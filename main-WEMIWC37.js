var A1e=Object.create;var ES=Object.defineProperty,O1e=Object.defineProperties,R1e=Object.getOwnPropertyDescriptor,M1e=Object.getOwnPropertyDescriptors,F1e=Object.getOwnPropertyNames,L_=Object.getOwnPropertySymbols,P1e=Object.getPrototypeOf,BO=Object.prototype.hasOwnProperty,o9=Object.prototype.propertyIsEnumerable;var LO=(n,t)=>(t=Symbol[n])?t:Symbol.for("Symbol."+n),$1e=n=>{throw TypeError(n)};var r9=(n,t,e)=>t in n?ES(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,Tt=(n,t)=>{for(var e in t||={})BO.call(t,e)&&r9(n,e,t[e]);if(L_)for(var e of L_(t))o9.call(t,e)&&r9(n,e,t[e]);return n},Tn=(n,t)=>O1e(n,M1e(t));var NS=(n,t)=>{var e={};for(var r in n)BO.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&L_)for(var r of L_(n))t.indexOf(r)<0&&o9.call(n,r)&&(e[r]=n[r]);return e};var D=(n,t)=>()=>(n&&(t=n(n=0)),t);var uo=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Br=(n,t)=>{for(var e in t)ES(n,e,{get:t[e],enumerable:!0})},s9=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of F1e(t))!BO.call(n,o)&&o!==e&&ES(n,o,{get:()=>t[o],enumerable:!(r=R1e(t,o))||r.enumerable});return n};var kS=(n,t,e)=>(e=n!=null?A1e(P1e(n)):{},s9(t||!n||!n.__esModule?ES(e,"default",{value:n,enumerable:!0}):e,n)),B_=n=>s9(ES({},"__esModule",{value:!0}),n);var Te=(n,t,e)=>new Promise((r,o)=>{var s=u=>{try{a(e.next(u))}catch(c){o(c)}},i=u=>{try{a(e.throw(u))}catch(c){o(c)}},a=u=>u.done?r(u.value):Promise.resolve(u.value).then(s,i);a((e=e.apply(n,t)).next())}),L1e=function(n,t){this[0]=n,this[1]=t};var bp=n=>{var t=n[LO("asyncIterator")],e=!1,r,o={};return t==null?(t=n[LO("iterator")](),r=s=>o[s]=i=>t[s](i)):(t=t.call(n),r=s=>o[s]=i=>{if(e){if(e=!1,s==="throw")throw i;return i}return e=!0,{done:!1,value:new L1e(new Promise(a=>{var u=t[s](i);u instanceof Object||$1e("Object expected"),a(u)}),1)}}),o[LO("iterator")]=()=>o,r("next"),"throw"in t?r("throw"):o.throw=s=>{throw s},"return"in t&&r("return"),o};function Ot(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}var s0,kh,gM=D(()=>{"use strict";s0=class{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}},kh=class{decComplexRef(t){}time(t){return Ot("time")}read(t){return Ot("read")}readSync(t){return Ot("readSync")}numDataIds(){return Ot("numDataIds")}disposeData(t){return Ot("disposeData")}write(t,e,r){return Ot("write")}move(t,e,r,o){return Ot("move")}memory(){return Ot("memory")}floatPrecision(){return Ot("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}batchMatMul(t,e,r,o){return Ot("batchMatMul")}fusedBatchMatMul({a:t,b:e,transposeA:r,transposeB:o,bias:s,activation:i,preluActivationWeights:a}){return Ot("fusedBatchMatMul")}slice(t,e,r){return Ot("slice")}stridedSlice(t,e,r,o){return Ot("stridedSlice")}unstack(t,e){return Ot("unstack")}reverse(t,e){return Ot("reverse")}concat(t,e){return Ot("concat")}neg(t){return Ot("neg")}add(t,e){return Ot("add")}addN(t){return Ot("addN")}subtract(t,e){return Ot("subtract")}multiply(t,e){return Ot("multiply")}realDivide(t,e){return Ot("realDivide")}floorDiv(t,e){return Ot("floorDiv")}sum(t,e){return Ot("sum")}prod(t,e){return Ot("prod")}unsortedSegmentSum(t,e,r){return Ot("unsortedSegmentSum")}argMin(t,e){return Ot("argMin")}argMax(t,e){return Ot("argMax")}equal(t,e){return Ot("equal")}notEqual(t,e){return Ot("notEqual")}less(t,e){return Ot("less")}lessEqual(t,e){return Ot("lessEqual")}greater(t,e){return Ot("greater")}greaterEqual(t,e){return Ot("greaterEqual")}logicalNot(t){return Ot("logicalNot")}logicalAnd(t,e){return Ot("logicalAnd")}logicalOr(t,e){return Ot("logicalOr")}where(t){return Ot("where")}select(t,e,r){return Ot("select")}topk(t,e,r){return Ot("topk")}min(t,e){return Ot("min")}minimum(t,e){return Ot("minimum")}mod(t,e){return Ot("mod")}max(t,e){return Ot("max")}maximum(t,e){return Ot("maximum")}all(t,e){return Ot("all")}any(t,e){return Ot("any")}squaredDifference(t,e){return Ot("squaredDifference")}ceil(t){return Ot("ceil")}floor(t){return Ot("floor")}round(t){return Ot("round")}sign(t){return Ot("sign")}isNaN(t){return Ot("isNaN")}isInf(t){return Ot("isInf")}isFinite(t){return Ot("isFinite")}pow(t,e){return Ot("pow")}exp(t){return Ot("exp")}expm1(t){return Ot("expm1")}softmax(t,e){return Ot("softmax")}log(t){return Ot("log")}log1p(t){return Ot("log1p")}sqrt(t){return Ot("sqrt")}rsqrt(t){return Ot("rsqrt")}square(t){return Ot("square")}reciprocal(t){return Ot("reciprocal")}relu(t){return Ot("relu")}relu6(t){return Ot("relu6")}prelu(t,e){return Ot("prelu")}elu(t){return Ot("elu")}eluDer(t,e){return Ot("eluDer")}selu(t){return Ot("selu")}int(t){return Ot("int")}clip(t,e,r){return Ot("clip")}abs(t){return Ot("abs")}complexAbs(t){return Ot("complexAbs")}sigmoid(t){return Ot("sigmoid")}softplus(t){return Ot("softplus")}sin(t){return Ot("sin")}cos(t){return Ot("cos")}tan(t){return Ot("tan")}asin(t){return Ot("asin")}acos(t){return Ot("acos")}atan(t){return Ot("atan")}atan2(t,e){return Ot("atan2")}sinh(t){return Ot("sinh")}cosh(t){return Ot("cosh")}tanh(t){return Ot("tanh")}asinh(t){return Ot("asinh")}acosh(t){return Ot("acosh")}atanh(t){return Ot("atanh")}erf(t){return Ot("erf")}step(t,e){return Ot("step")}fusedConv2d({input:t,filter:e,convInfo:r,bias:o,activation:s,preluActivationWeights:i}){return Ot("fusedConv2d")}conv2d(t,e,r){return Ot("conv2d")}conv2dDerInput(t,e,r){return Ot("conv2dDerInput")}conv2dDerFilter(t,e,r){return Ot("conv2dDerFilter")}fusedDepthwiseConv2D({input:t,filter:e,convInfo:r,bias:o,activation:s,preluActivationWeights:i}){return Ot("fusedDepthwiseConv2D")}depthwiseConv2D(t,e,r){return Ot("depthwiseConv2D")}depthwiseConv2DDerInput(t,e,r){return Ot("depthwiseConv2DDerInput")}depthwiseConv2DDerFilter(t,e,r){return Ot("depthwiseConv2DDerFilter")}conv3d(t,e,r){return Ot("conv3d")}conv3dDerInput(t,e,r){return Ot("conv3dDerInput")}conv3dDerFilter(t,e,r){return Ot("conv3dDerFilter")}maxPool(t,e){return Ot("maxPool")}maxPoolBackprop(t,e,r,o){return Ot("maxPoolBackprop")}avgPool(t,e){return Ot("avgPool")}avgPoolBackprop(t,e,r){return Ot("avgPoolBackprop")}avgPool3d(t,e){return Ot("avgPool3d")}avgPool3dBackprop(t,e,r){return Ot("avgPool3dBackprop")}maxPool3d(t,e){return Ot("maxPool3d")}maxPool3dBackprop(t,e,r,o){return Ot("maxPool3dBackprop")}reshape(t,e){return Ot("reshape")}cast(t,e){return Ot("cast")}tile(t,e){return Ot("tile")}pad(t,e,r){return Ot("pad")}transpose(t,e){return Ot("transpose")}gather(t,e,r,o=0){return Ot("gather")}gatherND(t,e){return Ot("gatherND")}scatterND(t,e,r){return Ot("scatterND")}batchToSpaceND(t,e,r){return Ot("batchToSpaceND")}spaceToBatchND(t,e,r){return Ot("spaceToBatchND")}resizeBilinear(t,e,r,o,s){return Ot("resizeBilinear")}resizeBilinearBackprop(t,e,r){return Ot("resizeBilinearBackprop")}resizeNearestNeighbor(t,e,r,o,s){return Ot("resizeNearestNeighbor")}resizeNearestNeighborBackprop(t,e,r){return Ot("resizeNearestNeighborBackprop")}batchNorm(t,e,r,o,s,i){return Ot("batchNorm")}localResponseNormalization4D(t,e,r,o,s){return Ot("localResponseNormalization4D")}LRNGrad(t,e,r,o,s,i,a){return Ot("LRNGrad")}multinomial(t,e,r,o){return Ot("multinomial")}oneHot(t,e,r,o){return Ot("oneHot")}cumsum(t,e,r,o){return Ot("cumsum")}nonMaxSuppression(t,e,r,o,s){return Ot("nonMaxSuppression")}fft(t){return Ot("fft")}ifft(t){return Ot("ifft")}complex(t,e){return Ot("complex")}real(t){return Ot("real")}imag(t){return Ot("imag")}cropAndResize(t,e,r,o,s,i){return Ot("cropAndResize")}depthToSpace(t,e,r){return Ot("depthToSpace")}split(t,e,r){return Ot("split")}sparseToDense(t,e,r,o){return Ot("sparseToDense")}diag(t){return Ot("diag")}fill(t,e,r){return Ot("fill")}onesLike(t){return Ot("onesLike")}zerosLike(t){return Ot("zerosLike")}linspace(t,e,r){return Ot("linspace")}dispose(){return Ot("dispose")}}});function dU(n){let t=n.length,e=0,r=0;for(;t>0;)r=Math.random()*t|0,t--,e=n[t],n[t]=n[r],n[r]=e}function Dv(n,t,e){return Math.max(n,Math.min(t,e))}function zCe(n){return n%2===0?n:n+1}function VCe(n){let t=0;for(let e=0;e<n.length;e++)t+=n[e];return t}function jCe(n,t){let e=Math.random();return t*e+(1-e)*n}function UCe(n,t){let e=0;for(let r=0;r<n.length;r++){let o=Number(n[r])-Number(t[r]);e+=o*o}return e}function ke(n,t){if(!n)throw new Error(typeof t=="string"?t:t())}function vr(n,t,e=""){ke(fu(n,t),()=>e+` Shapes ${n} and ${t} must match`)}function Hc(n){ke(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Np(n,t=[],e=!1){if(t==null&&(t=[]),Array.isArray(n)||_i(n)&&!e)for(let r=0;r<n.length;++r)Np(n[r],t,e);else t.push(n);return t}function xo(n){if(n.length===0)return 1;let t=n[0];for(let e=1;e<n.length;e++)t*=n[e];return t}function qCe(n){return n.length===0}function fu(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function to(n){return n%1===0}function GCe(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;{let t=Math.exp(2*n);return(t-1)/(t+1)}}function WCe(n){let t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function HCe(n){let t=new Uint32Array(n);for(let e=0;e<n;++e)t[e]=e;return dU(t),t}function t1(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function KCe(n,t=r=>0,e){return new Promise((r,o)=>{let s=0,i=()=>{if(n()){r();return}s++;let a=t(s);if(e!=null&&s>=e){o();return}setTimeout(i,a)};i()})}function XCe(n,t){let e=1,r=-1;for(let s=0;s<n.length;++s)if(n[s]>=0)e*=n[s];else if(n[s]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${s}`);r=s}else if(n[s]<0)throw Error(`Shapes can not be < 0. Found ${n[s]} at dim ${s}`);if(r===-1){if(t>0&&t!==e)throw Error(`Size(${t}) must match the product of shape ${n}`);return n}if(e===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(t%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${e}`);let o=n.slice();return o[r]=t/e,o}function ui(n,t){let e=t.length;return n=n==null?t.map((r,o)=>o):[].concat(n),ke(n.every(r=>r>=-e&&r<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${n}`),ke(n.every(r=>to(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?e+r:r)}function yM(n,t){let e=[],r=[],o=t!=null&&Array.isArray(t)&&t.length===0,s=t==null||o?null:ui(t,n).sort(),i=0;for(let a=0;a<n.length;++a){if(s!=null){if(s[i]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(s[i]==null||s[i]>a)&&n[a]===1&&(e.push(n[a]),r.push(a)),s[i]<=a&&i++}n[a]!==1&&(e.push(n[a]),r.push(a))}return{newShape:e,keptDims:r}}function xM(n,t){let e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else throw new Error(`Unknown data type ${n}`);return e}function bM(n,t){let e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else if(n==="string")e=new Array(t);else throw new Error(`Unknown data type ${n}`);return e}function vM(n,t){for(let e=0;e<n.length;e++){let r=n[e];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function wM(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function SM(n,t){return!(t==="complex64"||t==="float32"&&n!=="complex64"||t==="int32"&&n!=="float32"&&n!=="complex64"||t==="bool"&&n==="bool")}function _i(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function CM(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function IM(n){if(n==null)return 0;let t=0;return n.forEach(e=>t+=e.length),t}function kp(n){return typeof n=="string"||n instanceof String}function fU(n){return typeof n=="boolean"}function mU(n){return typeof n=="number"}function Av(n){return Array.isArray(n)?Av(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":mU(n)?"float32":kp(n)?"string":fU(n)?"bool":"float32"}function Dh(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Ov(n,t){for(let e=t;e<n;++e)if(n%e===0)return e;return n}function Ah(n){let t=n.length;if(t<2)return[];let e=new Array(t-1);e[t-2]=n[t-1];for(let r=t-3;r>=0;--r)e[r]=e[r+1]*n[r+1];return e}function gU(n,t,e){let r=new Array;if(t.length===1){let o=t[0];for(let s=0;s<o;s++)r[s]=e[n+s]}else{let o=t[0],s=t.slice(1),i=s.reduce((a,u)=>a*u);for(let a=0;a<o;a++)r[a]=gU(n+a*i,s,e)}return r}function e1(n,t){if(n.length===0)return t[0];let e=n.reduce((r,o)=>r*o);if(e===0)return[];if(e!==t.length)throw new Error(`[${n}] does not match the input size ${t.length}.`);return gU(0,n,t)}function NC(n,t){let e=Rv(n,t);for(let r=0;r<e.length;r++)e[r]=1;return e}function Rv(n,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${t}`)}function YCe(n,t){let e=n.reduce((r,o)=>r*o,1);if(t==null||t==="float32")return e1(n,new Float32Array(e));if(t==="int32")return e1(n,new Int32Array(e));if(t==="bool")return e1(n,new Uint8Array(e));throw new Error(`Unknown data type ${t}`)}function kC(n){n.forEach(t=>{ke(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function QCe(n,t,e){if(t===0)return 0;if(t===1)return n[0];let r=n[n.length-1];for(let o=0;o<n.length-1;++o)r+=e[o]*n[o];return r}function ZCe(n,t,e){if(t===0)return[];if(t===1)return[n];let r=new Array(t);for(let o=0;o<r.length-1;++o)r[o]=Math.floor(n/e[o]),n-=r[o]*e[o];return r[r.length-1]=n,r}function DC(n){return n&&n.then&&typeof n.then=="function"}var UE=D(()=>{"use strict";});function eIe(n){let t={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...r)=>(tIe(t,r[0],r[1]),r.join("="))),t}function tIe(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function nIe(n,t){if(t=t.toLowerCase(),t==="true"||t==="false")return t==="true";if(`${+t}`===t)return+t;throw new Error(`Could not parse value flag value ${t} for flag ${n}.`)}function mt(){return qE}function xU(n){qE=n}var yU,Mv,qE,Ua=D(()=>{"use strict";UE();yU="tfjsflags",Mv=class{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}setPlatform(t,e){this.platform!=null&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`),this.platformName=t,this.platform=e}registerFlag(t,e,r){if(this.flagRegistry[t]={evaluationFn:e,setHook:r},this.urlFlags[t]!=null){let o=this.urlFlags[t];console.warn(`Setting feature override from URL ${t}: ${o}.`),this.set(t,o)}}getAsync(t){return Te(this,null,function*(){return t in this.flags?this.flags[t]:(this.flags[t]=yield this.evaluateFlag(t),this.flags[t])})}get(t){if(t in this.flags)return this.flags[t];let e=this.evaluateFlag(t);if(DC(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let t=eIe(this.global.location.search);yU in t&&t[yU].split(",").forEach(r=>{let[o,s]=r.split(":");this.urlFlags[o]=nIe(o,s)})}};qE=null});function TM(){if(_M==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");_M=n}return _M}function rIe(){let n=TM();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function EM(n,t){let e=rIe();if(e.has(n))return e.get(n);{let r=t();return e.set(n,r),e.get(n)}}var _M,NM=D(()=>{"use strict";});var Uf,Oh,Rh,Nl,qf,n1,r1,Gf,Wf,Mh,Fh,Ph,$h,Lh,Hf,o1,Kf,s1,Xf,Yf,i1,kM,Dp,Bh,zh,a1,Qf,Zf,Jf,u1,em,tm,c1,l1,Vh,jh,nm,p1,h1,d1,rm,f1,m1,g1,om,Fv,Pv,Uh,qh,y1,Gh,i0,Wh,sm,Hh,x1,b1,v1,Kh,Xh,im,am,w1,a0,Yh,um,S1,C1,Qh,Zh,Jh,cm,u0,c0,I1,ed,td,l0,p0,h0,DM,lm,_1,pm,nd,hm,T1,dm,E1,N1,fm,mm,rd,gm,od,k1,sd,ym,d0,D1,A1,O1,xm,bm,vm,wm,oIe,id,Sm,R1,M1,F1,ad,ud,Cm,Im,P1,_m,$1,cd,Tm,ld,pd,L1,Em,hd,Nm,dd,fd,md,gd,yd,xd,km,Dm,Am,Om,bd,B1,vd,z1,V1,wd,Sd,Ap,j1,Rm,U1,Mm,Fm,Pm,Cd,$v,q1,f0,m0,g0,Ze=D(()=>{"use strict";Uf="Abs",Oh="Acos",Rh="Acosh",Nl="Add",qf="AddN",n1="All",r1="Any",Gf="ArgMax",Wf="ArgMin",Mh="Asin",Fh="Asinh",Ph="Atan",$h="Atanh",Lh="Atan2",Hf="AvgPool",o1="AvgPoolGrad",Kf="AvgPool3D",s1="AvgPool3DGrad",Xf="BatchMatMul",Yf="BatchToSpaceND",i1="Bincount",kM="BroadcastTo",Dp="Cast",Bh="Ceil",zh="ClipByValue",a1="Complex",Qf="ComplexAbs",Zf="Concat",Jf="Conv2D",u1="Conv2DBackpropFilter",em="Conv2DBackpropInput",tm="Conv3D",c1="Conv3DBackpropFilterV2",l1="Conv3DBackpropInputV2",Vh="Cos",jh="Cosh",nm="Cumsum",p1="CropAndResize",h1="DenseBincount",d1="DepthToSpace",rm="DepthwiseConv2dNative",f1="DepthwiseConv2dNativeBackpropFilter",m1="DepthwiseConv2dNativeBackpropInput",g1="Diag",om="Dilation2D",Fv="Dilation2DBackpropInput",Pv="Dilation2DBackpropFilter",Uh="RealDiv",qh="Elu",y1="EluGrad",Gh="Erf",i0="Equal",Wh="Exp",sm="ExpandDims",Hh="Expm1",x1="FFT",b1="Fill",v1="FlipLeftRight",Kh="Floor",Xh="FloorDiv",im="FusedBatchNorm",am="GatherV2",w1="GatherNd",a0="Greater",Yh="GreaterEqual",um="Identity",S1="IFFT",C1="Imag",Qh="IsFinite",Zh="IsInf",Jh="IsNan",cm="LeakyRelu",u0="Less",c0="LessEqual",I1="LinSpace",ed="Log",td="Log1p",l0="LogicalAnd",p0="LogicalNot",h0="LogicalOr",DM="LogSoftmax",lm="LRN",_1="LRNGrad",pm="Max",nd="Maximum",hm="MaxPool",T1="MaxPoolGrad",dm="MaxPool3D",E1="MaxPool3DGrad",N1="MaxPoolWithArgmax",fm="Mean",mm="Min",rd="Minimum",gm="MirrorPad",od="Mod",k1="Multinomial",sd="Multiply",ym="Neg",d0="NotEqual",D1="NonMaxSuppressionV3",A1="NonMaxSuppressionV4",O1="NonMaxSuppressionV5",xm="OnesLike",bm="OneHot",vm="Pack",wm="PadV2",oIe="Pool",id="Pow",Sm="Prelu",R1="Prod",M1="Range",F1="Real",ad="Reciprocal",ud="Relu",Cm="Reshape",Im="ResizeNearestNeighbor",P1="ResizeNearestNeighborGrad",_m="ResizeBilinear",$1="ResizeBilinearGrad",cd="Relu6",Tm="Reverse",ld="Round",pd="Rsqrt",L1="ScatterNd",Em="Select",hd="Selu",Nm="Slice",dd="Sin",fd="Sinh",md="Sign",gd="Sigmoid",yd="Softplus",xd="Sqrt",km="Sum",Dm="SpaceToBatchND",Am="SplitV",Om="Softmax",bd="SquaredDifference",B1="Square",vd="Sub",z1="SparseToDense",V1="StridedSlice",wd="Tan",Sd="Tanh",Ap="Tile",j1="TopK",Rm="Transpose",U1="Unique",Mm="Unpack",Fm="UnsortedSegmentSum",Pm="ZerosLike",Cd="Step",$v="FromPixels",q1="RotateWithOffset",f0="_FusedMatMul",m0="FusedConv2D",g0="FusedDepthwiseConv2D"});function OC(n,t){let e=OM(n,t);return Lv.get(e)}function GE(n){return AC.get(n)}function RC(n){let t=Lv.entries(),e=[];for(;;){let{done:r,value:o}=t.next();if(r)break;let[s,i]=o,[a]=s.split("_");a===n&&e.push(i)}return e}function Bv(n){let{kernelName:t,backendName:e}=n,r=OM(t,e);Lv.has(r)&&console.warn(`The kernel '${t}' for backend '${e}' is already registered`),Lv.set(r,n)}function AM(n){let{kernelName:t}=n;AC.has(t)&&mt().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${t}'`),AC.set(t,n)}function sIe(n,t){let e=OM(n,t);if(!Lv.has(e))throw new Error(`The kernel '${n}' for backend '${t}' is not registered`);Lv.delete(e)}function iIe(n){if(!AC.has(n))throw new Error(`The gradient '${n}' for backend is not registered`);AC.delete(n)}function aIe(n,t){RC(n).forEach(r=>{let o=Object.assign({},r,{backendName:t});Bv(o)})}function OM(n,t){return`${t}_${n}`}var Lv,AC,MC=D(()=>{"use strict";Ua();NM();Lv=EM("kernelRegistry",()=>new Map),AC=EM("gradRegistry",()=>new Map)});var Y={};Br(Y,{arraysEqual:()=>fu,assert:()=>ke,assertNonNegativeIntegerDimensions:()=>kC,assertNonNull:()=>Hc,assertShapesMatch:()=>vr,bytesFromStringArray:()=>IM,bytesPerElement:()=>CM,checkConversionForErrors:()=>vM,clamp:()=>Dv,computeStrides:()=>Ah,createScalarValue:()=>uIe,createShuffledIndices:()=>HCe,decodeString:()=>Vv,distSquared:()=>UCe,encodeString:()=>y0,fetch:()=>lIe,flatten:()=>Np,getArrayFromDType:()=>bM,getTypedArrayFromDType:()=>xM,hasEncodingLoss:()=>SM,indexToLoc:()=>ZCe,inferDtype:()=>Av,inferFromImplicitShape:()=>XCe,isBoolean:()=>fU,isFunction:()=>Dh,isInt:()=>to,isNumber:()=>mU,isPromise:()=>DC,isScalarShape:()=>qCe,isString:()=>kp,isTypedArray:()=>_i,isValidDtype:()=>wM,locToIndex:()=>QCe,makeOnesTypedArray:()=>NC,makeZerosNestedTypedArray:()=>YCe,makeZerosTypedArray:()=>Rv,nearestDivisor:()=>Ov,nearestLargerEven:()=>zCe,now:()=>WE,parseAxisParam:()=>ui,randUniform:()=>jCe,repeatedTry:()=>KCe,rightPad:()=>t1,shuffle:()=>dU,sizeFromShape:()=>xo,sizeToSquarishShape:()=>WCe,squeezeShape:()=>yM,sum:()=>VCe,tanh:()=>GCe,toNestedArray:()=>e1,toTypedArray:()=>zv});function uIe(n,t){return t==="string"?y0(n):zv([n],t)}function cIe(n,t){return n instanceof Float32Array&&t==="float32"||n instanceof Int32Array&&t==="int32"||n instanceof Uint8Array&&t==="bool"}function zv(n,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Np(n)),mt().getBool("DEBUG")&&vM(n,t),cIe(n,t))return n;if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool"){let e=new Uint8Array(n.length);for(let r=0;r<e.length;++r)Math.round(n[r])!==0&&(e[r]=1);return e}else throw new Error(`Unknown data type ${t}`)}function WE(){return mt().platform.now()}function lIe(n,t){return mt().platform.fetch(n,t)}function y0(n,t="utf-8"){return t=t||"utf-8",mt().platform.encode(n,t)}function Vv(n,t="utf-8"){return t=t||"utf-8",mt().platform.decode(n,t)}var Rt=D(()=>{"use strict";Ua();UE();UE();});function pIe(n,t,e){if(t!=="float32")return!1;for(let r=0;r<n.length;r++){let o=n[r];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${e}'`),!0}return!1}var HE,RM,bU=D(()=>{"use strict";Ua();Rt();HE=class{constructor(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new RM)}profileKernel(t,e,r){let o,s=()=>{o=r()},i=this.backendTimer.time(s);if(mt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<o.length;u++){let c=o[u];c.data().then(h=>{pIe(h,c.dtype,t)})}return{kernelName:t,outputs:o,inputs:e,timeMs:i.then(u=>u.kernelMs),extraInfo:i.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(t){let{kernelName:e,outputs:r,timeMs:o,inputs:s,extraInfo:i}=t;r.forEach(a=>{Promise.all([a.data(),o,i]).then(u=>{this.logger.logKernelProfile(e,a,u[0],u[1],s,u[2])})})}};RM=class{logKernelProfile(t,e,r,o,s,i){let a=typeof o=="number"?t1(`${o}ms`,9):o.error,u=t1(t,25),c=e.rank,h=e.size,f=t1(e.shape.toString(),14),g="";for(let d in s){let p=s[d];if(p!=null){let m=p.shape||e.shape,y=m.length;g+=`${d}: ${y}D ${y>0?m:""} `}}console.log(`%c${u}	%c${a}	%c${c}D ${f}	%c${h}	%c${g}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}});function vU(n,t,e){let r={},o={};for(let u=0;u<t.length;u++)r[t[u].id]=!0;for(let u=0;u<n.length;u++){let c=n[u],h=c.inputs;for(let f in h){let g=h[f],d=!1;for(let p=0;p<t.length;p++)if(r[g.id]){c.outputs.forEach(m=>r[m.id]=!0),d=!0,o[c.id]=!0;break}if(d)break}}let s={};s[e.id]=!0;let i={};for(let u=n.length-1;u>=0;u--){let c=n[u],h=c.inputs;for(let f=0;f<c.outputs.length;f++)if(s[c.outputs[f].id]){for(let g in h)s[h[g].id]=!0,i[c.id]=!0;break}}let a=[];for(let u=0;u<n.length;u++){let c=n[u];if(o[c.id]&&i[c.id]){let h={};for(let g in c.inputs){let d=c.inputs[g];r[d.id]&&(h[g]=d)}let f=Object.assign({},c);f.inputs=h,f.outputs=c.outputs,a.push(f)}}return a}function wU(n,t,e,r){for(let o=t.length-1;o>=0;o--){let s=t[o],i=[];if(s.outputs.forEach(u=>{let c=n[u.id];c!=null?i.push(c):i.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);let a=s.gradient(i);for(let u in s.inputs){if(!(u in a))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(a)}.`);let c=e(()=>a[u]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${c.dtype}'`);let h=s.inputs[u];if(!fu(c.shape,h.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${u}' has shape '${c.shape}', which does not match the shape of the input '${h.shape}'`);if(n[h.id]==null)n[h.id]=c;else{let f=n[h.id];n[h.id]=r(f,c),f.dispose()}}}}var SU=D(()=>{"use strict";Rt();});function IU(n,t,e,r){let o=Ah(t),s=hIe(n,t,e,o),i=t.length,a=KE(n,t,e,o,s),u=["Tensor"];return r&&(u.push(`  dtype: ${e}`),u.push(`  rank: ${i}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(a.map(c=>"    "+c).join(`
`)),u.join(`
`)}function hIe(n,t,e,r){let o=xo(t),s=r[r.length-1],i=new Array(s).fill(0),a=t.length,u=e==="complex64"?$C(n):n;if(a>1)for(let c=0;c<o/s;c++){let h=c*s;for(let f=0;f<s;f++)i[f]=Math.max(i[f],PC(u[h+f],0,e).length)}return i}function PC(n,t,e){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(MM))} + ${parseFloat(n[1].toFixed(MM))}j`:kp(n)?r=`'${n}'`:e==="bool"?r=_U(n):r=parseFloat(n.toFixed(MM)).toString(),t1(r,t)}function _U(n){return n===0?"false":"true"}function KE(n,t,e,r,o,s=!0){let i=e==="complex64"?2:1,a=t[0],u=t.length;if(u===0){if(e==="complex64"){let m=$C(n);return[PC(m[0],0,e)]}return e==="bool"?[_U(n[0])]:[n[0].toString()]}if(u===1){if(a>CU){let y=FC*i,v=Array.from(n.slice(0,y)),N=Array.from(n.slice((a-FC)*i,a*i));return e==="complex64"&&(v=$C(v),N=$C(N)),["["+v.map((T,O)=>PC(T,o[O],e)).join(", ")+", ..., "+N.map((T,O)=>PC(T,o[a-FC+O],e)).join(", ")+"]"]}return["["+(e==="complex64"?$C(n):Array.from(n)).map((y,v)=>PC(y,o[v],e)).join(", ")+"]"]}let c=t.slice(1),h=r.slice(1),f=r[0]*i,g=[];if(a>CU){for(let m=0;m<FC;m++){let y=m*f,v=y+f;g.push(...KE(n.slice(y,v),c,e,h,o,!1))}g.push("...");for(let m=a-FC;m<a;m++){let y=m*f,v=y+f;g.push(...KE(n.slice(y,v),c,e,h,o,m===a-1))}}else for(let m=0;m<a;m++){let y=m*f,v=y+f;g.push(...KE(n.slice(y,v),c,e,h,o,m===a-1))}let d=u===2?",":"";g[0]="["+g[0]+d;for(let m=1;m<g.length-1;m++)g[m]=" "+g[m]+d;let p=`,
`;for(let m=2;m<u;m++)p+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(s?"":p),g}function $C(n){let t=[];for(let e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}var CU,FC,MM,TU=D(()=>{"use strict";Rt();CU=20,FC=3,MM=7});function EU(n){Id=n}function NU(n){jv=n}function kU(n){dIe=n}var no,Id,jv,dIe,Me,_d,Ct=D(()=>{"use strict";TU();Rt();Rt();no=class{constructor(t,e,r){if(this.dtype=e,this.shape=t.slice(),this.size=xo(t),r!=null){let o=r.length;ke(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||bM(e,this.size),this.strides=Ah(t)}set(t,...e){e.length===0&&(e=[0]),ke(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);let r=this.locToIndex(e);this.values[r]=t}get(...t){t.length===0&&(t=[0]);let e=0;for(let o of t){if(o<0||o>=this.shape[e]){let s=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(s)}e++}let r=t[t.length-1];for(let o=0;o<t.length-1;++o)r+=this.strides[o]*t[o];return this.values[r]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let e=t[t.length-1];for(let r=0;r<t.length-1;++r)e+=this.strides[r]*t[r];return e}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];let e=new Array(this.shape.length);for(let r=0;r<e.length-1;++r)e[r]=Math.floor(t/this.strides[r]),t-=e[r]*this.strides[r];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return Id().makeTensor(this.values,this.shape,this.dtype)}},Id=null,jv=null,dIe=null;Me=class{constructor(t,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=xo(t),this.strides=Ah(t),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}buffer(){return Te(this,null,function*(){let t=yield this.data();return jv.buffer(this.shape,this.dtype,t)})}bufferSync(){return jv.buffer(this.shape,this.dtype,this.dataSync())}array(){return Te(this,null,function*(){let t=yield this.data();return e1(this.shape,t)})}arraySync(){return e1(this.shape,this.dataSync())}data(){return Te(this,null,function*(){this.throwIfDisposed();let t=Id().read(this.dataId);if(this.dtype==="string"){let e=yield t;try{return e.map(r=>Vv(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t})}dataSync(){this.throwIfDisposed();let t=Id().readSync(this.dataId);if(this.dtype==="string")try{return t.map(e=>Vv(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}bytes(){return Te(this,null,function*(){this.throwIfDisposed();let t=yield Id().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)})}dispose(){this.isDisposed||(Id().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return jv.print(this,t)}clone(){return this.throwIfDisposed(),jv.clone(this)}toString(t=!1){let e=this.dataSync();return IU(e,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),jv.cast(this,t)}variable(t=!0,e,r){return this.throwIfDisposed(),Id().makeVariable(this,t,e,r)}};Object.defineProperty(Me,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});_d=class extends Me{constructor(t,e,r,o){super(t.shape,t.dtype,t.dataId,o),this.trainable=e,this.name=r}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!fu(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);Id().disposeTensor(this),this.dataId=t.dataId,Id().incRef(this,null)}dispose(){Id().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(_d,Symbol.hasInstance,{value:n=>n instanceof Me&&n.assign!=null&&n.assign instanceof Function})});function ci(n,t){if(n==="string"||t==="string"){if(n==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${n} with ${t}`)}return fIe[n][t]}function x0(n){return ci(n,"int32")}var FM,DU,AU,OU,RU,fIe,XE=D(()=>{"use strict";FM=function(n){return n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6",n}(FM||{}),DU=function(n){return n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64",n}(DU||{}),AU=function(n){return n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64",n}(AU||{}),OU=function(n){return n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64",n}(OU||{}),RU=function(n){return n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64",n}(RU||{}),fIe={float32:OU,int32:DU,bool:AU,complex64:RU}});var Kc={};Br(Kc,{assertTypesMatch:()=>PM,getTensorsInContainer:()=>LC,isTensorInList:()=>mIe,makeTypesMatch:()=>Cr});function Cr(n,t){if(n.dtype===t.dtype)return[n,t];let e=ci(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function PM(n,t){ke(n.dtype===t.dtype,()=>`The dtypes of the first(${n.dtype}) and second(${t.dtype}) input must match`)}function mIe(n,t){return t.some(e=>e.id===n.id)}function LC(n){let t=[];return MU(n,t,new Set),t}function MU(n,t,e){if(n==null)return;if(n instanceof Me){t.push(n);return}if(!gIe(n))return;let r=n;for(let o in r){let s=r[o];e.has(s)||(e.add(s),MU(s,t,e))}}function gIe(n){return Array.isArray(n)||typeof n=="object"}var us=D(()=>{"use strict";Ct();XE();Rt();});function xIe(n){let t=NC(xo(n),"float32");return De.makeTensor(t,n,"float32")}function $M(){let n=TM();if(n._tfengine==null){let t=new Mv(n);n._tfengine=new yIe(t)}return xU(n._tfengine.ENV),EU(()=>n._tfengine),n._tfengine}function bIe(n,t){let e={a:n,b:t};return De.runKernel(Nl,e)}var YE,yIe,De,yt=D(()=>{"use strict";gM();Ua();NM();Ze();MC();bU();SU();Ct();us();Rt();Rt();YE=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(let t in this.registeredVariables)this.registeredVariables[t].dispose()}},yIe=(()=>{class n{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new YE}ready(){return Te(this,null,function*(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r];if(yield this.initializeBackend(o).success){yield this.setBackend(o);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")})}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:r}=this.initializeBackendsAndReturnBest();if(r)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:r}=this.initializeBackend(e);if(r)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,r,o=1){return e in this.registryFactory?(console.warn(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:r,priority:o},!0)}setBackend(e){return Te(this,null,function*(){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:r,asyncInit:o}=this.initializeBackend(e);if(!(o?yield r:r))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new HE(this.backendInstance),!0})}setupRegisteredKernels(){RC(this.backendName).forEach(r=>{r.setupFunc!=null&&r.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){RC(e).forEach(o=>{o.disposeFunc!=null&&o.disposeFunc(this.registry[e])})}initializeBackend(e){let r=this.registryFactory[e];if(r==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let o=r.factory();if(o&&!(o instanceof kh)&&typeof o.then=="function"){let s=++this.pendingBackendInitId,i=o.then(a=>s<this.pendingBackendInitId?!1:(this.registry[e]=a,this.pendingBackendInit=null,!0)).catch(a=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${e} failed`),console.warn(a.stack||a.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=o,{success:!0,asyncInit:!1}}catch(o){return console.warn(`Initialization of backend ${e} failed`),console.warn(o.stack||o.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,r)=>this.registryFactory[r].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r],{success:s,asyncInit:i}=this.initializeBackend(o);if(i||s)return{name:o,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,r){let o=this.state.tensorInfo.get(r),s=o.backend,i=this.readSync(r);s.disposeData(r),o.backend=e,e.move(r,i,o.shape,o.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,r){let o=null;if(r==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");r=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof r!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}let s;return this.scopedRun(()=>this.startScope(o),()=>this.endScope(s),()=>(s=r(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(e,r,o){e();try{let s=o();return r(),s}catch(s){throw r(),s}}nextTensorId(){return n.nextTensorId++}nextVariableId(){return n.nextVariableId++}clone(e){let r=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),o={x:e},s=a=>({x:()=>{let u="float32",c={x:a},h={dtype:u};return De.runKernelFunc(f=>f.cast(a,u),c,null,Dp,h)}}),i=[];return this.addTapeNode(this.state.activeScope.name,o,[r],s,i,{}),r}runKernel(e,r,o,s,i){return this.runKernelFunc(null,r,null,e,o,s,i)}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,r,o){let s=this.backend.numDataIds(),i=0;o.forEach(c=>{i+=c.dtype==="complex64"?3:1});let a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],u=s-r-i-a;if(u>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${u} data ids) after running '${e}'`)}runKernelFunc(e,r,o,s,i,a,u){let c,h=[],f=this.isTapeOn();s==null&&(s=this.state.activeScope!=null?this.state.activeScope.name:"");let g=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let p;this.backendName==null&&this.backend;let m=OC(s,this.backendName),y;if(m!=null)p=()=>{let N=this.backend.numDataIds();y=m.kernelFunc({inputs:r,attrs:i,backend:this.backend});let T=Array.isArray(y)?y:[y];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(s,N,T);let O=T.map(S=>{if(S.rank!=null)return S;let{dataId:F,shape:R,dtype:L}=S;return this.makeTensorFromDataId(F,R,L)});if(f){let S=this.getTensorsForGradient(s,r,O);if(S==null){u==null&&(u=[]);let F=O.filter((R,L)=>u[L]);S=(a||[]).slice().concat(F)}h=this.saveTensorsForBackwardMode(S)}return O};else{if(e==null)throw new Error(`Error running ${s}: Neither modular kernel nor forward func passed`);let N=T=>{f&&(h=T.map(O=>this.keep(this.clone(O))))};p=()=>{let T=this.backend.numDataIds();y=this.tidy(()=>e(this.backend,N));let O=Array.isArray(y)?y:[y];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(s,T,O),O}}let v;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?c=p():(v=this.profiler.profileKernel(s,r,()=>p()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(v),c=v.outputs)}),f&&this.addTapeNode(s,r,c,o,h,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:s,bytesAdded:this.state.numBytes-g,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(r).map(N=>r[N]!=null?r[N].shape:null),outputShapes:c.map(N=>N.shape),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(y)?c:c[0]}saveTensorsForBackwardMode(e){return e.map(o=>this.keep(this.clone(o)))}getTensorsForGradient(e,r,o){let s=GE(e);if(s!=null){let i=s.inputsToSave||[],a=s.outputsToSave||[],u;s.saveAllInputs?(ke(Array.isArray(r),()=>"saveAllInputs is true, expected inputs to be an array."),u=Object.keys(r).map(h=>r[h])):u=i.map(h=>r[h]);let c=o.filter((h,f)=>a[f]);return u.concat(c)}return null}makeTensor(e,r,o,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");o=o||"float32",s=s||this.backend;let i=e;o==="string"&&kp(e[0])&&(i=e.map(c=>y0(c)));let a=s.write(i,r,o),u=new Me(r,o,a,this.nextTensorId());if(this.incRef(u,s),o==="string"){let c=this.state.tensorInfo.get(a),h=IM(i);this.state.numBytes+=h-c.bytes,c.bytes=h}return u}makeTensorFromDataId(e,r,o,s){o=o||"float32";let i=new Me(r,o,e,this.nextTensorId());return this.incRef(i,s),i}makeVariable(e,r=!0,o,s){o=o||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.cast(s));let i=new _d(e,r,o,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}incRef(e,r){let o=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,o===0){this.state.numDataBuffers++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*CM(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:r||this.backend,dtype:e.dtype,shape:e.shape,bytes:s,refCount:0}),this.state.numBytes+=s}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof _d||this.track(e)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;let r=this.state.tensorInfo.get(e.dataId);r.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=r.bytes),this.state.numDataBuffers--,r.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):(r.backend.decComplexRef(e.dataId),this.state.tensorInfo.get(e.dataId).refCount--)}disposeVariables(){for(let e in this.state.registeredVariables){let r=this.state.registeredVariables[e];this.disposeVariable(r)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}profile(e){return Te(this,null,function*(){this.state.profiling=!0;let r=this.state.numBytes,o=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=yield e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-r,this.state.activeProfile.newTensors=this.state.numTensors-o;for(let s of this.state.activeProfile.kernels)s.kernelTimeMs=yield s.kernelTimeMs,s.extraInfo=yield s.extraInfo;return this.state.activeProfile})}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,r,o,s,i,a){let u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:r,outputs:o,saved:i},c=GE(e);c!=null&&(s=c.gradFunc),s!=null&&(u.gradient=h=>(h=h.map((f,g)=>{if(f==null){let d=o[g],p=Rv(d.size,d.dtype);return this.makeTensor(p,d.shape,d.dtype)}return f}),s(h.length>1?h:h[0],i,a))),this.state.activeTape.push(u)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let r={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(r.name=e),this.state.scopeStack.push(r),this.state.activeScope=r}endScope(e){let r=LC(e),o=new Set(r.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let a=this.state.activeScope.track[i];!a.kept&&!o.has(a.id)&&a.dispose()}let s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(i=>{!i.kept&&i.scopeId===s.id&&this.track(i)})}gradients(e,r,o,s=!1){if(ke(r.length>0,()=>"gradients() received an empty list of xs."),o!=null&&o.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${o.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));ke(i instanceof Me,()=>"The result y returned by f() must be a tensor.");let a=vU(this.state.activeTape,r,i);if(!s&&a.length===0&&r.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let u={};u[i.id]=o??xIe(i.shape),wU(u,a,h=>this.tidy(h),bIe);let c=r.map(h=>u[h.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(h=>{for(let f of h.saved)f.dispose()}),this.state.activeTape=null),{value:i,grads:c}})}customGrad(e){return ke(Dh(e),()=>"The f passed in customGrad(f) must be a function."),(...r)=>{ke(r.every(i=>i instanceof Me),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let o,s={};return r.forEach((i,a)=>{s[a]=i}),this.runKernelFunc((i,a)=>(o=e(...r,a),ke(o.value instanceof Me,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),ke(Dh(o.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),o.value),s,(i,a)=>{let u=o.gradFunc(i,a),c=Array.isArray(u)?u:[u];ke(c.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),ke(c.every(f=>f instanceof Me),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let h={};return c.forEach((f,g)=>{h[g]=()=>f}),h})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}time(e){return Te(this,null,function*(){let r=WE(),o=yield this.backend.time(e);return o.wallMs=WE()-r,o})}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new YE;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}return n.nextTensorId=0,n.nextVariableId=0,n})();De=$M()});var b0={};Br(b0,{isBrowser:()=>LM,isMobile:()=>wIe});function vIe(){return typeof navigator<"u"&&navigator!=null}function wIe(){if(vIe()){let n=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))}return!1}function LM(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var BM=D(()=>{"use strict";});var Td,Uv=D(()=>{"use strict";yt();BM();Ua();Td=mt();Td.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Td.registerFlag("IS_BROWSER",()=>LM());Td.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Td.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Td.registerFlag("PROD",()=>!1);Td.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Td.getBool("DEBUG"));Td.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Td.registerFlag("IS_TEST",()=>!1);Td.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0)});function va(n,t){let e=n;if(_i(n))return t==="string"?[]:[n.length];if(!Array.isArray(n))return[];let r=[];for(;Array.isArray(e)||_i(e)&&t!=="string";)r.push(e.length),e=e[0];return Array.isArray(n)&&mt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&PU(n,r,[]),r}function PU(n,t,e){if(e=e||[],!Array.isArray(n)&&!_i(n)){ke(t.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}ke(t.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${n.length} elements`),ke(n.length===t[0],()=>`Element arr[${e.join("][")}] should have ${t[0]} elements, but has ${n.length} elements`);let r=t.slice(1);for(let o=0;o<n.length;++o)PU(n[o],r,e.concat(o))}function FU(n,t,e,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==t||n==="numeric"&&t==="string")throw new Error(`Argument '${e}' passed to '${r}' must be ${n} tensor, but got ${t} tensor`)}}function le(n,t,e,r="numeric"){if(n instanceof Me)return FU(r,n.dtype,t,e),n;let o=Av(n);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),FU(r,o,t,e),n==null||!_i(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){let u=n==null?"null":n.constructor.name;throw new Error(`Argument '${t}' passed to '${e}' must be a Tensor or TensorLike, but got '${u}'`)}let s=va(n,o);!_i(n)&&!Array.isArray(n)&&(n=[n]);let a=o!=="string"?zv(n,o):Np(n,[],!0);return De.makeTensor(a,s,o)}function $m(n,t,e,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${t} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((s,i)=>le(s,`${t}[${i}]`,e,r))}var ht=D(()=>{"use strict";yt();Ua();Ct();Rt();});function Se(n){let t=Object.keys(n);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let e=t[0],r=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+zM;let o=(...s)=>{De.startScope(e);try{let i=r(...s);return DC(i)&&console.error("Cannot return a Promise inside of tidy."),De.endScope(i),i}catch(i){throw De.endScope(null),i}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}var zM,at=D(()=>{"use strict";yt();Rt();zM="__op"});function SIe(n,t){let e=le(n,"real","complex"),r=le(t,"imag","complex");vr(e.shape,r.shape,`real and imag shapes, ${e.shape} and ${r.shape}, must match in call to tf.complex().`);let o={real:e,imag:r};return De.runKernel(a1,o)}var Bu,G1=D(()=>{"use strict";yt();Ze();ht();Rt();at();Bu=Se({complex_:SIe})});function mu(n,t,e,r){if(r==null&&(r=Av(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!_i(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){kC(t);let o=xo(t),s=xo(e);ke(o===s,()=>`Based on the provided shape, [${t}], the tensor should have ${o} values but has ${s}`);for(let i=0;i<e.length;++i){let a=e[i],u=i===e.length-1?a!==xo(t.slice(i)):!0;ke(e[i]===t[i]||!u,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${t}). `)}}return!_i(n)&&!Array.isArray(n)&&(n=[n]),t=t||e,n=r!=="string"?zv(n,r):Np(n,[],!0),De.makeTensor(n,t,r)}var Lm=D(()=>{"use strict";yt();Rt();});function wa(n,t,e){let r=va(n,e);return mu(n,t,r,e)}var QE=D(()=>{"use strict";ht();Lm();});var BC,VM=D(()=>{"use strict";BC={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8}});function LU(n,t){return Te(this,null,function*(){let e=[],r=[],o=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<o.length;++i){let a=o[i],u=Array.isArray(n)?n[i].tensor:n[a];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${u.dtype}`);let c={name:a,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){let h=new Promise(f=>Te(null,null,function*(){let g=yield u.bytes(),d=g.reduce((y,v)=>y+v.length,0)+ZE*g.length,p=new Uint8Array(d),m=0;for(let y=0;y<g.length;y++){let v=g[y],N=new Uint8Array(new Uint32Array([v.length]).buffer);p.set(N,m),m+=ZE,p.set(v,m),m+=v.length}f(p)}));r.push(h)}else r.push(u.data());t!=null&&(c.group=t),e.push(c)}let s=yield Promise.all(r);return{data:CIe(s),specs:e}})}function JE(n,t){let e={},r,o=0;for(let s of t){let i=s.name,a=s.dtype,u=s.shape,c=xo(u),h;if("quantization"in s){let f=s.quantization;if(f.dtype==="uint8"||f.dtype==="uint16"){if(!("min"in f&&"scale"in f))throw new Error(`Weight ${s.name} with quantization ${f.dtype} doesn't have corresponding metadata min and scale.`)}else if(f.dtype==="float16"){if(a!=="float32")throw new Error(`Weight ${s.name} is quantized with ${f.dtype} which only supports weights of type float32 not ${a}.`)}else throw new Error(`Weight ${s.name} has unknown quantization dtype ${f.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let g=BC[f.dtype],d=n.slice(o,o+c*g),p=f.dtype==="uint8"?new Uint8Array(d):new Uint16Array(d);if(a==="float32")if(f.dtype==="uint8"||f.dtype==="uint16"){h=new Float32Array(p.length);for(let m=0;m<p.length;m++){let y=p[m];h[m]=y*f.scale+f.min}}else if(f.dtype==="float16")r===void 0&&(r=EIe()),h=r(p);else throw new Error(`Unsupported quantization type ${f.dtype} for weight type float32.`);else if(a==="int32"){if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error(`Unsupported quantization type ${f.dtype} for weight type int32.`);h=new Int32Array(p.length);for(let m=0;m<p.length;m++){let y=p[m];h[m]=Math.round(y*f.scale+f.min)}}else throw new Error(`Unsupported dtype in weight '${i}': ${a}`);o+=c*g}else if(a==="string"){let f=xo(s.shape);h=[];for(let g=0;g<f;g++){let d=new Uint32Array(n.slice(o,o+ZE))[0];o+=ZE;let p=new Uint8Array(n.slice(o,o+d));h.push(p),o+=d}}else{let f=BC[a],g=n.slice(o,o+c*f);if(a==="float32")h=new Float32Array(g);else if(a==="int32")h=new Int32Array(g);else if(a==="bool")h=new Uint8Array(g);else if(a==="complex64"){h=new Float32Array(g);let d=new Float32Array(h.length/2),p=new Float32Array(h.length/2);for(let v=0;v<d.length;v++)d[v]=h[v*2],p[v]=h[v*2+1];let m=wa(d,u,"float32"),y=wa(p,u,"float32");e[i]=Bu(m,y),m.dispose(),y.dispose()}else throw new Error(`Unsupported dtype in weight '${i}': ${a}`);o+=c*f}a!=="complex64"&&(e[i]=wa(h,u,a))}return e}function CIe(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let t=0,e=[];n.forEach(s=>{if(t+=s.byteLength,e.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});let r=new Uint8Array(t),o=0;return e.forEach(s=>{r.set(new Uint8Array(s.buffer),o),o+=s.byteLength}),r.buffer}function $U(n){return jM?Buffer.byteLength(n):new Blob([n]).size}function BU(n){if(jM)return Buffer.from(n).toString("base64");let t=new Uint8Array(n),e="";for(let r=0,o=t.length;r<o;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function zU(n){if(jM){let r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let t=atob(n),e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e.set([t.charCodeAt(r)],r);return e.buffer}function qv(n){if(n.length===1)return n[0];let t=0;n.forEach(o=>{t+=o.byteLength});let e=new Uint8Array(t),r=0;return n.forEach(o=>{e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function UM(n){let t="/";for(n=n.trim();n.endsWith(t);)n=n.slice(0,n.length-1);let e=n.split(t);return e[e.length-1]}function Ed(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:$U(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:$U(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function IIe(){let n=e=>{let r=e<<13,o=0;for(;(r&8388608)===0;)o-=8388608,r<<=1;return r&=-8388609,o+=947912704,r|o},t=new Uint32Array(2048);t[0]=0;for(let e=1;e<1024;e++)t[e]=n(e);for(let e=1024;e<2048;e++)t[e]=939524096+(e-1024<<13);return t}function _Ie(){let n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let t=1;t<31;t++)n[t]=t<<23;for(let t=33;t<63;t++)n[t]=2147483648+(t-32<<23);return n}function TIe(){let n=new Uint32Array(64);for(let t=0;t<64;t++)n[t]=1024;return n[0]=n[32]=0,n}function EIe(){let n=IIe(),t=_Ie(),e=TIe();return r=>{let o=new ArrayBuffer(4*r.length),s=new Uint32Array(o);for(let i=0;i<r.length;i++){let a=r[i],u=n[e[a>>10]+(a&1023)]+t[a>>10];s[i]=u}return new Float32Array(o)}}var ZE,jM,W1=D(()=>{"use strict";G1();QE();Rt();VM();ZE=4;jM=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u")});var Fi,VU,jU,UU,qU,H1=D(()=>{"use strict";Fi=class n{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return n.instance==null&&(n.instance=new n),n.instance}static registerSaveRouter(t){n.getInstance().saveRouters.push(t)}static registerLoadRouter(t){n.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return n.getHandlers(t,"save")}static getLoadHandlers(t,e){return n.getHandlers(t,"load",e)}static getHandlers(t,e,r){let o=[];return(e==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(i=>{let a=i(t,r);a!==null&&o.push(a)}),o}},VU=n=>Fi.registerSaveRouter(n),jU=n=>Fi.registerLoadRouter(n),UU=n=>Fi.getSaveHandlers(n),qU=(n,t)=>Fi.getLoadHandlers(n,t)});function GU(){if(!mt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let n=typeof window>"u"?self:window,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function WM(n){let t=n.result;t.createObjectStore(K1,{keyPath:"modelPath"}),t.createObjectStore(v0,{keyPath:"modelPath"})}function NIe(n){return new X1(n)}function kIe(n){return n.startsWith(X1.URL_SCHEME)?n.slice(X1.URL_SCHEME.length):n}var qM,GM,K1,v0,X1,WU,eN,HM=D(()=>{"use strict";Uv();Ua();W1();H1();qM="tensorflowjs",GM=1,K1="models_store",v0="model_info_store";X1=(()=>{class n{constructor(e){if(this.indexedDB=GU(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}save(e){return Te(this,null,function*(){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)})}load(){return Te(this,null,function*(){return this.databaseAction(this.modelPath)})}databaseAction(e,r){return new Promise((o,s)=>{let i=this.indexedDB.open(qM,GM);i.onupgradeneeded=()=>WM(i),i.onsuccess=()=>{let a=i.result;if(r==null){let u=a.transaction(K1,"readonly"),h=u.objectStore(K1).get(this.modelPath);h.onsuccess=()=>{if(h.result==null)return a.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));o(h.result.modelArtifacts)},h.onerror=f=>(a.close(),s(h.error)),u.oncomplete=()=>a.close()}else{let u=Ed(r),c=a.transaction(v0,"readwrite"),h=c.objectStore(v0),f=h.put({modelPath:this.modelPath,modelArtifactsInfo:u}),g;f.onsuccess=()=>{g=a.transaction(K1,"readwrite");let p=g.objectStore(K1).put({modelPath:this.modelPath,modelArtifacts:r,modelArtifactsInfo:u});p.onsuccess=()=>o({modelArtifactsInfo:u}),p.onerror=m=>{h=c.objectStore(v0);let y=h.delete(this.modelPath);y.onsuccess=()=>(a.close(),s(p.error)),y.onerror=v=>(a.close(),s(p.error))}},f.onerror=d=>(a.close(),s(f.error)),c.oncomplete=()=>{g==null?a.close():g.oncomplete=()=>a.close()}}},i.onerror=a=>s(i.error)})}}return n.URL_SCHEME="indexeddb://",n})(),WU=n=>mt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(X1.URL_SCHEME)?NIe(n.slice(X1.URL_SCHEME.length)):null;Fi.registerSaveRouter(WU);Fi.registerLoadRouter(WU);eN=class{constructor(){this.indexedDB=GU()}listModels(){return Te(this,null,function*(){return new Promise((t,e)=>{let r=this.indexedDB.open(qM,GM);r.onupgradeneeded=()=>WM(r),r.onsuccess=()=>{let o=r.result,s=o.transaction(v0,"readonly"),a=s.objectStore(v0).getAll();a.onsuccess=()=>{let u={};for(let c of a.result)u[c.modelPath]=c.modelArtifactsInfo;t(u)},a.onerror=u=>(o.close(),e(a.error)),s.oncomplete=()=>o.close()},r.onerror=o=>e(r.error)})})}removeModel(t){return Te(this,null,function*(){return t=kIe(t),new Promise((e,r)=>{let o=this.indexedDB.open(qM,GM);o.onupgradeneeded=()=>WM(o),o.onsuccess=()=>{let s=o.result,i=s.transaction(v0,"readwrite"),a=i.objectStore(v0),u=a.get(t),c;u.onsuccess=()=>{if(u.result==null)return s.close(),r(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{let h=a.delete(t),f=()=>{c=s.transaction(K1,"readwrite");let d=c.objectStore(K1).delete(t);d.onsuccess=()=>e(u.result.modelArtifactsInfo),d.onerror=p=>r(u.error)};h.onsuccess=f,h.onerror=g=>(f(),s.close(),r(u.error))}},u.onerror=h=>(s.close(),r(u.error)),i.oncomplete=()=>{c==null?s.close():c.oncomplete=()=>s.close()}},o.onerror=s=>r(o.error)})})}}});function KU(n){return{info:[Gv,n,HU].join(Bm),topology:[Gv,n,DIe].join(Bm),weightSpecs:[Gv,n,AIe].join(Bm),weightData:[Gv,n,OIe].join(Bm),modelMetadata:[Gv,n,RIe].join(Bm)}}function MIe(n){let t=n.split(Bm);if(t.length<3)throw new Error(`Invalid key format: ${n}`);return t.slice(1,t.length-1).join(Bm)}function FIe(n){return n.startsWith(Y1.URL_SCHEME)?n.slice(Y1.URL_SCHEME.length):n}function PIe(n){return new Y1(n)}var Bm,Gv,HU,DIe,AIe,OIe,RIe,Y1,XU,tN,KM=D(()=>{"use strict";Uv();Ua();Rt();W1();H1();Bm="/",Gv="tensorflowjs_models",HU="info",DIe="model_topology",AIe="weight_specs",OIe="weight_data",RIe="model_metadata";Y1=(()=>{class n{constructor(e){if(!mt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=KU(this.modelPath)}save(e){return Te(this,null,function*(){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let r=JSON.stringify(e.modelTopology),o=JSON.stringify(e.weightSpecs),s=Ed(e);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,r),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,BU(e.weightData));let i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};return e.signature!=null&&(i.signature=e.signature),e.userDefinedMetadata!=null&&(i.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(i.modelInitializer=e.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:s}}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}})}load(){return Te(this,null,function*(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let r={},o=JSON.parse(this.LS.getItem(this.keys.topology));if(o==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);r.modelTopology=o;let s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);r.weightSpecs=s;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let u=JSON.parse(i);r.format=u.format,r.generatedBy=u.generatedBy,r.convertedBy=u.convertedBy,u.signature!=null&&(r.signature=u.signature),u.userDefinedMetadata!=null&&(r.userDefinedMetadata=u.userDefinedMetadata),u.modelInitializer!=null&&(r.modelInitializer=u.modelInitializer)}let a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return r.weightData=zU(a),r})}}return n.URL_SCHEME="localstorage://",n})(),XU=n=>mt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Y1.URL_SCHEME)?PIe(n.slice(Y1.URL_SCHEME.length)):null;Fi.registerSaveRouter(XU);Fi.registerLoadRouter(XU);tN=class{constructor(){ke(mt().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),ke(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}listModels(){return Te(this,null,function*(){let t={},e=Gv+Bm,r=Bm+HU;for(let o=0;o<this.LS.length;++o){let s=this.LS.key(o);if(s.startsWith(e)&&s.endsWith(r)){let i=MIe(s);t[i]=JSON.parse(this.LS.getItem(s))}}return t})}removeModel(t){return Te(this,null,function*(){t=FIe(t);let e=KU(t);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${t}'`);let r=JSON.parse(this.LS.getItem(e.info));return this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),r})}}});function nN(n){if(n.indexOf(Wv)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Op.getSchemes().join(",")}`);return{scheme:n.split(Wv)[0],path:n.split(Wv)[1]}}function YU(n,t,e=!1){return Te(this,null,function*(){ke(n!==t,()=>`Old path and new path are the same: '${n}'`);let r=Fi.getLoadHandlers(n);ke(r.length>0,()=>`Copying failed because no load handler is found for source URL ${n}.`),ke(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${n}.`);let o=r[0],s=Fi.getSaveHandlers(t);ke(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),ke(s.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`);let i=s[0],a=nN(n).scheme,u=nN(n).path,c=a===nN(n).scheme,h=yield o.load();e&&c&&(yield Op.getManager(a).removeModel(u));let f=yield i.save(h);return e&&!c&&(yield Op.getManager(a).removeModel(u)),f.modelArtifactsInfo})}function QU(){return Te(this,null,function*(){let n=Op.getSchemes(),t={};for(let e of n){let r=yield Op.getManager(e).listModels();for(let o in r){let s=e+Wv+o;t[s]=r[o]}}return t})}function ZU(n){return Te(this,null,function*(){let t=nN(n);return Op.getManager(t.scheme).removeModel(t.path)})}function JU(n,t){return Te(this,null,function*(){return YU(n,t,!1)})}function eq(n,t){return Te(this,null,function*(){return YU(n,t,!0)})}var Wv,Op,XM=D(()=>{"use strict";Rt();H1();Wv="://",Op=class n{constructor(){this.managers={}}static getInstance(){return n.instance==null&&(n.instance=new n),n.instance}static registerManager(t,e){ke(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(Wv)&&(t=t.slice(0,t.indexOf(Wv))),ke(t.length>0,()=>"scheme must not be an empty string.");let r=n.getInstance();ke(r.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),r.managers[t]=e}static getManager(t){let e=this.getInstance().managers[t];if(e==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}});var YM,tq=D(()=>{"use strict";Uv();Ua();HM();KM();XM();YM=class{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}};if(mt().get("IS_BROWSER")){mt().setPlatform("browser",new YM);try{Op.registerManager(Y1.URL_SCHEME,new tN)}catch{}try{Op.registerManager(X1.URL_SCHEME,new eN)}catch{}}});var rq=uo((Hv,nq)=>{"use strict";var $Ie=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Q1=$Ie();nq.exports=Hv=Q1.fetch;Q1.fetch&&(Hv.default=Q1.fetch.bind(Q1));Hv.Headers=Q1.Headers;Hv.Request=Q1.Request;Hv.Response=Q1.Response});var oq=uo(()=>{"use strict"});var LIe,QM,ZM,sq=D(()=>{"use strict";Ua();LIe={importFetch:()=>rq()},ZM=class{constructor(){this.util=oq(),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return mt().global.fetch!=null?mt().global.fetch(t,e):(QM==null&&(QM=LIe.importFetch()),QM(t,e))}now(){let t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)}};mt().get("IS_NODE")&&mt().setPlatform("node",new ZM)});function Rn(n,t="float32",e){return t=t||"float32",kC(n),new no(n,t,e)}var zm=D(()=>{"use strict";Ct();Rt();});function BIe(n,t){let e=le(n,"x","cast");if(!wM(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:e},o={dtype:t};return De.runKernel(Dp,r,o)}var Wt,Mr=D(()=>{"use strict";yt();Ze();ht();Rt();at();Wt=Se({cast_:BIe})});function zIe(n){let e={x:le(n,"x","clone","string_or_numeric")};return De.runKernel(um,e)}var hc,Kv=D(()=>{"use strict";yt();Ze();ht();at();hc=Se({clone_:zIe})});function rN(n,t=!1){console.log(n.toString(t))}var JM=D(()=>{"use strict";});var VIe,iq=D(()=>{"use strict";yt();Uv();tq();sq();zm();Mr();Kv();JM();Ct();$M();VIe={buffer:Rn,cast:Wt,clone:hc,print:rN};NU(VIe)});function aq(n){return new Promise(t=>setTimeout(t)).then(n)}function WIe(n="model"){return new eF(n)}function uq(n){return new tF(n)}var jIe,UIe,qIe,eF,tF,GIe,cq=D(()=>{"use strict";Uv();Ua();W1();H1();jIe="model",UIe=".json",qIe=".weights.bin";eF=(()=>{class n{constructor(e){if(!mt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),(e==null||e.length===0)&&(e=jIe),this.modelTopologyFileName=e+UIe,this.weightDataFileName=e+qIe}save(e){return Te(this,null,function*(){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let r=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let o=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],s={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(s.signature=e.signature),e.userDefinedMetadata!=null&&(s.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(s.modelInitializer=e.modelInitializer);let i=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor;if(a.download=this.modelTopologyFileName,a.href=i,yield aq(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=r,yield aq(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Ed(e)}}})}}return n.URL_SCHEME="downloads://",n})(),tF=class{constructor(t){if(t==null||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.files=t}load(){return Te(this,null,function*(){let t=this.files[0],e=this.files.slice(1);return new Promise((r,o)=>{let s=new FileReader;s.onload=i=>{let a=JSON.parse(i.target.result),u=a.modelTopology;if(u==null){o(new Error(`modelTopology field is missing from file ${t.name}`));return}e.length===0&&r({modelTopology:u});let c=a.weightsManifest;if(c==null){o(new Error(`weightManifest field is missing from file ${t.name}`));return}let h;try{h=this.checkManifestAndWeightFiles(c,e)}catch(p){o(p);return}let f=[],g=[],d=[];c.forEach(p=>{p.paths.forEach(m=>{g.push(m),d.push(null)}),f.push(...p.weights)}),c.forEach(p=>{p.paths.forEach(m=>{let y=new FileReader;y.onload=v=>{let N=v.target.result,T=g.indexOf(m);if(d[T]=N,d.indexOf(null)===-1){let O={modelTopology:u,weightSpecs:f,weightData:qv(d),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy};a.signature!=null&&(O.signature=a.signature),a.userDefinedMetadata!=null&&(O.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(O.modelInitializer=a.modelInitializer),r(O)}},y.onerror=v=>o(`Failed to weights data from file of path '${m}'.`),y.readAsArrayBuffer(h[m])})})},s.onerror=i=>o(`Failed to read model topology and weights manifest JSON from file '${t.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(t)})})}checkManifestAndWeightFiles(t,e){let r=[],o=e.map(i=>UM(i.name)),s={};for(let i of t)i.paths.forEach(a=>{let u=UM(a);if(r.indexOf(u)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${u}'`);if(r.push(u),o.indexOf(u)===-1)throw new Error(`Weight file with basename '${u}' is not provided.`);s[a]=e[o.indexOf(u)]});if(r.length!==e.length)throw new Error(`Mismatch in the number of files in weights manifest (${r.length}) and the number of weight files provided (${e.length}).`);return s}},GIe=n=>mt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(eF.URL_SCHEME)?WIe(n.slice(eF.URL_SCHEME.length)):null;Fi.registerSaveRouter(GIe)});function nF(n,t,e,r){i(n),e=e??0,r=r??1,a(e,r);let o=0,s=u=>(u.then(c=>{let h=e+ ++o/n.length*(r-e);return t(h),c}),u);function i(u){ke(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function a(u,c){ke(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),ke(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),ke(c>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${c}`)}return Promise.all(n.map(s))}var lq=D(()=>{"use strict";Rt();});function rF(n,t){return Te(this,null,function*(){t==null&&(t={});let e=t.fetchFunc==null?mt().platform.fetch:t.fetchFunc,r=n.map(f=>e(f,t.requestInit,{isBinary:!0})),a=(t.onProgress==null?yield Promise.all(r):yield nF(r,t.onProgress,0,.5)).map(f=>f.arrayBuffer());return t.onProgress==null?yield Promise.all(a):yield nF(a,t.onProgress,.5,1)})}function pq(n,t="",e,r){return Te(this,null,function*(){return oF(i=>rF(i,{requestInit:r}))(n,t,e)})}function oF(n){return(t,e="",r)=>Te(null,null,function*(){let o=t.map(()=>!1),s={},i=r!=null?r.map(()=>!1):[],a=[];if(t.forEach((d,p)=>{let m=0;d.weights.forEach(y=>{let v="quantization"in y?y.quantization.dtype:y.dtype,N=BC[v]*xo(y.shape),T=()=>{o[p]=!0,s[p]==null&&(s[p]=[]),s[p].push({manifestEntry:y,groupOffset:m,sizeBytes:N})};r!=null?r.forEach((O,S)=>{O===y.name&&(T(),i[S]=!0)}):T(),a.push(y.name),m+=N})}),!i.every(d=>d)){let d=r.filter((p,m)=>!i[m]);throw new Error(`Could not find weights in manifest with names: ${d.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let u=o.reduce((d,p,m)=>(p&&d.push(m),d),[]),c=[];u.forEach(d=>{t[d].paths.forEach(p=>{let m=e+(e.endsWith("/")?"":"/")+p;c.push(m)})});let h=yield n(c),f={},g=0;return u.forEach(d=>{let p=t[d].paths.length,m=0;for(let O=0;O<p;O++)m+=h[g+O].byteLength;let y=new ArrayBuffer(m),v=new Uint8Array(y),N=0;for(let O=0;O<p;O++){let S=new Uint8Array(h[g+O]);v.set(S,N),N+=S.byteLength}s[d].forEach(O=>{let S=y.slice(O.groupOffset,O.groupOffset+O.sizeBytes),F=JE(S,[O.manifestEntry]);for(let R in F)f[R]=F[R]}),g+=p}),f})}var sF=D(()=>{"use strict";Ua();Rt();W1();lq();VM();});function XIe(n){let t=n.lastIndexOf("/"),e=n.lastIndexOf("?"),r=n.substring(0,t),o=e>t?n.substring(e):"";return[r+"/",o]}function oN(n){return n.match(hq.URL_SCHEME_REGEX)!=null}function sN(n,t){return new hq(n,t)}function fq(n,t){return sN(n,t)}var HIe,KIe,hq,dq,mq=D(()=>{"use strict";Ua();Rt();W1();H1();sF();HIe="application/octet-stream",KIe="application/json",hq=(()=>{class n{constructor(e,r){if(this.DEFAULT_METHOD="POST",r==null&&(r={}),this.weightPathPrefix=r.weightPathPrefix,this.onProgress=r.onProgress,this.weightUrlConverter=r.weightUrlConverter,r.fetchFunc!=null?(ke(typeof r.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=r.fetchFunc):this.fetch=mt().platform.fetch,ke(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&ke(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,r.requestInit!=null&&r.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=r.requestInit||{}}save(e){return Te(this,null,function*(){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let r=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);r.body=new FormData;let o=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],s={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(s.signature=e.signature),e.userDefinedMetadata!=null&&(s.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(s.modelInitializer=e.modelInitializer),r.body.append("model.json",new Blob([JSON.stringify(s)],{type:KIe}),"model.json"),e.weightData!=null&&r.body.append("model.weights.bin",new Blob([e.weightData],{type:HIe}),"model.weights.bin");let i=yield this.fetch(this.path,r);if(i.ok)return{modelArtifactsInfo:Ed(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)})}load(){return Te(this,null,function*(){let e=yield this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let r;try{r=yield e.json()}catch{let y=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?y+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":y+=" Please make sure the server is serving valid JSON for this request.",new Error(y)}let o=r.modelTopology,s=r.weightsManifest,i=r.generatedBy,a=r.convertedBy,u=r.format,c=r.signature,h=r.userDefinedMetadata;if(o==null&&s==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let f,g;s!=null&&([f,g]=yield this.loadWeights(s));let d={modelTopology:o,weightSpecs:f,weightData:g,generatedBy:i,convertedBy:a,format:u};c!=null&&(d.signature=c),h!=null&&(d.userDefinedMetadata=h);let p=r.modelInitializer;return p&&(d.modelInitializer=p),d})}loadWeights(e){return Te(this,null,function*(){let r=Array.isArray(this.path)?this.path[1]:this.path,[o,s]=XIe(r),i=this.weightPathPrefix||o,a=[];for(let f of e)a.push(...f.weights);let u=[],c=[];for(let f of e)for(let g of f.paths)this.weightUrlConverter!=null?c.push(this.weightUrlConverter(g)):u.push(i+g+s);this.weightUrlConverter&&u.push(...yield Promise.all(c));let h=yield rF(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[a,qv(h)]})}}return n.URL_SCHEME_REGEX=/^https?:\/\//,n})();dq=(n,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let e=!0;if(Array.isArray(n)?e=n.every(r=>oN(r)):e=oN(n),e)return sN(n,t)}return null};Fi.registerSaveRouter(dq);Fi.registerLoadRouter(dq)});function gq(n,t,e,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new zC(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zC({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zC({modelTopology:n,weightSpecs:t,weightData:e,trainingConfig:r}))}function yq(n){return new iF(n)}var zC,iF,xq=D(()=>{"use strict";zC=class{constructor(t){this.modelArtifacts=t}load(){return Te(this,null,function*(){return this.modelArtifacts})}},iF=class{constructor(t){this.saveHandler=t}save(t){return Te(this,null,function*(){return this.saveHandler(t)})}}});var Zi={};Br(Zi,{browserFiles:()=>uq,browserHTTPRequest:()=>fq,concatenateArrayBuffers:()=>qv,copyModel:()=>JU,decodeWeights:()=>JE,encodeWeights:()=>LU,fromMemory:()=>gq,getLoadHandlers:()=>qU,getModelArtifactsInfoForJSON:()=>Ed,getSaveHandlers:()=>UU,http:()=>sN,isHTTPScheme:()=>oN,listModels:()=>QU,loadWeights:()=>pq,moveModel:()=>eq,registerLoadRouter:()=>jU,registerSaveRouter:()=>VU,removeModel:()=>ZU,weightsLoaderFactory:()=>oF,withSaveHandler:()=>yq});var bq=D(()=>{"use strict";HM();KM();cq();mq();W1();xq();H1();sF();XM();});function YIe(n,t,e=!1,r=!1){let o=le(n,"a","matMul"),s=le(t,"b","matMul");[o,s]=Cr(o,s);let i={a:o,b:s},a={transposeA:e,transposeB:r};return De.runKernel(Xf,i,a)}var Ir,Nd=D(()=>{"use strict";yt();Ze();us();ht();at();Ir=Se({matMul_:YIe})});function QIe(n,t,e=1,r=0){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);let s={indices:le(n,"indices","oneHot","int32")},i={depth:t,onValue:e,offValue:r};return De.runKernel(bm,s,i)}var kl,iN=D(()=>{"use strict";yt();Ze();ht();at();kl=Se({oneHot_:QIe})});function ZIe(n,t){let e=le(n,"x","transpose");if(t==null&&(t=e.shape.map((s,i)=>i).reverse()),ke(e.rank===t.length,()=>`Error in transpose: rank of input ${e.rank} must match length of perm ${t}.`),t.forEach(s=>{ke(s>=0&&s<e.rank,()=>`All entries in 'perm' must be between 0 and ${e.rank-1} but got ${t}`)}),e.rank<=1)return e.clone();let r={x:e},o={perm:t};return De.runKernel(Rm,r,o)}var Dr,w0=D(()=>{"use strict";yt();Ze();ht();Rt();at();Dr=Se({transpose_:ZIe})});function JIe(n,t,e){let r=le(n,"labels","confusionMatrix"),o=le(t,"predictions","confusionMatrix");ke(e==null||e>0&&Number.isInteger(e),()=>`If provided, numClasses must be a positive integer, but got ${e}`),ke(r.rank===1,()=>`Expected the rank of labels to be 1, but got ${r.rank}`),ke(o.rank===1,()=>`Expected the rank of predictions to be 1, but got ${o.rank}`),ke(r.shape[0]===o.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${o.shape[0]}. Labels and predictions should have the same number of elements.`),ke(e>0&&Number.isInteger(e),()=>`numClasses is required to be a positive integer, but got ${e}`);let s=kl(Wt(r,"int32"),e),i=kl(Wt(o,"int32"),e),a=Dr(s),u=Ir(a,i);return Wt(u,"int32")}var vq,wq=D(()=>{"use strict";ht();Rt();Mr();Nd();iN();at();w0();vq=Se({confusionMatrix_:JIe})});var aF={};Br(aF,{confusionMatrix:()=>vq});var Sq=D(()=>{"use strict";wq();});function aN(n,t,e){if(Hc(n),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let r=va(n,e);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return mu(n,t,r,e)}var uF=D(()=>{"use strict";ht();Rt();Lm();});var VC={};Br(VC,{fromPixels:()=>n_e,toPixels:()=>t_e});function e_e(n,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let e=!1,r=!1,o=!1,s=!1,i=!1,a=!1;if(n.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)s=!0;else if(n.getContext!=null)i=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if(o&&o&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(OC($v,De.backendName)!=null){let p={pixels:n},m={numChannels:t};return De.runKernel($v,p,m)}let[c,h]=o?[n.videoWidth,n.videoHeight]:[n.width,n.height],f;i?f=n.getContext("2d").getImageData(0,0,c,h).data:r||e?f=n.data:(s||o||a)&&(Xv==null&&(Xv=document.createElement("canvas").getContext("2d")),Xv.canvas.width=c,Xv.canvas.height=h,Xv.drawImage(n,0,0,c,h),f=Xv.getImageData(0,0,c,h).data);let g;if(t===4)g=new Int32Array(f);else{let p=c*h;g=new Int32Array(p*t);for(let m=0;m<p;m++)for(let y=0;y<t;++y)g[m*t+y]=f[m*4+y]}return aN(g,[h,c,t],"int32")}function t_e(n,t){return Te(this,null,function*(){let e=le(n,"img","toPixels");if(!(n instanceof Me)){let c=e;e=Wt(c,"int32"),c.dispose()}if(e.rank!==2&&e.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${e.rank}.`);let[r,o]=e.shape.slice(0,2),s=e.rank===2?1:e.shape[2];if(s>4||s===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${s}`);if(e.dtype!=="float32"&&e.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${e.dtype}. Please use float32 or int32 tensors.`);let i=yield e.data(),a=e.dtype==="float32"?255:1,u=new Uint8ClampedArray(o*r*4);for(let c=0;c<r*o;++c){let h=[0,0,0,255];for(let g=0;g<s;g++){let d=i[c*s+g];if(e.dtype==="float32"){if(d<0||d>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${d}.`)}else if(e.dtype==="int32"&&(d<0||d>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${d}.`);s===1?(h[0]=d*a,h[1]=d*a,h[2]=d*a):h[g]=d*a}let f=c*4;u[f+0]=Math.round(h[0]),u[f+1]=Math.round(h[1]),u[f+2]=Math.round(h[2]),u[f+3]=Math.round(h[3])}if(t!=null){t.width=o,t.height=r;let c=t.getContext("2d"),h=new ImageData(u,o,r);c.putImageData(h,0,0)}return e!==n&&e.dispose(),u})}var Xv,n_e,Cq=D(()=>{"use strict";yt();Ze();MC();Ct();ht();Mr();at();uF();n_e=Se({fromPixels_:e_e})});var cF={};Br(cF,{prepareAndValidate:()=>Iq});function Iq(n,t){let e=n.shape.length,r=t.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${e}`);if(xo(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);let o=t.shape,s=o[o.length-1],i=1;for(let f=0;f<o.length-1;++f)i*=o[f];let a=n.shape,u=o.slice();u.pop();let c=1;for(let f=s;f<e;++f)c*=a[f],u.push(a[f]);let h=[...Ah(n.shape).map(f=>f/c),1].slice(0,s);return[u,i,c,h]}var lF=D(()=>{"use strict";Rt()});var cN={};Br(cN,{calculateShapes:()=>_q,validateInput:()=>uN,validateUpdateShape:()=>pF});function pF(n,t,e){let r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${t.shape}, shape: ${n}, sliceDim: ${r}, and batchDim: ${o}.`;if(e.rank<o)throw new Error(s+` update.rank < ${o}. `);if(n.length<r+(e.rank-o))throw new Error(s+` Output shape length < ${r+(e.rank-o)}`);if(e.rank!==o+n.length-r)throw new Error(s+` update.rank != ${o+n.length-r}`);for(let i=0;i<o;++i)if(e.shape[i]!==t.shape[i])throw new Error(s+` updates.shape[${i}] (${e.shape[i]}) != indices.shape[${i}] (${t.shape[i]}).`);for(let i=0;i<e.rank-o;++i)if(e.shape[i+o]!==n[i+r])throw new Error(s+` updates.shape[${i+o}] (${e.shape[i+o]}) != shape[${i+o}] (${n[i+o]})`)}function uN(n,t,e){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}pF(e,t,n)}function _q(n,t,e){let r=t.shape.length,o=r>1?t.shape[r-1]:1,s=e.length,i=1;for(let f=o;f<s;++f)i*=e[f];let a=o<1?1:o,u=xo(t.shape)/a,c=[...Ah(e.slice(0,o)),1],h=xo(e);return{sliceRank:o,numUpdates:u,sliceSize:i,strides:c,outputSize:h}}var lN=D(()=>{"use strict";Rt()});var Ji={};Br(Ji,{assertParamsValid:()=>r_e,computeFlatOffset:()=>s_e,computeOutShape:()=>Tq,getNormalizedAxes:()=>Dq,isSliceContinous:()=>o_e,maskToAxes:()=>pN,parseSliceParams:()=>hF,sliceInfo:()=>i_e,startForAxis:()=>Mq,startIndicesWithElidedDims:()=>Aq,stopForAxis:()=>Fq,stopIndicesWithElidedDims:()=>Oq,stridesForAxis:()=>Rq,stridesWithElidedDims:()=>Eq});function r_e(n,t,e){let r=n.shape.length;ke(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),ke(r===e.length,()=>`Error in slice${r}D: Length of size ${e} must match the rank of the array (${r}).`);for(let o=0;o<r;++o)ke(t[o]+e[o]<=n.shape[o],()=>`Error in slice${r}D: begin[${o}] + size[${o}] (${t[o]+e[o]}) would overflow input.shape[${o}] (${n.shape[o]})`)}function pN(n){let t=[],e=0;for(;n>0;)n&1&&t.push(e),n/=2,e++;return t}function Tq(n,t,e){let r=[];for(let o=0;o<n.length;o++)r[o]=Math.ceil((t[o]-n[o])/e[o]);return r}function Eq(n,t,e,r){let o=[...n];for(let s=o.length;s<r.length;s++)o.push(1);for(let s=0;s<e;s++)s===0?o[t]=1:(o.splice(t,0,1),o.pop());return o}function Nq(n,t,e){return e<=n?e:e-(t-1)}function kq(n,t){let e=[];for(let r=0;r<n;r++)e.push(t+r);return e}function Dq(n,t,e,r,o,s,i,a,u){let c=n.length,h=new Array(c),f=new Array(c),g=new Array(c);if(t.length&&e>0){let d=t[0],p=e+1;h=Aq(i,d,p,r,n),f=Oq(a,d,p,o,n),g=Eq(s,d,p,n)}else for(let d=0;d<c;d++)h[d]=Mq(i,r,s,n,d,u),f[d]=Fq(a,o,s,n,d,u),g[d]=Rq(s,d,u);return{begin:h,end:f,strides:g}}function Aq(n,t,e,r,o){let s=[...o],i=kq(e,t);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=0;else{let u=Nq(t,e,a),c=r[u];n&1<<u&&(c=0),s[a]=c}return s}function Oq(n,t,e,r,o){let s=[...o],i=kq(e,t);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{let u=Nq(t,e,a),c=r[u];n&1<<u&&(c=Number.MAX_SAFE_INTEGER),s[a]=c}for(let a=0;a<s.length;a++){let u=o[a];s[a]<0&&(s[a]+=u),s[a]=Dv(0,s[a],o[a])}return s}function Rq(n,t,e){let r=n[t];return(e&1<<t||r==null)&&(r=1),r}function Mq(n,t,e,r,o,s){let i=t[o],a=e[o]||1;(n&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);let u=r[o];return i<0&&(i+=u),i=Dv(0,i,u-1),i}function Fq(n,t,e,r,o,s){let i=t[o],a=e[o]||1;(n&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);let u=r[o];return i<0&&(i+=u),a>0?i=Dv(0,i,u):i=Dv(-1,i,u-1),i}function o_e(n,t,e){let r=e.length;for(let o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(let o=r+1;o<e.length;o++)if(t[o]>0||e[o]!==n[o])return!1;return!0}function s_e(n,t){let e=n.length>0?n[n.length-1]:1;for(let r=0;r<n.length-1;r++)e+=n[r]*t[r];return e}function hF(n,t,e){let r,o=n.shape.length;typeof t=="number"?r=[t,...new Array(o-1).fill(0)]:t.length<o?r=t.concat(new Array(o-t.length).fill(0)):r=t.slice(),r.forEach(i=>{ke(i!==-1,()=>"slice() does not support negative begin indexing.")});let s;return e==null?s=new Array(o).fill(-1):typeof e=="number"?s=[e,...new Array(o-1).fill(-1)]:e.length<o?s=e.concat(new Array(o-e.length).fill(-1)):s=e,s=s.map((i,a)=>i>=0?i:(ke(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),n.shape[a]-r[a])),[r,s]}function i_e(n,t,e,r,o,s,i,a,u){let c=t.slice(),h=e.slice(),f=r;r==null&&(f=new Array(c.length));let g=pN(i);if(g.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(i!==0&&a!==0)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(i!==0&&u!==0)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");let d=n.length-c.length,p=pN(a),m=n.slice();p.forEach(R=>{c[R]=0,h[R]=1,m.splice(R,0,1)});let{begin:y,end:v,strides:N}=Dq(m,g,d,c,h,f,o,s,i);c=y,h=v,f=N;let T=pN(u);T.forEach(R=>{h[R]=c[R]+1,f[R]=1});let O=Tq(c,h,f),S=O.filter((R,L)=>T.indexOf(L)===-1);return{nonStrided:f.every(R=>R===1),$begin:c,$end:h,$strides:f,size:O,newShape:m,outShape:S}}var hN=D(()=>{"use strict";Rt();});var Lt={};Br(Lt,{Serializable:()=>jC,SerializationMap:()=>dN,registerClass:()=>zu});function zu(n){ke(n.className!=null,()=>"Class being registered does not have the static className property defined."),ke(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),ke(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),dN.register(n)}var jC,dN,kd=D(()=>{"use strict";Rt();jC=class{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}},dN=class n{constructor(){this.classNameMap={}}static getMap(){return n.instance==null&&(n.instance=new n),n.instance}static register(t){n.getMap().classNameMap[t.className]=[t,t.fromConfig]}}});var gF={};Br(gF,{TEST_EPSILON_FLOAT16:()=>Pq,encodeStrings:()=>$q,expectArrayBuffersEqual:()=>d_e,expectArraysClose:()=>u_e,expectArraysEqual:()=>l_e,expectNumbersClose:()=>p_e,expectPromiseToFail:()=>c_e,expectValuesInRange:()=>h_e,testEpsilon:()=>fF});function u_e(n,t,e){return e==null&&(e=fF()),dF(n,t,(r,o)=>mF(r,o,e))}function fF(){return De.backend.floatPrecision()===32?a_e:Pq}function dF(n,t,e){let r=!0;if((_i(n)||_i(t))&&(r=!1),_i(n)&&_i(t)&&(r=!0),r){let i=n.constructor.name,a=t.constructor.name;if(i!==a)throw new Error(`Arrays are of different type. Actual: ${i}. Expected: ${a}`)}if(Array.isArray(n)&&Array.isArray(t)){let i=va(n),a=va(t);if(!fu(i,a))throw new Error(`Arrays have different shapes. Actual: [${i}]. Expected: [${a}]`)}let o=_i(n)?n:Np(n),s=_i(t)?t:Np(t);if(o.length!==s.length)throw new Error(`Arrays have different lengths actual: ${o.length} vs expected: ${s.length}.
Actual:   ${o}.
Expected: ${s}.`);for(let i=0;i<s.length;++i){let a=o[i],u=s[i];if(!e(a,u))throw new Error(`Arrays differ: actual[${i}] = ${a}, expected[${i}] = ${u}.
Actual:   ${o}.
Expected: ${s}.`)}}function c_e(n,t){n().then(()=>t.fail(),()=>t())}function l_e(n,t){let e=typeof t=="string"||typeof t=="number"||typeof t=="boolean"?[t]:t;return kp(n)||kp(n[0])||kp(t)||kp(t[0])?dF(n,e,(r,o)=>r==o):dF(n,t,(r,o)=>mF(r,o,0))}function p_e(n,t,e){if(e==null&&(e=fF()),!mF(n,t,e))throw new Error(`Numbers differ: actual === ${n}, expected === ${t}`)}function mF(n,t,e){return!isFinite(n)&&!isFinite(t)?!0:!(isNaN(n)||isNaN(t)||Math.abs(n-t)>e)}function h_e(n,t,e){for(let r=0;r<n.length;r++)if(n[r]<t||n[r]>e)throw new Error(`Value out of range:${n[r]} low: ${t}, high: ${e}`)}function d_e(n,t){expect(new Float32Array(n)).toEqual(new Float32Array(t))}function $q(n){for(let t=0;t<n.length;t++){let e=n[t];Array.isArray(e)?$q(e):n[t]=y0(e)}return n}var a_e,Pq,Lq=D(()=>{"use strict";yt();ht();Rt();a_e=.001,Pq=.1});var fN,Bq=D(()=>{"use strict";fN="2.8.6"});function f_e(){mt().set("PROD",!0)}function m_e(){mt().set("DEBUG",!0)}function g_e(){mt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Ns(n){mt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function y_e(){De.disposeVariables()}function Vm(){return De}function Yv(){return De.memory()}function x_e(n){return De.profile(n)}function st(n,t){return De.tidy(n,t)}function Vn(n){LC(n).forEach(e=>e.dispose())}function Ko(n){return De.keep(n)}function b_e(n){return De.time(n)}function zq(n){return De.setBackend(n)}function v_e(){return De.ready()}function w_e(){return De.backendName}function S_e(n){De.removeBackend(n)}function C_e(n){return De.findBackend(n)}function I_e(n){return De.findBackendFactory(n)}function UC(n,t,e=1){return De.registerBackend(n,t,e)}function yF(){return De.backend}function __e(n,t){mt().setPlatform(n,t)}var gu=D(()=>{"use strict";yt();Ua();Ct();us();kU(Ns)});function T_e(n,t){let e=le(n,"a","add"),r=le(t,"b","add");[e,r]=Cr(e,r);let o={a:e,b:r};return De.runKernel(Nl,o)}var Pt,ns=D(()=>{"use strict";yt();Ze();us();ht();at();Pt=Se({add_:T_e})});function E_e(n,t){let e=le(n,"a","floorDiv"),r=le(t,"b","floorDiv");[e,r]=Cr(e,r);let o={a:e,b:r};return De.runKernel(Xh,o)}var S0,mN=D(()=>{"use strict";yt();Ze();us();ht();at();S0=Se({floorDiv_:E_e})});function N_e(n,t){let e=le(n,"a","div"),r=le(t,"b","div");if([e,r]=Cr(e,r),e.dtype==="int32"&&r.dtype==="int32")return S0(e,r);let o={a:e,b:r},s={};return De.runKernel(Uh,o,s)}var hn,bo=D(()=>{"use strict";yt();Ze();us();ht();mN();at();hn=Se({div_:N_e})});function k_e(n,t){let e=le(n,"a","mul"),r=le(t,"b","mul");[e,r]=Cr(e,r);let o={a:e,b:r};return De.runKernel(sd,o)}var Qe,jn=D(()=>{"use strict";yt();Ze();us();ht();at();Qe=Se({mul_:k_e})});function D_e(n){let t=le(n,"x","abs");if(t.dtype==="complex64"){let e={x:t};return De.runKernel(Qf,e)}else{let e={x:t};return De.runKernel(Uf,e)}}var $o,Z1=D(()=>{"use strict";yt();Ze();ht();at();$o=Se({abs_:D_e})});function A_e(n){let e={x:le(n,"x","acos")};return De.runKernel(Oh,e)}var Qv,Vq=D(()=>{"use strict";yt();Ze();ht();at();Qv=Se({acos_:A_e})});function O_e(n){let e={x:le(n,"x","acosh")};return De.runKernel(Rh,e)}var Zv,jq=D(()=>{"use strict";yt();Ze();ht();at();Zv=Se({acosh_:O_e})});function R_e(n){ke(Array.isArray(n),()=>"The argument passed to tf.addN() must be a list of tensors"),ke(n.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${n.length}`);let t=n.map((o,s)=>le(o,`tensors${s}`,"addN")),e=t[0];t.forEach(o=>{if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(o=>{if(!fu(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});let r=t;return De.runKernel(qf,r)}var gN,Uq=D(()=>{"use strict";yt();Ze();ht();Rt();at();gN=Se({addN_:R_e})});function M_e(n,t=null,e=!1){let o={x:le(n,"x","all","bool")},s={axis:t,keepDims:e};return De.runKernel(n1,o,s)}var C0,xF=D(()=>{"use strict";yt();Ze();ht();at();C0=Se({all_:M_e})});function F_e(n,t=null,e=!1){let o={x:le(n,"x","any","bool")},s={axis:t,keepDims:e};return De.runKernel(r1,o,s)}var jm,bF=D(()=>{"use strict";yt();Ze();ht();at();jm=Se({any_:F_e})});function P_e(n,t=0){let r={x:le(n,"x","argMax")},o={axis:t};return De.runKernel(Gf,r,o)}var Um,vF=D(()=>{"use strict";yt();Ze();ht();at();Um=Se({argMax_:P_e})});function $_e(n,t=0){let r={x:le(n,"x","argMin")},o={axis:t};return De.runKernel(Wf,r,o)}var Jv,wF=D(()=>{"use strict";yt();Ze();ht();at();Jv=Se({argMin_:$_e})});function L_e(n){let e={x:le(n,"x","asin")};return De.runKernel(Mh,e)}var ew,qq=D(()=>{"use strict";yt();Ze();ht();at();ew=Se({asin_:L_e})});function B_e(n){let e={x:le(n,"x","asinh")};return De.runKernel(Fh,e)}var tw,Gq=D(()=>{"use strict";yt();Ze();ht();at();tw=Se({asinh_:B_e})});function z_e(n){let e={x:le(n,"x","atan")};return De.runKernel(Ph,e)}var nw,Wq=D(()=>{"use strict";yt();Ze();ht();at();nw=Se({atan_:z_e})});function V_e(n,t){let e=le(n,"a","atan2"),r=le(t,"b","atan2");[e,r]=Cr(e,r);let o={a:e,b:r};return De.runKernel(Lh,o)}var rw,SF=D(()=>{"use strict";yt();Ze();us();ht();at();rw=Se({atan2_:V_e})});function j_e(n){let e={x:le(n,"x","atanh")};return De.runKernel($h,e)}var ow,Hq=D(()=>{"use strict";yt();Ze();ht();at();ow=Se({atanh_:j_e})});function U_e(n,t,e,r,o="NHWC",s){let i=n[3],a=[...t,i],u=Xq(o);return ex(n,a,e,s,r,null,null,u)}function IF(n,t,e,r,o,s,i="channelsLast"){let[a,u]=yN(t),c;if(i==="channelsLast")c=[a,u,n[3],n[3]];else if(i==="channelsFirst")c=[a,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return ex(n,c,e,r,o,s,!1,i)}function q_e(n,t,e,r,o,s,i="NDHWC"){let[a,u,c]=CF(t),h,f;if(i==="NDHWC")f="channelsLast",h=[a,u,c,n[4],n[4]];else if(i==="NCDHW")f="channelsFirst",h=[a,u,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return Kq(n,h,e,r,o,!1,f,s)}function ex(n,t,e,r,o,s,i=!1,a="channelsLast"){let[u,c,h,f]=[-1,-1,-1,-1];if(a==="channelsLast")[u,c,h,f]=n;else if(a==="channelsFirst")[u,f,c,h]=n;else throw new Error(`Unknown dataFormat ${a}`);let[g,d,,p]=t,[m,y]=yN(e),[v,N]=yN(r),T=sw(g,v),O=sw(d,N),{padInfo:S,outHeight:F,outWidth:R}=H_e(o,c,h,m,y,T,O,s,a),L=i?p*f:p,q;return a==="channelsFirst"?q=[u,L,F,R]:a==="channelsLast"&&(q=[u,F,R,L]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:h,inChannels:f,outHeight:F,outWidth:R,outChannels:L,padInfo:S,strideHeight:m,strideWidth:y,filterHeight:g,filterWidth:d,effectiveFilterHeight:T,effectiveFilterWidth:O,dilationHeight:v,dilationWidth:N,inShape:n,outShape:q,filterShape:t}}function Kq(n,t,e,r,o,s=!1,i="channelsLast",a){let[u,c,h,f,g]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[u,c,h,f,g]=n;else if(i==="channelsFirst")[u,g,c,h,f]=n;else throw new Error(`Unknown dataFormat ${i}`);let[d,p,m,,y]=t,[v,N,T]=CF(e),[O,S,F]=CF(r),R=sw(d,O),L=sw(p,S),q=sw(m,F),{padInfo:U,outDepth:Z,outHeight:ee,outWidth:Q}=K_e(o,c,h,f,v,N,T,R,L,q,a),oe=s?y*g:y,se;return i==="channelsFirst"?se=[u,oe,Z,ee,Q]:i==="channelsLast"&&(se=[u,Z,ee,Q,oe]),{batchSize:u,dataFormat:i,inDepth:c,inHeight:h,inWidth:f,inChannels:g,outDepth:Z,outHeight:ee,outWidth:Q,outChannels:oe,padInfo:U,strideDepth:v,strideHeight:N,strideWidth:T,filterDepth:d,filterHeight:p,filterWidth:m,effectiveFilterDepth:R,effectiveFilterHeight:L,effectiveFilterWidth:q,dilationDepth:O,dilationHeight:S,dilationWidth:F,inShape:n,outShape:se,filterShape:t}}function G_e(n,t,e,r,o){r==null&&(r=_F(n,t,e));let s=n[0],i=n[1],a=J1((s-t+2*r)/e+1,o),u=J1((i-t+2*r)/e+1,o);return[a,u]}function W_e(n,t,e,r,o,s){o==null&&(o=_F(n,t,r));let i=n[0],a=n[1],u=n[2],c=J1((i-t+2*o)/r+1,s),h=J1((a-t+2*o)/r+1,s),f=J1((u-t+2*o)/r+1,s);return[c,h,f,e]}function _F(n,t,e,r=1){let o=sw(t,r);return Math.floor((n[0]*(e-1)-e+o)/2)}function yN(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function CF(n){return typeof n=="number"?[n,n,n]:n}function sw(n,t){return t<=1?n:n+(n-1)*(t-1)}function H_e(n,t,e,r,o,s,i,a,u){let c,h,f;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};let d=G_e([t,e],s,r,n,a);h=d[0],f=d[1]}else if(n==="same"){h=Math.ceil(t/r),f=Math.ceil(e/o);let g=Math.max(0,(h-1)*r+s-t),d=Math.max(0,(f-1)*o+i-e),p=Math.floor(g/2),m=g-p,y=Math.floor(d/2),v=d-y;c={top:p,bottom:m,left:y,right:v,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((t-s+1)/r),f=Math.ceil((e-i+1)/o);else if(typeof n=="object"){let g=u==="channelsLast"?n[1][0]:n[2][0],d=u==="channelsLast"?n[1][1]:n[2][1],p=u==="channelsLast"?n[2][0]:n[3][0],m=u==="channelsLast"?n[2][1]:n[3][1];c={top:g,bottom:d,left:p,right:m,type:g===0&&d===0&&p===0&&m===0?"VALID":"EXPLICIT"},h=J1((t-s+g+d)/r+1,a),f=J1((e-i+p+m)/o+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:h,outWidth:f}}function K_e(n,t,e,r,o,s,i,a,u,c,h){let f,g,d,p;if(typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};let y=W_e([t,e,r,1],a,1,o,n,h);g=y[0],d=y[1],p=y[2]}else if(n==="same"){g=Math.ceil(t/o),d=Math.ceil(e/s),p=Math.ceil(r/i);let m=(g-1)*o+a-t,y=(d-1)*s+u-e,v=(p-1)*i+c-r,N=Math.floor(m/2),T=m-N,O=Math.floor(y/2),S=y-O,F=Math.floor(v/2),R=v-F;f={top:O,bottom:S,left:F,right:R,front:N,back:T,type:"SAME"}}else if(n==="valid")f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},g=Math.ceil((t-a+1)/o),d=Math.ceil((e-u+1)/s),p=Math.ceil((r-c+1)/i);else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:g,outHeight:d,outWidth:p}}function J1(n,t){if(!t)return Math.trunc(n);switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${t}`)}}function Xc(n){let[t,e,r]=yN(n);return t===1&&e===1&&r===1}function cs(n,t){return Xc(n)||Xc(t)}function Xq(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}var qa=D(()=>{"use strict";});function X_e(n,t){let r={x:le(n,"x","reshape","string_or_numeric")},o={shape:t};return De.runKernel(Cm,r,o)}var nt,En=D(()=>{"use strict";yt();Ze();ht();at();nt=Se({reshape_:X_e})});function Y_e(n,t,e,r,o){let s=le(n,"x","avgPool","float32"),i=1;ke(cs(e,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);let a=s,u=!1;s.rank===3&&(u=!0,a=nt(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ke(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),o!=null&&ke(to(r),()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},h={filterSize:t,strides:e,pad:r,dimRoundingMode:o},f=De.runKernel(Hf,c,h);return f=Wt(f,s.dtype),u?nt(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Dd,xN=D(()=>{"use strict";yt();Ze();ht();Rt();Mr();qa();at();En();Dd=Se({avgPool_:Y_e})});function Q_e(n,t,e,r,o,s="NDHWC",i){i==null?i=[1,1,1]:Ns("dilations is deprecated, this field will be gone in v3.0.0.");let a=le(n,"x","avgPool3d","float32"),u=a,c=!1;a.rank===4&&(c=!0,u=nt(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),ke(u.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${u.rank}.`),ke(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),ke(cs(e,i),()=>`Error in avgPool3d: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),o!=null&&ke(to(r),()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let h={x:u},f={filterSize:t,strides:e,pad:r,dimRoundingMode:o,dataFormat:s,dilations:i},g=De.runKernel(Kf,h,f);return g=Wt(g,u.dtype),c?nt(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var iw,Yq=D(()=>{"use strict";yt();gu();Ze();ht();Rt();Mr();qa();at();En();iw=Se({avgPool3d_:Q_e})});function Z_e(n,t=0){ke(n.length>=1,()=>"Pass at least one tensor to concat");let e=$m(n,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),e.length===1)return hc(e[0]);let r=e,o={axis:t};return De.runKernel(Zf,r,o)}var $r,dc=D(()=>{"use strict";yt();Ze();ht();Rt();Kv();at();$r=Se({concat_:Z_e})});function J_e(n){let e={x:le(n,"x","sigmoid")};return De.runKernel(gd,e)}var Ga,qC=D(()=>{"use strict";yt();Ze();ht();at();Ga=Se({sigmoid_:J_e})});function eTe(n,t,e){let r=le(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let o={x:r},s={begin:t,size:e};return De.runKernel(Nm,o,s)}var Jn,Vu=D(()=>{"use strict";yt();Ze();ht();at();Jn=Se({slice_:eTe})});function tTe(n){let e={x:le(n,"x","tanh")};return De.runKernel(Sd,e)}var Rp,TF=D(()=>{"use strict";yt();Ze();ht();at();Rp=Se({tanh_:tTe})});function nTe(n,t,e,r,o,s){let i=le(n,"forgetBias","basicLSTMCell"),a=le(t,"lstmKernel","basicLSTMCell"),u=le(e,"lstmBias","basicLSTMCell"),c=le(r,"data","basicLSTMCell"),h=le(o,"c","basicLSTMCell"),f=le(s,"h","basicLSTMCell"),g=$r([c,f],1),d=Ir(g,a),p=Pt(d,u),m=p.shape[0],y=p.shape[1]/4,v=[m,y],N=Jn(p,[0,0],v),T=Jn(p,[0,y],v),O=Jn(p,[0,y*2],v),S=Jn(p,[0,y*3],v),F=Pt(Qe(Ga(N),Rp(T)),Qe(h,Ga(Pt(i,O)))),R=Qe(Rp(F),Ga(S));return[F,R]}var Qq,Zq=D(()=>{"use strict";ht();ns();dc();Nd();jn();at();qC();Vu();TF();Qq=Se({basicLSTMCell_:nTe})});function rTe(n,t,e){let r=le(n,"x","batchToSpaceND"),o=t.reduce((a,u)=>a*u);ke(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),ke(e.length===t.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${t.length}`),ke(r.shape[0]%o===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${o}`);let s={x:r},i={blockShape:t,crops:e};return De.runKernel(Yf,s,i)}var Ad,GC=D(()=>{"use strict";yt();Ze();ht();Rt();at();Ad=Se({batchToSpaceND_:rTe})});function Jq(n){let t;return n.rank===0||n.rank===1?t=nt(n,[1,1,1,n.size]):n.rank===2?t=nt(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?t=nt(n,[1,n.shape[0],n.shape[1],n.shape[2]]):t=n,t}var eG=D(()=>{"use strict";En()});function oTe(n,t,e,r,o,s){s==null&&(s=.001);let i=le(n,"x","batchNorm"),a=le(t,"mean","batchNorm"),u=le(e,"variance","batchNorm"),c;o!=null&&(c=le(o,"scale","batchNorm"));let h;r!=null&&(h=le(r,"offset","batchNorm")),ke(a.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ke(h==null||a.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ke(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let g={x:Jq(i),scale:c,offset:h,mean:a,variance:u},d={varianceEpsilon:s},p=De.runKernel(im,g,d);return nt(p,i.shape)}var Qc,aw=D(()=>{"use strict";yt();Ze();ht();Rt();eG();at();En();Qc=Se({batchNorm_:oTe})});function sTe(n,t,e,r,o,s){let i=le(n,"x","batchNorm"),a=le(t,"mean","batchNorm"),u=le(e,"variance","batchNorm"),c;o!=null&&(c=le(o,"scale","batchNorm"));let h;return r!=null&&(h=le(r,"offset","batchNorm")),ke(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),ke(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),ke(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&ke(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),h!=null&&ke(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),Qc(i,a,u,h,c,s)}var bN,tG=D(()=>{"use strict";ht();Rt();aw();at();bN=Se({batchNorm2d_:sTe})});function iTe(n,t,e,r,o,s){let i=le(n,"x","batchNorm"),a=le(t,"mean","batchNorm"),u=le(e,"variance","batchNorm"),c;o!=null&&(c=le(o,"scale","batchNorm"));let h;return r!=null&&(h=le(r,"offset","batchNorm")),ke(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),ke(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),ke(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&ke(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),h!=null&&ke(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),Qc(i,a,u,h,c,s)}var vN,nG=D(()=>{"use strict";ht();Rt();aw();at();vN=Se({batchNorm3d_:iTe})});function aTe(n,t,e,r,o,s){let i=le(n,"x","batchNorm"),a=le(t,"mean","batchNorm"),u=le(e,"variance","batchNorm"),c;o!=null&&(c=le(o,"scale","batchNorm"));let h;return r!=null&&(h=le(r,"offset","batchNorm")),ke(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),ke(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),ke(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&ke(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),h!=null&&ke(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),Qc(i,a,u,h,c,s)}var wN,rG=D(()=>{"use strict";ht();Rt();aw();at();wN=Se({batchNorm4d_:aTe})});function uTe(n,t,e){let r=le(n,"x","bincount"),o=le(t,"weights","bincount");ke(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),ke(e>=0,()=>`size must be non-negative, but got ${e}.`),ke(o.size===r.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${o.shape}.`);let s={x:r,weights:o},i={size:e};return De.runKernel(i1,s,i)}var SN,oG=D(()=>{"use strict";yt();Ze();ht();Rt();at();SN=Se({bincount_:uTe})});function cTe(n,t){let e=le(n,"broadcastTo","x"),r=e.shape;if(t.some(c=>!(c>0)||c%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${t}].`);if(t.length<e.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${e.rank}.`);if(t.length>e.rank){let c=e.shape.slice();for(;c.length<t.length;)c.unshift(1);e=nt(e,c)}let o=e.shape,s=Array.from(t);for(let c=t.length-1;c>=0;c--)if(o[c]===t[c])s[c]=1;else if(e.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(s.map((c,h)=>c>1?h:-1).filter(c=>c>=0).length===0)return hc(e);let a={x:e},u={reps:s};return De.runKernel(Ap,a,u)}var qm,CN=D(()=>{"use strict";yt();Ze();ht();Kv();at();En();qm=Se({broadcastTo_:cTe})});function lTe(n){let e={x:le(n,"x","ceil")};return De.runKernel(Bh,e)}var uw,sG=D(()=>{"use strict";yt();Ze();ht();at();uw=Se({ceil_:lTe})});function pTe(n,t,e){let r=le(n,"x","clipByValue");ke(t<=e,()=>`Error in clip: min (${t}) must be less than or equal to max (${e}).`);let o={x:r},s={clipValueMin:t,clipValueMax:e};return De.runKernel(zh,o,s)}var li,iG=D(()=>{"use strict";yt();Ze();ht();Rt();at();li=Se({clipByValue_:pTe})});function hTe(n){return $r(n,0)}var IN,aG=D(()=>{"use strict";dc();at();IN=Se({concat1d_:hTe})});function dTe(n,t){return $r(n,t)}var _N,uG=D(()=>{"use strict";dc();at();_N=Se({concat2d_:dTe})});function fTe(n,t){return $r(n,t)}var TN,cG=D(()=>{"use strict";dc();at();TN=Se({concat3d_:fTe})});function mTe(n,t){return $r(n,t)}var EN,lG=D(()=>{"use strict";dc();at();EN=Se({concat4d_:mTe})});function gTe(n,t,e,r,o="NHWC",s=[1,1],i){let a=le(n,"x","conv2d"),u=le(t,"filter","conv2d"),c=a,h=!1;a.rank===3&&(h=!0,c=nt(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ke(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),ke(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),i!=null&&ke(to(r),()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);let f=o==="NHWC"?c.shape[3]:c.shape[1];ke(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),ke(cs(e,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`);let g={x:c,filter:u},d={strides:e,pad:r,dataFormat:o,dilations:s,dimRoundingMode:i},p=De.runKernel(Jf,g,d);return h?nt(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Wa,tx=D(()=>{"use strict";yt();Ze();ht();Rt();qa();at();En();Wa=Se({conv2d_:gTe})});function yTe(n,t,e,r,o="NWC",s=1,i){let a=le(n,"x","conv1d"),u=le(t,"filter","conv1d"),c=a,h=!1;a.rank===2&&(h=!0,c=nt(a,[1,a.shape[0],a.shape[1]])),ke(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),ke(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),i!=null&&ke(to(r),()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`),ke(c.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`),ke(cs(e,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${s}'`),ke(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let f=nt(u,[1,u.shape[0],u.shape[1],u.shape[2]]),g=nt(c,[c.shape[0],1,c.shape[1],c.shape[2]]),y=Wa(g,f,[1,e],r,"NHWC",[1,s],i);return h?nt(y,[y.shape[2],y.shape[3]]):nt(y,[y.shape[0],y.shape[2],y.shape[3]])}var I0,EF=D(()=>{"use strict";ht();Rt();tx();qa();at();En();I0=Se({conv1d_:yTe})});function xTe(n,t,e,r,o,s="NHWC",i){ke(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let a=n,u=t,c=!1;t.rank===3&&(c=!0,u=nt(t,[1,t.shape[0],t.shape[1],t.shape[2]]),a=[1,n[0],n[1],n[2]]),ke(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),ke(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),ke(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);let h=s==="NHWC"?a[3]:a[1],f=s==="NHWC"?u.shape[3]:u.shape[1];ke(h===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${e.shape[2]}.`),ke(f===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${e.shape[3]}.`),i!=null&&ke(to(o),()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${i} but got pad ${o}.`);let g={dy:u,filter:e},d={strides:r,pad:o,dataFormat:s,dimRoundingMode:i,inputShape:a},p=De.runKernel(em,g,d);return c?nt(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var cw,NN=D(()=>{"use strict";yt();Ze();Rt();at();En();cw=Se({conv2DBackpropInput_:xTe})});function bTe(n,t,e,r,o,s){let i=le(n,"x","conv2dTranspose"),a=le(t,"filter","conv2dTranspose");return cw(e,i,a,r,o,"NHWC",s)}var _0,NF=D(()=>{"use strict";ht();NN();at();_0=Se({conv2dTranspose_:bTe})});function vTe(n,t,e,r,o="NDHWC",s=[1,1,1]){let i=le(n,"x","conv3d"),a=le(t,"filter","conv3d"),u=i,c=!1;i.rank===4&&(c=!0,u=nt(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),ke(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),ke(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),ke(u.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`),ke(cs(e,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`),ke(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`);let h={x:u,filter:a},f={strides:e,pad:r,dataFormat:o,dilations:s},g=De.runKernel(tm,h,f);return c?nt(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var lw,pG=D(()=>{"use strict";yt();Ze();ht();Rt();qa();at();En();lw=Se({conv3d_:vTe})});function wTe(n,t,e,r,o){ke(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let s=n,i=t,a=!1;t.rank===4&&(a=!0,i=nt(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),s=[1,n[0],n[1],n[2],n[3]]);let u=s[4],c=i.shape[4];ke(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),ke(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),ke(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),ke(u===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${e.shape[3]}.`),ke(c===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${e.shape[4]}.`);let h={dy:i,filter:e},f={pad:o,strides:r,inputShape:s},g=De.runKernel(l1,h,f);return a?nt(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var kN,kF=D(()=>{"use strict";yt();Ze();Rt();at();En();kN=Se({conv3DBackpropInput_:wTe})});function STe(n,t,e,r,o){let s=le(n,"x","conv3dTranspose"),i=le(t,"filter","conv3dTranspose");return kN(e,s,i,r,o)}var hG,dG=D(()=>{"use strict";ht();kF();at();hG=Se({conv3dTranspose_:STe})});function CTe(n){let e={x:le(n,"x","cos")};return De.runKernel(Vh,e)}var Od,DN=D(()=>{"use strict";yt();Ze();ht();at();Od=Se({cos_:CTe})});function ITe(n){let e={x:le(n,"x","cosh")};return De.runKernel(jh,e)}var T0,DF=D(()=>{"use strict";yt();Ze();ht();at();T0=Se({cosh_:ITe})});function _Te(n,t=0,e=!1,r=!1){let s={x:le(n,"x","cumsum")},i={axis:t,exclusive:e,reverse:r};return De.runKernel(nm,s,i)}var E0,AN=D(()=>{"use strict";yt();Ze();ht();at();E0=Se({cumsum_:_Te})});function TTe(n,t,e,r=!1){let o=le(n,"x","denseBincount"),s=le(t,"weights","denseBincount");ke(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),ke(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),ke(e>=0,()=>`size must be non-negative, but got ${e}.`),ke(s.size===o.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${s.shape}.`);let i={x:o,weights:s},a={size:e,binaryOutput:r};return De.runKernel(h1,i,a)}var ON,fG=D(()=>{"use strict";yt();Ze();ht();Rt();at();ON=Se({denseBincount_:TTe})});function ETe(n,t,e="NHWC"){let r=le(n,"x","depthToSpace"),o=e==="NHWC"?r.shape[1]:r.shape[2],s=e==="NHWC"?r.shape[2]:r.shape[3],i=e==="NHWC"?r.shape[3]:r.shape[1];ke(o*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${t}  for depthToSpace with input shape
    ${r.shape}`),ke(s*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${t} for depthToSpace with input shape
        ${r.shape}`),ke(i%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${i} for depthToSpace with input shape ${r.shape}`);let a={x:r},u={blockSize:t,dataFormat:e};return De.runKernel(d1,a,u)}var pw,AF=D(()=>{"use strict";yt();Ze();ht();Rt();at();pw=Se({depthToSpace_:ETe})});function NTe(n,t,e,r,o="NHWC",s=[1,1],i){let a=le(n,"x","depthwiseConv2d"),u=le(t,"filter","depthwiseConv2d"),c=a,h=!1;a.rank===3&&(h=!0,c=nt(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ke(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),ke(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`),ke(c.shape[3]===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),i!=null&&ke(to(r),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);let f={x:c,filter:u},g={strides:e,pad:r,dataFormat:o,dilations:s,dimRoundingMode:i},d=De.runKernel(rm,f,g);return h?nt(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var fc,hw=D(()=>{"use strict";yt();Ze();ht();Rt();at();En();fc=Se({depthwiseConv2d_:NTe})});function kTe(n){let e={x:le(n,"x","diag")};return De.runKernel(g1,e)}var mG,gG=D(()=>{"use strict";yt();Ze();ht();at();mG=Se({diag_:kTe})});function DTe(n,t,e,r,o=[1,1],s="NHWC"){let i=le(n,"x","dilation2d"),a=le(t,"filter","dilation2d");ke(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),ke(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),ke(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let u=i,c=!1;i.rank===3&&(u=nt(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0);let h={x:u,filter:a},f={strides:e,pad:r,dilations:o},g=De.runKernel(om,h,f);return c?nt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var dw,OF=D(()=>{"use strict";yt();Ze();ht();Rt();at();En();dw=Se({dilation2d_:DTe})});function ATe(n,t){let e=n.length,r=[];for(let o=0;o<e;o++){let s=e-1-o,i=n[s]||1;(t[t.length-1-o]||1)>1&&i===1&&r.unshift(s)}return r}function Lo(n,t){let e=[];for(let r=0;r<t.length;r++){let o=n[n.length-r-1],s=t.length-r-1,i=t[s];(o==null||o===1&&i>1)&&e.unshift(s)}return e}function hr(n,t){let e=[],r=Math.max(n.length,t.length);for(let o=0;o<r;o++){let s=n[n.length-o-1];s==null&&(s=1);let i=t[t.length-o-1];if(i==null&&(i=1),s===1)e.unshift(i);else if(i===1)e.unshift(s);else if(s!==i){let a=`Operands could not be broadcast together with shapes ${n} and ${t}.`;throw Error(a)}else e.unshift(s)}return e}var Xo=D(()=>{"use strict";});function OTe(n,t){let e=le(n,"a","equal"),r=le(t,"b","equal");[e,r]=Cr(e,r),hr(e.shape,r.shape);let o={a:e,b:r};return De.runKernel(i0,o)}var Ha,fw=D(()=>{"use strict";yt();Ze();us();ht();Xo();at();Ha=Se({equal_:OTe})});function RTe(n,t,e){let r=le(t,"a","where"),o=le(e,"b","where"),s=le(n,"condition","where","bool"),i=hr(r.shape,o.shape),a=qm(r,i),u=qm(o,i);s.rank===1&&ke(s.shape[0]===r.shape[0],()=>"The first dimension of `a` must match the size of `condition`."),s.rank!==1&&vr(s.shape,u.shape,"Error in where: ");let c={condition:s,t:a,e:u};return De.runKernel(Em,c)}var Yo,Dl=D(()=>{"use strict";yt();Ze();ht();Rt();CN();Xo();at();Yo=Se({where_:RTe})});function MTe(n){let e={x:le(n,"x","zerosLike")};return De.runKernel(Pm,e)}var Mn,rs=D(()=>{"use strict";yt();Ze();ht();at();Mn=Se({zerosLike_:MTe})});function FTe(n,t){let e=le(n,"a","div"),r=le(t,"b","div");[e,r]=Cr(e,r);let o=hn(e,r),s=Mn(o),i=Ha(r,s);return Yo(i,s,o)}var mw,RF=D(()=>{"use strict";us();ht();bo();fw();at();Dl();rs();mw=Se({divNoNan_:FTe})});function PTe(n,t){let e=le(n,"t1","dot"),r=le(t,"t2","dot");ke((e.rank===1||e.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${r.rank}.`);let o=e.rank===1?e.size:e.shape[1],s=r.rank===1?r.size:r.shape[0];if(ke(o===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${s}.`),e.rank===1&&r.rank===1){let i=nt(e,[1,-1]),a=nt(r,[-1,1]),u=Ir(i,a);return nt(u,[])}else if(e.rank===1&&r.rank===2){let i=nt(e,[1,-1]),a=nt(r,[r.shape[0],r.shape[1]]),u=Ir(i,a);return nt(u,[u.size])}else if(e.rank===2&&r.rank===1){let i=nt(r,[-1,1]),a=Ir(e,i);return nt(a,[a.size])}else{let i=nt(r,[r.shape[0],r.shape[1]]);return Ir(e,i)}}var RN,MF=D(()=>{"use strict";ht();Rt();Nd();at();En();RN=Se({dot_:PTe})});function $Te(n){let e={x:le(n,"x","elu")};return De.runKernel(qh,e)}var Al,MN=D(()=>{"use strict";yt();Ze();ht();at();Al=Se({elu_:$Te})});function LTe(n){let t=le(n,"x","erf");ke(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=Wt(t,"float32"));let e={x:t};return De.runKernel(Gh,e)}var gw,yG=D(()=>{"use strict";yt();Ze();ht();Rt();Mr();at();gw=Se({erf_:LTe})});function BTe(n){let e={x:le(n,"x","exp")};return De.runKernel(Wh,e)}var Us,Rd=D(()=>{"use strict";yt();Ze();ht();at();Us=Se({exp_:BTe})});function zTe(n,t=0){let e=le(n,"x","expandDims","string_or_numeric");ke(t<=e.rank,()=>"Axis must be <= rank of the tensor");let r={input:e},o={dim:t};return De.runKernel(sm,r,o)}var Pi,WC=D(()=>{"use strict";yt();Ze();ht();Rt();at();Pi=Se({expandDims_:zTe})});function VTe(n){let e={x:le(n,"x","expm1")};return De.runKernel(Hh,e)}var yw,xG=D(()=>{"use strict";yt();Ze();ht();at();yw=Se({expm1_:VTe})});function jTe(n,t){let e=le(n,"x","tile","string_or_numeric");ke(e.rank===t.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${t}.`);let r={x:e},o={reps:t};return De.runKernel(Ap,r,o)}var mc,HC=D(()=>{"use strict";yt();Ze();ht();Rt();at();mc=Se({tile_:jTe})});function UTe(n,t,e,r="float32"){t==null&&(t=n);let o=Rn([n,t],r),s=n<=t?n:t;for(let a=0;a<s;++a)o.set(1,a,a);let i=nt(o.toTensor(),[n,t]);if(e==null)return i;if(e.length===1)return mc(Pi(i,0),[e[0],1,1]);if(e.length===2)return mc(Pi(Pi(i,0),0),[e[0],e[1],1,1]);if(e.length===3)return mc(Pi(Pi(Pi(i,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}var nx,FF=D(()=>{"use strict";zm();WC();at();En();HC();nx=Se({eye_:UTe})});function Md(n,t,e){let r={shape:n,value:t,dtype:e};return De.runKernel(b1,{},r)}var FN=D(()=>{"use strict";yt();Ze();});function qTe(n){let e={x:le(n,"x","floor")};return De.runKernel(Kh,e)}var Ol,PN=D(()=>{"use strict";yt();Ze();ht();at();Ol=Se({floor_:qTe})});function GTe(n,t,e=0,r=0){let o=le(n,"x","gather"),s=le(t,"indices","gather","int32"),i={x:o,indices:s},a={axis:e,batchDims:r};return De.runKernel(am,i,a)}var Zc,KC=D(()=>{"use strict";yt();Ze();ht();at();Zc=Se({gather_:GTe})});function WTe(n,t){let e=le(n,"a","greater"),r=le(t,"b","greater");[e,r]=Cr(e,r),hr(e.shape,r.shape);let o={a:e,b:r};return De.runKernel(a0,o)}var ks,Fd=D(()=>{"use strict";yt();Ze();us();ht();Xo();at();ks=Se({greater_:WTe})});function HTe(n,t){let e=le(n,"a","greaterEqual"),r=le(t,"b","greaterEqual");[e,r]=Cr(e,r),hr(e.shape,r.shape);let o={a:e,b:r};return De.runKernel(Yh,o)}var Sa,k0=D(()=>{"use strict";yt();Ze();us();ht();Xo();at();Sa=Se({greaterEqual_:HTe})});function KTe(n){let e={input:le(n,"input","imag")};return De.runKernel(C1,e)}var D0,$N=D(()=>{"use strict";yt();Ze();ht();at();D0=Se({imag_:KTe})});function XTe(n){let e={x:le(n,"x","isFinite")};return De.runKernel(Qh,e)}var LN,bG=D(()=>{"use strict";yt();Ze();ht();at();LN=Se({isFinite_:XTe})});function YTe(n){let e={x:le(n,"x","isInf")};return De.runKernel(Zh,e)}var BN,vG=D(()=>{"use strict";yt();Ze();ht();at();BN=Se({isInf_:YTe})});function QTe(n){let e={x:le(n,"x","isNaN")};return De.runKernel(Jh,e)}var zN,wG=D(()=>{"use strict";yt();Ze();ht();at();zN=Se({isNaN_:QTe})});function ZTe(n,t=.2){let r={x:le(n,"x","leakyRelu")},o={alpha:t};return De.runKernel(cm,r,o)}var Pd,VN=D(()=>{"use strict";yt();Ze();ht();at();Pd=Se({leakyRelu_:ZTe})});function JTe(n,t){let e=le(n,"a","less"),r=le(t,"b","less");[e,r]=Cr(e,r),hr(e.shape,r.shape);let o={a:e,b:r};return De.runKernel(u0,o)}var $d,XC=D(()=>{"use strict";yt();Ze();us();ht();Xo();at();$d=Se({less_:JTe})});function eEe(n,t){let e=le(n,"a","lessEqual"),r=le(t,"b","lessEqual");[e,r]=Cr(e,r),hr(e.shape,r.shape);let o={a:e,b:r};return De.runKernel(c0,o)}var yu,A0=D(()=>{"use strict";yt();Ze();us();ht();Xo();at();yu=Se({lessEqual_:eEe})});function jN(n,t,e){if(e<=0)throw new Error("The number of values should be positive.");let r={start:n,stop:t,num:e};return De.runKernel(I1,{},r)}var SG=D(()=>{"use strict";yt();Ze();});function tEe(n,t=5,e=1,r=1,o=.5){let s=le(n,"x","localResponseNormalization");ke(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),ke(to(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let i=s,a=!1;s.rank===3&&(a=!0,i=nt(s,[1,s.shape[0],s.shape[1],s.shape[2]]));let u={x:i},c={depthRadius:t,bias:e,alpha:r,beta:o},h=De.runKernel(lm,u,c);return a?nt(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var xw,PF=D(()=>{"use strict";yt();Ze();ht();Rt();at();En();xw=Se({localResponseNormalization_:tEe})});function nEe(n){let e={x:le(n,"x","log")};return De.runKernel(ed,e)}var pi,bw=D(()=>{"use strict";yt();Ze();ht();at();pi=Se({log_:nEe})});function rEe(n){let e={x:le(n,"x","log1p")};return De.runKernel(td,e)}var O0,$F=D(()=>{"use strict";yt();Ze();ht();at();O0=Se({log1p_:rEe})});function CG(n){return ke(Dh(n),()=>"The f passed in grad(f) must be a function"),(t,e)=>{let r=le(t,"x","tf.grad","string_or_numeric"),o=e!=null?le(e,"dy","tf.grad"):null;return De.tidy(()=>{let{value:s,grads:i}=De.gradients(()=>n(r),[r],o);return o!=null&&vr(s.shape,o.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),UN(i),i[0]})}}function IG(n){return ke(Dh(n),()=>"The f passed in grads(f) must be a function"),(t,e)=>{ke(Array.isArray(t),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");let r=$m(t,"args","tf.grads","string_or_numeric"),o=e!=null?le(e,"dy","tf.grads"):null;return De.tidy(()=>{let{value:s,grads:i}=De.gradients(()=>n(...r),r,o);return o!=null&&vr(s.shape,o.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),UN(i),i})}}function _G(n){return ke(Dh(n),()=>"The f passed in valueAndGrad(f) must be a function"),(t,e)=>{ke(t instanceof Me,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),ke(e==null||e instanceof Me,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");let{grads:r,value:o}=De.gradients(()=>n(t),[t],e);return UN(r),{grad:r[0],value:o}}}function TG(n){return ke(Dh(n),()=>"The f passed in valueAndGrads(f) must be a function"),(t,e)=>{ke(Array.isArray(t)&&t.every(o=>o instanceof Me),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),ke(e==null||e instanceof Me,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");let r=De.gradients(()=>n(...t),t,e);return e!=null&&vr(r.value.shape,e.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),UN(r.grads),r}}function YC(n,t){ke(Dh(n),()=>"The f passed in variableGrads(f) must be a function"),ke(t==null||Array.isArray(t)&&t.every(c=>c instanceof _d),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let e=t!=null;if(!e){t=[];for(let c in De.registeredVariables)t.push(De.registeredVariables[c])}let r=e?t.filter(c=>!c.trainable):null,o=t.length;t=t.filter(c=>c.trainable),ke(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let s=!0,{value:i,grads:a}=De.gradients(n,t,null,s);ke(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),ke(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);let u={};return t.forEach((c,h)=>{a[h]!=null&&(u[c.name]=a[h])}),r?.forEach(c=>u[c.name]=null),{value:i,grads:u}}function Ka(n){return De.customGrad(n)}function UN(n){if(n.filter(e=>e==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var Gm=D(()=>{"use strict";yt();Ct();ht();Rt();});function oEe(n){let e={x:le(n,"x","neg")};return De.runKernel(ym,e)}var Er,Ca=D(()=>{"use strict";yt();Ze();ht();at();Er=Se({neg_:oEe})});function sEe(n){let e={x:le(n,"x","softplus")};return De.runKernel(yd,e)}var Rl,LF=D(()=>{"use strict";yt();Ze();ht();at();Rl=Se({softplus_:sEe})});function iEe(n){let t=le(n,"x","logSigmoid");return Ka(r=>({value:Er(Rl(Er(r))),gradFunc:i=>Qe(i,Ga(Er(r)))}))(t)}var qN,EG=D(()=>{"use strict";Gm();ht();jn();Ca();at();qC();LF();qN=Se({logSigmoid_:iEe})});function aEe(n,t=null,e=!1){let o={x:le(n,"x","max")},s={reductionIndices:t,keepDims:e};return De.runKernel(pm,o,s)}var hi,vw=D(()=>{"use strict";yt();Ze();ht();at();hi=Se({max_:aEe})});function uEe(n,t){let e=le(n,"a","sub"),r=le(t,"b","sub");[e,r]=Cr(e,r);let o={a:e,b:r};return De.runKernel(vd,o)}var un,No=D(()=>{"use strict";yt();Ze();us();ht();at();un=Se({sub_:uEe})});function cEe(n,t=null,e=!1){let r=le(n,"x","sum");r.dtype==="bool"&&(r=Wt(r,"int32"));let o={x:r},s={axis:t,keepDims:e};return De.runKernel(km,o,s)}var vn,qs=D(()=>{"use strict";yt();Ze();ht();Mr();at();vn=Se({sum_:cEe})});function lEe(n,t=-1){let e=le(n,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${t}`);return Ka((o,s)=>{let a=hi(o,t,!0),u=un(o,a),c=un(Wt(u,"float32"),pi(vn(Us(u),t,!0)));return s([c]),{value:c,gradFunc:(f,g)=>{let[d]=g,p=!0,m=Us(d);return un(f,Qe(vn(f,t,p),m))}}})(e)}var R0,NG=D(()=>{"use strict";Gm();ht();Mr();Rd();bw();vw();jn();at();No();qs();R0=Se({logSoftmax_:lEe})});function BF(n,t){for(let e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function kG(n,t,e){let r=n.length+t.length,o=[],s=0,i=0;for(let a=0;a<r;a++)e.indexOf(a)===-1?o.push(n[s++]):o.push(t[i++]);return o}function zF(n,t){let e=[],r=n.length;for(let s=0;s<r;s++)t.indexOf(s)===-1&&e.push(n[s]);let o=t.map(s=>n[s]);return[e,o]}function Ml(n,t){let e=t.map(r=>1);return kG(n,e,t)}function pEe(n,t,e){ke(BF(t,e),()=>`${n} supports only inner-most axes for now. Got axes ${t} and rank-${e} input.`)}function VF(n,t){if(BF(n,t))return null;let e=[];for(let r=0;r<t;++r)n.indexOf(r)===-1&&e.push(r);return n.forEach(r=>e.push(r)),e}function QC(n){return n.map((t,e)=>[e,t]).sort((t,e)=>t[1]-e[1]).map(t=>t[0])}function hEe(n,t){let e=[];for(let r=t-n;r<t;++r)e.push(r);return e}var Mp=D(()=>{"use strict";Rt();});function dEe(n,t=null,e=!1){let r=le(n,"x","logSumExp"),o=ui(t,r.shape),s=hi(r,o,!0),i=un(r,s),a=Us(i),u=vn(a,o),c=pi(u),h=Pt(nt(s,c.shape),c);if(e){let f=Ml(h.shape,o);return nt(h,f)}return h}var ww,GN=D(()=>{"use strict";ht();Rt();ns();Mp();Rd();bw();vw();at();En();No();qs();ww=Se({logSumExp_:dEe})});function fEe(n,t){let e=le(n,"a","logicalAnd","bool"),r=le(t,"b","logicalAnd","bool");hr(e.shape,r.shape);let o={a:e,b:r};return De.runKernel(l0,o)}var Ti,rx=D(()=>{"use strict";yt();Ze();ht();Xo();at();Ti=Se({logicalAnd_:fEe})});function mEe(n){let e={x:le(n,"x","logicalNot","bool")};return De.runKernel(p0,e)}var Ld,ZC=D(()=>{"use strict";yt();Ze();ht();at();Ld=Se({logicalNot_:mEe})});function gEe(n,t){let e=le(n,"a","logicalOr","bool"),r=le(t,"b","logicalOr","bool");hr(e.shape,r.shape);let o={a:e,b:r};return De.runKernel(h0,o)}var M0,WN=D(()=>{"use strict";yt();Ze();ht();Xo();at();M0=Se({logicalOr_:gEe})});function yEe(n,t){let e=le(n,"a","logicalXor","bool"),r=le(t,"b","logicalXor","bool");return hr(e.shape,r.shape),Ti(M0(n,t),Ld(Ti(n,t)))}var HN,UF=D(()=>{"use strict";ht();Xo();rx();ZC();WN();at();HN=Se({logicalXor_:yEe})});function xEe(n,t,e,r,o){let s=le(n,"x","maxPool"),i=1,a=s,u=!1;s.rank===3&&(u=!0,a=nt(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ke(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),ke(cs(e,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),o!=null&&ke(to(r),()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},h={filterSize:t,strides:e,pad:r,dimRoundingMode:o},f=De.runKernel(hm,c,h);return u?nt(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Bd,KN=D(()=>{"use strict";yt();Ze();ht();Rt();qa();at();En();Bd=Se({maxPool_:xEe})});function bEe(n,t=[1,1,1],e,r,o,s="NDHWC",i){i==null?i=[1,1,1]:Ns("dilations is deprecated, this field will be gone in v3.0.0.");let a=le(n,"x","maxPool3d"),u=a,c=!1;a.rank===4&&(c=!0,u=nt(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),ke(u.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${u.rank}.`),ke(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),ke(cs(e,i),()=>`Error in maxPool3d: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),o!=null&&ke(to(r),()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let h={x:u},f={filterSize:t,strides:e,pad:r,dimRoundingMode:o,dataFormat:s,dilations:i},g=De.runKernel(dm,h,f);return c?nt(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var Sw,DG=D(()=>{"use strict";yt();gu();Ze();ht();Rt();qa();at();En();Sw=Se({maxPool3d_:bEe})});function vEe(n,t,e,r,o=!1){let i={x:le(n,"x","maxPoolWithArgmax")},a={filterSize:t,strides:e,pad:r,includeBatchInIndex:o},u=De.runKernel(N1,i,a);return{result:u[0],indexes:u[1]}}var XN,AG=D(()=>{"use strict";yt();Ze();ht();at();XN=Se({maxPoolWithArgmax_:vEe})});function wEe(n,t){let e=le(n,"a","maximum"),r=le(t,"b","maximum");[e,r]=Cr(e,r),e.dtype==="bool"&&(e=Wt(e,"int32"),r=Wt(r,"int32")),hr(e.shape,r.shape);let o={a:e,b:r};return De.runKernel(nd,o)}var ea,Cw=D(()=>{"use strict";yt();Ze();us();ht();Xo();Mr();at();ea=Se({maximum_:wEe})});function SEe(n,t=null,e=!1){let o={x:le(n,"x","mean")},s={axis:t,keepDims:e};return De.runKernel(fm,o,s)}var vo,JC=D(()=>{"use strict";yt();Ze();ht();at();vo=Se({mean_:SEe})});function CEe(n,t=null,e=!1){let o={x:le(n,"x","min")},s={axis:t,keepDims:e};return De.runKernel(mm,o,s)}var Fp,YN=D(()=>{"use strict";yt();Ze();ht();at();Fp=Se({min_:CEe})});function IEe(n,t){let e=le(n,"a","minimum"),r=le(t,"b","minimum");[e,r]=Cr(e,r),e.dtype==="bool"&&(e=Wt(e,"int32"),r=Wt(r,"int32")),hr(e.shape,r.shape);let o={a:e,b:r};return De.runKernel(rd,o)}var gc,eI=D(()=>{"use strict";yt();Ze();us();ht();Xo();Mr();at();gc=Se({minimum_:IEe})});function _Ee(n,t,e){ke(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);let r=le(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");ke(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);let o=e==="reflect"?1:0;for(let a=0;a<r.rank;a++)ke(t[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ke(t[a][0]>=0&&t[a][0]<=r.shape[a]-o&&t[a][1]>=0&&t[a][1]<=r.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-o} or less than 0 for input of shape ${r.shape}`);let s={paddings:t,mode:e},i={x:r};return De.runKernel(gm,i,s)}var Iw,qF=D(()=>{"use strict";yt();Ze();ht();Rt();at();Iw=Se({mirrorPad_:_Ee})});function TEe(n,t){let e=le(n,"a","mod"),r=le(t,"b","mod");[e,r]=Cr(e,r);let o={a:e,b:r};return De.runKernel(od,o)}var F0,QN=D(()=>{"use strict";yt();Ze();us();ht();at();F0=Se({mod_:TEe})});function EEe(n){let t=le(n,"x","square"),e={};return De.runKernel("Square",{x:t},e)}var sr,di=D(()=>{"use strict";yt();ht();at();sr=Se({square_:EEe})});function NEe(n,t=null,e=!1){n=le(n,"x","moments");let r=ui(t,n.shape),o=vo(n,r,e),s=o.shape;e||(s=Ml(o.shape,r));let i=sr(un(Wt(n,"float32"),nt(o,s))),a=vo(i,r,e);return{mean:o,variance:a}}var ox,OG=D(()=>{"use strict";ht();Rt();Mp();Mr();JC();at();En();di();No();ox=Se({moments_:NEe})});function kEe(n,t,e,r){let o=le(t,"data","multiRNNCell"),s=$m(e,"c","multiRNNCell"),i=$m(r,"h","multiRNNCell"),a=o,u=[];for(let f=0;f<n.length;f++){let g=n[f](a,s[f],i[f]);u.push(g[0]),u.push(g[1]),a=g[1]}let c=[],h=[];for(let f=0;f<u.length;f+=2)c.push(u[f]),h.push(u[f+1]);return[c,h]}var RG,MG=D(()=>{"use strict";ht();at();RG=Se({multiRNNCell_:kEe})});function DEe(n,t,e,r=!1){let o=le(n,"logits","multinomial"),s=o.size,i=o.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);e=e||Math.random();let u={logits:i===1?nt(o,[1,-1]):o},c={numSamples:t,seed:e,normalized:r},h=De.runKernel(k1,u,c);return i===1?nt(h,[h.size]):h}var ZN,FG=D(()=>{"use strict";yt();Ze();ht();at();En();ZN=Se({multinomial_:DEe})});function AEe(n,t){let e=le(n,"a","notEqual"),r=le(t,"b","notEqual");[e,r]=Cr(e,r),hr(e.shape,r.shape);let o={a:e,b:r};return De.runKernel(d0,o)}var ju,tI=D(()=>{"use strict";yt();Ze();us();ht();Xo();at();ju=Se({notEqual_:AEe})});function so(n,t="float32"){if(t==="complex64"){let r=so(n,"float32"),o=so(n,"float32");return Bu(r,o)}let e=Rv(xo(n),t);return De.makeTensor(e,n,t)}var sx=D(()=>{"use strict";yt();Rt();G1();});function ta(n,t="float32"){if(t==="complex64"){let r=ta(n,"float32"),o=so(n,"float32");return Bu(r,o)}let e=NC(xo(n),t);return De.makeTensor(e,n,t)}var _w=D(()=>{"use strict";yt();Rt();G1();sx();});function OEe(n){let e={x:le(n,"x","onesLike")};return De.runKernel(xm,e)}var ei,PG=D(()=>{"use strict";yt();Ze();ht();at();ei=Se({onesLike_:OEe})});function REe(n,t){let e=le(n,"v1","outerProduct"),r=le(t,"v2","outerProduct");ke(e.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${e.rank} and ${r.rank}.`);let o=nt(e,[-1,1]),s=nt(r,[1,-1]);return Ir(o,s)}var $G,LG=D(()=>{"use strict";ht();Rt();Nd();at();En();$G=Se({outerProduct_:REe})});function MEe(n,t,e=0){let r=le(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:t,constantValue:e},s={x:r};return De.runKernel(wm,s,o)}var Ia,P0=D(()=>{"use strict";yt();Ze();ht();at();Ia=Se({pad_:MEe})});function FEe(n,t,e=0){return ke(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),Ia(n,[t],e)}var BG,zG=D(()=>{"use strict";Rt();at();P0();BG=Se({pad1d_:FEe})});function PEe(n,t,e=0){return ke(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ia(n,t,e)}var VG,jG=D(()=>{"use strict";Rt();at();P0();VG=Se({pad2d_:PEe})});function $Ee(n,t,e=0){return ke(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ia(n,t,e)}var UG,qG=D(()=>{"use strict";Rt();at();P0();UG=Se({pad3d_:$Ee})});function LEe(n,t,e=0){return ke(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ia(n,t,e)}var GG,WG=D(()=>{"use strict";Rt();at();P0();GG=Se({pad4d_:LEe})});function BEe(n,t,e){let r=le(n,"x","spaceToBatchND");ke(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),ke(e.length===t.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${t.length}`),ke(r.shape.reduce((i,a,u)=>u>0&&u<=t.length?i&&(a+e[u-1][0]+e[u-1][1])%t[u-1]===0:i,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${t.toString()}`);let o={x:r},s={blockShape:t,paddings:e};return De.runKernel(Dm,o,s)}var zd,nI=D(()=>{"use strict";yt();Ze();ht();Rt();at();zd=Se({spaceToBatchND_:BEe})});function zEe(n,t,e,r,o,s){o==null&&(o=[1,1]),s==null&&(s=1),r===0&&(r="valid");let i=le(n,"x","maxPool"),a=i,u=!1;i.rank===3&&(u=!0,a=nt(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ke(cs(s,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${o}'`);let c=IF(a.shape,t,s,o,r),h=[c.dilationHeight,c.dilationWidth],f;r==="same"?f=jEe([c.filterHeight,c.filterWidth],h):f=[[0,0],[0,0]];let g=h[0]===1&&h[1]===1,[d,p]=VEe([c.inHeight,c.inWidth],h,f),m=g?r:"valid",y=g?a:zd(a,h,d),N=(e==="avg"?()=>Dd(y,t,s,m):()=>Bd(y,t,s,m))(),T=g?N:Ad(N,h,p);return u?nt(T,[T.shape[1],T.shape[2],T.shape[3]]):T}function VEe(n,t,e){let r=e.map(h=>h[0]),o=e.map(h=>h[1]),s=n.concat(r,o),i=t.map((h,f)=>(h-s[f]%h)%h),a=o.map((h,f)=>h+i[f]),u=t.map((h,f)=>[r[f],a[f]]),c=t.map((h,f)=>[0,i[f]]);return[u,c]}function jEe(n,t){let r=n.map((i,a)=>i+(i-1)*(t[a]-1)).map(i=>i-1),o=r.map(i=>Math.floor(i/2)),s=r.map((i,a)=>i-o[a]);return r.map((i,a)=>[o[a],s[a]])}var JN,GF=D(()=>{"use strict";ht();Rt();xN();GC();qa();KN();at();En();nI();JN=Se({pool_:zEe})});function UEe(n,t){let e=le(n,"base","pow"),r=le(t,"exp","pow");[e,r]=Cr(e,r);let o={a:e,b:r};return De.runKernel(id,o)}var $i,Wm=D(()=>{"use strict";yt();Ze();us();ht();at();$i=Se({pow_:UEe})});function qEe(n,t){let e=le(n,"x","prelu"),r=le(t,"alpha","prelu"),o={x:e,alpha:r};return De.runKernel(Sm,o)}var Vd,ek=D(()=>{"use strict";yt();Ze();ht();at();Vd=Se({prelu_:qEe})});function GEe(n,t=null,e=!1){let r=le(n,"x","prod");r.dtype==="bool"&&(r=Wt(r,"int32"));let o={x:r},s={axis:t,keepDims:e};return De.runKernel(R1,o,s)}var $0,WF=D(()=>{"use strict";yt();Ze();ht();Mr();at();$0=Se({prod_:GEe})});function WEe(n,t,e){let r=xo(n),o=null;if(e==null||e==="float32")o=new Float32Array(r);else if(e==="int32")o=new Int32Array(r);else if(e==="bool")o=new Uint8Array(r);else throw new Error(`Unknown data type ${e}`);for(let s=0;s<r;s++)o[s]=t();return De.makeTensor(o,n,e)}var HG,KG=D(()=>{"use strict";yt();Rt();at();HG=Se({rand_:WEe})});var YG=uo((XG,HF)=>{"use strict";(function(n,t,e){function r(a){var u=this,c=i();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(a),u.s0<0&&(u.s0+=1),u.s1-=c(a),u.s1<0&&(u.s1+=1),u.s2-=c(a),u.s2<0&&(u.s2+=1),c=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function s(a,u){var c=new r(a),h=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&o(h,c),f.state=function(){return o(c,{})}),f}function i(){var a=4022871197,u=function(c){c=c.toString();for(var h=0;h<c.length;h++){a+=c.charCodeAt(h);var f=.02519603282416938*a;a=f>>>0,f-=a,f*=a,a=f>>>0,f-=a,a+=f*4294967296}return(a>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.alea=s})(XG,typeof HF=="object"&&HF,typeof define=="function"&&define)});var ZG=uo((QG,KF)=>{"use strict";(function(n,t,e){function r(i){var a=this,u="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var h=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^h^h>>>8},i===(i|0)?a.x=i:u+=i;for(var c=0;c<u.length+64;c++)a.x^=u.charCodeAt(c)|0,a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a}function s(i,a){var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xor128=s})(QG,typeof KF=="object"&&KF,typeof define=="function"&&define)});var eW=uo((JG,XF)=>{"use strict";(function(n,t,e){function r(i){var a=this,u="";a.next=function(){var h=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(h^h<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,i===(i|0)?a.x=i:u+=i;for(var c=0;c<u.length+64;c++)a.x^=u.charCodeAt(c)|0,c==u.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a.v=i.v,a.d=i.d,a}function s(i,a){var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xorwow=s})(JG,typeof XF=="object"&&XF,typeof define=="function"&&define)});var nW=uo((tW,YF)=>{"use strict";(function(n,t,e){function r(i){var a=this;a.next=function(){var c=a.x,h=a.i,f,g,d;return f=c[h],f^=f>>>7,g=f^f<<24,f=c[h+1&7],g^=f^f>>>10,f=c[h+3&7],g^=f^f>>>3,f=c[h+4&7],g^=f^f<<7,f=c[h+7&7],f=f^f<<13,g^=f^f<<9,c[h]=g,a.i=h+1&7,g};function u(c,h){var f,g,d=[];if(h===(h|0))g=d[0]=h;else for(h=""+h,f=0;f<h.length;++f)d[f&7]=d[f&7]<<15^h.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?g=d[7]=-1:g=d[f],c.x=d,c.i=0,f=256;f>0;--f)c.next()}u(a,i)}function o(i,a){return a.x=i.x.slice(),a.i=i.i,a}function s(i,a){i==null&&(i=+new Date);var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(c.x&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xorshift7=s})(tW,typeof YF=="object"&&YF,typeof define=="function"&&define)});var oW=uo((rW,QF)=>{"use strict";(function(n,t,e){function r(i){var a=this;a.next=function(){var c=a.w,h=a.X,f=a.i,g,d;return a.w=c=c+1640531527|0,d=h[f+34&127],g=h[f=f+1&127],d^=d<<13,g^=g<<17,d^=d>>>15,g^=g>>>12,d=h[f]=d^g,a.i=f,d+(c^c>>>16)|0};function u(c,h){var f,g,d,p,m,y=[],v=128;for(h===(h|0)?(g=h,h=null):(h=h+"\0",g=0,v=Math.max(v,h.length)),d=0,p=-32;p<v;++p)h&&(g^=h.charCodeAt((p+32)%h.length)),p===0&&(m=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,p>=0&&(m=m+1640531527|0,f=y[p&127]^=g+m,d=f==0?d+1:0);for(d>=128&&(y[(h&&h.length||0)&127]=-1),d=127,p=4*128;p>0;--p)g=y[d+34&127],f=y[d=d+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,y[d]=g^f;c.w=m,c.X=y,c.i=d}u(a,i)}function o(i,a){return a.i=i.i,a.w=i.w,a.X=i.X.slice(),a}function s(i,a){i==null&&(i=+new Date);var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(c.X&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xor4096=s})(rW,typeof QF=="object"&&QF,typeof define=="function"&&define)});var iW=uo((sW,ZF)=>{"use strict";(function(n,t,e){function r(i){var a=this,u="";a.next=function(){var h=a.b,f=a.c,g=a.d,d=a.a;return h=h<<25^h>>>7^f,f=f-g|0,g=g<<24^g>>>8^d,d=d-h|0,a.b=h=h<<20^h>>>12^f,a.c=f=f-g|0,a.d=g<<16^f>>>16^d,a.a=d-h|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,i===Math.floor(i)?(a.a=i/4294967296|0,a.b=i|0):u+=i;for(var c=0;c<u.length+20;c++)a.b^=u.charCodeAt(c)|0,a.next()}function o(i,a){return a.a=i.a,a.b=i.b,a.c=i.c,a.d=i.d,a}function s(i,a){var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.tychei=s})(sW,typeof ZF=="object"&&ZF,typeof define=="function"&&define)});var tk=uo(()=>{"use strict"});var aW=uo((Cut,nk)=>{"use strict";(function(n,t){var e=this,r=256,o=6,s=52,i="random",a=t.pow(r,o),u=t.pow(2,s),c=u*2,h=r-1,f;function g(T,O,S){var F=[];O=O==!0?{entropy:!0}:O||{};var R=y(m(O.entropy?[T,N(n)]:T??v(),3),F),L=new d(F),q=function(){for(var U=L.g(o),Z=a,ee=0;U<u;)U=(U+ee)*r,Z*=r,ee=L.g(1);for(;U>=c;)U/=2,Z/=2,ee>>>=1;return(U+ee)/Z};return q.int32=function(){return L.g(4)|0},q.quick=function(){return L.g(4)/4294967296},q.double=q,y(N(L.S),n),(O.pass||S||function(U,Z,ee,Q){return Q&&(Q.S&&p(Q,L),U.state=function(){return p(L,{})}),ee?(t[i]=U,Z):U})(q,R,"global"in O?O.global:this==t,O.state)}t["seed"+i]=g;function d(T){var O,S=T.length,F=this,R=0,L=F.i=F.j=0,q=F.S=[];for(S||(T=[S++]);R<r;)q[R]=R++;for(R=0;R<r;R++)q[R]=q[L=h&L+T[R%S]+(O=q[R])],q[L]=O;(F.g=function(U){for(var Z,ee=0,Q=F.i,oe=F.j,se=F.S;U--;)Z=se[Q=h&Q+1],ee=ee*r+se[h&(se[Q]=se[oe=h&oe+Z])+(se[oe]=Z)];return F.i=Q,F.j=oe,ee})(r)}function p(T,O){return O.i=T.i,O.j=T.j,O.S=T.S.slice(),O}function m(T,O){var S=[],F=typeof T,R;if(O&&F=="object")for(R in T)try{S.push(m(T[R],O-1))}catch{}return S.length?S:F=="string"?T:T+"\0"}function y(T,O){for(var S=T+"",F,R=0;R<S.length;)O[h&R]=h&(F^=O[h&R]*19)+S.charCodeAt(R++);return N(O)}function v(){try{var T;return f&&(T=f.randomBytes)?T=T(r):(T=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(T)),N(T)}catch{var O=e.navigator,S=O&&O.plugins;return[+new Date,e,S,e.screen,N(n)]}}function N(T){return String.fromCharCode.apply(0,T)}if(y(t.random(),n),typeof nk=="object"&&nk.exports){nk.exports=g;try{f=tk()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return g})})([],Math)});var cW=uo((Iut,uW)=>{"use strict";var HEe=YG(),KEe=ZG(),XEe=eW(),YEe=nW(),QEe=oW(),ZEe=iW(),ix=aW();ix.alea=HEe;ix.xor128=KEe;ix.xorwow=XEe;ix.xorshift7=YEe;ix.xor4096=QEe;ix.tychei=ZEe;uW.exports=ix});var sk,ax,rk,ok,rI=D(()=>{"use strict";sk=kS(cW());ax=class{constructor(t,e,r,o,s){this.mean=t,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let i=s||Math.random();this.random=sk.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let t,e,r=!1;for(;!r;){let o,s,i;do o=2*this.random()-1,s=2*this.random()-1,i=o*o+s*s;while(i>=1||i===0);let a=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*o*a,e=this.mean+this.stdDev*s*a,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}},rk=class{constructor(t,e,r,o){this.alpha=t,this.beta=1/e,this.dtype=r;let s=o||Math.random();this.randu=sk.alea(s.toString()),this.randn=new ax(0,1,r,!1,this.randu()),t<1?this.d=t+2/3:this.d=t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,r,o,s,i;for(;;){do o=this.randn.nextValue(),i=1+this.c*o;while(i<=0);if(i*=i*i,t=o*o,e=1-.331*t*t,r=.5*t+this.d*(1-i+Math.log(i)),s=this.randu(),s<e||Math.log(s)<r)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}convertValue(t){return this.dtype==="float32"?t:Math.round(t)}},ok=class{constructor(t=0,e=1,r,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=e-t,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=sk.alea(o)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}});function JEe(n,t,e=1,r="float32",o){if(e==null&&(e=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);let s=new rk(t,e,r,o),i=Rn(n,r);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var lW,pW=D(()=>{"use strict";zm();at();rI();lW=Se({randomGamma_:JEe})});function eNe(n,t=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);let s=new ax(t,e,r,!1,o),i=Rn(n,r);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var oI,hW=D(()=>{"use strict";zm();at();rI();oI=Se({randomNormal_:eNe})});function tNe(n,t=0,e=1,r="float32",o){let s=Rn(n,r),i=new ok(t,e,null,o);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var Fl,JF=D(()=>{"use strict";zm();at();rI();Fl=Se({randomUniform_:tNe})});function ux(n,t,e=1,r="float32"){if(e===0)throw new Error("Cannot have a step of zero");let o={start:n,stop:t,step:e,dtype:r};return De.runKernel(M1,{},o)}var eP=D(()=>{"use strict";yt();Ze();});function nNe(n){let e={input:le(n,"input","real")};return De.runKernel(F1,e)}var Hm,ik=D(()=>{"use strict";yt();Ze();ht();at();Hm=Se({real_:nNe})});function rNe(n){let e={x:le(n,"x","reciprocal")};return De.runKernel(ad,e)}var Tw,dW=D(()=>{"use strict";yt();Ze();ht();at();Tw=Se({reciprocal_:rNe})});function oNe(n){let e={x:le(n,"x","relu")};return De.runKernel(ud,e)}var na,Ew=D(()=>{"use strict";yt();Ze();ht();at();na=Se({relu_:oNe})});function sNe(n){let e={x:le(n,"x","relu6")};return De.runKernel(cd,e)}var L0,ak=D(()=>{"use strict";yt();Ze();ht();at();L0=Se({relu6_:sNe})});function iNe(n,t){let r={x:le(n,"x","reverse")},o={dims:t};return De.runKernel(Tm,r,o)}var Ds,Km=D(()=>{"use strict";yt();Ze();ht();at();Ds=Se({reverse_:iNe})});function aNe(n){let t=le(n,"x","reverse");return ke(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),Ds(t,0)}var fW,mW=D(()=>{"use strict";ht();Rt();at();Km();fW=Se({reverse1d_:aNe})});function uNe(n,t){let e=le(n,"x","reverse");return ke(e.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${e.rank}.`),Ds(e,t)}var gW,yW=D(()=>{"use strict";ht();Rt();at();Km();gW=Se({reverse2d_:uNe})});function cNe(n,t){let e=le(n,"x","reverse");return ke(e.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${e.rank}.`),Ds(e,t)}var xW,bW=D(()=>{"use strict";ht();Rt();at();Km();xW=Se({reverse3d_:cNe})});function lNe(n,t){let e=le(n,"x","reverse");return ke(e.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${e.rank}.`),Ds(e,t)}var vW,wW=D(()=>{"use strict";ht();Rt();at();Km();vW=Se({reverse4d_:lNe})});function pNe(n){let e={x:le(n,"x","round")};return De.runKernel(ld,e)}var Nw,SW=D(()=>{"use strict";yt();Ze();ht();at();Nw=Se({round_:pNe})});function hNe(n){let e={x:le(n,"x","rsqrt")};return De.runKernel(pd,e)}var B0,tP=D(()=>{"use strict";yt();Ze();ht();at();B0=Se({rsqrt_:hNe})});function sn(n,t){if((_i(n)&&t!=="string"||Array.isArray(n))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&_i(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return mu(n,[],[],t)}var Go=D(()=>{"use strict";Rt();Lm();});function dNe(n){let e={x:le(n,"x","selu")};return De.runKernel(hd,e)}var z0,nP=D(()=>{"use strict";yt();Ze();ht();at();z0=Se({selu_:dNe})});function fNe(n,t,e,r,o,s=[1,1],i="NHWC"){let a=le(n,"x","separableConv2d"),u=le(t,"depthwiseFilter","separableConv2d"),c=le(e,"pointwiseFilter","separableConv2d"),h=a,f=!1;if(a.rank===3&&(f=!0,h=nt(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ke(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),ke(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),ke(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),ke(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),ke(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let g=u.shape[2],d=u.shape[3];ke(c.shape[2]===g*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${g*d}, but got ${c.shape[2]}.`);let p=fc(h,u,r,o,i,s),y=Wa(p,c,1,"valid",i);return f?nt(y,[y.shape[1],y.shape[2],y.shape[3]]):y}var kw,rP=D(()=>{"use strict";ht();Rt();tx();hw();at();En();kw=Se({separableConv2d_:fNe})});function mNe(n,t){return Te(this,null,function*(){let e=le(n,"x","setdiff1d"),r=le(t,"y","setdiff1d");ke(e.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${e.dtype}) and y (${r.dtype}).`),ke(e.rank===1,()=>`x should be 1D tensor, but got x (${e.shape}).`),ke(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);let o=yield e.data(),s=yield r.data(),i=new Set(s),a=0;for(let h=0;h<o.length;h++)i.has(o[h])||a++;let u=new no([a],e.dtype),c=new no([a],"int32");for(let h=0,f=0;h<o.length;h++)i.has(o[h])||(u.values[f]=o[h],c.values[f]=h,f++);return[u.toTensor(),c.toTensor()]})}var uk,CW=D(()=>{"use strict";Ct();ht();Rt();uk=mNe});function gNe(n){let e={x:le(n,"x","sign")};return De.runKernel(md,e)}var Dw,IW=D(()=>{"use strict";yt();Ze();ht();at();Dw=Se({sign_:gNe})});function yNe(n){let e={x:le(n,"x","sin")};return De.runKernel(dd,e)}var V0,oP=D(()=>{"use strict";yt();Ze();ht();at();V0=Se({sin_:yNe})});function xNe(n){let e={x:le(n,"x","sinh")};return De.runKernel(fd,e)}var j0,sP=D(()=>{"use strict";yt();Ze();ht();at();j0=Se({sinh_:xNe})});function bNe(n,t,e){let r=le(n,"x","slice1d");return ke(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),Jn(r,[t],[e])}var Aw,_W=D(()=>{"use strict";ht();Rt();at();Vu();Aw=Se({slice1d_:bNe})});function vNe(n,t,e){let r=le(n,"x","slice2d");return ke(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),Jn(r,t,e)}var sI,TW=D(()=>{"use strict";ht();Rt();at();Vu();sI=Se({slice2d_:vNe})});function wNe(n,t,e){let r=le(n,"x","slice3d");return ke(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),Jn(r,t,e)}var Ow,EW=D(()=>{"use strict";ht();Rt();at();Vu();Ow=Se({slice3d_:wNe})});function SNe(n,t,e){let r=le(n,"x","slice4d");return ke(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),Jn(r,t,e)}var cx,NW=D(()=>{"use strict";ht();Rt();at();Vu();cx=Se({slice4d_:SNe})});function CNe(n,t=-1){let e=le(n,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${t}`);let r={logits:e},o={dim:t};return De.runKernel(Om,r,o)}var jd,kW=D(()=>{"use strict";yt();Ze();ht();at();jd=Se({softmax_:CNe})});function INe(n){ke(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);let t={input:n};return De.runKernel(x1,t)}var Ud,ck=D(()=>{"use strict";yt();Ze();Rt();at();Ud=Se({fft_:INe})});function _Ne(n){ke(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);let t={input:n};return De.runKernel(S1,t)}var Pp,lk=D(()=>{"use strict";yt();Ze();Rt();at();Pp=Se({ifft_:_Ne})});function TNe(n){let t=n.shape[n.shape.length-1],e=n.size/t,r;if(t<=2){let o=nt(n,[e,t]);r=Pp(o)}else{let o=[e,2*(t-1)],s=nt(Hm(n),[e,t]),i=nt(D0(n),[e,t]),a=Ds(Jn(s,[0,1],[e,t-2]),1),u=Qe(Ds(Jn(i,[0,1],[e,t-2]),1),sn(-1)),c=$r([s,a],1),h=$r([i,u],1),f=nt(Bu(c,h),[o[0],o[1]]);r=Pp(f)}if(r=Hm(r),n.rank===3&&n.shape[0]!==0){let o=r,s=n.shape[0];r=nt(r,[s,r.shape[0]/s,r.shape[1]]),o.dispose()}return r}var U0,iP=D(()=>{"use strict";G1();dc();$N();jn();at();ik();En();Km();Go();Vu();lk();U0=Se({irfft_:TNe})});function ENe(n,t,e=0){let o={x:le(n,"x","split")},s={numOrSizeSplits:t,axis:e};return De.runKernel(Am,o,s)}var fi,Rw=D(()=>{"use strict";yt();Ze();ht();at();fi=Se({split_:ENe})});function NNe(n,t){ke(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let e=n.shape[n.shape.length-1],r=n.size/e,o;if(t!=null&&t<e){let p=n.shape.map(y=>0),m=n.shape.map(y=>y);m[n.shape.length-1]=t,o=Jn(n,p,m),e=t}else if(t!=null&&t>e){let p=n.shape.map(m=>m);p[n.shape.length-1]=t-e,o=$r([n,so(p)],n.shape.length-1),e=t}else o=n;let s=Mn(o),i=nt(Bu(o,s),[r,e]),a=Ud(i),u=Math.floor(e/2)+1,c=Hm(a),h=D0(a),f=fi(c,[u,e-u],c.shape.length-1),g=fi(h,[u,e-u],h.shape.length-1),d=o.shape.slice();return d[o.shape.length-1]=u,nt(Bu(f[0],g[0]),d)}var qd,pk=D(()=>{"use strict";Rt();G1();dc();$N();at();ik();En();Vu();Rw();sx();rs();ck();qd=Se({rfft_:NNe})});function kNe(n){let e={x:le(n,"x","sqrt")};return De.runKernel(xd,e)}var wo,$p=D(()=>{"use strict";yt();Ze();ht();at();wo=Se({sqrt_:kNe})});function DNe(n,t){let e=le(n,"a","squaredDifference"),r=le(t,"b","squaredDifference");[e,r]=Cr(e,r),hr(e.shape,r.shape);let o={a:e,b:r},s={};return De.runKernel(bd,o,s)}var Gd,iI=D(()=>{"use strict";yt();Ze();us();ht();Xo();at();Gd=Se({squaredDifference_:DNe})});function ANe(n,t){let e=le(n,"x","squeeze");return nt(e,yM(e.shape,t).newShape)}var Uu,aI=D(()=>{"use strict";ht();Rt();at();En();Uu=Se({squeeze_:ANe})});function ONe(n,t=0){let e=$m(n,"tensors","stack","string_or_numeric");ke(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&ke(t<=e[0].rank,()=>"Axis must be <= rank of the tensor");let r=e,o={axis:t};return De.runKernel(vm,r,o)}var xs,lx=D(()=>{"use strict";yt();Ze();ht();Rt();at();xs=Se({stack_:ONe})});function RNe(n,t=0){let r={x:le(n,"x","step")},o={alpha:t};return De.runKernel(Cd,r,o)}var Pl,Mw=D(()=>{"use strict";yt();Ze();ht();at();Pl=Se({step_:RNe})});function MNe(n,t,e,r,o=0,s=0,i=0,a=0,u=0){let h={x:le(n,"x","stridedSlice")},f={begin:t,end:e,strides:r,beginMask:o,endMask:s,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return De.runKernel(V1,h,f)}var Fw,DW=D(()=>{"use strict";yt();Ze();ht();at();Fw=Se({stridedSlice_:MNe})});function FNe(n){let e={x:le(n,"x","tan")};return De.runKernel(wd,e)}var Pw,AW=D(()=>{"use strict";yt();Ze();ht();at();Pw=Se({tan_:FNe})});function bs(n,t){Hc(n);let e=va(n,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return mu(n,null,e,t)}var $w=D(()=>{"use strict";ht();Rt();Lm();});function Lp(n,t,e){if(Hc(n),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let r=va(n,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return mu(n,t,r,e)}var hk=D(()=>{"use strict";ht();Rt();Lm();});function OW(n,t,e){if(Hc(n),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");let r=va(n,e);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return mu(n,t,r,e)}var RW=D(()=>{"use strict";ht();Rt();Lm();});function MW(n,t,e){if(Hc(n),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");let r=va(n,e);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return mu(n,t,r,e)}var FW=D(()=>{"use strict";ht();Rt();Lm();});function PW(n,t,e){if(Hc(n),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");let r=va(n,e);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||r,mu(n,t,r,e)}var $W=D(()=>{"use strict";ht();Rt();Lm();});function PNe(n,t=1,e=!0){let r=le(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=r.shape[r.shape.length-1];if(t>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${t}`);let s={x:r},i={k:t,sorted:e},[a,u]=De.runKernel(j1,s,i);return{values:a,indices:u}}var Lw,aP=D(()=>{"use strict";yt();Ze();ht();at();Lw=Se({topk_:PNe})});function $Ne(n,t=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");let s=new ax(t,e,r,!0,o),i=Rn(n,r);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var q0,LW=D(()=>{"use strict";zm();at();rI();q0=Se({truncatedNormal_:$Ne})});function LNe(n,t=0){let e=le(n,"x","unique","string_or_numeric");ke(e.rank>0,()=>"The input tensor must be at least 1D");let r={x:e},o={axis:t},[s,i]=De.runKernel(U1,r,o);return{values:s,indices:i}}var px,uP=D(()=>{"use strict";yt();Ze();ht();Rt();at();px=Se({unique_:LNe})});function BNe(n,t,e){let r=le(n,"x","unsortedSegmentSum"),o=le(t,"segmentIds","unsortedSegmentSum","int32");ke(to(e),()=>"numSegments must be of dtype int");let s={x:r,segmentIds:o},i={numSegments:e};return De.runKernel(Fm,s,i)}var Bw,dk=D(()=>{"use strict";yt();Ze();ht();Rt();at();Bw=Se({unsortedSegmentSum_:BNe})});function zNe(n,t=0){let e=le(n,"x","unstack","string_or_numeric");ke(t>=-e.shape.length&&t<e.shape.length,()=>`Axis = ${t} is not in [-${e.shape.length}, ${e.shape.length})`);let r={value:e},o={axis:t};return De.runKernel(Mm,r,o)}var mi,zw=D(()=>{"use strict";yt();Ze();ht();Rt();at();mi=Se({unstack_:zNe})});function fk(n,t=!0,e,r){return De.makeVariable(n,t,e,r)}var BW=D(()=>{"use strict";yt();});function mk(n,t){let e=[];for(let s=0;s<t.length;s++)t[s]&&e.push(s);let r=Rn(n,"int32"),o=Rn([e.length,n.length],"int32");for(let s=0;s<e.length;s++){let i=r.indexToLoc(e[s]),a=s*n.length;o.values.set(i,a)}return o.toTensor()}var cP=D(()=>{"use strict";zm();});function VNe(n){return Te(this,null,function*(){let t=le(n,"condition","whereAsync","bool"),e=yield t.data(),r=mk(t.shape,e);return n!==t&&t.dispose(),r})}var Vw,lP=D(()=>{"use strict";cP();ht();Vw=VNe});function jNe(n,t,e){return Te(this,null,function*(){let r=le(n,"tensor","boolMask"),o=le(t,"mask","boolMask","bool"),s=e??0,i=o.rank,a=r.shape;ke(i>0,()=>"mask cannot be scalar"),vr(a.slice(s,s+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let m=s;m<s+i;m++)u*=a[m];let c=a.slice(0,s).concat([u],a.slice(s+i)),h=nt(r,c),f=nt(o,[-1]),g=yield Vw(f),d=Uu(g,[1]),p=Zc(h,d,s);return n!==r&&r.dispose(),t!==o&&o.dispose(),d.dispose(),h.dispose(),f.dispose(),g.dispose(),p})}var UNe,zW=D(()=>{"use strict";ht();Rt();KC();En();aI();lP();UNe=jNe});function qNe(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","notEqualStrict"),r=le(t,"b","notEqualStrict");return vr(e.shape,r.shape,"Error in notEqualStrict: "),ju(e,r)}function GNe(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","lessStrict"),r=le(t,"b","lessStrict");return vr(e.shape,r.shape,"Error in lessStrict: "),$d(e,r)}function WNe(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","equalStrict"),r=le(t,"b","equalStrict");return vr(e.shape,r.shape,"Error in equalStrict: "),Ha(e,r)}function HNe(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","lessEqualStrict"),r=le(t,"b","lessEqualStrict");return vr(e.shape,r.shape,"Error in lessEqualStrict: "),yu(e,r)}function KNe(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","greaterStrict"),r=le(t,"b","greaterStrict");return vr(e.shape,r.shape,"Error in greaterStrict: "),ks(e,r)}function XNe(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","greaterEqualStrict"),r=le(t,"b","greaterEqualStrict");return vr(e.shape,r.shape,"Error in greaterEqualStrict: "),Sa(e,r)}var pP,hP,dP,fP,mP,gP,VW=D(()=>{"use strict";gu();ht();Rt();fw();Fd();k0();XC();A0();tI();at();pP=Se({equalStrict_:WNe}),hP=Se({greaterEqualStrict_:XNe}),dP=Se({greaterStrict_:KNe}),fP=Se({lessEqualStrict_:HNe}),mP=Se({lessStrict_:GNe}),gP=Se({notEqualStrict_:qNe})});function YNe(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","addStrict"),r=le(t,"b","addStrict");return vr(e.shape,r.shape,"Error in addStrict: "),Pt(e,r)}function QNe(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","subStrict"),r=le(t,"b","subStrict");return vr(e.shape,r.shape,"Error in subStrict: "),un(e,r)}function ZNe(n,t){return Ns("strict variants of ops have been deprecated and will be removed in future"),vr(n.shape,t.shape,"Error in powStrict: "),$i(n,t)}function JNe(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","mul"),r=le(t,"b","mul");return vr(e.shape,r.shape,"Error in multiplyStrict: "),Qe(e,r)}function eke(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","div"),r=le(t,"b","div");return vr(e.shape,r.shape,"Error in divideStrict: "),hn(e,r)}function tke(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","modStrict"),r=le(t,"b","modStrict");return vr(e.shape,r.shape,"Error in modStrict: "),F0(e,r)}function nke(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","minimumStrict"),r=le(t,"b","minimumStrict");return vr(e.shape,r.shape,"Error in minimumStrict: "),gc(e,r)}function rke(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","maximumStrict"),r=le(t,"b","maximumStrict");return vr(e.shape,r.shape,"Error in maximumStrict: "),ea(e,r)}function oke(n,t){Ns("strict variants of ops have been deprecated and will be removed in future");let e=le(n,"a","squaredDifferenceStrict"),r=le(t,"b","squaredDifferenceStrict");return vr(e.shape,r.shape,"Error in squaredDifferenceStrict: "),Gd(e,r)}var yP,xP,bP,vP,wP,SP,CP,IP,_P,jW=D(()=>{"use strict";gu();ht();Rt();ns();bo();Cw();eI();QN();jn();at();Wm();iI();No();yP=Se({addStrict_:YNe}),xP=Se({divStrict_:eke}),bP=Se({maximumStrict_:rke}),vP=Se({minimumStrict_:nke}),wP=Se({modStrict_:tke}),SP=Se({mulStrict_:JNe}),CP=Se({powStrict_:ZNe}),IP=Se({squaredDifferenceStrict_:oke}),_P=Se({subStrict_:QNe})});function ske(n,t="euclidean",e=null,r=!1){n=le(n,"x","norm");let o=UW(n,t,e),s=o.shape;if(r){let i=ui(e,n.shape);s=Ml(o.shape,i)}return nt(o,s)}function UW(n,t,e=null){if(n.rank===0)return $o(n);if(n.rank!==1&&e===null)return UW(nt(n,[-1]),t,e);if(n.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(t===1)return vn($o(n),e);if(t===1/0)return hi($o(n),e);if(t===-1/0)return Fp($o(n),e);if(t==="euclidean"||t===2)return wo(vn($i($o(n),sn(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(e)&&e.length===2){if(t===1)return hi(vn($o(n),e[0]),e[1]-1);if(t===1/0)return hi(vn($o(n),e[1]),e[0]);if(t===-1/0)return Fp(vn($o(n),e[1]),e[0]);if(t==="fro"||t==="euclidean")return wo(vn(sr(n),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}var hx,gk=D(()=>{"use strict";ht();Rt();Z1();Mp();vw();YN();at();Wm();En();Go();$p();di();qs();hx=Se({norm_:ske})});function ike(n,t,e,r,o=!0){let s=le(n,"v","movingAverage"),i=le(t,"x","movingAverage"),a=le(e,"decay","movingAverage");PM(s,i),ke(fu(s.shape,i.shape),()=>"Shape mismatch in v and x");let u=sn(1),c=un(u,a),h=Qe(un(i,s),c);if(o){ke(r!=null,()=>"When using zeroDebias: true, step is required.");let f=le(r,"step","movingAverage");h=hn(h,un(u,$i(a,f)))}return Pt(s,h)}var ake,qW=D(()=>{"use strict";us();ht();Rt();ns();bo();jn();at();Wm();Go();No();ake=Se({movingAverage_:ike})});function uke(n,t,e){let r=le(n,"indices","scatterND","int32"),o=le(t,"updates","scatterND");uN(o,r,e);let s={indices:r,updates:o},i={shape:e};return De.runKernel(L1,s,i)}var TP,GW=D(()=>{"use strict";yt();Ze();ht();at();lN();TP=Se({scatterND_:uke})});function WW(n,t,e,r){if(n.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${n.shape}.`);let o=n.rank>0?n.shape[0]:1,s=n.rank>1?n.shape[1]:1;if(e.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${e.length}, should be: ${s}.`);let i=t.size;if(!(t.rank===0||t.rank===1&&i===o))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${o}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}var HW=D(()=>{"use strict"});function lke(n,t,e,r=0){let o=le(n,"sparseIndices","sparseToDense","int32"),s=le(t,"sparseValues","sparseToDense"),i=le(r,"defaultValue","sparseToDense",s.dtype);WW(o,s,e,i);let a={sparseIndices:o,sparseValues:s,defaultValue:i},u={outputShape:e};return De.runKernel(z1,a,u)}var uI,KW=D(()=>{"use strict";yt();Ze();HW();ht();at();uI=Se({sparseToDense_:lke})});function pke(n,t){let e=le(t,"indices","gatherND","int32"),o={params:le(n,"x","gatherND"),indices:e};return De.runKernel(w1,o)}var EP,XW=D(()=>{"use strict";yt();Ze();ht();at();EP=Se({gatherND_:pke})});function YW(n,t){if(t==null)return n.shape.slice();if(fu(n.shape,t))return t;if(n.shape.length===t.length){let e=[];for(let r=0;r<n.shape.length;r++)t[r]==null&&n.shape[r]!=null?e.push(n.shape[r]):e.push(t[r]);return e}return t}var QW=D(()=>{"use strict";Rt();});function hke(n,t,e,r){let o=le(n,"x","dropout");if(ke(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),ke(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return n instanceof Me?o.clone():o;let s=YW(o,e),i=1-t,a=hn(Ol(Pt(Fl(s,0,1,"float32",r),i)),i);return Qe(o,a)}var NP,ZW=D(()=>{"use strict";Ct();ht();Rt();ns();bo();QW();PN();jn();at();JF();NP=Se({dropout_:hke})});function kP(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function cI(n,t,e){let r=1-n%2,o=new Float32Array(n);for(let s=0;s<n;++s){let i=2*Math.PI*s/(n+r-1);o[s]=t-e*Math.cos(i)}return bs(o,"float32")}var lI=D(()=>{"use strict";$w();});function dke(n,t,e=1){return Te(this,null,function*(){let r=le(n,"predictions","inTopK"),o=le(t,"targets","inTopK");ke(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),ke(r.rank-1===o.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${o.rank}`),vr(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");let s=r.shape[r.shape.length-1];ke(e>0&&e<=s,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${e}`);let i=yield r.data(),a=yield o.data(),[u,c]=[i.length/s,s],h=xM("bool",u);for(let f=0;f<u;f++){let g=f*c,d=i.subarray(g,g+c),p=[];for(let m=0;m<d.length;m++)p.push({value:d[m],index:m});p.sort((m,y)=>y.value-m.value),h[f]=0;for(let m=0;m<e;m++)if(p[m].index===a[f]){h[f]=1;break}}return n!==r&&r.dispose(),t!==o&&o.dispose(),wa(h,o.shape,"bool")})}var fke,JW=D(()=>{"use strict";ht();Rt();QE();fke=dke});function mke(n,t,e,r,o,s="NHWC",i){let a=n;n.rank===3&&(a=nt(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=t;u.rank===3&&(u=nt(t,[1,t.shape[0],t.shape[1],t.shape[2]])),ke(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),ke(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),ke(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);let c=s==="NHWC"?a.shape[3]:a.shape[1],h=s==="NHWC"?u.shape[3]:u.shape[1];ke(c===e[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${e[2]}.`),ke(h===e[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${e[3]}).`),i!=null&&ke(to(o),()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${i} but got pad ${o}.`);let f={x:a,dy:u},g={strides:r,pad:o,dataFormat:s,dimRoundingMode:i,filterShape:e};return De.runKernel(u1,f,g)}var jw,yk=D(()=>{"use strict";yt();Ze();Rt();at();En();jw=Se({conv2DBackpropFilter_:mke})});function dx(n,t,e){if(e==null||e==="linear")return n;if(e==="relu")return Qe(n,Pl(t));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function fx(n,t){let e=t,r=Lo(n.shape,t.shape);return r.length>0&&(e=vn(e,r)),nt(e,n.shape)}function mx(n,t,e,r){if(t==="linear")return n;if(t==="relu")return na(n);if(t==="elu")return Al(n);if(t==="relu6")return L0(n);if(t==="prelu")return Vd(n,e);if(t==="leakyrelu")return Pd(n,r);throw new Error(`Unknown fused activation ${t}.`)}var gx,Uw=D(()=>{"use strict";Xo();MN();VN();jn();ek();Ew();ak();En();Mw();qs();gx=(n,t)=>!(n>0)||t==="linear"});function gke({x:n,filter:t,strides:e,pad:r,dataFormat:o="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(u=u||"linear",gx(De.state.gradientDepth,u)===!1){let S=Wa(n,t,e,r,o,s,i);return a!=null&&(S=Pt(S,a)),mx(S,u,c,h)}let f=le(n,"x","conv2d"),g=le(t,"filter","conv2d"),d=f,p=!1;f.rank===3&&(p=!0,d=nt(f,[1,f.shape[0],f.shape[1],f.shape[2]])),ke(d.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`),ke(g.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${g.rank}.`),i!=null&&ke(to(r),()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`),ke(d.shape[3]===g.shape[2],()=>`Error in conv2d: depth of input (${d.shape[3]}) must match input depth for filter ${g.shape[2]}.`),ke(cs(e,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`),ke(o==="NHWC",()=>`Error in conv2d: got dataFormat of ${o} but only NHWC is currently supported.`);let m=ex(d.shape,g.shape,e,s,r,i),y;a!=null&&(y=le(a,"bias","fused conv2d"),[y]=Cr(y,f),hr(m.outShape,y.shape));let v;c!=null&&(v=le(c,"prelu weights","fused conv2d"));let N=(S,F)=>{let[R,L,q,U]=F,Z=dx(S,q,u);ke(Xc(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);let ee=cw(L.shape,Z,R,e,r),Q=jw(L,Z,R.shape,e,r),oe=[ee,Q];if(U!=null){let se=fx(U,Z);oe.push(se)}return oe},T={x:d,filter:g,bias:y,preluActivationWeights:v},O={strides:e,pad:r,dataFormat:o,dilations:s,dimRoundingMode:i,activation:u,leakyreluAlpha:h};return a==null?Ka((F,R,L)=>{let q=De.runKernel(m0,T,O);return L([R,F,q]),p&&(q=nt(q,[q.shape[1],q.shape[2],q.shape[3]])),{value:q,gradFunc:N}})(d,g):Ka((F,R,L,q)=>{let U=De.runKernel(m0,T,O);return q([R,F,U,L]),p&&(U=nt(U,[U.shape[1],U.shape[2],U.shape[3]])),{value:U,gradFunc:N}})(d,g,y)}var eH,tH=D(()=>{"use strict";yt();Gm();Ze();us();ht();Rt();ns();Xo();tx();yk();NN();qa();Uw();at();En();eH=Se({fusedConv2d_:gke})});function yke(n,t,e,r,o,s=[1,1],i){let a=n;n.rank===3&&(a=nt(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=t;u.rank===3&&(u=nt(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let c={x:a,dy:u},h={strides:r,pad:o,dimRoundingMode:i,dilations:s,filterShape:e};return De.runKernel(f1,c,h)}var xk,DP=D(()=>{"use strict";yt();Ze();at();En();xk=Se({depthwiseConv2dNativeBackpropFilter_:yke})});function xke(n,t,e,r,o,s=[1,1],i){let a=t,u=!1;t.rank===3&&(u=!0,a=nt(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let c={dy:a,filter:e},h={strides:r,pad:o,dimRoundingMode:i,dilations:s,inputShape:n},f=De.runKernel(m1,c,h);return u?nt(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var bk,AP=D(()=>{"use strict";yt();Ze();at();En();bk=Se({depthwiseConv2dNativeBackpropInput_:xke})});function bke({x:n,filter:t,strides:e,pad:r,dataFormat:o="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(gx(De.state.gradientDepth,u)===!1){let S=fc(n,t,e,r,o,s,i);return a!=null&&(S=Pt(S,a)),mx(S,u,c,h)}let f=le(n,"x","depthwiseConv2d"),g=le(t,"filter","depthwiseConv2d"),d=f,p=!1;f.rank===3&&(p=!0,d=nt(f,[1,f.shape[0],f.shape[1],f.shape[2]])),ke(d.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),ke(g.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${g.rank}.`),ke(d.shape[3]===g.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${g.shape[2]}.`),s==null&&(s=[1,1]),ke(cs(e,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`),i!=null&&ke(to(r),()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${i} but got pad ${r}.`);let m=ex(d.shape,g.shape,e,s,r,i,!0),y;a!=null&&(y=le(a,"bias","fused conv2d"),[y]=Cr(y,f),hr(m.outShape,y.shape));let v;c!=null&&(v=le(c,"prelu weights","fused depthwiseConv2d"));let N=(S,F)=>{ke(Xc(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[R,L,q,U]=F,Z=dx(S,q,u),ee=bk(L.shape,Z,R,e,r,s,i),Q=xk(L,Z,R.shape,e,r,s,i);if(U!=null){let oe=fx(y,Z);return[ee,Q,oe]}return[ee,Q]},T={x:d,filter:g,bias:y,preluActivationWeights:v},O={strides:e,pad:r,dataFormat:o,dilations:s,dimRoundingMode:i,activation:u,leakyreluAlpha:h};return a==null?Ka((F,R,L)=>{let q=De.runKernel(g0,T,O);return L([R,F,q]),p&&(q=nt(q,[q.shape[1],q.shape[2],q.shape[3]])),{value:q,gradFunc:N}})(d,g):Ka((F,R,L,q)=>{let U=De.runKernel(g0,T,O);return q([R,F,U,L]),p&&(U=nt(U,[U.shape[1],U.shape[2],U.shape[3]])),{value:U,gradFunc:N}})(d,g,y)}var nH,rH=D(()=>{"use strict";yt();Gm();Ze();us();ht();Rt();ns();Xo();qa();hw();DP();AP();Uw();at();En();nH=Se({fusedDepthwiseConv2d_:bke})});function vke({a:n,b:t,transposeA:e=!1,transposeB:r=!1,bias:o,activation:s="linear",preluActivationWeights:i,leakyreluAlpha:a}){if(gx(De.state.gradientDepth,s)===!1){let U=Ir(n,t,e,r);return o!=null&&(U=Pt(U,o)),mx(U,s,i,a)}let u=le(n,"a","fused matMul"),c=le(t,"b","fused matMul");[u,c]=Cr(u,c);let h=e?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],g=e?u.shape[u.rank-1]:u.shape[u.rank-2],d=r?c.shape[c.rank-2]:c.shape[c.rank-1],p=u.shape.slice(0,-2),m=c.shape.slice(0,-2),y=xo(p),v=xo(m);ke(u.rank>=2&&c.rank>=2&&u.rank===c.rank,()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${u.rank} and ${c.rank}.`),ke(fu(p,m),()=>`Error in fused matMul: outer dimensions (${p}) and (${m}) of Tensors with shapes ${u.shape} and ${c.shape} must match.`),ke(h===f,()=>`Error in fused matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${e} and transposeB=${r} must match.`);let N=u.shape.slice(0,-2).concat([g,d]),T=e?nt(u,[y,h,g]):nt(u,[y,g,h]),O=r?nt(c,[v,d,f]):nt(c,[v,f,d]),S;o!=null&&(S=le(o,"bias","fused matMul"),[S]=Cr(S,u),hr(N,S.shape));let F;i!=null&&(F=le(i,"prelu weights","fused matMul"));let R=(U,Z)=>{let[ee,Q,oe,se]=Z,pe=dx(nt(U,oe.shape),oe,s),ae,fe;if(!e&&!r?(ae=Ir(pe,Q,!1,!0),fe=Ir(ee,pe,!0,!1)):!e&&r?(ae=Ir(pe,Q,!1,!1),fe=Ir(pe,ee,!0,!1)):e&&!r?(ae=Ir(Q,pe,!1,!0),fe=Ir(ee,pe,!1,!1)):(ae=Ir(Q,pe,!0,!0),fe=Ir(pe,ee,!0,!0)),o!=null){let he=fx(se,pe);return[ae,fe,he]}else return[ae,fe]},L={a:T,b:O,bias:S,preluActivationWeights:F},q={transposeA:e,transposeB:r,activation:s,leakyreluAlpha:a};return o==null?Ka((Z,ee,Q)=>{let oe=De.runKernel(f0,L,q);return Q([Z,ee,oe]),{value:nt(oe,N),gradFunc:R}})(T,O):Ka((Z,ee,Q,oe)=>{let se=De.runKernel(f0,L,q);return oe([Z,ee,se,Q]),{value:nt(se,N),gradFunc:R}})(T,O,S)}var oH,sH=D(()=>{"use strict";yt();Gm();Ze();us();ht();Rt();ns();Xo();Uw();Nd();at();En();oH=Se({fusedMatMul_:vke})});var Jc={};Br(Jc,{conv2d:()=>eH,depthwiseConv2d:()=>nH,matMul:()=>oH});var iH=D(()=>{"use strict";tH();rH();sH();});function wke(n){return cI(n,.54,.46)}var aH,uH=D(()=>{"use strict";at();lI();aH=Se({hammingWindow_:wke})});function Ske(n){return cI(n,.5,.5)}var vk,OP=D(()=>{"use strict";at();lI();vk=Se({hannWindow_:Ske})});function Cke(n,t,e,r=!1,o=0){let s=0,i=[];for(;s+t<=n.size;)i.push(Jn(n,s,t)),s+=e;if(r)for(;s<n.size;){let a=s+t-n.size,u=$r([Jn(n,s,t-a),Md([a],o)]);i.push(u),s+=e}return i.length===0?Lp([],[0,t]):nt($r(i),[i.length,t])}var wk,RP=D(()=>{"use strict";dc();FN();at();En();Vu();hk();wk=Se({frame_:Cke})});function Ike(n,t,e,r,o=vk){r==null&&(r=kP(t));let s=wk(n,t,e),i=Qe(s,o(t)),a=[];for(let u=0;u<s.shape[0];u++)a.push(qd(Jn(i,[u,0],[1,t]),r));return $r(a)}var cH,lH=D(()=>{"use strict";dc();jn();at();lI();Vu();pk();RP();OP();cH=Se({stft_:Ike})});function _ke(n,t,e,r,o="bilinear",s=0){let i=le(n,"image","cropAndResize"),a=le(t,"boxes","cropAndResize","float32"),u=le(e,"boxInd","cropAndResize","int32"),c=a.shape[0];ke(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),ke(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),ke(u.rank===1&&u.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),ke(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),ke(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),ke(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);let h={image:i,boxes:a,boxInd:u},f={method:o,extrapolationValue:s,cropSize:r};return De.runKernel(p1,h,f)}var pH,hH=D(()=>{"use strict";yt();Ze();ht();Rt();at();pH=Se({cropAndResize_:_ke})});function Tke(n){let t=le(n,"image","flipLeftRight","float32");ke(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);let e={image:t};return De.runKernel(v1,e,{})}var dH,fH=D(()=>{"use strict";yt();Ze();ht();Rt();at();dH=Se({flipLeftRight_:Tke})});function Eke(n,t,e=0,r=.5){let o=le(n,"image","rotateWithOffset","float32");ke(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);let s={image:o},i={radians:t,fillValue:e,center:r};return De.runKernel(q1,s,i)}var mH,gH=D(()=>{"use strict";yt();Ze();ht();Rt();at();mH=Se({rotateWithOffset_:Eke})});function $l(n,t,e,r,o,s){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),s==null&&(s=0);let i=n.shape[0];return e=Math.min(e,i),ke(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),ke(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),ke(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),ke(t.rank===1,()=>"scores must be a 1D tensor"),ke(t.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${t.shape[0]}`),ke(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:s}}var yx=D(()=>{"use strict";Rt();});function Nke(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY){let s=le(n,"boxes","nonMaxSuppression"),i=le(t,"scores","nonMaxSuppression"),a=$l(s,i,e,r,o);e=a.maxOutputSize,r=a.iouThreshold,o=a.scoreThreshold;let u={maxOutputSize:e,iouThreshold:r,scoreThreshold:o};return De.runKernel(D1,{boxes:s,scores:i},u)}var yH,xH=D(()=>{"use strict";yt();Ze();ht();yx();at();yH=Se({nonMaxSuppression_:Nke})});function bH(n,t,e){let r=kke(n,t,e),o=r<0?-(r+1):r;n.splice(o,0,t)}function kke(n,t,e){return Ake(n,t,e||Dke)}function Dke(n,t){return n>t?1:n<t?-1:0}function Ake(n,t,e){let r=0,o=n.length,s=0,i=!1;for(;r<o;){s=r+(o-r>>>1);let a=e(t,n[s]);a>0?r=s+1:(o=s,i=!a)}return i?r:-r-1}var vH=D(()=>{"use strict";});function Sk(n,t,e,r,o){return MP(n,t,e,r,o,0)}function Ck(n,t,e,r,o,s){return MP(n,t,e,r,o,0,!1,s,!0)}function Ik(n,t,e,r,o,s){return MP(n,t,e,r,o,s,!0)}function MP(n,t,e,r,o,s,i=!1,a=!1,u=!1){let c=[];for(let y=0;y<t.length;y++)t[y]>o&&c.push({score:t[y],boxIndex:y,suppressBeginIndex:0});c.sort(wH);let h=s>0?-.5/s:0,f=[],g=[];for(;f.length<e&&c.length>0;){let y=c.pop(),{score:v,boxIndex:N,suppressBeginIndex:T}=y;if(v<o)break;let O=!1;for(let S=f.length-1;S>=T;--S){let F=Oke(n,N,f[S]);if(F>=r){O=!0;break}if(y.score=y.score*Rke(r,h,F),y.score<=o)break}y.suppressBeginIndex=f.length,O||(y.score===v?(f.push(N),g.push(y.score)):y.score>o&&bH(c,y,wH))}let d=f.length,p=e-d;a&&p>0&&(f.push(...new Array(p).fill(0)),g.push(...new Array(p).fill(0)));let m={selectedIndices:f};return i&&(m.selectedScores=g),u&&(m.validOutputs=d),m}function Oke(n,t,e){let r=n.subarray(t*4,t*4+4),o=n.subarray(e*4,e*4+4),s=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),h=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),g=Math.max(o[1],o[3]),d=(a-s)*(u-i),p=(f-c)*(g-h);if(d<=0||p<=0)return 0;let m=Math.max(s,c),y=Math.max(i,h),v=Math.min(a,f),N=Math.min(u,g),T=Math.max(v-m,0)*Math.max(N-y,0);return T/(d+p-T)}function Rke(n,t,e){let r=Math.exp(t*e*e);return e<=n?r:0}function wH(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}var pI=D(()=>{"use strict";vH();});function Mke(s,i,a){return Te(this,arguments,function*(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY){let u=le(n,"boxes","nonMaxSuppressionAsync"),c=le(t,"scores","nonMaxSuppressionAsync"),h=$l(u,c,e,r,o);e=h.maxOutputSize,r=h.iouThreshold,o=h.scoreThreshold;let f=yield Promise.all([u.data(),c.data()]),g=f[0],d=f[1],{selectedIndices:p}=Sk(g,d,e,r,o);return u!==n&&u.dispose(),c!==t&&c.dispose(),bs(p,"int32")})}var SH,CH=D(()=>{"use strict";pI();ht();yx();$w();SH=Mke});function Fke(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,s=0){let i=le(n,"boxes","nonMaxSuppression"),a=le(t,"scores","nonMaxSuppression"),u=$l(i,a,e,r,o,s);e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,s=u.softNmsSigma;let c={boxes:i,scores:a},h={maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:s},f=De.runKernel(O1,c,h);return{selectedIndices:f[0],selectedScores:f[1]}}var IH,_H=D(()=>{"use strict";yt();Ze();ht();yx();at();IH=Se({nonMaxSuppressionWithScore_:Fke})});function Pke(i,a,u){return Te(this,arguments,function*(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,s=0){let c=le(n,"boxes","nonMaxSuppressionAsync"),h=le(t,"scores","nonMaxSuppressionAsync"),f=$l(c,h,e,r,o,s);e=f.maxOutputSize,r=f.iouThreshold,o=f.scoreThreshold,s=f.softNmsSigma;let g=yield Promise.all([c.data(),h.data()]),d=g[0],p=g[1],{selectedIndices:m,selectedScores:y}=Ik(d,p,e,r,o,s);return c!==n&&c.dispose(),h!==t&&h.dispose(),{selectedIndices:bs(m,"int32"),selectedScores:bs(y)}})}var TH,EH=D(()=>{"use strict";pI();ht();yx();$w();TH=Pke});function $ke(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,s=!1){let i=le(n,"boxes","nonMaxSuppression"),a=le(t,"scores","nonMaxSuppression"),u=$l(i,a,e,r,o,null),c=u.maxOutputSize,h=u.iouThreshold,f=u.scoreThreshold,g={boxes:i,scores:a},d={maxOutputSize:c,iouThreshold:h,scoreThreshold:f,padToMaxOutputSize:s},p=De.runKernel(A1,g,d);return{selectedIndices:p[0],validOutputs:p[1]}}var NH,kH=D(()=>{"use strict";yt();Ze();ht();yx();at();NH=Se({nonMaxSuppressionPadded_:$ke})});function Lke(i,a,u){return Te(this,arguments,function*(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,s=!1){let c=le(n,"boxes","nonMaxSuppressionAsync"),h=le(t,"scores","nonMaxSuppressionAsync"),f=$l(c,h,e,r,o,null),g=f.maxOutputSize,d=f.iouThreshold,p=f.scoreThreshold,[m,y]=yield Promise.all([c.data(),h.data()]),{selectedIndices:v,validOutputs:N}=Ck(m,y,g,d,p,s);return c!==n&&c.dispose(),h!==t&&h.dispose(),{selectedIndices:bs(v,"int32"),validOutputs:sn(N,"int32")}})}var DH,AH=D(()=>{"use strict";pI();ht();yx();Go();$w();DH=Lke});function Bke(n,t,e=!1,r=!1){let o=le(n,"images","resizeBilinear");ke(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),ke(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),ke(r===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=nt(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=t,a={images:s},u={alignCorners:e,halfPixelCenters:r,size:t},c=De.runKernel(_m,a,u);return i?nt(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var _k,FP=D(()=>{"use strict";yt();Ze();ht();Rt();at();En();_k=Se({resizeBilinear_:Bke})});function zke(n,t,e=!1,r=!1){let o=le(n,"images","resizeNearestNeighbor");ke(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),ke(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),ke(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),ke(r===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=nt(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=t,a={images:s},u={alignCorners:e,halfPixelCenters:r,size:t},c=De.runKernel(Im,a,u);return i?nt(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var Tk,PP=D(()=>{"use strict";yt();Ze();ht();Rt();at();En();Tk=Se({resizeNearestNeighbor_:zke})});function Vke(n,t,e){ke(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),ke(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`);let r=le(n,"a","bandPart");ke(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);let o=r.shape,[s,i]=r.shape.slice(-2);if(!(t<=s))throw new Error(`bandPart(): numLower (${t}) must not be greater than the number of rows (${s}).`);if(!(e<=i))throw new Error(`bandPart(): numUpper (${e}) must not be greater than the number of columns (${i}).`);t<0&&(t=s),e<0&&(e=i);let a=nt(ux(0,s,1,"int32"),[-1,1]),u=ux(0,i,1,"int32"),c=un(a,u),h=Ti(yu(c,sn(+t,"int32")),Sa(c,sn(-e,"int32"))),f=so([s,i],r.dtype);return nt(xs(mi(nt(r,[-1,s,i])).map(g=>Yo(h,g,f))),o)}var OH,RH=D(()=>{"use strict";ht();Rt();k0();A0();rx();at();eP();En();Go();lx();No();zw();Dl();sx();OH=Se({bandPart_:Vke})});function jke(n){let t;if(Array.isArray(n)){t=!1,ke(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=n[0].shape[0];for(let s=1;s<n.length;++s)ke(n[s].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[s].shape[0]} vs. ${o})`)}else t=!0,n=fi(n,n.shape[0],0).map(o=>Uu(o,[0]));ke(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);let e=[],r=n;for(let o=0;o<n.length;++o)e.push(De.tidy(()=>{let s=r[o];if(o>0)for(let i=0;i<o;++i){let a=Qe(vn(Qe(e[i],s)),e[i]);s=un(s,a)}return hn(s,hx(s,"euclidean"))}));return t?xs(e,0):e}var MH,FH=D(()=>{"use strict";yt();Rt();bo();jn();gk();at();Rw();aI();lx();No();qs();MH=Se({gramSchmidt_:jke})});function Uke(n,t=!1){if(ke(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return PH(n,t);{let e=n.shape.slice(0,n.shape.length-2).reduce((u,c)=>u*c),r=mi(nt(n,[e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),o=[],s=[];r.forEach(u=>{let[c,h]=PH(u,t);o.push(c),s.push(h)});let i=nt(xs(o,0),n.shape),a=nt(xs(s,0),n.shape);return[i,a]}}function PH(n,t=!1){return De.tidy(()=>{ke(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);let e=n.shape[0],r=n.shape[1],o=nx(e),s=hc(n),i=Lp([[1]],[1,1]),a=hc(i),u=e>=r?r:e;for(let c=0;c<u;++c){let h=s,f=a,g=o;[a,s,o]=De.tidy(()=>{let d=Jn(s,[c,c],[e-c,1]),p=hx(d),m=Jn(s,[c,c],[1,1]),y=Yo(ks(m,0),Lp([[-1]]),Lp([[1]])),v=un(m,Qe(y,p)),N=hn(d,v);N.shape[0]===1?a=hc(i):a=$r([i,Jn(N,[1,0],[N.shape[0]-1,N.shape[1]])],0);let T=Er(hn(Ir(y,v),p)),O=Jn(s,[c,0],[e-c,r]),S=Qe(T,a),F=Dr(a);if(c===0)s=un(O,Ir(S,Ir(F,O)));else{let q=un(O,Ir(S,Ir(F,O)));s=$r([Jn(s,[0,0],[c,r]),q],0)}let R=Dr(S),L=Jn(o,[0,c],[e,o.shape[1]-c]);if(c===0)o=un(L,Ir(Ir(L,a),R));else{let q=un(L,Ir(Ir(L,a),R));o=$r([Jn(o,[0,0],[e,c]),q],1)}return[a,s,o]}),Vn([h,f,g])}return!t&&e>r&&(o=Jn(o,[0,0],[e,r]),s=Jn(s,[0,0],[r,r])),[o,s]})}var $H,LH=D(()=>{"use strict";yt();gu();Rt();Kv();dc();bo();FF();Fd();Nd();jn();Ca();gk();at();En();Vu();lx();No();hk();w0();zw();Dl();$H=Se({qr_:Uke})});var As,Bp=D(()=>{"use strict";As=function(n){return n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS",n}(As||{})});function qke(n,t,e=As.SUM_BY_NONZERO_WEIGHTS){let r=le(n,"losses","computeWeightedLoss"),o=null;t!=null&&(o=le(t,"weights","computeWeightedLoss"));let s=o==null?r:Qe(r,o);if(e===As.NONE)return s;if(e===As.SUM)return vn(s);if(e===As.MEAN){if(o==null)return vo(s);{let i=r.size/o.size,a=hn(vn(s),vn(o));return i>1?hn(a,sn(i)):a}}if(e===As.SUM_BY_NONZERO_WEIGHTS){if(o==null)return hn(vn(s),sn(r.size));{let i=Qe(o,ta(r.shape)),a=Wt(vn(ju(i,sn(0))),"float32");return hn(vn(s),a)}}throw Error(`Unknown reduction: ${e}`)}var _a,Wd=D(()=>{"use strict";ht();Mr();bo();Bp();JC();jn();tI();_w();at();Go();qs();_a=Se({computeWeightedLoss_:qke})});function Gke(n,t,e,r=As.SUM_BY_NONZERO_WEIGHTS){let o=le(n,"labels","absoluteDifference"),s=le(t,"predictions","absoluteDifference"),i=null;e!=null&&(i=le(e,"weights","absoluteDifference")),vr(o.shape,s.shape,"Error in absoluteDifference: ");let a=$o(un(o,s));return _a(a,i,r)}var BH,zH=D(()=>{"use strict";ht();Rt();Z1();Bp();at();No();Wd();BH=Se({absoluteDifference_:Gke})});function Wke(n,t,e,r,o=As.SUM_BY_NONZERO_WEIGHTS){let s=le(n,"labels","cosineDistance"),i=le(t,"predictions","cosineDistance"),a=null;r!=null&&(a=le(r,"weights","cosineDistance")),vr(s.shape,i.shape,"Error in cosineDistance: ");let u=sn(1),c=un(u,vn(Qe(s,i),e,!0));return _a(c,a,o)}var VH,jH=D(()=>{"use strict";ht();Rt();Bp();jn();at();Go();No();qs();Wd();VH=Se({cosineDistance_:Wke})});function Hke(n,t,e,r=As.SUM_BY_NONZERO_WEIGHTS){let o=le(n,"labels","hingeLoss"),s=le(t,"predictions","hingeLoss"),i=null;e!=null&&(i=le(e,"weights","hingeLoss")),vr(o.shape,s.shape,"Error in hingeLoss: ");let a=sn(1);o=un(Qe(sn(2),o),a);let u=na(un(a,Qe(o,s)));return _a(u,i,r)}var UH,qH=D(()=>{"use strict";ht();Rt();Bp();jn();at();Ew();Go();No();Wd();UH=Se({hingeLoss_:Hke})});function Kke(n,t,e,r=1,o=As.SUM_BY_NONZERO_WEIGHTS){let s=le(n,"labels","huberLoss"),i=le(t,"predictions","huberLoss"),a=null;e!=null&&(a=le(e,"weights","huberLoss")),vr(s.shape,i.shape,"Error in huberLoss: ");let u=sn(r),c=$o(un(i,s)),h=gc(c,u),f=un(c,h),g=Pt(Qe(sn(.5),sr(h)),Qe(u,f));return _a(g,a,o)}var GH,WH=D(()=>{"use strict";ht();Rt();Z1();ns();Bp();eI();jn();at();Go();di();No();Wd();GH=Se({huberLoss_:Kke})});function Xke(n,t,e,r=1e-7,o=As.SUM_BY_NONZERO_WEIGHTS){let s=le(n,"labels","logLoss"),i=le(t,"predictions","logLoss"),a=null;e!=null&&(a=le(e,"weights","logLoss")),vr(s.shape,i.shape,"Error in logLoss: ");let u=sn(1),c=sn(r),h=Er(Qe(s,pi(Pt(i,c)))),f=Qe(un(u,s),pi(Pt(un(u,i),c))),g=un(h,f);return _a(g,a,o)}var HH,KH=D(()=>{"use strict";ht();Rt();ns();bw();Bp();jn();Ca();at();Go();No();Wd();HH=Se({logLoss_:Xke})});function Yke(n,t,e,r=As.SUM_BY_NONZERO_WEIGHTS){let o=le(n,"labels","meanSquaredError"),s=le(t,"predictions","meanSquaredError"),i=null;e!=null&&(i=le(e,"weights","meanSquaredError")),vr(o.shape,s.shape,"Error in meanSquaredError: ");let a=Gd(o,s);return _a(a,i,r)}var XH,YH=D(()=>{"use strict";ht();Rt();Bp();at();iI();Wd();XH=Se({meanSquaredError_:Yke})});function Qke(n,t){let e=le(n,"labels","sigmoidCrossEntropyWithLogits"),r=le(t,"logits","sigmoidCrossEntropyWithLogits");vr(e.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");let o=na(r),s=Qe(r,e),i=O0(Us(Er($o(r))));return Pt(un(o,s),i)}function Zke(n,t,e,r=0,o=As.SUM_BY_NONZERO_WEIGHTS){let s=le(n,"multiClassLabels","sigmoidCrossEntropy"),i=le(t,"logits","sigmoidCrossEntropy"),a=null;if(e!=null&&(a=le(e,"weights","sigmoidCrossEntropy")),vr(s.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){let c=sn(r),h=sn(1),f=sn(.5);s=Pt(Qe(s,un(h,c)),Qe(f,c))}let u=Qke(s,i);return _a(u,a,o)}var QH,ZH=D(()=>{"use strict";ht();Rt();Z1();ns();Rd();$F();Bp();jn();Ca();at();Ew();Go();No();Wd();QH=Se({sigmoidCrossEntropy_:Zke})});function Jke(n,t,e=-1){if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${e}`);return Ka((o,s,i)=>{let u=ww(s,[e],!0),c=un(Wt(s,"float32"),u);i([o,c]);let h=Er(Qe(c,o));return{value:vn(h,[e]),gradFunc:(d,p)=>{let[m,y]=p,v=Ml(d.shape,[e]);return[Qe(nt(d,v),un(Wt(m,"float32"),Us(y))),Qe(nt(d,v),un(Us(y),Wt(m,"float32")))]}}})(n,t)}function eDe(n,t,e,r=0,o=As.SUM_BY_NONZERO_WEIGHTS){let s=le(n,"onehotLabels","softmaxCrossEntropy"),i=le(t,"logits","softmaxCrossEntropy"),a=null;if(e!=null&&(a=le(e,"weights","softmaxCrossEntropy")),vr(s.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){let c=sn(r),h=sn(1),f=sn(s.shape[1]);s=Pt(Qe(s,un(h,c)),hn(c,f))}let u=Jke(s,i);return _a(u,a,o)}var JH,eK=D(()=>{"use strict";Gm();ht();Rt();ns();Mp();Mr();bo();Rd();GN();Bp();jn();Ca();at();En();Go();No();qs();Wd();JH=Se({softmaxCrossEntropy_:eDe})});var tDe,nDe,zp,$P,rDe,Dn=D(()=>{"use strict";Z1();Vq();jq();ns();Uq();xF();bF();vF();wF();qq();Gq();Wq();SF();Hq();xN();Yq();Zq();GC();aw();tG();nG();rG();oG();CN();zm();Mr();sG();iG();Kv();G1();dc();aG();uG();cG();lG();EF();tx();NF();pG();dG();DN();DF();AN();fG();AF();hw();gG();OF();bo();RF();MF();MN();fw();yG();Rd();WC();xG();FF();FN();PN();mN();KC();Fd();k0();$N();bG();vG();wG();VN();XC();A0();SG();PF();bw();$F();EG();NG();GN();rx();ZC();WN();UF();Nd();vw();KN();DG();AG();Cw();JC();YN();eI();qF();QN();OG();jn();MG();FG();Ca();tI();iN();_w();PG();LG();P0();zG();jG();qG();WG();GF();Wm();ek();JM();WF();KG();pW();hW();JF();eP();ik();dW();Ew();ak();En();Km();mW();yW();bW();wW();SW();tP();Go();nP();rP();CW();qC();IW();oP();sP();Vu();_W();TW();EW();NW();kW();LF();nI();ck();lk();iP();pk();Rw();$p();di();iI();aI();lx();Mw();DW();No();qs();AW();TF();QE();$w();hk();uF();RW();FW();$W();HC();aP();LW();uP();dk();zw();BW();Dl();lP();sx();rs();zW();VW();jW();w0();gk();qW();GW();KW();XW();ZW();lI();JW();at();pk();ck();lk();iP();iH();uH();OP();RP();lH();hH();fH();gH();xH();CH();_H();EH();kH();AH();FP();PP();RH();FH();LH();zH();Wd();jH();qH();WH();KH();YH();ZH();eK();tDe={fft:Ud,ifft:Pp,rfft:qd,irfft:U0},nDe={hammingWindow:aH,hannWindow:vk,frame:wk,stft:cH},zp={flipLeftRight:dH,resizeNearestNeighbor:Tk,resizeBilinear:_k,rotateWithOffset:mH,cropAndResize:pH,nonMaxSuppression:yH,nonMaxSuppressionAsync:SH,nonMaxSuppressionWithScore:IH,nonMaxSuppressionWithScoreAsync:TH,nonMaxSuppressionPadded:NH,nonMaxSuppressionPaddedAsync:DH},$P={bandPart:OH,gramSchmidt:MH,qr:$H},rDe={absoluteDifference:BH,computeWeightedLoss:_a,cosineDistance:VH,hingeLoss:UH,huberLoss:GH,logLoss:HH,meanSquaredError:XH,sigmoidCrossEntropy:QH,softmaxCrossEntropy:JH}});var ra,G0=D(()=>{"use strict";gu();Gm();Dn();kd();ra=class extends jC{minimize(t,e=!1,r){let{value:o,grads:s}=this.computeGradients(t,r);if(r!=null){let i=r.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(i)}else this.applyGradients(s);return Vn(s),e?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return YC(t,e)}dispose(){this.iterations_!=null&&Vn(this.iterations_)}saveIterations(){return Te(this,null,function*(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:sn(this.iterations_,"int32")}})}getWeights(){return Te(this,null,function*(){throw new Error("getWeights() is not implemented for this optimizer yet.")})}setWeights(t){return Te(this,null,function*(){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)})}extractIterations(t){return Te(this,null,function*(){return this.iterations_=(yield t[0].tensor.data())[0],t.slice(1)})}};Object.defineProperty(ra,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null})});var hI,LP=D(()=>{"use strict";yt();gu();ns();bo();jn();Dn();di();rs();kd();G0();hI=(()=>{class n extends ra{constructor(e,r,o=null){super(),this.learningRate=e,this.rho=r,this.epsilon=o,this.accumulatedGrads=[],this.accumulatedUpdates=[],o==null&&(this.epsilon=De.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,s)=>{let i=De.registeredVariables[o],a=!1;this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${o}/accum_grad`,variable:st(()=>Mn(i).variable(a))}),this.accumulatedUpdates[s]==null&&(this.accumulatedUpdates[s]={originalName:`${o}/accum_var`,variable:st(()=>Mn(i).variable(a))});let u=Array.isArray(e)?e[s].tensor:e[o];if(u==null)return;let c=this.accumulatedGrads[s].variable,h=this.accumulatedUpdates[s].variable;st(()=>{let f=Pt(Qe(c,this.rho),Qe(sr(u),1-this.rho)),g=Qe(hn(wo(Pt(h,this.epsilon)),wo(Pt(c,this.epsilon))),u),d=Pt(Qe(h,this.rho),Qe(sr(g),1-this.rho));c.assign(f),h.assign(d);let p=Pt(Qe(g,-this.learningRate),i);i.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Vn(this.accumulatedGrads.map(e=>e.variable)),Vn(this.accumulatedUpdates.map(e=>e.variable)))}getWeights(){return Te(this,null,function*(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[yield this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))})}setWeights(e){return Te(this,null,function*(){e=yield this.extractIterations(e);let r=e.length/2,o=!1;this.accumulatedGrads=e.slice(0,r).map(s=>({originalName:s.name,variable:s.tensor.variable(o)})),this.accumulatedUpdates=e.slice(r,r*2).map(s=>({originalName:s.name,variable:s.tensor.variable(o)}))})}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.rho,r.epsilon)}}return n.className="Adadelta",n})();zu(hI)});var dI,BP=D(()=>{"use strict";yt();gu();ns();bo();FN();jn();$p();di();kd();G0();dI=(()=>{class n extends ra{constructor(e,r=.1){super(),this.learningRate=e,this.initialAccumulatorValue=r,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,s)=>{let i=De.registeredVariables[o];this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${o}/accumulator`,variable:st(()=>Md(i.shape,this.initialAccumulatorValue).variable(!1))});let a=Array.isArray(e)?e[s].tensor:e[o];if(a==null)return;let u=this.accumulatedGrads[s].variable;st(()=>{let c=Pt(u,sr(a));u.assign(c);let h=Pt(Qe(hn(a,wo(Pt(c,De.backend.epsilon()))),-this.learningRate),i);i.assign(h)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Vn(this.accumulatedGrads.map(e=>e.variable))}getWeights(){return Te(this,null,function*(){return[yield this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))})}setWeights(e){return Te(this,null,function*(){e=yield this.extractIterations(e);let r=!1;this.accumulatedGrads=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))})}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,r){return new e(r.learningRate,r.initialAccumulatorValue)}}return n.className="Adagrad",n})();zu(dI)});var fI,zP=D(()=>{"use strict";yt();gu();ns();bo();jn();Wm();Go();$p();di();No();rs();kd();G0();fI=(()=>{class n extends ra{constructor(e,r,o,s=null){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=s,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],st(()=>{this.accBeta1=sn(r).variable(),this.accBeta2=sn(o).variable()}),s==null&&(this.epsilon=De.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);st(()=>{let o=un(1,this.accBeta1),s=un(1,this.accBeta2);r.forEach((i,a)=>{let u=De.registeredVariables[i],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${i}/m`,variable:st(()=>Mn(u).variable(c))}),this.accumulatedSecondMoment[a]==null&&(this.accumulatedSecondMoment[a]={originalName:`${i}/v`,variable:st(()=>Mn(u).variable(c))});let h=Array.isArray(e)?e[a].tensor:e[i];if(h==null)return;let f=this.accumulatedFirstMoment[a].variable,g=this.accumulatedSecondMoment[a].variable,d=Pt(Qe(f,this.beta1),Qe(h,1-this.beta1)),p=Pt(Qe(g,this.beta2),Qe(sr(h),1-this.beta2)),m=hn(d,o),y=hn(p,s);f.assign(d),g.assign(p);let v=Pt(Qe(hn(m,Pt(wo(y),this.epsilon)),-this.learningRate),u);u.assign(v)}),this.accBeta1.assign(Qe(this.accBeta1,this.beta1)),this.accBeta2.assign(Qe(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Vn(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Vn(this.accumulatedSecondMoment.map(e=>e.variable))}getWeights(){return Te(this,null,function*(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[yield this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))})}setWeights(e){return Te(this,null,function*(){e=yield this.extractIterations(e),st(()=>{this.accBeta1.assign($i(this.beta1,this.iterations_+1)),this.accBeta2.assign($i(this.beta2,this.iterations_+1))});let r=e.length/2,o=!1;this.accumulatedFirstMoment=e.slice(0,r).map(s=>({originalName:s.name,variable:s.tensor.variable(o)})),this.accumulatedSecondMoment=e.slice(r,r*2).map(s=>({originalName:s.name,variable:s.tensor.variable(o)}))})}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)}}return n.className="Adam",n})();zu(fI)});var mI,VP=D(()=>{"use strict";yt();gu();Z1();ns();bo();Cw();jn();Go();No();rs();kd();G0();mI=(()=>{class n extends ra{constructor(e,r,o,s=null,i=0){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=s,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],st(()=>{this.iteration=sn(0).variable(),this.accBeta1=sn(r).variable()}),s==null&&(this.epsilon=De.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);st(()=>{let o=un(1,this.accBeta1),s=hn(-this.learningRate,Pt(Qe(this.iteration,this.decay),1));r.forEach((i,a)=>{let u=De.registeredVariables[i],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${i}/m`,variable:Mn(u).variable(c)}),this.accumulatedWeightedInfNorm[a]==null&&(this.accumulatedWeightedInfNorm[a]={originalName:`${i}/v`,variable:Mn(u).variable(c)});let h=Array.isArray(e)?e[a].tensor:e[i];if(h==null)return;let f=this.accumulatedFirstMoment[a].variable,g=this.accumulatedWeightedInfNorm[a].variable,d=Pt(Qe(f,this.beta1),Qe(h,1-this.beta1)),p=Qe(g,this.beta2),m=$o(h),y=ea(p,m);f.assign(d),g.assign(y);let v=Pt(Qe(hn(s,o),hn(d,Pt(y,this.epsilon))),u);u.assign(v)}),this.iteration.assign(Pt(this.iteration,1)),this.accBeta1.assign(Qe(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Vn(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Vn(this.accumulatedWeightedInfNorm.map(e=>e.variable))}getWeights(){return Te(this,null,function*(){throw new Error("getWeights() is not implemented for Adamax yet.")})}setWeights(e){return Te(this,null,function*(){throw new Error("setWeights() is not implemented for Adamax yet.")})}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)}}return n.className="Adamax",n})();zu(mI)});var xx,Ek=D(()=>{"use strict";yt();gu();ns();jn();Go();kd();G0();xx=(()=>{class n extends ra{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,s)=>{let i=Array.isArray(e)?e[s].tensor:e[o];if(i==null)return;let a=De.registeredVariables[o];st(()=>{let u=Pt(Qe(this.c,i),a);a.assign(u)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Ko(sn(-e))}dispose(){this.c.dispose()}getWeights(){return Te(this,null,function*(){return[yield this.saveIterations()]})}setWeights(e){return Te(this,null,function*(){if(e=yield this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")})}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,r){return new e(r.learningRate)}}return n.className="SGD",n})();zu(xx)});var gI,jP=D(()=>{"use strict";yt();gu();ns();jn();Go();rs();kd();Ek();gI=(()=>{class n extends xx{constructor(e,r,o=!1){super(e),this.learningRate=e,this.momentum=r,this.useNesterov=o,this.accumulations=[],this.m=sn(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,s)=>{let i=De.registeredVariables[o];this.accumulations[s]==null&&(this.accumulations[s]={originalName:`${o}/momentum`,variable:st(()=>Mn(i).variable(!1))});let a=this.accumulations[s].variable,u=Array.isArray(e)?e[s].tensor:e[o];u!=null&&st(()=>{let c,h=Pt(Qe(this.m,a),u);this.useNesterov?c=Pt(Qe(this.c,Pt(u,Qe(h,this.m))),i):c=Pt(Qe(this.c,h),i),a.assign(h),i.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Vn(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}getWeights(){return Te(this,null,function*(){return[yield this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))})}setWeights(e){return Te(this,null,function*(){e=yield this.extractIterations(e);let r=!1;this.accumulations=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))})}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)}}return n.className="Momentum",n})();zu(gI)});var yI,UP=D(()=>{"use strict";yt();gu();ns();bo();jn();$p();di();No();rs();kd();G0();yI=(()=>{class n extends ra{constructor(e,r=.9,o=0,s=null,i=!1){if(super(),this.learningRate=e,this.decay=r,this.momentum=o,this.epsilon=s,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,s==null&&(this.epsilon=De.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,s)=>{let i=De.registeredVariables[o],a=!1;this.accumulatedMeanSquares[s]==null&&(this.accumulatedMeanSquares[s]={originalName:`${o}/rms`,variable:st(()=>Mn(i).variable(a))}),this.accumulatedMoments[s]==null&&(this.accumulatedMoments[s]={originalName:`${o}/momentum`,variable:st(()=>Mn(i).variable(a))}),this.accumulatedMeanGrads[s]==null&&this.centered&&(this.accumulatedMeanGrads[s]={originalName:`${o}/mg`,variable:st(()=>Mn(i).variable(a))});let u=Array.isArray(e)?e[s].tensor:e[o];if(u==null)return;let c=this.accumulatedMeanSquares[s].variable,h=this.accumulatedMoments[s].variable;st(()=>{let f=Pt(Qe(c,this.decay),Qe(sr(u),1-this.decay));if(this.centered){let g=this.accumulatedMeanGrads[s].variable,d=Pt(Qe(g,this.decay),Qe(u,1-this.decay)),p=hn(Qe(u,this.learningRate),wo(un(f,Pt(sr(d),this.epsilon)))),m=Pt(Qe(h,this.momentum),p);c.assign(f),g.assign(d),h.assign(m);let y=un(i,m);i.assign(y)}else{let g=Pt(Qe(c,this.decay),Qe(sr(u),1-this.decay)),d=Pt(Qe(h,this.momentum),hn(Qe(u,this.learningRate),wo(Pt(g,this.epsilon))));c.assign(g),h.assign(d);let p=un(i,d);i.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Vn(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Vn(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Vn(this.accumulatedMoments.map(e=>e.variable))}getWeights(){return Te(this,null,function*(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[yield this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))})}setWeights(e){return Te(this,null,function*(){e=yield this.extractIterations(e);let r=this.centered?e.length/3:e.length/2,o=!1;this.accumulatedMeanSquares=e.slice(0,r).map(s=>({originalName:s.name,variable:s.tensor.variable(o)})),this.accumulatedMoments=e.slice(r,r*2).map(s=>({originalName:s.name,variable:s.tensor.variable(o)})),this.centered&&(this.accumulatedMeanGrads=e.slice(r*2,r*3).map(s=>({originalName:s.name,variable:s.tensor.variable(o)})))})}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)}}return n.className="RMSProp",n})();zu(yI)});var Hd,tK=D(()=>{"use strict";LP();BP();zP();VP();jP();UP();Ek();Hd=class{static sgd(t){return new xx(t)}static momentum(t,e,r=!1){return new gI(t,e,r)}static rmsprop(t,e=.9,r=0,o=null,s=!1){return new yI(t,e,r,o,s)}static adam(t=.001,e=.9,r=.999,o=null){return new fI(t,e,r,o)}static adadelta(t=.001,e=.95,r=null){return new hI(t,e,r)}static adamax(t=.002,e=.9,r=.999,o=null,s=0){return new mI(t,e,r,o,s)}static adagrad(t,e=.1){return new dI(t,e)}}});var W0,nK=D(()=>{"use strict";tK();W0={sgd:Hd.sgd,momentum:Hd.momentum,adadelta:Hd.adadelta,adagrad:Hd.adagrad,rmsprop:Hd.rmsprop,adamax:Hd.adamax,adam:Hd.adam}});function qw(){return new Promise(n=>oDe(()=>n()))}var oDe,rK=D(()=>{"use strict";oDe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n()});function sDe(n,t){let e=n[0].length;n.forEach((o,s)=>{ke(o.length===e,()=>`Error in concat${e}D: rank of tensors[${s}] must be the same as the rank of the rest (${e})`)}),ke(t>=0&&t<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);let r=n[0];n.forEach((o,s)=>{for(let i=0;i<e;i++)ke(i===t||o[i]===r[i],()=>`Error in concat${e}D: Shape of tensors[${s}] (${o}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`)})}function iDe(n,t){let e=n[0].slice();for(let r=1;r<n.length;r++)e[t]+=n[r][t];return e}var oK=D(()=>{"use strict";Rt();});function aDe(n){return n<=Nk?n:Ov(n,Math.floor(Math.sqrt(n)))}var Nk,qP=D(()=>{"use strict";Rt();Nk=30});function uDe(n,t,e){let r=e*(typeof n=="number"?n:n[0]),o=t*(typeof n=="number"?n:n[1]);return[r,o]}var sK=D(()=>{"use strict";});function cDe(n,t,e,r=!0){let o=[];if(r)o=o.concat(t.slice(0)),o.push(n[0]/e),o=o.concat(n.slice(1));else{o=o.concat(n[0]);let s=t.length;for(let i=0;i<s;++i)o=o.concat([n[i+1]/t[i],t[i]]);o=o.concat(n.slice(s+1))}return o}function lDe(n,t,e=!0){let r=[];if(e){r.push(t);for(let o=t+1;o<n;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{let o=[],s=[];for(let i=1;i<n;++i)i>=t*2+1||i%2===1?s.push(i):o.push(i);r.push(...o),r.push(0),r.push(...s)}return r}function pDe(n,t,e,r=!0){let o=[];r?o.push(n[0]/e):o.push(n[0]*e);for(let s=1;s<n.length;++s)s<=t.length?r?o.push(t[s-1]*n[s]):o.push(n[s]/t[s-1]):o.push(n[s]);return o}function hDe(n,t){let e=[0];for(let r=0;r<t;++r)e.push(n[r][0]);return e}function dDe(n,t,e){let r=n.slice(0,1);for(let o=0;o<e;++o)r.push(n[o+1]-t[o][0]-t[o][1]);return r}var iK=D(()=>{"use strict";});var GP,WP,HP=D(()=>{"use strict";GP=1.7580993408473768,WP=1.0507009873554805});var fDe,mDe,gDe,yDe,xDe,bDe,aK=D(()=>{"use strict";fDe=.3275911,mDe=.254829592,gDe=-.284496736,yDe=1.421413741,xDe=-1.453152027,bDe=1.061405429});function vDe(...n){mt().getBool("IS_TEST")||console.warn(...n)}function wDe(...n){mt().getBool("IS_TEST")||console.log(...n)}var uK=D(()=>{"use strict";Ua();});function SDe(n,t){if(n.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${t.length}.`);let e=new Float32Array(n.length*2);for(let r=0;r<e.length;r+=2)e[r]=n[r/2],e[r+1]=t[r/2];return e}function CDe(n){let t=new Float32Array(n.length/2),e=new Float32Array(n.length/2);for(let r=0;r<n.length;r+=2)t[r/2]=n[r],e[r/2]=n[r+1];return{real:t,imag:e}}function IDe(n){let t=Math.ceil(n.length/4),e=new Float32Array(t),r=new Float32Array(t);for(let o=0;o<n.length;o+=4)e[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:e,imag:r}}function _De(n){let t=Math.floor(n.length/4),e=new Float32Array(t),r=new Float32Array(t);for(let o=2;o<n.length;o+=4)e[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:e,imag:r}}function TDe(n,t){let e=n[t*2],r=n[t*2+1];return{real:e,imag:r}}function EDe(n,t,e,r){n[r*2]=t,n[r*2+1]=e}function NDe(n,t){let e=new Float32Array(n/2),r=new Float32Array(n/2);for(let o=0;o<Math.ceil(n/2);o++){let s=(t?2:-2)*Math.PI*(o/n);e[o]=Math.cos(s),r[o]=Math.sin(s)}return{real:e,imag:r}}function kDe(n,t,e){let r=(e?2:-2)*Math.PI*(n/t),o=Math.cos(r),s=Math.sin(r);return{real:o,imag:s}}var cK=D(()=>{"use strict";});function DDe(n,t,e=0){let r=[];if(typeof t=="number")ke(n.shape[e]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(n.shape[e]/t);else{let o=t.reduce((i,a)=>(a===-1&&(i+=1),i),0);ke(o<=1,()=>"There should be only one negative value in split array.");let s=t.indexOf(-1);if(s!==-1){let i=t.reduce((a,u)=>u>0?a+u:a);t[s]=n.shape[e]-i}ke(n.shape[e]===t.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}var lK=D(()=>{"use strict";Rt()});var KP={};Br(KP,{collectGatherOpShapeInfo:()=>RDe,computeOutShape:()=>ODe,segOpComputeOptimalWindowSize:()=>ADe});function ADe(n,t){let e=!1,r;for(n<=Nk?(r=n,e=!0):r=Ov(n,Math.floor(Math.sqrt(n)));!e;)r>t||r===n?e=!0:r=Ov(n,r+1);return r}function ODe(n,t,e){let r=[],o=n.length;for(let s=0;s<o;s++)s!==t?r.push(n[s]):r.push(e);return r}function RDe(n,t,e,r){let o=t.shape.length,s=n.shape.length;if(r!==0&&(r<-o||r>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${r}`);if(r<0&&(r+=o),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${s}).`);if(e<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${e}).`);for(let f=0;f<r;++f)if(n.shape[f]!==t.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${t.shape[f]}.`);let i=n.shape[e],a=[],u=1,c=1,h=1;for(let f=0;f<r;++f)a.push(n.shape[f]),u*=n.shape[f];for(let f=r;f<e;f++)a.push(n.shape[f]),c*=n.shape[f];for(let f=r;f<o;f++)a.push(t.shape[f]);for(let f=e+1;f<s;f++)a.push(n.shape[f]),h*=n.shape[f];return{batchSize:u,sliceSize:h,outerSize:c,dimSize:i,outputShape:a}}var pK=D(()=>{"use strict";Rt();qP();});var Re={};Br(Re,{ERF_A1:()=>mDe,ERF_A2:()=>gDe,ERF_A3:()=>yDe,ERF_A4:()=>xDe,ERF_A5:()=>bDe,ERF_P:()=>fDe,PARALLELIZE_THRESHOLD:()=>Nk,SELU_SCALE:()=>WP,SELU_SCALEALPHA:()=>GP,applyActivation:()=>mx,assertAndGetBroadcastShape:()=>hr,assertAxesAreInnerMostDims:()=>pEe,assertParamsConsistent:()=>sDe,assignToTypedArray:()=>EDe,axesAreInnerMostDims:()=>BF,calculateShapes:()=>_q,castTensor:()=>MDe,combineLocations:()=>kG,complexWithEvenIndex:()=>IDe,complexWithOddIndex:()=>_De,computeConv2DInfo:()=>ex,computeConv3DInfo:()=>Kq,computeDefaultPad:()=>_F,computeDilation2DInfo:()=>U_e,computeOptimalWindowSize:()=>aDe,computeOutAndReduceShapes:()=>zF,computeOutShape:()=>iDe,computePool2DInfo:()=>IF,computePool3DInfo:()=>q_e,convertConv2DDataFormat:()=>Xq,eitherStridesOrDilationsAreOne:()=>cs,expandShapeToKeepDim:()=>Ml,exponent:()=>kDe,exponents:()=>NDe,fromStringArrayToUint8:()=>$De,fromUint8ToStringArray:()=>PDe,getAxesPermutation:()=>VF,getBroadcastDims:()=>ATe,getComplexWithIndex:()=>TDe,getFusedBiasGradient:()=>fx,getFusedDyActivation:()=>dx,getImageCenter:()=>uDe,getInnerMostAxes:()=>hEe,getPermuted:()=>lDe,getReductionAxes:()=>Lo,getReshaped:()=>cDe,getReshapedPermuted:()=>pDe,getSliceBeginCoords:()=>hDe,getSliceSize:()=>dDe,getUndoAxesPermutation:()=>QC,log:()=>wDe,mergeRealAndImagArrays:()=>SDe,prepareAndValidate:()=>Iq,prepareSplitSize:()=>DDe,reshapeTensor:()=>FDe,segment_util:()=>KP,shouldFuse:()=>gx,slice_util:()=>Ji,splitRealAndImagArrays:()=>CDe,tupleValuesAreOne:()=>Xc,upcastType:()=>ci,validateInput:()=>uN,validateUpdateShape:()=>pF,warn:()=>vDe});function MDe(n,t,e){if(t==="complex64"){if(n.dtype==="complex64")return n.clone();let r=so(n.shape),o=Wt(n,"float32"),s=e.complex(o,r);return r.dispose(),o.dispose(),s}if(!SM(n.dtype,t))return De.makeTensorFromDataId(n.dataId,n.shape,t);if(n.dtype==="complex64"){let r=e.real(n),o=Wt(r,t);return r.dispose(),o}if(t==="int32")return e.int(n);if(t==="bool"){let r=sn(0,n.dtype),o=e.notEqual(n,r);return r.dispose(),o}else throw new Error(`Error in Cast: failed to cast ${n.dtype} to ${t}`)}function FDe(n,t){return De.makeTensorFromDataId(n.dataId,t,n.dtype)}function PDe(n){try{return n.map(t=>Vv(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function $De(n){return n.map(t=>y0(t))}var hK=D(()=>{"use strict";yt();Mr();Go();sx();Rt();Mp();Xo();oK();qa();Uw();qP();hN();XE();sK();iK();lF();lN();HP();Uw();aK();uK();cK();lK();pK();});var oa={};Br(oa,{nonMaxSuppressionV3Impl:()=>Sk,nonMaxSuppressionV4Impl:()=>Ck,nonMaxSuppressionV5Impl:()=>Ik,whereImpl:()=>mk});var dK=D(()=>{"use strict";pI();cP();});var fK=D(()=>{"use strict";bq();Sq();Cq();lF();lN();hN();kd();us();Lq();Rt();Bq();LP();BP();zP();VP();jP();G0();UP();Ek();Ct();XE();Dn();Bp();nK();gu();MC();Gm();Ua();rK();hK();BM();dK();gM();Ze();});var kk,XP=D(()=>{"use strict";Ze();Mr();jn();Mw();kk={kernelName:Uf,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(n,Pl(Wt(e,"float32"),-1))}}}});var mK,gK=D(()=>{"use strict";Ze();Mr();bo();Ca();Go();$p();di();No();mK={kernelName:Oh,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>{let r=sr(Wt(e,"float32")),o=wo(un(sn(1),r));return Er(hn(n,o))}}}}});var yK,xK=D(()=>{"use strict";Ze();Mr();bo();$p();di();No();yK={kernelName:Rh,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>{let r=wo(un(sr(Wt(e,"float32")),1));return hn(n,r)}}}}});var bK,vK=D(()=>{"use strict";Ze();Xo();En();qs();bK={kernelName:Nl,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=hr(e.shape,r.shape);return{a:()=>{let a=n,u=Lo(e.shape,o);return u.length>0&&(a=vn(a,u)),nt(a,e.shape)},b:()=>{let a=n,u=Lo(r.shape,o);return u.length>0&&(a=vn(a,u)),nt(a,r.shape)}}}}});var wK,SK=D(()=>{"use strict";Ze();wK={kernelName:qf,saveAllInputs:!0,gradFunc:(n,t)=>{let e={};return t.forEach((r,o)=>{e[o]=()=>n.clone()}),e}}});var CK,IK=D(()=>{"use strict";Ze();rs();CK={kernelName:Gf,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Mn(e)}}}});var _K,TK=D(()=>{"use strict";Ze();rs();_K={kernelName:Wf,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Mn(e)}}}});var EK,NK=D(()=>{"use strict";Ze();Mr();bo();Go();$p();di();No();EK={kernelName:Mh,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>hn(n,wo(un(sn(1),sr(Wt(e,"float32")))))}}}});var kK,DK=D(()=>{"use strict";Ze();ns();Mr();bo();Go();$p();di();kK={kernelName:Fh,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>{let r=wo(Pt(sn(1),sr(Wt(e,"float32"))));return hn(n,r)}}}}});var AK,OK=D(()=>{"use strict";Ze();ns();Xo();bo();jn();Ca();En();di();qs();AK={kernelName:Lh,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=hr(e.shape,r.shape);return{a:()=>{let a=Pt(sr(e),sr(r)),u=Qe(n,hn(r,a)),c=Lo(e.shape,o);return c.length>0&&(u=vn(u,c)),nt(u,e.shape)},b:()=>{let a=Pt(sr(e),sr(r)),u=Er(Qe(n,hn(e,a))),c=Lo(r.shape,o);return c.length>0&&(u=vn(u,c)),nt(u,r.shape)}}}}});var RK,MK=D(()=>{"use strict";Ze();ns();Mr();bo();di();RK={kernelName:Ph,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>hn(n,Pt(sr(Wt(e,"float32")),1))}}}});var FK,PK=D(()=>{"use strict";Ze();Mr();bo();di();No();Go();FK={kernelName:$h,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>hn(n,un(sn(1),sr(Wt(e,"float32"))))}}}});function LDe(n,t,e,r,o=[1,1,1],s,i){let a=le(n,"dy","avgPool3dGrad"),u=le(t,"input","avgPool3dGrad"),c=a,h=u,f=!1;u.rank===4&&(f=!0,c=nt(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=nt(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),ke(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),ke(h.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),ke(cs(r,o),()=>`Error in avgPool3dGrad: Either strides or dilations must be 1. Got strides ${r} and dilations '${o}'`),i!=null&&ke(to(s),()=>`Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ${i} but got pad ${s}.`);let g={dy:c,input:h},d={filterSize:e,strides:r,dilations:o,pad:s,dimRoundingMode:i},p=De.runKernel(s1,g,d);return f?nt(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var $K,LK=D(()=>{"use strict";yt();Ze();ht();Rt();qa();at();En();$K=Se({avgPool3dGrad_:LDe})});var BK,zK=D(()=>{"use strict";Ze();LK();BK={kernelName:Kf,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{filterSize:o,strides:s,dilations:i,pad:a,dimRoundingMode:u}=e,c=i??[1,1,1];return{x:()=>$K(n,r,o,s,c,a,u)}}}});function BDe(n,t,e,r,o){let s=le(n,"dy","avgPoolGrad"),i=le(t,"input","avgPoolGrad");ke(i.rank===s.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${s.rank})`);let a=i,u=s,c=!1;i.rank===3&&(c=!0,a=nt(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=nt(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ke(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),ke(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);let h={dy:u,input:a},f={filterSize:e,strides:r,pad:o},g=De.runKernel(o1,h,f);return c?nt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var VK,jK=D(()=>{"use strict";yt();Ze();ht();Rt();at();En();VK=Se({avgPoolGrad_:BDe})});var UK,qK=D(()=>{"use strict";Ze();jK();UK={kernelName:Hf,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{filterSize:o,strides:s,pad:i}=e;return{x:()=>VK(n,r,o,s,i)}}}});var GK,WK=D(()=>{"use strict";Ze();Nd();GK={kernelName:Xf,inputsToSave:["a","b"],gradFunc:(n,t,e)=>{let[r,o]=t,{transposeA:s,transposeB:i}=e;return!s&&!i?{a:()=>Ir(n,o,!1,!0),b:()=>Ir(r,n,!0,!1)}:!s&&i?{a:()=>Ir(n,o,!1,!1),b:()=>Ir(n,r,!0,!1)}:s&&!i?{a:()=>Ir(o,n,!1,!0),b:()=>Ir(r,n,!1,!1)}:{a:()=>Ir(o,n,!0,!0),b:()=>Ir(n,r,!0,!0)}}}});var HK,KK=D(()=>{"use strict";Ze();nI();HK={kernelName:Yf,gradFunc:(n,t,e)=>{let{blockShape:r,crops:o}=e;return{x:()=>zd(n,r,o)}}}});var XK,YK=D(()=>{"use strict";Ze();qs();XK={kernelName:kM,gradFunc:(n,t,e)=>{let r=e,o=r.inputShape,s=r.shape,i=Array.from(s);for(let u=o.length-1;u>=0;u--)if(o[u]===s[u])i[u]=1;else if(o[u]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${s}].`);let a=[];for(let u=0;u<i.length;u++)i[u]>1&&a.push(u);return{x:()=>vn(n,a,!0)}}}});var QK,ZK=D(()=>{"use strict";Ze();QK={kernelName:Dp,gradFunc:n=>({x:()=>n.clone()})}});var JK,eX=D(()=>{"use strict";Ze();rs();JK={kernelName:Bh,gradFunc:n=>({x:()=>Mn(n)})}});var tX,nX=D(()=>{"use strict";Ze();k0();A0();rx();Dl();rs();tX={kernelName:zh,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{clipValueMin:o,clipValueMax:s}=e;return{x:()=>Yo(Ti(Sa(r,o),yu(r,s)),n,Mn(n))}}}});var rX,oX=D(()=>{"use strict";Ze();XP();rX={kernelName:Qf,inputsToSave:["x"],gradFunc:kk.gradFunc}});var sX,iX=D(()=>{"use strict";Ze();Rw();Rt();sX={kernelName:Zf,saveAllInputs:!0,gradFunc:(n,t,e)=>{let r=t.map(u=>u.shape),{axis:o}=e,s=ui(o,t[0].shape)[0],i=r.map(u=>u[s]);return fi(n,i,s).map(u=>()=>u)}}});var aX,uX=D(()=>{"use strict";Ze();yk();NN();qa();Rt();aX={kernelName:Jf,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{let[r,o]=t,{dilations:s,strides:i,pad:a,dataFormat:u}=e;return ke(Xc(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>cw(r.shape,n,o,i,a,u),filter:()=>jw(r,n,o.shape,i,a,u)}}}});var cX,lX=D(()=>{"use strict";Ze();tx();yk();cX={kernelName:em,inputsToSave:["dy","filter"],gradFunc:(n,t,e)=>{let[r,o]=t,{strides:s,pad:i,dataFormat:a,dimRoundingMode:u}=e;return{dy:()=>Wa(n,o,s,i,a,1,u),filter:()=>jw(n,r,o.shape,s,i,a,u)}}}});function zDe(n,t,e,r,o){let s=n;n.rank===4&&(s=nt(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=t;i.rank===4&&(i=nt(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),ke(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),ke(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),ke(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),ke(s.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${e[3]}.`),ke(i.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${e[4]}).`);let a={x:s,dy:i},u={strides:r,pad:o,filterShape:e};return De.runKernel(c1,a,u)}var pX,hX=D(()=>{"use strict";yt();Ze();Rt();at();En();pX=Se({conv3DBackpropFilter_:zDe})});var dX,fX=D(()=>{"use strict";Ze();hX();kF();qa();Rt();dX={kernelName:tm,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{let{dilations:r,strides:o,pad:s}=e;ke(Xc(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[i,a]=t;return{x:()=>kN(i.shape,n,a,o,s),filter:()=>pX(i,n,a.shape,o,s)}}}});var mX,gX=D(()=>{"use strict";Ze();Mr();jn();Ca();oP();mX={kernelName:Vh,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(Er(V0(Wt(e,"float32"))),n)}}}});var yX,xX=D(()=>{"use strict";Ze();Mr();jn();sP();yX={kernelName:jh,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(j0(Wt(e,"float32")),n)}}}});var bX,vX=D(()=>{"use strict";Ze();Mp();AN();w0();bX={kernelName:nm,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{axis:o,exclusive:s,reverse:i}=e;return{x:()=>{let a=VF([o],r.rank),u=E0(n,o,s,!i);return a!=null&&(u=Dr(u,a)),u}}}}});var wX,SX=D(()=>{"use strict";Ze();qa();DP();AP();Rt();wX={kernelName:rm,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{let{dilations:r,strides:o,pad:s,dimRoundingMode:i}=e,a=r??[1,1];ke(Xc(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);let[u,c]=t;return ke(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),ke(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),ke(u.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),ke(cs(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),i!=null&&ke(to(s),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${s}.`),{x:()=>bk(u.shape,n,c,o,s,r,i),filter:()=>xk(u,n,c.shape,o,s,r,i)}}}});var CX,IX=D(()=>{"use strict";yt();Ze();CX={kernelName:om,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{let[r,o]=t,s={x:r,filter:o,dy:n},i={x:r,filter:o,dy:n};return{x:()=>De.runKernel(Fv,s,e),filter:()=>De.runKernel(Pv,i,e)}}}});var _X,TX=D(()=>{"use strict";yt();Ze();_X={kernelName:qh,outputsToSave:[!0],gradFunc:(n,t)=>{let[e]=t,r={dy:n,y:e};return{x:()=>De.runKernel(y1,r)}}}});var EX,NX=D(()=>{"use strict";Ze();Rd();jn();Ca();di();EX={kernelName:Gh,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t,r=Qe(Us(Er(sr(e))),2/Math.sqrt(Math.PI));return{x:()=>Qe(n,r)}}}});var kX,DX=D(()=>{"use strict";Ze();jn();kX={kernelName:Wh,outputsToSave:[!0],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(n,e)}}}});var AX,OX=D(()=>{"use strict";Ze();En();AX={kernelName:sm,inputsToSave:["input"],gradFunc:(n,t)=>{let[e]=t;return{input:()=>nt(n,e.shape)}}}});var RX,MX=D(()=>{"use strict";Ze();Rd();jn();RX={kernelName:Hh,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(n,Us(e))}}}});var FX,PX=D(()=>{"use strict";Ze();rs();FX={kernelName:Kh,gradFunc:n=>({x:()=>Mn(n)})}});var $X,LX=D(()=>{"use strict";Ze();Xo();Mr();bo();jn();Ca();En();di();qs();$X={kernelName:Xh,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=hr(e.shape,r.shape);return{a:()=>{let a=hn(n,Wt(r,"float32")),u=Lo(e.shape,o);return u.length>0?nt(vn(a,u),e.shape):a},b:()=>{let a=Qe(n,Wt(e,"float32")),u=Lo(r.shape,o);u.length>0&&(a=nt(vn(a,u),r.shape));let c=sr(r);return Er(hn(a,Wt(c,"float32")))}}}}});var BX,zX=D(()=>{"use strict";Ze();ns();Xo();jn();En();tP();Go();No();qs();HC();BX={kernelName:im,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,t,e)=>{let{varianceEpsilon:r}=e,[o,s,i,a]=t,u=a??sn(1),c=Lo(s.shape,o.shape),h=[];if(s.rank===1){for(let O=0;O<o.shape.length-1;++O)h.push(o.shape[O]);h.push(1)}let f=un(o,s),g=Qe(n,u),d=B0(Pt(i,sn(r))),p=Qe(Qe(Qe(d,d),d),sn(-.5));return{x:()=>s.rank===1?nt(Qe(Qe(n,mc(nt(d,[1,1,1,s.shape[0]]),h)),u),o.shape):nt(Qe(Qe(n,d),u),o.shape),mean:()=>{let O=Qe(Qe(d,sn(-1)),g);return s.rank===1&&(O=vn(O,c)),nt(O,s.shape)},variance:()=>{let O=Qe(Qe(p,f),g);return s.rank===1&&(O=vn(O,c)),nt(O,s.shape)},scale:()=>{let O=Qe(f,d),S=Qe(n,O);return s.rank===1&&(S=vn(S,c)),nt(S,s.shape)},offset:()=>{let O=n;return s.rank===1&&(O=vn(O,c)),nt(O,s.shape)}}}}});function VX(n,t){let e=[];for(let r=n;r<t;++r)e.push(r);return e}function jX(n){let t=[];for(let e=0;e<n.length;++e)for(let r=0;r<n[e].length;++r)t.push(n[e][r]);return t}var UX,qX=D(()=>{"use strict";Ze();Mp();En();w0();dk();Rt();UX={kernelName:am,inputsToSave:["x","indices"],gradFunc:(n,t,e)=>{let[r,o]=t,{axis:s}=e,i=ui(s,r.shape)[0];return{x:()=>{let u=r.shape,c=o.size,h=u.slice(0,i),f=h.length,g=u.slice(s,u.length).slice(1),d=g.length,p=VX(0,f),m=VX(f+1,f+1+d),y=jX([h,[c],g]),v=nt(n,y),N=nt(o,[c]),T=jX([[f],p,m]),O=Dr(v,T),S=Bw(O,N,r.shape[i]),F=QC(T);return S=Dr(S,F),S},indices:()=>o}}}});var GX,WX=D(()=>{"use strict";Ze();rs();GX={kernelName:Yh,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t;return{a:()=>Mn(e),b:()=>Mn(r)}}}});var HX,KX=D(()=>{"use strict";Ze();Mr();HX={kernelName:um,gradFunc:n=>({x:()=>Wt(n,"float32")})}});var XX,YX=D(()=>{"use strict";Ze();rs();XX={kernelName:Qh,gradFunc:n=>({x:()=>Mn(n)})}});var QX,ZX=D(()=>{"use strict";Ze();rs();QX={kernelName:Zh,gradFunc:n=>({x:()=>Mn(n)})}});var JX,eY=D(()=>{"use strict";Ze();rs();JX={kernelName:Jh,gradFunc:n=>({x:()=>Mn(n)})}});var tY,nY=D(()=>{"use strict";Ze();Fd();jn();Dl();tY={kernelName:cm,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{alpha:o}=e,s=ks(r,0);return{x:()=>Yo(s,n,Qe(n,o))}}}});var rY,oY=D(()=>{"use strict";Ze();ns();bo();rY={kernelName:td,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>hn(n,Pt(e,1))}}}});var sY,iY=D(()=>{"use strict";Ze();Mr();bo();sY={kernelName:ed,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>hn(n,Wt(e,"float32"))}}}});var aY,uY=D(()=>{"use strict";Ze();Rd();jn();No();qs();aY={kernelName:DM,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,t,e)=>{let[r]=t,{axis:o}=e;return{logits:()=>{let i=Us(r);return un(n,Qe(vn(n,o,!0),i))}}}}});function VDe(n,t,e,r=5,o=1,s=1,i=.5){let a={x:n,y:t,dy:e},u={depthRadius:r,bias:o,alpha:s,beta:i};return De.runKernel(_1,a,u)}var cY,lY=D(()=>{"use strict";yt();Ze();at();cY=Se({localResponseNormalizationBackprop_:VDe})});var pY,hY=D(()=>{"use strict";Ze();lY();pY={kernelName:lm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{let[r,o]=t,{depthRadius:s,bias:i,alpha:a,beta:u}=e;return{x:()=>cY(r,o,n,s,i,a,u)}}}});function Dk(n,t,e,r){return t.rank<e.rank&&(t=nt(t,Ml(t.shape,r))),n.rank<e.rank&&(n=nt(n,Ml(n.shape,r))),{x:()=>Qe(n,Wt(Ha(e,t),n.dtype))}}var YP=D(()=>{"use strict";Mp();Mr();fw();jn();En();});var QP,dY=D(()=>{"use strict";Ze();Rt();YP();QP={kernelName:pm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{let r=e,{reductionIndices:o}=r,s=t[0],i=t[1],a=ui(o,s.shape),u=Dk(n,i,s,a);return{x:()=>u.x()}}}});var fY,mY=D(()=>{"use strict";Ze();Mr();k0();XC();jn();fY={kernelName:nd,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t;return{a:()=>Qe(n,Wt(Sa(e,r),"float32")),b:()=>Qe(n,Wt($d(e,r),"float32"))}}}});function jDe(n,t,e,r,o,s=[1,1,1],i,a){let u=le(n,"dy","maxPool3dGrad"),c=le(t,"input","maxPool3dGrad"),h=le(e,"output","maxPool3dGrad"),f=u,g=c,d=h,p=!1;c.rank===4&&(p=!0,f=nt(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),g=nt(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=nt(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]])),ke(f.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${f.rank}.`),ke(g.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${g.rank}.`),ke(d.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`),ke(cs(o,s),()=>`Error in maxPool3dGrad: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`),a!=null&&ke(to(i),()=>`Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ${a} but got pad ${i}.`);let m={dy:f,input:g,output:d},y={filterSize:r,strides:o,dilations:s,pad:i,dimRoundingMode:a},v=De.runKernel(E1,m,y);return p?nt(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}var gY,yY=D(()=>{"use strict";yt();Ze();ht();Rt();qa();at();En();gY=Se({maxPool3dGrad_:jDe})});var xY,bY=D(()=>{"use strict";Ze();yY();xY={kernelName:dm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{let[r,o]=t,{filterSize:s,strides:i,dilations:a,pad:u,dimRoundingMode:c}=e,h=a??[1,1,1];return{x:()=>gY(n,r,o,s,i,h,u,c)}}}});function UDe(n,t,e,r,o,s,i){let a=le(n,"dy","maxPoolGrad"),u=le(t,"input","maxPoolGrad"),c=le(e,"output","maxPoolGrad");ke(u.rank===a.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${a.rank})`),ke(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),ke(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),i!=null&&ke(to(s),()=>`Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ${i} but got pad ${s}.`);let h={dy:a,input:u,output:c},f={filterSize:r,strides:o,pad:s,dimRoundingMode:i};return De.runKernel(T1,h,f)}var vY,wY=D(()=>{"use strict";yt();Ze();ht();Rt();at();vY=Se({maxPoolGrad_:UDe})});var SY,CY=D(()=>{"use strict";Ze();wY();SY={kernelName:hm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{let[r,o]=t,{filterSize:s,strides:i,pad:a}=e;return{x:()=>vY(n,r,o,s,i,a)}}}});var IY,_Y=D(()=>{"use strict";Ze();Mp();bo();jn();_w();En();Rt();IY={kernelName:fm,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{axis:o}=e,s=ui(o,r.shape),a=zF(r.shape,s)[1],u=xo(a);return{x:()=>{let h=r.shape.slice();s.forEach(d=>{h[d]=1});let f=nt(n,h);return hn(Qe(f,ta(r.shape,"float32")),u)}}}}});var TY,EY=D(()=>{"use strict";Ze();Rt();YP();TY={kernelName:mm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{let r=e,{axis:o}=r,[s,i]=t,a=ui(o,s.shape),u=Dk(n,i,s,a);return{x:()=>u.x()}}}});var NY,kY=D(()=>{"use strict";Ze();Mr();Fd();A0();jn();NY={kernelName:rd,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t;return{a:()=>Qe(n,Wt(yu(e,r),"float32")),b:()=>Qe(n,Wt(ks(e,r),"float32"))}}}});var DY,AY=D(()=>{"use strict";Ze();Vu();DY={kernelName:gm,inputsToSave:["x"],gradFunc:(n,t,e)=>{let r=t[0],{paddings:o}=e,s=o.map(i=>i[0]);return{x:()=>Jn(n,s,r.shape)}}}});var OY,RY=D(()=>{"use strict";Ze();Xo();bo();PN();jn();Ca();En();qs();OY={kernelName:od,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=hr(e.shape,r.shape);return{a:()=>{let a=Lo(e.shape,o);return a.length>0?nt(vn(n,a),e.shape):n},b:()=>{let a=Qe(n,Er(Ol(hn(e,r)))),u=Lo(r.shape,o);return u.length>0?nt(vn(a,u),r.shape):a}}}}});var MY,FY=D(()=>{"use strict";Ze();Xo();Mr();jn();En();qs();MY={kernelName:sd,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=hr(e.shape,r.shape);return{a:()=>{let a=Qe(n,Wt(r,"float32")),u=Lo(e.shape,o);return u.length>0?nt(vn(a,u),e.shape):a},b:()=>{let a=Qe(n,Wt(e,"float32")),u=Lo(r.shape,o);return u.length>0?nt(vn(a,u),r.shape):a}}}}});var PY,$Y=D(()=>{"use strict";Ze();Ca();PY={kernelName:ym,gradFunc:n=>({x:()=>Er(n)})}});var LY,BY=D(()=>{"use strict";Ze();sx();LY={kernelName:bm,inputsToSave:["indices"],gradFunc:(n,t)=>{let e=t[0];return{indices:()=>so(e.shape,"float32")}}}});var zY,VY=D(()=>{"use strict";Ze();rs();zY={kernelName:xm,gradFunc:n=>({x:()=>Mn(n)})}});var jY,UY=D(()=>{"use strict";Ze();zw();jY={kernelName:vm,saveAllInputs:!0,gradFunc:(n,t,e)=>{let{axis:r}=e;return mi(n,r).map(s=>()=>s)}}});var ZP,qY=D(()=>{"use strict";Ze();Vu();ZP={kernelName:wm,inputsToSave:["x"],gradFunc:(n,t,e)=>{let r=t[0],{paddings:o}=e,s=o.map(i=>i[0]);return{x:()=>Jn(n,s,r.shape)}}}});var GY,WY=D(()=>{"use strict";Ze();Xo();Mr();Fd();bw();jn();Wm();En();Go();No();qs();Dl();rs();GY={kernelName:id,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,t)=>{let[e,r,o]=t,s=e,i=r,a=hr(s.shape,i.shape);return{a:()=>{let h=Wt(i,"float32"),f=Qe(n,Qe(h,$i(s,un(h,sn(1))))),g=Lo(s.shape,a);return g.length>0&&(f=vn(f,g)),nt(f,s.shape)},b:()=>{let h=ks(s,0),f=Yo(h,pi(s),Mn(s)),g=Qe(n,Qe(o,f)),d=Lo(i.shape,a);return d.length>0&&(g=vn(g,d)),nt(g,i.shape)}}}}});var HY,KY=D(()=>{"use strict";Ze();Xo();Fd();jn();En();qs();Dl();rs();HY={kernelName:Sm,inputsToSave:["x","alpha"],gradFunc:(n,t)=>{let[e,r]=t,o=ks(e,0);return{x:()=>Yo(o,n,Qe(n,r)),alpha:()=>{let s=Yo(o,Mn(n),Qe(n,e)),i=Lo(r.shape,n.shape);return i.length>0&&(s=vn(s,i)),nt(s,r.shape)}}}}});var XY,YY=D(()=>{"use strict";Ze();Xo();Mr();bo();jn();Ca();En();di();qs();XY={kernelName:Uh,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=hr(e.shape,r.shape);return{a:()=>{let a=hn(n,Wt(r,"float32")),u=Lo(e.shape,o);return u.length>0?nt(vn(a,u),e.shape):a},b:()=>{let a=Qe(n,Wt(e,"float32")),u=Lo(r.shape,o);u.length>0&&(a=nt(vn(a,u),r.shape));let c=sr(r);return Er(hn(a,Wt(c,"float32")))}}}}});var QY,ZY=D(()=>{"use strict";Ze();bo();Ca();di();QY={kernelName:ad,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>hn(n,Er(sr(e)))}}}});var JY,eQ=D(()=>{"use strict";Ze();Mr();A0();jn();Mw();JY={kernelName:cd,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t,r=Qe(yu(e,6),Pl(e));return{x:()=>Qe(n,Wt(r,"float32"))}}}});var tQ,nQ=D(()=>{"use strict";Ze();Mr();jn();Mw();tQ={kernelName:ud,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(n,Wt(Pl(e),"float32"))}}}});var rQ,oQ=D(()=>{"use strict";Ze();En();rQ={kernelName:Cm,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>nt(n,e.shape)}}}});var sQ,iQ=D(()=>{"use strict";yt();Ze();sQ={kernelName:_m,inputsToSave:["images"],gradFunc:(n,t,e)=>{let[r]=t,o={dy:n,images:r};return{images:()=>De.runKernel($1,o,e)}}}});var aQ,uQ=D(()=>{"use strict";yt();Ze();aQ={kernelName:Im,inputsToSave:["images"],gradFunc:(n,t,e)=>{let[r]=t,o={dy:n,images:r};return{images:()=>De.runKernel(P1,o,e)}}}});var cQ,lQ=D(()=>{"use strict";Ze();Km();Rt();cQ={kernelName:Tm,gradFunc:(n,t,e)=>{let{dims:r}=e,o=ui(r,n.shape);return{x:()=>Ds(n,o)}}}});var pQ,hQ=D(()=>{"use strict";Ze();rs();pQ={kernelName:ld,gradFunc:n=>({x:()=>Mn(n)})}});var dQ,fQ=D(()=>{"use strict";Ze();bo();jn();Ca();Wm();dQ={kernelName:pd,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Er(hn(n,Qe($i(e,1.5),2)))}}}});var mQ,gQ=D(()=>{"use strict";Ze();Mr();ZC();jn();rs();mQ={kernelName:Em,inputsToSave:["condition"],gradFunc:(n,t)=>{let[e]=t;return{condition:()=>Wt(Mn(e),"float32"),t:()=>Qe(n,Wt(e,n.dtype)),e:()=>Qe(n,Wt(Ld(e),n.dtype))}}}});var yQ,xQ=D(()=>{"use strict";Ze();Mr();Rd();Fd();jn();Go();HP();Dl();yQ={kernelName:hd,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>{let r=ks(e,sn(0)),o=sn(GP),s=sn(WP),i=Qe(n,s),a=Qe(Qe(n,o),Us(Wt(e,"float32")));return Yo(r,i,a)}}}}});var bQ,vQ=D(()=>{"use strict";Ze();jn();Go();No();bQ={kernelName:gd,outputsToSave:[!0],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(n,Qe(e,un(sn(1),e)))}}}});var wQ,SQ=D(()=>{"use strict";Ze();rs();wQ={kernelName:md,gradFunc:n=>({x:()=>Mn(n)})}});var CQ,IQ=D(()=>{"use strict";Ze();Mr();DN();jn();CQ={kernelName:dd,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(Od(Wt(e,"float32")),n)}}}});var _Q,TQ=D(()=>{"use strict";Ze();Mr();DF();jn();_Q={kernelName:fd,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(T0(Wt(e,"float32")),n)}}}});var EQ,NQ=D(()=>{"use strict";Ze();P0();hN();EQ={kernelName:Nm,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{begin:o,size:s}=e,i=r.shape,[a,u]=hF(r,o,s),c=[];for(let h=0;h<n.rank;h++)c.push([a[h],i[h]-a[h]-u[h]]);return{x:()=>Ia(n,c)}}}});var kQ,DQ=D(()=>{"use strict";Ze();jn();No();qs();kQ={kernelName:Om,outputsToSave:[!0],gradFunc:(n,t,e)=>{let[r]=t,{dim:o}=e,s=!0,i=Qe(n,r);return{logits:()=>un(i,Qe(vn(i,[o],s),r))}}}});var AQ,OQ=D(()=>{"use strict";Ze();jn();qC();AQ={kernelName:yd,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(n,Ga(e))}}}});var JP,RQ=D(()=>{"use strict";Ze();GC();JP={kernelName:Dm,gradFunc:(n,t,e)=>{let{blockShape:r,paddings:o}=e;return{x:()=>Ad(n,r,o)}}}});var e5,MQ=D(()=>{"use strict";Ze();dc();e5={kernelName:Am,gradFunc:(n,t,e)=>{let{axis:r}=e;return{x:()=>$r(n,r)}}}});var FQ,PQ=D(()=>{"use strict";Ze();Mr();bo();jn();$p();FQ={kernelName:xd,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>hn(n,Qe(wo(Wt(e,"float32")),2))}}}});var $Q,LQ=D(()=>{"use strict";Ze();Mr();jn();$Q={kernelName:B1,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(n,Qe(Wt(e,"float32"),2))}}}});var BQ,zQ=D(()=>{"use strict";Ze();jn();Go();No();BQ={kernelName:bd,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=sn(2);return{a:()=>Qe(n,Qe(o,un(e,r))),b:()=>Qe(n,Qe(o,un(r,e)))}}}});var VQ,jQ=D(()=>{"use strict";Ze();rs();VQ={kernelName:Cd,gradFunc:n=>({x:()=>Mn(n)})}});var UQ,qQ=D(()=>{"use strict";Ze();Xo();Ca();En();qs();UQ={kernelName:vd,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=hr(e.shape,r.shape);return{a:()=>{let a=n,u=Lo(e.shape,o);return u.length>0&&(a=vn(a,u)),nt(a,e.shape)},b:()=>{let a=n,u=Lo(r.shape,o);return u.length>0&&(a=vn(a,u)),nt(Er(a),r.shape)}}}}});var GQ,WQ=D(()=>{"use strict";Ze();jn();_w();En();Rt();GQ={kernelName:km,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,o=r.shape.slice(),{axis:s}=e;ui(s,r.shape).forEach(c=>{o[c]=1});let a=nt(n,o),u=Qe(a,ta(r.shape,"float32"));return{x:()=>u}}}});var HQ,KQ=D(()=>{"use strict";Ze();DN();bo();di();HQ={kernelName:wd,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>hn(n,sr(Od(e)))}}}});var XQ,YQ=D(()=>{"use strict";Ze();jn();Go();di();No();XQ={kernelName:Sd,outputsToSave:[!0],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Qe(un(sn(1),sr(e)),n)}}}});var QQ,ZQ=D(()=>{"use strict";Ze();ns();Vu();rs();QQ={kernelName:Ap,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{reps:o}=e;return{x:()=>{let i=Mn(r);if(r.rank===1)for(let a=0;a<o[0];++a)i=Pt(i,Jn(n,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<o[0];++a)for(let u=0;u<o[1];++u)i=Pt(i,Jn(n,[a*r.shape[0],u*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<o[0];++a)for(let u=0;u<o[1];++u)for(let c=0;c<o[2];++c)i=Pt(i,Jn(n,[a*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<o[0];++a)for(let u=0;u<o[1];++u)for(let c=0;c<o[2];++c)for(let h=0;h<o[3];++h)i=Pt(i,Jn(n,[a*r.shape[0],u*r.shape[1],c*r.shape[2],h*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return i}}}}});var JQ,eZ=D(()=>{"use strict";Ze();Mp();w0();JQ={kernelName:Rm,gradFunc:(n,t,e)=>{let r=e,{perm:o}=r,s=QC(o);return{x:()=>Dr(n,s)}}}});var tZ,nZ=D(()=>{"use strict";Ze();lx();tZ={kernelName:Mm,gradFunc:(n,t,e)=>{let r=e,{axis:o}=r;return{value:()=>xs(n,o)}}}});function qDe(n,t){let e=ea(t,Mn(t)),r=Zc(n,e),o=Sa(t,sn(0,"int32")),s=r.rank-o.rank;for(let a=0;a<s;++a)o=Pi(o,a+1);o=Ti(o,ta(r.shape,"bool"));let i=Mn(r);return Yo(o,r,i)}var rZ,oZ=D(()=>{"use strict";Ze();WC();KC();k0();rx();Cw();_w();Go();Dl();rs();rZ={kernelName:Fm,inputsToSave:["segmentIds"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>qDe(n,e)}}}});var sZ,iZ=D(()=>{"use strict";Ze();rs();sZ={kernelName:Pm,gradFunc:n=>({x:()=>Mn(n)})}});var GDe,aZ=D(()=>{"use strict";XP();gK();xK();vK();SK();IK();TK();NK();DK();OK();MK();PK();zK();qK();WK();KK();YK();ZK();eX();nX();oX();iX();uX();lX();fX();gX();xX();vX();SX();IX();TX();NX();DX();OX();MX();PX();LX();zX();qX();WX();KX();YX();ZX();eY();nY();oY();iY();uY();hY();dY();mY();bY();CY();_Y();EY();kY();AY();RY();FY();$Y();BY();VY();UY();qY();WY();KY();YY();ZY();eQ();nQ();oQ();iQ();uQ();lQ();hQ();fQ();gQ();xQ();vQ();SQ();IQ();TQ();NQ();DQ();OQ();RQ();MQ();PQ();LQ();zQ();jQ();qQ();WQ();KQ();YQ();ZQ();eZ();nZ();oZ();iZ();MC();GDe=[kk,mK,yK,bK,wK,CK,_K,EK,kK,AK,RK,FK,BK,UK,GK,HK,XK,QK,JK,tX,rX,sX,cX,aX,dX,mX,yX,bX,wX,CX,XY,_X,EX,kX,AX,RX,$X,FX,BX,UX,GX,HX,XX,QX,JX,tY,rY,sY,aY,pY,QP,QP,fY,xY,SY,IY,TY,NY,DY,OY,MY,PY,LY,zY,jY,ZP,ZP,GY,HY,QY,JY,tQ,rQ,sQ,aQ,cQ,pQ,dQ,mQ,yQ,bQ,wQ,CQ,_Q,EQ,kQ,AQ,JP,JP,e5,e5,FQ,BQ,$Q,VQ,UQ,GQ,HQ,XQ,QQ,JQ,tZ,rZ,sZ];for(let n of GDe)AM(n)});var uZ=D(()=>{"use strict";Dn();Ct();Me.prototype.abs=function(){return this.throwIfDisposed(),$o(this)}});var cZ=D(()=>{"use strict";Dn();Ct();Me.prototype.acos=function(){return this.throwIfDisposed(),Qv(this)}});var lZ=D(()=>{"use strict";Dn();Ct();Me.prototype.acosh=function(){return this.throwIfDisposed(),Zv(this)}});var pZ=D(()=>{"use strict";Dn();Ct();Me.prototype.addStrict=function(n){return this.throwIfDisposed(),yP(this,n)}});var hZ=D(()=>{"use strict";ns();Ct();Me.prototype.add=function(n){return this.throwIfDisposed(),Pt(this,n)}});var dZ=D(()=>{"use strict";xF();Ct();Me.prototype.all=function(n,t){return this.throwIfDisposed(),C0(this,n,t)}});var fZ=D(()=>{"use strict";bF();Ct();Me.prototype.any=function(n,t){return this.throwIfDisposed(),jm(this,n,t)}});var mZ=D(()=>{"use strict";vF();Ct();Me.prototype.argMax=function(n){return this.throwIfDisposed(),Um(this,n)}});var gZ=D(()=>{"use strict";wF();Ct();Me.prototype.argMin=function(n){return this.throwIfDisposed(),Jv(this,n)}});var yZ=D(()=>{"use strict";En();Ct();Rt();Me.prototype.asScalar=function(){return this.throwIfDisposed(),ke(this.size===1,()=>"The array must have only 1 element."),nt(this,[])}});var xZ=D(()=>{"use strict";Dn();Ct();Me.prototype.asType=function(n){return this.throwIfDisposed(),Wt(this,n)}});var bZ=D(()=>{"use strict";En();Ct();Me.prototype.as1D=function(){return this.throwIfDisposed(),nt(this,[this.size])}});var vZ=D(()=>{"use strict";En();Ct();Me.prototype.as2D=function(n,t){return this.throwIfDisposed(),nt(this,[n,t])}});var wZ=D(()=>{"use strict";En();Ct();Me.prototype.as3D=function(n,t,e){return this.throwIfDisposed(),nt(this,[n,t,e])}});var SZ=D(()=>{"use strict";En();Ct();Me.prototype.as4D=function(n,t,e,r){return this.throwIfDisposed(),nt(this,[n,t,e,r])}});var CZ=D(()=>{"use strict";En();Ct();Me.prototype.as5D=function(n,t,e,r,o){return this.throwIfDisposed(),nt(this,[n,t,e,r,o])}});var IZ=D(()=>{"use strict";Dn();Ct();Me.prototype.asin=function(){return this.throwIfDisposed(),ew(this)}});var _Z=D(()=>{"use strict";Dn();Ct();Me.prototype.asinh=function(){return this.throwIfDisposed(),tw(this)}});var TZ=D(()=>{"use strict";Dn();Ct();Me.prototype.atan=function(){return this.throwIfDisposed(),nw(this)}});var EZ=D(()=>{"use strict";SF();Ct();Me.prototype.atan2=function(n){return this.throwIfDisposed(),rw(this,n)}});var NZ=D(()=>{"use strict";Dn();Ct();Me.prototype.atanh=function(){return this.throwIfDisposed(),ow(this)}});var kZ=D(()=>{"use strict";xN();Ct();Me.prototype.avgPool=function(n,t,e,r){return this.throwIfDisposed(),Dd(this,n,t,e,r)}});var DZ=D(()=>{"use strict";GC();Ct();Me.prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),Ad(this,n,t)}});var AZ=D(()=>{"use strict";aw();Ct();Me.prototype.batchNorm=function(n,t,e,r,o){return this.throwIfDisposed(),Qc(this,n,t,e,r,o)}});var OZ=D(()=>{"use strict";CN();Ct();Me.prototype.broadcastTo=function(n){return this.throwIfDisposed(),qm(this,n)}});var RZ=D(()=>{"use strict";Dn();Ct();Me.prototype.cast=function(n){return this.throwIfDisposed(),Wt(this,n)}});var MZ=D(()=>{"use strict";Dn();Ct();Me.prototype.ceil=function(){return this.throwIfDisposed(),uw(this)}});var FZ=D(()=>{"use strict";Dn();Ct();Me.prototype.clipByValue=function(n,t){return this.throwIfDisposed(),li(this,n,t)}});var PZ=D(()=>{"use strict";dc();Ct();Me.prototype.concat=function(n,t){return this.throwIfDisposed(),n instanceof Me&&(n=[n]),$r([this,...n],t)}});var $Z=D(()=>{"use strict";EF();Ct();Me.prototype.conv1d=function(n,t,e,r,o,s){return this.throwIfDisposed(),I0(this,n,t,e,r,o,s)}});var LZ=D(()=>{"use strict";NF();Ct();Me.prototype.conv2dTranspose=function(n,t,e,r,o){return this.throwIfDisposed(),_0(this,n,t,e,r,o)}});var BZ=D(()=>{"use strict";tx();Ct();Me.prototype.conv2d=function(n,t,e,r,o,s){return this.throwIfDisposed(),Wa(this,n,t,e,r,o,s)}});var zZ=D(()=>{"use strict";Dn();Ct();Me.prototype.cos=function(){return this.throwIfDisposed(),Od(this)}});var VZ=D(()=>{"use strict";Dn();Ct();Me.prototype.cosh=function(){return this.throwIfDisposed(),T0(this)}});var jZ=D(()=>{"use strict";AN();Ct();Me.prototype.cumsum=function(n,t,e){return this.throwIfDisposed(),E0(this,n,t,e)}});var UZ=D(()=>{"use strict";AF();Ct();Me.prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),pw(this,n,t)}});var qZ=D(()=>{"use strict";gu();hw();Ct();Me.prototype.depthwiseConv2D=function(n,t,e,r,o,s){return Ns("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),fc(this,n,t,e,r,o,s)}});var GZ=D(()=>{"use strict";hw();Ct();Me.prototype.depthwiseConv2d=function(n,t,e,r,o,s){return this.throwIfDisposed(),fc(this,n,t,e,r,o,s)}});var WZ=D(()=>{"use strict";OF();Ct();Me.prototype.dilation2d=function(n,t,e,r,o){return this.throwIfDisposed(),dw(this,n,t,e,r,o)}});var HZ=D(()=>{"use strict";RF();Ct();Me.prototype.divNoNan=function(n){return this.throwIfDisposed(),mw(this,n)}});var KZ=D(()=>{"use strict";Dn();Ct();Me.prototype.divStrict=function(n){return this.throwIfDisposed(),xP(this,n)}});var XZ=D(()=>{"use strict";bo();Ct();Me.prototype.div=function(n){return this.throwIfDisposed(),hn(this,n)}});var YZ=D(()=>{"use strict";MF();Ct();Me.prototype.dot=function(n){return this.throwIfDisposed(),RN(this,n)}});var QZ=D(()=>{"use strict";MN();Ct();Me.prototype.elu=function(){return this.throwIfDisposed(),Al(this)}});var ZZ=D(()=>{"use strict";Dn();Ct();Me.prototype.equalStrict=function(n){return this.throwIfDisposed(),pP(this,n)}});var JZ=D(()=>{"use strict";fw();Ct();Me.prototype.equal=function(n){return this.throwIfDisposed(),Ha(this,n)}});var eJ=D(()=>{"use strict";Dn();Ct();Me.prototype.erf=function(){return this.throwIfDisposed(),gw(this)}});var tJ=D(()=>{"use strict";Dn();Ct();Me.prototype.exp=function(){return this.throwIfDisposed(),Us(this)}});var nJ=D(()=>{"use strict";WC();Ct();Me.prototype.expandDims=function(n){return this.throwIfDisposed(),Pi(this,n)}});var rJ=D(()=>{"use strict";Dn();Ct();Me.prototype.expm1=function(){return this.throwIfDisposed(),yw(this)}});var oJ=D(()=>{"use strict";Dn();Ct();Me.prototype.fft=function(){return this.throwIfDisposed(),Ud(this)}});var sJ=D(()=>{"use strict";En();Ct();Me.prototype.flatten=function(){return this.throwIfDisposed(),nt(this,[this.size])}});var iJ=D(()=>{"use strict";Dn();Ct();Me.prototype.floor=function(){return this.throwIfDisposed(),Ol(this)}});var aJ=D(()=>{"use strict";mN();Ct();Me.prototype.floorDiv=function(n){return this.throwIfDisposed(),S0(this,n)}});var uJ=D(()=>{"use strict";KC();Ct();Me.prototype.gather=function(n,t){return this.throwIfDisposed(),Zc(this,n,t)}});var cJ=D(()=>{"use strict";Dn();Ct();Me.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),hP(this,n)}});var lJ=D(()=>{"use strict";k0();Ct();Me.prototype.greaterEqual=function(n){return this.throwIfDisposed(),Sa(this,n)}});var pJ=D(()=>{"use strict";Dn();Ct();Me.prototype.greaterStrict=function(n){return this.throwIfDisposed(),dP(this,n)}});var hJ=D(()=>{"use strict";Fd();Ct();Me.prototype.greater=function(n){return this.throwIfDisposed(),ks(this,n)}});var dJ=D(()=>{"use strict";Dn();Ct();Me.prototype.ifft=function(){return this.throwIfDisposed(),Pp(this)}});var fJ=D(()=>{"use strict";Dn();Ct();Me.prototype.irfft=function(){return this.throwIfDisposed(),U0(this)}});var mJ=D(()=>{"use strict";Dn();Ct();Me.prototype.isFinite=function(){return this.throwIfDisposed(),LN(this)}});var gJ=D(()=>{"use strict";Dn();Ct();Me.prototype.isInf=function(){return this.throwIfDisposed(),BN(this)}});var yJ=D(()=>{"use strict";Dn();Ct();Me.prototype.isNaN=function(){return this.throwIfDisposed(),zN(this)}});var xJ=D(()=>{"use strict";VN();Ct();Me.prototype.leakyRelu=function(n){return this.throwIfDisposed(),Pd(this,n)}});var bJ=D(()=>{"use strict";Dn();Ct();Me.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),fP(this,n)}});var vJ=D(()=>{"use strict";A0();Ct();Me.prototype.lessEqual=function(n){return this.throwIfDisposed(),yu(this,n)}});var wJ=D(()=>{"use strict";Dn();Ct();Me.prototype.lessStrict=function(n){return this.throwIfDisposed(),mP(this,n)}});var SJ=D(()=>{"use strict";XC();Ct();Me.prototype.less=function(n){return this.throwIfDisposed(),$d(this,n)}});var CJ=D(()=>{"use strict";PF();Ct();Me.prototype.localResponseNormalization=function(n,t,e,r){return this.throwIfDisposed(),xw(this,n,t,e,r)}});var IJ=D(()=>{"use strict";Dn();Ct();Me.prototype.logSigmoid=function(){return this.throwIfDisposed(),qN(this)}});var _J=D(()=>{"use strict";Dn();Ct();Me.prototype.logSoftmax=function(n){return this.throwIfDisposed(),R0(this,n)}});var TJ=D(()=>{"use strict";GN();Ct();Me.prototype.logSumExp=function(n,t){return this.throwIfDisposed(),ww(this,n,t)}});var EJ=D(()=>{"use strict";Dn();Ct();Me.prototype.log=function(){return this.throwIfDisposed(),pi(this)}});var NJ=D(()=>{"use strict";Dn();Ct();Me.prototype.log1p=function(){return this.throwIfDisposed(),O0(this)}});var kJ=D(()=>{"use strict";rx();Ct();Me.prototype.logicalAnd=function(n){return this.throwIfDisposed(),Ti(this,n)}});var DJ=D(()=>{"use strict";ZC();Ct();Me.prototype.logicalNot=function(){return this.throwIfDisposed(),Ld(this)}});var AJ=D(()=>{"use strict";WN();Ct();Me.prototype.logicalOr=function(n){return this.throwIfDisposed(),M0(this,n)}});var OJ=D(()=>{"use strict";UF();Ct();Me.prototype.logicalXor=function(n){return this.throwIfDisposed(),HN(this,n)}});var RJ=D(()=>{"use strict";Nd();Ct();Me.prototype.matMul=function(n,t,e){return this.throwIfDisposed(),Ir(this,n,t,e)}});var MJ=D(()=>{"use strict";KN();Ct();Me.prototype.maxPool=function(n,t,e,r){return this.throwIfDisposed(),Bd(this,n,t,e,r)}});var FJ=D(()=>{"use strict";vw();Ct();Me.prototype.max=function(n,t){return this.throwIfDisposed(),hi(this,n,t)}});var PJ=D(()=>{"use strict";Dn();Ct();Me.prototype.maximumStrict=function(n){return this.throwIfDisposed(),bP(this,n)}});var $J=D(()=>{"use strict";Cw();Ct();Me.prototype.maximum=function(n){return this.throwIfDisposed(),ea(this,n)}});var LJ=D(()=>{"use strict";JC();Ct();Me.prototype.mean=function(n,t){return this.throwIfDisposed(),vo(this,n,t)}});var BJ=D(()=>{"use strict";YN();Ct();Me.prototype.min=function(n,t){return this.throwIfDisposed(),Fp(this,n,t)}});var zJ=D(()=>{"use strict";Dn();Ct();Me.prototype.minimumStrict=function(n){return this.throwIfDisposed(),vP(this,n)}});var VJ=D(()=>{"use strict";eI();Ct();Me.prototype.minimum=function(n){return this.throwIfDisposed(),gc(this,n)}});var jJ=D(()=>{"use strict";qF();Ct();Me.prototype.mirrorPad=function(n,t){return this.throwIfDisposed(),Iw(this,n,t)}});var UJ=D(()=>{"use strict";Dn();Ct();Me.prototype.modStrict=function(n){return this.throwIfDisposed(),wP(this,n)}});var qJ=D(()=>{"use strict";QN();Ct();Me.prototype.mod=function(n){return this.throwIfDisposed(),F0(this,n)}});var GJ=D(()=>{"use strict";Dn();Ct();Me.prototype.mulStrict=function(n){return this.throwIfDisposed(),SP(this,n)}});var WJ=D(()=>{"use strict";jn();Ct();Me.prototype.mul=function(n){return this.throwIfDisposed(),Qe(this,n)}});var HJ=D(()=>{"use strict";Dn();Ct();Me.prototype.neg=function(){return this.throwIfDisposed(),Er(this)}});var KJ=D(()=>{"use strict";Dn();Ct();Me.prototype.norm=function(n,t,e){return this.throwIfDisposed(),hx(this,n,t,e)}});var XJ=D(()=>{"use strict";Dn();Ct();Me.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),gP(this,n)}});var YJ=D(()=>{"use strict";tI();Ct();Me.prototype.notEqual=function(n){return this.throwIfDisposed(),ju(this,n)}});var QJ=D(()=>{"use strict";iN();Ct();Me.prototype.oneHot=function(n,t=1,e=0){return this.throwIfDisposed(),kl(this,n,t,e)}});var ZJ=D(()=>{"use strict";Dn();Ct();Me.prototype.onesLike=function(){return this.throwIfDisposed(),ei(this)}});var JJ=D(()=>{"use strict";P0();Ct();Me.prototype.pad=function(n,t){return this.throwIfDisposed(),Ia(this,n,t)}});var eee=D(()=>{"use strict";GF();Ct();Me.prototype.pool=function(n,t,e,r,o){return this.throwIfDisposed(),JN(this,n,t,e,r,o)}});var tee=D(()=>{"use strict";Dn();Ct();Me.prototype.powStrict=function(n){return this.throwIfDisposed(),CP(this,n)}});var nee=D(()=>{"use strict";Wm();Ct();Me.prototype.pow=function(n){return this.throwIfDisposed(),$i(this,n)}});var ree=D(()=>{"use strict";ek();Ct();Me.prototype.prelu=function(n){return this.throwIfDisposed(),Vd(this,n)}});var oee=D(()=>{"use strict";WF();Ct();Me.prototype.prod=function(n,t){return this.throwIfDisposed(),$0(this,n,t)}});var see=D(()=>{"use strict";Dn();Ct();Me.prototype.reciprocal=function(){return this.throwIfDisposed(),Tw(this)}});var iee=D(()=>{"use strict";Ew();Ct();Me.prototype.relu=function(){return this.throwIfDisposed(),na(this)}});var aee=D(()=>{"use strict";ak();Ct();Me.prototype.relu6=function(){return this.throwIfDisposed(),L0(this)}});var uee=D(()=>{"use strict";En();Ct();Me.prototype.reshapeAs=function(n){return this.throwIfDisposed(),nt(this,n.shape)}});var cee=D(()=>{"use strict";En();Ct();Me.prototype.reshape=function(n){return this.throwIfDisposed(),nt(this,n)}});var lee=D(()=>{"use strict";FP();Ct();Me.prototype.resizeBilinear=function(n,t,e){return this.throwIfDisposed(),_k(this,n,t,e)}});var pee=D(()=>{"use strict";PP();Ct();Me.prototype.resizeNearestNeighbor=function(n,t,e){return this.throwIfDisposed(),Tk(this,n,t,e)}});var hee=D(()=>{"use strict";Km();Ct();Me.prototype.reverse=function(n){return this.throwIfDisposed(),Ds(this,n)}});var dee=D(()=>{"use strict";Dn();Ct();Me.prototype.rfft=function(){return this.throwIfDisposed(),qd(this)}});var fee=D(()=>{"use strict";Dn();Ct();Me.prototype.round=function(){return this.throwIfDisposed(),Nw(this)}});var mee=D(()=>{"use strict";Dn();Ct();Me.prototype.rsqrt=function(){return this.throwIfDisposed(),B0(this)}});var gee=D(()=>{"use strict";nP();Ct();Me.prototype.selu=function(){return this.throwIfDisposed(),z0(this)}});var yee=D(()=>{"use strict";rP();Ct();Me.prototype.separableConv2d=function(n,t,e,r,o,s){return this.throwIfDisposed(),kw(this,n,t,e,r,o,s)}});var xee=D(()=>{"use strict";Dn();Ct();Me.prototype.sigmoid=function(){return this.throwIfDisposed(),Ga(this)}});var bee=D(()=>{"use strict";Dn();Ct();Me.prototype.sign=function(){return this.throwIfDisposed(),Dw(this)}});var vee=D(()=>{"use strict";Dn();Ct();Me.prototype.sin=function(){return this.throwIfDisposed(),V0(this)}});var wee=D(()=>{"use strict";Dn();Ct();Me.prototype.sinh=function(){return this.throwIfDisposed(),j0(this)}});var See=D(()=>{"use strict";Dn();Ct();Me.prototype.slice=function(n,t){return this.throwIfDisposed(),Jn(this,n,t)}});var Cee=D(()=>{"use strict";Dn();Ct();Me.prototype.softmax=function(n){return this.throwIfDisposed(),jd(this,n)}});var Iee=D(()=>{"use strict";Dn();Ct();Me.prototype.softplus=function(){return this.throwIfDisposed(),Rl(this)}});var _ee=D(()=>{"use strict";nI();Ct();Me.prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),zd(this,n,t)}});var Tee=D(()=>{"use strict";Rw();Ct();Me.prototype.split=function(n,t){return this.throwIfDisposed(),fi(this,n,t)}});var Eee=D(()=>{"use strict";Dn();Ct();Me.prototype.sqrt=function(){return this.throwIfDisposed(),wo(this)}});var Nee=D(()=>{"use strict";Dn();Ct();Me.prototype.square=function(){return this.throwIfDisposed(),sr(this)}});var kee=D(()=>{"use strict";iI();Ct();Me.prototype.squaredDifference=function(n){return this.throwIfDisposed(),Gd(this,n)}});var Dee=D(()=>{"use strict";Dn();Ct();Me.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),IP(this,n)}});var Aee=D(()=>{"use strict";aI();Ct();Me.prototype.squeeze=function(n){return this.throwIfDisposed(),Uu(this,n)}});var Oee=D(()=>{"use strict";lx();Ct();Me.prototype.stack=function(n,t){this.throwIfDisposed();let e=n instanceof Me?[this,n]:[this,...n];return xs(e,t)}});var Ree=D(()=>{"use strict";Dn();Ct();Me.prototype.step=function(n){return this.throwIfDisposed(),Pl(this,n)}});var Mee=D(()=>{"use strict";Dn();Ct();Me.prototype.stridedSlice=function(n,t,e,r,o,s,i,a){return this.throwIfDisposed(),Fw(this,n,t,e,r,o,s,i,a)}});var Fee=D(()=>{"use strict";Dn();Ct();Me.prototype.subStrict=function(n){return this.throwIfDisposed(),_P(this,n)}});var Pee=D(()=>{"use strict";No();Ct();Me.prototype.sub=function(n){return this.throwIfDisposed(),un(this,n)}});var $ee=D(()=>{"use strict";qs();Ct();Me.prototype.sum=function(n,t){return this.throwIfDisposed(),vn(this,n,t)}});var Lee=D(()=>{"use strict";Dn();Ct();Me.prototype.tan=function(){return this.throwIfDisposed(),Pw(this)}});var Bee=D(()=>{"use strict";Dn();Ct();Me.prototype.tanh=function(){return this.throwIfDisposed(),Rp(this)}});var zee=D(()=>{"use strict";HC();Ct();Me.prototype.tile=function(n){return this.throwIfDisposed(),mc(this,n)}});var Vee=D(()=>{"use strict";Dn();Ct();Me.prototype.toBool=function(){return this.throwIfDisposed(),Wt(this,"bool")}});var jee=D(()=>{"use strict";Dn();Ct();Me.prototype.toFloat=function(){return this.throwIfDisposed(),Wt(this,"float32")}});var Uee=D(()=>{"use strict";Dn();Ct();Me.prototype.toInt=function(){return this.throwIfDisposed(),Wt(this,"int32")}});var qee=D(()=>{"use strict";aP();Ct();Me.prototype.topk=function(n,t){return this.throwIfDisposed(),Lw(this,n,t)}});var Gee=D(()=>{"use strict";w0();Ct();Me.prototype.transpose=function(n){return this.throwIfDisposed(),Dr(this,n)}});var Wee=D(()=>{"use strict";uP();Ct();Me.prototype.unique=function(n){return this.throwIfDisposed(),px(this,n)}});var Hee=D(()=>{"use strict";dk();Ct();Me.prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),Bw(this,n,t)}});var Kee=D(()=>{"use strict";zw();Ct();Me.prototype.unstack=function(n){return this.throwIfDisposed(),mi(this,n)}});var Xee=D(()=>{"use strict";Dl();Ct();Me.prototype.where=function(n,t){return this.throwIfDisposed(),Yo(n,this,t)}});var Yee=D(()=>{"use strict";Dn();Ct();Me.prototype.zerosLike=function(){return this.throwIfDisposed(),Mn(this)}});var Qee=D(()=>{"use strict";uZ();cZ();lZ();pZ();hZ();dZ();fZ();mZ();gZ();yZ();xZ();bZ();vZ();wZ();SZ();CZ();IZ();_Z();TZ();EZ();NZ();kZ();DZ();AZ();OZ();RZ();MZ();FZ();PZ();$Z();LZ();BZ();zZ();VZ();jZ();UZ();qZ();GZ();WZ();HZ();KZ();XZ();YZ();QZ();ZZ();JZ();eJ();tJ();nJ();rJ();oJ();sJ();iJ();aJ();uJ();cJ();lJ();pJ();hJ();dJ();fJ();mJ();gJ();yJ();xJ();bJ();vJ();wJ();SJ();CJ();IJ();_J();TJ();EJ();NJ();kJ();DJ();AJ();OJ();RJ();MJ();FJ();PJ();$J();LJ();BJ();zJ();VJ();jJ();UJ();qJ();GJ();WJ();HJ();KJ();XJ();YJ();QJ();ZJ();JJ();eee();tee();nee();ree();oee();see();iee();aee();uee();cee();lee();pee();hee();dee();fee();mee();gee();yee();xee();bee();vee();wee();See();Cee();Iee();_ee();Tee();Eee();Nee();kee();Dee();Aee();Oee();Ree();Mee();Fee();Pee();$ee();Lee();Bee();zee();Vee();jee();Uee();qee();Gee();Wee();Hee();Kee();Xee();Yee();});var ve=D(()=>{"use strict";iq();fK();aZ();Qee();});function ti(){return t5==null&&(t5=yF().epsilon()),t5}function xu(){return"channelsLast"}var t5,Xm=D(()=>{"use strict";ve();});var el,bu,rt,Bn,Ak,So=D(()=>{"use strict";el=class n extends Error{constructor(t){super(t),Object.setPrototypeOf(this,n.prototype)}},bu=class n extends Error{constructor(t){super(t),Object.setPrototypeOf(this,n.prototype)}},rt=class n extends Error{constructor(t){super(t),Object.setPrototypeOf(this,n.prototype)}},Bn=class n extends Error{constructor(t){super(t),Object.setPrototypeOf(this,n.prototype)}},Ak=class n extends Error{constructor(t){super(t),Object.setPrototypeOf(this,n.prototype)}}});function Bl(n,t){if(Array.isArray(n)){let e=[];for(let r=0;r<t;r++)e=e.concat(n);return e}else{let e=new Array(t);return e.fill(n),e}}function tl(n,t){if(!n)throw new Ak(t)}function r5(n,t){let e=0;for(let r of n)r===t&&e++;return e}function Li(n){return n.length===1?n[0]:n}function ko(n){return Array.isArray(n)?n:[n]}function zl(n){let e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function Ym(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(t,e)=>e.toUpperCase())}function Gw(n){if(n==null)return null;let t={};return t.className=n.getClassName(),t.config=n.getConfig(),t}function n5(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(t=>n5(t));else{let t=Object.keys(n);for(let e of t){let r=n[e];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?n[e]=r.value:n5(r))}}}function Kd(n,t={},e={},r="object",o=!1){if(typeof n=="string"){let s=n,i;if(s in e)i=e[s];else if(s in Ll)i=Ll[s];else if(i=t[s],i==null)throw new rt(`Unknown ${r}: ${n}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{let s=n;if(s.className==null||s.config==null)throw new rt(`${r}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);let i=s.className,a,u;if(i in e?[a,u]=e[i]:i in Ll?[a,u]=Ll.className:i in t&&([a,u]=t[i]),a==null)throw new rt(`Unknown ${r}: ${i}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(u!=null){let c={};for(let d of Object.keys(Ll))c[d]=Ll[d];for(let d of Object.keys(e))c[d]=e[d];let h=s.config;h.customObjects=c;let f=Object.assign({},Ll);for(let d of Object.keys(e))Ll[d]=e[d];n5(s.config);let g=u(a,s.config,e,o);return Ll=Object.assign({},f),g}else{let c=Object.assign({},Ll);for(let f of Object.keys(e))Ll[f]=e[f];let h=new a(s.config);return Ll=Object.assign({},c),h}}}function WDe(n,t){return n<t?-1:n>t?1:0}function xI(n,t){return-1*WDe(n,t)}function Vl(n){if(n==null)return n;let t=[];for(let e of n)t.indexOf(e)===-1&&t.push(e);return t}function Zee(n){if(n==null)throw new rt(`Invalid value in obj: ${JSON.stringify(n)}`);for(let t in n)if(n.hasOwnProperty(t))return!1;return!0}function Xd(n,t,e){if(e!=null&&n.indexOf(e)<0)throw new rt(`${e} is not a valid ${t}.  Valid values are ${n} or null/undefined.`)}function Ok(n,t,e=0,r=1/0){return tl(e>=0),tl(r>=e),Array.isArray(n)&&n.length>=e&&n.length<=r&&n.every(o=>typeof o===t)}function Os(n,t){Array.isArray(n)?(Y.assert(n.length>0,()=>`${t} is unexpectedly an empty array.`),n.forEach((e,r)=>Os(e,`element ${r+1} of ${t}`))):Y.assert(Number.isInteger(n)&&n>0,()=>`Expected ${t} to be a positive integer, but got ${Jee(n)}.`)}function Jee(n){return n===null?"null":Array.isArray(n)?"["+n.map(t=>Jee(t)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function ete(n,t){let e=Y.now(),r;return(...s)=>{let i=Y.now();return i-e<t||(e=i,r=n(...s)),r}}function Rk(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}var Ll,ws=D(()=>{"use strict";ve();So();Ll={}});function o5(n,t){return st(()=>wo(vn(Qe(n,n),t,!0)))}function ls(n){return Gw(n)}function nte(n,t={}){return Kd(n,Lt.SerializationMap.getMap().classNameMap,t,"constraint")}function ps(n){if(n==null)return null;if(typeof n=="string"){let e={className:n in tte?tte[n]:n,config:{}};return nte(e)}else return n instanceof bx?n:nte(n)}var bx,s5,i5,a5,u5,tte,Qm=D(()=>{"use strict";ve();ve();Xm();ws();bx=class extends Lt.Serializable{getConfig(){return{}}},s5=(()=>{class n extends bx{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return st(()=>{let r=o5(e,this.axis),o=li(r,0,this.maxValue);return Qe(e,hn(o,Pt(ti(),r)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}return n.className="MaxNorm",n})();Lt.registerClass(s5);i5=(()=>{class n extends bx{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return st(()=>hn(e,Pt(ti(),o5(e,this.axis))))}getConfig(){return{axis:this.axis}}}return n.className="UnitNorm",n})();Lt.registerClass(i5);a5=(()=>{class n extends bx{apply(e){return na(e)}}return n.className="NonNeg",n})();Lt.registerClass(a5);u5=(()=>{class n extends bx{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return st(()=>{let r=o5(e,this.axis),o=Pt(Qe(this.rate,li(r,this.minValue,this.maxValue)),Qe(1-this.rate,r));return Qe(e,hn(o,Pt(ti(),r)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}return n.className="MinMaxNorm",n})();Lt.registerClass(u5);tte={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"}});var c5={};Br(c5,{maxNorm:()=>HDe,minMaxNorm:()=>YDe,nonNeg:()=>XDe,unitNorm:()=>KDe});function HDe(n){return new s5(n)}function KDe(n){return new i5(n)}function XDe(){return new a5}function YDe(n){return new u5(n)}var rte=D(()=>{"use strict";Qm();});var ote,ste,ite,ate,ute,l5=D(()=>{"use strict";ote=["channelsFirst","channelsLast"],ste=["nearest","bilinear"],ite=["valid","same","causal"],ate=["max","avg"],ute=["sum","mul","concat","ave"]});function os(n){Xd(ote,"DataFormat",n)}function lte(n){Xd(ste,"InterpolationFormat",n)}function vu(n){Xd(ite,"PaddingMode",n)}function p5(n){Xd(ate,"PoolMode",n)}function jp(n,t){bI.push(n);try{let e=t();return bI.pop(),e}catch(e){throw bI.pop(),e}}function QDe(){return bI.length===0?"":bI.join(cte)+cte}function Mk(n){if(!pte(n))throw new Error("Not a valid tensor name: '"+n+"'");return QDe()+n}function Fk(n){if(!pte(n))throw new Error("Not a valid tensor name: '"+n+"'");Ww.has(n)||Ww.set(n,0);let t=Ww.get(n);if(Ww.set(n,Ww.get(n)+1),t>0){let e=`${n}_${t}`;return Ww.set(e,1),e}else return n}function pte(n){return!!n.match(ZDe)}var Ww,bI,cte,ZDe,jl=D(()=>{"use strict";l5();ws();Ww=new Map;bI=[],cte="/";ZDe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/)});function hte(n){return n===parseInt(n.toString(),10)}function Ul(n,t,e){t==null&&(t=0),e==null&&(e=n.length);let r=1;for(let o=t;o<e;++o)r*=n[o];return r}function dte(n){return n=Array.isArray(n)?new Float32Array(n):n,bs(n)}function vx(n){return Fp(dte(n)).dataSync()[0]}function Up(n){return hi(dte(n)).dataSync()[0]}function Xa(n,t){if(t<n)throw new rt(`end (${t}) < begin (${n}) is forbidden.`);let e=[];for(let r=n;r<t;++r)e.push(r);return e}var Yd=D(()=>{"use strict";ve();ve();So();});function Jm(n,t){return n.asType(t)}function eg(n,t=-1){let e=n.shape.slice();return t<0&&(t=e.length+t+1),e.splice(t,0,1),n.reshape(e)}function fte(n,t){return st(()=>{if(n.shape.length!==2)throw new rt(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);let e=eg(n,1);return $k(e,[1,t,1])})}function mte(n){let t=[Ul(n.shape)];return n.reshape(t)}function gte(n){if(n.rank<=1)throw new rt(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);let t=[n.shape[0],Ul(n.shape,1)];return n.reshape(t)}function Zm(n,t,e){return st(()=>{switch(n.rank){case 1:return Aw(n,t,e);case 2:return sI(n,[t,0],[e,n.shape[1]]);case 3:return Ow(n,[t,0,0],[e,n.shape[1],n.shape[2]]);case 4:return cx(n,[t,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Jn(n,[t,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Jn(n,[t,0,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new rt(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function h5(n,t,e){return st(()=>{switch(n.rank){case 1:return Aw(n,t,e);case 2:return sI(n,[0,t],[n.shape[0],e]);case 3:return Ow(n,[0,0,t],[n.shape[0],n.shape[1],e]);case 4:return cx(n,[0,0,0,t],[n.shape[0],n.shape[1],n.shape[2],e]);default:throw new rt(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function vI(n,t,e,r){return st(()=>{switch(n.rank){case 1:return Aw(n,t,e);case 2:switch(r){case 1:return Zm(n,t,e);case 2:return h5(n,t,e);default:throw new rt(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return Zm(n,t,e);case 2:return Ow(n,[0,t,0],[n.shape[0],e,n.shape[2]]);case 3:return h5(n,t,e);default:throw new rt(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return Zm(n,t,e);case 2:return cx(n,[0,t,0,0],[n.shape[0],e,n.shape[2],n.shape[3]]);case 3:return cx(n,[0,0,t,0],[n.shape[0],n.shape[1],e,n.shape[3]]);case 4:return h5(n,t,e);default:throw new rt(`The axis is not within the rank of the tensor ${r}`)}default:throw new rt(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Hw(n,t=-1){let e;return t<0&&(e=n[0].rank,e!==0?t=e:t=0),t===n[0].rank&&(t=-1),$r(n,t)}function f5(n,t){switch(n.rank){case 1:return IN([n,t]);case 2:return _N([n,t],0);case 3:return TN([n,t],0);case 4:return EN([n,t],0);default:throw new rt(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function $k(n,t){if(Array.isArray(t)||(t=[t]),n.rank!==t.length)throw new rt(`The length of input n (${t.length}) does not match the number of dimensions in input x (${n.rank})`);return mc(n,t)}function Kw(n,t=0,e=1,r,o){return oI(n,t,e,r,o)}function ql(n,t,e,r){if(n.rank<2||t.rank<2)throw new Bn(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${t.shape}`);if(t.rank>=3){let o=n.shape.slice(-1)[0],s=t.shape.slice(-2)[0];if(o!==s)throw new Bn(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${t.shape}`)}if(n.rank===2&&t.rank===2)return Jc.matMul({a:n,b:t,transposeA:!1,transposeB:!1,bias:r?d5(n.rank,r,xu()):null,activation:e});{let o=n.shape.slice(),s=o.pop();n=n.reshape([-1,s]);let i=t.shape.slice(),a=i.pop(),u=i.pop(),c=[...i,a],h=Array.from({length:t.rank},(p,m)=>m===0?t.rank-2:m<=t.rank-2?m-1:m);t=t.transpose(h).reshape([u,-1]);let f=[...o,...c];return Jc.matMul({a:n,b:t,transposeA:!1,transposeB:!1,bias:r?d5(n.rank,r,xu()):null,activation:e}).reshape(f)}}function Lk(n,t,e){return st(()=>(Array.isArray(t)?t=bs(t,"int32"):t=t.toInt(),Zc(n,t,e)))}function wx(n){return Qe(n,n)}function d5(n,t,e){let r=t.shape;if(t.rank!==1&&t.rank!==n)throw new rt(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${n}`);if(n===5){if(e==="channelsFirst")return r.length===1?t.reshape([1,r[0],1,1,1]):t.reshape([1,r[3],r[0],r[1],r[2]]);if(e==="channelsLast")return r.length===1?t.reshape([1,1,1,1,r[0]]):t.reshape([1].concat(r))}else if(n===4){if(e==="channelsFirst")return r.length===1?t.reshape([1,r[0],1,1]):t.reshape([1,r[2],r[0],r[1]]);if(e==="channelsLast")return r.length===1?t.reshape([1,1,1,r[0]]):t.reshape([1].concat(r))}else if(n===3){if(e==="channelsFirst")return r.length===1?t.reshape([1,r[0],1]):t.reshape([1,r[1],r[0]]);if(e==="channelsLast")return r.length===1?t.reshape([1,1,r[0]]):t.reshape([1].concat(r))}else if(n<3)return t;throw new rt(`Unsupported input rank by biasAdd: ${t.rank}`)}function qu(n,t,e){return st(()=>(e==null&&(e=xu()),os(e),n.add(d5(n.rank,t,e))))}function yte(n,t=1){if(t!==1)throw new Bn(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return Al(n)}function xte(n){return st(()=>hn(n,$o(n).add(1)))}function Bk(n,t,e,r){return st(()=>NP(n,t,e,r))}function bte(n){return st(()=>{let t=Pt(.5,Qe(.2,n));return li(t,0,1)})}function H0(n,t,e=!1){return e?n():t()}var sa=D(()=>{"use strict";ve();ve();jl();So();Yd();Xm();});var vte,wte,Ste=D(()=>{"use strict";vte=["fanIn","fanOut","fanAvg"],wte=["normal","uniform","truncatedNormal"]});function JDe(n){Xd(vte,"FanMode",n)}function eAe(n){Xd(wte,"Distribution",n)}function tAe(n,t="channelsLast"){let e,r;if(os(t),n.length===2)e=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(t==="channelsFirst"){let o=Ul(n,2);e=n[1]*o,r=n[0]*o}else if(t==="channelsLast"){let o=Ul(n,0,n.length-2);e=n[n.length-2]*o,r=n[n.length-1]*o}}else{let o=Ul(n);e=Math.sqrt(o),r=Math.sqrt(o)}return[e,r]}function Ite(n,t={}){return Kd(n,Lt.SerializationMap.getMap().classNameMap,t,"initializer")}function Bo(n){return Gw(n)}function Co(n){if(typeof n=="string"){let t=n in Cte?Cte[n]:n;if(t==="GlorotNormal")return new Vk;if(t==="GlorotUniform")return new zk;if(t==="HeNormal")return new jk;if(t==="HeUniform")return new Uk;if(t==="LeCunNormal")return new qk;if(t==="LeCunUniform")return new Gk;{let e={};return e.className=t,e.config={},Ite(e)}}else return n instanceof Su?n:Ite(n)}var Su,m5,wI,g5,y5,x5,b5,v5,Gu,zk,Vk,jk,Uk,qk,Gk,w5,Cte,qp=D(()=>{"use strict";ve();sa();jl();So();Ste();ws();Yd();Su=class extends Lt.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},m5=(()=>{class n extends Su{apply(e,r){return so(e,r)}}return n.className="Zeros",n})();Lt.registerClass(m5);wI=(()=>{class n extends Su{apply(e,r){return ta(e,r)}}return n.className="Ones",n})();Lt.registerClass(wI);g5=(()=>{class n extends Su{constructor(e){if(super(),typeof e!="object")throw new rt(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new rt(`config must have value set but got ${e}`);this.value=e.value}apply(e,r){return st(()=>Qe(sn(this.value),ta(e,r)))}getConfig(){return{value:this.value}}}return n.className="Constant",n})();Lt.registerClass(g5);y5=(()=>{class n extends Su{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,r){return Fl(e,this.minval,this.maxval,r)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}return n.className="RandomUniform",n})();Lt.registerClass(y5);x5=(()=>{class n extends Su{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Bn(`randomNormal does not support dType ${r}.`);return Kw(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return n.className="RandomNormal",n})();Lt.registerClass(x5);b5=(()=>{class n extends Su{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Bn(`truncatedNormal does not support dType ${r}.`);return q0(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return n.className="TruncatedNormal",n})();Lt.registerClass(b5);v5=(()=>{class n extends Su{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,r){return st(()=>{if(e.length!==2||e[0]!==e[1])throw new rt("Identity matrix initializer can only be used for 2D square matrices.");return Qe(this.gain,nx(e[0]))})}getConfig(){return{gain:this.gain}}}return n.className="Identity",n})();Lt.registerClass(v5);Gu=(()=>{class n extends Su{constructor(e){if(super(),e.scale<0)throw new rt(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,JDe(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,eAe(this.distribution),this.seed=e.seed}apply(e,r){let o=tAe(e),s=o[0],i=o[1],a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,s):this.mode==="fanOut"?a/=Math.max(1,i):a/=Math.max(1,(s+i)/2),this.distribution==="normal"){let u=Math.sqrt(a);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Bn(`${this.getClassName()} does not support dType ${r}.`);return q0(e,0,u,r,this.seed)}else{let u=Math.sqrt(3*a);return Fl(e,-u,u,r)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}return n.className="VarianceScaling",n})();Lt.registerClass(Gu);zk=(()=>{class n extends Gu{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Gu.className}}return n.className="GlorotUniform",n})();Lt.registerClass(zk);Vk=(()=>{class n extends Gu{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Gu.className}}return n.className="GlorotNormal",n})();Lt.registerClass(Vk);jk=(()=>{class n extends Gu{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Gu.className}}return n.className="HeNormal",n})();Lt.registerClass(jk);Uk=(()=>{class n extends Gu{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Gu.className}}return n.className="HeUniform",n})();Lt.registerClass(Uk);qk=(()=>{class n extends Gu{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Gu.className}}return n.className="LeCunNormal",n})();Lt.registerClass(qk);Gk=(()=>{class n extends Gu{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Gu.className}}return n.className="LeCunNormal",n})();Lt.registerClass(Gk);w5=(()=>{class n extends Su{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,this.seed!=null)throw new Bn("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,r){return st(()=>{if(e.length<2)throw new Bn("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);let o=e[0]>e[1]?[e[1],e[0]]:e,s=Kw(o,0,1,"float32"),i=$P.gramSchmidt(s);return e[0]>e[1]&&(i=i.transpose()),Qe(this.gain,i)})}getConfig(){return{gain:this.gain,seed:this.seed}}}return n.className="Orthogonal",n})();Lt.registerClass(w5);Cte={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"}});var S5={};Br(S5,{constant:()=>oAe,glorotNormal:()=>pAe,glorotUniform:()=>lAe,heNormal:()=>hAe,heUniform:()=>dAe,identity:()=>uAe,leCunNormal:()=>fAe,leCunUniform:()=>mAe,ones:()=>rAe,orthogonal:()=>gAe,randomNormal:()=>iAe,randomUniform:()=>sAe,truncatedNormal:()=>aAe,varianceScaling:()=>cAe,zeros:()=>nAe});function nAe(){return new m5}function rAe(){return new wI}function oAe(n){return new g5(n)}function sAe(n){return new y5(n)}function iAe(n){return new x5(n)}function aAe(n){return new b5(n)}function uAe(n){return new v5(n)}function cAe(n){return new Gu(n)}function lAe(n){return new zk(n)}function pAe(n){return new Vk(n)}function hAe(n){return new jk(n)}function dAe(n){return new Uk(n)}function fAe(n){return new qk(n)}function mAe(n){return new Gk(n)}function gAe(n){return new w5(n)}var _te=D(()=>{"use strict";qp();});function Hk(){return yAe++}function K0(n=""){return n in Wk||(Wk[n]=0),Wk[n]+=1,n+Wk[n].toString()}var yAe,Wk,Xw=D(()=>{"use strict";yAe=0;Wk={}});function Kk(n){return Array.isArray(n)&&Array.isArray(n[0])}function Yw(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function or(n){let t;if(Array.isArray(n)){if(n.length!==1)throw new rt(`Expected Tensor length to be 1; got ${n.length}`);t=n[0]}else t=n;return t}function Vr(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new rt(`Expected exactly 1 Shape; got ${n.length}`)}else return n}var Ya=D(()=>{"use strict";So();});function Qw(n){let t=0;for(let e of n)e.shape.length===0?t+=1:t+=e.shape.reduce((r,o)=>r*o);return t}var C5=D(()=>{"use strict";});function bAe(n,t){if(n.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(t.shape))}function SI(n){return n.map(t=>t.read())}function Jw(n){n.forEach(t=>{t[0].write(t[1])})}var Ete,Zw,CI=D(()=>{"use strict";ve();ve();Xw();jl();So();Ete="Variable",Zw=class{constructor(t,e="float32",r=Ete,o=!0,s=null){this.dtype=e??"float32",this.shape=t.shape,this.id=Hk(),r=r??Ete,this.originalName=Mk(r),this.name=Fk(this.originalName),this.trainable_=o,this.constraint=s,this.val=fk(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),bAe(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}});function SAe(n){n=ko(n);let t=[];for(let e of n)t.push(e.shape);return Li(t)}function CAe(n){return"float32"}function I5(n,t,e){if((t==null||e!=null&&e>0)&&(t=n.sourceLayer,e=n.nodeIndex),t.inboundNodes.length===0)return[n];{let r=t.inboundNodes[e];if(r.inboundLayers.length===0)return r.inputTensors;{let o=[];for(let s=0;s<r.inboundLayers.length;s++){let i=r.inputTensors[s],a=r.inboundLayers[s],u=r.nodeIndices[s],c=I5(i,a,u);for(let h of c)o.indexOf(h)===-1&&o.push(h)}return o}}}var zo,Ta,vAe,tg,wAe,ir,Ei=D(()=>{"use strict";ve();Xw();jl();So();qp();ws();Ya();C5();CI();zo=class{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}},Ta=class{constructor(t,e,r,o,s,i,a){this.dtype=t,this.shape=e,this.sourceLayer=r,this.inputs=o,this.callArgs=s,this.outputTensorIndex=a,this.id=Hk(),i!=null&&(this.originalName=Mk(i),this.name=Fk(this.originalName)),this.rank=e.length}},vAe=0,tg=class{constructor(t,e){this.callArgs=e,this.id=vAe++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(let r of t.inboundLayers)r?.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){let t=[];for(let e of this.inboundLayers)e!=null?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},wAe=0,ir=class extends Lt.Serializable{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=wAe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){let r=this.getClassName();e=zl(r)+"_"+K0(r)}if(this.name=e,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let r;if(t.batchInputShape!=null)r=t.batchInputShape;else if(t.inputShape!=null){let s=null;t.batchSize!=null&&(s=t.batchSize),r=[s].concat(t.inputShape)}this.batchInputShape=r;let o=t.dtype;o==null&&(o=t.inputDType),o==null&&(o="float32"),this.dtype=o}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(this.inboundNodes.length===0)throw new bu(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new rt(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return Li(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return Li(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new el(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new el(`Layer ${this.name} is not connected, no input to return.`);return Li(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new el(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new el(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Li(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(e=>e.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=ko(t),this.inputSpec==null||this.inputSpec.length===0)return;let e=ko(this.inputSpec);if(t.length!==e.length)throw new rt(`Layer ${this.name} expects ${e.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let r=0;r<t.length;r++){let o=t[r],s=e[r];if(s==null)continue;let i=o.rank;if(s.ndim!=null&&i!==s.ndim)throw new rt(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${i}`);if(s.maxNDim!=null&&i>s.maxNDim)throw new rt(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${i}`);if(s.minNDim!=null&&i<s.minNDim)throw new rt(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${i}.`);if(s.dtype!=null&&o.dtype!==s.dtype)throw new rt(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${o.dtype}.`);if(s.axes){let a=o.shape;for(let u in s.axes){let c=Number(u),h=s.axes[u],f=c>=0?a[c]:a[a.length+c];if(h!=null&&[h,null].indexOf(f)===-1)throw new rt(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${h} but got shape ${a}.`)}}if(s.shape!=null)for(let a=0;a<s.shape.length;++a){let u=s.shape[a],c=o.shape[a];if(u!=null&&c!=null&&u!==c)throw new rt(`Input ${r} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${o.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){this._callHook!=null&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();let r=ko(t),o=!0;for(let i of r)if(!(i instanceof Ta)){o=!1;break}let s=!0;for(let i of r)if(i instanceof Ta){s=!1;break}if(o===s)throw new rt("Arguments to apply() must be all SymbolicTensors or all Tensors");return jp(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);let i=[];for(let a of ko(t))i.push(a.shape);this.build(Li(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&s&&(this._refCount=1)}if(this.assertInputCompatibility(t),s){let i=this.call(t,e),a=ko(i),u=[];for(let c of a)r.indexOf(c)!==-1&&(c=c.clone()),u.push(c);if(i=Li(u),this.activityRegularizer!=null)throw new Bn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{let i=SAe(t),a=this.computeOutputShape(i),u,c=CAe(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?u=a.map((h,f)=>new Ta(c,h,this,ko(t),e,this.name,f)):u=new Ta(c,a,this,ko(t),e,this.name),this.addInboundNode(t,u,null,null,i,a,e),this._refCount++,this.activityRegularizer!=null)throw new Bn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((r,o)=>{r!=null&&t[o]!=null&&t[o]!==r&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new el(`The layer ${this.name} has never been called and thus has no defined output shape.`);let t=[];for(let e of this.inboundNodes){let r=JSON.stringify(e.outputShapes);t.indexOf(r)===-1&&t.push(r)}if(t.length===1){let e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new el(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new bu(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Qw(this.weights)}build(t){this.built=!0}getWeights(t=!1){return SI(t?this.trainableWeights:this.weights)}setWeights(t){st(()=>{let e=this.weights;if(e.length!==t.length)throw new rt(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(e.length===0)return;let r=[],o=SI(e);for(let s=0;s<o.length;++s){let i=o[s],a=e[s],u=t[s];if(!Y.arraysEqual(i.shape,u.shape))throw new rt(`Layer weight shape ${i.shape} not compatible with provided weight shape ${u.shape}`);r.push([a,u])}Jw(r)})}addWeight(t,e,r,o,s,i,a){if(this._addedWeightNames.indexOf(t)!==-1)throw new rt(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(o=Co("zeros"));let u=o.apply(e,r),c=new Zw(u,r,t,i,a);return u.dispose(),s!=null&&this.addLoss(()=>s.apply(c.read())),i==null&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=ko(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}addInboundNode(t,e,r,o,s,i,a=null){let u=ko(t);e=ko(e),r=ko(r),o=ko(o),s=Yw(s),i=Yw(i);let c=[],h=[],f=[];for(let g of u)c.push(g.sourceLayer),h.push(g.nodeIndex),f.push(g.tensorIndex);new tg({outboundLayer:this,inboundLayers:c,nodeIndices:h,tensorIndices:f,inputTensors:u,outputTensors:e,inputMasks:r,outputMasks:o,inputShapes:s,outputShapes:i},a);for(let g=0;g<e.length;g++)e[g].sourceLayer=this,e[g].nodeIndex=this.inboundNodes.length-1,e[g].tensorIndex=g}getConfig(){let t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}});function Xk(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new rt("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=n.batchShape;n.shape!=null&&t==null&&(t=[null].concat(n.shape));let e=n.dtype;return e==null&&(e="float32"),new X0({batchInputShape:t,name:n.name,dtype:e,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}var X0,e2=D(()=>{"use strict";ve();Xw();So();Ei();X0=(()=>{class n extends ir{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:K0("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new rt("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let r=e.batchInputShape;if(r==null){if(e.inputShape==null)throw new rt("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new rt("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let o=e.dtype||"float32";this.batchInputShape=r,this.dtype=o,this.inputSpec=[{shape:r}];let s=new Ta(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new tg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]})}apply(e,r){throw new rt(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}return n.className="InputLayer",n})();Lt.registerClass(X0)});function Qd(n){return Te(this,null,function*(){if(n==null)return;let t=[],e=[],r=[];for(let o in n){let s=n[o];if(typeof s!="number"){let i=s;t.push(i.data()),e.push(o),r.push(i)}}if(t.length>0){let o=yield Promise.all(t);for(let s=0;s<o.length;++s)n[e[s]]=o[s][0];Vn(r)}})}function Yk(n){if(n!=null)for(let t in n){let e=n[t];typeof e!="number"&&e.dispose()}}var II=D(()=>{"use strict";ve();});function Qk(n,t){return n==null&&(n={}),n instanceof ng?[n]:Array.isArray(n)&&n[0]instanceof ng?n:ko(n).map(r=>new EI(r,t))}function Zk(n,t,e,r,o,s,i,a,u){let c=new TI,h=[new _5,...T5.createCallbacks(t)];n!=null&&h.push(...n),h.push(c);let f=new _I(h);return f.setParams({epochs:e,initialEpoch:r,samples:o,steps:s,batchSize:i,verbose:t,doValidation:a,metrics:u}),{callbackList:f,history:c}}var IAe,ng,_I,_5,TI,EI,T5,t2=D(()=>{"use strict";ve();So();II();ws();IAe=125,ng=class{constructor(){this.validationData=null}setParams(t){this.params=t}onEpochBegin(t,e){return Te(this,null,function*(){})}onEpochEnd(t,e){return Te(this,null,function*(){})}onBatchBegin(t,e){return Te(this,null,function*(){})}onBatchEnd(t,e){return Te(this,null,function*(){})}onTrainBegin(t){return Te(this,null,function*(){})}onTrainEnd(t){return Te(this,null,function*(){})}setModel(t){}},_I=class{constructor(t,e=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(let e of this.callbacks)e.setParams(t)}setModel(t){for(let e of this.callbacks)e.setModel(t)}onEpochBegin(t,e){return Te(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onEpochBegin(t,e)})}onEpochEnd(t,e){return Te(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onEpochEnd(t,e)})}onBatchBegin(t,e){return Te(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onBatchBegin(t,e)})}onBatchEnd(t,e){return Te(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onBatchEnd(t,e)})}onTrainBegin(t){return Te(this,null,function*(){t==null&&(t={});for(let e of this.callbacks)yield e.onTrainBegin(t)})}onTrainEnd(t){return Te(this,null,function*(){t==null&&(t={});for(let e of this.callbacks)yield e.onTrainEnd(t)})}},_5=class extends ng{constructor(){super()}onEpochBegin(t){return Te(this,null,function*(){this.seen=0,this.totals={}})}onBatchEnd(t,e){return Te(this,null,function*(){e==null&&(e={});let r=e.size==null?0:e.size;this.seen+=r;for(let o in e){let s=e[o];if(typeof s=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+s*r;else{let i;o in this.totals?i=this.totals[o]:this.totals[o]=0;let a=st(()=>Pt(this.totals[o],Qe(s,r)));this.totals[o]=a,i?.dispose()}}})}onEpochEnd(t,e){return Te(this,null,function*(){if(e!=null)for(let r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?e[r]=this.totals[r]/this.seen:st(()=>{let o=Qe(hn(1,this.seen),this.totals[r]);e[r]=o,this.totals[r].dispose(),Ko(e[r])}))})}},TI=class extends ng{onTrainBegin(t){return Te(this,null,function*(){this.epoch=[],this.history={}})}onEpochEnd(t,e){return Te(this,null,function*(){e==null&&(e={}),this.epoch.push(t);for(let r in e)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(e[r])})}syncData(){return Te(this,null,function*(){let t=[],e=[],r=[];for(let s in this.history){let i=this.history[s];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){let u=i[a];t.push(u.data()),e.push(s),r.push(a)}}let o=yield Promise.all(t);for(let s=0;s<o.length;++s)this.history[e[s]][r[s]].dispose(),this.history[e[s]][r[s]]=o[s][0]})}},EI=class extends ng{constructor(t,e){if(super(),this.currentEpoch=0,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=IAe),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Y.isNumber(this.yieldEvery)&&(this.maybeWait=ete(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}maybeWait(t,e,r){return Te(this,null,function*(){let o=[];this.yield!=null&&(yield Qd(r),o.push(this.yield(t,e,r))),o.push(qw()),yield Promise.all(o)})}onEpochBegin(t,e){return Te(this,null,function*(){this.currentEpoch=t,this.epochBegin!=null&&(yield Qd(e),yield this.epochBegin(t,e))})}onEpochEnd(t,e){return Te(this,null,function*(){let r=[];this.epochEnd!=null&&(yield Qd(e),r.push(this.epochEnd(t,e))),this.yieldEvery==="epoch"&&r.push(qw()),yield Promise.all(r)})}onBatchBegin(t,e){return Te(this,null,function*(){this.batchBegin!=null&&(yield Qd(e),yield this.batchBegin(t,e))})}onBatchEnd(t,e){return Te(this,null,function*(){let r=[];this.batchEnd!=null&&(yield Qd(e),r.push(this.batchEnd(t,e))),this.yieldEvery==="batch"?r.push(qw()):Y.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,e)),yield Promise.all(r)})}onTrainBegin(t){return Te(this,null,function*(){this.trainBegin!=null&&(yield Qd(t),yield this.trainBegin(t))})}onTrainEnd(t){return Te(this,null,function*(){this.trainEnd!=null&&(yield Qd(t),yield this.trainEnd(t))})}};T5=(()=>{class n{constructor(){}static registerCallbackConstructor(e,r){Y.assert(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),n.checkForDuplicate(r),n.constructors[e]==null&&(n.constructors[e]=[]),n.constructors[e].push(r)}static checkForDuplicate(e){for(let r in n.constructors)n.constructors[+r].forEach(s=>{if(s===e)throw new rt("Duplicate callback constructor.")})}static clear(){n.constructors={}}static createCallbacks(e){let r=[];for(let o in n.constructors){let s=+o;e>=s&&r.push(...n.constructors[s])}return r.map(o=>new o)}}return n.constructors={},n})()});function Cu(n,t={},e=!1){return Kd(n,Lt.SerializationMap.getMap().classNameMap,t,"layer",e)}var n2=D(()=>{"use strict";ve();ws();});function NI(n,t){return st(()=>{n.dtype!=="float32"&&(n=n.asType("float32"));let e=vn(wx(n),t,!0),r=Md(e.shape,ti()),o=wo(ea(e,r));return hn(n,o)})}function Zd(n,t){return st(()=>vo(wx(un(t,n)),-1))}function r2(n,t){return st(()=>vo($o(un(t,n)),-1))}function Y0(n,t){return st(()=>{let e=un(n,t),r=li($o(n),ti(),Number.MAX_VALUE),o=$o(hn(e,r));return Qe(100,vo(o,-1))})}function _Ae(n,t){return st(()=>{let e=li(t,ti(),Number.MAX_VALUE),r=pi(Pt(1,e)),o=li(n,ti(),Number.MAX_VALUE),s=pi(Pt(1,o));return vo(wx(un(r,s)),-1)})}function TAe(n,t){return st(()=>{let e=ea(0,un(1,Qe(n,t)));return vo(wx(e),-1)})}function EAe(n,t){return st(()=>{let e=ea(0,un(1,Qe(n,t)));return vo(e,-1)})}function NAe(n,t){return st(()=>{let e=vn(Qe(n,t),-1),r=hi(Qe(un(1,n),t),-1);return ea(0,Pt(1,un(r,e)))})}function kAe(n,t){return st(()=>{let e=Math.log(2),r=un(t,n),o=un(Pt(r,Rl(Qe(-2,r))),e);return vo(o,-1)})}function Sx(n,t,e=!1){return st(()=>{if(e)t=jd(t);else{let r=vn(t,t.shape.length-1,!0);t=hn(t,r)}return t=li(t,ti(),1-ti()),Er(vn(Qe(n.toFloat(),pi(t)),t.shape.length-1))})}function o2(n,t,e=!1){return st(()=>{let r=Ol(mte(n)).toInt();t=li(t,ti(),1-ti());let o=t.shape,s=kl(r,o[o.length-1]).reshape(o);return Sx(s,t,e)})}function DAe(n,t){if(!Y.arraysEqual(n.shape,t.shape))throw new rt(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(t.shape)}`);return st(()=>{let e=t.relu(),r=t.abs().neg();return e.sub(t.mul(n)).add(r.exp().log1p())})}function s2(n,t){return st(()=>{let e;return e=li(t,ti(),1-ti()),e=pi(hn(e,un(1,e))),vo(DAe(n,e),-1)})}function AAe(n,t){return st(()=>{let e=li(n,ti(),1),r=li(t,ti(),1);return vn(Qe(n,pi(hn(e,r))),-1)})}function OAe(n,t){return st(()=>{let e=pi(Pt(ti(),t));return vo(un(t,Qe(n,e)),-1)})}function DI(n,t){return st(()=>{let e=NI(n,-1),r=NI(t,-1),o=Qe(e,r);return Er(vn(o,-1))})}function Jk(n){if(typeof n=="string"){if(n in kI)return kI[n];let t=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new rt(t)}else return n}var kI,Cx=D(()=>{"use strict";ve();ve();Xm();sa();So();kI={meanSquaredError:Zd,meanAbsoluteError:r2,meanAbsolutePercentageError:Y0,meanSquaredLogarithmicError:_Ae,squaredHinge:TAe,hinge:EAe,categoricalHinge:NAe,logcosh:kAe,categoricalCrossentropy:Sx,sparseCategoricalCrossentropy:o2,binaryCrossentropy:s2,kullbackLeiblerDivergence:AAe,poisson:OAe,cosineProximity:DI}});function AI(n,t){return st(()=>{let e=Qe(.5,ei(t)),r=Jm(ks(t,e),n.dtype);return vo(Ha(n,r),-1)})}function OI(n,t){return st(()=>Jm(Ha(Um(n,-1),Um(t,-1)),"float32"))}function kte(n,t){return st(()=>Ti(n.equal(1),t.equal(1)).sum().cast("float32"))}function RAe(n,t){return st(()=>Ti(n.equal(1),t.equal(0)).sum().cast("float32"))}function MAe(n,t){return st(()=>Ti(n.equal(0),t.equal(1)).sum().cast("float32"))}function E5(n,t){return st(()=>{let e=kte(n,t),r=MAe(n,t),o=e.add(r);return Yo(ks(o,0),e.div(o),0).cast("float32")})}function Dte(n,t){return st(()=>{let e=kte(n,t),r=RAe(n,t),o=e.add(r);return Yo(ks(o,0),e.div(o),0).cast("float32")})}function tD(n,t){return s2(n,t)}function nD(n,t){return n.rank===t.rank&&(n=n.squeeze([n.rank-1])),t=t.argMax(-1),t.dtype!==n.dtype&&(t=t.asType(n.dtype)),Ha(n,t).asType("float32")}function Ate(n){if(typeof n=="string"&&n in eD)return eD[n];if(typeof n!="string"&&n!=null)return n;throw new rt(`Unknown metric ${n}`)}function MI(n){if(tl(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let t;for(let e of Object.keys(kI))if(kI[e]===n){t=e;break}if(t!==void 0)return t;for(let e of Object.keys(eD))if(eD[e]===n){t=e;break}return t!==void 0?t:n.name}}var FAe,PAe,$Ae,LAe,BAe,zAe,RI,VAe,N5,eD,k5=D(()=>{"use strict";ve();ve();sa();So();Cx();Cx();Cx();ws();FAe=Zd,PAe=Zd,$Ae=r2,LAe=r2,BAe=Y0,zAe=Y0,RI=Sx,VAe=DI,N5=o2,eD={binaryAccuracy:AI,categoricalAccuracy:OI,precision:E5,categoricalCrossentropy:RI,sparseCategoricalCrossentropy:N5,mse:FAe,MSE:PAe,mae:$Ae,MAE:LAe,mape:BAe,MAPE:zAe,cosine:VAe}});function Rte(n){let t={Adagrad:()=>W0.adagrad(.01),Adadelta:()=>W0.adadelta(1,.95,ti()),Adam:()=>W0.adam(.001,.9,.999,ti()),Adamax:()=>W0.adamax(.002,.9,.999,ti(),0),RMSProp:()=>W0.rmsprop(.001,.9,0,ti()),SGD:()=>W0.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,n in t)return t[n]();throw new rt(`Unknown Optimizer ${n}`)}var Mte=D(()=>{"use strict";ve();Xm();So();});function A5(n,t,e=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!D5(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){let r=JSON.stringify(n);r.length>1048576&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function D5(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){let t=Object.keys(n);for(let e of t)if(typeof e!="string"||!D5(n[e]))return!1;return!0}else if(Array.isArray(n)){for(let t of n)if(!D5(t))return!1;return!0}else return!1;else{let t=typeof n;return t==="string"||t==="number"||t==="boolean"}}var Fte=D(()=>{"use strict";});function Pte(n,t,e,r=console.log){let o=qAe(n),s=["Layer (type)","Output shape","Param #"];o?(t=t||65,e=e||[.45,.85,1]):(t=t||98,e=e||[.33,.55,.67,1]),e[e.length-1]<=1&&(e=e.map(h=>Math.floor(t*h)));let i;if(!o){s.push("Receives inputs"),i=[];for(let h in n.nodesByDepth)i.push(...n.nodesByDepth[h])}r("_".repeat(t)),rD(s,e,r),r("=".repeat(t));let a=n.layers;for(let h=0;h<a.length;++h)o?GAe(a[h],e,r):WAe(a[h],e,i,r),r((h===a.length-1?"=":"_").repeat(t));n.checkTrainableWeightsConsistency();let u=UAe(n),c=Qw(n.nonTrainableWeights);r(`Total params: ${u+c}`),r(`Trainable params: ${u}`),r(`Non-trainable params: ${c}`),r("_".repeat(t))}function UAe(n){let t;return n.collectedTrainableWeights!=null?t=Qw(n.collectedTrainableWeights):t=Qw(n.trainableWeights),t}function qAe(n){let t=!0,e=[],r=[];for(let o in n.nodesByDepth)e.push(n.nodesByDepth[o]);for(let o of e){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){t=!1;break}r.push(...o)}if(t)for(let o of n.layers){let s=!1;for(let i of o.inboundNodes)if(r.indexOf(i)!==-1)if(s){t=!1;break}else s=!0;if(!t)break}return t}function rD(n,t,e=console.log){let r="";for(let o=0;o<n.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r+=n[o],r=r.slice(0,t[o]),r+=" ".repeat(t[o]-r.length);e(r)}function GAe(n,t,e){let r;try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}let o=n.name,s=n.getClassName(),i=[`${o} (${s})`,r,n.countParams().toString()];rD(i,t,e)}function WAe(n,t,e,r){let o;try{o=JSON.stringify(n.outputShape)}catch{o="multiple"}let s=[];for(let h of n.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(h)===-1))for(let f=0;f<h.inboundLayers.length;++f){let g=h.inboundLayers[f].name,d=h.nodeIndices[f],p=h.tensorIndices[f];s.push(`${g}[${d}][${p}]`)}let i=n.name,a=n.getClassName(),u=s.length===0?"":s[0],c=[`${i} (${a})`,o,n.countParams().toString(),u];rD(c,t,r);for(let h=1;h<s.length;++h)rD(["","","",s[h]],t,r)}var $te=D(()=>{"use strict";C5();});function Lte(n,t,e){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&t===0&&typeof e=="string"}function Ix(n,t){if(n===null)return null;if(typeof n=="string")return Ym(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){let e=[],r=n.length;for(let o=0;o<r;++o){let s=n[o];Lte(t,o,s)?e.push(s):e.push(Ix(s,t))}return e}else{let e={};for(let r of Object.keys(n)){let o=n[r];if(r==="name"&&typeof o=="string")e[r]=o;else{let s=Ym(r);e[s]=Ix(o,s)}}return e}}function oD(n,t){if(n==null)return null;if(typeof n=="string")return zl(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){let e=[],r=n.length;for(let o=0;o<r;++o){let s=n[o];Lte(t,o,s)?e.push(s):e.push(oD(s,t))}return e}else{let e={};for(let r of Object.keys(n)){let o=n[r],s=zl(r);(r==="name"||r==="className")&&typeof o=="string"?e[s]=o:e[s]=oD(o,r)}return e}}var sD=D(()=>{"use strict";ws();});var Q0,iD=D(()=>{"use strict";Q0="2.8.6"});function HAe(n,t){if(n.dtype==null||n.dtype===t.dtype)return t;try{return Wt(t,n.dtype)}catch{throw new rt(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}function _x(n,t,e,r){let o=e==null?!1:e.training,s=Array.isArray(n),i=s?n:[n],a=i.map(p=>p.name),u=[],c=t.names();for(let p of a)c.indexOf(p)!==-1?u.push(t.getValue(p)):u.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);let h=a.join(",")+"|"+t.names().join(","),f,g;if(O5[h]==null){let p=KAe(i,t);f=p.sorted,g=p.recipientCounts,O5[h]=f,Bte[h]=g}f=O5[h],g={},o||Object.assign(g,Bte[h]);let d=new Jd(t);for(let p=0;p<f.length;++p){if(r!=null){let q=Yv().numTensors;q>r.maxNumTensors&&(r.maxNumTensors=q),q<r.minNumTensors&&(r.minNumTensors=q)}let m=f[p],y=m.sourceLayer;if(y instanceof X0)continue;let v=[],N=[],T=[],O=!1;for(let q of m.inputs){let U=d.getValue(q),Z=d.getMask(q);v.push(U),N.push(Z),Z!=null&&(O=!0),o||(g[q.name]--,g[q.name]===0&&!t.hasKey(q)&&a.indexOf(q.name)===-1&&!U.isDisposed&&q.sourceLayer.stateful!==!0&&T.push(U))}O&&(e=e||{},e.mask=N[0]);let S=ko(y.apply(v,e)),F=null;y.supportsMasking&&(F=y.computeMask(v,N));let R=YAe(m),L=Array.isArray(R)?R:[R];for(let q=0;q<L.length;++q){d.hasKey(L[q])||d.add(L[q],S[q],Array.isArray(F)?F[0]:F);let U=a.indexOf(L[q].name);U!==-1&&(u[U]=S[q])}o||Vn(T)}return d.disposeMasks(),s?u:u[0]}function KAe(n,t){Y.assert(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let e=[],r={};if(n.length===1){let o=zte(n[0],t);e=o.sorted,r=o.recipientMap}else{let o=new Set;for(let s of n){let{sorted:i,recipientMap:a}=zte(s,t);for(let u of i)o.has(u.name)||(e.push(u),o.add(u.name));for(let u in a)r[u]==null&&(r[u]=new Set),a[u].forEach(c=>r[u].add(c))}}return{sorted:e,recipientCounts:XAe(r)}}function XAe(n){let t={};for(let e in n)t[e]=n[e].size;return t}function zte(n,t){let e=new Set,r=[],o={};for(let a of t.names())e.add(a);let s=[],i=[];for(s.push(n);s.length>0;){let a=s[s.length-1];if(e.has(a.name)){s.pop();continue}let u=i[i.length-1]===s.length-1;if(a.inputs.length===0||u)s.pop(),r.push(a),e.add(a.name),u&&i.pop();else{i.push(s.length-1);for(let c of a.inputs)o[c.name]==null&&(o[c.name]=new Set),o[c.name].add(a.name),!e.has(c.name)&&s.push(c)}}return{sorted:r,recipientMap:o}}function YAe(n){let t;if(n.sourceLayer.inboundNodes.length===1)t=n.sourceLayer.output;else{let e=null;for(let r=0;r<n.sourceLayer.inboundNodes.length;++r)for(let o of n.sourceLayer.inboundNodes[r].outputTensors)if(o.id===n.id){e=r;break}t=n.sourceLayer.getOutputAt(e)}return t}var Jd,O5,Bte,R5=D(()=>{"use strict";ve();So();ws();e2();Ei();Jd=class n{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof n)for(let e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(t==null)return;for(let e of t)this.add(e.key,e.value)}}add(t,e,r){if(this.id2Value[t.id]==null)this.id2Value[t.id]=HAe(t,e),this.name2Id[t.name]=t.id,r!=null&&(this.id2Mask[t.id]=r);else throw new rt(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof Ta){if(this.id2Value[t.id]==null)throw new rt(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{let e=this.name2Id[t];if(e==null)throw new rt(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof Ta){if(this.id2Value[t.id]==null)throw new rt(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{let e=this.name2Id[t];if(e==null)throw new rt(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&Vn(this.id2Mask)}},O5={},Bte={}});var aD,Vte=D(()=>{"use strict";ve();Xw();So();n2();ws();sD();Ya();CI();iD();R5();e2();Ei();aD=class n extends ir{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){let N=this.getClassName().toLowerCase();this.name=K0(N)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Vl(this.inputs).length!==this.inputs.length)throw new rt(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(N=>N.name)}`);Vl(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(N=>N.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let N of this.outputs){let T=N.sourceLayer,O=N.nodeIndex,S=N.tensorIndex;this.outputLayers.push(T),this.outputLayersNodeIndices.push(O),this.outputLayersTensorIndices.push(S)}for(let N of this.inputs){let T=N.sourceLayer,O=N.nodeIndex,S=N.tensorIndex;tl(O===0,"input layer has >1 nodes"),tl(S===0,"input layer has >1 tensors"),this.inputLayers.push(T),this.inputLayersNodeIndices.push(O),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let N=0;N<this.inputLayers.length;N++){let T=this.inputLayers[N];if(!(T instanceof X0))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${N} (0-based) originates from layer type ${T.getClassName()}.`);this.inputNames.push(T.name),this.feedInputShapes.push(T.batchInputShape),this.feedInputNames.push(T.name)}for(let N of this.outputLayers)this.outputNames.push(N.name);this.internalInputShapes=this.inputs.map(N=>N.shape),this.internalOutputShapes=this.outputs.map(N=>N.shape);let e={},r={},o={},s={},i={},a=[],u=(N,T,O,S,F,R)=>{(S==null||F==null||R==null)&&(S=N.sourceLayer,F=N.nodeIndex,R=N.tensorIndex);let L=S.inboundNodes[F];if(O.indexOf(L)!==-1)throw new bu(`The tensor ${N.name} at layer "${S.name}" is part of a cycle.`);if(T.indexOf(L)!==-1)return;this.containerNodes.add(n.nodeKey(S,F)),S.id in i||(i[S.id]=Object.keys(i).length),O.indexOf(L)===-1&&O.push(L);let q=L.inboundLayers.length;for(let U=0;U<q;U++){let Z=L.inputTensors[U],ee=L.inboundLayers[U],Q=L.nodeIndices[U],oe=L.tensorIndices[U];u(Z,T,O,ee,Q,oe)}for(T.push(L);O.indexOf(L)>=0;)O.splice(O.indexOf(L),1);a.push(L)},c=[],h=[];for(let N of this.outputs)u(N,c,h);let f=a.slice().reverse();for(let N of f){r[N.id]=N,N.id in e||(e[N.id]=0);let T=e[N.id],O=o[N.outboundLayer.id]==null?0:o[N.outboundLayer.id];T=Math.max(T,O),o[N.outboundLayer.id]=T,s[N.outboundLayer.id]=N.outboundLayer,e[N.id]=T;for(let S=0;S<N.inboundLayers.length;S++){let F=N.inboundLayers[S],R=N.nodeIndices[S],L=F.inboundNodes[R],q=e[L.id]==null?0:e[L.id];e[L.id]=Math.max(T+1,q),r[L.id]=L}}let g={};for(let N in e){let T=e[N];T in g||(g[T]=[]),g[T].push(r[N])}let d={};for(let N in o){let T=o[N];T in d||(d[T]=[]),d[T].push(s[N])}let p=Object.keys(d).map(N=>parseInt(N,10)).sort(xI);this.layers=[];for(let N of p){let T=d[N];T.sort((O,S)=>{let F=i[O.id],R=i[S.id];return F<R?-1:F>R?1:0});for(let O of T)O instanceof n&&this.internalContainerRefs.push(O),this.layers.push(O)}this.layersByDepth=d,p=Object.keys(g).map(N=>parseInt(N,10)).sort(xI);let m=this.inputs.slice(),y=[];for(let N of p)for(let T of g[N]){let O=T.outboundLayer;if(O!=null){for(let S of T.inputTensors)if(m.indexOf(S)===-1)throw new bu(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${O.name}". The following previous layers were accessed without issue: ${y}`);for(let S of T.outputTensors)m.push(S);y.push(O.name)}}this.nodesByDepth=g;let v=this.layers.map(N=>N.name);for(let N of v){let T=v.filter(O=>O===N).length;if(T!==1)throw new bu(`The name "${N}" is used ${T} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(v))}this.outboundNodes=[],this.inboundNodes=[],new tg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(N=>null),outputMasks:this.outputs.map(N=>null),inputShapes:this.inputs.map(N=>N.shape),outputShapes:this.outputs.map(N=>N.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(let e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(e=>{e._trainableWeights.forEach(r=>r.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new rt("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(let e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){let t=[];for(let e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){let e=[];for(let r of this.layers)e.push(...r.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){let r={},o=0;for(let i of this.layers)for(let a of i.weights){if(r[a.originalName]!=null)throw new rt(`Duplicate weight name: ${a.originalName}`);r[a.originalName]=a,o++}let s=[];for(let i in t){let a=i;if(r[i]==null){let u=i.split("/");a=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(r[a]!=null)s.push([r[a],t[i]]);else if(e)throw new rt(`Provided weight data has no target variable: ${i}`);delete r[a]}if(e){let i=[];for(let a in r)i.push(a);if(i.length>0)throw new rt(`${i.length} of ${o} weights are not set: ${i}`)}Jw(s)}updatedConfig(){let t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion=`tfjs-layers ${Q0}`,e.backend="TensorFlow.js",e}toJSON(t,e=!0){let r=oD(this.updatedConfig());return e?JSON.stringify(r):r}call(t,e){return st(()=>{t=ko(t);let r=new Jd;for(let o=0;o<this.inputs.length;++o)r.add(this.inputs[o],t[o]);return _x(this.outputs,r,e)})}computeMask(t,e){return st(()=>{t=ko(t);let r;return e==null?r=Bl(null,t.length):r=ko(e),this.runInternalGraph(t,r)[1]})}computeOutputShape(t){let e=Yw(t);if(e.length!==this.inputLayers.length)throw new rt(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);let r={};for(let a=0;a<e.length;a++){let u=this.inputLayers[a],c=e[a],h=u.name+"_0_0";r[h]=c}let o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(xI);if(o.length>1)for(let a of o){let u=this.nodesByDepth[a];for(let c of u){let h=c.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(h.id)!==-1)continue;let f=[];for(let m=0;m<c.inboundLayers.length;m++){let y=c.inboundLayers[m],v=c.nodeIndices[m],N=c.tensorIndices[m],T=`${y.name}_${v}_${N}`,O=r[T];f.push(O)}let g=h.computeOutputShape(Li(f)),d=Yw(g),p=h.inboundNodes.indexOf(c);for(let m=0;m<d.length;m++){let y=`${h.name}_${p}_${m}`;r[y]=d[m]}}}let s=[],i=[];for(let a=0;a<this.outputLayers.length;a++){let u=this.outputLayers[a],c=this.outputLayersNodeIndices[a],h=this.outputLayersTensorIndices[a],f=`${u.name}_${c}_${h}`;i.push(f)}for(let a=0;a<i.length;a++){let u=i[a];tl(u in r),s.push(r[u])}return Li(s)}runInternalGraph(t,e){e==null&&(e=Bl(null,t.length));let r={};for(let u=0;u<this.inputs.length;++u){let c=this.inputs[u],h=t[u],f=e[u];r[c.id]=[h,f]}let o=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(xI);for(let u of o){let c=this.nodesByDepth[u];for(let h of c){let f=h.outboundLayer,g=h.inputTensors,d=h.outputTensors,p=new Array;for(let m of g)m.id in r&&p.push(r[m.id]);if(p.length===g.length){let m={},y,v,N,T;if(h.callArgs!=null&&(m=h.callArgs),p.length===1){let[O,S]=p[0];m.mask==null&&(m.mask=S),N=ko(f.call(O,m)),T=ko(f.computeMask(O,S)),y=[O],v=[S]}else y=p.map(O=>O[0]),v=p.map(O=>O[1]),m.mask==null&&(m.mask=v),N=ko(f.call(y,m)),T=ko(f.computeMask(y,v));if(f.activityRegularizer)throw new Bn("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let O=0;O<d.length;++O){let S=d[O],F=N[O],R=T[O];r[S.id]=[F,R]}}}}let s=[],i=[],a=[];for(let u of this.outputs){tl(u.id in r,`Could not compute output ${u.name} : ${u.id}`);let[c,h]=r[u.id];a.push(c.shape),s.push(c),i.push(h)}return[s,i,a]}buildNodeConversionMap(t){let e={},r;for(let o of this.layers){r=o instanceof n?1:0;for(let s=0;s<o.inboundNodes.length;s++){let i=n.nodeKey(o,s);this.containerNodes.has(i)&&(e[i]=r,r+=1)}}return e}getLayer(t,e){if(e!=null){if(this.layers.length<=e)throw new rt(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}else if(t==null)throw new rt("Provide either a layer name or layer index");for(let r of this.layers)if(r.name===t)return r;throw new rt(`No such layer: ${t}`)}calculateLosses(){return st(()=>{let t=[];for(let e of this.layers)for(let r=0;r<e.inboundNodes.length;++r){let o=n.nodeKey(e,r);this.containerNodes.has(o)&&t.push(...e.calculateLosses())}return t})}getConfig(){let t={name:this.name},e=this.buildNodeConversionMap(this.layers),r=[];for(let i of this.layers){let a=i.getClassName(),u=i.getConfig(),c=[];for(let f=0;f<i.inboundNodes.length;f++){let g=i.inboundNodes[f],d=n.nodeKey(i,f),p={};if(this.containerNodes.has(d)){if(g.callArgs)try{JSON.stringify(g.callArgs),p=g.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${g.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(g.inboundLayers.length>0){let m=[];for(let y=0;y<g.inboundLayers.length;y++){let v=g.inboundLayers[y],N=g.nodeIndices[y],T=g.tensorIndices[y],O=n.nodeKey(v,N),S=e[O];S==null&&(S=0),m.push([v.name,S,T,p])}c.push(m)}}}let h={};h.name=i.name,h.className=a,h.config=u,h.inboundNodes=c,r.push(h)}t.layers=r;let o=[];for(let i=0;i<this.inputLayers.length;i++){let a=this.inputLayers[i],u=this.inputLayersNodeIndices[i],c=n.nodeKey(a,u);if(!this.containerNodes.has(c))continue;let h=e[c];h==null&&(h=0);let f=this.inputLayersTensorIndices[i];o.push([a.name,h,f])}t.inputLayers=o;let s=[];for(let i=0;i<this.outputLayers.length;i++){let a=this.outputLayers[i],u=this.outputLayersNodeIndices[i],c=n.nodeKey(a,u);if(!this.containerNodes.has(c))continue;let h=e[c];h==null&&(h=0);let f=this.outputLayersTensorIndices[i];s.push([a.name,h,f])}return t.outputLayers=s,t}static fromConfig(t,e,r={},o=!1){let s={},i={};function a(y,v){y.name in i?i[y.name].push(v):i[y.name]=[v]}function u(y,v){let N=[],T;for(let O of v){let S=O[0],F=O[1],R=O[2];if(T=O[3]==null?{}:O[3],!(S in s)){a(y,v);return}let L=s[S];if(L.inboundNodes.length<=F){a(y,v);return}let q=L.inboundNodes[F];N.push(q.outputTensors[R])}N.length>0&&y.apply(Li(N),T)}function c(y){let v=y.name,N=Cu(y,e.customObjects!=null?e.customObjects:{});N.setFastWeightInitDuringBuild(o),s[v]=N,y.inboundNodes.forEach(O=>{if(!(O instanceof Array))throw new rt(`Corrupted configuration, expected array for nodeData: ${O}`);a(N,O)})}let h=e.name,f=e.layers;for(let y of f)c(y);for(;!Zee(i);)for(let y of f){let v=s[y.name];if(v.name in i){let N=i[v.name];delete i[v.name];for(let T of N)u(v,T)}}let g=[],d=[],p=e.inputLayers;for(let y of p){let v=y[0],N=y[1],T=y[2];tl(v in s);let S=s[v].inboundNodes[N].outputTensors;g.push(S[T])}let m=e.outputLayers;for(let y of m){let v=y[0],N=y[1],T=y[2];tl(v in s);let S=s[v].inboundNodes[N].outputTensors;d.push(S[T])}return new t({inputs:g,outputs:d,name:h})}get stateful(){if(this._stateful)throw new rt("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let t of this.layers)if(t.stateful)return!0;return!1}resetStates(){st(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}});function QAe(n,t,e){let r=t.length;if(n==null||Array.isArray(n)&&n.length===0)return t.map(o=>null);if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&t[0]in n?[n[t[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error(`Provided ${e} is an array of ${n.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){let o=[];return t.forEach(s=>{s in n?o.push(n[s]):o.push(null)}),o}else throw new Error(`The model has multiple (${r}) outputs, so ${e} must be either an array with ${r} elements or an object with ${t} keys. Provided ${e} not understood: ${JSON.stringify(n)}`)}function uD(n,t){return QAe(n,t,"classWeight")}function cD(n,t,e,r){return Te(this,null,function*(){if(t!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){let o=st(()=>{if(n.shape.length===1)return n.clone();if(n.shape.length===2){if(n.shape[1]>1)return n.argMax(1);if(n.shape[1]===1)return n.reshape([n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(yield o.data());Vn(o);let i=[];return s.forEach(a=>{if(e[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(e[a])}),bs(i,"float32")}else return null})}function jte(n,t){return Qe(n,t)}var M5=D(()=>{"use strict";ve();});function Gte(n,t){let e,r,o=t;e=o.xs,r=o.ys,Y.assert(e!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);let s=Ute("input",n.inputNames,e),i=Ute("output",n.outputNames,r),a=s[0].shape[0];Y.assert(s.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),Y.assert(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let u=0;u<s.length;u++)Y.assert(s[u].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[u]} has ${s[u].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let u=0;u<i.length;u++)Y.assert(i[u].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[u]} has ${i[u].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:s,ys:i}}function Ute(n,t,e){if(e instanceof Me)return[e];if(Array.isArray(e))return Y.assert(e.length===t.length,()=>`Received an array of ${e.length} Tensors, but expected ${t.length} to match the ${n} keys ${t}.`),e;{let r=[];for(let o of t){if(e[o]==null)throw new rt(`The feature data generated by the dataset lacks the required ${n} key '${o}'.`);r.push(e[o])}return r}}function JAe(n){if(n.length===3)throw new Bn("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}function Wte(n,t,e){return Te(this,null,function*(){let r=e.batchesPerEpoch!=null;if(Y.assert(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),Y.assert(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),Y.assert(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),Y.assert(!r||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),Y.assert(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{let o=e.validationData!=null,s,i;if(o)if(qte(e.validationData))Y.assert(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{let y=JAe(e.validationData);s=y.xs,i=y.ys}let a=n.makeTrainFunction(),u=n.getDedupedMetricsNames(),c;o?c=u.slice().concat(u.map(y=>"val_"+y)):c=u.slice();let h=Qk(e.callbacks,e.yieldEvery),f=e.verbose==null?1:e.verbose,{callbackList:g,history:d}=Zk(h,f,e.epochs,null,null,e3e(t,e),null,o,c);g.setModel(n),n.history=d,yield g.onTrainBegin(),n.stopTraining_=!1;let p=e.initialEpoch==null?0:e.initialEpoch,m=yield t.iterator();for(;p<e.epochs;){let y={};yield g.onEpochBegin(p);let v=0,N=0;for(r||(m=yield t.iterator());!r||v<e.batchesPerEpoch;){let T=yield m.next();if(r&&T.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${v} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(T.value!=null){let{xs:O,ys:S}=Gte(n,T.value),F={};F.batch=N,F.size=O[0].shape[0],yield g.onBatchBegin(N,F);let R=[];if(e.classWeight!=null){let U=uD(e.classWeight,n.outputNames);for(let Z=0;Z<U.length;++Z)R.push(yield cD(S[Z],null,U[Z]))}let L=O.concat(S).concat(R),q=a(L);Vn(L);for(let U=0;U<u.length;++U){let Z=u[U],ee=q[U];F[Z]=ee,Ko(ee)}yield g.onBatchEnd(N,F),Yk(F),N++,v++}if(r?v>=e.batchesPerEpoch:T.done){if(o){let O;qte(e.validationData)?O=ko(yield n.evaluateDataset(e.validationData,{batches:e.validationBatches})):O=ko(n.evaluate(s,i,{batchSize:e.validationBatchSize==null?ZAe:e.validationBatchSize,verbose:0}));for(let S=0;S<n.metricsNames.length;++S)y[`val_${n.metricsNames[S]}`]=O[S]}break}if(n.stopTraining_)break}if(yield g.onEpochEnd(p,y),p++,n.stopTraining_)break}return yield g.onTrainEnd(),yield n.history.syncData(),n.history}finally{n.isTraining=!1}})}function e3e(n,t){let e=null;return t.batchesPerEpoch!=null?e=t.batchesPerEpoch:Number.isFinite(n.size)&&(e=n.size),e}function qte(n){return typeof n.iterator=="function"}function t3e(n){return typeof n.next=="function"}function Hte(n,t,e){return Te(this,null,function*(){e=e||{};let r=e.batches!=null,o=n.testFunction,s=[];if(e.verbose>0)throw new Bn("Verbose mode is not implemented yet.");Y.assert(!r||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);let i=t3e(t)?t:yield t.iterator(),a=0,u=0;for(;!r||u<e.batches;){let c=yield i.next();if(s=st(()=>{if(c.value){let{xs:h,ys:f}=Gte(n,c.value),g=h.concat(f),d=st(()=>o(g));if(Vn(g),u===0)for(let m=0;m<d.length;++m)s.push(sn(0));let p=g[0].shape[0];for(let m=0;m<d.length;++m){let y=d[m],v=s[m];s[m]=st(()=>Pt(s[m],Qe(p,y))),u>0&&Vn(v)}Vn(d),a+=p,++u}return s}),c.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<s.length;++c){let h=s[c];s[c]=hn(s[c],a),Vn(h)}return Li(s)})}var ZAe,Kte=D(()=>{"use strict";ve();ve();t2();So();II();ws();M5();ZAe=32});function lD(n){Y.assert(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function i2(n,t,e){return n==null?[null]:Array.isArray(n)?n.map(r=>Zm(r,t,e-t)):Zm(n,t,e-t)}function pD(n,t){return st(()=>n==null?null:Array.isArray(n)?n.map(e=>pD(e,t)):Lk(n,t.dtype==="int32"?t:t.toInt()))}function hD(n,t){let e=[],r=0,o=null;for(;r<n;)o=r+t,o>=n&&(o=n),e.push([r,o]),r=o;return e}function n3e(n,t,e,r,o,s,i,a,u,c,h,f,g,d,p){return Te(this,null,function*(){o==null&&(o=32),s==null&&(s=1),h==null&&(h=!0),g==null&&(g=0);let m=!1;if(u!=null&&c!=null&&(m=!0),p!=null&&(m=!0,d==null))throw new rt("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let y=n.checkNumSamples(e,o,d,"steps_per_epoch"),v;y!=null&&(v=Xa(0,y)),i==null&&(i=1);let{callbackList:N,history:T}=Zk(a,i,s,g,y,d,o,m,f);N.setModel(n),n.history=T,yield N.onTrainBegin(),n.stopTraining_=!1;for(let O=g;O<s;++O){yield N.onEpochBegin(O);let S={};if(d!=null)throw new Bn("stepsPerEpoch mode is not implemented yet.");{if(h==="batch")throw new Bn("batch shuffling is not implemneted yet");h&&Y.shuffle(v);let F=bs(v),R=hD(y,o);for(let L=0;L<R.length;++L){let q={};if(yield N.onBatchBegin(L,q),st(()=>{let U=R[L][0],Z=R[L][1],ee=Zm(F,U,Z-U);q.batch=L,q.size=Z-U;let Q=pD(e,ee),oe=t(Q);for(let se=0;se<r.length;++se){let pe=r[se],ae=oe[se];q[pe]=ae,Ko(ae)}if(L===R.length-1&&m){let se=n.testLoop(u,c,o);for(let pe=0;pe<r.length;++pe){let ae=r[pe],fe=se[pe];Ko(fe),S["val_"+ae]=fe}}}),yield N.onBatchEnd(L,q),Yk(q),n.stopTraining_)break}F.dispose()}if(yield N.onEpochEnd(O,S),n.stopTraining_)break}return yield N.onTrainEnd(),yield n.history.syncData(),n.history})}function Xte(o,s,i){return Te(this,arguments,function*(n,t,e,r={}){if(n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;let a,u,c,h,f,g,d;try{let p=r.batchSize==null?32:r.batchSize;lD(p);let y=yield n.standardizeUserData(t,e,r.sampleWeight,r.classWeight,!1,p);a=y[0],u=y[1],d=y[2];let v=!1,N;if(r.validationData!=null&&r.validationData.length>0){if(v=!0,r.validationData.length===2)c=r.validationData[0],h=r.validationData[1];else throw r.validationData.length===3?new Bn("validationData including sample weights is not supported yet."):new rt(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);let Z=yield n.standardizeUserData(c,h,null,null,!0,p);f=Z[0],g=Z[1],N=f.concat(g)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){v=!0;let U=Math.floor(a[0].shape[0]*(1-r.validationSplit)),Z=a[0].shape[0];f=i2(a,U,Z),a=i2(a,0,U),g=i2(u,U,Z),u=i2(u,0,U),N=f.concat(g)}else r.validationSteps!=null&&(v=!0);let T=a.concat(u).concat(d);n.checkTrainableWeightsConsistency();let O=n.makeTrainFunction(),S=n.getDedupedMetricsNames(),F,R;v?(n.makeTestFunction(),F=n.testFunction,R=S.slice().concat(S.map(U=>"val_"+U))):(F=null,N=[],R=S.slice());let L=Qk(r.callbacks,r.yieldEvery);return yield n3e(n,O,T,S,p,r.epochs,r.verbose,L,F,N,r.shuffle,R,r.initialEpoch,null,null)}finally{n.isTraining=!1,Z0(a,t),Z0(u,e),Z0(f,c),Z0(g,h),d!=null&&Vn(d)}})}function F5(n){let t=[];n instanceof Me&&(n=[n]);for(let e=0;e<n.length;++e){let r=n[e];if(r.rank===1)t.push(eg(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function Z0(n,t){if(n==null)return;let e=[];if(t instanceof Me)e.push(t.id);else if(Array.isArray(t))t.forEach(o=>e.push(o.id));else if(t!=null)for(let o in t){let s=t[o];e.push(s.id)}let r=[];if(n instanceof Me)e.indexOf(n.id)===-1&&r.push(n);else if(Array.isArray(n))n.forEach(o=>{e.indexOf(o.id)===-1&&r.push(o)});else if(n!=null)for(let o in n){let s=n[o];e.indexOf(s.id)===-1&&r.push(s)}r.forEach(o=>{o.isDisposed||o.dispose()})}var Yte=D(()=>{"use strict";ve();ve();sa();t2();So();II();Yd();});function r3e(n){return n instanceof Me}function P5(n){return Array.isArray(n)}function Qte(n){return!r3e(n)&&!P5(n)}function Zte(n,t,e,r=!0,o=""){if(t==null||t.length===0){if(n!=null){let i=!1;if(P5(n)&&n.length>0)i=!0;else if(Qte(n)){for(let a in n)if(n.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new rt(`Error when checking model ${o} expected no data, but got ${n}`)}return[]}if(n==null)return t.map(i=>null);let s;if(Qte(n)){n=n,s=[];for(let i of t){if(n[i]==null)throw new rt(`No data provided for "${i}". Need data for each key in: ${t}`);s.push(n[i])}}else if(P5(n)){if(n=n,n.length!==t.length)throw new rt(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);s=n}else{if(n=n,t.length>1)throw new rt(`The model ${o} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);s=[n]}if(s=F5(s),e!=null)for(let i=0;i<t.length;++i){if(e[i]==null)continue;let a=s[i];if(a.shape.length!==e[i].length)throw new rt(`Error when checking ${o}: expected ${t[i]} to have ${e[i].length} dimension(s). but got array with shape ${a.shape}`);for(let u=0;u<e[i].length;++u){if(u===0&&!r)continue;let c=a.shape[u],h=e[i][u];if(h!=null&&h>=0&&c!==h)throw new rt(`Error when checking ${o}: expected ${t[i]} to have shape [${e[i]}], but got array with shape [${a.shape}].`)}}return s}function o3e(n,t,e){let r=Vl(n.map(s=>s.shape[0]));r.sort();let o=Vl(t.map(s=>s.shape[0]));if(o.sort(),r.length>1)throw new rt(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(s=>s.shape))}`);if(o.length>1)throw new rt(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(s=>s.shape))}`);if(r.length>0&&o.length>0&&!Y.arraysEqual(r,o))throw new rt(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${o[0]} target sample(s).`)}function s3e(n,t,e){let r=[Zd,s2,Sx];for(let o=0;o<n.length;++o){let s=n[o],i=t[o],a=e[o];if(i!=null){if(i===Sx&&s.shape[s.shape.length-1]===1)throw new rt(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(i)!==-1){let u=s.shape.slice(1),c=a.slice(1);for(let h=0;h<u.length;++h){let f=u[h],g=c[h];if(g!=null&&f!==g)throw new rt(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Jte(n,t,e,r=!0,o=""){let s;if(Array.isArray(n)){if(n.length!==t.length)throw new rt(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${n.length} Tensors(s).`);s=n}else{if(t.length>1)throw new rt(`The model expects ${t.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);s=[n]}if(e!=null)for(let i=0;i<t.length;++i){if(e[i]==null)continue;let a=s[i];if(a.shape.length!==e[i].length)throw new rt(`Error when checking ${o}: expected ${t[i]} to have ${e[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let u=0;u<e[i].length;++u){if(u===0&&!r)continue;let c=a.shape[u],h=e[i][u];if(h!=null&&h!==c)throw new rt(`Error when checking ${o}: expected ${t[i]} to have shape ${JSON.stringify(e[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function i3e(n,t){if(n==null||Array.isArray(n)&&n.length===0)return t.map(r=>[]);let e;if(typeof n=="string"||typeof n=="function")e=[n];else if(Array.isArray(n)||typeof n=="object")e=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(e))return t.map(r=>e);{let r=[];for(let o of t){let s=e.hasOwnProperty(o)?e[o]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}}var a3e,Gl,u3e,FI=D(()=>{"use strict";ve();ve();sa();jl();So();n2();Cx();k5();Mte();Fte();ws();$te();Yd();sD();iD();Vte();R5();Kte();Yte();M5();a3e="layers-model",Gl=(()=>{class n extends aD{constructor(e){super(e),this.isTraining=!1}summary(e,r,o=console.log){if(!this.built)throw new rt("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Pte(this,e,r,o)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=Rte(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof ra))throw new rt("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let r=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let a in e.loss)if(this.outputNames.indexOf(a)===-1)throw new rt(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(let a of this.outputNames)e.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),r.push(Jk(e.loss[a]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new rt(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);r=e.loss.map(u=>Jk(u))}else{let a=Jk(e.loss);this.outputs.forEach(u=>{r.push(a)})}this.lossFunctions=r,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){let u=this.internalOutputShapes[a],c=this.outputNames[a];this.feedOutputNames.push(c),this.feedOutputShapes.push(u),this.feedLossFns.push(this.lossFunctions[a])}let o=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],jp("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let u=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([u,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});let s=i3e(e.metrics,this.outputNames),i=(a,u,c)=>{this.outputNames.length>1&&(u=this.outputNames[a]+"_"+u),this.metricsNames.push(u),this.metricsTensors.push([c,a])};jp("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let u=s[a];(h=>{let f="",g,d,p;for(let m of h){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){let v=this.internalOutputShapes[a];v[v.length-1]===1||this.lossFunctions[a]===s2?["accuracy","acc"].indexOf(m)!==-1?d=AI:["crossentropy","ce"].indexOf(m)!==-1&&(d=tD):this.lossFunctions[a]===o2?["accuracy","acc"].indexOf(m)!==-1?d=nD:["crossentropy","ce"].indexOf(m)!==-1&&(d=N5):["accuracy","acc"].indexOf(m)!==-1?d=OI:["crossentropy","ce"].indexOf(m)!==-1&&(d=RI);let N;["accuracy","acc"].indexOf(m)!==-1?N="acc":["crossentropy","ce"].indexOf(m)!==-1&&(N="ce"),p=d,g=f+N}else p=Ate(m),g=f+MI(m);let y;jp(g,()=>{y=p}),i(a,g,y)}})(u)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,r,o={}){let s=o.batchSize==null?32:o.batchSize;lD(s);let a=this.standardizeUserDataXY(e,r,!0,s);try{let u=a[0].concat(a[1]);this.makeTestFunction();let c=this.testFunction,h=this.testLoop(c,u,s,o.verbose,o.steps);return Li(h)}finally{Z0(a[0],e),Z0(a[1],r)}}evaluateDataset(e,r){return Te(this,null,function*(){return this.makeTestFunction(),Hte(this,e,r)})}checkNumSamples(e,r,o,s="steps"){let i;if(o!=null){if(i=null,r!=null)throw new rt(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${r}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new rt(`Either the input data should have a defined shape, or ${s} shoud be specified.`);return i}execute(e,r){if(Array.isArray(r)&&r.length===0)throw new rt("`outputs` is an empty Array, which is not allowed.");let o=Array.isArray(r),s=o?r:[r],i=this.retrieveSymbolicTensors(s),a=new Jd;if(e instanceof Me&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new rt(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)a.add(this.inputs[c],e[c])}else for(let c of this.inputs){let h=e[c.name];if(h==null)throw new rt(`No value is provided for the model's input ${c.name}`);a.add(c,h)}let u=_x(i,a);return o?u:u[0]}retrieveSymbolicTensors(e){let r=Bl(null,e.length),o=e.length;for(let s of this.layers){let i=Array.isArray(s.output)?s.output:[s.output],a=i.map(u=>u.name);for(let u=0;u<e.length;++u){let c=a.indexOf(e[u]);if(c!==-1&&(r[u]=i[c],o--),o===0)break}if(o===0)break}if(o>0){let s=[];throw r.forEach((i,a)=>{i==null&&s.push(e[a])}),new rt(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(s)}`)}return r}predictLoop(e,r=32,o=!1){return st(()=>{let s=this.checkNumSamples(e);if(o)throw new Bn("Verbose predictLoop() is not implemented yet.");let i=hD(s,r),a=this.outputs.map(u=>[]);for(let u=0;u<i.length;++u)st(()=>{let h=i[u][0],f=i[u][1],g=i2(e,h,f),d=[];if(Array.isArray(g))for(let m=0;m<g.length;++m)d.push({key:this.inputs[m],value:g[m]});else d.push({key:this.inputs[0],value:g});let p=new Jd(d);return _x(this.outputs,p)}).forEach((h,f)=>a[f].push(h));return Li(a.map(u=>$r(u,0)))})}predict(e,r={}){let o=F5(e);Jte(o,this.inputNames,this.feedInputShapes,!1);try{let s=r.batchSize==null?32:r.batchSize;return lD(s),this.predictLoop(o,s)}finally{Z0(o,e)}}predictOnBatch(e){Jte(e,this.inputNames,this.feedInputShapes,!0);let r=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,r)}standardizeUserDataXY(e,r,o=!0,s){if(this.optimizer_==null)throw new bu("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let i=[];for(let a=0;a<this.feedOutputShapes.length;++a){let u=this.feedOutputShapes[a];this.feedLossFns[a]===o2?i.push(u.slice(0,u.length-1).concat([1])):i.push(u)}if(e=Zte(e,this.feedInputNames,this.feedInputShapes,!1,"input"),r=Zte(r,this.feedOutputNames,i,!1,"target"),o3e(e,r,null),s3e(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&s!=null&&s>0&&e[0].shape[0]%s!==0)throw new rt(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${e[0].shape[0]} sample(s).`);return[e,r]}standardizeUserData(e,r,o,s,i=!0,a){return Te(this,null,function*(){let[u,c]=this.standardizeUserDataXY(e,r,i,a);if(o!=null)throw new Error("sample weight is not supported yet.");let h=null;if(s!=null){let f=uD(s,this.outputNames);h=[];for(let g=0;g<f.length;++g)h.push(yield cD(c[g],null,f[g]))}return[u,c,h]})}testLoop(e,r,o,s=0,i){return st(()=>{let a=this.checkNumSamples(r,o,i,"steps"),u=[];if(s>0)throw new Bn("Verbose mode is not implemented yet.");if(i!=null)throw new Bn("steps mode in testLoop() is not implemented yet");{let c=hD(a,o),h=bs(Xa(0,a));for(let f=0;f<c.length;++f){let g=c[f][0],d=c[f][1],p=Zm(h,g,d-g),m=pD(r,p),y=e(m);if(f===0)for(let v=0;v<y.length;++v)u.push(sn(0));for(let v=0;v<y.length;++v){let N=y[v];u[v]=Pt(u[v],Qe(d-g,N))}}for(let f=0;f<u.length;++f)u[f]=hn(u[f],a)}return u})}getDedupedMetricsNames(){let e=this.metricsNames,r=[];for(let o=0;o<e.length;++o){let s=e[o],i=s;if(r5(e,s)>1){let a=r5(e.slice(0,o),s);i+=`_${a}`}r.push(i)}return r}makeTrainFunction(){return e=>{let r=[],o=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],u=()=>{let g=[];for(let y=0;y<this.inputs.length;++y)g.push({key:this.inputs[y],value:o[y]});let d=new Jd(g),p=_x(this.outputs,d,{training:!0}),m;for(let y=0;y<this.lossFunctions.length;++y){let v=this.lossFunctions[y],N=v(s[y],p[y]);i[y]!=null&&(N=jte(N,i[y]));let T=vo(N);r.push(T),y===0?m=N:m=Pt(m,N)}for(let y=0;y<this.metricsTensors.length;++y){let v;if(this.outputs.length>1&&y<this.outputs.length)v=r[y];else{let N=this.metricsTensors[y][0],T=this.metricsTensors[y][1];v=vo(N(s[T],p[T]))}Ko(v),a.push(v)}return m=vo(m),this.calculateLosses().forEach(y=>{m=Pt(m,y)}),m},c=this.collectedTrainableWeights.map(g=>g.read());return[this.optimizer_.minimize(u,!0,c)].concat(a)}}makeTestFunction(){this.testFunction=e=>st(()=>{let r=[],o,s=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let h=0;h<this.inputs.length;++h)a.push({key:this.inputs[h],value:s[h]});let u=new Jd(a),c=_x(this.outputs,u);for(let h=0;h<this.lossFunctions.length;++h){let f=this.lossFunctions[h],g=vo(f(i[h],c[h]));h===0?o=g:o=Pt(o,g),r.push(o)}for(let h=0;h<this.metricsTensors.length;++h){let f=this.metricsTensors[h][0],g=this.metricsTensors[h][1],d=vo(f(i[g],c[g]));r.push(d)}return r})}fit(s,i){return Te(this,arguments,function*(e,r,o={}){return Xte(this,e,r,o)})}fitDataset(e,r){return Te(this,null,function*(){return Wte(this,e,r)})}trainOnBatch(e,r){return Te(this,null,function*(){let o=yield this.standardizeUserData(e,r),s=o[0],i=o[1],u=this.makeTrainFunction()(s.concat(i)),c=[];for(let h of u){let f=yield h.data();c.push(f[0])}return Vn(u),Li(c)})}getNamedWeights(e){let r=[],o=e!=null&&e.trainableOnly,s=o?this.trainableWeights:this.weights,i=this.getWeights(o);for(let a=0;a<s.length;++a)o&&!s[a].trainable||r.push({name:s[a].originalName,tensor:i[a]});return r}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let r=Yv().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=r-Yv().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=zl(this.loss);else if(Array.isArray(this.loss)){for(let r of this.loss)if(typeof r!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(r=>zl(r))}else{let r=Object.keys(this.loss);e={};let o=this.loss;for(let s of r)if(typeof o[s]=="string")e[s]=zl(o[s]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[zl(MI(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>zl(MI(e)));{let e={};for(let r in this.metrics)e[r]=zl(MI(this.metrics[r]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let r=Ix(e.optimizer_config),o=Cu(r),s;if(typeof e.loss=="string")s=Ym(e.loss);else if(Array.isArray(e.loss))s=e.loss.map(a=>Ym(a));else if(e.loss!=null){s={};for(let a in e.loss)s[a]=Ym(e.loss[a])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(a=>Ym(a));else if(e.metrics!=null){i={};for(let a in e.metrics)i[a]=Ym(e.metrics[a])}this.compile({loss:s,metrics:i,optimizer:o})}save(e,r){return Te(this,null,function*(){if(typeof e=="string"){let h=Zi.getSaveHandlers(e);if(h.length===0)throw new rt(`Cannot find any save handlers for URL '${e}'`);if(h.length>1)throw new rt(`Found more than one (${h.length}) save handlers for URL '${e}'`);e=h[0]}if(e.save==null)throw new rt("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let o=yield Zi.encodeWeights(this.getNamedWeights(r)),u={modelTopology:this.toJSON(null,!1),format:a3e,generatedBy:`TensorFlow.js tfjs-layers v${Q0}`,convertedBy:null};if((r==null?!1:r.includeOptimizer)&&this.optimizer!=null){u.trainingConfig=this.getTrainingConfig();let h="optimizer",{data:f,specs:g}=yield Zi.encodeWeights(yield this.optimizer.getWeights(),h);o.specs.push(...g),o.data=Zi.concatenateArrayBuffers([o.data,f])}return this.userDefinedMetadata!=null&&(A5(this.userDefinedMetadata,this.name,!0),u.userDefinedMetadata=this.userDefinedMetadata),u.weightData=o.data,u.weightSpecs=o.specs,e.save(u)})}setUserDefinedMetadata(e){A5(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}return n.className="Model",n})();Lt.registerClass(Gl);u3e=(()=>{class n extends Gl{}return n.className="Functional",n})();Lt.registerClass(u3e)});function ene(n,t){return Te(this,null,function*(){"modelTopology"in n||(n={modelTopology:n}),n=n;let e=n.modelTopology;e.model_config!=null&&(e=e.model_config);let r=Ix(e),o=Cu(r,t);if(n.weightsManifest!=null){let s=yield Zi.loadWeights(n.weightsManifest,n.pathPrefix,o.weights.map(a=>a.originalName)),i={};for(let a of o.weights)i[a.originalName]=s[a.originalName];o.loadWeights(i),Vn(s)}return o})}function tne(n,t){return Te(this,null,function*(){if(t==null&&(t={}),typeof n=="string"){let e=Zi.getLoadHandlers(n,t);if(e.length===0)e.push(Zi.browserHTTPRequest(n,t));else if(e.length>1)throw new rt(`Found more than one (${e.length}) load handlers for URL '${n}'`);n=e[0]}return c3e(n,void 0,t)})}function c3e(n,t,e){return Te(this,null,function*(){if(e==null&&(e={}),n.load==null)throw new rt("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let r=yield n.load(),o=r.modelTopology;o.model_config!=null&&(o=o.model_config);let s=e.strict==null?!0:e.strict,i=r.weightData!=null&&r.weightSpecs!=null&&s,a=Cu(Ix(o),t,i),u=r.trainingConfig;if(u!=null&&a.loadTrainingConfig(u),r.userDefinedMetadata!=null&&a.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new rt("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");let{modelWeights:c,optimizerWeights:h}=l3e(r.weightData,r.weightSpecs);a.loadWeights(c,s),a.optimizer!=null&&h.length>0&&(yield a.optimizer.setWeights(h)),Vn(c),Vn(h.map(f=>f.tensor))}return a})}function l3e(n,t){let e=Zi.decodeWeights(n,t),r={},o=[];return t.forEach(s=>{s.group==="optimizer"?o.push({name:s.name,tensor:e[s.name]}):r[s.name]=e[s.name]}),{modelWeights:r,optimizerWeights:o}}var PI,dD=D(()=>{"use strict";ve();Xw();e2();Ei();FI();So();n2();ws();sD();Ya();PI=(()=>{class n extends Gl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:K0("sequential_"),e.layers!=null)for(let r of e.layers)this.add(r)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(o=>o<0))throw new rt(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){let r=e instanceof n||e instanceof Gl,o;if(r){if(o=e,o.outputs.length!==1)throw new rt("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(o.inputs.length!==1)throw new rt("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new rt("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let s=Xk({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(s)}if(r)this.outputs=o.outputs,this.inputs=o.inputs;else{if(e.inboundNodes.length!==1)throw new rt(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new rt("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=I5(this.outputs[0])}this.inboundNodes=[],new tg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Bl(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(s=>s.shape),outputShapes:this.outputs[0].shape})}else{let s=e.apply(this.outputs[0]);if(Array.isArray(s))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[s],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,r){return this.model==null&&this.build(),this.model.call(e,r)}build(e){if(Vr(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Gl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,r,o=console.log){this.built||this.build(),super.summary(e,r,o)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,r,o={}){if(!this.built)throw new bu("The model needs to be compiled before being used.");return this.model.evaluate(e,r,o)}evaluateDataset(e,r){return Te(this,null,function*(){if(!this.built)throw new bu("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,r)})}predict(e,r={}){return this.model==null&&this.build(),this.model.predict(e,r)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}fit(s,i){return Te(this,arguments,function*(e,r,o={}){if(!this.built)throw new bu("The model needs to be compiled before being used.");return this.model.fit(e,r,o)})}fitDataset(e,r){return Te(this,null,function*(){if(!this.built)throw new bu("The model needs to be compiled before being used.");return this.model.fitDataset(e,r)})}trainOnBatch(e,r){return Te(this,null,function*(){return this.model.trainOnBatch(e,r)})}static fromConfig(e,r,o={},s=!1){let i,a={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new rt("Legacy serialization format not supported yet.");i=r}else Y.assert(r.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=r.layers,delete r.layers,a=r;let u=new e(a);if(!(u instanceof n))throw new Bn(`Sequential.fromConfig called on non-Sequential input: ${u}`);for(let c of i){let f=Cu(c,void 0,s);s&&f.setFastWeightInitDuringBuild(!0),u.add(f)}return u}set stopTraining(e){if(this.model==null)throw new rt("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new rt("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let e=[];for(let r of this.layers){let o={};o.className=r.getClassName(),o.config=r.getConfig(),e.push(o)}return{name:this.name,layers:e}}}return n.className="Sequential",n})();Lt.registerClass(PI)});function nne(n){return new Gl(n)}function rne(n){return new PI(n)}function one(n,t){return t==null&&(t={}),tne(n,t)}function fD(n){return Xk(n)}function sne(n,t){T5.registerCallbackConstructor(n,t)}var $5=D(()=>{"use strict";t2();e2();FI();dD();});function Gp(n){return n.getClassName()}function L5(n,t={}){return Kd(n,Lt.SerializationMap.getMap().classNameMap,t,"activation")}function Wp(n){if(n==null){let t={};return t.className="linear",t.config={},L5(t)}if(typeof n=="string"){let t={};return t.className=n,t.config={},L5(t)}else return n instanceof Iu?n:L5(n)}var Iu,p3e,h3e,d3e,f3e,m3e,g3e,y3e,x3e,b3e,v3e,B5,w3e,S3e,$I=D(()=>{"use strict";ve();ve();sa();ws();Iu=class extends Lt.Serializable{getConfig(){return{}}},p3e=(()=>{class n extends Iu{apply(e,r=1){return yte(e,r)}}return n.className="elu",n})();Lt.registerClass(p3e);h3e=(()=>{class n extends Iu{apply(e){return z0(e)}}return n.className="selu",n})();Lt.registerClass(h3e);d3e=(()=>{class n extends Iu{apply(e){return na(e)}}return n.className="relu",n})();Lt.registerClass(d3e);f3e=(()=>{class n extends Iu{apply(e){return st(()=>gc(6,na(e)))}}return n.className="relu6",n})();Lt.registerClass(f3e);m3e=(()=>{class n extends Iu{apply(e){return e}}return n.className="linear",n})();Lt.registerClass(m3e);g3e=(()=>{class n extends Iu{apply(e){return Ga(e)}}return n.className="sigmoid",n})();Lt.registerClass(g3e);y3e=(()=>{class n extends Iu{apply(e){return bte(e)}}return n.className="hardSigmoid",n})();Lt.registerClass(y3e);x3e=(()=>{class n extends Iu{apply(e){return Rl(e)}}return n.className="softplus",n})();Lt.registerClass(x3e);b3e=(()=>{class n extends Iu{apply(e){return xte(e)}}return n.className="softsign",n})();Lt.registerClass(b3e);v3e=(()=>{class n extends Iu{apply(e){return Rp(e)}}return n.className="tanh",n})();Lt.registerClass(v3e);B5=(()=>{class n extends Iu{apply(e,r=-1){return jd(e,r)}}return n.className="softmax",n})();Lt.registerClass(B5);w3e=(()=>{class n extends Iu{apply(e,r=-1){return R0(e,r)}}return n.className="logSoftmax",n})();Lt.registerClass(w3e);S3e=(()=>{class n extends Iu{apply(e,r=1){return st(()=>Ga(e.mul(r)).mul(e))}}return n.className="swish",n})();Lt.registerClass(S3e)});function z5(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}function une(n){return z5(n),new LI({l1:n!=null?n.l1:null,l2:0})}function cne(n){return z5(n),new LI({l2:n!=null?n.l2:null,l1:0})}function io(n){return Gw(n)}function ane(n,t={}){return Kd(n,Lt.SerializationMap.getMap().classNameMap,t,"regularizer")}function Do(n){if(n==null)return null;if(typeof n=="string"){let e={className:n in ine?ine[n]:n,config:{}};return ane(e)}else return n instanceof mD?n:ane(n)}var mD,LI,ine,ef=D(()=>{"use strict";ve();ve();sa();ws();mD=class extends Lt.Serializable{},LI=(()=>{class n extends mD{constructor(e){super(),z5(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return st(()=>{let r=so([1]);return this.hasL1&&(r=Pt(r,vn(Qe(this.l1,$o(e))))),this.hasL2&&(r=Pt(r,vn(Qe(this.l2,wx(e))))),r.asScalar()})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,r){return new e({l1:r.l1,l2:r.l2})}}return n.className="L1L2",n})();Lt.registerClass(LI);ine={l1l2:"L1L2"}});var V5,j5,U5,q5,G5,W5,lne=D(()=>{"use strict";ve();$I();sa();Qm();Ei();So();qp();ef();Ya();V5=(()=>{class n extends ir{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,r){e=or(e);let o=na(e);return this.maxValue!=null&&(o=li(o,0,this.maxValue)),o}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},r=super.getConfig();return Object.assign(e,r),e}}return n.className="ReLU",n})();Lt.registerClass(V5);j5=(()=>{class n extends ir{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=or(e);return Pd(o,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return n.className="LeakyReLU",n})();Lt.registerClass(j5);U5=(()=>{class n extends ir{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Co(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Do(e.alphaRegularizer),this.alphaConstraint=ps(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new rt(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Vr(e);let r=e.slice(1);if(this.sharedAxes!=null)for(let s of this.sharedAxes)r[s-1]=1;this.alpha=this.addWeight("alpha",r,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let o={};if(this.sharedAxes!=null)for(let s=1;s<e.length;++s)o[s]=e[s];this.inputSpec=[new zo({ndim:e.length,axes:o})],this.built=!0}call(e,r){return e=or(e),Vd(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Bo(this.alphaInitializer),alphaRegularizer:io(this.alphaRegularizer),alphaConstraint:ls(this.alphaConstraint),sharedAxes:this.sharedAxes},r=super.getConfig();return Object.assign(e,r),e}}return n.className="PReLU",n})();Lt.registerClass(U5);q5=(()=>{class n extends ir{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Bn(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=or(e);return Al(o)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return n.className="ELU",n})();Lt.registerClass(q5);G5=(()=>{class n extends ir{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,r){let o=or(e);return o.mul(Jm(o.greater(this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},r=super.getConfig();return Object.assign(e,r),e}}return n.className="ThresholdedReLU",n})();Lt.registerClass(G5);W5=(()=>{class n extends ir{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new B5().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,r){let o=or(e);return this.softmax(o,this.axis)}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Softmax",n})();Lt.registerClass(W5)});function J0(n,t,e){if(typeof n=="number")return Bl(n,t);if(n.length!==t)throw new rt(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${n.length} elements.`);for(let r=0;r<t;++r){let o=n[r];if(!hte(o))throw new rt(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(n)} including a non-integer number ${o}`)}return n}function Wu(n,t,e,r,o=1){if(n==null)return n;let s=t+(t-1)*(o-1),i;return e==="same"?i=n:i=n-s+1,Math.floor((i+r-1)/r)}function BI(n,t,e,r){if(n==null)return null;if(r==="valid")n=n*t+Up([e-t,0]);else if(r==="same")n=n*t;else throw new rt(`Unsupport padding mode: ${r}.`);return n}var zI=D(()=>{"use strict";So();ws();Yd();});function jI(n,t){return st(()=>(os(t),t==="channelsFirst"?Dr(n,[0,2,3,1]):n))}function H5(n,t){return st(()=>(os(t),t==="channelsFirst"?Dr(n,[0,2,3,4,1]):n))}function I3e(n,t,e,r=1,o="valid",s,i=1){return st(()=>{if(s==null&&(s=xu()),os(s),n.shape.length!==3)throw new rt(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(t.shape.length!==3)throw new rt(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new rt(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(s==="channelsFirst"&&(n=Dr(n,[0,2,1])),o==="causal")throw new Bn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=I0(n,t,r,o==="same"?"same":"valid","NWC",i);return e!=null&&(a=qu(a,e)),a})}function pne(n,t,e,r=[1,1],o="valid",s,i,a=null){return st(()=>{if(s==null&&(s=xu()),os(s),n.rank!==3&&n.rank!==4)throw new rt(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(t.rank!==3&&t.rank!==4)throw new rt(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let u=jI(n,s);if(o==="causal")throw new Bn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=Jc.conv2d({x:u,filter:t,strides:r,pad:o==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:e,activation:a}),s==="channelsFirst"&&(u=Dr(u,[0,3,1,2])),u})}function _3e(n,t,e,r=[1,1,1],o="valid",s,i){return st(()=>{if(s==null&&(s=xu()),os(s),n.rank!==4&&n.rank!==5)throw new rt(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(t.rank!==4&&t.rank!==5)throw new rt(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=H5(n,s);if(o==="causal")throw new Bn("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=lw(a,t,r,o==="same"?"same":"valid","NDHWC",i),e!=null&&(a=qu(a,e)),s==="channelsFirst"&&(a=Dr(a,[0,4,1,2,3])),a})}var VI,a2,gD,K5,X5,T3e,Y5,Q5,Z5,J5,yD=D(()=>{"use strict";ve();ve();$I();Xm();sa();jl();Qm();Ei();So();qp();ef();zI();ws();Ya();VI=class n extends ir{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(e),this.rank=t,Os(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Bn(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=J0(e.kernelSize,t,"kernelSize"),this.strides=J0(e.strides==null?1:e.strides,t,"strides"),this.padding=e.padding==null?"valid":e.padding,vu(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,os(this.dataFormat),this.activation=Wp(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=Co(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=ps(e.biasConstraint),this.biasRegularizer=Do(e.biasRegularizer),this.activityRegularizer=Do(e.activityRegularizer),this.dilationRate=J0(e.dilationRate==null?1:e.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new rt(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new rt(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new rt(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(tl("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!Ok(t.kernelSize,"number",1,3))throw new rt(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){let t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Gp(this.activation),useBias:this.useBias,biasInitializer:Bo(this.biasInitializer),biasRegularizer:io(this.biasRegularizer),activityRegularizer:io(this.activityRegularizer),biasConstraint:ls(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}},a2=class n extends VI{constructor(t,e){super(t,e),this.kernel=null,n.verifyArgs(e),this.filters=e.filters,Os(this.filters,"filters"),this.kernelInitializer=Co(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=ps(e.kernelConstraint),this.kernelRegularizer=Do(e.kernelRegularizer)}build(t){t=Vr(t);let e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new rt(`The channel dimension of the input should be defined. Found ${t[e]}`);let r=t[e],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:r}}],this.built=!0}call(t,e){return st(()=>{t=or(t);let r,o=this.bias==null?null:this.bias.read(),s=Rk(this.activation.getClassName());if(s!=null&&this.rank===2)r=pne(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)r=I3e(t,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=pne(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=_3e(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Bn("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(t){t=Vr(t);let e=[],r=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let s=0;s<r.length;++s){let i=Wu(r[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);e.push(i)}let o=[t[0]];return this.dataFormat==="channelsLast"?(o=o.concat(e),o.push(this.filters)):(o.push(this.filters),o=o.concat(e)),o}getConfig(){let t={filters:this.filters,kernelInitializer:Bo(this.kernelInitializer),kernelRegularizer:io(this.kernelRegularizer),kernelConstraint:ls(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new rt(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}},gD=(()=>{class n extends a2{constructor(e){super(2,e),n.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Ok(e.kernelSize,"number",1,2))throw new rt(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}return n.className="Conv2D",n})();Lt.registerClass(gD);K5=(()=>{class n extends a2{constructor(e){super(3,e),n.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new rt(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}return n.className="Conv3D",n})();Lt.registerClass(K5);X5=(()=>{class n extends gD{constructor(e){if(super(e),this.inputSpec=[new zo({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new rt(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Vr(e),e.length!==4)throw new rt("Input should have rank 4; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new rt("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],s=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new zo({ndim:4,axes:{[r]:o}})],this.built=!0}call(e,r){return st(()=>{let o=or(e);if(o.shape.length!==4)throw new rt(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let s=o.shape,i=s[0],a,u;this.dataFormat==="channelsFirst"?(a=2,u=3):(a=1,u=2);let c=s[a],h=s[u],f=this.kernelSize[0],g=this.kernelSize[1],d=this.strides[0],p=this.strides[1],m=BI(c,d,f,this.padding),y=BI(h,p,g,this.padding),v=[i,m,y,this.filters];this.dataFormat!=="channelsLast"&&(o=Dr(o,[0,2,3,1]));let N=_0(o,this.kernel.read(),v,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(N=Dr(N,[0,3,1,2])),this.bias!=null&&(N=qu(N,this.bias.read(),this.dataFormat)),this.activation!=null&&(N=this.activation.apply(N)),N})}computeOutputShape(e){e=Vr(e);let r=e.slice(),o,s,i;this.dataFormat==="channelsFirst"?(o=1,s=2,i=3):(o=3,s=1,i=2);let a=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],h=this.strides[1];return r[o]=this.filters,r[s]=BI(r[s],c,a,this.padding),r[i]=BI(r[i],h,u,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return n.className="Conv2DTranspose",n})();Lt.registerClass(X5);T3e=(()=>{class n extends a2{constructor(e,r){if(super(e,r),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,r.filters==null)throw new rt("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new rt("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new rt(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(r.padding)}`);this.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,this.depthwiseInitializer=Co(r.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Do(r.depthwiseRegularizer),this.depthwiseConstraint=ps(r.depthwiseConstraint),this.pointwiseInitializer=Co(r.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Do(r.pointwiseRegularizer),this.pointwiseConstraint=ps(r.pointwiseConstraint)}build(e){if(e=Vr(e),e.length<this.rank+2)throw new rt(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null||e[r]<0)throw new rt(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[r])}`);let o=e[r],s=this.kernelSize.concat([o,this.depthMultiplier]),i=[];for(let u=0;u<this.rank;++u)i.push(1);i.push(o*this.depthMultiplier,this.filters);let a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new zo({ndim:this.rank+2,axes:{[r]:o}})],this.built=!0}call(e,r){return st(()=>{e=or(e);let o;if(this.rank===1)throw new Bn("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Dr(e,[0,2,3,1])),o=kw(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(o=qu(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),this.dataFormat==="channelsFirst"&&(o=Dr(o,[0,3,1,2])),o})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Bo(this.depthwiseInitializer),e.pointwiseInitializer=Bo(this.pointwiseInitializer),e.depthwiseRegularizer=io(this.depthwiseRegularizer),e.pointwiseRegularizer=io(this.pointwiseRegularizer),e.depthwiseConstraint=ls(this.depthwiseConstraint),e.pointwiseConstraint=ls(this.pointwiseConstraint),e}}return n.className="SeparableConv",n})(),Y5=(()=>{class n extends T3e{constructor(e){super(2,e)}}return n.className="SeparableConv2D",n})();Lt.registerClass(Y5);Q5=(()=>{class n extends a2{constructor(e){super(1,e),n.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){let e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Ok(e.kernelSize,"number",1,1))throw new rt(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}return n.className="Conv1D",n})();Lt.registerClass(Q5);Z5=(()=>{class n extends ir{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,r){return st(()=>{if(e=or(e),this.dataFormat==="channelsLast"){let o=vI(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return vI(o,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let o=vI(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return vI(o,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Cropping2D",n})();Lt.registerClass(Z5);J5=(()=>{class n extends ir{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,os(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,lte(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let r=e[2]==null?null:this.size[0]*e[2],o=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],r,o]}else{let r=e[1]==null?null:this.size[0]*e[1],o=e[2]==null?null:this.size[1]*e[2];return[e[0],r,o,e[3]]}}call(e,r){return st(()=>{let o=or(e),s=o.shape;if(this.dataFormat==="channelsFirst"){o=Dr(o,[0,2,3,1]);let i=this.size[0]*s[2],a=this.size[1]*s[3],u=this.interpolation==="nearest"?o.resizeNearestNeighbor([i,a]):o.resizeBilinear([i,a]);return Dr(u,[0,3,1,2])}else{let i=this.size[0]*s[1],a=this.size[1]*s[2];return this.interpolation==="nearest"?o.resizeNearestNeighbor([i,a]):o.resizeBilinear([i,a])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return n.className="UpSampling2D",n})();Lt.registerClass(J5)});function E3e(n,t,e=[1,1],r="valid",o,s){return st(()=>{o==null&&(o=xu()),os(o);let i=jI(n,o);if(n.rank!==4)throw new rt(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(t.rank!==4)throw new rt(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return i=fc(i,t,e,r==="same"?"same":"valid","NHWC",s),o==="channelsFirst"&&(i=Dr(i,[0,3,1,2])),i})}var e6,hne=D(()=>{"use strict";ve();ve();Xm();sa();jl();Qm();So();qp();ef();zI();Ya();yD();e6=(()=>{class n extends VI{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Co(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=ps(e.depthwiseConstraint),this.depthwiseRegularizer=Do(e.depthwiseRegularizer)}build(e){if(e=Vr(e),e.length<4)throw new rt(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let r=this.dataFormat==="channelsFirst"?1:3;if(e[r]==null||e[r]<0)throw new rt(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[r]}).`);let o=e[r],s=[this.kernelSize[0],this.kernelSize[1],o,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[o*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return st(()=>{e=or(e);let o=E3e(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(o=qu(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),o})}computeOutputShape(e){e=Vr(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],o=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Wu(r,this.kernelSize[0],this.padding,this.strides[0]),a=Wu(o,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],s,i,a]:[e[0],i,a,s]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Bo(this.depthwiseInitializer),e.depthwiseRegularizer=io(this.depthwiseRegularizer),e.depthwiseConstraint=ls(this.depthwiseRegularizer),e}}return n.className="DepthwiseConv2D",n})();Lt.registerClass(e6)});function t6(n,t,e,r){if(Array.isArray(n)){if(t!=null||e!=null)throw new rt("When inputs is an array, neither initialState or constants should be provided");r!=null&&(e=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(t=n.slice(1,n.length)),n=n[0]}function o(s){return s==null||Array.isArray(s)?s:[s]}return t=o(t),e=o(e),{inputs:n,initialState:t,constants:e}}function n6(n,t,e,r=!1,o,s,i=!1,a=!1){return st(()=>{let u=t.shape.length;if(u<3)throw new rt(`Input should be at least 3D, but is ${u}D.`);let c=[1,0].concat(Xa(2,u));if(t=Dr(t,c),s!=null)throw new Bn("The rnn() functoin of the deeplearn.js backend does not support constants yet.");i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=o.asType("bool").asType("float32"),o.rank===u-1&&(o=Pi(o,-1)),o=Dr(o,c)),r&&(t=Ds(t,0),o!=null&&(o=Ds(o,0)));let h=[],f,g=e,d=t.shape[0],p=mi(t),m;o!=null&&(m=mi(o));for(let v=0;v<d;++v){let N=p[v],T=st(()=>n(N,g));if(o==null)f=T[0],g=T[1];else{let O=st(()=>{let S=m[v],F=ei(S).sub(S),R=T[0].mul(S).add(g[0].mul(F)),L=g.map((q,U)=>T[1][U].mul(S).add(q.mul(F)));return{output:R,newStates:L}});f=O.output,g=O.newStates}a&&h.push(f)}let y;return a&&(y=xs(h,1)),[f,y,g]})}function og(n){let{ones:t,rate:e,training:r=!1,count:o=1}=n,s=()=>Bk(t(),e),i=()=>H0(s,t,r);return!o||o<=1?Ko(i().clone()):Array(o).fill(void 0).map(i).map(u=>Ko(u.clone()))}var Hp,rg,xD,r6,bD,o6,u2,s6,vD,UI=D(()=>{"use strict";ve();ve();$I();sa();jl();Qm();Ei();Ei();So();qp();ef();ws();Yd();Ya();CI();n2();Hp=(()=>{class n extends ir{constructor(e){super(e);let r;if(e.cell==null)throw new rt("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?r=new vD({cells:e.cell}):r=e.cell,r.stateSize==null)throw new rt("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=r,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new zo({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Xa(0,e).map(r=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Kk(e)&&(e=e[0]),e=e;let r=this.cell.stateSize;Array.isArray(r)||(r=[r]);let o=r[0],s;if(this.returnSequences?s=[e[0],e[1],o]:s=[e[0],o],this.returnState){let i=[];for(let a of r)i.push([e[0],a]);return[s].concat(i)}else return s}computeMask(e,r){return st(()=>{Array.isArray(r)&&(r=r[0]);let o=this.returnSequences?r:null;if(this.returnState){let s=this.states.map(i=>null);return[o].concat(s)}else return o})}get states(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[];for(let o=0;o<e;++o)r.push(null);return r}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Bn("Constants support is not implemented in RNN yet.");Kk(e)&&(e=e[0]),e=e;let o=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new zo({shape:[o,null,...s]});let i=[e[0]].concat(e.slice(2));this.cell.build(i);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!Y.arraysEqual(this.stateSpec.map(u=>u.shape[u.shape.length-1]),a))throw new rt(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(u=>new zo({shape:[null,u]}));this.stateful&&this.resetStates()}resetStates(e,r=!1){st(()=>{if(!this.stateful)throw new el("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape[0];if(o==null)throw new rt("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>so([o,s])):this.states_=[so([o,this.cell.stateSize])];else if(e==null)Vn(this.states_),this.keptStates!=null&&(Vn(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>so([o,s])):this.states_[0]=so([o,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new rt(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r===!0?this.keptStates.push(this.states_.slice()):Vn(this.states_);for(let s=0;s<this.states_.length;++s){let i=e[s],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[s]:this.cell.stateSize,u=[o,a];if(!Y.arraysEqual(i.shape,u))throw new rt(`State ${s} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${i.shape}`);this.states_[s]=i}}this.states_=this.states_.map(s=>Ko(s.clone()))})}apply(e,r){let o=r==null?null:r.initialState,s=r==null?null:r.constants;r==null&&(r={});let i=t6(e,o,s,this.numConstants);e=i.inputs,o=i.initialState,s=i.constants;let a=[],u=[];if(o!=null){r.initialState=o,a=a.concat(o),this.stateSpec=[];for(let h of o)this.stateSpec.push(new zo({shape:h.shape}));u=u.concat(this.stateSpec)}if(s!=null&&(r.constants=s,a=a.concat(s),this.numConstants=s.length),a[0]instanceof Ta){let h=[e].concat(a),f=this.inputSpec.concat(u),g=this.inputSpec;this.inputSpec=f;let d=super.apply(h,r);return this.inputSpec=g,d}else return super.apply(e,r)}call(e,r){return st(()=>{let o=r==null?null:r.mask,s=r==null?null:r.training,i=r==null?null:r.initialState;e=or(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));let a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==a)throw new rt(`RNN Layer has ${a} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let u={training:s},h=n6((m,y)=>{let v=this.cell.call([m].concat(y),u);return[v[0],v.slice(1)]},e,i,this.goBackwards,o,null,this.unroll,this.returnSequences),f=h[0],g=h[1],d=h[2];this.stateful&&this.resetStates(d,s);let p=this.returnSequences?g:f;return this.returnState?[p].concat(d):p})}getInitialState(e){return st(()=>{let r=so(e.shape);return r=vn(r,[1,2]),r=eg(r),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(o=>o>1?$k(r,[1,o]):r):this.cell.stateSize>1?[$k(r,[1,this.cell.stateSize])]:[r]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){let e=super.getConfig(),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);let o=this.cell.getConfig();return this.getClassName()===n.className&&(r.cell={className:this.cell.getClassName(),config:o}),Object.assign({},o,e,r)}static fromConfig(e,r,o={}){let s=r.cell,i=Cu(s,o);return new e(Object.assign(r,{cell:i}))}}return n.className="RNN",n})();Lt.registerClass(Hp);rg=class extends ir{},xD=(()=>{class n extends rg{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Os(this.units,"units"),this.activation=Wp(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Co(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Co(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Co(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Do(e.kernelRegularizer),this.recurrentRegularizer=Do(e.recurrentRegularizer),this.biasRegularizer=Do(e.biasRegularizer),this.kernelConstraint=ps(e.kernelConstraint),this.recurrentConstraint=ps(e.recurrentConstraint),this.biasConstraint=ps(e.biasConstraint),this.dropout=vx([1,Up([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=vx([1,Up([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Vr(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return st(()=>{if(e=e,e.length!==2)throw new rt(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let o=e[1];e=e[0];let s=r.training==null?!1:r.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=og({ones:()=>ei(e),rate:this.dropout,training:s})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=og({ones:()=>ei(o),rate:this.recurrentDropout,training:s}));let i,a=this.dropoutMask,u=this.recurrentDropoutMask;a!=null?i=ql(Qe(e,a),this.kernel.read()):i=ql(e,this.kernel.read()),this.bias!=null&&(i=qu(i,this.bias.read())),u!=null&&(o=Qe(o,u));let c=Pt(i,ql(o,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Gp(this.activation),useBias:this.useBias,kernelInitializer:Bo(this.kernelInitializer),recurrentInitializer:Bo(this.recurrentInitializer),biasInitializer:Bo(this.biasInitializer),kernelRegularizer:io(this.kernelRegularizer),recurrentRegularizer:io(this.recurrentRegularizer),biasRegularizer:io(this.biasRegularizer),activityRegularizer:io(this.activityRegularizer),kernelConstraint:ls(this.kernelConstraint),recurrentConstraint:ls(this.recurrentConstraint),biasConstraint:ls(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,r)}}return n.className="SimpleRNNCell",n})();Lt.registerClass(xD);r6=(()=>{class n extends Hp{constructor(e){e.cell=new xD(e),super(e)}call(e,r){return st(()=>{this.cell.dropoutMask!=null&&(Vn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Vn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,s=r==null?null:r.training,i=r==null?null:r.initialState;return super.call(e,{mask:o,training:s,initialState:i})})}static fromConfig(e,r){return new e(r)}}return n.className="SimpleRNN",n})();Lt.registerClass(r6);bD=(()=>{class n extends rg{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new rt("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Os(this.units,"units"),this.activation=Wp(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Wp(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Co(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Co(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Co(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Do(e.kernelRegularizer),this.recurrentRegularizer=Do(e.recurrentRegularizer),this.biasRegularizer=Do(e.biasRegularizer),this.kernelConstraint=ps(e.kernelConstraint),this.recurrentConstraint=ps(e.recurrentConstraint),this.biasConstraint=ps(e.biasConstraint),this.dropout=vx([1,Up([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=vx([1,Up([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Vr(e);let r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return st(()=>{if(e=e,e.length!==2)throw new rt(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training==null?!1:r.training,s=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=og({ones:()=>ei(e),rate:this.dropout,training:o,count:3})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=og({ones:()=>ei(s),rate:this.recurrentDropout,training:o,count:3}));let i=this.dropoutMask,a=this.recurrentDropoutMask,u,c,h;0<this.dropout&&this.dropout<1&&(e=Qe(e,i[0]));let f=ql(e,this.kernel.read());this.useBias&&(f=qu(f,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=Qe(s,a[0]));let g=this.recurrentKernel.read(),[d,p]=fi(g,[2*this.units,this.units],g.rank-1),m=ql(s,d),[y,v,N]=fi(f,3,f.rank-1),[T,O]=fi(m,2,m.rank-1);u=this.recurrentActivation.apply(Pt(y,T)),c=this.recurrentActivation.apply(Pt(v,O));let S=ql(Qe(c,s),p);h=this.activation.apply(Pt(N,S));let F=Pt(Qe(u,s),Qe(Pt(1,Er(u)),h));return[F,F]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Gp(this.activation),recurrentActivation:Gp(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Bo(this.kernelInitializer),recurrentInitializer:Bo(this.recurrentInitializer),biasInitializer:Bo(this.biasInitializer),kernelRegularizer:io(this.kernelRegularizer),recurrentRegularizer:io(this.recurrentRegularizer),biasRegularizer:io(this.biasRegularizer),activityRegularizer:io(this.activityRegularizer),kernelConstraint:ls(this.kernelConstraint),recurrentConstraint:ls(this.recurrentConstraint),biasConstraint:ls(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,r)}}return n.className="GRUCell",n})();Lt.registerClass(bD);o6=(()=>{class n extends Hp{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new bD(e),super(e)}call(e,r){return st(()=>{this.cell.dropoutMask!=null&&(Vn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Vn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,s=r==null?null:r.training,i=r==null?null:r.initialState;return super.call(e,{mask:o,training:s,initialState:i})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return n.className="GRU",n})();Lt.registerClass(o6);u2=(()=>{class n extends rg{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Os(this.units,"units"),this.activation=Wp(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Wp(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Co(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Co(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Co(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Do(e.kernelRegularizer),this.recurrentRegularizer=Do(e.recurrentRegularizer),this.biasRegularizer=Do(e.biasRegularizer),this.kernelConstraint=ps(e.kernelConstraint),this.recurrentConstraint=ps(e.recurrentConstraint),this.biasConstraint=ps(e.biasConstraint),this.dropout=vx([1,Up([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=vx([1,Up([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var r;e=Vr(e);let o=e[e.length-1];this.kernel=this.addWeight("kernel",[o,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let s;if(this.useBias){if(this.unitForgetBias){let i=this.biasInitializer,a=this.units;s=new(r=class extends Su{apply(c,h){let f=i.apply([a]),g=new wI().apply([a]),d=i.apply([a*2]);return f5(f5(f,g),d)}},r.className="CustomInit",r)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,r){return st(()=>{let o=r.training==null?!1:r.training;if(e=e,e.length!==3)throw new rt(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let s=e[1],i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=og({ones:()=>ei(e),rate:this.dropout,training:o,count:4})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=og({ones:()=>ei(s),rate:this.recurrentDropout,training:o,count:4}));let a=this.dropoutMask,u=this.recurrentDropoutMask,c,h,f,g;0<this.dropout&&this.dropout<1&&(e=Qe(e,a[0]));let d=ql(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=Qe(s,u[0])),d=Pt(d,ql(s,this.recurrentKernel.read())),this.useBias&&(d=qu(d,this.bias.read()));let[p,m,y,v]=fi(d,4,d.rank-1);c=this.recurrentActivation.apply(p),h=this.recurrentActivation.apply(m),f=Pt(Qe(h,i),Qe(c,this.activation.apply(y))),g=this.recurrentActivation.apply(v);let N=Qe(g,this.activation.apply(f));return[N,N,f]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Gp(this.activation),recurrentActivation:Gp(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Bo(this.kernelInitializer),recurrentInitializer:Bo(this.recurrentInitializer),biasInitializer:Bo(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:io(this.kernelRegularizer),recurrentRegularizer:io(this.recurrentRegularizer),biasRegularizer:io(this.biasRegularizer),activityRegularizer:io(this.activityRegularizer),kernelConstraint:ls(this.kernelConstraint),recurrentConstraint:ls(this.recurrentConstraint),biasConstraint:ls(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,r)}}return n.className="LSTMCell",n})();Lt.registerClass(u2);s6=(()=>{class n extends Hp{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new u2(e),super(e)}call(e,r){return st(()=>{this.cell.dropoutMask!=null&&(Vn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Vn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,s=r==null?null:r.training,i=r==null?null:r.initialState;return super.call(e,{mask:o,training:s,initialState:i})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return n.className="LSTM",n})();Lt.registerClass(s6);vD=(()=>{class n extends rg{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let r of this.cells.slice().reverse())Array.isArray(r.stateSize)?e.push(...r.stateSize):e.push(r.stateSize);return e}call(e,r){return st(()=>{e=e;let o=e.slice(1),s=[];for(let u of this.cells.slice().reverse())Array.isArray(u.stateSize)?s.push(o.splice(0,u.stateSize.length)):s.push(o.splice(0,1));s.reverse();let i=[],a;for(let u=0;u<this.cells.length;++u){let c=this.cells[u];o=s[u],u===0?a=[e[0]].concat(o):a=[a[0]].concat(o),a=c.call(a,r),i.push(a.slice(1))}o=[];for(let u of i.slice().reverse())o.push(...u);return[a[0]].concat(o)})}build(e){Kk(e)&&(e=e[0]),e=e;let r;this.cells.forEach((o,s)=>{jp(`RNNCell_${s}`,()=>{o.build(e),Array.isArray(o.stateSize)?r=o.stateSize[0]:r=o.stateSize,e=[e[0],r]})}),this.built=!0}getConfig(){let e=super.getConfig(),r=i=>({className:i.getClassName(),config:i.getConfig()}),s={cells:this.cells.map(r)};return Object.assign({},e,s)}static fromConfig(e,r,o={}){let s=[];for(let i of r.cells)s.push(Cu(i,o));return new e({cells:s})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let r of this.cells)e.push(...r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.cells)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let o of this.cells)r.push(...o.trainableWeights);return r.concat(e)}return e}getWeights(){let e=[];for(let r of this.cells)e.push(...r.weights);return SI(e)}setWeights(e){let r=[];for(let o of this.cells){let s=o.weights.length,i=e.splice(s);for(let a=0;a<o.weights.length;++a)r.push([o.weights[a],i[a]])}Jw(r)}}return n.className="StackedRNNCells",n})();Lt.registerClass(vD)});var N3e,k3e,wD,i6,dne=D(()=>{"use strict";ve();ve();sa();jl();Ei();So();qp();zI();ws();Ya();UI();N3e=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(e[r[o]]=n[r[o]]);return e},k3e=(()=>{class n extends Hp{constructor(e){if(e.unroll)throw new Bn("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Bn("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new zo({ndim:5})]}call(e,r){return st(()=>{if(this.cell.dropoutMask!=null&&(Vn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Vn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),r&&r.constants)throw new rt("ConvRNN2D cell does not support constants");let o=r==null?null:r.mask,s=r==null?null:r.training,i=r==null?null:r.initialState;return super.call(e,{mask:o,training:s,initialState:i})})}computeOutputShape(e){let r=this.computeSingleOutputShape(e);return this.returnSequences||(r=[r[0],...r.slice(2)]),this.returnState&&(r=[r,...Array(2).fill([e[0],...r.slice(-3)])]),r}getInitialState(e){return st(()=>{let{stateSize:r}=this.cell,o=e.shape,s=this.computeSingleOutputShape(o),i=[s[0],...s.slice(2)],a=so(i);return Array.isArray(r)?Array(r.length).fill(a):[a]})}resetStates(e,r=!1){st(()=>{if(!this.stateful)throw new el("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape,s=this.computeSingleOutputShape(o),i=[s[0],...s.slice(2)];if(o[0]==null)throw new rt("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>so(i)):this.states_=[so(i)];else if(e==null)Vn(this.states_),this.keptStates!=null&&(Vn(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>so(i)):this.states_[0]=so(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new rt(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r?this.keptStates.push(this.states_.slice()):Vn(this.states_);for(let u=0;u<this.states_.length;++u){let c=e[u],h=i;if(!Y.arraysEqual(c.shape,h))throw new rt(`State ${u} is incompatible with layer ${this.name}: expected shape=${h}, received shape=${c.shape}`);this.states_[u]=c}}this.states_=this.states_.map(u=>Ko(u.clone()))})}computeSingleOutputShape(e){let{dataFormat:r,filters:o,kernelSize:s,padding:i,strides:a,dilationRate:u}=this.cell,c=r==="channelsFirst",h=e[c?3:2],f=e[c?4:3],g=Wu(h,s[0],i,a[0],u[0]),d=Wu(f,s[1],i,a[1],u[1]);return[...e.slice(0,2),...c?[o,g,d]:[g,d,o]]}}return n.className="ConvRNN2D",n})(),wD=(()=>{class n extends u2{constructor(e){let{filters:r,kernelSize:o,strides:s,padding:i,dataFormat:a,dilationRate:u}=e;super(Object.assign({},e,{units:r})),this.filters=r,Os(this.filters,"filters"),this.kernelSize=J0(o,2,"kernelSize"),this.kernelSize.forEach(c=>Os(c,"kernelSize")),this.strides=J0(s||1,2,"strides"),this.strides.forEach(c=>Os(c,"strides")),this.padding=i||"valid",vu(this.padding),this.dataFormat=a||"channelsLast",os(this.dataFormat),this.dilationRate=J0(u||1,2,"dilationRate"),this.dilationRate.forEach(c=>Os(c,"dilationRate"))}build(e){var r;e=Vr(e);let o=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[o]==null)throw new rt(`The channel dimension of the input should be defined. Found ${e[o]}`);let s=e[o],i=4,a=this.kernelSize.concat([s,this.filters*i]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let u=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){let h=this.biasInitializer,f=this.filters;c=new(r=class extends Su{apply(d,p){let m=h.apply([f]),y=ta([f]),v=h.apply([f*2]);return Hw([m,y,v])}},r.className="CustomInit",r)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,r){return st(()=>{if(e.length!==3)throw new rt(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training||!1,s=e[0],i=e[1],a=e[2],u=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=og({ones:()=>ei(s),rate:this.dropout,training:o,count:u}));let c=this.dropoutMask,h=(Le,Ve,qe)=>!Ve||!Ve[qe]?Le:Qe(Ve[qe],Le),f=h(s,c,0),g=h(s,c,1),d=h(s,c,2),p=h(s,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=og({ones:()=>ei(i),rate:this.recurrentDropout,training:o,count:u}));let m=this.recurrentDropoutMask,y=h(i,m,0),v=h(i,m,1),N=h(i,m,2),T=h(i,m,3),O=3,[S,F,R,L]=fi(this.kernel.read(),u,O),[q,U,Z,ee]=this.useBias?fi(this.bias.read(),u):[null,null,null,null];f=this.inputConv(f,S,q,this.padding),g=this.inputConv(g,F,U,this.padding),d=this.inputConv(d,R,Z,this.padding),p=this.inputConv(p,L,ee,this.padding);let[Q,oe,se,pe]=fi(this.recurrentKernel.read(),u,O);y=this.recurrentConv(y,Q),v=this.recurrentConv(v,oe),N=this.recurrentConv(N,se),T=this.recurrentConv(T,pe);let ae=this.recurrentActivation.apply(Pt(f,y)),fe=this.recurrentActivation.apply(Pt(g,v)),he=Pt(Qe(fe,a),Qe(ae,this.activation.apply(Pt(d,N)))),Ee=Qe(this.recurrentActivation.apply(Pt(p,T)),this.activation.apply(he));return[Ee,Ee,he]})}getConfig(){let e=super.getConfig(),{units:r}=e,o=N3e(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},o,s)}inputConv(e,r,o,s){let i=Wa(e,r,this.strides,s||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return o?qu(i,o,this.dataFormat):i}recurrentConv(e,r){return Wa(e,r,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}return n.className="ConvLSTM2DCell",n})();Lt.registerClass(wD);i6=(()=>{class n extends k3e{constructor(e){let r=new wD(e);super(Object.assign({},e,{cell:r}))}static fromConfig(e,r){return new e(r)}}return n.className="ConvLSTM2D",n})();Lt.registerClass(i6)});var SD,a6,u6,c6,l6,p6,h6,d6,f6,fne=D(()=>{"use strict";ve();$I();sa();Qm();Ei();So();qp();ef();ws();Yd();Ya();SD=(()=>{class n extends ir{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let r=e.shape,o=[];for(let s=0;s<this.noiseShape.length;++s)o.push(this.noiseShape[s]==null?r[s]:this.noiseShape[s]);return o}call(e,r){return st(()=>{this.invokeCallHook(e,r);let o=or(e);if(0<this.rate&&this.rate<1){let s=r.training==null?!1:r.training,i=this.getNoiseShape(o);return H0(()=>Bk(o,this.rate,i,this.seed),()=>o,s)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=super.getConfig();return Object.assign(e,r),e}dispose(){return super.dispose()}}return n.className="Dropout",n})();Lt.registerClass(SD);a6=(()=>{class n extends SD{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let r=e.shape;return[r[0],1,r[2]]}}return n.className="SpatialDropout1D",n})();Lt.registerClass(a6);u6=(()=>{class n extends ir{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),this.batchInputShape=[r,e.inputDim]}this.units=e.units,Os(this.units,"units"),this.activation=Wp(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Co(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Co(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=ps(e.kernelConstraint),this.biasConstraint=ps(e.biasConstraint),this.kernelRegularizer=Do(e.kernelRegularizer),this.biasRegularizer=Do(e.biasRegularizer),this.activityRegularizer=Do(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Vr(e);let r=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[r,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:r}}],this.built=!0}computeOutputShape(e){e=Vr(e);let r=e.slice();return r[r.length-1]=this.units,r}call(e,r){return st(()=>{this.invokeCallHook(e,r);let o=or(e),s=Rk(this.activation.getClassName()),i;return s!=null?i=ql(o,this.kernel.read(),s,this.bias?this.bias.read():null):(i=ql(o,this.kernel.read()),this.bias!=null&&(i=qu(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){let e={units:this.units,activation:Gp(this.activation),useBias:this.useBias,kernelInitializer:Bo(this.kernelInitializer),biasInitializer:Bo(this.biasInitializer),kernelRegularizer:io(this.kernelRegularizer),biasRegularizer:io(this.biasRegularizer),activityRegularizer:io(this.activityRegularizer),kernelConstraint:ls(this.kernelConstraint),biasConstraint:ls(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Dense",n})();Lt.registerClass(u6);c6=(()=>{class n extends ir{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Vr(e);for(let r of e.slice(1))if(r==null)throw new rt(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Ul(e,1)]}call(e,r){return st(()=>{this.invokeCallHook(e,r);let o=or(e);if(this.dataFormat==="channelsFirst"&&o.rank>1){let s=[0];for(let i=2;i<o.rank;++i)s.push(i);s.push(1),o=o.transpose(s)}return gte(o)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let r=super.getConfig();return Object.assign(e,r),e}}return n.className="Flatten",n})();Lt.registerClass(c6);l6=(()=>{class n extends ir{constructor(e){super(e),this.supportsMasking=!0,this.activation=Wp(e.activation)}call(e,r){return st(()=>{this.invokeCallHook(e,r);let o=or(e);return this.activation.apply(o)})}getConfig(){let e={activation:Gp(this.activation)},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Activation",n})();Lt.registerClass(l6);p6=(()=>{class n extends ir{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,r){return st(()=>(e=or(e),fte(e,this.n)))}getConfig(){let e={n:this.n},r=super.getConfig();return Object.assign(e,r),e}}return n.className="RepeatVector",n})();Lt.registerClass(p6);h6=(()=>{class n extends ir{constructor(e){super(e),this.targetShape=e.targetShape;for(let r=0;r<this.targetShape.length;++r)this.isUnknown(this.targetShape[r])&&(this.targetShape[r]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,r){let o="Total size of new array must be unchanged.",s=r.slice(),i=1,a=null;for(let c=0;c<s.length;++c){let h=s[c];if(this.isUnknown(h))if(a===null)a=c;else throw new rt("Can only specifiy one unknown dimension.");else i*=h}let u=Ul(e);if(a!==null){if(i===0||u%i!==0)throw new rt(o);s[a]=u/i}else if(u!==i)throw new rt(o);return s}computeOutputShape(e){let r=!1;for(let o=0;o<e.length;++o)if(this.isUnknown(e[o])){r=!0;break}return r?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,r){return st(()=>{this.invokeCallHook(e,r);let o=or(e),s=o.shape,i=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return o.reshape(i)})}getConfig(){let e={targetShape:this.targetShape},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Reshape",n})();Lt.registerClass(h6);d6=(()=>{class n extends ir{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let r=Xa(1,e.dims.length+1);if(!Y.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new zo({ndim:this.dims.length+1})]}computeOutputShape(e){e=Vr(e);let r=e.slice();return this.dims.forEach((o,s)=>{r[s+1]=e[o]}),r}call(e,r){return Dr(or(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Permute",n})();Lt.registerClass(d6);f6=(()=>{class n extends ir{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={maskValue:this.maskValue};return Object.assign(r,e),r}computeMask(e,r){let o=or(e);return jm(ju(o,this.maskValue),-1)}call(e,r){return st(()=>{this.invokeCallHook(e,r);let o=or(e),a=jm(ju(o,this.maskValue),-1,!0);return o.mul(a.asType(o.dtype))})}}return n.className="Masking",n})();Lt.registerClass(f6)});var m6,mne=D(()=>{"use strict";ve();sa();Qm();Ei();So();qp();ef();ws();Ya();m6=(()=>{class n extends ir{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let r=null;e.batchSize!=null&&(r=e.batchSize),e.inputLength==null?this.batchInputShape=[r,null]:this.batchInputShape=[r].concat(ko(e.inputLength))}this.inputDim=e.inputDim,Os(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Os(this.outputDim,"outputDim"),this.embeddingsInitializer=Co(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Do(e.embeddingsRegularizer),this.activityRegularizer=Do(e.activityRegularizer),this.embeddingsConstraint=ps(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,r){return st(()=>this.maskZero?(e=or(e),ju(e,Mn(e))):null)}computeOutputShape(e){if(e=Vr(e),this.inputLength==null)return[...e,this.outputDim];let r=ko(this.inputLength);if(r.length!==e.length-1)throw new rt(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let o=0;for(let s=0;s<r.length;++s){let i=r[s],a=e[s+1];if(i!=null&&a!=null&&i!==a)throw new rt(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(r[o]=a),o++}}return[e[0],...r,this.outputDim]}call(e,r){return st(()=>{this.invokeCallHook(e,r);let o=or(e);return o.dtype!=="int32"&&(o=Jm(o,"int32")),Lk(this.embeddings.read(),o.as1D()).reshape(Vr(this.computeOutputShape(o.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Bo(this.embeddingsInitializer),embeddingsRegularizer:io(this.embeddingsRegularizer),activityRegularizer:io(this.activityRegularizer),embeddingsConstraint:ls(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Embedding",n})();Lt.registerClass(m6)});function qI(n,t){for(;n<0;)n+=t;return n}function D3e(n,t,e){if(n.shape.length>3||t.shape.length>3)throw new Bn("batchDot is not implemented for tensors of 4D or higher rank yet");if(Y.assert(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),Y.assert(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof e=="number"&&(e=[e,e]),n.dtype==="complex64"||t.dtype==="complex64")throw new Bn("batchDot is not implemented for complex64-type Tensors yet.");let r=n.shape.length,o=t.shape.length;e==null&&(e=[r-1,o-2]);let s=e;return st(()=>{let i;if(r>o){i=r-o;let u=[];for(let c=0;c<i;++c)u.push(1);t=t.reshape(t.shape.concat(u))}else if(o>r){i=o-r;let u=[];for(let c=0;c<i;++c)u.push(1);n=n.reshape(n.shape.concat(u))}else i=0;let a;if(n.shape.length===2&&t.shape.length===2)s[0]===s[1]?a=n.mul(t).sum(s[0]):a=n.transpose([1,0]).mul(t).sum(s[1]);else{let u=s[0]!==n.shape.length-1,c=s[1]===t.shape.length-1;a=n.matMul(t,u,c)}if(i>0){let u;r>o?u=r+o-3:u=r-1;let c=[];for(let h=u;h<u+i;++h)c.push(h);a=a.squeeze(c)}return a.shape.length===1&&(a=a.expandDims(1)),a})}var sg,g6,y6,x6,b6,v6,w6,S6,gne=D(()=>{"use strict";ve();ve();sa();Ei();So();Cx();ws();Yd();Ya();sg=class extends ir{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new Bn}computeElementwiseOpOutputShape(t,e){if(t==null||e==null)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(e.length===0)return t;let r=t.slice(0,t.length-e.length);for(let o=0;o<e.length;++o){let s=t[t.length-e.length+o],i=e[o];if(s==null||i==null||s<0||i<0)r.push(null);else if(s===1)r.push(i);else if(i===1)r.push(s);else{if(s!==i)throw new rt("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));r.push(s)}}return r}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Vr(t)]),t=t,t.length<2)throw new rt(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(let s of t)s!=null&&s[0]!==null&&e.push(s[0]);if(e=Vl(e),e.length>1)throw new rt(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let r=t[0]==null?null:t[0].slice(1);for(let s=1;s<t.length;++s){let i=t[s]==null?null:t[s].slice(1);r=this.computeElementwiseOpOutputShape(r,i)}let o=t.map(s=>s.length);t.indexOf(null)===-1&&Vl(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return st(()=>{if(t=t,this.reshapeRequired){let r=[],o=t.map(s=>s.rank);if(o.indexOf(null)===-1){let s=Up(o);for(let i of t){let a=i.rank;for(let u=0;u<s-a;++u)i=eg(i,1);r.push(i)}return this.mergeFunction(r)}else{let s=!1;for(let u of t){let c=u.rank;if(c==null){let h=u.shape,f=h[0],g=h.slice(1).concat([f]),d=u.reshape([f].concat(Ul(h.slice(1))));d=Dr(d,[1,0]),d=d.reshape(g),r.push(d),s=!0}else if(c>1){let h=Xa(1,c).concat([0]);r.push(Dr(u,h)),s=!0}else r.push(u)}let i=this.mergeFunction(r),a=i.rank;if(s){if(a==null){let u=i.shape,c=u.length,h=u[c-1],f=[h].concat(u.slice(0,u.length-1));i=Dr(i.reshape([-1,h]),[1,0]).reshape(f)}else if(a>1){let u=[a-1].concat(Xa(0,a-1));i=Dr(i,u)}}return i}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let e;t[0]==null?e=null:e=t[0].slice(1);for(let o=1;o<t.length;++o){let s=t[o]==null?null:t[o].slice(1);e=this.computeElementwiseOpOutputShape(e,s)}let r=[];for(let o of t)o!=null&&o[0]!==null&&r.push(o[0]);return r=Vl(r),r.length===1?e=r.concat(e):e=[null].concat(e),e}computeMask(t,e){return st(()=>{if(e==null)return null;if(!Array.isArray(e))throw new rt("`mask` should be an Array");if(!Array.isArray(t))throw new rt("`inputs` should be an Array");if(e.length!==t.length)throw new rt(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every(o=>o==null))return null;e=e.map(o=>o==null?o:Pi(o,0));let r=e[0];for(let o=1;o<e.length-1;++o)r=Ti(r,e[o]);return r})}},g6=(()=>{class n extends sg{constructor(e){super(e)}mergeFunction(e){return st(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=Pt(r,e[o]);return r})}}return n.className="Add",n})();Lt.registerClass(g6);y6=(()=>{class n extends sg{constructor(e){super(e)}mergeFunction(e){return st(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=Qe(r,e[o]);return r})}}return n.className="Multiply",n})();Lt.registerClass(y6);x6=(()=>{class n extends sg{constructor(e){super(e)}mergeFunction(e){return st(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=Pt(r,e[o]);return Qe(1/e.length,r)})}}return n.className="Average",n})();Lt.registerClass(x6);b6=(()=>{class n extends sg{constructor(e){super(e)}mergeFunction(e){return st(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=ea(r,e[o]);return r})}}return n.className="Maximum",n})();Lt.registerClass(b6);v6=(()=>{class n extends sg{constructor(e){super(e)}mergeFunction(e){return st(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=gc(r,e[o]);return r})}}return n.className="Minimum",n})();Lt.registerClass(v6);w6=(()=>{class n extends sg{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new rt("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let r=!0;for(let s of e)if(s!=null){r=!1;break}if(r)return;let o=[];for(let s=0;s<e.length;++s){let i=e[s].slice();i.splice(this.axis,1);let a=!1;for(let u of o)if(Y.arraysEqual(u,i)){a=!0;break}a||o.push(i)}if(o.length>1)throw new rt("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return st(()=>Hw(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new rt("A `Concatenate` layer should be called on a list of inputs.");let r=e,o=r[0].slice(),s=this.axis<0?o.length+this.axis:this.axis;for(let i of r.slice(1)){if(o[s]==null||i[s]==null){o[s]=null;break}o[s]+=i[s]}return o}computeMask(e,r){if(r==null)return null;if(!Array.isArray(r))throw new rt("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new rt("`inputs` should be an array for Concatenate");if(r.length!==e.length)throw new rt(`Mismatch in the length of mask (${r.length}) and the legnth of inputs (${e.length})`);return st(()=>{let o=!0;if(r.forEach(a=>{if(a!=null){o=!1;return}}),o)return null;let s=[];for(let a=0;a<e.length;++a)r[a]==null?s.push(ei(e[a]).asType("bool")):r[a].rank<e[a].rank?s.push(Pi(r[a],-1)):s.push(r[a]);let i=$r(s,this.axis);return C0(i,-1,!1)})}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Concatenate",n})();Lt.registerClass(w6);S6=(()=>{class n extends sg{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){Y.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0],o=e[1];if(r.length>3||o.length>3)throw new Bn("Dot layer does not support tensors of 4D or higher rank yet.");let s=this.interpretAxes(r,o);if(r[s[0]]!==o[s[1]])throw new rt(`Dimension incompatibility: ${r[s[0]]} !== ${o[s[1]]}`)}mergeFunction(e){if(e.length!==2)throw new rt(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let r=e[0],o=e[1],s;return Array.isArray(this.axes)?s=this.axes.map((i,a)=>qI(i,e[a].shape.length)):s=[qI(this.axes,r.shape.length),qI(this.axes,o.shape.length)],this.normalize&&(r=NI(r,s[0]),o=NI(o,s[1])),D3e(r,o,s)}interpretAxes(e,r){let o;return Array.isArray(this.axes)?o=this.axes:o=[qI(this.axes,e.length),qI(this.axes,r.length)],o}computeOutputShape(e){Y.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0].slice(),o=e[1].slice();if(r.length>3||o.length>3)throw new Bn("Dot layer does not support tensors of 4D or higher rank yet.");let s=this.interpretAxes(r,o);r.splice(s[0],1),o.splice(s[1],1),o.splice(0,1);let i=r.concat(o);return i.length===1&&i.push(1),i}computeMask(e,r){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Dot",n})();Lt.registerClass(S6)});var C6,I6,_6,yne=D(()=>{"use strict";ve();sa();Ei();Ya();C6=(()=>{class n extends ir{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={stddev:this.stddev};return Object.assign(r,e),r}call(e,r){return st(()=>{this.invokeCallHook(e,r);let o=or(e);return H0(()=>Kw(o.shape,0,this.stddev).add(o),()=>o,r.training||!1)})}}return n.className="GaussianNoise",n})();Lt.registerClass(C6);I6=(()=>{class n extends ir{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return st(()=>{this.invokeCallHook(e,r);let o=or(e);return this.rate>0&&this.rate<1?H0(()=>{let i=Math.sqrt(this.rate/(1-this.rate));return o.mul(Kw(o.shape,1,i))},()=>o,r.training||!1):o})}}return n.className="GaussianDropout",n})();Lt.registerClass(I6);_6=(()=>{class n extends ir{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||or(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return st(()=>{if(this.rate<1&&this.rate>0){let o=this._getNoiseShape(e);return H0(()=>{let i=or(e),c=-1.6732632423543772*1.0507009873554805,h=Sa(Fl(o),this.rate);h=Jm(h,"float32");let f=((1-this.rate)*(1+this.rate*c**2))**-.5,g=-f*c*this.rate;return i.mul(h).add(h.add(-1).mul(c)).mul(f).add(g)},()=>or(e),r.training||!1)}return e})}}return n.className="AlphaDropout",n})();Lt.registerClass(_6)});function GI(n,t,e,r,o,s=.001){let i;if(n.rank===2)i=bN(n,t,e,r,o,s);else if(n.rank===3)i=vN(n,t,e,r,o,s);else if(n.rank===4)i=wN(n,t,e,r,o,s);else throw new Bn(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function A3e(n,t,e,r,o=.001){return st(()=>{let s=ox(n,r),i=s.mean,a=s.variance;return[GI(n,i,a,e,t,o),i,a]})}function O3e(n,t,e,r,o=.001){return st(()=>{let s=ox(n,r),i=s.mean,a=s.variance,u=[];for(let p of Xa(0,n.rank))r.indexOf(p)!==-1?u.push(1):u.push(n.shape[p]);let c=i.reshape(u),h=a.reshape(u),f=t==null?null:t.reshape(u),g=e==null?null:e.reshape(u);return[GI(n,c,h,g,f,o),i,a]})}function R3e(n,t,e,r,o=.001){return Y.arraysEqual(r.slice().sort(),Xa(0,n.rank-1))?A3e(n,t,e,r,o):O3e(n,t,e,r,o)}var T6,E6,xne=D(()=>{"use strict";ve();ve();Qm();Ei();So();qp();ef();ws();Yd();Ya();T6=(()=>{class n extends ir{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Co(e.betaInitializer||"zeros"),this.gammaInitializer=Co(e.gammaInitializer||"ones"),this.movingMeanInitializer=Co(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Co(e.movingVarianceInitializer||"ones"),this.betaConstraint=ps(e.betaConstraint),this.gammaConstraint=ps(e.gammaConstraint),this.betaRegularizer=Do(e.betaRegularizer),this.gammaRegularizer=Do(e.gammaRegularizer)}build(e){e=Vr(e);let r=this.axis>=0?this.axis:this.axis+e.length,o=e[r];if(o==null)throw new rt(`Axis ${r} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new zo({ndim:e.length,axes:{[r]:o}})];let s=[o];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,r){return st(()=>{let o=r.training==null?!1:r.training,s=or(e),i=s.shape,a=i.length,u=Xa(0,a),c=this.axis>=0?this.axis:this.axis+a;u.splice(c,1);let h=Bl(1,a);h[c]=i[c];let f=u.slice();f.sort();let g=!Y.arraysEqual(f,Xa(0,a).slice(0,a-1)),d=()=>{if(g){let T=this.movingMean.read().reshape(h),O=this.movingVariance.read().reshape(h),S=this.center?this.beta.read().reshape(h):null,F=this.scale?this.gamma.read().reshape(h):null;return GI(s,T,O,S,F,this.epsilon)}else return GI(s,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!o)return d();let[p,m,y]=R3e(s,this.gamma.read(),this.beta.read(),u,this.epsilon),v=(T,O,S)=>{st(()=>{let F=1-S,R=T.read(),L=R.sub(O).mul(F);T.write(R.sub(L))})};return(()=>{v(this.movingMean,m,this.momentum),v(this.movingVariance,y,this.momentum)})(),p})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Bo(this.betaInitializer),gammaInitializer:Bo(this.gammaInitializer),movingMeanInitializer:Bo(this.movingMeanInitializer),movingVarianceInitializer:Bo(this.movingVarianceInitializer),betaRegularizer:io(this.betaRegularizer),gammaRegularizer:io(this.gammaRegularizer),betaConstraint:ls(this.betaConstraint),gammaConstraint:ls(this.gammaConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return n.className="BatchNormalization",n})();Lt.registerClass(T6);E6=(()=>{class n extends ir{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let r of this.axis)if(!Number.isInteger(r))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Co(e.betaInitializer||"zeros"),this.gammaInitializer=Co(e.gammaInitializer||"ones"),this.betaRegularizer=Do(e.betaRegularizer),this.gammaRegularizer=Do(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Vr(e);let r=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=r);for(let i of this.axis)if(i<0||i>=r)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Vl(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let o=this.axis.map(i=>e[i]),s=!0;this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(e,r){let o=or(e),s=o.shape,i=s.length;return st(()=>{let{mean:u,variance:c}=ox(o,this.axis,!0),h=Bl(1,i);for(let y of this.axis)h[y]=s[y];let f=y=>y!=null&&y.shape.length!==i&&this.axis!==[i-1]?y.reshape(h):y,g=f(this.gamma.read()),d=f(this.beta.read()),p=[],m=[];for(let y=0;y<i;++y)this.axis.indexOf(y)!==-1?(p.push(s[y]),m.push(1)):(p.push(1),m.push(s[y]));return u=u.tile(p),c=c.tile(p),g=g.tile(m),d=d.tile(m),GI(o,u,c,d,g,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Bo(this.betaInitializer),gammaInitializer:Bo(this.gammaInitializer),betaRegularizer:io(this.betaRegularizer),gammaRegularizer:io(this.gammaRegularizer)},r=super.getConfig();return Object.assign(e,r),e}}return n.className="LayerNormalization",n})();Lt.registerClass(E6)});function M3e(n,t,e){return st(()=>{if(n.rank!==4)throw new rt(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new rt("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=xu()),e!=="channelsLast"&&e!=="channelsFirst")throw new rt(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return e==="channelsFirst"?r=[[0,0],[0,0],t[0],t[1]]:r=[[0,0],t[0],t[1],[0,0]],Ia(n,r)})}var N6,bne=D(()=>{"use strict";ve();ve();Xm();Ei();So();Ya();N6=(()=>{class n extends ir{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?xu():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new rt(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let r,o;if(typeof e.padding[0]=="number")r=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new rt(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(r=e.padding[0],e.padding[1].length!==2)throw new rt(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);o=e.padding[1]}this.padding=[r,o]}this.inputSpec=[new zo({ndim:4})]}computeOutputShape(e){e=Vr(e);let r,o;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?r=e[2]+this.padding[0][0]+this.padding[0][1]:r=null,e[3]!=null&&e[3]>=0?o=e[3]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],e[1],r,o]):(e[1]!=null&&e[1]>=0?r=e[1]+this.padding[0][0]+this.padding[0][1]:r=null,e[2]!=null&&e[2]>=0?o=e[2]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],r,o,e[3]])}call(e,r){return st(()=>M3e(or(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return n.className="ZeroPadding2D",n})();Lt.registerClass(N6)});function ND(n,t,e,r,o,s){return st(()=>{os(o),p5(s),vu(r),e==null&&(e=[1,1]),r==null&&(r="valid"),o==null&&(o=xu()),s==null&&(s="max"),n=jI(n,o);let i,a=r==="same"?"same":"valid";return s==="max"?i=Bd(n,t,e,a):i=Dd(n,t,e,a),o==="channelsFirst"&&(i=Dr(i,[0,3,1,2])),i})}function vne(n,t,e,r,o,s){return st(()=>{os(o),p5(s),vu(r),e==null&&(e=[1,1,1]),r==null&&(r="valid"),o==null&&(o=xu()),s==null&&(s="max"),n=H5(n,o);let i,a=r==="same"?"same":"valid";return s==="max"?i=Sw(n,t,e,a):i=iw(n,t,e,a),o==="channelsFirst"&&(i=Dr(i,[0,4,1,2,3])),i})}var CD,k6,D6,ID,A6,O6,_D,R6,M6,TD,F6,P6,ED,$6,L6,wne=D(()=>{"use strict";ve();ve();Xm();sa();jl();Ei();Ei();So();zI();ws();Ya();yD();CD=class extends ir{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new rt(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(Os(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new rt(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);Os(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,vu(this.padding),this.inputSpec=[new zo({ndim:3})]}computeOutputShape(t){t=Vr(t);let e=Wu(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return st(()=>{this.invokeCallHook(t,e),t=eg(or(t),2);let r=this.poolingFunction(or(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Uu(r,[2])})}getConfig(){let t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}},k6=(()=>{class n extends CD{constructor(e){super(e)}poolingFunction(e,r,o,s,i){return os(i),vu(s),ND(e,r,o,s,i,"max")}}return n.className="MaxPooling1D",n})();Lt.registerClass(k6);D6=(()=>{class n extends CD{constructor(e){super(e)}poolingFunction(e,r,o,s,i){return os(i),vu(s),ND(e,r,o,s,i,"avg")}}return n.className="AveragePooling1D",n})();Lt.registerClass(D6);ID=class extends ir{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new rt(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];Os(this.poolSize,"poolSize"),Os(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,os(this.dataFormat),vu(this.padding),this.inputSpec=[new zo({ndim:4})]}computeOutputShape(t){t=Vr(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2];return e=Wu(e,this.poolSize[0],this.padding,this.strides[0]),r=Wu(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,r]:[t[0],e,r,t[3]]}call(t,e){return st(()=>(this.invokeCallHook(t,e),this.poolingFunction(or(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}},A6=(()=>{class n extends ID{constructor(e){super(e)}poolingFunction(e,r,o,s,i){return os(i),vu(s),ND(e,r,o,s,i,"max")}}return n.className="MaxPooling2D",n})();Lt.registerClass(A6);O6=(()=>{class n extends ID{constructor(e){super(e)}poolingFunction(e,r,o,s,i){return os(i),vu(s),ND(e,r,o,s,i,"avg")}}return n.className="AveragePooling2D",n})();Lt.registerClass(O6);_D=class extends ir{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new rt(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];Os(this.poolSize,"poolSize"),Os(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,os(this.dataFormat),vu(this.padding),this.inputSpec=[new zo({ndim:5})]}computeOutputShape(t){t=Vr(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2],o=this.dataFormat==="channelsFirst"?t[4]:t[3];return e=Wu(e,this.poolSize[0],this.padding,this.strides[0]),r=Wu(r,this.poolSize[1],this.padding,this.strides[1]),o=Wu(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,r,o]:[t[0],e,r,o,t[4]]}call(t,e){return st(()=>(this.invokeCallHook(t,e),this.poolingFunction(or(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}},R6=(()=>{class n extends _D{constructor(e){super(e)}poolingFunction(e,r,o,s,i){return os(i),vu(s),vne(e,r,o,s,i,"max")}}return n.className="MaxPooling3D",n})();Lt.registerClass(R6);M6=(()=>{class n extends _D{constructor(e){super(e)}poolingFunction(e,r,o,s,i){return os(i),vu(s),vne(e,r,o,s,i,"avg")}}return n.className="AveragePooling3D",n})();Lt.registerClass(M6);TD=class extends ir{constructor(t){super(t),this.inputSpec=[new zo({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new Bn}},F6=(()=>{class n extends TD{constructor(e){super(e||{})}call(e,r){return st(()=>{let o=or(e);return vo(o,1)})}}return n.className="GlobalAveragePooling1D",n})();Lt.registerClass(F6);P6=(()=>{class n extends TD{constructor(e){super(e||{})}call(e,r){return st(()=>{let o=or(e);return hi(o,1)})}}return n.className="GlobalMaxPooling1D",n})();Lt.registerClass(P6);ED=class extends ir{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,os(this.dataFormat),this.inputSpec=[new zo({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new Bn}getConfig(){let t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}},$6=(()=>{class n extends ED{call(e,r){return st(()=>{let o=or(e);return this.dataFormat==="channelsLast"?vo(o,[1,2]):vo(o,[2,3])})}}return n.className="GlobalAveragePooling2D",n})();Lt.registerClass($6);L6=(()=>{class n extends ED{call(e,r){return st(()=>{let o=or(e);return this.dataFormat==="channelsLast"?hi(o,[1,2]):hi(o,[2,3])})}}return n.className="GlobalMaxPooling2D",n})();Lt.registerClass(L6)});function F3e(n){Xd(ute,"BidirectionalMergeMode",n)}var kD,B6,P3e,z6,Sne=D(()=>{"use strict";ve();ve();sa();jl();Ei();So();l5();ws();Ya();UI();n2();kD=class extends ir{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){let t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,r={}){let o=e.layer,s=Cu(o,r);delete e.layer;let i={layer:s};return Object.assign(i,e),new t(i)}},B6=(()=>{class n extends kD{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Vr(e),e.length<3)throw new rt(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let r=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Vr(e);let r=[e[0]].concat(e.slice(2)),o=this.layer.computeOutputShape(r),s=e[1];return[o[0],s].concat(o.slice(1))}call(e,r){return st(()=>(e=or(e),n6((a,u)=>[or(this.layer.call(a,r)),[]],e,[],!1,null,null,!1,!0)[1]))}}return n.className="TimeDistributed",n})();Lt.registerClass(B6);P3e="concat",z6=(()=>{class n extends kD{constructor(e){super(e);let r=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=r,this.forwardLayer=Cu(o),r.goBackwards=r.goBackwards!==!0;let s={};if(s.className=e.layer.getClassName(),s.config=r,this.backwardLayer=Cu(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?P3e:e.mergeMode,F3e(this.mergeMode),e.weights)throw new Bn("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let r=e.length,o=Math.floor(r/2);this.forwardLayer.setWeights(e.slice(0,o)),this.backwardLayer.setWeights(e.slice(o))}computeOutputShape(e){let r=this.forwardLayer.computeOutputShape(e);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;let o,s,i;return this.returnState&&(i=r.slice(1)),o=r[0],o=o,this.mergeMode==="concat"?(o[o.length-1]*=2,s=[o]):this.mergeMode==null?s=[o,o.slice()]:s=[o],this.returnState?this.mergeMode==null?s.concat(i).concat(i.slice()):[o].concat(i).concat(i.slice()):Li(s)}apply(e,r){let o=r==null?null:r.initialState,s=r==null?null:r.constants;r==null&&(r={});let i=t6(e,o,s,this.numConstants);if(e=i.inputs,o=i.initialState,s=i.constants,Array.isArray(e)&&(o=e.slice(1),e=e[0]),(o==null||o.length===0)&&s==null)return super.apply(e,r);let a=[],u=[];if(o!=null){let h=o.length;if(h%2>0)throw new rt("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=o,a.push(...o);let f=o.map(g=>new zo({shape:g.shape}));this.forwardLayer.stateSpec=f.slice(0,h/2),this.backwardLayer.stateSpec=f.slice(h/2),u.push(...f)}if(s!=null)throw new Bn("Support for constants in Bidirectional layers is not implemented yet.");let c=a[0]instanceof Ta;for(let h of a)if(h instanceof Ta!==c)throw new rt("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){let h=[e].concat(a),f=this.inputSpec.concat(u),g=this.inputSpec;this.inputSpec=f;let d=super.apply(h,r);return this.inputSpec=g,d}else return super.apply(e,r)}call(e,r){return st(()=>{let o=r.initialState,s,i;if(o==null)s=this.forwardLayer.call(e,r),i=this.backwardLayer.call(e,r);else{let c=o.slice(0,o.length/2),h=o.slice(o.length/2);s=this.forwardLayer.call(e,Object.assign(r,{initialState:c})),i=this.backwardLayer.call(e,Object.assign(r,{initialState:h}))}let a;this.returnState&&(Array.isArray(s)&&(a=s.slice(1).concat(i.slice(1))),s=s[0],i=i[0]),this.returnSequences&&(i=Ds(i,1));let u;return this.mergeMode==="concat"?u=Hw([s,i]):this.mergeMode==="sum"?u=Pt(s,i):this.mergeMode==="ave"?u=Qe(.5,Pt(s,i)):this.mergeMode==="mul"?u=Qe(s,i):this.mergeMode==null&&(u=[s,i]),this.returnState?this.mergeMode==null?u.concat(a):[u].concat(a):u})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){jp(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),jp(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,r){Array.isArray(r)&&(r=r[0]);let o;if(this.returnSequences?this.mergeMode==null?o=[r,r]:o=r:this.mergeMode==null?o=[null,null]:o=null,this.returnState){let i=this.forwardLayer.states.map(a=>null);return Array.isArray(o)?o.concat(i).concat(i):[o].concat(i).concat(i)}else return o}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},r=super.getConfig();return Object.assign(e,r),e}static fromConfig(e,r){let o=Cu(r.layer);if(delete r.layer,r.numConstants!=null)throw new Bn("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let s=r;return s.layer=o,new e(s)}}return n.className="Bidirectional",n})();Lt.registerClass(z6)});var q6={};Br(q6,{Layer:()=>ir,RNN:()=>Hp,RNNCell:()=>rg,activation:()=>Z3e,add:()=>aOe,alphaDropout:()=>qOe,average:()=>uOe,averagePooling1d:()=>V6,averagePooling2d:()=>j6,averagePooling3d:()=>U6,avgPool1d:()=>yOe,avgPool2d:()=>bOe,avgPool3d:()=>wOe,avgPooling1d:()=>xOe,avgPooling2d:()=>vOe,avgPooling3d:()=>SOe,batchNormalization:()=>fOe,bidirectional:()=>POe,concatenate:()=>cOe,conv1d:()=>q3e,conv2d:()=>G3e,conv2dTranspose:()=>W3e,conv3d:()=>H3e,convLstm2d:()=>OOe,convLstm2dCell:()=>ROe,cropping2D:()=>X3e,dense:()=>J3e,depthwiseConv2d:()=>Q3e,dot:()=>dOe,dropout:()=>eOe,elu:()=>L3e,embedding:()=>iOe,flatten:()=>nOe,gaussianDropout:()=>UOe,gaussianNoise:()=>jOe,globalAveragePooling1d:()=>COe,globalAveragePooling2d:()=>IOe,globalMaxPool1d:()=>LOe,globalMaxPool2d:()=>BOe,globalMaxPooling1d:()=>Cne,globalMaxPooling2d:()=>Ine,gru:()=>TOe,gruCell:()=>EOe,input:()=>fD,inputLayer:()=>$3e,layerNormalization:()=>mOe,leakyReLU:()=>z3e,lstm:()=>NOe,lstmCell:()=>kOe,masking:()=>GOe,maxPool1d:()=>zOe,maxPool2d:()=>VOe,maxPooling1d:()=>_ne,maxPooling2d:()=>Tne,maxPooling3d:()=>_Oe,maximum:()=>lOe,minimum:()=>pOe,multiply:()=>hOe,permute:()=>sOe,prelu:()=>V3e,reLU:()=>B3e,repeatVector:()=>rOe,reshape:()=>oOe,rnn:()=>MOe,separableConv2d:()=>K3e,simpleRNN:()=>DOe,simpleRNNCell:()=>AOe,softmax:()=>j3e,spatialDropout1d:()=>tOe,stackedRNNCells:()=>FOe,thresholdedReLU:()=>U3e,timeDistributed:()=>$Oe,upSampling2d:()=>Y3e,zeroPadding2d:()=>gOe});function $3e(n){return new X0(n)}function L3e(n){return new q5(n)}function B3e(n){return new V5(n)}function z3e(n){return new j5(n)}function V3e(n){return new U5(n)}function j3e(n){return new W5(n)}function U3e(n){return new G5(n)}function q3e(n){return new Q5(n)}function G3e(n){return new gD(n)}function W3e(n){return new X5(n)}function H3e(n){return new K5(n)}function K3e(n){return new Y5(n)}function X3e(n){return new Z5(n)}function Y3e(n){return new J5(n)}function Q3e(n){return new e6(n)}function Z3e(n){return new l6(n)}function J3e(n){return new u6(n)}function eOe(n){return new SD(n)}function tOe(n){return new a6(n)}function nOe(n){return new c6(n)}function rOe(n){return new p6(n)}function oOe(n){return new h6(n)}function sOe(n){return new d6(n)}function iOe(n){return new m6(n)}function aOe(n){return new g6(n)}function uOe(n){return new x6(n)}function cOe(n){return new w6(n)}function lOe(n){return new b6(n)}function pOe(n){return new v6(n)}function hOe(n){return new y6(n)}function dOe(n){return new S6(n)}function fOe(n){return new T6(n)}function mOe(n){return new E6(n)}function gOe(n){return new N6(n)}function V6(n){return new D6(n)}function yOe(n){return V6(n)}function xOe(n){return V6(n)}function j6(n){return new O6(n)}function bOe(n){return j6(n)}function vOe(n){return j6(n)}function U6(n){return new M6(n)}function wOe(n){return U6(n)}function SOe(n){return U6(n)}function COe(n){return new F6(n)}function IOe(n){return new $6(n)}function Cne(n){return new P6(n)}function Ine(n){return new L6(n)}function _ne(n){return new k6(n)}function Tne(n){return new A6(n)}function _Oe(n){return new R6(n)}function TOe(n){return new o6(n)}function EOe(n){return new bD(n)}function NOe(n){return new s6(n)}function kOe(n){return new u2(n)}function DOe(n){return new r6(n)}function AOe(n){return new xD(n)}function OOe(n){return new i6(n)}function ROe(n){return new wD(n)}function MOe(n){return new Hp(n)}function FOe(n){return new vD(n)}function POe(n){return new z6(n)}function $Oe(n){return new B6(n)}function jOe(n){return new C6(n)}function UOe(n){return new I6(n)}function qOe(n){return new _6(n)}function GOe(n){return new f6(n)}var LOe,BOe,zOe,VOe,Ene=D(()=>{"use strict";e2();Ei();$5();lne();yD();hne();dne();fne();mne();gne();yne();xne();bne();wne();UI();Sne();LOe=Cne,BOe=Ine,zOe=_ne,VOe=Tne});var G6={};Br(G6,{MAPE:()=>nRe,MSE:()=>sRe,binaryAccuracy:()=>WOe,binaryCrossentropy:()=>HOe,categoricalAccuracy:()=>XOe,categoricalCrossentropy:()=>YOe,cosineProximity:()=>JOe,mape:()=>rRe,meanAbsoluteError:()=>eRe,meanAbsolutePercentageError:()=>tRe,meanSquaredError:()=>oRe,mse:()=>iRe,precision:()=>QOe,recall:()=>ZOe,sparseCategoricalAccuracy:()=>KOe});function WOe(n,t){return AI(n,t)}function HOe(n,t){return tD(n,t)}function KOe(n,t){return nD(n,t)}function XOe(n,t){return OI(n,t)}function YOe(n,t){return RI(n,t)}function QOe(n,t){return E5(n,t)}function ZOe(n,t){return Dte(n,t)}function JOe(n,t){return DI(n,t)}function eRe(n,t){return r2(n,t)}function tRe(n,t){return Y0(n,t)}function nRe(n,t){return Y0(n,t)}function rRe(n,t){return Y0(n,t)}function oRe(n,t){return Zd(n,t)}function sRe(n,t){return Zd(n,t)}function iRe(n,t){return Zd(n,t)}var Nne=D(()=>{"use strict";Cx();k5()});var W6={};Br(W6,{modelFromJSON:()=>ene});var kne=D(()=>{"use strict";dD();});var H6={};Br(H6,{l1:()=>uRe,l1l2:()=>aRe,l2:()=>cRe});function aRe(n){return new LI(n)}function uRe(n){return une(n)}function cRe(n){return cne(n)}var Dne=D(()=>{"use strict";ef();ef();});function DD(n,t){return n<t}function Ane(n,t){return n>t}function lRe(n){return new HI(n)}var WI,HI,One,Rne=D(()=>{"use strict";t2();FI();So();II();WI=class extends ng{constructor(){super(...arguments),this.model=null}setModel(t){if(!(t instanceof Gl))throw new Error("model must be a LayersModel, not some other Container");this.model=t}};HI=class extends WI{constructor(t){if(super(),t==null&&(t={}),t.restoreBestWeights)throw new Bn("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=t.monitor||"val_loss",this.minDelta=Math.abs(t.minDelta||0),this.patience=t.patience||0,this.verbose=t.verbose||0,this.mode=t.mode||"auto",this.baseline=t.baseline,["auto","min","max"].indexOf(this.mode)===-1&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.mode==="min"?this.monitorFunc=DD:this.mode==="max"?this.monitorFunc=Ane:this.monitor.indexOf("acc")!==-1?this.monitorFunc=Ane:this.monitorFunc=DD,this.monitorFunc===DD&&(this.minDelta*=-1)}onTrainBegin(t){return Te(this,null,function*(){this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===DD?1/0:-1/0})}onEpochEnd(t,e){return Te(this,null,function*(){yield Qd(e);let r=this.getMonitorValue(e);r!=null&&(this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)))})}onTrainEnd(t){return Te(this,null,function*(){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)})}getMonitorValue(t){t==null&&(t={});let e=t[this.monitor];return e==null&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: ${Object.keys(t)}`),e}};One={earlyStopping:lRe}});var K6=D(()=>{"use strict";rte();_te();Ene();Nne();kne();Dne();t2();Rne();Ei();FI();$5();UI();dD();CI();iD();});var Kp,Mne,Fne=D(()=>{"use strict";Kp=function(n){return n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n}(Kp||{});(function(n){let t;(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t=n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(Mne||(Mne={}))});function Pne(n,t){let e={tfOpName:n,category:"custom",inputs:[],attrs:[],customExecutor:t};X6[n]=e}function AD(n){return X6[n]}function $ne(n){delete X6[n]}var X6,OD=D(()=>{"use strict";X6={}});function ge(n,t,e,r,o){let s=t.inputParams[n];if(s&&s.inputIndexStart!==void 0){let a=s.inputIndexStart,u=s.inputIndexEnd===0?void 0:s.inputIndexEnd===void 0?a+1:s.inputIndexEnd;if(s.type==="tensor")return Bi(t.inputNames[s.inputIndexStart],e,r,o);if(s.type==="tensors")return t.inputNames.slice(a,u).map(g=>Bi(g,e,r,o));let c=Bi(t.inputNames.slice(a)[0],e,r,o),h=c.dataSync();return s.type==="number"?h[0]:Y.toNestedArray(c.shape,h)}let i=t.attrParams[n];return i&&i.value}function Bi(n,t,e,r){let[o,s]=_u(n);if(r!=null){let a=r.getHashTableHandleByName(o);if(a!=null)return a}let i=e.currentContextIds.find(a=>!!t[RD(o,a)]);return i!==void 0?t[RD(o,i)][s]:void 0}function Lne(n,t,e){return t[RD(n,e.currentContextId)]}function Xp(n,t){let[e,r]=_u(n);return[RD(e,t&&t.currentContextId),r]}function RD(n,t){return t?`${n}-${t}`:n}function _u(n){let t=n.split(":");return t.length===1?[n,0]:[t[0],Number(t[t.length-1])]}function KI(n,t,e){let r=ge("pad",n,t,e);if(r==="explicit"){r=ge("explicitPaddings",n,t,e);let o=[[0,0],[0,0],[0,0],[0,0]];for(let s=0;s<4;s++)o[s][0]=r[s*2],o[s][1]=r[s*2+1];return o}return r}function Yp(n){return n.kept?n:hc(n)}var gi=D(()=>{"use strict";ve();});var Y6={};Br(Y6,{json:()=>hRe});var hRe,Bne=D(()=>{"use strict";hRe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});var Q6={};Br(Q6,{json:()=>dRe});var dRe,zne=D(()=>{"use strict";dRe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});var Z6={};Br(Z6,{json:()=>fRe});var fRe,Vne=D(()=>{"use strict";fRe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}]});var J6={};Br(J6,{json:()=>mRe});var mRe,jne=D(()=>{"use strict";mRe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]});var e$={};Br(e$,{json:()=>gRe});var gRe,Une=D(()=>{"use strict";gRe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]});var t$={};Br(t$,{json:()=>yRe});var yRe,qne=D(()=>{"use strict";yRe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});var n$={};Br(n$,{json:()=>xRe});var xRe,Gne=D(()=>{"use strict";xRe=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]});var r$={};Br(r$,{json:()=>bRe});var bRe,Wne=D(()=>{"use strict";bRe=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]});var o$={};Br(o$,{json:()=>vRe});var vRe,Hne=D(()=>{"use strict";vRe=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]}]});var s$={};Br(s$,{json:()=>wRe});var wRe,Kne=D(()=>{"use strict";wRe=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]});var i$={};Br(i$,{json:()=>SRe});var SRe,Xne=D(()=>{"use strict";SRe=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});var a$={};Br(a$,{json:()=>CRe});var CRe,Yne=D(()=>{"use strict";CRe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});var u$={};Br(u$,{json:()=>IRe});var IRe,Qne=D(()=>{"use strict";IRe=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]});var c$={};Br(c$,{json:()=>_Re});var _Re,Zne=D(()=>{"use strict";_Re=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]});var l$={};Br(l$,{json:()=>TRe});var TRe,Jne=D(()=>{"use strict";TRe=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]});var p$={};Br(p$,{json:()=>ERe});var ERe,ere=D(()=>{"use strict";ERe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]});var h$={};Br(h$,{json:()=>NRe});var NRe,tre=D(()=>{"use strict";NRe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]}]});function kRe(n){let t=mt().global;if(typeof t.atob<"u")return t.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function rre(n,t){let e=Array.isArray(n)?String.fromCharCode.apply(null,n):kRe(n);return t?e:e.toLowerCase()}function MD(n,t,e,r=!1){let o=n[t];return o!=null?rre(o.s,r):e}function FD(n,t,e){let r=n[t];return r?r.b:e}function PD(n,t,e){let r=n[t]||{},o=r.i!=null?r.i:r.f!=null?r.f:e;return typeof o=="number"?o:parseInt(o,10)}function d$(n){switch(typeof n=="string"&&(n=Kp[n]),n){case Kp.DT_FLOAT:return"float32";case Kp.DT_INT32:case Kp.DT_INT64:case Kp.DT_INT8:case Kp.DT_UINT8:return"int32";case Kp.DT_BOOL:return"bool";case Kp.DT_DOUBLE:return"float32";case Kp.DT_STRING:return"string";default:return null}}function nre(n,t,e){let r=n[t];return r&&r.func?r.func.name:e}function $D(n,t,e){let r=n[t];return r&&r.type?d$(r.type):e}function LD(n,t,e){let r=n[t];return r&&r.list&&r.list.type?r.list.type.map(o=>d$(o)):e}function ore(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(t=>typeof t.size=="number"?t.size:parseInt(t.size,10)):[]}function BD(n,t,e){let r=n[t];return r&&r.shape?ore(r.shape):e}function zD(n,t,e){let r=n[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(o=>typeof o=="number"?o:parseInt(o,10)):e}function VD(n,t,e,r=!1){let o=n[t];return o&&o.list&&o.list.s?o.list.s.map(s=>rre(s,r)):e}function jD(n,t,e){let r=n[t];return r&&r.list&&r.list.shape?r.list.shape.map(o=>ore(o)):e}function UD(n,t,e){let r=n[t];return r&&r.list&&r.list.b?r.list.b:e}var XI,f$=D(()=>{"use strict";ve();Fne();OD();gi();Bne();zne();Vne();jne();Une();qne();Gne();Wne();Hne();Kne();Xne();Yne();Qne();Zne();Jne();ere();tre();XI=class{static get Instance(){return this._instance||(this._instance=new this)}constructor(){let t=[Y6,Q6,Z6,J6,e$,t$,n$,i$,s$,r$,a$,u$,c$,l$,p$,h$,o$],e=[].concat(...t.map(r=>r.json));this.opMappers=e.reduce((r,o)=>(r[o.tfOpName]=o,r),{})}transformGraph(t,e={}){let r=t.node,o=[],s=[],i=[],a=r.reduce((m,y)=>(m[y.name]=this.mapNode(y),y.op.startsWith("Placeholder")?o.push(m[y.name]):y.op==="Const"?s.push(m[y.name]):(y.input==null||y.input.length===0)&&i.push(m[y.name]),m),{}),u=[],c=[],h={},f={};e!=null&&(h=this.mapSignatureEntries(e.inputs),f=this.mapSignatureEntries(e.outputs));let g=Object.keys(a);g.forEach(m=>{let y=a[m];y.inputNames.forEach(v=>{let[N]=Xp(v);y.inputs.push(a[N]),a[N].children.push(y)})}),Object.keys(f).length===0?g.forEach(m=>{let y=a[m];y.children.length===0&&c.push(y)}):Object.keys(f).forEach(m=>{let[y]=Xp(m),v=a[y];v!=null&&(v.signatureKey=f[m],c.push(v))}),Object.keys(h).length>0?Object.keys(h).forEach(m=>{let[y]=Xp(m),v=a[y];v&&(v.signatureKey=h[m],u.push(v))}):u=o;let d={};t.library!=null&&t.library.function!=null&&(d=t.library.function.reduce((m,y)=>(m[y.signature.name]=this.mapFunction(y),m),{}));let p={nodes:a,inputs:u,outputs:c,weights:s,placeholders:o,signature:e,functions:d};return i.length>0&&(p.initNodes=i),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce((e,r)=>(e[t[r].name]=r,e),{})}mapNode(t){let e=AD(t.op)||this.opMappers[t.op]||{};t.attr==null&&(t.attr={});let r={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map(o=>o.startsWith("^")?o.substr(1):o),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr};return e.inputs!=null&&(r.inputParams=e.inputs.reduce((o,s)=>(o[s.name]={type:s.type,inputIndexStart:s.start,inputIndexEnd:s.end},o),{})),e.attrs!=null&&(r.attrParams=e.attrs.reduce((o,s)=>{let i=s.type,a;switch(s.type){case"string":a=MD(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=MD(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"string[]":a=VD(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=VD(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"number":a=PD(t.attr,s.tfName,s.defaultValue||0),a===void 0&&s.tfDeprecatedName&&(a=PD(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"number[]":a=zD(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=zD(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"bool":a=FD(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=FD(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"bool[]":a=UD(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=UD(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"shape":a=BD(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=BD(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"shape[]":a=jD(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=jD(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"dtype":a=$D(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=$D(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"dtype[]":a=LD(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=LD(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"func":a=nre(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=nre(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${s.type} for op: ${t.op}`)}return o[s.name]={value:a,type:i},o},{})),r}mapFunction(t){let e=t.nodeDef,r=[],o=[],s={};e!=null&&(s=e.reduce((f,g)=>(f[g.name]=this.mapNode(g),g.op==="Const"&&o.push(f[g.name]),f),{}));let i=[],a=[];t.signature.inputArg.forEach(f=>{let[g]=Xp(f.name),d={name:g,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:d$(f.type),type:"dtype"}},children:[]};d.signatureKey=f.name,i.push(d),s[g]=d}),Object.keys(s).forEach(f=>{let g=s[f];g.inputNames.forEach(d=>{let[p]=Xp(d);g.inputs.push(s[p]),s[p].children.push(g)})});let c=t.ret;t.signature.outputArg.forEach(f=>{let[g,d]=Xp(c[f.name]),p=s[g];p!=null&&(p.defaultOutput=d,a.push(p))});let h=this.mapArgsToSignature(t);return{nodes:s,inputs:i,outputs:a,weights:o,placeholders:r,signature:h}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce((e,r)=>(e[r.name]=this.mapArgToTensorInfo(r),e),{}),outputs:t.signature.outputArg.reduce((e,r)=>(e[r.name]=this.mapArgToTensorInfo(r,t.ret),e),{})}}mapArgToTensorInfo(t,e){let r=t.name;return e!=null&&(r=e[r]),{name:r,dtype:t.type}}}});var qD,sre=D(()=>{"use strict";gi();f$();qD=class{constructor(t,e,r){this.node=t,this.tensorMap=e,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(o=>this.getInput(o)),t.rawAttrs!=null&&(this.attrs=Object.keys(t.rawAttrs).reduce((o,s)=>(o[s]=this.getAttr(s),o),{}))}getInput(t){return Bi(t,this.tensorMap,this.context)}getAttr(t,e){let r=this.node.rawAttrs[t];if(r.tensor!=null)return Bi(t,this.tensorMap,this.context);if(r.i!=null||r.f!=null)return PD(this.node.rawAttrs,t,e);if(r.s!=null)return MD(this.node.rawAttrs,t,e);if(r.b!=null)return FD(this.node.rawAttrs,t,e);if(r.shape!=null)return BD(this.node.rawAttrs,t,e);if(r.type!=null)return $D(this.node.rawAttrs,t,e);if(r.list!=null){if(r.list.i!=null||r.list.f!=null)return zD(this.node.rawAttrs,t,e);if(r.list.s!=null)return VD(this.node.rawAttrs,t,e);if(r.list.shape!=null)return jD(this.node.rawAttrs,t,e);if(r.list.b!=null)return UD(this.node.rawAttrs,t,e);if(r.list.type!=null)return LD(this.node.rawAttrs,t,e)}return e}}});var Tu=D(()=>{"use strict";Dn();});var ire,are=D(()=>{"use strict";Tu();gi();ire=(n,t,e)=>{switch(n.op){case"BiasAdd":case"AddV2":case"Add":return[Pt(ge("a",n,t,e),ge("b",n,t,e))];case"AddN":return[gN(ge("tensors",n,t,e))];case"FloorMod":case"Mod":return[F0(ge("a",n,t,e),ge("b",n,t,e))];case"Mul":return[Qe(ge("a",n,t,e),ge("b",n,t,e))];case"RealDiv":case"Div":return[hn(ge("a",n,t,e),ge("b",n,t,e))];case"DivNoNan":return[mw(ge("a",n,t,e),ge("b",n,t,e))];case"FloorDiv":return[S0(ge("a",n,t,e),ge("b",n,t,e))];case"Sub":return[un(ge("a",n,t,e),ge("b",n,t,e))];case"Minimum":return[gc(ge("a",n,t,e),ge("b",n,t,e))];case"Maximum":return[ea(ge("a",n,t,e),ge("b",n,t,e))];case"Pow":return[$i(ge("a",n,t,e),ge("b",n,t,e))];case"SquaredDifference":return[Gd(ge("a",n,t,e),ge("b",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}}});var ure,cre=D(()=>{"use strict";Tu();gi();ure=(n,t,e)=>{switch(n.op){case"Abs":case"ComplexAbs":return[$o(ge("x",n,t,e))];case"Acos":return[Qv(ge("x",n,t,e))];case"Acosh":return[Zv(ge("x",n,t,e))];case"Asin":return[ew(ge("x",n,t,e))];case"Asinh":return[tw(ge("x",n,t,e))];case"Atan":return[nw(ge("x",n,t,e))];case"Atan2":return[rw(ge("x",n,t,e),ge("y",n,t,e))];case"Atanh":return[ow(ge("x",n,t,e))];case"Ceil":return[uw(ge("x",n,t,e))];case"Complex":return[Bu(ge("real",n,t,e),ge("imag",n,t,e))];case"Cos":return[Od(ge("x",n,t,e))];case"Cosh":return[T0(ge("x",n,t,e))];case"Elu":return[Al(ge("x",n,t,e))];case"Erf":return[gw(ge("x",n,t,e))];case"Exp":return[Us(ge("x",n,t,e))];case"Expm1":return[yw(ge("x",n,t,e))];case"Floor":return[Ol(ge("x",n,t,e))];case"Log":return[pi(ge("x",n,t,e))];case"Log1p":return[O0(ge("x",n,t,e))];case"Imag":return[D0(ge("x",n,t,e))];case"Neg":return[Er(ge("x",n,t,e))];case"Reciprocal":return[Tw(ge("x",n,t,e))];case"Real":return[Hm(ge("x",n,t,e))];case"Relu":return[na(ge("x",n,t,e))];case"Round":return[Nw(ge("x",n,t,e))];case"Selu":return[z0(ge("x",n,t,e))];case"Sigmoid":return[Ga(ge("x",n,t,e))];case"Sin":return[V0(ge("x",n,t,e))];case"Sign":return[Dw(ge("x",n,t,e))];case"Sinh":return[j0(ge("x",n,t,e))];case"Softplus":return[Rl(ge("x",n,t,e))];case"Sqrt":return[wo(ge("x",n,t,e))];case"Square":return[sr(ge("x",n,t,e))];case"Tanh":return[Rp(ge("x",n,t,e))];case"Tan":return[Pw(ge("x",n,t,e))];case"ClipByValue":return[li(ge("x",n,t,e),ge("clipValueMin",n,t,e),ge("clipValueMax",n,t,e))];case"Relu6":return[L0(ge("x",n,t,e))];case"Rsqrt":return[B0(Bi(n.inputNames[0],t,e))];case"Prod":return[$0(ge("x",n,t,e),ge("axes",n,t,e))];case"LeakyRelu":return[Pd(ge("x",n,t,e),ge("alpha",n,t,e))];case"Prelu":return[Vd(ge("x",n,t,e),ge("alpha",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}}});function yc(n,t,e=""){Y.assert(ORe(n,t),()=>e+` Shapes ${n} and ${t} must match`)}function ORe(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==-1&&t[e]!==-1&&n[e]!==t[e])return!1;return!0}var m$=D(()=>{"use strict";ve();});var GD,lre=D(()=>{"use strict";ve();m$();GD=class{constructor(t,e,r,o,s,i,a){this.name=t,this.dtype=e,this.maxSize=r,this.elementShape=o,this.identicalElementShapes=s,this.dynamicSize=i,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=sn(0),Ko(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach(e=>{(t==null||!t.has(e.tensor.id))&&e.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);let e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map(e=>this.read(e))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);let r=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},
          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=e.shape),yc(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),r.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(r.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);r.tensor=e,Ko(e),r.written=!0,this.tensors[t]=r}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach((r,o)=>this.write(r,e[o]))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let o=0;o<this.size();o++)t.push(o)}if(t.length===0)return wa([],[0].concat(this.elementShape));let r=this.readMany(t);return yc(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),xs(r,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(this.size()===0)return wa([],[0].concat(this.elementShape));let e=[];for(let o=0;o<this.size();o++)e.push(o);let r=this.readMany(e);return yc(this.elementShape,r[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${r[0].shape})`),$r(r,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);let r=Math.max(...t);if(!this.dynamicSize&&r>=this.maxSize)throw new Error(`Max index must be < array size (${r}  vs. ${this.maxSize})`);this.writeMany(t,mi(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let r=0,o=t.map(u=>(r+=u,r));if(r!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);let s=r===0?0:e.size/r,i=[];st(()=>{e=nt(e,[1,r,s]);for(let u=0;u<t.length;++u){let h=[0,u===0?0:o[u-1],0],f=[1,t[u],s];i[u]=nt(Jn(e,h,f),this.elementShape)}return i});let a=[];for(let u=0;u<t.length;u++)a[u]=u;this.writeMany(a,i)}}});function pre(n,t,e){let r=n.dtype;if(n.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${n.shape}`);if(n.dtype!==e)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${e}`);let o=n.shape.slice(1);yc(o,t,"TensorList shape mismatch: ");let s=mi(n);return new c2(s,t,r)}function hre(n,t,e){return new c2([],n,t,e)}function dre(n,t,e,r){if(t.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${n.shape[0]}`);let o=Math.max(...t);if(r!=null&&r!==-1&&o>=r)throw new Error(`Max index must be < array size (${o}  vs. ${r})`);let s=new c2([],e,n.dtype,r),i=mi(n,0);return t.forEach((a,u)=>{s.setItem(a,i[u])}),s}function fre(n,t,e){let r=0,o=t.map(u=>(r+=u,r));if(r!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${n.shape}`);let s=r===0?0:n.size/r,i=st(()=>{let u=[];n=nt(n,[1,r,s]);for(let c=0;c<t.length;++c){let f=[0,c===0?0:o[c-1],0],g=[1,t[c],s];u[c]=nt(Jn(n,f,g),e)}return n.dispose(),u}),a=new c2([],e,n.dtype,t.length);for(let u=0;u<i.length;u++)a.setItem(u,i[u]);return a}var c2,mre=D(()=>{"use strict";ve();m$();c2=class n{constructor(t,e,r,o=-1){this.tensors=t,this.elementShape=e,this.elementDtype=r,t?.forEach(s=>{if(r!==s.dtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${s.dtype}`);yc(e,s.shape,"TensorList shape mismatch: "),Ko(s)}),this.idTensor=sn(0),this.maxNumElements=o,Ko(this.idTensor)}get id(){return this.idTensor.id}copy(){return new n([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach(e=>{(t==null||!t.has(e.id))&&e.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,r=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(r!==-1&&this.tensors.length!==r)throw new Error(`Operation expected a list with ${r} elements but got a list with ${this.tensors.length} elements.`);return yc(t,this.elementShape,"TensorList shape mismatch: "),st(()=>{let o=this.tensors.map(s=>nt(s,t));return xs(o,0)})}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");let r=this.tensors.pop();return yc(r.shape,t,"TensorList shape mismatch: "),nt(r,t)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(yc(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Ko(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(this.maxNumElements!==-1&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);this.tensors.length=t}getItem(t,e,r){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(this.tensors[t]==null)throw new Error(`element at index ${t} is null.`);return yc(this.tensors[t].shape,e,"TensorList shape mismatch: "),this.tensors[t]}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||this.maxNumElements!==-1&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);yc(this.elementShape,e.shape,"TensorList shape mismatch: "),Ko(e),this.tensors[t]=e}gather(t,e,r){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);return yc(this.elementShape,r,"TensorList shape mismatch: "),t=t.slice(0,this.size()),t.length===0?wa([],[0].concat(this.elementShape)):st(()=>{let o=t.map(s=>nt(this.tensors[s],r));return xs(o,0)})}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);return yc(this.elementShape,e,"TensorList shape mismatch: "),this.size()===0?wa([],[0].concat(this.elementShape)):st(()=>{let r=this.tensors.map(o=>nt(o,e));return $r(r,0)})}}});var gre,yre=D(()=>{"use strict";ve();lre();mre();gi();gre=(n,t,e)=>Te(null,null,function*(){switch(n.op){case"If":case"StatelessIf":{let r=ge("thenBranch",n,t,e),o=ge("elseBranch",n,t,e),s=ge("cond",n,t,e),i=ge("args",n,t,e);return(yield s.data())[0]?e.functionMap[r].executeFunctionAsync(i,e.tensorArrayMap,e.tensorListMap):e.functionMap[o].executeFunctionAsync(i,e.tensorArrayMap,e.tensorListMap)}case"While":case"StatelessWhile":{let r=ge("body",n,t,e),o=ge("cond",n,t,e),s=ge("args",n,t,e),i=yield e.functionMap[o].executeFunctionAsync(s,e.tensorArrayMap,e.tensorListMap),a=s.map(h=>h.id),u=yield i[0].data();i.forEach(h=>{!h.kept&&a.indexOf(h.id)===-1&&h.dispose()});let c=s;for(;u[0];){let h=c;c=yield e.functionMap[r].executeFunctionAsync(c,e.tensorArrayMap,e.tensorListMap);let f=c.map(d=>d.id);h.forEach(d=>{!d.kept&&a.indexOf(d.id)===-1&&f.indexOf(d.id)===-1&&d.dispose()});let g=yield e.functionMap[o].executeFunctionAsync(c,e.tensorArrayMap,e.tensorListMap);u=yield g[0].data(),g.forEach(d=>{!d.kept&&a.indexOf(d.id)===-1&&f.indexOf(d.id)===-1&&d.dispose()})}return c}case"LoopCond":{let r=ge("pred",n,t,e);return[Yp(r)]}case"Switch":{let r=ge("pred",n,t,e),o=ge("data",n,t,e);return o.kept||(o=Yp(o)),(yield r.data())[0]?[void 0,o]:[o,void 0]}case"Merge":{let r=n.inputNames.find(o=>Bi(o,t,e)!==void 0);if(r){let o=Bi(r,t,e);return[Yp(o)]}return}case"Enter":{let r=ge("frameName",n,t,e),o=ge("tensor",n,t,e);return e.enterFrame(r),[Yp(o)]}case"Exit":{let r=ge("tensor",n,t,e);return e.exitFrame(),[Yp(r)]}case"NextIteration":{let r=ge("tensor",n,t,e);return e.nextIteration(),[Yp(r)]}case"TensorArrayV3":{let r=ge("size",n,t,e),o=ge("dtype",n,t,e),s=ge("elementShape",n,t,e),i=ge("dynamicSize",n,t,e),a=ge("clearAfterRead",n,t,e),u=ge("identicalElementShapes",n,t,e),c=ge("name",n,t,e),h=new GD(c,o,r,s,u,i,a);return e.addTensorArray(h),[h.idTensor,sn(1)]}case"TensorArrayWriteV3":{let r=ge("tensorArrayId",n,t,e),o=ge("index",n,t,e),s=ge("tensor",n,t,e),i=e.getTensorArray(r.id);return i.write(o,s),[i.idTensor]}case"TensorArrayReadV3":{let r=ge("tensorArrayId",n,t,e),o=ge("index",n,t,e);return[e.getTensorArray(r.id).read(o)]}case"TensorArrayGatherV3":{let r=ge("tensorArrayId",n,t,e),o=ge("indices",n,t,e),s=ge("dtype",n,t,e);return[e.getTensorArray(r.id).gather(o,s)]}case"TensorArrayScatterV3":{let r=ge("tensorArrayId",n,t,e),o=ge("indices",n,t,e),s=ge("tensor",n,t,e),i=e.getTensorArray(r.id);return i.scatter(o,s),[i.idTensor]}case"TensorArrayConcatV3":{let r=ge("tensorArrayId",n,t,e),o=e.getTensorArray(r.id),s=ge("dtype",n,t,e);return[o.concat(s)]}case"TensorArraySplitV3":{let r=ge("tensorArrayId",n,t,e),o=ge("tensor",n,t,e),s=ge("lengths",n,t,e),i=e.getTensorArray(r.id);return i.split(s,o),[i.idTensor]}case"TensorArraySizeV3":{let r=ge("tensorArrayId",n,t,e),o=e.getTensorArray(r.id);return[sn(o.size(),"int32")]}case"TensorArrayCloseV3":{let r=ge("tensorArrayId",n,t,e),o=e.getTensorArray(r.id);return o.clearAndClose(),[o.idTensor]}case"TensorListSetItem":{let r=ge("tensorListId",n,t,e),o=ge("index",n,t,e),s=ge("tensor",n,t,e),i=e.getTensorList(r.id);return i.setItem(o,s),[i.idTensor]}case"TensorListGetItem":{let r=ge("tensorListId",n,t,e),o=ge("index",n,t,e),s=ge("elementShape",n,t,e),i=ge("elementDType",n,t,e);return[e.getTensorList(r.id).getItem(o,s,i)]}case"TensorListScatterV2":case"TensorListScatter":{let r=ge("indices",n,t,e),o=ge("tensor",n,t,e),s=ge("elementShape",n,t,e),i=ge("numElements",n,t,e),a=dre(o,r,s,i);return e.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{let r=ge("elementShape",n,t,e),o=ge("elementDType",n,t,e),s;n.op==="TensorListReserve"?s="numElements":s="maxNumElements";let i=ge(s,n,t,e),a=hre(r,o,i);return e.addTensorList(a),[a.idTensor]}case"TensorListGather":{let r=ge("tensorListId",n,t,e),o=ge("indices",n,t,e),s=ge("elementShape",n,t,e),i=ge("elementDType",n,t,e);return[e.getTensorList(r.id).gather(o,i,s)]}case"TensorListStack":{let r=ge("tensorListId",n,t,e),o=ge("elementShape",n,t,e),s=ge("elementDType",n,t,e),i=ge("numElements",n,t,e);return[e.getTensorList(r.id).stack(o,s,i)]}case"TensorListFromTensor":{let r=ge("tensor",n,t,e),o=ge("elementShape",n,t,e),s=ge("elementDType",n,t,e),i=pre(r,o,s);return e.addTensorList(i),[i.idTensor]}case"TensorListConcat":{let r=ge("tensorListId",n,t,e),o=e.getTensorList(r.id),s=ge("dtype",n,t,e),i=ge("elementShape",n,t,e);return[o.concat(s,i)]}case"TensorListPushBack":{let r=ge("tensorListId",n,t,e),o=ge("tensor",n,t,e),s=e.getTensorList(r.id);return s.pushBack(o),[s.idTensor]}case"TensorListPopBack":{let r=ge("tensorListId",n,t,e),o=ge("elementShape",n,t,e),s=ge("elementDType",n,t,e);return[e.getTensorList(r.id).popBack(o,s)]}case"TensorListSplit":{let r=ge("tensor",n,t,e),o=ge("elementShape",n,t,e),s=ge("lengths",n,t,e),i=fre(r,s,o);return e.addTensorList(i),[i.idTensor]}default:throw TypeError(`Node type ${n.op} is not implemented`)}})});function xre(n,t,e){let[r,o]=ge("fusedOps",n,t,e),s=r==="biasadd",i=o==="prelu",a=r==="fusedbatchnorm",u=ge("numArgs",n,t,e);if(s){if(i&&u!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&u!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(a)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");let c=ge("strides",n,t,e),h=KI(n,t,e),f=ge("dataFormat",n,t,e).toUpperCase(),g=ge("dilations",n,t,e),[d,p]=ge("args",n,t,e),m=ge("leakyreluAlpha",n,t,e);return{stride:c,pad:h,dataFormat:f,dilations:g,biasArg:d,preluArg:p,activationFunc:o,leakyreluAlpha:m}}var bre,vre=D(()=>{"use strict";Tu();gi();bre=(n,t,e)=>{switch(n.op){case"Conv1D":{let r=ge("stride",n,t,e),o=ge("pad",n,t,e),s=ge("dataFormat",n,t,e).toUpperCase(),i=ge("dilation",n,t,e);return[I0(ge("x",n,t,e),ge("filter",n,t,e),r,o,s,i)]}case"Conv2D":{let r=ge("strides",n,t,e),o=KI(n,t,e),s=ge("dataFormat",n,t,e).toUpperCase(),i=ge("dilations",n,t,e);return[Wa(ge("x",n,t,e),ge("filter",n,t,e),[r[1],r[2]],o,s,[i[1],i[2]])]}case"_FusedConv2D":{let{stride:r,pad:o,dataFormat:s,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:h}=xre(n,t,e);return[Jc.conv2d({x:ge("x",n,t,e),filter:ge("filter",n,t,e),strides:[r[1],r[2]],pad:o,dataFormat:s,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{let{stride:r,pad:o,dataFormat:s,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:h}=xre(n,t,e);return[Jc.depthwiseConv2d({x:ge("x",n,t,e),filter:ge("filter",n,t,e),strides:[r[1],r[2]],pad:o,dataFormat:s,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{let r=ge("outputShape",n,t,e),o=ge("strides",n,t,e),s=KI(n,t,e);return[_0(ge("x",n,t,e),ge("filter",n,t,e),r,[o[1],o[2]],s)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{let r=ge("strides",n,t,e),o=KI(n,t,e),s=ge("dilations",n,t,e),i=ge("dataFormat",n,t,e).toUpperCase();return[fc(ge("input",n,t,e),ge("filter",n,t,e),[r[1],r[2]],o,i,[s[1],s[2]])]}case"Conv3D":{let r=ge("strides",n,t,e),o=ge("pad",n,t,e),s=ge("dataFormat",n,t,e).toUpperCase(),i=ge("dilations",n,t,e);return[lw(ge("x",n,t,e),ge("filter",n,t,e),[r[1],r[2],r[3]],o,s,[i[1],i[2],i[3]])]}case"AvgPool":{let r=ge("strides",n,t,e),o=ge("pad",n,t,e),s=ge("kernelSize",n,t,e);return[Dd(ge("x",n,t,e),[s[1],s[2]],[r[1],r[2]],o)]}case"MaxPool":{let r=ge("strides",n,t,e),o=ge("pad",n,t,e),s=ge("kernelSize",n,t,e);return[Bd(ge("x",n,t,e),[s[1],s[2]],[r[1],r[2]],o)]}case"MaxPoolWithArgmax":{let r=ge("strides",n,t,e),o=ge("pad",n,t,e),s=ge("kernelSize",n,t,e),i=ge("includeBatchInIndex",n,t,e),{result:a,indexes:u}=XN(ge("x",n,t,e),[s[1],s[2]],[r[1],r[2]],o,i);return[a,u]}case"AvgPool3D":{let r=ge("strides",n,t,e),o=ge("pad",n,t,e),s=ge("kernelSize",n,t,e);return[iw(ge("x",n,t,e),[s[1],s[2],s[3]],[r[1],r[2],r[3]],o)]}case"MaxPool3D":{let r=ge("strides",n,t,e),o=ge("pad",n,t,e),s=ge("kernelSize",n,t,e);return[Sw(ge("x",n,t,e),[s[1],s[2],s[3]],[r[1],r[2],r[3]],o)]}case"Dilation2D":{let r=ge("strides",n,t,e),o=ge("pad",n,t,e),s=ge("dilations",n,t,e),i=r[1],a=r[2],u=s[1],c=s[2];return[dw(ge("x",n,t,e),ge("filter",n,t,e),[i,a],o,[u,c],"NHWC")]}default:throw TypeError(`Node type ${n.op} is not implemented`)}}});var wre,Sre=D(()=>{"use strict";Tu();gi();wre=(n,t,e)=>{switch(n.op){case"Fill":{let r=ge("shape",n,t,e),o=ge("dtype",n,t,e),s=ge("value",n,t,e);return[Md(r,s,o)]}case"LinSpace":{let r=ge("start",n,t,e),o=ge("stop",n,t,e),s=ge("num",n,t,e);return[jN(r,o,s)]}case"Multinomial":{let r=ge("logits",n,t,e),o=ge("numSamples",n,t,e),s=ge("seed",n,t,e);return[ZN(r,o,s)]}case"OneHot":{let r=ge("indices",n,t,e),o=ge("depth",n,t,e),s=ge("onValue",n,t,e),i=ge("offValue",n,t,e);return[kl(r,o,s,i)]}case"Ones":return[ta(ge("shape",n,t,e),ge("dtype",n,t,e))];case"OnesLike":return[ei(ge("x",n,t,e))];case"RandomUniform":return[Fl(ge("shape",n,t,e),ge("minval",n,t,e),ge("maxval",n,t,e),ge("dtype",n,t,e))];case"Range":{let r=ge("start",n,t,e),o=ge("stop",n,t,e),s=ge("step",n,t,e);return[ux(r,o,s,ge("dtype",n,t,e))]}case"TruncatedNormal":{let r=ge("shape",n,t,e),o=ge("mean",n,t,e),s=ge("stdDev",n,t,e),i=ge("seed",n,t,e);return[q0(r,o,s,ge("dtype",n,t,e),i)]}case"Zeros":return[so(ge("shape",n,t,e),ge("dtype",n,t,e))];case"ZerosLike":return[Mn(ge("x",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}}});function g$(n,t,e){let r=ge("boxes",n,t,e),o=ge("scores",n,t,e),s=ge("maxOutputSize",n,t,e),i=ge("iouThreshold",n,t,e),a=ge("scoreThreshold",n,t,e),u=ge("softNmsSigma",n,t,e);return{boxes:r,scores:o,maxOutputSize:s,iouThreshold:i,scoreThreshold:a,softNmsSigma:u}}var Cre,Ire=D(()=>{"use strict";Tu();gi();Cre=(n,t,e)=>Te(null,null,function*(){switch(n.op){case"NonMaxSuppressionV5":{let{boxes:r,scores:o,maxOutputSize:s,iouThreshold:i,scoreThreshold:a,softNmsSigma:u}=g$(n,t,e),c=yield zp.nonMaxSuppressionWithScoreAsync(r,o,s,i,a,u);return[c.selectedIndices,c.selectedScores]}case"NonMaxSuppressionV4":{let{boxes:r,scores:o,maxOutputSize:s,iouThreshold:i,scoreThreshold:a}=g$(n,t,e),u=ge("padToMaxOutputSize",n,t,e),c=yield zp.nonMaxSuppressionPaddedAsync(r,o,s,i,a,u);return[c.selectedIndices,c.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{let{boxes:r,scores:o,maxOutputSize:s,iouThreshold:i,scoreThreshold:a}=g$(n,t,e);return[yield zp.nonMaxSuppressionAsync(r,o,s,i,a)]}case"Where":{let r=Wt(ge("condition",n,t,e),"bool"),o=[yield Vw(r)];return r.dispose(),o}case"ListDiff":return uk(ge("x",n,t,e),ge("y",n,t,e));default:throw TypeError(`Node type ${n.op} is not implemented`)}})});var _re,Tre=D(()=>{"use strict";Tu();gi();_re=(n,t,e)=>{switch(n.op){case"TopKV2":{let r=ge("x",n,t,e),o=ge("k",n,t,e),s=ge("sorted",n,t,e),i=Lw(r,o,s);return[i.values,i.indices]}case"Unique":{let r=ge("x",n,t,e),o=px(r);return[o.values,o.indices]}case"UniqueV2":{let r=ge("x",n,t,e),o=ge("axis",n,t,e),s=px(r,o);return[s.values,s.indices]}default:throw TypeError(`Node type ${n.op} is not implemented`)}}});var Ere,Nre=D(()=>{"use strict";Tu();gi();Ere=(n,t,e)=>{switch(n.op){case"Const":return t[n.name];case"PlaceholderWithDefault":let r=ge("default",n,t,e);return[Bi(n.name,t,e)||r];case"Placeholder":return[Bi(n.name,t,e)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{let c=ge("x",n,t,e);return[Yp(c)]}case"IdentityN":return ge("x",n,t,e).map(c=>Yp(c));case"Snapshot":let o=ge("x",n,t,e);return[Yp(o)];case"Shape":return[bs(ge("x",n,t,e).shape,"int32")];case"ShapeN":return ge("x",n,t,e).map(c=>bs(c.shape));case"Size":return[sn(ge("x",n,t,e).size,"int32")];case"Rank":return[sn(ge("x",n,t,e).rank,"int32")];case"NoOp":return[sn(1)];case"Print":let s=ge("x",n,t,e),i=ge("data",n,t,e),a=ge("message",n,t,e),u=ge("summarize",n,t,e);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(a);for(let c=0;c<i.length;c++)console.log(Array.prototype.slice.call(i[c].dataSync()).slice(0,u));return[s];default:throw TypeError(`Node type ${n.op} is not implemented`)}}});var WD,kre=D(()=>{"use strict";ve();WD=class{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=sn(0),this.tensorMap=new Map,Ko(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach(t=>t.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}import(t,e){return Te(this,null,function*(){this.checkKeyAndValueTensor(t,e);let r=yield t.data();return this.tensorMap.forEach(o=>o.dispose()),this.tensorMap.clear(),st(()=>{let o=mi(e),s=r.length,i=o.length;Y.assert(s===i,()=>`The number of elements doesn't match, keys has ${s} elements, the values has ${i} elements.`);for(let a=0;a<s;a++){let u=r[a],c=o[a];Ko(c),this.tensorMap.set(u,c)}return this.handle})})}find(t,e){return Te(this,null,function*(){this.checkKeyAndValueTensor(t,e);let r=yield t.data();return st(()=>{let o=[];for(let s=0;s<r.length;s++){let i=r[s],a=this.findWithDefault(i,e);o.push(a)}return xs(o)})})}findWithDefault(t,e){let r=this.tensorMap.get(t);return r??e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}});var Dre,Are=D(()=>{"use strict";kre();gi();Dre=(n,t,e,r)=>Te(null,null,function*(){switch(n.op){case"HashTable":case"HashTableV2":{let o=ge("keyDType",n,t,e),s=ge("valueDType",n,t,e),i=new WD(o,s);return r.addHashTable(n.name,i),[i.handle]}case"LookupTableImport":case"LookupTableImportV2":{let o=ge("tableHandle",n,t,e,r),s=ge("keys",n,t,e),i=ge("values",n,t,e);return[yield r.getHashTableById(o.id).import(s,i)]}case"LookupTableFind":case"LookupTableFindV2":{let o=ge("tableHandle",n,t,e,r),s=ge("keys",n,t,e),i=ge("defaultValue",n,t,e);return[yield r.getHashTableById(o.id).find(s,i)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}})});var Ore,Rre=D(()=>{"use strict";Tu();gi();Ore=(n,t,e)=>{switch(n.op){case"ResizeBilinear":{let r=ge("images",n,t,e),o=ge("size",n,t,e),s=ge("alignCorners",n,t,e),i=ge("halfPixelCenters",n,t,e);return[zp.resizeBilinear(r,[o[0],o[1]],s,i)]}case"ResizeNearestNeighbor":{let r=ge("images",n,t,e),o=ge("size",n,t,e),s=ge("alignCorners",n,t,e),i=ge("halfPixelCenters",n,t,e);return[zp.resizeNearestNeighbor(r,[o[0],o[1]],s,i)]}case"CropAndResize":{let r=ge("image",n,t,e),o=ge("boxes",n,t,e),s=ge("boxInd",n,t,e),i=ge("cropSize",n,t,e),a=ge("method",n,t,e),u=ge("extrapolationValue",n,t,e);return[zp.cropAndResize(r,o,s,i,a,u)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}}});var Mre,Fre=D(()=>{"use strict";Tu();gi();Mre=(n,t,e)=>{switch(n.op){case"Equal":return[Ha(ge("a",n,t,e),ge("b",n,t,e))];case"NotEqual":return[ju(ge("a",n,t,e),ge("b",n,t,e))];case"Greater":return[ks(ge("a",n,t,e),ge("b",n,t,e))];case"GreaterEqual":return[Sa(ge("a",n,t,e),ge("b",n,t,e))];case"Less":return[$d(ge("a",n,t,e),ge("b",n,t,e))];case"LessEqual":return[yu(ge("a",n,t,e),ge("b",n,t,e))];case"LogicalAnd":return[Ti(ge("a",n,t,e),ge("b",n,t,e))];case"LogicalNot":return[Ld(ge("a",n,t,e))];case"LogicalOr":return[M0(ge("a",n,t,e),ge("b",n,t,e))];case"Select":case"SelectV2":return[Yo(ge("condition",n,t,e),ge("a",n,t,e),ge("b",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}}});var Pre,$re=D(()=>{"use strict";Tu();gi();Pre=(n,t,e)=>{switch(n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Ir(ge("a",n,t,e),ge("b",n,t,e),ge("transposeA",n,t,e),ge("transposeB",n,t,e))];case"Transpose":return[Dr(ge("x",n,t,e),ge("perm",n,t,e))];case"_FusedMatMul":let[r,o]=ge("fusedOps",n,t,e),s=r==="biasadd",i=o==="prelu",a=ge("numArgs",n,t,e),u=ge("leakyreluAlpha",n,t,e);if(s){if(i&&a!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&a!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}let[c,h]=ge("args",n,t,e);return[Jc.matMul({a:ge("a",n,t,e),b:ge("b",n,t,e),transposeA:ge("transposeA",n,t,e),transposeB:ge("transposeB",n,t,e),bias:c,activation:o,preluActivationWeights:h,leakyreluAlpha:u})];default:throw TypeError(`Node type ${n.op} is not implemented`)}}});var Lre,Bre=D(()=>{"use strict";Tu();gi();Lre=(n,t,e)=>{switch(n.op){case"FusedBatchNorm":case"FusedBatchNormV2":return[Qc(ge("x",n,t,e),ge("mean",n,t,e),ge("variance",n,t,e),ge("offset",n,t,e),ge("scale",n,t,e),ge("epsilon",n,t,e))];case"FusedBatchNormV3":return[Qc(ge("x",n,t,e),ge("mean",n,t,e),ge("variance",n,t,e),ge("offset",n,t,e),ge("scale",n,t,e),ge("epsilon",n,t,e))];case"LRN":return[xw(ge("x",n,t,e),ge("radius",n,t,e),ge("bias",n,t,e),ge("alpha",n,t,e),ge("beta",n,t,e))];case"Softmax":return[jd(ge("x",n,t,e))];case"LogSoftmax":return[R0(ge("x",n,t,e))];case"SparseToDense":return[uI(ge("sparseIndices",n,t,e),ge("outputShape",n,t,e),ge("sparseValues",n,t,e),ge("defaultValue",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}}});var zre,Vre=D(()=>{"use strict";Tu();gi();zre=(n,t,e)=>{switch(n.op){case"Max":{let i=ge("axis",n,t,e),a=ge("keepDims",n,t,e);return[hi(ge("x",n,t,e),i,a)]}case"Mean":{let i=ge("axis",n,t,e),a=ge("keepDims",n,t,e);return[vo(ge("x",n,t,e),i,a)]}case"Min":{let i=ge("axis",n,t,e),a=ge("keepDims",n,t,e);return[Fp(ge("x",n,t,e),i,a)]}case"Sum":{let i=ge("axis",n,t,e),a=ge("keepDims",n,t,e);return[vn(ge("x",n,t,e),i,a)]}case"All":{let i=ge("axis",n,t,e),a=ge("keepDims",n,t,e);return[C0(ge("x",n,t,e),i,a)]}case"Any":{let i=ge("axis",n,t,e),a=ge("keepDims",n,t,e);return[jm(ge("x",n,t,e),i,a)]}case"ArgMax":{let i=ge("axis",n,t,e);return[Um(ge("x",n,t,e),i)]}case"ArgMin":{let i=ge("axis",n,t,e);return[Jv(ge("x",n,t,e),i)]}case"Prod":{let i=ge("axis",n,t,e),a=ge("keepDims",n,t,e);return[$0(ge("x",n,t,e),i,a)]}case"Cumsum":{let i=ge("axis",n,t,e),a=ge("exclusive",n,t,e),u=ge("reverse",n,t,e);return[E0(ge("x",n,t,e),i,a,u)]}case"Bincount":let r=ge("x",n,t,e),o=ge("weights",n,t,e),s=ge("size",n,t,e);return[SN(r,o,s)];case"DenseBincount":{let i=ge("x",n,t,e),a=ge("weights",n,t,e),u=ge("size",n,t,e),c=ge("binaryOutput",n,t,e);return[ON(i,a,u,c)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}}});var jre,Ure=D(()=>{"use strict";ve();Tu();gi();jre=(n,t,e)=>{switch(n.op){case"ConcatV2":case"Concat":{let r=ge("n",n,t,e),o=ge("axis",n,t,e),s=ge("tensors",n,t,e);return s=s.slice(0,r),[$r(s,o)]}case"Gather":{let r=ge("x",n,t,e),o=ge("indices",n,t,e);return[Zc(r,Wt(o,"int32"),0)]}case"GatherV2":{let r=ge("axis",n,t,e),o=ge("batchDims",n,t,e),s=ge("x",n,t,e),i=ge("indices",n,t,e);return[Zc(s,Wt(i,"int32"),r,o)]}case"Reverse":{let r=ge("dims",n,t,e),o=[];for(let i=0;i<r.length;i++)r[i]&&o.push(i);let s=ge("x",n,t,e);return[Ds(s,o)]}case"ReverseV2":{let r=ge("axis",n,t,e),o=ge("x",n,t,e);return[Ds(o,r)]}case"Slice":{let r=ge("begin",n,t,e),o=ge("size",n,t,e);return[Jn(ge("x",n,t,e),r,o)]}case"StridedSlice":{let r=ge("begin",n,t,e),o=ge("end",n,t,e),s=ge("strides",n,t,e),i=ge("beginMask",n,t,e),a=ge("endMask",n,t,e),u=ge("ellipsisMask",n,t,e),c=ge("newAxisMask",n,t,e),h=ge("shrinkAxisMask",n,t,e),f=ge("x",n,t,e);return[Fw(f,r,o,s,i,a,u,c,h)]}case"Pack":return st(()=>{let r=ge("axis",n,t,e),o=ge("tensors",n,t,e),s=o[0].shape,i=Uu(o[0]).shape,a=o.map(u=>{let c=Y.arraysEqual(u.shape,s);if(!c&&!Y.arraysEqual(Uu(u).shape,i))throw new Error("the input tensors shape does not match");return c?u:nt(u,s)});return[xs(a,r)]});case"Unpack":{let r=ge("axis",n,t,e),o=ge("tensor",n,t,e);return mi(o,r)}case"Tile":{let r=ge("reps",n,t,e);return[mc(ge("x",n,t,e),r)]}case"Split":case"SplitV":{let r=ge("axis",n,t,e),o=ge("numOrSizeSplits",n,t,e),s=ge("x",n,t,e);return fi(s,o,r)}case"ScatterNd":{let r=ge("indices",n,t,e),o=ge("values",n,t,e),s=ge("shape",n,t,e);return[TP(r,o,s)]}case"GatherNd":{let r=ge("x",n,t,e),o=ge("indices",n,t,e);return[EP(r,o)]}case"SparseToDense":{let r=ge("sparseIndices",n,t,e),o=ge("outputShape",n,t,e),s=ge("sparseValues",n,t,e),i=ge("defaultValue",n,t,e);return[uI(r,s,o,s.dtype===i.dtype?i:Wt(i,s.dtype))]}default:throw TypeError(`Node type ${n.op} is not implemented`)}}});var qre,Gre=D(()=>{"use strict";Tu();gi();qre=(n,t,e)=>{switch(n.op){case"FFT":return[Ud(ge("x",n,t,e))];case"IFFT":return[Pp(ge("x",n,t,e))];case"RFFT":return[qd(ge("x",n,t,e))];case"IRFFT":return[U0(ge("x",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}}});var Wre,Hre=D(()=>{"use strict";Tu();gi();Wre=(n,t,e)=>{switch(n.op){case"Cast":return[Wt(ge("x",n,t,e),ge("dtype",n,t,e))];case"ExpandDims":{let r=ge("axis",n,t,e);return[Pi(ge("x",n,t,e),r)]}case"Squeeze":{let r=ge("axis",n,t,e);return[Uu(ge("x",n,t,e),r)]}case"Reshape":return[nt(ge("x",n,t,e),ge("shape",n,t,e))];case"MirrorPad":return[Iw(ge("x",n,t,e),ge("padding",n,t,e),ge("mode",n,t,e))];case"PadV2":case"Pad":return[Ia(ge("x",n,t,e),ge("padding",n,t,e),ge("constantValue",n,t,e))];case"SpaceToBatchND":{let r=ge("blockShape",n,t,e),o=ge("paddings",n,t,e);return[zd(ge("x",n,t,e),r,o)]}case"BatchToSpaceND":{let r=ge("blockShape",n,t,e),o=ge("crops",n,t,e);return[Ad(ge("x",n,t,e),r,o)]}case"DepthToSpace":{let r=ge("blockSize",n,t,e),o=ge("dataFormat",n,t,e).toUpperCase();return[pw(ge("x",n,t,e),r,o)]}case"BroadcastTo":return[qm(ge("x",n,t,e),ge("shape",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}}});function y$(n,t,e,r){let o=((s,i,a)=>{switch(s.category){case"arithmetic":return st(()=>ire(s,i,a));case"basic_math":return st(()=>ure(s,i,a));case"control":return gre(s,i,a);case"convolution":return st(()=>bre(s,i,a));case"creation":return st(()=>wre(s,i,a));case"dynamic":return Cre(s,i,a);case"evaluation":return st(()=>_re(s,i,a));case"image":return st(()=>Ore(s,i,a));case"graph":return st(()=>Ere(s,i,a));case"logical":return st(()=>Mre(s,i,a));case"matrices":return st(()=>Pre(s,i,a));case"normalization":return st(()=>Lre(s,i,a));case"reduction":return st(()=>zre(s,i,a));case"slice_join":return st(()=>jre(s,i,a));case"spectral":return st(()=>qre(s,i,a));case"transformation":return st(()=>Wre(s,i,a));case"hash_table":return Dre(s,i,a,r);case"custom":let u=AD(s.op);if(u&&u.customExecutor)return u.customExecutor(new qD(s,i,a));throw TypeError(`Custom op ${s.op} is not registered.`);default:throw TypeError(`Unknown op '${s.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(n,t,e);return Y.isPromise(o)?o.then(s=>[].concat(s)):[].concat(o)}var Kre=D(()=>{"use strict";ve();sre();OD();are();cre();yre();vre();Sre();Ire();Tre();Nre();Are();Rre();Fre();$re();Bre();Vre();Ure();Gre();Hre();});var YI,Xre=D(()=>{"use strict";YI=class{constructor(t={},e={},r={},o={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=r,this.functionMap=o,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){let t=[];for(let e=0;e<this.contexts.length-1;e++){let r=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(r))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map(e=>e.id===0&&e.iterationId===0?"":`${e.frameName}-${e.iterationId}`).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;let t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(let e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(let e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}});function x$(n,t,e,r){let o=new Set,s=[],i=null,a=null,u=new Set,c=Object.keys(n).map(g=>_u(g)[0]),h=[];r!=null&&(h=r.map(g=>_u(g.name)[0]));let f=[...t];for(;f.length>0;){let g=f.pop();if((b$(g)||QRe(g)||ZRe(g))&&i==null&&(i=g,a=i.children.map(d=>d.name).filter(d=>o.has(d))),o.add(g.name),e[g.name]==null&&c.indexOf(g.name)===-1&&h.indexOf(g.name)===-1){if(g.inputs.length===0){s.push(g.name);continue}g.inputs.forEach(d=>{u.has(d.name)||(u.add(d.name),f.push(d))})}}return{inputs:n,outputs:t,usedNodes:o,missingInputs:s,dynamicNode:i,syncInputs:a}}function Yre(n,t,e){let{usedNodes:r,inputs:o}=e,s=[],i=Object.keys(o).map(h=>_u(h)[0]).map(h=>n.nodes[h]),a=n.initNodes;i.forEach(h=>{r.has(h.name)&&s.push(h)}),n.weights.forEach(h=>{r.has(h.name)&&s.push(h)}),a?.forEach(h=>{r.has(h.name)&&s.push(h)});let u=new Set,c=[];for(;s.length>0;){let h=s.pop();u.add(h.name),t[h.name]||c.push(h),h.children.forEach(f=>{!u.has(f.name)&&r.has(f.name)&&f.inputs.every(g=>u.has(g.name))&&s.push(f)})}return c}function b$(n){return KRe.indexOf(n.op)>=0}function QRe(n){return XRe.indexOf(n.op)>=0}function ZRe(n){return YRe.indexOf(n.op)>=0}var KRe,XRe,YRe,Qre=D(()=>{"use strict";gi();KRe=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],XRe=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],YRe=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2"]});var QI,Zre=D(()=>{"use strict";ve();gi();Kre();Xre();Qre();QI=class n{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,t.functions!=null&&Object.keys(t.functions).forEach(r=>{this._functionExecutorMap[r]=new n(t.functions[r],this)})}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){let e=Object.keys(t).map(r=>t[r].map(o=>o.id));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(t=>t.signatureKey||t.name)}get outputNodes(){return this._outputs.map(t=>{let e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e})}get functions(){return Object.keys(this._functions).reduce((t,e)=>(t[e]=this._functions[e].signature,t),{})}getCompilationKey(t,e){let r=t.map(s=>s.name).sort(),o=e.map(s=>s.name).sort();return r.join(this.SEPERATOR)+"--"+o.join(this.SEPERATOR)}compile(t,e){let r=x$(t,e,this.weightMap,this._initNodes),{missingInputs:o,dynamicNode:s,syncInputs:i}=r;if(s!=null)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${i}]`);if(o.length>0){let a=e.map(c=>c.name),u=Object.keys(t);throw new Error(`Cannot compute the outputs [${a}] from the provided inputs [${u}]. Missing the following inputs: [${o}]`)}return Yre(this.graph,this.weightMap,r)}execute(t,e){t=this.mapInputs(t);let r=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);let o=r.map(f=>this.graph.nodes[_u(f)[0]]),s=e.map(f=>_u(f)[0]),i=s.map(f=>this.graph.nodes[f]);i.length===0&&(i=this._outputs);let a=this.getCompilationKey(o,i),u=this.compiledMap.get(a);u==null&&(u=this.compile(t,i),this.compiledMap.set(a,u));let c={},h={};return st(()=>{let f=new YI(this.weightMap,c,h,this.functionExecutorMap),g=Object.assign({},this.weightMap);Object.keys(t).forEach(m=>{let[y,v]=_u(m),N=[];N[v]=t[m],g[y]=N});let d=this.getFrozenTensorIds(g),p={};for(let m=0;m<u.length;m++){let y=u[m];if(!g[y.name]){let v=y$(y,g,f,this._resourceManager);if(Y.isPromise(v))throw new Error(`The execution of the op '${y.op}' returned a promise. Please use model.executeAsync() instead.`);g[y.name]=v,this.checkTensorForDisposal(y.name,y,g,f,d,s,p)}}return this.parent==null&&f.dispose(d),e.map(m=>Bi(m,g,f))})}getFrozenTensorIds(t){let e=[].concat.apply([],Object.keys(t).map(r=>t[r]).map(r=>r.map(o=>o.id)));return new Set(e)}checkTensorForDisposal(t,e,r,o,s,i,a){e.category==="control"||i.indexOf(t)!==-1||(r[t].forEach(u=>{u!=null&&(a[u.id]=(a[u.id]||0)+e.children.length)}),e.inputs.forEach(u=>{if(u.category!=="control"){let c=Lne(u.name,r,o);c?.forEach(h=>{if(h&&!s.has(h.id)){let f=a[h.id];f===1?(h.dispose(),delete a[h.id]):f!=null&&a[h.id]--}})}}))}executeAsync(t,e){return Te(this,null,function*(){return this._executeAsync(t,e)})}_executeAsync(i,a){return Te(this,arguments,function*(t,e,r=!1,o={},s={}){r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));let u=new YI(this.weightMap,o,s,this.functionExecutorMap),c=yield this.executeWithControlFlow(t,u,e,r),h=e.map(p=>Bi(p,c,u)),f=h.map(p=>p.id),g=Object.keys(t).map(p=>t[p].id),d=new Set([...f,...g,...this.weightIds]);return Object.keys(c).forEach(p=>{c[p].forEach(y=>{y&&!y.isDisposed&&!d.has(y.id)&&y.dispose()})}),this.parent==null&&u.dispose(d),h})}executeFunctionAsync(t,e,r){return Te(this,null,function*(){let o=t.reduce((s,i,a)=>(s[this.inputs[a].name]=i,s),{});return this._executeAsync(o,this.outputNodes,!0,e,r)})}executeWithControlFlow(t,e,r,o){return Te(this,null,function*(){let s=Object.keys(t),i=s.map(T=>this.graph.nodes[_u(T)[0]]),a=r.map(T=>_u(T)[0]),u=a.map(T=>this.graph.nodes[T]);u.length===0&&(u=this._outputs);let{usedNodes:c,missingInputs:h,dynamicNode:f,syncInputs:g}=x$(t,u,this.weightMap,this._initNodes),d=[...i,...this.graph.weights,...this._initNodes||[]].map(T=>({node:T,contexts:e.currentContext})),p=Object.assign({},this.weightMap);Object.keys(t).forEach(T=>{let[O,S]=_u(T),F=[];F[S]=t[T],p[O]=F});let m={},y=this.getFrozenTensorIds(p),v={};for(;d.length>0;){let T=this.processStack(i,d,e,p,v,y,a,m,c);yield Promise.all(T)}f==null&&!o&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");let N=u.filter(T=>!b$(T)&&!Bi(T.name,p,e)).map(T=>T.name);if(N.length>0){let T="";throw f!=null&&(T=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${g}]`),new Error(`Cannot compute the outputs [${N}] from the provided inputs [${s}]. Consider providing the following inputs: [${h}]. ${T}`)}return p})}processStack(t,e,r,o,s,i,a,u,c){let h=[];for(;e.length>0;){let f=e.pop();r.currentContext=f.contexts;let g="";if(f.node.op==="Enter"&&ge("isConstant",f.node,o,r)&&([g]=Xp(f.node.name,r)),o[f.node.name]==null){let d=y$(f.node,o,r,this._resourceManager);g||([g]=Xp(f.node.name,r));let p=r.currentContext;Y.isPromise(d)?h.push(d.then(m=>(o[g]=m,r.currentContext=p,this.checkTensorForDisposal(g,f.node,o,r,i,a,u),this.processChildNodes(f.node,e,r,o,s,c),m))):(o[g]=d,this.checkTensorForDisposal(g,f.node,o,r,i,a,u),this.processChildNodes(f.node,e,r,o,s,c))}else this.processChildNodes(f.node,e,r,o,s,c)}return h}processChildNodes(t,e,r,o,s,i){t.children.forEach(a=>{let[u]=Xp(a.name,r);s[u]||!i.has(a.name)||(a.op==="Merge"?a.inputNames.some(c=>!!Bi(c,o,r))&&(s[u]=!0,e.push({contexts:r.currentContext,node:a})):a.inputNames.every(c=>!!Bi(c,o,r))&&(s[u]=!0,e.push({contexts:r.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(t=>this.weightMap[t].forEach(e=>e.dispose()))}checkInputShapeAndType(t){Object.keys(t).forEach(e=>{let r=t[e],[o]=_u(e),s=this.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){let i=s.attrParams.shape.value,a=i.length===r.shape.length&&r.shape.every((u,c)=>i[c]===-1||i[c]===u);Y.assert(a,()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${i}], but was [${r.shape}]`)}s.attrParams.dtype&&s.attrParams.dtype.value&&Y.assert(r.dtype===s.attrParams.dtype.value,()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${r.dtype}`)})}mapInputs(t){let e={};for(let r in t)if(this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[r]!=null){let o=this._signature.inputs[r];e[o.name]=t[r]}else e[r]=t[r];return e}checkInputs(t){let e=Object.keys(t).filter(r=>{let[o]=_u(r);return this.graph.nodes[o]==null});if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map(e=>this._signature!=null&&this._signature.outputs!=null&&this._signature.outputs[e]!=null?this._signature.outputs[e].name:e,{})}checkOutputs(t){t.forEach(e=>{let[r]=_u(e);if(!this.graph.nodes[r])throw new Error(`The output '${e}' is not found in the graph`)})}}});var HD,Jre=D(()=>{"use strict";HD=class{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(let t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(let t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}});function eoe(e){return Te(this,arguments,function*(n,t={}){if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");t==null&&(t={}),t.fromTFHub&&n.load==null&&(n.endsWith("/")||(n=n+"/"),n=`${n}${e4e}${JRe}`);let r=new ZI(n,t);return yield r.load(),r})}var JRe,e4e,ZI,toe=D(()=>{"use strict";ve();f$();Zre();Jre();JRe="?tfjs-format=file",e4e="model.json",ZI=class{constructor(t,e={}){this.modelUrl=t,this.loadOptions=e,this.version="n/a",e==null&&(this.loadOptions={}),this.resourceManager=new HD}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){let t=this.modelUrl;if(t.load!=null)this.handler=t;else if(this.loadOptions.requestInit!=null)this.handler=Zi.browserHTTPRequest(t,this.loadOptions);else{let e=Zi.getLoadHandlers(t,this.loadOptions);if(e.length===0)e.push(Zi.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){return Te(this,null,function*(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let t=yield this.handler.load();return this.loadSync(t)})}loadSync(t){this.artifacts=t;let e=this.artifacts.modelTopology,r;this.artifacts.userDefinedMetadata!=null&&this.artifacts.userDefinedMetadata.signature!=null?r=this.artifacts.userDefinedMetadata.signature:r=this.artifacts.signature,this.signature=r,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;let o=Zi.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new QI(XI.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(o),this.executor.resourceManager=this.resourceManager,t.modelInitializer!=null&&t.modelInitializer.node!=null){let s=XI.Instance.transformGraph(t.modelInitializer);this.initializer=new QI(s),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}save(t,e){return Te(this,null,function*(){if(typeof t=="string"){let r=Zi.getSaveHandlers(t);if(r.length===0)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(r.length>1)throw new Error(`Found more than one (${r.length}) save handlers for URL '${t}'`);t=r[0]}if(t.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)})}predict(t,e){return this.execute(t,this.outputNodes)}normalizeInputs(t){if(!(t instanceof Me)&&!Array.isArray(t))return t;if(t=Array.isArray(t)?t:[t],t.length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce((e,r,o)=>(e[r]=t[o],e),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);let r=this.executor.execute(t,e);return r.length>1?r:r[0]}executeAsync(t,e){return Te(this,null,function*(){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);let r=yield this.executor.executeAsync(t,e);return r.length>1?r:r[0]})}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce((e,r)=>(e[r]=[t[r]],e),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}});var KD,noe=D(()=>{"use strict";KD="2.8.6"});var v$=D(()=>{"use strict";toe();OD();noe();});var ooe=uo((roe,w$)=>{"use strict";(function(n,t,e){function r(a){var u=this,c=i();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(a),u.s0<0&&(u.s0+=1),u.s1-=c(a),u.s1<0&&(u.s1+=1),u.s2-=c(a),u.s2<0&&(u.s2+=1),c=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function s(a,u){var c=new r(a),h=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&o(h,c),f.state=function(){return o(c,{})}),f}function i(){var a=4022871197,u=function(c){c=c.toString();for(var h=0;h<c.length;h++){a+=c.charCodeAt(h);var f=.02519603282416938*a;a=f>>>0,f-=a,f*=a,a=f>>>0,f-=a,a+=f*4294967296}return(a>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.alea=s})(roe,typeof w$=="object"&&w$,typeof define=="function"&&define)});var ioe=uo((soe,S$)=>{"use strict";(function(n,t,e){function r(i){var a=this,u="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var h=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^h^h>>>8},i===(i|0)?a.x=i:u+=i;for(var c=0;c<u.length+64;c++)a.x^=u.charCodeAt(c)|0,a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a}function s(i,a){var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xor128=s})(soe,typeof S$=="object"&&S$,typeof define=="function"&&define)});var uoe=uo((aoe,C$)=>{"use strict";(function(n,t,e){function r(i){var a=this,u="";a.next=function(){var h=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(h^h<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,i===(i|0)?a.x=i:u+=i;for(var c=0;c<u.length+64;c++)a.x^=u.charCodeAt(c)|0,c==u.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a.v=i.v,a.d=i.d,a}function s(i,a){var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xorwow=s})(aoe,typeof C$=="object"&&C$,typeof define=="function"&&define)});var loe=uo((coe,I$)=>{"use strict";(function(n,t,e){function r(i){var a=this;a.next=function(){var c=a.x,h=a.i,f,g,d;return f=c[h],f^=f>>>7,g=f^f<<24,f=c[h+1&7],g^=f^f>>>10,f=c[h+3&7],g^=f^f>>>3,f=c[h+4&7],g^=f^f<<7,f=c[h+7&7],f=f^f<<13,g^=f^f<<9,c[h]=g,a.i=h+1&7,g};function u(c,h){var f,g,d=[];if(h===(h|0))g=d[0]=h;else for(h=""+h,f=0;f<h.length;++f)d[f&7]=d[f&7]<<15^h.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?g=d[7]=-1:g=d[f],c.x=d,c.i=0,f=256;f>0;--f)c.next()}u(a,i)}function o(i,a){return a.x=i.x.slice(),a.i=i.i,a}function s(i,a){i==null&&(i=+new Date);var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(c.x&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xorshift7=s})(coe,typeof I$=="object"&&I$,typeof define=="function"&&define)});var hoe=uo((poe,_$)=>{"use strict";(function(n,t,e){function r(i){var a=this;a.next=function(){var c=a.w,h=a.X,f=a.i,g,d;return a.w=c=c+1640531527|0,d=h[f+34&127],g=h[f=f+1&127],d^=d<<13,g^=g<<17,d^=d>>>15,g^=g>>>12,d=h[f]=d^g,a.i=f,d+(c^c>>>16)|0};function u(c,h){var f,g,d,p,m,y=[],v=128;for(h===(h|0)?(g=h,h=null):(h=h+"\0",g=0,v=Math.max(v,h.length)),d=0,p=-32;p<v;++p)h&&(g^=h.charCodeAt((p+32)%h.length)),p===0&&(m=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,p>=0&&(m=m+1640531527|0,f=y[p&127]^=g+m,d=f==0?d+1:0);for(d>=128&&(y[(h&&h.length||0)&127]=-1),d=127,p=4*128;p>0;--p)g=y[d+34&127],f=y[d=d+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,y[d]=g^f;c.w=m,c.X=y,c.i=d}u(a,i)}function o(i,a){return a.i=i.i,a.w=i.w,a.X=i.X.slice(),a}function s(i,a){i==null&&(i=+new Date);var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(c.X&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xor4096=s})(poe,typeof _$=="object"&&_$,typeof define=="function"&&define)});var foe=uo((doe,T$)=>{"use strict";(function(n,t,e){function r(i){var a=this,u="";a.next=function(){var h=a.b,f=a.c,g=a.d,d=a.a;return h=h<<25^h>>>7^f,f=f-g|0,g=g<<24^g>>>8^d,d=d-h|0,a.b=h=h<<20^h>>>12^f,a.c=f=f-g|0,a.d=g<<16^f>>>16^d,a.a=d-h|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,i===Math.floor(i)?(a.a=i/4294967296|0,a.b=i|0):u+=i;for(var c=0;c<u.length+20;c++)a.b^=u.charCodeAt(c)|0,a.next()}function o(i,a){return a.a=i.a,a.b=i.b,a.c=i.c,a.d=i.d,a}function s(i,a){var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.tychei=s})(doe,typeof T$=="object"&&T$,typeof define=="function"&&define)});var moe=uo((Pqt,XD)=>{"use strict";(function(n,t){var e=(0,eval)("this"),r=256,o=6,s=52,i="random",a=t.pow(r,o),u=t.pow(2,s),c=u*2,h=r-1,f;function g(T,O,S){var F=[];O=O==!0?{entropy:!0}:O||{};var R=y(m(O.entropy?[T,N(n)]:T??v(),3),F),L=new d(F),q=function(){for(var U=L.g(o),Z=a,ee=0;U<u;)U=(U+ee)*r,Z*=r,ee=L.g(1);for(;U>=c;)U/=2,Z/=2,ee>>>=1;return(U+ee)/Z};return q.int32=function(){return L.g(4)|0},q.quick=function(){return L.g(4)/4294967296},q.double=q,y(N(L.S),n),(O.pass||S||function(U,Z,ee,Q){return Q&&(Q.S&&p(Q,L),U.state=function(){return p(L,{})}),ee?(t[i]=U,Z):U})(q,R,"global"in O?O.global:this==t,O.state)}t["seed"+i]=g;function d(T){var O,S=T.length,F=this,R=0,L=F.i=F.j=0,q=F.S=[];for(S||(T=[S++]);R<r;)q[R]=R++;for(R=0;R<r;R++)q[R]=q[L=h&L+T[R%S]+(O=q[R])],q[L]=O;(F.g=function(U){for(var Z,ee=0,Q=F.i,oe=F.j,se=F.S;U--;)Z=se[Q=h&Q+1],ee=ee*r+se[h&(se[Q]=se[oe=h&oe+Z])+(se[oe]=Z)];return F.i=Q,F.j=oe,ee})(r)}function p(T,O){return O.i=T.i,O.j=T.j,O.S=T.S.slice(),O}function m(T,O){var S=[],F=typeof T,R;if(O&&F=="object")for(R in T)try{S.push(m(T[R],O-1))}catch{}return S.length?S:F=="string"?T:T+"\0"}function y(T,O){for(var S=T+"",F,R=0;R<S.length;)O[h&R]=h&(F^=O[h&R]*19)+S.charCodeAt(R++);return N(O)}function v(){try{var T;return f&&(T=f.randomBytes)?T=T(r):(T=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(T)),N(T)}catch{var O=e.navigator,S=O&&O.plugins;return[+new Date,e,S,e.screen,N(n)]}}function N(T){return String.fromCharCode.apply(0,T)}if(y(t.random(),n),typeof XD=="object"&&XD.exports){XD.exports=g;try{f=tk()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return g})})([],Math)});var E$=uo(($qt,goe)=>{"use strict";var t4e=ooe(),n4e=ioe(),r4e=uoe(),o4e=loe(),s4e=hoe(),i4e=foe(),Tx=moe();Tx.alea=t4e;Tx.xor128=n4e;Tx.xorwow=r4e;Tx.xorshift7=o4e;Tx.xor4096=s4e;Tx.tychei=i4e;goe.exports=Tx});function yoe(n,t){return YD(n,t)}function YD(n,t,e=new Map,r=new Set){if(n==null)return null;if(r.has(n))throw new Error("Circular references are not supported.");if(e.has(n))return e.get(n);let o=t(n);if(o.recurse&&o.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(o.recurse)if(ey(n)){let s=Array.isArray(n)?[]:{};r.add(n);for(let i in n){let a=n[i],u=YD(a,t,e,r);s[i]=u}return r.delete(n),s}else throw new Error(`Can't recurse into non-iterable type: ${n}`);else return e.set(n,o.value),o.value}function xoe(n,t=N$){return boe(n,t)}function boe(n,t,e=new Set){let r=n[0];if(e.has(r))throw new Error("Circular references are not supported.");let o=t(n);if(o.recurse&&o.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(o.recurse)if(ey(r)){let s=Array.isArray(r)?[]:{};e.add(r);for(let i in r){let a=n.map(c=>c[i]),u=boe(a,t,e);s[i]=u}return e.delete(r),s}else throw new Error(`Can't recurse into non-iterable type: ${r}`);else return o.value}function N$(n){return n===null?null:ey(n[0])?{value:null,recurse:!0}:{value:n,recurse:!1}}function QD(n,t){return Te(this,null,function*(){let e=new Map;YD(n,t,e);for(let o of Array.from(e.keys())){let s=e.get(o);if(Y.isPromise(s)){let i=yield s;e.set(o,i)}}return YD(n,t,e)})}function ey(n){return n!=null&&!ArrayBuffer.isView(n)&&(Array.isArray(n)||typeof n=="object"&&!(n instanceof Me))}function voe(n){return n==null||a4e(n)||Array.isArray(n)||typeof n=="object"&&n instanceof Me||Y.isTypedArray(n)}function a4e(n){return n===null||typeof n!="object"&&typeof n!="function"}var ZD=D(()=>{"use strict";ve();});function woe(n){return yoe(n,u4e)}function u4e(n){return n instanceof Me?{value:n.clone(),recurse:!1}:ey(n)?{value:null,recurse:!0}:{value:n,recurse:!1}}var Soe=D(()=>{"use strict";ve();ZD();});var l2,k$=D(()=>{"use strict";l2=class{constructor(t){if(this.capacity=t,this.begin=0,this.end=0,t==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}wrap(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity}get(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]}set(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e}length(){let t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)}pushAll(t){for(let e of t)this.push(e)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);let t=this.get(this.end);return this.set(this.end,void 0),t}unshift(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t}shuffleExcise(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let e=this.wrap(this.begin+t),r=this.get(e);return this.set(e,this.pop()),r}}});var Coe,Ioe=D(()=>{"use strict";k$();Coe=(()=>{class n extends l2{constructor(){super(n.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){let e=this.capacity*2,r=new Array(e),o=this.length();for(let s=0;s<o;s++)r[s]=this.get(this.wrap(this.begin+s));this.data=r,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=o}}return n.INITIAL_CAPACITY=32,n})()});function j$(n){return new D$(n)}function JI(n){return new A$(n)}function Toe(n,t){return new eA(n,t)}function Eoe(n,t=ty.FAIL){return new z$(n,t)}var _oe,Rs,D$,A$,O$,R$,M$,F$,P$,$$,L$,JD,Ex,B$,eA,ty,z$,tA,V$,Nx=D(()=>{"use strict";ve();_oe=kS(E$());Soe();ZD();Ioe();k$();Rs=class{toArray(){return Te(this,null,function*(){let t=[],e=yield this.next();for(;!e.done;)t.push(e.value),e=yield this.next();return t})}toArrayForTest(){return Te(this,null,function*(){let t=this.prefetch(100),e=[],r=yield t.next();for(;!r.done;)e.push(r.value),r=yield t.next();return e})}resolveFully(){return Te(this,null,function*(){let t=yield this.next();for(;!t.done;)t=yield this.next()})}resolveWhile(t){return Te(this,null,function*(){let e=yield this.next(),r=t(e.value);for(;!e.done&&r;)e=yield this.next(),r=t(e.value)})}handleErrors(t){return new L$(this,t)}filter(t){return new P$(this,t)}map(t){return new $$(this,t)}mapAsync(t){return new JD(this,t)}serialMapAsync(t){return new JD(this,t).serial()}flatmap(t){return new B$(this,t)}forEachAsync(t){return Te(this,null,function*(){return this.map(t).resolveFully()})}serialForEach(t){return Te(this,null,function*(){return this.serialMapAsync(t).resolveWhile(e=>e===!0)})}rowMajorBatch(t,e=!0){return new F$(this,t,e)}columnMajorBatch(t,e=!0,r=N$){return this.rowMajorBatch(t,e).map(s=>xoe(s,r))}concatenate(t,e){return new eA(j$([this,t]),e)}take(t){return t<0||t==null?this:new M$(this,t)}skip(t){return t<0||t==null?this:new R$(this,t)}prefetch(t){return new tA(this,t)}shuffle(t,e){return new V$(this,t,e)}serial(){return new O$(this)}},D$=class extends Rs{constructor(t){super(),this.items=t,this.trav=0}summary(){return`Array of ${this.items.length} items`}next(){return Te(this,null,function*(){if(this.trav>=this.items.length)return{value:null,done:!0};let t=this.items[this.trav];return this.trav++,{value:woe(t),done:!1}})}},A$=class extends Rs{constructor(t){super(),this.nextFn=t}summary(){return"Function call"}next(){return Te(this,null,function*(){try{return this.nextFn()}catch(t){throw t.message=`Error thrown while iterating through a dataset: ${t.message}`,t}})}},O$=class extends Rs{constructor(t){super(),this.upstream=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}next(){return Te(this,null,function*(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead})}serialNext(){return Te(this,null,function*(){return this.upstream.next()})}},R$=class extends Rs{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}next(){return Te(this,null,function*(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead})}serialNext(){return Te(this,null,function*(){for(;this.count++<this.maxCount;){let t=yield this.upstream.next();if(t.done)return t;Vn(t.value)}return this.upstream.next()})}},M$=class extends Rs{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}next(){return Te(this,null,function*(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()})}},F$=class extends Rs{constructor(t,e,r=!0){super(),this.upstream=t,this.batchSize=e,this.enableSmallLastBatch=r,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}next(){return Te(this,null,function*(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead})}serialNext(){return Te(this,null,function*(){let t=[];for(;t.length<this.batchSize;){let e=yield this.upstream.next();if(e.done)return this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0};t.push(e.value)}return{value:t,done:!1}})}},P$=class extends Rs{constructor(t,e){super(),this.upstream=t,this.predicate=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}next(){return Te(this,null,function*(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead})}serialNext(){return Te(this,null,function*(){for(;;){let t=yield this.upstream.next();if(t.done||this.predicate(t.value))return t;Vn(t.value)}})}},$$=class extends Rs{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Map`}next(){return Te(this,null,function*(){let t=yield this.upstream.next();if(t.done)return{value:null,done:!0};let e=Kc.getTensorsInContainer(t.value),r=this.transform(t.value),o=Kc.getTensorsInContainer(r);for(let s of e)Kc.isTensorInList(s,o)||s.dispose();return{value:r,done:!1}})}},L$=class extends Rs{constructor(t,e){super(),this.upstream=t,this.handler=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}next(){return Te(this,null,function*(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead})}serialNext(){return Te(this,null,function*(){for(;;)try{return yield this.upstream.next()}catch(t){if(!this.handler(t))return{value:null,done:!0}}})}},JD=class extends Rs{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> AsyncMap`}next(){return Te(this,null,function*(){let t=yield this.upstream.next();if(t.done)return{value:null,done:!0};let e=Kc.getTensorsInContainer(t.value),r=yield this.transform(t.value),o=Kc.getTensorsInContainer(r);for(let s of e)Kc.isTensorInList(s,o)||s.dispose();return{value:r,done:!1}})}},Ex=class extends Rs{constructor(){super(),this.outputQueue=new Coe,this.lastRead=Promise.resolve({value:null,done:!1})}next(){return Te(this,null,function*(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead})}serialNext(){return Te(this,null,function*(){for(;this.outputQueue.length()===0;)if(!(yield this.pump()))return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}})}},B$=class extends Ex{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Flatmap`}pump(){return Te(this,null,function*(){let t=yield this.upstream.next();if(t.done)return!1;let e=Kc.getTensorsInContainer(t.value),r=this.transform(t.value),o=Kc.getTensorsInContainer(r);this.outputQueue.pushAll(r);for(let s of e)Kc.isTensorInList(s,o)||s.dispose();return!0})}},eA=class extends Rs{constructor(t,e){super(),this.baseErrorHandler=e,this.lastRead=null,this.iterator=null,this.moreIterators=t}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}next(){return Te(this,null,function*(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead})}readFromChain(t){return Te(this,null,function*(){if(yield t,this.iterator==null){let r=yield this.moreIterators.next();if(r.done)return{value:null,done:!0};this.iterator=r.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}let e=yield this.iterator.next();return e.done?(this.iterator=null,this.readFromChain(t)):e})}},ty=function(n){return n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST",n}(ty||{}),z$=class extends Rs{constructor(t,e=ty.FAIL){super(),this.iterators=t,this.mismatchMode=e,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}nextState(t){return Te(this,null,function*(){yield t;let e=0,r=0;function o(i){return i instanceof Rs?{value:i.next().then(u=>(e++,u.done&&r++,u.value)),recurse:!1}:{value:null,recurse:!0}}let s=yield QD(this.iterators,o);if(e===r)return{value:null,done:!0};if(r>0)switch(this.mismatchMode){case ty.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case ty.SHORTEST:return{value:null,done:!0};case ty.LONGEST:default:}return this.count++,{value:s,done:!1}})}next(){return Te(this,null,function*(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise})}},tA=class extends Rs{constructor(t,e){super(),this.upstream=t,this.bufferSize=e,this.buffer=new l2(e)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){let t=this.upstream.next();this.buffer.push(t)}}next(){return this.refill(),this.buffer.shift()}},V$=class extends tA{constructor(t,e,r){super(t,e),this.upstream=t,this.windowSize=e,this.upstreamExhausted=!1,this.random=_oe.alea(r||Y.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}next(){return Te(this,null,function*(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead})}randomInt(t){return Math.floor(this.random()*t)}chooseIndex(){return this.randomInt(this.buffer.length())}serialNext(){return Te(this,null,function*(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){let t=this.chooseIndex(),e=yield this.buffer.shuffleExcise(t);if(e.done)this.upstreamExhausted=!0;else return this.refill(),e}return{value:null,done:!0}})}}});function Ku(n,t=null){return new class extends ny{constructor(){super(...arguments),this.size=t}iterator(){return Te(this,null,function*(){return n()})}}}function koe(n){return Ku(()=>Te(null,null,function*(){return j$(n)}),n.length)}function Doe(n){if(!ey(n))throw new Error("The argument to zip() must be an object or array.");let t;if(Array.isArray(n))for(let e=0;e<n.length;e++)t=t==null?n[e].size:Math.min(t,n[e].size);else if(n instanceof Object)for(let e in n)t=t==null?n[e].size:Math.min(t,n[e].size);return Ku(()=>Te(null,null,function*(){let e=yield QD(n,r=>{if(r instanceof ny)return{value:r.iterator(),recurse:!1};if(ey(r))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")});return Eoe(e,ty.SHORTEST)}),t)}function c4e(n){if(n===null)return null;let t=n[0];return voe(t)?{value:l4e(n),recurse:!1}:{value:null,recurse:!0}}function l4e(n){if(n.length===0)throw new Error("Can't make a batch of zero elements.");return n[0]instanceof Me?xs(n):wa(n)}var Noe,ny,e_=D(()=>{"use strict";ve();Noe=kS(E$());Nx();ZD();ny=(()=>{class n{constructor(){this.size=null}batch(e,r=!0){let o=this;Y.assert(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let s;return this.size===1/0||this.size==null?s=this.size:r?s=Math.ceil(this.size/e):s=Math.floor(this.size/e),Ku(()=>Te(this,null,function*(){return(yield o.iterator()).columnMajorBatch(e,r,c4e)}),s)}concatenate(e){let r=this,o;return this.size===1/0||e.size===1/0?o=1/0:this.size!=null&&e.size!=null?o=this.size+e.size:o=null,Ku(()=>Te(this,null,function*(){return(yield r.iterator()).concatenate(yield e.iterator())}),o)}filter(e){let r=this,o;return this.size===1/0?o=1/0:o=null,Ku(()=>Te(this,null,function*(){return(yield r.iterator()).filter(s=>st(()=>e(s)))}),o)}forEachAsync(e){return Te(this,null,function*(){return(yield this.iterator()).forEachAsync(e)})}map(e){let r=this;return Ku(()=>Te(this,null,function*(){return(yield r.iterator()).map(o=>st(()=>e(o)))}),this.size)}mapAsync(e){let r=this;return Ku(()=>Te(this,null,function*(){return(yield r.iterator()).mapAsync(e)}),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");let r=this;return Ku(()=>Te(this,null,function*(){return(yield r.iterator()).prefetch(e)}),this.size)}repeat(e){let r=this,o;return this.size!=null&&e>0?o=this.size*e:e===0?o=0:this.size!=null&&(e===void 0||e<0)?o=1/0:o=null,Ku(()=>Te(this,null,function*(){let s=JI(()=>Te(this,null,function*(){return{value:yield r.iterator(),done:!1}}));return Toe(s.take(e))}),o)}skip(e){let r=this,o;return this.size!=null&&e>=0&&this.size>=e?o=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?o=0:o=null,Ku(()=>Te(this,null,function*(){return(yield r.iterator()).skip(e)}),o)}shuffle(e,r,o=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);let s=this,i=Noe.alea(r||Y.now().toString());return Ku(()=>Te(this,null,function*(){let a=i.int32();return o&&(a+=i.int32()),(yield s.iterator()).shuffle(e,a.toString())}),this.size)}take(e){let r=this,o;return this.size!=null&&this.size>e?o=e:this.size!=null&&this.size<=e?o=this.size:o=null,Ku(()=>Te(this,null,function*(){return(yield r.iterator()).take(e)}),o)}toArray(){return Te(this,null,function*(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(yield this.iterator()).toArray()})}toArrayForTest(){return Te(this,null,function*(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(yield this.iterator()).toArrayForTest()})}}return n.MAX_BUFFER_SIZE=1e4,n})()});var p2,U$=D(()=>{"use strict";e_();p2=class extends ny{constructor(t){super(),this.input=t}iterator(){return Te(this,null,function*(){return(yield this.input.iterator()).decodeUTF8().split(`
`).map(o=>(o.endsWith("\r")&&(o=o.slice(0,-1)),o))})}}});var nA,t_,Aoe,rA,q$,Ooe,h2,G$=D(()=>{"use strict";ve();e_();U$();nA='"',t_=Symbol("out"),Aoe=Symbol("field"),rA=Symbol("quote"),q$=Symbol("quoteafterquote"),Ooe=Symbol("quoteinquote"),h2=class extends ny{constructor(t,e){super(),this.input=t,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new p2(t),e||(e={}),this.hasHeader=e.hasHeader!==!1,this.fullColumnNames=e.columnNames,this.columnConfigs=e.columnConfigs,this.configuredColumnsOnly=e.configuredColumnsOnly,e.delimWhitespace?(Y.assert(e.delimiter==null,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=e.delimiter?e.delimiter:","}columnNames(){return Te(this,null,function*(){return this.columnNamesValidated||(yield this.setColumnNames()),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames})}setColumnNames(){return Te(this,null,function*(){let t=yield this.maybeReadHeaderLine();if(!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&t&&Y.assert(t.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=t);let e=this.fullColumnNames.reduce((o,s)=>(o[s]=o[s]+1||1,o),{}),r=Object.keys(e).filter(o=>e[o]>1);if(Y.assert(r.length===0,()=>"Duplicate column names found: "+r.toString()),this.columnConfigs){for(let o of Object.keys(this.columnConfigs))if(this.fullColumnNames.indexOf(o)===-1)throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0})}maybeReadHeaderLine(){return Te(this,null,function*(){if(this.hasHeader){let e=yield(yield this.base.iterator()).next();if(e.done)throw new Error("No data was found for CSV parsing.");let r=e.value;return this.parseRow(r,!1)}else return null})}iterator(){return Te(this,null,function*(){this.columnNamesValidated||(yield this.setColumnNames());let t=yield this.base.iterator();return this.hasHeader&&(t=t.skip(1)),t.map(e=>this.makeDataElement(e))})}makeDataElement(t){let e=this.parseRow(t),r={},o={};for(let s=0;s<this.fullColumnNames.length;s++){let i=this.fullColumnNames[s],a=this.columnConfigs?this.columnConfigs[i]:null;if(!(this.configuredColumnsOnly&&!a)){let u=e[s],c=null;if(u==="")if(a&&a.default!==void 0)c=a.default;else{if(a&&(a.required||a.isLabel))throw new Error(`Required column ${i} is empty in this line: ${t}`);c=void 0}else{let h=Number(u);if(isNaN(h))a&&a.dtype==="bool"?c=this.getBoolean(u):c=u;else if(!a||!a.dtype)c=h;else switch(a.dtype){case"float32":c=h;break;case"int32":c=Math.floor(h);break;case"bool":c=this.getBoolean(u);break;default:c=h}}a&&a.isLabel?o[i]=c:r[i]=c}}return Object.keys(o).length===0?r:{xs:r,ys:o}}getBoolean(t){return t==="1"||t.toLowerCase()==="true"?1:0}parseRow(t,e=!0){let r=[],o=0,s=t.length,i=t_;for(let a=0;a<s;a++)switch(i){case t_:switch(t.charAt(a)){case nA:o=a+1,i=rA;break;case this.delimiter:if(o=a+1,this.delimiter===" "&&this.delimWhitespace)break;r.push(""),i=t_;break;default:i=Aoe,o=a;break}break;case Aoe:switch(t.charAt(a)){case this.delimiter:r.push(t.substring(o,a)),i=t_,o=a+1;break;default:}break;case rA:switch(t.charAt(a)){case nA:i=q$;break;default:}break;case q$:switch(t.charAt(a)){case this.delimiter:r.push(t.substring(o,a-1)),i=t_,o=a+1;break;case nA:i=rA;break;default:i=Ooe;break}break;case Ooe:switch(t.charAt(a)){case nA:i=rA;break;default:}break;default:}if(i===q$?r.push(t.substring(o,s-1)):r.push(t.substring(o)),e&&r.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${r}`);return r}}});var oA,Roe=D(()=>{"use strict";ve();Nx();oA=class n extends Rs{constructor(t){super(),this.microphoneConfig=t,this.isClosed=!1,this.fftSize=t.fftSize||1024;let e=Math.log2(this.fftSize);if(this.fftSize<0||e<4||e>14||!Number.isInteger(e))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=t.numFramesPerSpectrogram||43,this.sampleRateHz=t.sampleRateHz,this.columnTruncateLength=t.columnTruncateLength||this.fftSize,this.audioTrackConstraints=t.audioTrackConstraints,this.smoothingTimeConstant=t.smoothingTimeConstant||0,this.includeSpectrogram=t.includeSpectrogram!==!1,this.includeWaveform=t.includeWaveform===!0,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static create(){return Te(this,arguments,function*(t={}){if(mt().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");let e=new n(t);return yield e.start(),e})}start(){return Te(this,null,function*(){try{this.stream=yield navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})}catch(r){throw new Error(`Error thrown while initializing video stream: ${r.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");let t=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new t,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`);let e=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,e.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)})}next(){return Te(this,null,function*(){if(this.isClosed)return{value:null,done:!0};let t,e,r=yield this.getAudioData();if(this.includeSpectrogram){let o=this.flattenQueue(r.freqDataQueue);t=this.getTensorFromAudioDataArray(o,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){let o=this.flattenQueue(r.timeDataQueue);e=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:t,waveform:e},done:!1}})}capture(){return Te(this,null,function*(){return(yield this.next()).value})}getAudioData(){return Te(this,null,function*(){let t=[],e=[],r=0;return new Promise(o=>{let s=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&o({freqDataQueue:t,timeDataQueue:e}),t.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),e.push(this.timeData.slice())),++r===this.numFrames&&(clearInterval(s),o({freqDataQueue:t,timeDataQueue:e}))},this.fftSize/this.sampleRateHz*1e3)})})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(t){let e=t[0].length,r=new Float32Array(t.length*e);return t.forEach((o,s)=>r.set(o,s*e)),r}getTensorFromAudioDataArray(t,e){let r=new Float32Array(Y.sizeFromShape(e));return r.set(t,r.length-t.length),wa(r,e)}}});var sA,Moe=D(()=>{"use strict";ve();Nx();sA=class n extends Rs{constructor(t,e){if(super(),this.webcamVideoElement=t,this.webcamConfig=e,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=bs([0],"int32"),this.webcamConfig.centerCrop){let r=this.webcamConfig.resizeWidth*1/this.webcamVideoElement.width,o=this.webcamConfig.resizeHeight*1/this.webcamVideoElement.height,s=(1-r)/2,i=(1-o)/2,a=s+r,u=o+i;this.cropBox=Lp([i,s,u,a],[1,4])}else this.cropBox=Lp([0,0,1,1],[1,4])}summary(){return"webcam"}static create(r){return Te(this,arguments,function*(t,e={}){if(mt().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!e.resizeWidth||!e.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=e.resizeWidth,t.height=e.resizeHeight}let o=new n(t,e);return yield o.start(),o})}start(){return Te(this,null,function*(){this.webcamConfig.facingMode&&Y.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=yield navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(t){throw t.message=`Error thrown while initializing video stream: ${t.message}`,t}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(t){console.log(t),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(t=>{this.webcamVideoElement.onloadedmetadata=()=>{t()}})})}next(){return Te(this,null,function*(){if(this.isClosed)return{value:null,done:!0};let t;try{t=VC.fromPixels(this.webcamVideoElement)}catch(e){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(e)}`)}if(this.resize)try{return{value:this.cropAndResizeFrame(t),done:!1}}catch(e){throw new Error(`Error thrown cropping the video: ${e.message}`)}finally{t.dispose()}else return{value:t,done:!1}})}needToResize(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))}cropAndResizeFrame(t){return st(()=>{let e=t.toFloat().expandDims(0),r;r=zp.cropAndResize(e,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");let o=r.shape;return r.reshape(o.slice(1))})}capture(){return Te(this,null,function*(){return(yield this.next()).value})}stop(){this.stream.getTracks().forEach(e=>e.stop());try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}});var d2,W$=D(()=>{"use strict";d2=class{}});var n_,H$,K$,Foe=D(()=>{"use strict";Nx();n_=class extends Rs{split(t){return new H$(this,t)}},H$=class extends n_{constructor(t,e){super(),this.upstream=t,this.impl=new K$(t,e)}summary(){return this.impl.summary()}next(){return Te(this,null,function*(){return this.impl.next()})}},K$=class extends Ex{constructor(t,e){super(),this.upstream=t,this.separator=e,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}pump(){return Te(this,null,function*(){let t=yield this.upstream.next();if(t.done)return this.carryover===""?!1:(this.outputQueue.push(this.carryover),this.carryover="",!0);let e=t.value.split(this.separator);e[0]=this.carryover+e[0];for(let r of e.slice(0,-1))this.outputQueue.push(r);return this.carryover=e[e.length-1],!0})}}});var Loe=uo(iA=>{"use strict";iA.byteLength=h4e;iA.toByteArray=f4e;iA.fromByteArray=y4e;var tf=[],Wl=[],p4e=typeof Uint8Array<"u"?Uint8Array:Array,X$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(kx=0,Poe=X$.length;kx<Poe;++kx)tf[kx]=X$[kx],Wl[X$.charCodeAt(kx)]=kx;var kx,Poe;Wl[45]=62;Wl[95]=63;function $oe(n){var t=n.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=n.indexOf("=");e===-1&&(e=t);var r=e===t?0:4-e%4;return[e,r]}function h4e(n){var t=$oe(n),e=t[0],r=t[1];return(e+r)*3/4-r}function d4e(n,t,e){return(t+e)*3/4-e}function f4e(n){var t,e=$oe(n),r=e[0],o=e[1],s=new p4e(d4e(n,r,o)),i=0,a=o>0?r-4:r,u;for(u=0;u<a;u+=4)t=Wl[n.charCodeAt(u)]<<18|Wl[n.charCodeAt(u+1)]<<12|Wl[n.charCodeAt(u+2)]<<6|Wl[n.charCodeAt(u+3)],s[i++]=t>>16&255,s[i++]=t>>8&255,s[i++]=t&255;return o===2&&(t=Wl[n.charCodeAt(u)]<<2|Wl[n.charCodeAt(u+1)]>>4,s[i++]=t&255),o===1&&(t=Wl[n.charCodeAt(u)]<<10|Wl[n.charCodeAt(u+1)]<<4|Wl[n.charCodeAt(u+2)]>>2,s[i++]=t>>8&255,s[i++]=t&255),s}function m4e(n){return tf[n>>18&63]+tf[n>>12&63]+tf[n>>6&63]+tf[n&63]}function g4e(n,t,e){for(var r,o=[],s=t;s<e;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),o.push(m4e(r));return o.join("")}function y4e(n){for(var t,e=n.length,r=e%3,o=[],s=16383,i=0,a=e-r;i<a;i+=s)o.push(g4e(n,i,i+s>a?a:i+s));return r===1?(t=n[e-1],o.push(tf[t>>2]+tf[t<<4&63]+"==")):r===2&&(t=(n[e-2]<<8)+n[e-1],o.push(tf[t>>10]+tf[t>>4&63]+tf[t<<2&63]+"=")),o.join("")}});var Boe=uo(Y$=>{"use strict";Y$.read=function(n,t,e,r,o){var s,i,a=o*8-r-1,u=(1<<a)-1,c=u>>1,h=-7,f=e?o-1:0,g=e?-1:1,d=n[t+f];for(f+=g,s=d&(1<<-h)-1,d>>=-h,h+=a;h>0;s=s*256+n[t+f],f+=g,h-=8);for(i=s&(1<<-h)-1,s>>=-h,h+=r;h>0;i=i*256+n[t+f],f+=g,h-=8);if(s===0)s=1-c;else{if(s===u)return i?NaN:(d?-1:1)*(1/0);i=i+Math.pow(2,r),s=s-c}return(d?-1:1)*i*Math.pow(2,s-r)};Y$.write=function(n,t,e,r,o,s){var i,a,u,c=s*8-o-1,h=(1<<c)-1,f=h>>1,g=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,m=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,i=h):(i=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-i))<1&&(i--,u*=2),i+f>=1?t+=g/u:t+=g*Math.pow(2,1-f),t*u>=2&&(i++,u/=2),i+f>=h?(a=0,i=h):i+f>=1?(a=(t*u-1)*Math.pow(2,o),i=i+f):(a=t*Math.pow(2,f-1)*Math.pow(2,o),i=0));o>=8;n[e+d]=a&255,d+=p,a/=256,o-=8);for(i=i<<o|a,c+=o;c>0;n[e+d]=i&255,d+=p,i/=256,c-=8);n[e+d-p]|=m*128}});var Zoe=uo(m2=>{"use strict";var Q$=Loe(),f2=Boe(),zoe=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;m2.Buffer=Kt;m2.SlowBuffer=C4e;m2.INSPECT_MAX_BYTES=50;var aA=2147483647;m2.kMaxLength=aA;Kt.TYPED_ARRAY_SUPPORT=x4e();!Kt.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function x4e(){try{var n=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(n,t),n.foo()===42}catch{return!1}}Object.defineProperty(Kt.prototype,"parent",{enumerable:!0,get:function(){if(Kt.isBuffer(this))return this.buffer}});Object.defineProperty(Kt.prototype,"offset",{enumerable:!0,get:function(){if(Kt.isBuffer(this))return this.byteOffset}});function ig(n){if(n>aA)throw new RangeError('The value "'+n+'" is invalid for option "size"');var t=new Uint8Array(n);return Object.setPrototypeOf(t,Kt.prototype),t}function Kt(n,t,e){if(typeof n=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return t8(n)}return Uoe(n,t,e)}Kt.poolSize=8192;function Uoe(n,t,e){if(typeof n=="string")return v4e(n,t);if(ArrayBuffer.isView(n))return w4e(n);if(n==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n);if(nf(n,ArrayBuffer)||n&&nf(n.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(nf(n,SharedArrayBuffer)||n&&nf(n.buffer,SharedArrayBuffer)))return J$(n,t,e);if(typeof n=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var r=n.valueOf&&n.valueOf();if(r!=null&&r!==n)return Kt.from(r,t,e);var o=S4e(n);if(o)return o;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof n[Symbol.toPrimitive]=="function")return Kt.from(n[Symbol.toPrimitive]("string"),t,e);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n)}Kt.from=function(n,t,e){return Uoe(n,t,e)};Object.setPrototypeOf(Kt.prototype,Uint8Array.prototype);Object.setPrototypeOf(Kt,Uint8Array);function qoe(n){if(typeof n!="number")throw new TypeError('"size" argument must be of type number');if(n<0)throw new RangeError('The value "'+n+'" is invalid for option "size"')}function b4e(n,t,e){return qoe(n),n<=0?ig(n):t!==void 0?typeof e=="string"?ig(n).fill(t,e):ig(n).fill(t):ig(n)}Kt.alloc=function(n,t,e){return b4e(n,t,e)};function t8(n){return qoe(n),ig(n<0?0:n8(n)|0)}Kt.allocUnsafe=function(n){return t8(n)};Kt.allocUnsafeSlow=function(n){return t8(n)};function v4e(n,t){if((typeof t!="string"||t==="")&&(t="utf8"),!Kt.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var e=Goe(n,t)|0,r=ig(e),o=r.write(n,t);return o!==e&&(r=r.slice(0,o)),r}function Z$(n){for(var t=n.length<0?0:n8(n.length)|0,e=ig(t),r=0;r<t;r+=1)e[r]=n[r]&255;return e}function w4e(n){if(nf(n,Uint8Array)){var t=new Uint8Array(n);return J$(t.buffer,t.byteOffset,t.byteLength)}return Z$(n)}function J$(n,t,e){if(t<0||n.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(n.byteLength<t+(e||0))throw new RangeError('"length" is outside of buffer bounds');var r;return t===void 0&&e===void 0?r=new Uint8Array(n):e===void 0?r=new Uint8Array(n,t):r=new Uint8Array(n,t,e),Object.setPrototypeOf(r,Kt.prototype),r}function S4e(n){if(Kt.isBuffer(n)){var t=n8(n.length)|0,e=ig(t);return e.length===0||n.copy(e,0,0,t),e}if(n.length!==void 0)return typeof n.length!="number"||r8(n.length)?ig(0):Z$(n);if(n.type==="Buffer"&&Array.isArray(n.data))return Z$(n.data)}function n8(n){if(n>=aA)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+aA.toString(16)+" bytes");return n|0}function C4e(n){return+n!=n&&(n=0),Kt.alloc(+n)}Kt.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==Kt.prototype};Kt.compare=function(t,e){if(nf(t,Uint8Array)&&(t=Kt.from(t,t.offset,t.byteLength)),nf(e,Uint8Array)&&(e=Kt.from(e,e.offset,e.byteLength)),!Kt.isBuffer(t)||!Kt.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,o=e.length,s=0,i=Math.min(r,o);s<i;++s)if(t[s]!==e[s]){r=t[s],o=e[s];break}return r<o?-1:o<r?1:0};Kt.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};Kt.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return Kt.alloc(0);var r;if(e===void 0)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var o=Kt.allocUnsafe(e),s=0;for(r=0;r<t.length;++r){var i=t[r];if(nf(i,Uint8Array))s+i.length>o.length?Kt.from(i).copy(o,s):Uint8Array.prototype.set.call(o,i,s);else if(Kt.isBuffer(i))i.copy(o,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=i.length}return o};function Goe(n,t){if(Kt.isBuffer(n))return n.length;if(ArrayBuffer.isView(n)||nf(n,ArrayBuffer))return n.byteLength;if(typeof n!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof n);var e=n.length,r=arguments.length>2&&arguments[2]===!0;if(!r&&e===0)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":return e8(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return e*2;case"hex":return e>>>1;case"base64":return Qoe(n).length;default:if(o)return r?-1:e8(n).length;t=(""+t).toLowerCase(),o=!0}}Kt.byteLength=Goe;function I4e(n,t,e){var r=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((e===void 0||e>this.length)&&(e=this.length),e<=0)||(e>>>=0,t>>>=0,e<=t))return"";for(n||(n="utf8");;)switch(n){case"hex":return M4e(this,t,e);case"utf8":case"utf-8":return Hoe(this,t,e);case"ascii":return O4e(this,t,e);case"latin1":case"binary":return R4e(this,t,e);case"base64":return D4e(this,t,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F4e(this,t,e);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),r=!0}}Kt.prototype._isBuffer=!0;function Dx(n,t,e){var r=n[t];n[t]=n[e],n[e]=r}Kt.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)Dx(this,e,e+1);return this};Kt.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)Dx(this,e,e+3),Dx(this,e+1,e+2);return this};Kt.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)Dx(this,e,e+7),Dx(this,e+1,e+6),Dx(this,e+2,e+5),Dx(this,e+3,e+4);return this};Kt.prototype.toString=function(){var t=this.length;return t===0?"":arguments.length===0?Hoe(this,0,t):I4e.apply(this,arguments)};Kt.prototype.toLocaleString=Kt.prototype.toString;Kt.prototype.equals=function(t){if(!Kt.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:Kt.compare(this,t)===0};Kt.prototype.inspect=function(){var t="",e=m2.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"};zoe&&(Kt.prototype[zoe]=Kt.prototype.inspect);Kt.prototype.compare=function(t,e,r,o,s){if(nf(t,Uint8Array)&&(t=Kt.from(t,t.offset,t.byteLength)),!Kt.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(e===void 0&&(e=0),r===void 0&&(r=t?t.length:0),o===void 0&&(o=0),s===void 0&&(s=this.length),e<0||r>t.length||o<0||s>this.length)throw new RangeError("out of range index");if(o>=s&&e>=r)return 0;if(o>=s)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,o>>>=0,s>>>=0,this===t)return 0;for(var i=s-o,a=r-e,u=Math.min(i,a),c=this.slice(o,s),h=t.slice(e,r),f=0;f<u;++f)if(c[f]!==h[f]){i=c[f],a=h[f];break}return i<a?-1:a<i?1:0};function Woe(n,t,e,r,o){if(n.length===0)return-1;if(typeof e=="string"?(r=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,r8(e)&&(e=o?0:n.length-1),e<0&&(e=n.length+e),e>=n.length){if(o)return-1;e=n.length-1}else if(e<0)if(o)e=0;else return-1;if(typeof t=="string"&&(t=Kt.from(t,r)),Kt.isBuffer(t))return t.length===0?-1:Voe(n,t,e,r,o);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?o?Uint8Array.prototype.indexOf.call(n,t,e):Uint8Array.prototype.lastIndexOf.call(n,t,e):Voe(n,[t],e,r,o);throw new TypeError("val must be string, number or Buffer")}function Voe(n,t,e,r,o){var s=1,i=n.length,a=t.length;if(r!==void 0&&(r=String(r).toLowerCase(),r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le")){if(n.length<2||t.length<2)return-1;s=2,i/=2,a/=2,e/=2}function u(d,p){return s===1?d[p]:d.readUInt16BE(p*s)}var c;if(o){var h=-1;for(c=e;c<i;c++)if(u(n,c)===u(t,h===-1?0:c-h)){if(h===-1&&(h=c),c-h+1===a)return h*s}else h!==-1&&(c-=c-h),h=-1}else for(e+a>i&&(e=i-a),c=e;c>=0;c--){for(var f=!0,g=0;g<a;g++)if(u(n,c+g)!==u(t,g)){f=!1;break}if(f)return c}return-1}Kt.prototype.includes=function(t,e,r){return this.indexOf(t,e,r)!==-1};Kt.prototype.indexOf=function(t,e,r){return Woe(this,t,e,r,!0)};Kt.prototype.lastIndexOf=function(t,e,r){return Woe(this,t,e,r,!1)};function _4e(n,t,e,r){e=Number(e)||0;var o=n.length-e;r?(r=Number(r),r>o&&(r=o)):r=o;var s=t.length;r>s/2&&(r=s/2);for(var i=0;i<r;++i){var a=parseInt(t.substr(i*2,2),16);if(r8(a))return i;n[e+i]=a}return i}function T4e(n,t,e,r){return uA(e8(t,n.length-e),n,e,r)}function E4e(n,t,e,r){return uA(L4e(t),n,e,r)}function N4e(n,t,e,r){return uA(Qoe(t),n,e,r)}function k4e(n,t,e,r){return uA(B4e(t,n.length-e),n,e,r)}Kt.prototype.write=function(t,e,r,o){if(e===void 0)o="utf8",r=this.length,e=0;else if(r===void 0&&typeof e=="string")o=e,r=this.length,e=0;else if(isFinite(e))e=e>>>0,isFinite(r)?(r=r>>>0,o===void 0&&(o="utf8")):(o=r,r=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var s=this.length-e;if((r===void 0||r>s)&&(r=s),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var i=!1;;)switch(o){case"hex":return _4e(this,t,e,r);case"utf8":case"utf-8":return T4e(this,t,e,r);case"ascii":case"latin1":case"binary":return E4e(this,t,e,r);case"base64":return N4e(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k4e(this,t,e,r);default:if(i)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),i=!0}};Kt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function D4e(n,t,e){return t===0&&e===n.length?Q$.fromByteArray(n):Q$.fromByteArray(n.slice(t,e))}function Hoe(n,t,e){e=Math.min(n.length,e);for(var r=[],o=t;o<e;){var s=n[o],i=null,a=s>239?4:s>223?3:s>191?2:1;if(o+a<=e){var u,c,h,f;switch(a){case 1:s<128&&(i=s);break;case 2:u=n[o+1],(u&192)===128&&(f=(s&31)<<6|u&63,f>127&&(i=f));break;case 3:u=n[o+1],c=n[o+2],(u&192)===128&&(c&192)===128&&(f=(s&15)<<12|(u&63)<<6|c&63,f>2047&&(f<55296||f>57343)&&(i=f));break;case 4:u=n[o+1],c=n[o+2],h=n[o+3],(u&192)===128&&(c&192)===128&&(h&192)===128&&(f=(s&15)<<18|(u&63)<<12|(c&63)<<6|h&63,f>65535&&f<1114112&&(i=f))}}i===null?(i=65533,a=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|i&1023),r.push(i),o+=a}return A4e(r)}var joe=4096;function A4e(n){var t=n.length;if(t<=joe)return String.fromCharCode.apply(String,n);for(var e="",r=0;r<t;)e+=String.fromCharCode.apply(String,n.slice(r,r+=joe));return e}function O4e(n,t,e){var r="";e=Math.min(n.length,e);for(var o=t;o<e;++o)r+=String.fromCharCode(n[o]&127);return r}function R4e(n,t,e){var r="";e=Math.min(n.length,e);for(var o=t;o<e;++o)r+=String.fromCharCode(n[o]);return r}function M4e(n,t,e){var r=n.length;(!t||t<0)&&(t=0),(!e||e<0||e>r)&&(e=r);for(var o="",s=t;s<e;++s)o+=z4e[n[s]];return o}function F4e(n,t,e){for(var r=n.slice(t,e),o="",s=0;s<r.length-1;s+=2)o+=String.fromCharCode(r[s]+r[s+1]*256);return o}Kt.prototype.slice=function(t,e){var r=this.length;t=~~t,e=e===void 0?r:~~e,t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),e<t&&(e=t);var o=this.subarray(t,e);return Object.setPrototypeOf(o,Kt.prototype),o};function Ea(n,t,e){if(n%1!==0||n<0)throw new RangeError("offset is not uint");if(n+t>e)throw new RangeError("Trying to access beyond buffer length")}Kt.prototype.readUintLE=Kt.prototype.readUIntLE=function(t,e,r){t=t>>>0,e=e>>>0,r||Ea(t,e,this.length);for(var o=this[t],s=1,i=0;++i<e&&(s*=256);)o+=this[t+i]*s;return o};Kt.prototype.readUintBE=Kt.prototype.readUIntBE=function(t,e,r){t=t>>>0,e=e>>>0,r||Ea(t,e,this.length);for(var o=this[t+--e],s=1;e>0&&(s*=256);)o+=this[t+--e]*s;return o};Kt.prototype.readUint8=Kt.prototype.readUInt8=function(t,e){return t=t>>>0,e||Ea(t,1,this.length),this[t]};Kt.prototype.readUint16LE=Kt.prototype.readUInt16LE=function(t,e){return t=t>>>0,e||Ea(t,2,this.length),this[t]|this[t+1]<<8};Kt.prototype.readUint16BE=Kt.prototype.readUInt16BE=function(t,e){return t=t>>>0,e||Ea(t,2,this.length),this[t]<<8|this[t+1]};Kt.prototype.readUint32LE=Kt.prototype.readUInt32LE=function(t,e){return t=t>>>0,e||Ea(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};Kt.prototype.readUint32BE=Kt.prototype.readUInt32BE=function(t,e){return t=t>>>0,e||Ea(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};Kt.prototype.readIntLE=function(t,e,r){t=t>>>0,e=e>>>0,r||Ea(t,e,this.length);for(var o=this[t],s=1,i=0;++i<e&&(s*=256);)o+=this[t+i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*e)),o};Kt.prototype.readIntBE=function(t,e,r){t=t>>>0,e=e>>>0,r||Ea(t,e,this.length);for(var o=e,s=1,i=this[t+--o];o>0&&(s*=256);)i+=this[t+--o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*e)),i};Kt.prototype.readInt8=function(t,e){return t=t>>>0,e||Ea(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]};Kt.prototype.readInt16LE=function(t,e){t=t>>>0,e||Ea(t,2,this.length);var r=this[t]|this[t+1]<<8;return r&32768?r|4294901760:r};Kt.prototype.readInt16BE=function(t,e){t=t>>>0,e||Ea(t,2,this.length);var r=this[t+1]|this[t]<<8;return r&32768?r|4294901760:r};Kt.prototype.readInt32LE=function(t,e){return t=t>>>0,e||Ea(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};Kt.prototype.readInt32BE=function(t,e){return t=t>>>0,e||Ea(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};Kt.prototype.readFloatLE=function(t,e){return t=t>>>0,e||Ea(t,4,this.length),f2.read(this,t,!0,23,4)};Kt.prototype.readFloatBE=function(t,e){return t=t>>>0,e||Ea(t,4,this.length),f2.read(this,t,!1,23,4)};Kt.prototype.readDoubleLE=function(t,e){return t=t>>>0,e||Ea(t,8,this.length),f2.read(this,t,!0,52,8)};Kt.prototype.readDoubleBE=function(t,e){return t=t>>>0,e||Ea(t,8,this.length),f2.read(this,t,!1,52,8)};function xc(n,t,e,r,o,s){if(!Kt.isBuffer(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<s)throw new RangeError('"value" argument is out of bounds');if(e+r>n.length)throw new RangeError("Index out of range")}Kt.prototype.writeUintLE=Kt.prototype.writeUIntLE=function(t,e,r,o){if(t=+t,e=e>>>0,r=r>>>0,!o){var s=Math.pow(2,8*r)-1;xc(this,t,e,r,s,0)}var i=1,a=0;for(this[e]=t&255;++a<r&&(i*=256);)this[e+a]=t/i&255;return e+r};Kt.prototype.writeUintBE=Kt.prototype.writeUIntBE=function(t,e,r,o){if(t=+t,e=e>>>0,r=r>>>0,!o){var s=Math.pow(2,8*r)-1;xc(this,t,e,r,s,0)}var i=r-1,a=1;for(this[e+i]=t&255;--i>=0&&(a*=256);)this[e+i]=t/a&255;return e+r};Kt.prototype.writeUint8=Kt.prototype.writeUInt8=function(t,e,r){return t=+t,e=e>>>0,r||xc(this,t,e,1,255,0),this[e]=t&255,e+1};Kt.prototype.writeUint16LE=Kt.prototype.writeUInt16LE=function(t,e,r){return t=+t,e=e>>>0,r||xc(this,t,e,2,65535,0),this[e]=t&255,this[e+1]=t>>>8,e+2};Kt.prototype.writeUint16BE=Kt.prototype.writeUInt16BE=function(t,e,r){return t=+t,e=e>>>0,r||xc(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=t&255,e+2};Kt.prototype.writeUint32LE=Kt.prototype.writeUInt32LE=function(t,e,r){return t=+t,e=e>>>0,r||xc(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t&255,e+4};Kt.prototype.writeUint32BE=Kt.prototype.writeUInt32BE=function(t,e,r){return t=+t,e=e>>>0,r||xc(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};Kt.prototype.writeIntLE=function(t,e,r,o){if(t=+t,e=e>>>0,!o){var s=Math.pow(2,8*r-1);xc(this,t,e,r,s-1,-s)}var i=0,a=1,u=0;for(this[e]=t&255;++i<r&&(a*=256);)t<0&&u===0&&this[e+i-1]!==0&&(u=1),this[e+i]=(t/a>>0)-u&255;return e+r};Kt.prototype.writeIntBE=function(t,e,r,o){if(t=+t,e=e>>>0,!o){var s=Math.pow(2,8*r-1);xc(this,t,e,r,s-1,-s)}var i=r-1,a=1,u=0;for(this[e+i]=t&255;--i>=0&&(a*=256);)t<0&&u===0&&this[e+i+1]!==0&&(u=1),this[e+i]=(t/a>>0)-u&255;return e+r};Kt.prototype.writeInt8=function(t,e,r){return t=+t,e=e>>>0,r||xc(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=t&255,e+1};Kt.prototype.writeInt16LE=function(t,e,r){return t=+t,e=e>>>0,r||xc(this,t,e,2,32767,-32768),this[e]=t&255,this[e+1]=t>>>8,e+2};Kt.prototype.writeInt16BE=function(t,e,r){return t=+t,e=e>>>0,r||xc(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=t&255,e+2};Kt.prototype.writeInt32LE=function(t,e,r){return t=+t,e=e>>>0,r||xc(this,t,e,4,2147483647,-2147483648),this[e]=t&255,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4};Kt.prototype.writeInt32BE=function(t,e,r){return t=+t,e=e>>>0,r||xc(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};function Koe(n,t,e,r,o,s){if(e+r>n.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function Xoe(n,t,e,r,o){return t=+t,e=e>>>0,o||Koe(n,t,e,4,34028234663852886e22,-34028234663852886e22),f2.write(n,t,e,r,23,4),e+4}Kt.prototype.writeFloatLE=function(t,e,r){return Xoe(this,t,e,!0,r)};Kt.prototype.writeFloatBE=function(t,e,r){return Xoe(this,t,e,!1,r)};function Yoe(n,t,e,r,o){return t=+t,e=e>>>0,o||Koe(n,t,e,8,17976931348623157e292,-17976931348623157e292),f2.write(n,t,e,r,52,8),e+8}Kt.prototype.writeDoubleLE=function(t,e,r){return Yoe(this,t,e,!0,r)};Kt.prototype.writeDoubleBE=function(t,e,r){return Yoe(this,t,e,!1,r)};Kt.prototype.copy=function(t,e,r,o){if(!Kt.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),!o&&o!==0&&(o=this.length),e>=t.length&&(e=t.length),e||(e=0),o>0&&o<r&&(o=r),o===r||t.length===0||this.length===0)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),t.length-e<o-r&&(o=t.length-e+r);var s=o-r;return this===t&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(e,r,o):Uint8Array.prototype.set.call(t,this.subarray(r,o),e),s};Kt.prototype.fill=function(t,e,r,o){if(typeof t=="string"){if(typeof e=="string"?(o=e,e=0,r=this.length):typeof r=="string"&&(o=r,r=this.length),o!==void 0&&typeof o!="string")throw new TypeError("encoding must be a string");if(typeof o=="string"&&!Kt.isEncoding(o))throw new TypeError("Unknown encoding: "+o);if(t.length===1){var s=t.charCodeAt(0);(o==="utf8"&&s<128||o==="latin1")&&(t=s)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;e=e>>>0,r=r===void 0?this.length:r>>>0,t||(t=0);var i;if(typeof t=="number")for(i=e;i<r;++i)this[i]=t;else{var a=Kt.isBuffer(t)?t:Kt.from(t,o),u=a.length;if(u===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=a[i%u]}return this};var P4e=/[^+/0-9A-Za-z-_]/g;function $4e(n){if(n=n.split("=")[0],n=n.trim().replace(P4e,""),n.length<2)return"";for(;n.length%4!==0;)n=n+"=";return n}function e8(n,t){t=t||1/0;for(var e,r=n.length,o=null,s=[],i=0;i<r;++i){if(e=n.charCodeAt(i),e>55295&&e<57344){if(!o){if(e>56319){(t-=3)>-1&&s.push(239,191,189);continue}else if(i+1===r){(t-=3)>-1&&s.push(239,191,189);continue}o=e;continue}if(e<56320){(t-=3)>-1&&s.push(239,191,189),o=e;continue}e=(o-55296<<10|e-56320)+65536}else o&&(t-=3)>-1&&s.push(239,191,189);if(o=null,e<128){if((t-=1)<0)break;s.push(e)}else if(e<2048){if((t-=2)<0)break;s.push(e>>6|192,e&63|128)}else if(e<65536){if((t-=3)<0)break;s.push(e>>12|224,e>>6&63|128,e&63|128)}else if(e<1114112){if((t-=4)<0)break;s.push(e>>18|240,e>>12&63|128,e>>6&63|128,e&63|128)}else throw new Error("Invalid code point")}return s}function L4e(n){for(var t=[],e=0;e<n.length;++e)t.push(n.charCodeAt(e)&255);return t}function B4e(n,t){for(var e,r,o,s=[],i=0;i<n.length&&!((t-=2)<0);++i)e=n.charCodeAt(i),r=e>>8,o=e%256,s.push(o),s.push(r);return s}function Qoe(n){return Q$.toByteArray($4e(n))}function uA(n,t,e,r){for(var o=0;o<r&&!(o+e>=t.length||o>=n.length);++o)t[o+e]=n[o];return o}function nf(n,t){return n instanceof t||n!=null&&n.constructor!=null&&n.constructor.name!=null&&n.constructor.name===t.name}function r8(n){return n!==n}var z4e=function(){for(var n="0123456789abcdef",t=new Array(256),e=0;e<16;++e)for(var r=e*16,o=0;o<16;++o)t[r+o]=n[e]+n[o];return t}()});var tse=uo((o8,ese)=>{"use strict";var cA=Zoe(),rf=cA.Buffer;function Joe(n,t){for(var e in n)t[e]=n[e]}rf.from&&rf.alloc&&rf.allocUnsafe&&rf.allocUnsafeSlow?ese.exports=cA:(Joe(cA,o8),o8.Buffer=Ax);function Ax(n,t,e){return rf(n,t,e)}Ax.prototype=Object.create(rf.prototype);Joe(rf,Ax);Ax.from=function(n,t,e){if(typeof n=="number")throw new TypeError("Argument must not be a number");return rf(n,t,e)};Ax.alloc=function(n,t,e){if(typeof n!="number")throw new TypeError("Argument must be a number");var r=rf(n);return t!==void 0?typeof e=="string"?r.fill(t,e):r.fill(t):r.fill(0),r};Ax.allocUnsafe=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return rf(n)};Ax.allocUnsafeSlow=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return cA.SlowBuffer(n)}});var ose=uo(rse=>{"use strict";var i8=tse().Buffer,nse=i8.isEncoding||function(n){switch(n=""+n,n&&n.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function V4e(n){if(!n)return"utf8";for(var t;;)switch(n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:if(t)return;n=(""+n).toLowerCase(),t=!0}}function j4e(n){var t=V4e(n);if(typeof t!="string"&&(i8.isEncoding===nse||!nse(n)))throw new Error("Unknown encoding: "+n);return t||n}rse.StringDecoder=r_;function r_(n){this.encoding=j4e(n);var t;switch(this.encoding){case"utf16le":this.text=K4e,this.end=X4e,t=4;break;case"utf8":this.fillLast=G4e,t=4;break;case"base64":this.text=Y4e,this.end=Q4e,t=3;break;default:this.write=Z4e,this.end=J4e;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=i8.allocUnsafe(t)}r_.prototype.write=function(n){if(n.length===0)return"";var t,e;if(this.lastNeed){if(t=this.fillLast(n),t===void 0)return"";e=this.lastNeed,this.lastNeed=0}else e=0;return e<n.length?t?t+this.text(n,e):this.text(n,e):t||""};r_.prototype.end=H4e;r_.prototype.text=W4e;r_.prototype.fillLast=function(n){if(this.lastNeed<=n.length)return n.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);n.copy(this.lastChar,this.lastTotal-this.lastNeed,0,n.length),this.lastNeed-=n.length};function s8(n){return n<=127?0:n>>5===6?2:n>>4===14?3:n>>3===30?4:n>>6===2?-1:-2}function U4e(n,t,e){var r=t.length-1;if(r<e)return 0;var o=s8(t[r]);return o>=0?(o>0&&(n.lastNeed=o-1),o):--r<e||o===-2?0:(o=s8(t[r]),o>=0?(o>0&&(n.lastNeed=o-2),o):--r<e||o===-2?0:(o=s8(t[r]),o>=0?(o>0&&(o===2?o=0:n.lastNeed=o-3),o):0))}function q4e(n,t,e){if((t[0]&192)!==128)return n.lastNeed=0,"\uFFFD";if(n.lastNeed>1&&t.length>1){if((t[1]&192)!==128)return n.lastNeed=1,"\uFFFD";if(n.lastNeed>2&&t.length>2&&(t[2]&192)!==128)return n.lastNeed=2,"\uFFFD"}}function G4e(n){var t=this.lastTotal-this.lastNeed,e=q4e(this,n,t);if(e!==void 0)return e;if(this.lastNeed<=n.length)return n.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);n.copy(this.lastChar,t,0,n.length),this.lastNeed-=n.length}function W4e(n,t){var e=U4e(this,n,t);if(!this.lastNeed)return n.toString("utf8",t);this.lastTotal=e;var r=n.length-(e-this.lastNeed);return n.copy(this.lastChar,0,r),n.toString("utf8",t,r)}function H4e(n){var t=n&&n.length?this.write(n):"";return this.lastNeed?t+"\uFFFD":t}function K4e(n,t){if((n.length-t)%2===0){var e=n.toString("utf16le",t);if(e){var r=e.charCodeAt(e.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=n[n.length-2],this.lastChar[1]=n[n.length-1],e.slice(0,-1)}return e}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=n[n.length-1],n.toString("utf16le",t,n.length-1)}function X4e(n){var t=n&&n.length?this.write(n):"";if(this.lastNeed){var e=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,e)}return t}function Y4e(n,t){var e=(n.length-t)%3;return e===0?n.toString("base64",t):(this.lastNeed=3-e,this.lastTotal=3,e===1?this.lastChar[0]=n[n.length-1]:(this.lastChar[0]=n[n.length-2],this.lastChar[1]=n[n.length-1]),n.toString("base64",t,n.length-e))}function Q4e(n){var t=n&&n.length?this.write(n):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function Z4e(n){return n.toString(this.encoding)}function J4e(n){return n&&n.length?this.write(n):""}});var lA,a8,u8,sse=D(()=>{"use strict";ve();Nx();Foe();lA=class extends Rs{decodeUTF8(){return new a8(this)}},a8=class extends n_{constructor(t){super(),this.upstream=t,this.impl=new u8(t)}summary(){return this.impl.summary()}next(){return Te(this,null,function*(){return this.impl.next()})}},u8=class extends Ex{constructor(t){if(super(),this.upstream=t,mt().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{let{StringDecoder:e}=ose();this.decoder=new e("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}pump(){return Te(this,null,function*(){let t=yield this.upstream.next(),e;if(t.done)return!1;e=t.value;let r;return mt().get("IS_BROWSER")?r=this.decoder.decode(e,{stream:!0}):r=this.decoder.write(Buffer.from(e.buffer)),this.outputQueue.push(r),!0})}}});var g2,c8=D(()=>{"use strict";ve();sse();g2=class extends lA{constructor(t,e={}){super(),this.file=t,this.options=e,Y.assert(t instanceof Uint8Array||(mt().get("IS_BROWSER")?t instanceof File||t instanceof Blob:!1),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=e.offset||0,this.chunkSize=e.chunkSize||1024*1024}summary(){return`FileChunks ${this.file}`}next(){return Te(this,null,function*(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:yield new Promise((e,r)=>{let o=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)e(new Uint8Array(this.file.slice(this.offset,o)));else{let s=new FileReader;s.onload=a=>{let u=s.result;if(u instanceof ArrayBuffer&&(u=new Uint8Array(u)),!(u instanceof Uint8Array))return r(new TypeError("FileReader returned unknown type."));e(u)},s.onabort=a=>r(new Error("Aborted")),s.onerror=a=>r(new Error(a.type));let i=this.file.slice(this.offset,o);s.readAsArrayBuffer(i)}this.offset=o}),done:!1}})}}});function ise(e){return Te(this,arguments,function*(n,t={}){let r,o;typeof n=="string"?r=n:(r=n.url,o=eMe(n));let s=yield Y.fetch(r,o);if(s.ok){let i=new Uint8Array(yield s.arrayBuffer());return new g2(i,t)}else throw new Error(s.statusText)})}var eMe,ase=D(()=>{"use strict";ve();c8();eMe=n=>({method:n.method,headers:n.headers,body:n.body,mode:n.mode,credentials:n.credentials,cache:n.cache,redirect:n.redirect,referrer:n.referrer,integrity:n.integrity})});function pA(n){return typeof n=="string"&&n.substr(0,7)==="file://"}var l8=D(()=>{"use strict";});var use=uo(()=>{"use strict"});var y2,p8=D(()=>{"use strict";ve();W$();c8();l8();y2=class extends d2{constructor(t,e={}){super(),this.input=t,this.options=e}iterator(){return Te(this,null,function*(){if(pA(this.input)&&mt().get("IS_NODE")){let t=use();this.input=t.readFileSync(this.input.substr(7))}return new g2(this.input,this.options)})}}});var x2,h8=D(()=>{"use strict";W$();ase();l8();p8();x2=class extends d2{constructor(t,e={}){super(),this.url=t,this.fileOptions=e}iterator(){return Te(this,null,function*(){return pA(this.url)?new y2(this.url,this.fileOptions).iterator():ise(this.url,this.fileOptions)})}}});function cse(n,t={}){return new h2(new x2(n),t)}function lse(n){let t=JI(n);return Ku(()=>Te(null,null,function*(){return t}))}function pse(n){return Ku(()=>Te(null,null,function*(){let t=yield n();return JI(()=>t.next())}))}function hse(n,t){return Te(this,null,function*(){return sA.create(n,t)})}function dse(n){return Te(this,null,function*(){return oA.create(n)})}var fse=D(()=>{"use strict";e_();G$();Nx();Roe();Moe();h8();});var hA,mse=D(()=>{"use strict";hA="2.8.6"});var d8={};Br(d8,{CSVDataset:()=>h2,Dataset:()=>ny,FileDataSource:()=>y2,TextLineDataset:()=>p2,URLDataSource:()=>x2,array:()=>koe,csv:()=>cse,func:()=>lse,generator:()=>pse,microphone:()=>dse,version_data:()=>hA,webcam:()=>hse,zip:()=>Doe});var f8=D(()=>{"use strict";e_();G$();U$();fse();p8();h8();mse();});function zt(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&Y.assert(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}var Ln=D(()=>{"use strict";ve();});var tMe,dA,gse=D(()=>{"use strict";ve();Ln();tMe=oa.whereImpl,dA=class extends kh{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new s0(this,Vm())}write(t,e,r){this.firstUse&&(this.firstUse=!1,mt().get("IS_NODE")&&Re.warn(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));let o={};return this.data.set(o,{values:t,dtype:r,refCount:1}),o}makeTensorInfo(t,e,r){let o;if(e==="string"&&r!=null&&r.length>0&&Y.isString(r[0])){let s=r.map(i=>Y.encodeString(i));o=this.write(s,t,e)}else o=this.write(r,t,e);return{dataId:o,shape:t,dtype:e}}incRef(t){let e=this.data.get(t);e.refCount++}decRef(t){if(this.data.has(t)){let e=this.data.get(t);e.refCount--}}move(t,e,r,o){this.data.set(t,{values:e,dtype:o,refCount:1})}numDataIds(){return this.data.numDataIds()}read(t){return Te(this,null,function*(){return this.readSync(t)})}readSync(t){let{dtype:e,complexTensorInfos:r}=this.data.get(t);if(e==="complex64"){let o=this.readSync(r.real.dataId),s=this.readSync(r.imag.dataId);return Re.mergeRealAndImagArrays(o,s)}return this.data.get(t).values}bufferSync(t){let e=this.readSync(t.dataId),r=e;if(t.dtype==="string")try{r=e.map(o=>Y.decodeString(o))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Rn(t.shape,t.dtype,r)}makeOutput(t,e,r){let o=this.write(t,e,r);return Vm().makeTensorFromDataId(o,e,r,this)}disposeData(t){if(this.data.has(t)){let{complexTensorInfos:e}=this.data.get(t);e!=null&&(this.disposeData(e.real.dataId),this.disposeData(e.imag.dataId)),this.data.delete(t)}}disposeIntermediateTensorInfo(t){let e=t.dataId;if(this.data.has(e)){let r=this.data.get(e);r.refCount--,r.refCount<1&&this.disposeData(e)}}time(t){return Te(this,null,function*(){let e=Y.now();return t(),{kernelMs:Y.now()-e}})}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){zt([t],"where");let e=this.readSync(t.dataId);return tMe(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}});function m8(n){let t=new Float32Array(n.length);for(let e=0;e<n.length;++e)t[e]=Math.abs(n[e]);return t}var nMe,yse,g8=D(()=>{"use strict";ve();Ln();nMe=n=>{let{x:t}=n.inputs,e=n.backend;zt(t,"abs");let r=new Float32Array(Y.sizeFromShape(t.shape)),o=e.data.get(t.dataId).values;return r=m8(o),e.makeOutput(r,t.shape,"float32")},yse={kernelName:Uf,backendName:"cpu",kernelFunc:nMe}});function Lr(n){return(t,e,r,o,s)=>{let i=Re.assertAndGetBroadcastShape(t,e),a=i.length,u=Y.computeStrides(i),c=Y.sizeFromShape(i),h=Y.getTypedArrayFromDType(s,c),f=t.length,g=e.length,d=Y.computeStrides(t),p=Y.computeStrides(e),m=Re.getBroadcastDims(t,i),y=Re.getBroadcastDims(e,i);if(m.length+y.length===0)for(let v=0;v<h.length;++v)h[v]=n(r[v%r.length],o[v%o.length]);else for(let v=0;v<h.length;++v){let N=Y.indexToLoc(v,a,u),T=N.slice(-f);m.forEach(R=>T[R]=0);let O=Y.locToIndex(T,f,d),S=N.slice(-g);y.forEach(R=>S[R]=0);let F=Y.locToIndex(S,g,p);h[v]=n(r[O],o[F])}return[h,i]}}var yi=D(()=>{"use strict";ve();});function Ni(n){let{inputs:t,backend:e}=n,{real:r,imag:o}=t,s=e.data.get(r.dataId).values,i=e.data.get(o.dataId).values,a=e.makeTensorInfo(r.shape,"complex64"),u=e.data.get(a.dataId);return u.complexTensorInfos={real:e.makeTensorInfo(r.shape,"float32",s),imag:e.makeTensorInfo(o.shape,"float32",i)},a}var xse,ag=D(()=>{"use strict";ve();xse={kernelName:a1,backendName:"cpu",kernelFunc:Ni}});function b2(n,t,e="float32"){if(e==="complex64"){let o=b2(n,t,"float32"),s=b2(n,t,"float32");return Ni({inputs:{real:o,imag:s},backend:n})}let r=Y.makeZerosTypedArray(Y.sizeFromShape(t),e);return n.makeTensorInfo(t,e,r)}var y8=D(()=>{"use strict";ve();ag();});function Na(n){let{inputs:t,backend:e}=n,{x:r}=t;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var bse,of=D(()=>{"use strict";ve();bse={kernelName:um,backendName:"cpu",kernelFunc:Na}});function Hl(n){let{inputs:t,backend:e}=n,{input:r}=t,o=e.data.get(r.dataId).complexTensorInfos.real,s=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,s)}var vse,Ox=D(()=>{"use strict";ve();vse={kernelName:F1,backendName:"cpu",kernelFunc:Hl}});function Kl(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dtype:s}=r;if(s==="complex64"){if(o.dtype==="complex64")return Na({inputs:{x:o},backend:e});let i=b2(e,o.shape,o.dtype),a=Kl({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),u=Ni({inputs:{real:a,imag:i},backend:e});return e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(a),u}if(o.dtype==="complex64"){let i=Hl({inputs:{input:o},backend:e}),a=Kl({inputs:{x:i},backend:e,attrs:{dtype:s}});return e.disposeIntermediateTensorInfo(i),a}if(!Y.hasEncodingLoss(o.dtype,s)){let i=Na({inputs:{x:o},backend:e});return{dataId:i.dataId,shape:i.shape,dtype:s}}if(s==="int32"){let i=e.data.get(o.dataId).values,a=Int32Array.from(i);return e.makeTensorInfo(o.shape,"int32",a)}if(s==="bool"){let i=e.data.get(o.dataId).values,a=Y.toTypedArray([0],o.dtype),[u,c]=Lr((h,f)=>h!==f?1:0)(o.shape,[],i,a,"bool");return e.makeTensorInfo(c,"bool",u)}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${s}`)}var wse,v2=D(()=>{"use strict";ve();yi();y8();ag();of();Ox();wse={kernelName:Dp,backendName:"cpu",kernelFunc:Kl}});function Xr(n,t,e,r){return e==null?({inputs:o,backend:s})=>{let{a:i,b:a}=o,u=s;zt([i,a],n);let c=u.data.get(i.dataId).values,h=u.data.get(a.dataId).values,f=r||i.dtype,[g,d]=t(i.shape,a.shape,c,h,f);return u.makeTensorInfo(d,f,g)}:({inputs:o,backend:s})=>{let{a:i,b:a}=o,u=s;if(i.dtype==="complex64"||a.dtype==="complex64"){let c=Kl({inputs:{x:i},backend:u,attrs:{dtype:"complex64"}}),h=u.data.get(c.dataId),f=h.complexTensorInfos.real,g=h.complexTensorInfos.imag,d=u.data.get(f.dataId).values,p=u.data.get(g.dataId).values,m=Kl({inputs:{x:a},backend:u,attrs:{dtype:"complex64"}}),y=u.data.get(m.dataId),v=y.complexTensorInfos.real,N=y.complexTensorInfos.imag,T=u.data.get(v.dataId).values,O=u.data.get(N.dataId).values,[S,F,R]=e(i.shape,a.shape,d,p,T,O),L=u.makeTensorInfo(R,"float32",S),q=u.makeTensorInfo(R,"float32",F),U=Ni({inputs:{real:L,imag:q},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(L),u.disposeIntermediateTensorInfo(q),U}else{let c=u.data.get(i.dataId).values,h=u.data.get(a.dataId).values,f=r||i.dtype,[g,d]=t(i.shape,a.shape,c,h,f);return u.makeTensorInfo(d,f,g)}}}function w2(n){return(t,e,r,o,s,i)=>{let a=Re.assertAndGetBroadcastShape(t,e),u=Y.sizeFromShape(a),c=a.length,h=Y.computeStrides(a),f=Y.getTypedArrayFromDType("float32",u),g=Y.getTypedArrayFromDType("float32",u),d=Re.getBroadcastDims(t,a),p=Re.getBroadcastDims(e,a),m=Re.mergeRealAndImagArrays(r,o),y=Re.mergeRealAndImagArrays(s,i),v=t.length,N=Y.computeStrides(t),T=e.length,O=Y.computeStrides(e);if(d.length+p.length===0)for(let S=0;S<f.length;S++){let F=S%m.length,R=S%y.length,L=n(m[F*2],m[F*2+1],y[R*2],y[R*2+1]);f[S]=L.real,g[S]=L.imag}else for(let S=0;S<f.length;S++){let F=Y.indexToLoc(S,c,h),R=F.slice(-v);d.forEach(ee=>R[ee]=0);let L=Y.locToIndex(R,v,N),q=F.slice(-T);p.forEach(ee=>q[ee]=0);let U=Y.locToIndex(q,T,O),Z=n(m[L*2],m[L*2+1],y[U*2],y[U*2+1]);f[S]=Z.real,g[S]=Z.imag}return[f,g,a]}}var zi=D(()=>{"use strict";ve();Ln();v2();ag();});var x8,rMe,ug,Sse,Rx=D(()=>{"use strict";ve();yi();zi();x8=Lr((n,t)=>n+t),rMe=w2((n,t,e,r)=>({real:n+e,imag:t+r})),ug=Xr(Nl,x8,rMe),Sse={kernelName:Nl,backendName:"cpu",kernelFunc:ug}});function S2(n,t,e,r,o){let s=Y.sizeFromShape(r),i=Y.makeZerosTypedArray(o,e);for(let a=0;a<n.length;a++){let u=n[a];if(u<0)throw new Error("Input x must be non-negative!");u>=o||(s>0?i[u]+=t[a]:i[u]+=1)}return i}function fA(n,t,e,r=!1){let o=n.shape[0],s=n.shape[1],i=Rn([o,e],t.dtype);for(let a=0;a<o;a++)for(let u=0;u<s;u++){let c=n.get(a,u);if(c<0)throw new Error("Input x must be non-negative!");c>=e||(r?i.set(1,a,c):t.size>0?i.set(i.get(a,c)+t.get(a,u),a,c):i.set(i.get(a,c)+1,a,c))}return i}var mA=D(()=>{"use strict";ve();});function Xl(n){return(t,e,r)=>{let o=Y.getTypedArrayFromDType(e,t.length);for(let s=0;s<t.length;++s)o[s]=n(t[s],r);return o}}var Mx=D(()=>{"use strict";ve();});function Hn(n,t,e){return({inputs:r,attrs:o,backend:s})=>{let{x:i}=r;if(zt(i,n),i.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=s,u=a.data.get(i.dataId).values,c=Y.sizeFromShape(i.shape),h=e||i.dtype,f=Y.getArrayFromDType(h,c);for(let g=0;g<c;++g)f[g]=t(u[g],o);return a.makeTensorInfo(i.shape,h,f)}}function Yl(n,t,e){return({inputs:r,attrs:o,backend:s})=>{let{x:i}=r;if(zt(i,n),i.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=s,u=a.data.get(i.dataId).values,c=e||i.dtype,h=t(u,c,o);return a.makeTensorInfo(i.shape,c,h)}}var Zr=D(()=>{"use strict";ve();Ln();});var b8,oMe,Cse,v8=D(()=>{"use strict";ve();Mx();Zr();b8=Xl(n=>Math.ceil(n)),oMe=Yl(Bh,b8),Cse={kernelName:Bh,backendName:"cpu",kernelFunc:oMe}});function gA(n,t,e,r){let o=Y.getArrayFromDType(e,Y.sizeFromShape(t));if(r&&e!=="string"){let s=0;n.forEach(i=>{let a=Y.sizeFromShape(i.shape);o.set(i.vals,s),s+=a})}else{let s=0;n.forEach(i=>{let a=e==="string"?Re.fromUint8ToStringArray(i.vals):i.vals,u=0;for(let c=0;c<i.shape[0];++c){let h=c*t[1]+s;for(let f=0;f<i.shape[1];++f)o[h+f]=a[u++]}s+=i.shape[1]})}return o}var w8=D(()=>{"use strict";ve();});var S8,C8,Ise,yA=D(()=>{"use strict";ve();Mx();Zr();S8=Xl(n=>Math.exp(n)),C8=Yl(Wh,S8),Ise={kernelName:Wh,backendName:"cpu",kernelFunc:C8}});var I8,sMe,_se,_8=D(()=>{"use strict";ve();Mx();Zr();I8=Xl(n=>Math.expm1(n)),sMe=Yl(Hh,I8),_se={kernelName:Hh,backendName:"cpu",kernelFunc:sMe}});var T8,iMe,Tse,E8=D(()=>{"use strict";ve();Mx();Zr();T8=Xl(n=>Math.floor(n)),iMe=Yl(Kh,T8),Tse={kernelName:Kh,backendName:"cpu",kernelFunc:iMe}});function xA(n,t,e){let r=Rn(e,n.dtype);for(let o=0;o<r.size;++o){let i=r.indexToLoc(o).slice(),a=i[0],u=i[2],c=t.locToIndex([a,u]);i[2]=t.values[c];let h=n.locToIndex(i);r.values[o]=n.values[h]}return r}var N8=D(()=>{"use strict";ve();});var k8,aMe,Ese,D8=D(()=>{"use strict";ve();yi();zi();k8=Lr((n,t)=>n>t?1:0),aMe=Xr(a0,k8,null,"bool"),Ese={kernelName:a0,backendName:"cpu",kernelFunc:aMe}});var A8,uMe,Nse,O8=D(()=>{"use strict";ve();yi();zi();A8=Lr((n,t)=>n<t?1:0),uMe=Xr(u0,A8,null,"bool"),Nse={kernelName:u0,backendName:"cpu",kernelFunc:uMe}});function bA(n,t,e){let r=(t-n)/(e-1),o=Y.makeZerosTypedArray(e,"float32");o[0]=n;for(let s=1;s<o.length;s++)o[s]=o[s-1]+r;return o}var R8=D(()=>{"use strict";ve();});var M8,cMe,kse,F8=D(()=>{"use strict";ve();Mx();Zr();M8=Xl(n=>Math.log(n)),cMe=Yl(ed,M8),kse={kernelName:ed,backendName:"cpu",kernelFunc:cMe}});function vA(n,t,e,r){let o=Y.getTypedArrayFromDType(r,Y.sizeFromShape(e));for(let s=0;s<o.length;++s){let i=s*t,a=n[i];for(let u=0;u<t;++u){let c=n[i+u];c>a&&(a=c)}o[s]=a}return o}var P8=D(()=>{"use strict";ve();});var $8,lMe,Dse,L8=D(()=>{"use strict";ve();yi();zi();$8=Lr((n,t)=>Math.max(n,t)),lMe=Xr(nd,$8),Dse={kernelName:nd,backendName:"cpu",kernelFunc:lMe}});var B8,pMe,Ase,z8=D(()=>{"use strict";ve();yi();zi();B8=Lr((n,t)=>Math.min(n,t)),pMe=Xr(rd,B8),Ase={kernelName:rd,backendName:"cpu",kernelFunc:pMe}});var o_,hMe,s_,Ose,C2=D(()=>{"use strict";ve();yi();zi();o_=Lr((n,t)=>n*t),hMe=w2((n,t,e,r)=>({real:n*e-t*r,imag:n*r+t*e})),s_=Xr(sd,o_,hMe),Ose={kernelName:sd,backendName:"cpu",kernelFunc:s_}});function V8(n,t,e){let r=Y.createScalarValue(-1,e);return o_([],t,r,n,e)}function dMe(n){let{inputs:t,backend:e}=n,{x:r}=t;zt(r,"neg");let o=e.data.get(r.dataId).values,[s,i]=V8(o,r.shape,r.dtype);return e.makeTensorInfo(i,r.dtype,s)}var Rse,j8=D(()=>{"use strict";ve();Ln();C2();Rse={kernelName:ym,backendName:"cpu",kernelFunc:dMe}});var U8,fMe,Mse,q8=D(()=>{"use strict";ve();yi();zi();U8=Lr((n,t)=>n!==t?1:0),fMe=Xr(d0,U8,null,"bool"),Mse={kernelName:d0,backendName:"cpu",kernelFunc:fMe}});function I2(n,t,e,r,o){let s=t.length,i=Y.sizeFromShape(t),a=Y.computeStrides(t),u=Y.computeStrides(o),c=Y.getTypedArrayFromDType(e,Y.sizeFromShape(o));for(let h=0;h<i;++h){let f=Y.indexToLoc(h,s,a),g=new Array(f.length);for(let p=0;p<g.length;p++)g[p]=f[r[p]];let d=Y.locToIndex(g,s,u);c[d]=n[h]}return c}var wA=D(()=>{"use strict";ve();});function xi(n){let{inputs:t,attrs:e,backend:r}=n,{x:o}=t,{perm:s}=e;zt(o,"transpose");let i=o.shape.length,a=new Array(i);for(let f=0;f<a.length;f++)a[f]=o.shape[s[f]];let u=r.data.get(o.dataId).values,c=I2(u,o.shape,o.dtype,s,a);return{dataId:r.write(c,a,o.dtype),shape:a,dtype:o.dtype}}var Fse,Ql=D(()=>{"use strict";ve();Ln();wA();Fse={kernelName:Rm,backendName:"cpu",kernelFunc:xi}});function G8(n,t,e,r){let[o,s]=Re.computeOutAndReduceShapes(n,r),i=ci(t,"int32"),a=Y.makeZerosTypedArray(Y.sizeFromShape(o),i),u=Y.sizeFromShape(s);for(let c=0;c<a.length;++c){let h=c*u,f=1;for(let g=0;g<u;++g)f*=e[h+g];a[c]=f}return{outVals:a,outShape:o,outDtype:i}}function mMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,keepDims:i}=r;zt(o,"prod");let a=o.shape.length,u=Y.parseAxisParam(s,o.shape),c=Re.getAxesPermutation(u,a),h=u,f=o,g=[];c!=null&&(f=xi({inputs:{x:o},backend:e,attrs:{perm:c}}),g.push(f),h=Re.getInnerMostAxes(h.length,a));let d=e.data.get(f.dataId).values,{outVals:p,outShape:m,outDtype:y}=G8(f.shape,f.dtype,d,h),v=m;return i&&(v=Re.expandShapeToKeepDim(m,u)),g.forEach(N=>e.disposeIntermediateTensorInfo(N)),e.makeTensorInfo(v,y,p)}var Pse,W8=D(()=>{"use strict";ve();Ln();Ql();Pse={kernelName:R1,backendName:"cpu",kernelFunc:mMe}});function SA(n,t,e,r){let o=n===t,s=n<t&&e<0,i=t<n&&e>1;if(o||s||i)return Y.makeZerosTypedArray(0,r);let a=Math.abs(Math.ceil((t-n)/e)),u=Y.makeZerosTypedArray(a,r);t<n&&e===1&&(e=-1),u[0]=n;for(let c=1;c<u.length;c++)u[c]=u[c-1]+e;return u}var H8=D(()=>{"use strict";ve();});var K8,gMe,$se,X8=D(()=>{"use strict";ve();Mx();Zr();K8=Xl(n=>1/Math.sqrt(n)),gMe=Yl(pd,K8),$se={kernelName:pd,backendName:"cpu",kernelFunc:gMe}});function Y8(n,t,e,r,o){let s=Ji.isSliceContinous(r,t,e),i=Y.sizeFromShape(e),a=Y.computeStrides(r);if(s){let f=Ji.computeFlatOffset(t,a);return o==="string"?n.slice(f,f+i):n.subarray(f,f+i)}let u=o==="string"?Re.fromUint8ToStringArray(n):n,c=Rn(r,o,u),h=Rn(e,o);for(let f=0;f<h.size;++f){let g=h.indexToLoc(f),d=g.map((p,m)=>p+t[m]);h.set(c.get(...d),...g)}return o==="string"?Re.fromStringArrayToUint8(h.values):h.values}function Zl(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:s,size:i}=r;zt(o,"slice");let[a,u]=Ji.parseSliceParams(o,s,i);Ji.assertParamsValid(o,a,u);let c=e.data.get(o.dataId).values,h=Y8(c,a,u,o.shape,o.dtype);return e.makeTensorInfo(u,o.dtype,h)}var Lse,ry=D(()=>{"use strict";ve();Ln();Lse={kernelName:Nm,backendName:"cpu",kernelFunc:Zl}});var Q8,yMe,Bse,Z8=D(()=>{"use strict";ve();yi();zi();Q8=Lr((n,t)=>{let e=n-t;return e*e}),yMe=Xr(bd,Q8),Bse={kernelName:bd,backendName:"cpu",kernelFunc:yMe}});function CA(n,t,e,r){let o=Rn(n,t.dtype);for(let s=0;s<o.size;s++){let i=o.indexToLoc(s),a=new Array(i.length);for(let u=0;u<a.length;u++)a[u]=i[u]*e[u]+r[u];o.set(t.get(...a),...i)}return o}var J8=D(()=>{"use strict";ve();});var eL,xMe,i_,zse,a_=D(()=>{"use strict";ve();yi();zi();eL=Lr((n,t)=>n-t),xMe=w2((n,t,e,r)=>({real:n-e,imag:t-r})),i_=Xr(vd,eL,xMe),zse={kernelName:vd,backendName:"cpu",kernelFunc:i_}});function IA(n,t){let e=new Array(n.rank);for(let o=0;o<e.length;o++)e[o]=n.shape[o]*t[o];let r=Rn(e,n.dtype);for(let o=0;o<r.values.length;++o){let s=r.indexToLoc(o),i=new Array(n.rank);for(let u=0;u<i.length;u++)i[u]=s[u]%n.shape[u];let a=n.locToIndex(i);r.values[o]=n.values[a]}return r}var tL=D(()=>{"use strict";ve();});function _A(n,t,e,r,o){let s=t[t.length-1],[i,a]=[n.length/s,s],u=Y.getTypedArrayFromDType(e,i*r),c=Y.getTypedArrayFromDType("int32",i*r);for(let f=0;f<i;f++){let g=f*a,d=n.subarray(g,g+a),p=[];for(let N=0;N<d.length;N++)p.push({value:d[N],index:N});p.sort((N,T)=>T.value-N.value);let m=f*r,y=u.subarray(m,m+r),v=c.subarray(m,m+r);for(let N=0;N<r;N++)y[N]=p[N].value,v[N]=p[N].index}let h=t.slice();return h[h.length-1]=r,[Rn(h,e,u),Rn(h,"int32",c)]}var nL=D(()=>{"use strict";ve();});function TA(n,t,e,r){let o=Y.parseAxisParam(t,e)[0],s=[1,e[0],1];for(let p=0;p<o;p++)s[0]*=e[p];s[1]=e[o];for(let p=o+1;p<e.length;p++)s[2]*=e[p];let i={},a=new Int32Array(e[o]),u=new no(s,r,n),c=[],h=s[0]===1&&s[2]===1;for(let p=0;p<e[o];p++){let m;if(h)m=n[p].toString();else{let y=[];for(let v=0;v<s[0];v++)for(let N=0;N<s[2];N++)y.push(u.get(v,p,N));m=y.join(",")}if(i[m]!==void 0)a[p]=i[m];else{let y=Object.keys(i).length;i[m]=y,a[p]=y,c.push(p)}}let f=s.slice();f[1]=Object.keys(i).length;let g=new no(f,r);c.forEach((p,m)=>{for(let y=0;y<s[0];y++)for(let v=0;v<s[2];v++)g.set(u.get(y,p,v),y,m,v)});let d=e.slice();return d[o]=f[1],{outputValues:g.values,outputShape:d,indices:a}}var rL=D(()=>{"use strict";ve();});var oL={};Br(oL,{addImpl:()=>x8,bincountImpl:()=>S2,bincountReduceImpl:()=>fA,ceilImpl:()=>b8,concatImpl:()=>gA,expImpl:()=>S8,expm1Impl:()=>I8,floorImpl:()=>T8,gatherV2Impl:()=>xA,greaterImpl:()=>k8,lessImpl:()=>A8,linSpaceImpl:()=>bA,logImpl:()=>M8,maxImpl:()=>vA,maximumImpl:()=>$8,minimumImpl:()=>B8,multiplyImpl:()=>o_,negImpl:()=>V8,notEqualImpl:()=>U8,prodImpl:()=>G8,rangeImpl:()=>SA,rsqrtImpl:()=>K8,simpleAbsImpl:()=>m8,sliceImpl:()=>Y8,squaredDifferenceImpl:()=>Q8,stridedSliceImpl:()=>CA,subImpl:()=>eL,tileImpl:()=>IA,topKImpl:()=>_A,transposeImpl:()=>I2,uniqueImpl:()=>TA});var Vse=D(()=>{"use strict";g8();Rx();mA();v8();w8();yA();_8();E8();N8();D8();O8();R8();F8();P8();L8();z8();C2();j8();q8();W8();H8();X8();ry();Z8();J8();a_();tL();nL();wA();rL();});var sL,jse=D(()=>{"use strict";sL="2.8.6"});var Use=D(()=>{"use strict";ve();gse();jse();UC("cpu",()=>new dA,1)});var iL,qse,aL=D(()=>{"use strict";ve();Zr();iL=Hn(qh,n=>n>=0?n:Math.exp(n)-1),qse={kernelName:qh,backendName:"cpu",kernelFunc:iL}});function uL(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{alpha:s}=r;zt([o],"leakyRelu");let i=Y.sizeFromShape(o.shape),a=e.data.get(o.dataId).values,u=Y.getTypedArrayFromDType("float32",i);for(let c=0;c<a.length;c++)u[c]=a[c]<0?s*a[c]:a[c];return e.makeTensorInfo(o.shape,"float32",u)}var Gse,cL=D(()=>{"use strict";ve();Ln();Gse={kernelName:cm,backendName:"cpu",kernelFunc:uL}});function lL(n){let{inputs:t,backend:e}=n,{x:r,alpha:o}=t;zt([r,o],"prelu");let s=e.data.get(r.dataId).values,i=e.data.get(o.dataId).values,[a,u]=bMe(r.shape,o.shape,s,i,r.dtype);return e.makeTensorInfo(u,r.dtype,a)}var bMe,Wse,pL=D(()=>{"use strict";ve();Ln();yi();bMe=Lr((n,t)=>n<0?t*n:n);Wse={kernelName:Sm,backendName:"cpu",kernelFunc:lL}});var hL,Hse,dL=D(()=>{"use strict";ve();Zr();hL=Hn(ud,n=>Math.max(0,n)),Hse={kernelName:ud,backendName:"cpu",kernelFunc:hL}});var fL,Kse,mL=D(()=>{"use strict";ve();Zr();fL=Hn(cd,n=>Math.min(Math.max(0,n),6)),Kse={kernelName:cd,backendName:"cpu",kernelFunc:fL}});function _2(n,t,e,r,o){if(e==="linear")return Na({inputs:{x:t},backend:n});if(e==="relu")return hL({inputs:{x:t},backend:n});if(e==="elu")return iL({inputs:{x:t},backend:n});if(e==="relu6")return fL({inputs:{x:t},backend:n});if(e==="prelu")return lL({inputs:{x:t,alpha:r},backend:n});if(e==="leakyrelu")return uL({inputs:{x:t},backend:n,attrs:{alpha:o}});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}var EA=D(()=>{"use strict";aL();of();cL();pL();dL();mL();});function Ur(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{shape:s}=r,i=Y.sizeFromShape(o.shape),a=Y.inferFromImplicitShape(s,i),u=Y.sizeFromShape(a);Y.assert(i===u,()=>`The new shape (${a}) has ${u} elements and the old shape (${o.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),e.incRef(o.dataId);let c=e.data.get(o.dataId);if(c.complexTensorInfos!=null){let h=c.complexTensorInfos.real,f=c.complexTensorInfos.imag;h.shape=a,f.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}var Xse,Qa=D(()=>{"use strict";ve();Xse={kernelName:Cm,backendName:"cpu",kernelFunc:Ur}});function gL(n){let{inputs:t,backend:e,attrs:r}=n,{a:o,b:s}=t,{transposeA:i,transposeB:a}=r;zt([o,s],"matMul");let u=o.shape.length,c=s.shape.length,h=i?o.shape[u-2]:o.shape[u-1],f=a?s.shape[c-1]:s.shape[c-2],g=i?o.shape[u-1]:o.shape[u-2],d=a?s.shape[c-2]:s.shape[c-1],p=o.shape.slice(0,-2),m=s.shape.slice(0,-2),y=Y.sizeFromShape(p),v=Y.sizeFromShape(m),N=y===v||y===1||v===1;Y.assert(u>=2&&c>=2&&N,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${p}) and (${m}).`);let O=(y>v?o.shape.slice(0,-2):s.shape.slice(0,-2)).concat([g,d]);Y.assert(h===f,()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${o.shape} and ${s.shape} and transposeA=${i} and transposeB=${a} must match.`);let S=i?[y,h,g]:[y,g,h],F=a?[v,d,f]:[v,f,d],R=Ur({inputs:{x:o},backend:e,attrs:{shape:S}}),L=Ur({inputs:{x:s},backend:e,attrs:{shape:F}}),q=i?R.shape[1]:R.shape[2],U=i?R.shape[2]:R.shape[1],Z=a?L.shape[1]:L.shape[2],ee=Math.max(y,v),Q=e.data.get(R.dataId).values,oe=e.data.get(L.dataId).values,se=Y.computeStrides(R.shape),pe=Y.computeStrides(L.shape),[ae,fe,he]=i?[se[0],1,se[1]]:[se[0],se[1],1],[Ee,Le,Ve]=a?[1,pe[1],pe[0]]:[pe[1],1,pe[0]],qe=U*Z,je=Rn([ee,U,Z],R.dtype),Ce=je.values,tt=e.blockSize;for(let ye=0;ye<ee;ye++)for(let z=0;z<U;z+=tt)for(let M=0;M<Z;M+=tt)for(let W=0;W<q;W+=tt){let ce=Math.min(z+tt,U),J=Math.min(M+tt,Z),Ie=Math.min(W+tt,q);for(let Fe=z;Fe<ce;Fe++)for(let lt=M;lt<J;lt++){let Dt=0;for(let Ht=W;Ht<Ie;Ht++){let an=Math.min(ye,y-1)*ae,cn=Math.min(ye,v-1)*Ve,nn=Q[an+Fe*fe+Ht*he],Yn=oe[Ht*Ee+lt*Le+cn];Dt+=nn*Yn}Ce[ye*qe+(Fe*Z+lt)]+=Dt}}return e.disposeIntermediateTensorInfo(R),e.disposeIntermediateTensorInfo(L),e.makeTensorInfo(O,je.dtype,je.values)}var Yse,yL=D(()=>{"use strict";ve();Ln();Qa();Yse={kernelName:Xf,backendName:"cpu",kernelFunc:gL}});function vMe(n){let{inputs:t,backend:e,attrs:r}=n,{a:o,b:s,bias:i,preluActivationWeights:a}=t,{transposeA:u,transposeB:c,activation:h,leakyreluAlpha:f}=r,g,d,p,m=[];g=gL({inputs:{a:o,b:s},attrs:{transposeA:u,transposeB:c},backend:e}),i&&(d=ug({inputs:{a:g,b:i},backend:e}),m.push(g),g=d),h&&(p=_2(e,g,h,a,f),m.push(g),g=p);for(let v of m)e.disposeIntermediateTensorInfo(v);return g}var Qse,Zse=D(()=>{"use strict";ve();EA();Rx();yL();Qse={kernelName:f0,backendName:"cpu",kernelFunc:vMe}});var wMe,Jse,eie=D(()=>{"use strict";ve();Zr();wMe=Hn(Oh,n=>Math.acos(n)),Jse={kernelName:Oh,backendName:"cpu",kernelFunc:wMe}});var SMe,tie,nie=D(()=>{"use strict";ve();Zr();SMe=Hn(Rh,n=>Math.acosh(n)),tie={kernelName:Rh,backendName:"cpu",kernelFunc:SMe}});function CMe(n){let{inputs:t,backend:e}=n,r=t;zt(t,"addN");let o=r.map(a=>e.data.get(a.dataId).values),s=Rn(r[0].shape,r[0].dtype),i=s.values;for(let a=0;a<r.length;a++){let u=o[a];for(let c=0;c<i.length;c++)i[c]+=u[c]}return e.makeTensorInfo(s.shape,s.dtype,s.values)}var rie,oie=D(()=>{"use strict";ve();Ln();rie={kernelName:qf,backendName:"cpu",kernelFunc:CMe}});function IMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,keepDims:i}=r;zt(o,"all");let a=Y.parseAxisParam(s,o.shape),u=a,c=Re.getAxesPermutation(u,o.shape.length),h=o;c!=null&&(h=xi({inputs:{x:o},backend:e,attrs:{perm:c}}),u=Re.getInnerMostAxes(u.length,o.shape.length)),Re.assertAxesAreInnerMostDims("all",u,h.shape.length);let[f,g]=Re.computeOutAndReduceShapes(h.shape,u),d=Y.sizeFromShape(g),p=Y.makeZerosTypedArray(Y.sizeFromShape(f),h.dtype),m=e.data.get(h.dataId).values;for(let v=0;v<p.length;++v){let N=v*d,T=m[N];for(let O=0;O<d;++O){let S=m[N+O];T=T&&S}p[v]=T}c!=null&&e.disposeIntermediateTensorInfo(h);let y=e.makeTensorInfo(f,h.dtype,p);if(i){let v=Re.expandShapeToKeepDim(f,a),N=Ur({inputs:{x:y},backend:e,attrs:{shape:v}});return e.disposeIntermediateTensorInfo(y),N}return y}var sie,iie=D(()=>{"use strict";ve();Ln();Qa();Ql();sie={kernelName:n1,backendName:"cpu",kernelFunc:IMe}});function _Me(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,keepDims:i}=r;zt(o,"any");let a=Y.parseAxisParam(s,o.shape),u=a,c=Re.getAxesPermutation(u,o.shape.length),h=o;c!=null&&(h=xi({inputs:{x:o},backend:e,attrs:{perm:c}}),u=Re.getInnerMostAxes(u.length,o.shape.length)),Re.assertAxesAreInnerMostDims("any",u,h.shape.length);let[f,g]=Re.computeOutAndReduceShapes(h.shape,u),d=Y.sizeFromShape(g),p=Y.makeZerosTypedArray(Y.sizeFromShape(f),h.dtype),m=e.data.get(h.dataId).values;for(let v=0;v<p.length;++v){let N=v*d,T=m[N];for(let O=0;O<d;++O){let S=m[N+O];T=T||S}p[v]=T}c!=null&&e.disposeIntermediateTensorInfo(h);let y=e.makeTensorInfo(f,h.dtype,p);if(i){let v=Re.expandShapeToKeepDim(f,a),N=Ur({inputs:{x:y},backend:e,attrs:{shape:v}});return e.disposeIntermediateTensorInfo(y),N}return y}var aie,uie=D(()=>{"use strict";ve();Ln();Qa();Ql();aie={kernelName:r1,backendName:"cpu",kernelFunc:_Me}});function TMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s}=r;zt(o,"argMax");let i=Y.parseAxisParam(s,o.shape),a=Re.getAxesPermutation(i,o.shape.length),u=o,c=[];a!=null&&(u=xi({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(u),i=Re.getInnerMostAxes(i.length,u.shape.length)),i=[i[0]],Re.assertAxesAreInnerMostDims("argMax",i,u.shape.length);let[h,f]=Re.computeOutAndReduceShapes(u.shape,i),g=Y.sizeFromShape(h),d=Y.makeZerosTypedArray(g,"int32"),p=Y.sizeFromShape(f),m=e.data.get(u.dataId).values;for(let y=0;y<d.length;++y){let v=y*p,N=m[v],T=0;for(let O=0;O<p;++O){let S=m[v+O];S>N&&(N=S,T=O)}d[y]=T}return c.forEach(y=>e.disposeIntermediateTensorInfo(y)),e.makeTensorInfo(h,"int32",d)}var cie,lie=D(()=>{"use strict";ve();Ln();Ql();cie={kernelName:Gf,backendName:"cpu",kernelFunc:TMe}});function EMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s}=r;zt(o,"argMin");let i=Y.parseAxisParam(s,o.shape),a=Re.getAxesPermutation(i,o.shape.length),u=o,c=[];a!=null&&(u=xi({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(u),i=Re.getInnerMostAxes(i.length,u.shape.length)),i=[i[0]],Re.assertAxesAreInnerMostDims("argMin",i,u.shape.length);let[h,f]=Re.computeOutAndReduceShapes(u.shape,i),g=Y.sizeFromShape(h),d=Y.makeZerosTypedArray(g,"int32"),p=Y.sizeFromShape(f),m=e.data.get(u.dataId).values;for(let y=0;y<d.length;++y){let v=y*p,N=m[v],T=0;for(let O=0;O<p;++O){let S=m[v+O];S<N&&(N=S,T=O)}d[y]=T}return c.forEach(y=>e.disposeIntermediateTensorInfo(y)),e.makeTensorInfo(h,"int32",d)}var pie,hie=D(()=>{"use strict";ve();Ln();Ql();pie={kernelName:Wf,backendName:"cpu",kernelFunc:EMe}});var NMe,die,fie=D(()=>{"use strict";ve();Zr();NMe=Hn(Mh,n=>Math.asin(n)),die={kernelName:Mh,backendName:"cpu",kernelFunc:NMe}});var kMe,mie,gie=D(()=>{"use strict";ve();Zr();kMe=Hn(Fh,n=>Math.asinh(n)),mie={kernelName:Fh,backendName:"cpu",kernelFunc:kMe}});var DMe,yie,xie=D(()=>{"use strict";ve();Zr();DMe=Hn(Ph,n=>Math.atan(n)),yie={kernelName:Ph,backendName:"cpu",kernelFunc:DMe}});var AMe,OMe,bie,vie=D(()=>{"use strict";ve();yi();zi();AMe=Lr((n,t)=>Math.atan2(n,t)),OMe=Xr(Lh,AMe),bie={kernelName:Lh,backendName:"cpu",kernelFunc:OMe}});var RMe,wie,Sie=D(()=>{"use strict";ve();Zr();RMe=Hn($h,n=>Math.atanh(n)),wie={kernelName:$h,backendName:"cpu",kernelFunc:RMe}});function T2(n,t,e,r,o,s){let i=o.strideHeight,a=o.strideWidth,u=o.dilationHeight,c=o.dilationWidth,h=o.effectiveFilterHeight,f=o.effectiveFilterWidth,g=o.padInfo.top,d=o.padInfo.left,p=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Rn(o.outShape,e),y=m.values,v=o.outShape[1]*o.outShape[2]*o.outShape[3],N=o.outShape[2]*o.outShape[3],T=o.outShape[3];for(let O=0;O<o.batchSize;++O){let S=O*v,F=O*r[0];for(let R=0;R<o.inChannels;++R)for(let L=0;L<o.outHeight;++L){let q=L*i-g,U=Math.max(0,q),Z=Math.min(o.inHeight,h+q),ee=S+L*N;for(let Q=0;Q<o.outWidth;++Q){let oe=Q*a-d,se=Math.max(0,oe),pe=Math.min(o.inWidth,f+oe),ae=p,fe=0,he=0;for(let Le=U;Le<Z;Le+=u){let Ve=F+Le*r[1];for(let qe=se;qe<pe;qe+=c){let je=Ve+qe*r[2],Ce=n[je+R];s==="max"&&Ce>ae?ae=Ce:s==="avg"&&(fe+=Ce,he++)}if(isNaN(ae))break}let Ee=ee+Q*T+R;y[Ee]=s==="avg"?fe/he:ae}}}return m}function NA(n,t,e,r,o=!1,s=!1){let i=Rn(r.outShape,"int32"),a=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,h=r.dilationWidth,f=r.effectiveFilterHeight,g=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,m=Rn(t,e,n);for(let y=0;y<r.batchSize;++y)for(let v=0;v<r.inChannels;++v)for(let N=0;N<r.outHeight;++N){let T=N*a-d,O=T;for(;O<0;)O+=c;let S=Math.min(r.inHeight,f+T);for(let F=0;F<r.outWidth;++F){let R=F*u-p,L=R;for(;L<0;)L+=h;let q=Math.min(r.inWidth,g+R),U=Number.NEGATIVE_INFINITY,Z=-1;for(let ee=O;ee<S;ee+=c){let Q=ee-T;for(let oe=L;oe<q;oe+=h){let se=oe-R,pe=m.get(y,ee,oe,v);pe>U&&(U=pe,o?Z=s?((y*r.inHeight+ee)*r.inWidth+oe)*r.inChannels+v:(ee*r.inWidth+oe)*r.inChannels+v:Z=Q*g+se)}}i.set(Z,y,N,F,v)}}return i}function kA(n,t,e,r,o,s){let i=o.strideDepth,a=o.strideHeight,u=o.strideWidth,c=o.dilationDepth,h=o.dilationHeight,f=o.dilationWidth,g=o.effectiveFilterDepth,d=o.effectiveFilterHeight,p=o.effectiveFilterWidth,m=o.padInfo.front,y=o.padInfo.top,v=o.padInfo.left,N=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,T=Rn(o.outShape,e),O=T.values,S=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],F=o.outShape[2]*o.outShape[3]*o.outShape[4],R=o.outShape[3]*o.outShape[4],L=o.outShape[4];for(let q=0;q<o.batchSize;++q){let U=q*S,Z=q*r[0];for(let ee=0;ee<o.inChannels;++ee)for(let Q=0;Q<o.outDepth;++Q){let oe=Q*i-m,se=oe;for(;se<0;)se+=c;let pe=Math.min(o.inDepth,g+oe),ae=U+Q*F;for(let fe=0;fe<o.outHeight;++fe){let he=fe*a-y,Ee=he;for(;Ee<0;)Ee+=h;let Le=Math.min(o.inHeight,d+he),Ve=ae+fe*R;for(let qe=0;qe<o.outWidth;++qe){let je=qe*u-v,Ce=je;for(;Ce<0;)Ce+=f;let tt=Math.min(o.inWidth,p+je),ye=Ve+qe*L,z=N,M=0,W=0;for(let J=se;J<pe;J+=c){let Ie=Z+J*r[1];for(let Fe=Ee;Fe<Le;Fe+=h){let lt=Ie+Fe*r[2];for(let Dt=Ce;Dt<tt;Dt+=f){let Ht=lt+Dt*r[3],an=n[Ht+ee];if(s==="max"&&an>z?z=an:s==="avg"&&(M+=an,W++),isNaN(z))break}if(isNaN(z))break}if(isNaN(z))break}let ce=ye+ee;O[ce]=s==="avg"?M/W:z}}}}return T}function Cie(n,t){let e=Rn(t.outShape,"int32"),r=t.strideDepth,o=t.strideHeight,s=t.strideWidth,i=t.dilationDepth,a=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,g=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left;for(let m=0;m<t.batchSize;++m)for(let y=0;y<t.inChannels;++y)for(let v=0;v<t.outDepth;++v){let N=v*r-g,T=N;for(;T<0;)T+=i;let O=Math.min(t.inDepth,c+N);for(let S=0;S<t.outHeight;++S){let F=S*o-d,R=F;for(;R<0;)R+=a;let L=Math.min(t.inHeight,h+F);for(let q=0;q<t.outWidth;++q){let U=q*s-p,Z=U;for(;Z<0;)Z+=u;let ee=Math.min(t.inWidth,f+U),Q=Number.NEGATIVE_INFINITY,oe=-1;for(let se=T;se<O;se+=i){let pe=se-N;for(let ae=R;ae<L;ae+=a){let fe=ae-F;for(let he=Z;he<ee;he+=u){let Ee=he-U,Le=n.get(m,se,ae,he,y);Le>=Q&&(Q=Le,oe=pe*h*f+fe*h+Ee)}}}e.set(oe,m,v,S,q,y)}}}return e}var oy=D(()=>{"use strict";ve();});function MMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t;zt(o,"avgPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:u}=r,c=1;Y.assert(Re.eitherStridesOrDilationsAreOne(i,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let h=Re.computePool2DInfo(o.shape,s,i,c,a,u),f;if(h.filterWidth===1&&h.filterHeight===1&&Y.arraysEqual(h.inShape,h.outShape))f=Na({inputs:{x:o},backend:e});else{let g=e.data.get(o.dataId).values,d=Y.computeStrides(o.shape),p=T2(g,o.shape,o.dtype,d,h,"avg");f=e.makeTensorInfo(h.outShape,o.dtype,p.values)}return f}var Iie,_ie=D(()=>{"use strict";ve();Ln();oy();of();Iie={kernelName:Hf,backendName:"cpu",kernelFunc:MMe}});function FMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:s,strides:i,pad:a,dimRoundingMode:u,dataFormat:c,dilations:h}=r;zt(o,"avgPool3d");let f=h;f==null&&(f=[1,1,1]);let g=Re.computePool3DInfo(o.shape,s,i,f,a,u,c),d=e.data.get(o.dataId).values,p=kA(d,o.shape,o.dtype,Y.computeStrides(o.shape),g,"avg");return e.makeTensorInfo(p.shape,"float32",p.values)}var Tie,Eie=D(()=>{"use strict";ve();Ln();oy();Tie={kernelName:Kf,backendName:"cpu",kernelFunc:FMe}});function PMe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:s}=t,{filterSize:i,strides:a,pad:u,dilations:c,dimRoundingMode:h}=r;zt([o,s],"avgPool3DGrad");let f=Re.computePool3DInfo(s.shape,i,a,c,u,h),g=f.strideDepth,d=f.strideHeight,p=f.strideWidth,m=f.filterDepth,y=f.filterHeight,v=f.filterWidth,N=f.dilationDepth,T=f.dilationHeight,O=f.dilationWidth,S=f.effectiveFilterDepth,F=f.effectiveFilterHeight,R=f.effectiveFilterWidth,L=S-1-f.padInfo.front,q=R-1-f.padInfo.left,U=F-1-f.padInfo.top,Z=Rn(s.shape,"float32"),ee=1/(m*y*v),Q=e.bufferSync(o);for(let oe=0;oe<f.batchSize;++oe)for(let se=0;se<f.inChannels;++se)for(let pe=0;pe<f.inDepth;++pe)for(let ae=0;ae<f.inHeight;++ae)for(let fe=0;fe<f.inWidth;++fe){let he=pe-L,Ee=ae-U,Le=fe-q,Ve=0;for(let qe=0;qe<S;qe+=N){let je=(he+qe)/g;if(!(je<0||je>=f.outDepth||Math.floor(je)!==je))for(let Ce=0;Ce<F;Ce+=T){let tt=(Ee+Ce)/d;if(!(tt<0||tt>=f.outHeight||Math.floor(tt)!==tt))for(let ye=0;ye<R;ye+=O){let z=(Le+ye)/p;if(z<0||z>=f.outWidth||Math.floor(z)!==z)continue;let M=Q.get(oe,je,tt,z,se);Ve+=M}}}Z.set(Ve*ee,oe,pe,ae,fe,se)}return e.makeTensorInfo(Z.shape,Z.dtype,Z.values)}var Nie,kie=D(()=>{"use strict";ve();Ln();Nie={kernelName:s1,backendName:"cpu",kernelFunc:PMe}});function $Me(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:s}=t,i=s;zt([o,s],"avgPoolGrad");let{filterSize:a,strides:u,pad:c}=r,h=Re.computePool2DInfo(i.shape,a,u,1,c),f=h.strideHeight,g=h.strideWidth,d=h.filterHeight,p=h.filterWidth,m=h.dilationHeight,y=h.dilationWidth,v=h.effectiveFilterHeight,N=h.effectiveFilterWidth,T=N-1-h.padInfo.left,O=v-1-h.padInfo.top,S=Rn(i.shape,"float32"),F=1/(d*p),R=e.data.get(o.dataId).values,L=Rn(o.shape,"float32",R);for(let q=0;q<h.batchSize;++q)for(let U=0;U<h.inChannels;++U)for(let Z=0;Z<h.inHeight;++Z)for(let ee=0;ee<h.inWidth;++ee){let Q=Z-O,oe=ee-T,se=0;for(let pe=0;pe<v;pe+=m){let ae=(Q+pe)/f;if(!(ae<0||ae>=h.outHeight||Math.floor(ae)!==ae))for(let fe=0;fe<N;fe+=y){let he=(oe+fe)/g;if(he<0||he>=h.outWidth||Math.floor(he)!==he)continue;let Ee=L.get(q,ae,he,U);se+=Ee}}S.set(se*F,q,Z,ee,U)}return e.makeTensorInfo(S.shape,S.dtype,S.values)}var Die,Aie=D(()=>{"use strict";ve();Ln();Die={kernelName:o1,backendName:"cpu",kernelFunc:$Me}});function LMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,scale:s,offset:i,mean:a,variance:u}=t;Y.assert(a.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),Y.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),Y.assert(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),zt([o,a,u,s,i],"batchNorm");let{varianceEpsilon:c}=r;c==null&&(c=.001);let h=e.data.get(o.dataId).values,f=e.data.get(a.dataId).values,g=e.data.get(u.dataId).values,d=s?e.data.get(s.dataId).values:new Float32Array([1]),p=i?e.data.get(i.dataId).values:new Float32Array([0]),m=new Float32Array(h.length),y=p.length,v=d.length,N=g.length,T=f.length,O=0,S=0,F=0,R=0;for(let L=0;L<h.length;++L)m[L]=p[O++]+(h[L]-f[S++])*d[F++]/Math.sqrt(g[R++]+c),O>=y&&(O=0),S>=T&&(S=0),F>=v&&(F=0),R>=N&&(R=0);return e.makeTensorInfo(o.shape,o.dtype,m)}var Oie,Rie=D(()=>{"use strict";ve();Ln();Oie={kernelName:im,backendName:"cpu",kernelFunc:LMe}});function BMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:s,crops:i}=r;zt([o],"batchToSpaceND");let a=s.reduce((v,N)=>v*N),u=Re.getReshaped(o.shape,s,a),c=Re.getPermuted(u.length,s.length),h=Re.getReshapedPermuted(o.shape,s,a),f=Re.getSliceBeginCoords(i,s.length),g=Re.getSliceSize(h,i,s.length),d=Ur({inputs:{x:o},backend:e,attrs:{shape:u}}),p=xi({inputs:{x:d},backend:e,attrs:{perm:c}}),m=Ur({inputs:{x:p},backend:e,attrs:{shape:h}}),y=Zl({inputs:{x:m},backend:e,attrs:{begin:f,size:g}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),y}var Mie,Fie=D(()=>{"use strict";ve();Ln();Qa();ry();Ql();Mie={kernelName:Yf,backendName:"cpu",kernelFunc:BMe}});function zMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,weights:s}=t,{size:i}=r,a=e.data.get(o.dataId).values,u=e.data.get(s.dataId).values,c=S2(a,u,s.dtype,s.shape,i);return e.makeTensorInfo([i],s.dtype,c)}var Pie,$ie=D(()=>{"use strict";ve();mA();Pie={kernelName:i1,backendName:"cpu",kernelFunc:zMe}});var VMe,Lie,Bie=D(()=>{"use strict";ve();Zr();VMe=Hn(zh,(n,t)=>{let e=t;return n>e.clipValueMax?e.clipValueMax:n<e.clipValueMin?e.clipValueMin:n}),Lie={kernelName:zh,backendName:"cpu",kernelFunc:VMe}});var jMe,zie,Vie=D(()=>{"use strict";ve();jMe=n=>{let{x:t}=n.inputs,e=n.backend,r=new Float32Array(Y.sizeFromShape(t.shape)),o=e.data.get(t.dataId),s=o.complexTensorInfos.real,i=o.complexTensorInfos.imag,a=e.data.get(s.dataId).values,u=e.data.get(i.dataId).values;for(let c=0;c<a.length;c++){let h=a[c],f=u[c];r[c]=Math.hypot(h,f)}return e.makeOutput(r,t.shape,"float32")},zie={kernelName:Qf,backendName:"cpu",kernelFunc:jMe}});function sf(n){let{inputs:t,backend:e}=n,{input:r}=t,o=e.data.get(r.dataId).complexTensorInfos.imag,s=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,s)}var jie,E2=D(()=>{"use strict";ve();jie={kernelName:C1,backendName:"cpu",kernelFunc:sf}});function sy(n){let{inputs:t,backend:e,attrs:r}=n,{axis:o}=r,s=Y.parseAxisParam(o,t[0].shape)[0],i=Re.computeOutShape(t.map(m=>m.shape),s);if(Y.sizeFromShape(i)===0)return e.makeTensorInfo(i,t[0].dtype,[]);let a=t.filter(m=>Y.sizeFromShape(m.shape)>0);if(a.length===1)return Na({inputs:{x:a[0]},backend:e});let u=a.map(m=>m.shape);if(Re.assertParamsConsistent(u,s),a[0].dtype==="complex64"){let m=a.map(O=>Hl({inputs:{input:O},backend:e})),y=a.map(O=>sf({inputs:{input:O},backend:e})),v=sy({inputs:m,backend:e,attrs:{axis:s}}),N=sy({inputs:y,backend:e,attrs:{axis:s}}),T=Ni({inputs:{real:v,imag:N},backend:e});return m.forEach(O=>e.disposeIntermediateTensorInfo(O)),y.forEach(O=>e.disposeIntermediateTensorInfo(O)),e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(N),T}let c=a.map(m=>{let v=[-1,Y.sizeFromShape(m.shape.slice(s))];return Ur({inputs:{x:m},backend:e,attrs:{shape:v}})}),h=c.map(m=>({vals:e.data.get(m.dataId).values,shape:m.shape}));i=Re.computeOutShape(c.map(m=>m.shape),1);let f=c[0].shape[0]===1,g=gA(h,i,t[0].dtype,f),d=Re.computeOutShape(a.map(m=>m.shape),s),p=e.makeTensorInfo(d,t[0].dtype,g);return c.forEach(m=>e.disposeIntermediateTensorInfo(m)),p}var Uie,DA=D(()=>{"use strict";ve();ag();w8();of();E2();Ox();Qa();Uie={kernelName:Zf,backendName:"cpu",kernelFunc:sy}});function xL(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:s}=t,{strides:i,pad:a,dataFormat:u,dilations:c,dimRoundingMode:h}=r;zt([o,s],"conv2d");let f=Re.convertConv2DDataFormat(u),g=Re.computeConv2DInfo(o.shape,s.shape,i,c,a,h,!1,f),d=g.filterHeight,p=g.filterWidth,m=g.dilationHeight,y=g.dilationWidth,v=g.padInfo.left,N=g.padInfo.top,T=g.dataFormat==="channelsLast",O=new no(g.outShape,o.dtype),S=Y.computeStrides(o.shape),F=Y.computeStrides(s.shape),R=S[0],L=T?S[1]:S[2],q=T?S[2]:1,U=T?1:S[1],Z=O.strides[0],ee=T?O.strides[1]:O.strides[2],Q=T?O.strides[2]:1,oe=T?1:O.strides[1],se=e.data.get(o.dataId).values,pe=e.data.get(s.dataId).values,ae=O.values;for(let fe=0;fe<g.batchSize;++fe){let he=fe*R,Ee=fe*Z;for(let Le=0;Le<g.outHeight;++Le){let Ve=Ee+Le*ee,qe=Le*g.strideHeight-N;for(let je=0;je<d;++je){let Ce=qe+je*m;if(Ce<0||Ce>=g.inHeight)continue;let tt=je*F[0],ye=he+Ce*L;for(let z=0;z<g.outWidth;++z){let M=Ve+z*Q,W=z*g.strideWidth-v;for(let ce=0;ce<p;++ce){let J=W+ce*y;if(J<0||J>=g.inWidth)continue;let Ie=tt+ce*F[1],Fe=ye+J*q,lt=Ie;for(let Dt=0;Dt<g.inChannels;++Dt){let Ht=se[Fe+Dt*U];for(let an=0;an<g.outChannels;++an)ae[M+an*oe]+=Ht*pe[lt+an];lt+=g.outChannels}}}}}}return e.makeTensorInfo(O.shape,O.dtype,ae)}var qie,bL=D(()=>{"use strict";ve();Ln();qie={kernelName:Jf,backendName:"cpu",kernelFunc:xL}});function UMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:s}=t,{strides:i,pad:a,dataFormat:u,dimRoundingMode:c,filterShape:h}=r;zt([o,s],"conv2dBackpropFilter");let f=Re.convertConv2DDataFormat(u),g=Re.computeConv2DInfo(o.shape,h,i,1,a,c,!1,f),{strideHeight:d,strideWidth:p,filterHeight:m,filterWidth:y}=g,v=g.dataFormat==="channelsLast",N=new no(g.filterShape,"float32"),T=g.padInfo.left,O=g.padInfo.top,S=e.data.get(o.dataId).values,F=e.data.get(s.dataId).values,R=new no(o.shape,o.dtype,S),L=new no(s.shape,s.dtype,F);for(let q=0;q<m;++q){let U=Math.max(0,Math.ceil((O-q)/d)),Z=Math.min(g.outHeight,(g.inHeight+O-q)/d);for(let ee=0;ee<y;++ee){let Q=Math.max(0,Math.ceil((T-ee)/p)),oe=Math.min(g.outWidth,(g.inWidth+T-ee)/p);for(let se=0;se<g.inChannels;++se)for(let pe=0;pe<g.outChannels;++pe){let ae=0;for(let fe=0;fe<g.batchSize;++fe)for(let he=U;he<Z;++he){let Ee=q+he*d-O;for(let Le=Q;Le<oe;++Le){let Ve=ee+Le*p-T;v?ae+=R.get(fe,Ee,Ve,se)*L.get(fe,he,Le,pe):ae+=R.get(fe,se,Ee,Ve)*L.get(fe,pe,he,Le)}}N.set(ae,q,ee,se,pe)}}}return e.makeTensorInfo(N.shape,N.dtype,N.values)}var Gie,Wie=D(()=>{"use strict";ve();Ln();Gie={kernelName:u1,backendName:"cpu",kernelFunc:UMe}});function qMe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:s}=t,{inputShape:i,strides:a,pad:u,dataFormat:c,dimRoundingMode:h}=r;zt([o,s],"conv2dBackpropInput");let f=Y.computeStrides(s.shape),g=Y.computeStrides(o.shape),d=Re.convertConv2DDataFormat(c),p=Re.computeConv2DInfo(i,s.shape,a,1,u,h,!1,d),m=new no(p.inShape,"float32"),y=m.values,v=e.data.get(o.dataId).values,N=e.data.get(s.dataId).values,[T,O,S]=f,{batchSize:F,filterHeight:R,filterWidth:L,inChannels:q,inHeight:U,inWidth:Z,outChannels:ee,outHeight:Q,outWidth:oe,strideHeight:se,strideWidth:pe}=p;d=p.dataFormat;let ae=R-1-p.padInfo.top,fe=L-1-p.padInfo.left,he=d==="channelsLast",Ee=m.strides[0],Le=he?m.strides[1]:m.strides[2],Ve=he?m.strides[2]:1,qe=he?1:m.strides[1],je=g[0],Ce=he?g[1]:g[2],tt=he?g[2]:1,ye=he?1:g[1];for(let z=0;z<F;++z)for(let M=0;M<q;++M)for(let W=0;W<U;++W){let ce=W-ae,J=Math.max(0,Math.ceil(ce/se)),Ie=Math.min(Q,(R+ce)/se);for(let Fe=0;Fe<Z;++Fe){let lt=Fe-fe,Dt=Math.max(0,Math.ceil(lt/pe)),Ht=Math.min(oe,(L+lt)/pe),an=0;for(let nn=J;nn<Ie;++nn){let Yn=nn*se-ce;for(let ln=Dt;ln<Ht;++ln){let Qn=ln*pe-lt,wn=je*z+Ce*nn+tt*ln,_r=T*(R-1-Yn)+O*(L-1-Qn)+S*M;for(let Ar=0;Ar<ee;++Ar){let ss=v[wn+ye*Ar],Qo=N[_r+Ar];an+=ss*Qo}}}let cn=Ee*z+Le*W+Ve*Fe+qe*M;y[cn]=an}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}var Hie,Kie=D(()=>{"use strict";ve();Ln();Hie={kernelName:em,backendName:"cpu",kernelFunc:qMe}});function GMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:s}=t,{strides:i,pad:a,dilations:u}=r;zt([o,s],"conv3d");let c=Re.computeConv3DInfo(o.shape,s.shape,i,u,a),{filterDepth:h,filterHeight:f,filterWidth:g,dilationDepth:d,dilationHeight:p,dilationWidth:m,padInfo:y}=c,v=y.front,N=y.left,T=y.top,O=new no(c.outShape,o.dtype),S=e.data.get(o.dataId).values,F=e.data.get(s.dataId).values,R=O.values,L=Y.computeStrides(o.shape),q=Y.computeStrides(s.shape);for(let U=0;U<c.batchSize;++U){let Z=U*L[0],ee=U*O.strides[0];for(let Q=0;Q<c.outDepth;++Q){let oe=ee+Q*O.strides[1],se=Q*c.strideDepth-v;for(let pe=0;pe<h;++pe){let ae=se+pe*d;if(ae<0||ae>=c.inDepth)continue;let fe=pe*q[0],he=Z+ae*L[1];for(let Ee=0;Ee<c.outHeight;++Ee){let Le=oe+Ee*O.strides[2],Ve=Ee*c.strideHeight-T;for(let qe=0;qe<f;++qe){let je=Ve+qe*p;if(je<0||je>=c.inHeight)continue;let Ce=fe+qe*q[1],tt=he+je*L[2];for(let ye=0;ye<c.outWidth;++ye){let z=Le+ye*c.outChannels,M=ye*c.strideWidth-N;for(let W=0;W<g;++W){let ce=M+W*m;if(ce<0||ce>=c.inWidth)continue;let J=Ce+W*q[2],Ie=tt+ce*c.inChannels,Fe=J;for(let lt=0;lt<c.inChannels;++lt){let Dt=S[Ie+lt];for(let Ht=0;Ht<c.outChannels;++Ht)R[z+Ht]+=Dt*F[Fe+Ht];Fe+=c.outChannels}}}}}}}}return e.makeTensorInfo(O.shape,O.dtype,O.values)}var Xie,Yie=D(()=>{"use strict";ve();Ln();Xie={kernelName:tm,backendName:"cpu",kernelFunc:GMe}});function WMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:s}=t,{strides:i,pad:a,filterShape:u}=r;zt([o,s],"conv3dBackpropFilterV2");let c=Y.computeStrides(o.shape),h=Y.computeStrides(s.shape),f=Re.computeConv3DInfo(o.shape,u,i,1,a),g=f.strideDepth,d=f.strideHeight,p=f.strideWidth,m=f.filterDepth,y=f.filterHeight,v=f.filterWidth,N=new no(f.filterShape,"float32"),T=N.values,[O,S,F,R]=N.strides,L=e.data.get(s.dataId).values,[q,U,Z,ee]=h,Q=e.data.get(o.dataId).values,[oe,se,pe,ae]=c,fe=f.padInfo.front,he=f.padInfo.left,Ee=f.padInfo.top;for(let Le=0;Le<m;++Le){let Ve=Math.max(0,Math.ceil((fe-Le)/g)),qe=Math.min(f.outDepth,(f.inDepth+fe-Le)/g),je=Le*O;for(let Ce=0;Ce<y;++Ce){let tt=Math.max(0,Math.ceil((Ee-Ce)/d)),ye=Math.min(f.outHeight,(f.inHeight+Ee-Ce)/d),z=Ce*S+je;for(let M=0;M<v;++M){let W=Math.max(0,Math.ceil((he-M)/p)),ce=Math.min(f.outWidth,(f.inWidth+he-M)/p),J=M*F+z;for(let Ie=0;Ie<f.inChannels;++Ie){let Fe=Ie*R+J;for(let lt=0;lt<f.outChannels;++lt){let Dt=0;for(let Ht=0;Ht<f.batchSize;++Ht){let an=Ht*oe,cn=Ht*q;for(let nn=Ve;nn<qe;++nn){let ln=(Le+nn*g-fe)*se+an,Qn=nn*U+cn;for(let wn=tt;wn<ye;++wn){let Ar=(Ce+wn*d-Ee)*pe+ln,ss=wn*Z+Qn;for(let Qo=W;Qo<ce;++Qo){let ki=(M+Qo*p-he)*ae+Ar,Di=Qo*ee+ss;Dt+=Q[ki+Ie]*L[Di+lt]}}}}T[Fe+lt]=Dt}}}}}return e.makeTensorInfo(N.shape,N.dtype,N.values)}var Qie,Zie=D(()=>{"use strict";ve();Ln();Qie={kernelName:c1,backendName:"cpu",kernelFunc:WMe}});function HMe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:s}=t,{pad:i,strides:a,inputShape:u}=r;zt([o],"conv3dBackpropInputV2");let c=Y.computeStrides(o.shape),h=Y.computeStrides(s.shape),f=Re.computeConv3DInfo(u,s.shape,a,1,i),g=new no(f.inShape,"float32"),d=g.values,[p,m,y,v]=g.strides,N=e.data.get(o.dataId).values,[T,O,S,F]=c,R=e.data.get(s.dataId).values,[L,q,U,Z]=h,{batchSize:ee,filterDepth:Q,filterHeight:oe,filterWidth:se,inChannels:pe,inDepth:ae,inHeight:fe,inWidth:he,outChannels:Ee,outDepth:Le,outHeight:Ve,outWidth:qe,strideDepth:je,strideHeight:Ce,strideWidth:tt}=f,ye=Q-1-f.padInfo.front,z=oe-1-f.padInfo.top,M=se-1-f.padInfo.left;for(let W=0;W<ee;++W)for(let ce=0;ce<pe;++ce)for(let J=0;J<ae;++J){let Ie=J-ye,Fe=Math.max(0,Math.ceil(Ie/je)),lt=Math.min(Le,(Q+Ie)/je);for(let Dt=0;Dt<fe;++Dt){let Ht=Dt-z,an=Math.max(0,Math.ceil(Ht/Ce)),cn=Math.min(Ve,(oe+Ht)/Ce);for(let nn=0;nn<he;++nn){let Yn=nn-M,ln=Math.max(0,Math.ceil(Yn/tt)),Qn=Math.min(qe,(se+Yn)/tt),wn=0;for(let _r=Fe;_r<lt;++_r){let Ar=_r*je-Ie;for(let ss=an;ss<cn;++ss){let Qo=ss*Ce-Ht;for(let Ws=ln;Ws<Qn;++Ws){let ki=Ws*tt-Yn,Di=T*W+O*_r+S*ss+F*Ws,Ai=L*(Q-1-Ar)+q*(oe-1-Qo)+U*(se-1-ki)+Z*ce;for(let ia=0;ia<Ee;++ia){let aa=N[Di+ia],Nu=R[Ai+ia];wn+=aa*Nu}}}}d[p*W+m*J+y*Dt+v*nn+ce]=wn}}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}var Jie,eae=D(()=>{"use strict";ve();Ln();Jie={kernelName:l1,backendName:"cpu",kernelFunc:HMe}});var KMe,tae,nae=D(()=>{"use strict";ve();Zr();KMe=Hn(Vh,n=>Math.cos(n)),tae={kernelName:Vh,backendName:"cpu",kernelFunc:KMe}});var XMe,rae,oae=D(()=>{"use strict";ve();Zr();XMe=Hn(jh,n=>Math.cosh(n)),rae={kernelName:jh,backendName:"cpu",kernelFunc:XMe}});function YMe(n){let{inputs:t,backend:e,attrs:r}=n,{image:o,boxes:s,boxInd:i}=t,{cropSize:a,method:u,extrapolationValue:c}=r,[h,f,g,d]=o.shape,p=s.shape[0],[m,y]=a,v=Rn([p,m,y,d],"float32"),N=e.data.get(s.dataId).values,T=e.data.get(i.dataId).values,O=e.data.get(o.dataId).values,S=Y.computeStrides(o.shape),F=Y.computeStrides(v.shape);for(let R=0;R<p;R++){let L=R*4,q=N[L],U=N[L+1],Z=N[L+2],ee=N[L+3],Q=T[R];if(Q>=h)continue;let oe=m>1?(Z-q)*(f-1)/(m-1):0,se=y>1?(ee-U)*(g-1)/(y-1):0;for(let pe=0;pe<m;pe++){let ae=m>1?q*(f-1)+pe*oe:.5*(q+Z)*(f-1);if(ae<0||ae>f-1){for(let fe=0;fe<y;fe++)for(let he=0;he<d;he++){let Ee=he+fe*F[2]+pe*F[1]+R*F[0];v.values[Ee]=c}continue}if(u==="bilinear"){let fe=Math.floor(ae),he=Math.ceil(ae),Ee=ae-fe;for(let Le=0;Le<y;Le++){let Ve=y>1?U*(g-1)+Le*se:.5*(U+ee)*(g-1);if(Ve<0||Ve>g-1){for(let tt=0;tt<d;tt++){let ye=tt+Le*F[2]+pe*F[1]+R*F[0];v.values[ye]=c}continue}let qe=Math.floor(Ve),je=Math.ceil(Ve),Ce=Ve-qe;for(let tt=0;tt<d;tt++){let ye=tt+qe*S[2]+fe*S[1]+Q*S[0],z=O[ye];ye=tt+je*S[2]+fe*S[1]+Q*S[0];let M=O[ye];ye=tt+qe*S[2]+he*S[1]+Q*S[0];let W=O[ye];ye=tt+je*S[2]+he*S[1]+Q*S[0];let ce=O[ye],J=z+(M-z)*Ce,Ie=W+(ce-W)*Ce;ye=tt+Le*F[2]+pe*F[1]+R*F[0],v.values[ye]=J+(Ie-J)*Ee}}}else for(let fe=0;fe<y;++fe){let he=y>1?U*(g-1)+fe*se:.5*(U+ee)*(g-1);if(he<0||he>g-1){for(let Ve=0;Ve<d;Ve++){let qe=Ve+fe*F[2]+pe*F[1]+R*F[0];v.values[qe]=c}continue}let Ee=Math.round(he),Le=Math.round(ae);for(let Ve=0;Ve<d;Ve++){let qe=Ve+Ee*S[2]+Le*S[1]+Q*S[0],je=Ve+fe*F[2]+pe*F[1]+R*F[0];v.values[je]=O[qe]}}}}return e.makeTensorInfo(v.shape,v.dtype,v.values)}var sae,iae=D(()=>{"use strict";ve();sae={kernelName:p1,backendName:"cpu",kernelFunc:YMe}});function QMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,exclusive:i,reverse:a}=r;zt(o,"cumsum");let u=Re.getAxesPermutation([s],o.shape.length),c=o;u!=null&&(c=xi({inputs:{x:o},backend:e,attrs:{perm:u}}));let h=Re.getInnerMostAxes(1,o.shape.length)[0];if(h!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${h}`);let f=ci(c.dtype,"int32"),g=Y.makeZerosTypedArray(Y.sizeFromShape(c.shape),f),d=e.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=a?(v,N)=>v+p-N-1:(v,N)=>v+N;for(let v=0;v<d.length;v+=p)for(let N=0;N<p;N++){let T=m(v,N);if(N===0)g[T]=i?0:d[T];else{let O=m(v,N-1);g[T]=i?d[O]+g[O]:d[T]+g[O]}}let y=e.makeTensorInfo(c.shape,f,g);if(u!=null){let v=Re.getUndoAxesPermutation(u),N=xi({inputs:{x:y},backend:e,attrs:{perm:v}});return e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(c),N}return y}var aae,uae=D(()=>{"use strict";ve();Ln();Ql();aae={kernelName:nm,backendName:"cpu",kernelFunc:QMe}});function ZMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,weights:s}=t,{size:i,binaryOutput:a}=r;if(o.shape.length===1){let u=e.data.get(o.dataId).values,c=e.data.get(s.dataId).values,h=S2(u,c,s.dtype,s.shape,i);return e.makeTensorInfo([i],s.dtype,h)}else if(o.shape.length===2){let u=e.bufferSync(o),c=e.bufferSync(s),h=fA(u,c,i,a);return e.makeTensorInfo(h.shape,s.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var cae,lae=D(()=>{"use strict";ve();mA();cae={kernelName:h1,backendName:"cpu",kernelFunc:ZMe}});function JMe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockSize:s,dataFormat:i}=r;Y.assert(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`),Y.assert(s>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${s}`);let a=o.shape[0],u=o.shape[1],c=o.shape[2],h=o.shape[3],f=u*s,g=c*s,d=h/(s*s),p=e.data.get(o.dataId).values,m=new Float32Array(a*f*g*d),y=0;for(let v=0;v<a;++v)for(let N=0;N<f;++N){let T=Math.floor(N/s),O=N%s;for(let S=0;S<g;++S){let F=Math.floor(S/s),R=S%s,L=(O*s+R)*d;for(let q=0;q<d;++q){let Z=q+L+h*(F+c*(T+u*v));m[y++]=p[Z]}}}return e.makeTensorInfo([a,f,g,d],o.dtype,m)}var pae,hae=D(()=>{"use strict";ve();pae={kernelName:d1,backendName:"cpu",kernelFunc:JMe}});function vL(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:s}=t,{strides:i,pad:a,dilations:u,dimRoundingMode:c}=r;zt([o,s],"depthwiseConv2DNative");let h=Y.computeStrides(o.shape),f=Y.computeStrides(s.shape),g=u;g==null&&(g=[1,1]),Y.assert(Re.eitherStridesOrDilationsAreOne(i,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${g}'`);let d=Re.computeConv2DInfo(o.shape,s.shape,i,g,a,c,!0),{filterHeight:p,filterWidth:m,dilationHeight:y,dilationWidth:v,padInfo:N}=d,T=N.left,O=N.top,S=d.outChannels/d.inChannels,F=new no(d.outShape,o.dtype),R=e.data.get(o.dataId).values,L=e.data.get(s.dataId).values,q=F.values;for(let U=0;U<d.batchSize;++U){let Z=U*h[0],ee=U*F.strides[0];for(let Q=0;Q<d.outHeight;++Q){let oe=ee+Q*F.strides[1],se=Q*d.strideHeight-T;for(let pe=0;pe<p;++pe){let ae=se+pe*y;if(ae<0||ae>=d.inHeight)continue;let fe=pe*f[0],he=Z+ae*h[1];for(let Ee=0;Ee<d.outWidth;++Ee){let Le=oe+Ee*F.strides[2],Ve=Ee*d.strideWidth-O;for(let qe=0;qe<m;++qe){let je=Ve+qe*v;if(je<0||je>=d.inWidth)continue;let Ce=fe+qe*f[1],tt=he+je*d.inChannels,ye=Le,z=Ce;for(let M=0;M<d.inChannels;++M){let W=R[tt+M];for(let ce=0;ce<S;++ce)q[ye+ce]+=W*L[z+ce];ye+=S,z+=S}}}}}}return e.makeTensorInfo(F.shape,F.dtype,F.values)}var dae,wL=D(()=>{"use strict";ve();Ln();dae={kernelName:rm,backendName:"cpu",kernelFunc:vL}});function eFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:s}=t,{strides:i,dilations:a,pad:u,dimRoundingMode:c,filterShape:h}=r;zt([o,s],"depthwiseConv2dNativeBackpropFilter");let f=Re.computeConv2DInfo(o.shape,h,i,a,u,c,!0),{strideHeight:g,strideWidth:d,filterHeight:p,filterWidth:m}=f,y=new no(f.filterShape,"float32"),v=f.padInfo.left,N=f.padInfo.top,T=f.outChannels/f.inChannels,O=e.data.get(o.dataId).values,S=new no(o.shape,o.dtype,O),F=e.data.get(s.dataId).values,R=new no(s.shape,s.dtype,F);for(let L=0;L<p;++L){let q=Math.max(0,Math.ceil((N-L)/g)),U=Math.min(f.outHeight,(f.inHeight+N-L)/g);for(let Z=0;Z<m;++Z){let ee=Math.max(0,Math.ceil((v-Z)/d)),Q=Math.min(f.outWidth,(f.inWidth+v-Z)/d);for(let oe=0;oe<f.outChannels;++oe){let se=Math.trunc(oe/T),pe=oe%T,ae=0;for(let fe=0;fe<f.batchSize;++fe)for(let he=q;he<U;++he){let Ee=L+he*g-N;for(let Le=ee;Le<Q;++Le){let Ve=Z+Le*d-v;ae+=S.get(fe,Ee,Ve,se)*R.get(fe,he,Le,oe)}}y.set(ae,L,Z,se,pe)}}}return e.makeTensorInfo(y.shape,y.dtype,y.values)}var fae,mae=D(()=>{"use strict";ve();Ln();fae={kernelName:f1,backendName:"cpu",kernelFunc:eFe}});function tFe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:s}=t,{strides:i,dilations:a,pad:u,dimRoundingMode:c,inputShape:h}=r;zt([o,s],"depthwiseConv2DNativeBackpropInput");let f=Y.computeStrides(o.shape),g=Y.computeStrides(s.shape),d=Re.computeConv2DInfo(h,s.shape,i,a,u,c,!0),p=new no(d.inShape,"float32"),m=p.values,[y,v,N]=p.strides,T=e.data.get(o.dataId).values,[O,S,F]=f,R=e.data.get(s.dataId).values,[L,q,U]=g,{batchSize:Z,filterHeight:ee,filterWidth:Q,inChannels:oe,inHeight:se,inWidth:pe,outChannels:ae,outHeight:fe,outWidth:he,strideHeight:Ee,strideWidth:Le}=d,Ve=ee-1-d.padInfo.top,qe=Q-1-d.padInfo.left,je=ae/oe;for(let Ce=0;Ce<Z;++Ce)for(let tt=0;tt<oe;++tt)for(let ye=0;ye<se;++ye){let z=ye-Ve,M=Math.max(0,Math.ceil(z/Ee)),W=Math.min(fe,(ee+z)/Ee);for(let ce=0;ce<pe;++ce){let J=ce-qe,Ie=Math.max(0,Math.ceil(J/Le)),Fe=Math.min(he,(Q+J)/Le),lt=0;for(let Dt=M;Dt<W;++Dt){let Ht=Dt*Ee-z;for(let an=Ie;an<Fe;++an){let cn=an*Le-J,nn=O*Ce+S*Dt+F*an,Yn=L*(ee-1-Ht)+q*(Q-1-cn)+U*tt;for(let ln=0;ln<je;++ln){let Qn=tt*je+ln,wn=T[nn+Qn],_r=R[Yn+ln];lt+=wn*_r}}}m[y*Ce+v*ye+N*ce+tt]=lt}}return e.makeTensorInfo(p.shape,p.dtype,p.values)}var gae,yae=D(()=>{"use strict";ve();Ln();gae={kernelName:m1,backendName:"cpu",kernelFunc:tFe}});function nFe(n){let{inputs:t,backend:e}=n,{x:r}=t,o=Y.sizeFromShape(r.shape),s=e.data.get(r.dataId).values,i=Rn([o,o],r.dtype),a=i.values;for(let c=0;c<s.length;c++)a[c*o+c]=s[c];let u=[...r.shape,...r.shape];return e.makeTensorInfo(u,i.dtype,i.values)}var xae,bae=D(()=>{"use strict";ve();xae={kernelName:g1,backendName:"cpu",kernelFunc:nFe}});var vae,wae=D(()=>{"use strict";ve();vae={kernelName:om,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{let{x:r,filter:o}=n,{strides:s,pad:i,dilations:a}=e,u=t,c=u.data.get(r.dataId).values,h=r.shape.length,f=u.data.get(o.dataId).values,g=o.shape.length,{batchSize:d,inHeight:p,inWidth:m,inChannels:y,outHeight:v,outWidth:N,padInfo:T,strideHeight:O,strideWidth:S,filterHeight:F,filterWidth:R,dilationHeight:L,dilationWidth:q,outShape:U}=Re.computeDilation2DInfo(r.shape,o.shape,s,i,"NHWC",a),Z=Y.sizeFromShape(U),ee=U.length,Q=Y.getArrayFromDType(r.dtype,Z);for(let se=0;se<d;++se)for(let pe=0;pe<v;++pe){let ae=pe*O-T.top;for(let fe=0;fe<N;++fe){let he=fe*S-T.left;for(let Ee=0;Ee<y;++Ee){let Le=Number.MIN_SAFE_INTEGER;for(let qe=0;qe<F;++qe){let je=ae+qe*L;if(je>=0&&je<p)for(let Ce=0;Ce<R;++Ce){let tt=he+Ce*q;if(tt>=0&&tt<m){let ye=Y.locToIndex([se,je,tt,Ee],h,Y.computeStrides(r.shape)),z=Y.locToIndex([qe,Ce,Ee],g,Y.computeStrides(o.shape)),M=c[ye]+f[z];M>Le&&(Le=M)}}}let Ve=Y.locToIndex([se,pe,fe,Ee],ee,Y.computeStrides(U));Q[Ve]=Le}}}return{dataId:u.write(Y.toTypedArray(Q,r.dtype),U,r.dtype),shape:U,dtype:r.dtype}}}});var Sae,Cae=D(()=>{"use strict";ve();Sae={kernelName:Pv,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{let{x:r,filter:o,dy:s}=n,{strides:i,pad:a,dilations:u}=e,c=t,h=Y.toNestedArray(r.shape,c.data.get(r.dataId).values),f=Y.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:g,inHeight:d,inWidth:p,inChannels:m,outHeight:y,outWidth:v,padInfo:N,strideHeight:T,strideWidth:O,filterHeight:S,filterWidth:F,dilationHeight:R,dilationWidth:L,outShape:q}=Re.computeDilation2DInfo(r.shape,o.shape,i,a,"NHWC",u);Y.assert(s.rank===q.length,()=>`Error in ${Pv}, dy must have the same rank as output ${q.length}, but got ${s.rank}`);let U=Y.toNestedArray(q,c.data.get(s.dataId).values),Z=Y.makeZerosNestedTypedArray(o.shape,o.dtype);for(let Q=0;Q<g;++Q)for(let oe=0;oe<y;++oe){let se=oe*T-N.top;for(let pe=0;pe<v;++pe){let ae=pe*O-N.left;for(let fe=0;fe<m;++fe){let he=Number.MIN_SAFE_INTEGER,Ee=0,Le=0;for(let Ve=0;Ve<S;++Ve){let qe=se+Ve*R;if(qe>=0&&qe<d)for(let je=0;je<F;++je){let Ce=ae+je*L;if(Ce>=0&&Ce<p){let tt=h[Q][qe][Ce][fe]+f[Ve][je][fe];tt>he&&(he=tt,Ee=Ve,Le=je)}}}Z[Ee][Le][fe]+=U[Q][oe][pe][fe]}}}return{dataId:c.write(Y.toTypedArray(Z,r.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}}});var Iae,_ae=D(()=>{"use strict";ve();Iae={kernelName:Fv,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{let{x:r,filter:o,dy:s}=n,{strides:i,pad:a,dilations:u}=e,c=t,h=Y.toNestedArray(r.shape,c.data.get(r.dataId).values),f=Y.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:g,inHeight:d,inWidth:p,inChannels:m,outHeight:y,outWidth:v,padInfo:N,strideHeight:T,strideWidth:O,filterHeight:S,filterWidth:F,dilationHeight:R,dilationWidth:L,outShape:q}=Re.computeDilation2DInfo(r.shape,o.shape,i,a,"NHWC",u);Y.assert(s.rank===q.length,()=>`Error in ${Fv}, dy must have the same rank as output ${q.length}, but got ${s.rank}`);let U=Y.toNestedArray(q,c.data.get(s.dataId).values),Z=Y.makeZerosNestedTypedArray(r.shape,r.dtype);for(let Q=0;Q<g;++Q)for(let oe=0;oe<y;++oe){let se=oe*T-N.top;for(let pe=0;pe<v;++pe){let ae=pe*O-N.left;for(let fe=0;fe<m;++fe){let he=Number.MIN_SAFE_INTEGER,Ee=se<0?0:se,Le=ae<0?0:ae;for(let Ve=0;Ve<S;++Ve){let qe=se+Ve*R;if(qe>=0&&qe<d)for(let je=0;je<F;++je){let Ce=ae+je*L;if(Ce>=0&&Ce<p){let tt=h[Q][qe][Ce][fe]+f[Ve][je][fe];tt>he&&(he=tt,Ee=qe,Le=Ce)}}}Z[Q][Ee][Le][fe]+=U[Q][oe][pe][fe]}}}return{dataId:c.write(Y.toTypedArray(Z,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}}});function rFe(n){let{inputs:t,backend:e}=n,{dy:r,y:o}=t;zt([r,o],"eluGrad");let s=new Float32Array(Y.sizeFromShape(o.shape)),i=e.data.get(o.dataId).values,a=e.data.get(r.dataId).values;for(let u=0;u<i.length;++u){let c=i[u];c>=1?s[u]=a[u]:s[u]=a[u]*(c+1)}return e.makeTensorInfo(o.shape,"float32",s)}var Tae,Eae=D(()=>{"use strict";ve();Ln();Tae={kernelName:y1,backendName:"cpu",kernelFunc:rFe}});var oFe,SL,Nae,CL=D(()=>{"use strict";ve();yi();zi();oFe=Lr((n,t)=>n===t?1:0),SL=Xr(i0,oFe,null,"bool"),Nae={kernelName:i0,backendName:"cpu",kernelFunc:SL}});var sFe,iFe,aFe,uFe,cFe,lFe,pFe,kae,Dae=D(()=>{"use strict";ve();Zr();sFe=Re.ERF_P,iFe=Re.ERF_A1,aFe=Re.ERF_A2,uFe=Re.ERF_A3,cFe=Re.ERF_A4,lFe=Re.ERF_A5,pFe=Hn(Gh,n=>{let t=Math.sign(n),e=Math.abs(n),r=1/(1+sFe*e);return t*(1-((((lFe*r+cFe)*r+uFe)*r+aFe)*r+iFe)*r*Math.exp(-e*e))}),kae={kernelName:Gh,backendName:"cpu",kernelFunc:pFe}});function N2(n){let{inputs:t,backend:e,attrs:r}=n,{input:o}=t,{dim:s}=r,i=o.shape.length,a=o.shape.slice(),u=s;return s<0&&(Y.assert(-(i+1)<=s,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),u=i+s+1),a.splice(u,0,1),Ur({inputs:{x:o},backend:e,attrs:{shape:a}})}var Aae,AA=D(()=>{"use strict";ve();Qa();Aae={kernelName:sm,backendName:"cpu",kernelFunc:N2}});var hFe,u_,c_,l_=D(()=>{"use strict";ve();yi();zi();hFe=Lr((n,t)=>n/t),u_=Xr(Uh,hFe),c_={kernelName:Uh,backendName:"cpu",kernelFunc:u_}});function OA(n,t,e){let r=n.shape,o=r[0],s=r[1],i=e.data.get(n.dataId),a=i.complexTensorInfos.real,u=i.complexTensorInfos.imag,c=[o,s],h=Y.sizeFromShape(c),f=Y.getTypedArrayFromDType("float32",h),g=Y.getTypedArrayFromDType("float32",h);for(let y=0;y<o;y++){let v=Zl({inputs:{x:a},backend:e,attrs:{begin:[y,0],size:[1,s]}}),N=Zl({inputs:{x:u},backend:e,attrs:{begin:[y,0],size:[1,s]}}),T=Ni({inputs:{real:v,imag:N},backend:e}),{real:O,imag:S}=dFe(T,t,e),F=Re.mergeRealAndImagArrays(O,S);for(let R=0;R<s;R++){let L=Re.getComplexWithIndex(F,R);f[y*s+R]=L.real,g[y*s+R]=L.imag}e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(N),e.disposeIntermediateTensorInfo(T)}let d=e.makeTensorInfo(c,"float32",f),p=e.makeTensorInfo(c,"float32",g),m=Ni({inputs:{real:d,imag:p},backend:e});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),m}function dFe(n,t,e){let r=Y.sizeFromShape(n.shape),o=e.data.get(n.dataId),s=e.data.get(o.complexTensorInfos.real.dataId).values,i=e.data.get(o.complexTensorInfos.imag.dataId).values;if(fFe(r)){let a=IL(s,i,r,t,e),u=[n.shape[0],n.shape[1]];if(t){let c=e.makeTensorInfo(u,"float32",a.real),h=e.makeTensorInfo(u,"float32",a.imag),f=e.makeTensorInfo([],"float32",Y.createScalarValue(r,"float32")),g=Na({inputs:{x:f},backend:e}),d=c_.kernelFunc({inputs:{a:c,b:f},backend:e}),p=c_.kernelFunc({inputs:{a:h,b:g},backend:e}),m=e.data.get(d.dataId).values,y=e.data.get(p.dataId).values;return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),{real:m,imag:y}}return a}else{let a=Re.mergeRealAndImagArrays(s,i),u=mFe(a,r,t);return Re.splitRealAndImagArrays(u)}}function fFe(n){return(n&n-1)===0}function IL(n,t,e,r,o){if(e===1)return{real:n,imag:t};let s=Re.mergeRealAndImagArrays(n,t),i=e/2,a=Re.complexWithEvenIndex(s),u=a.real,c=a.imag,h=[u.length],f=o.makeTensorInfo(h,"float32",u),g=o.makeTensorInfo(h,"float32",c),d=Ni({inputs:{real:f,imag:g},backend:o}),p=Re.complexWithOddIndex(s),m=p.real,y=p.imag,v=[m.length],N=o.makeTensorInfo(v,"float32",m),T=o.makeTensorInfo(v,"float32",y),O=Ni({inputs:{real:N,imag:T},backend:o}),S=IL(u,c,i,r,o),F=S.real,R=S.imag,L=[F.length],q=o.makeTensorInfo(L,"float32",F),U=o.makeTensorInfo(L,"float32",R),Z=Ni({inputs:{real:q,imag:U},backend:o}),ee=IL(m,y,i,r,o),Q=ee.real,oe=ee.imag,se=[Q.length],pe=o.makeTensorInfo(se,"float32",Q),ae=o.makeTensorInfo(se,"float32",oe),fe=Ni({inputs:{real:pe,imag:ae},backend:o}),he=Re.exponents(e,r),Ee=[he.real.length],Le=o.makeTensorInfo(Ee,"float32",he.real),Ve=o.makeTensorInfo(Ee,"float32",he.imag),qe=Ni({inputs:{real:Le,imag:Ve},backend:o}),je=s_({inputs:{a:qe,b:fe},backend:o}),Ce=ug({inputs:{a:Z,b:je},backend:o}),tt=i_({inputs:{a:Z,b:je},backend:o}),ye=Hl({inputs:{input:Ce},backend:o}),z=Hl({inputs:{input:tt},backend:o}),M=sf({inputs:{input:Ce},backend:o}),W=sf({inputs:{input:tt},backend:o}),ce=sy({inputs:[ye,z],backend:o,attrs:{axis:0}}),J=sy({inputs:[M,W],backend:o,attrs:{axis:0}}),Ie=o.data.get(ce.dataId).values,Fe=o.data.get(J.dataId).values;return o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(g),o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(N),o.disposeIntermediateTensorInfo(T),o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo(q),o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(Z),o.disposeIntermediateTensorInfo(pe),o.disposeIntermediateTensorInfo(ae),o.disposeIntermediateTensorInfo(fe),o.disposeIntermediateTensorInfo(Le),o.disposeIntermediateTensorInfo(Ve),o.disposeIntermediateTensorInfo(qe),o.disposeIntermediateTensorInfo(je),o.disposeIntermediateTensorInfo(Ce),o.disposeIntermediateTensorInfo(tt),o.disposeIntermediateTensorInfo(ye),o.disposeIntermediateTensorInfo(M),o.disposeIntermediateTensorInfo(z),o.disposeIntermediateTensorInfo(W),o.disposeIntermediateTensorInfo(ce),o.disposeIntermediateTensorInfo(J),{real:Ie,imag:Fe}}function mFe(n,t,e){let r=new Float32Array(t*2);for(let o=0;o<t;o++){let s=0,i=0;for(let a=0;a<t;a++){let u=Re.exponent(o*a,t,e),c=Re.getComplexWithIndex(n,a);s+=c.real*u.real-c.imag*u.imag,i+=c.real*u.imag+c.imag*u.real}e&&(s/=t,i/=t),Re.assignToTypedArray(r,s,i,o)}return r}var _L=D(()=>{"use strict";ve();Rx();ag();DA();of();E2();C2();Ox();l_();ry();a_();});function gFe(n){let{inputs:t,backend:e}=n,{input:r}=t,o=Y.sizeFromShape(r.shape),s=r.shape[r.shape.length-1],i=o/s,a=Ur({inputs:{x:r},backend:e,attrs:{shape:[i,s]}}),u=OA(a,!1,e),c=Ur({inputs:{x:u},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(u),c}var Oae,Rae=D(()=>{"use strict";ve();_L();Qa();Oae={kernelName:x1,backendName:"cpu",kernelFunc:gFe}});function p_(n){let{backend:t,attrs:e}=n,{shape:r,value:o,dtype:s}=e,i=s||Y.inferDtype(o),a=Y.getArrayFromDType(i,Y.sizeFromShape(r));return yFe(a,o,i),t.makeTensorInfo(r,i,a)}function yFe(n,t,e){n.fill(t)}var Mae,RA=D(()=>{"use strict";ve();Mae={kernelName:b1,backendName:"cpu",kernelFunc:p_}});var Fae,Pae=D(()=>{"use strict";ve();Fae={kernelName:v1,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{image:r}=n,o=e,s=Y.getTypedArrayFromDType(r.dtype,Y.sizeFromShape(r.shape)),[i,a,u,c]=r.shape,h=o.data.get(r.dataId).values;for(let g=0;g<i;g++){let d=g*u*a*c;for(let p=0;p<a;p++){let m=p*(u*c);for(let y=0;y<u;y++){let v=y*c;for(let N=0;N<c;N++){let O=[i,p,y,N][2],S=Math.round(u-O),F=d+m+v+N,R=h[F];if(S>=0&&S<u){let L=S*c,q=d+m+L+N;R=h[q]}s[F]=R}}}}return{dataId:o.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}}});var xFe,bFe,$ae,Lae=D(()=>{"use strict";ve();yi();zi();xFe=Lr((n,t)=>Math.floor(n/t)),bFe=Xr(Xh,xFe,null,"int32"),$ae={kernelName:Xh,backendName:"cpu",kernelFunc:bFe}});function vFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:s,bias:i,preluActivationWeights:a}=t,{strides:u,pad:c,dataFormat:h,dilations:f,dimRoundingMode:g,activation:d,leakyreluAlpha:p}=r,m=xL({inputs:{x:o,filter:s},backend:e,attrs:{strides:u,pad:c,dataFormat:h,dilations:f,dimRoundingMode:g}});if(i){let y=m;m=ug({inputs:{a:m,b:i},backend:e}),e.disposeIntermediateTensorInfo(y)}if(d){let y=m;m=_2(e,m,d,a,p),e.disposeIntermediateTensorInfo(y)}return m}var Bae,zae=D(()=>{"use strict";ve();EA();Rx();bL();Bae={kernelName:m0,backendName:"cpu",kernelFunc:vFe}});function wFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:s,bias:i,preluActivationWeights:a}=t,{strides:u,pad:c,dataFormat:h,dilations:f,dimRoundingMode:g,activation:d,leakyreluAlpha:p}=r,m=vL({inputs:{x:o,filter:s},backend:e,attrs:{strides:u,pad:c,dataFormat:h,dilations:f,dimRoundingMode:g}});if(i){let y=m;m=ug({inputs:{a:m,b:i},backend:e}),e.disposeIntermediateTensorInfo(y)}if(d){let y=m;m=_2(e,m,d,a,p),e.disposeIntermediateTensorInfo(y)}return m}var Vae,jae=D(()=>{"use strict";ve();EA();Rx();wL();Vae={kernelName:g0,backendName:"cpu",kernelFunc:wFe}});function SFe(n){let{inputs:t,backend:e}=n,{params:r,indices:o}=t,s=Y.sizeFromShape(r.shape),i=o.shape,a=i[i.length-1],[u,c,h,f]=Re.prepareAndValidate(r,o);if(c===0)return e.makeTensorInfo(u,r.dtype,[]);let g=Rn([c,h],r.dtype),d=e.data.get(o.dataId).values,p=e.data.get(r.dataId).values;for(let m=0;m<c;m++){let y=[],v=0;for(let N=0;N<a;N++){let T=d[m*a+N];v+=T*f[N],y.push(T)}if(v<0||v>=s/h)throw new Error(`Invalid indices: ${y} does not index into ${r.shape}`);for(let N=0;N<h;N++)g.values[m*h+N]=p[v*h+N]}return e.makeTensorInfo(u,g.dtype,g.values)}var Uae,qae=D(()=>{"use strict";ve();Uae={kernelName:w1,backendName:"cpu",kernelFunc:SFe}});function CFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,indices:s}=t,{axis:i,batchDims:a}=r;zt([o,s],"gatherV2");let u=a;a==null&&(u=0);let c=Y.sizeFromShape(s.shape),h=Y.parseAxisParam(i,o.shape)[0],f=Re.segment_util.collectGatherOpShapeInfo(o,s,h,u),g=Ur({inputs:{x:o},backend:e,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),d=Ur({inputs:{x:s},backend:e,attrs:{shape:[f.batchSize,c/f.batchSize]}}),p=[f.batchSize,f.outerSize,c/f.batchSize,f.sliceSize],m=e.bufferSync(d),y=e.bufferSync(g),v=xA(y,m,p);return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(d),e.makeTensorInfo(f.outputShape,v.dtype,v.values)}var Gae,Wae=D(()=>{"use strict";ve();Ln();N8();Qa();Gae={kernelName:am,backendName:"cpu",kernelFunc:CFe}});var IFe,_Fe,Hae,Kae=D(()=>{"use strict";ve();yi();zi();IFe=Lr((n,t)=>n>=t?1:0),_Fe=Xr(Yh,IFe,null,"bool"),Hae={kernelName:Yh,backendName:"cpu",kernelFunc:_Fe}});function TFe(n){let{inputs:t,backend:e}=n,{input:r}=t,o=Y.sizeFromShape(r.shape),s=r.shape[r.shape.length-1],i=o/s,a=Ur({inputs:{x:r},backend:e,attrs:{shape:[i,s]}}),u=OA(a,!0,e),c=Ur({inputs:{x:u},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(u),c}var Xae,Yae=D(()=>{"use strict";ve();_L();Qa();Xae={kernelName:S1,backendName:"cpu",kernelFunc:TFe}});var EFe,Qae,Zae=D(()=>{"use strict";ve();Zr();EFe=Hn(Qh,n=>Number.isFinite(n)?1:0,"bool"),Qae={kernelName:Qh,backendName:"cpu",kernelFunc:EFe}});var NFe,Jae,eue=D(()=>{"use strict";ve();Zr();NFe=Hn(Zh,n=>Math.abs(n)===1/0?1:0,"bool"),Jae={kernelName:Zh,backendName:"cpu",kernelFunc:NFe}});var kFe,tue,nue=D(()=>{"use strict";ve();Zr();kFe=Hn(Jh,n=>Number.isNaN(n)?1:0,"bool"),tue={kernelName:Jh,backendName:"cpu",kernelFunc:kFe}});var DFe,AFe,rue,oue=D(()=>{"use strict";ve();yi();zi();DFe=Lr((n,t)=>n<=t?1:0),AFe=Xr(c0,DFe,null,"bool"),rue={kernelName:c0,backendName:"cpu",kernelFunc:AFe}});function OFe(n){let{backend:t,attrs:e}=n,{start:r,stop:o,num:s}=e,i=bA(r,o,s);return t.makeTensorInfo([i.length],"float32",i)}var sue,iue=D(()=>{"use strict";ve();R8();sue={kernelName:I1,backendName:"cpu",kernelFunc:OFe}});var RFe,aue,uue=D(()=>{"use strict";ve();Zr();RFe=Hn(td,n=>Math.log1p(n)),aue={kernelName:td,backendName:"cpu",kernelFunc:RFe}});var MFe,FFe,cue,lue=D(()=>{"use strict";ve();yi();zi();MFe=Lr((n,t)=>n&&t),FFe=Xr(l0,MFe,null,"bool"),cue={kernelName:l0,backendName:"cpu",kernelFunc:FFe}});var PFe,pue,hue=D(()=>{"use strict";ve();Zr();PFe=Hn(p0,n=>n?0:1,"bool"),pue={kernelName:p0,backendName:"cpu",kernelFunc:PFe}});var $Fe,LFe,due,fue=D(()=>{"use strict";ve();yi();zi();$Fe=Lr((n,t)=>n||t),LFe=Xr(h0,$Fe,null,"bool"),due={kernelName:h0,backendName:"cpu",kernelFunc:LFe}});function BFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{depthRadius:s,bias:i,alpha:a,beta:u}=r;zt(o,"LRN");let c=o.shape[3],h=c-1,f=e.data.get(o.dataId).values,g=Y.sizeFromShape(o.shape),d=new Float32Array(g);function p(m){let y=m%c,v=m-y+Math.max(0,y-s),N=m-y+Math.min(y+s,h),T=0;for(;v<=N;v++){let O=f[v];T+=O*O}return T}for(let m=0;m<g;m++){let y=p(m),v=f[m]*Math.pow(i+a*y,-u);d[m]=v}return e.makeTensorInfo(o.shape,o.dtype,d)}var mue,gue=D(()=>{"use strict";ve();Ln();mue={kernelName:lm,backendName:"cpu",kernelFunc:BFe}});function zFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,y:s,dy:i}=t,{depthRadius:a,bias:u,alpha:c,beta:h}=r;zt(i,"LRNGrad");let f=Y.sizeFromShape(i.shape),g=i.shape[3],d=e.data.get(i.dataId).values,p=e.data.get(o.dataId).values,m=e.data.get(s.dataId).values,y=new Float32Array(f),v=f;for(let N=0;N<v;N++){let T=N%g,O=N-T+Math.max(0,T-a),S=N-T+Math.min(g,T+a+1),F=0;for(let R=O;R<S;R++)F+=Math.pow(p[R],2);F=c*F+u;for(let R=O;R<S;R++){let L=-2*c*h*p[R]*m[N]/F;N===R&&(L+=Math.pow(F,-h)),L*=d[N],y[R]+=L}}return e.makeTensorInfo(i.shape,o.dtype,y)}var yue,xue=D(()=>{"use strict";ve();Ln();yue={kernelName:_1,backendName:"cpu",kernelFunc:zFe}});function TL(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reductionIndices:s,keepDims:i}=r,a=e,u=o.shape,c=u.length,h=Y.parseAxisParam(s,u),f=h,g=Re.getAxesPermutation(f,c),d=a.data.get(o.dataId).values;if(g!=null){let O=new Array(c);for(let S=0;S<O.length;S++)O[S]=u[g[S]];d=I2(d,u,o.dtype,g,O),f=Re.getInnerMostAxes(f.length,c),u=O}zt(o,"max"),Re.assertAxesAreInnerMostDims("max",f,c);let[p,m]=Re.computeOutAndReduceShapes(u,f),y=Y.sizeFromShape(m),v=vA(d,y,p,o.dtype),N=a.write(v,p,o.dtype),T=p;return i&&(T=Re.expandShapeToKeepDim(p,h)),{dataId:N,shape:T,dtype:o.dtype}}var bue,EL=D(()=>{"use strict";ve();ve();ve();Ln();P8();wA();bue={kernelName:pm,backendName:"cpu",kernelFunc:TL}});function VFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t;zt(o,"maxPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:u}=r,c=1;Y.assert(Re.eitherStridesOrDilationsAreOne(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let h=Re.computePool2DInfo(o.shape,s,i,c,a,u),f;if(h.filterWidth===1&&h.filterHeight===1&&Y.arraysEqual(h.inShape,h.outShape))f=Na({inputs:{x:o},backend:e});else{let g=e.data.get(o.dataId).values,d=Y.computeStrides(o.shape),p=T2(g,o.shape,o.dtype,d,h,"max");f=e.makeTensorInfo(h.outShape,o.dtype,p.values)}return f}var vue,wue=D(()=>{"use strict";ve();Ln();oy();of();vue={kernelName:hm,backendName:"cpu",kernelFunc:VFe}});function jFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:s,strides:i,pad:a,dimRoundingMode:u,dataFormat:c,dilations:h}=r;zt(o,"maxPool3d");let f=h;f==null&&(f=[1,1,1]);let g=Re.computePool3DInfo(o.shape,s,i,f,a,u,c),d=e.data.get(o.dataId).values,p=kA(d,o.shape,o.dtype,Y.computeStrides(o.shape),g,"max");return e.makeTensorInfo(p.shape,"float32",p.values)}var Sue,Cue=D(()=>{"use strict";ve();Ln();oy();Sue={kernelName:dm,backendName:"cpu",kernelFunc:jFe}});function UFe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:s}=t,{filterSize:i,strides:a,pad:u,dilations:c,dimRoundingMode:h}=r;zt([o,s],"maxPool3DGrad");let f=Re.computePool3DInfo(s.shape,i,a,c,u,h),g=e.bufferSync(s),d=Cie(g,f),p=f.strideDepth,m=f.strideHeight,y=f.strideWidth,v=f.dilationDepth,N=f.dilationHeight,T=f.dilationWidth,O=f.effectiveFilterDepth,S=f.effectiveFilterHeight,F=f.effectiveFilterWidth,R=O-1-f.padInfo.front,L=F-1-f.padInfo.left,q=S-1-f.padInfo.top,U=Rn(s.shape,"float32"),Z=e.bufferSync(o);for(let ee=0;ee<f.batchSize;++ee)for(let Q=0;Q<f.inChannels;++Q)for(let oe=0;oe<f.inDepth;++oe)for(let se=0;se<f.inHeight;++se)for(let pe=0;pe<f.inWidth;++pe){let ae=oe-R,fe=se-q,he=pe-L,Ee=0;for(let Le=0;Le<O;Le+=v){let Ve=(ae+Le)/p;if(!(Ve<0||Ve>=f.outDepth||Math.floor(Ve)!==Ve))for(let qe=0;qe<S;qe+=N){let je=(fe+qe)/m;if(!(je<0||je>=f.outHeight||Math.floor(je)!==je))for(let Ce=0;Ce<F;Ce+=T){let tt=(he+Ce)/y;if(tt<0||tt>=f.outWidth||Math.floor(tt)!==tt)continue;let ye=O*S*F-1-d.get(ee,Ve,je,tt,Q),z=Le*S*F+qe*F+Ce,M=ye===z?1:0;if(M===0)continue;let W=Z.get(ee,Ve,je,tt,Q);Ee+=W*M}}}U.set(Ee,ee,oe,se,pe,Q)}return e.makeTensorInfo(U.shape,U.dtype,U.values)}var Iue,_ue=D(()=>{"use strict";ve();Ln();oy();Iue={kernelName:E1,backendName:"cpu",kernelFunc:UFe}});function qFe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:s,output:i}=t,a=s;zt([s,i],"maxPoolGrad");let{filterSize:u,strides:c,pad:h,dimRoundingMode:f}=r,g=Re.computePool2DInfo(a.shape,u,c,1,h,f),d=e.data.get(a.dataId).values,p=Rn(g.outShape,a.dtype,NA(d,a.shape,a.dtype,g).values),m=g.strideHeight,y=g.strideWidth,v=g.dilationHeight,N=g.dilationWidth,T=g.effectiveFilterHeight,O=g.effectiveFilterWidth,S=O-1-g.padInfo.left,F=T-1-g.padInfo.top,R=Rn(a.shape,"float32"),L=e.data.get(o.dataId).values,q=Rn(o.shape,"float32",L);for(let U=0;U<g.batchSize;++U)for(let Z=0;Z<g.inChannels;++Z)for(let ee=0;ee<g.inHeight;++ee)for(let Q=0;Q<g.inWidth;++Q){let oe=ee-F,se=Q-S,pe=0;for(let ae=0;ae<T;ae+=v){let fe=(oe+ae)/m;if(!(fe<0||fe>=g.outHeight||Math.floor(fe)!==fe))for(let he=0;he<O;he+=N){let Ee=(se+he)/y;if(Ee<0||Ee>=g.outWidth||Math.floor(Ee)!==Ee)continue;let Le=T*O-1-p.get(U,fe,Ee,Z),Ve=ae*O+he,qe=Le===Ve?1:0;if(qe===0)continue;let je=q.get(U,fe,Ee,Z);pe+=je*qe}}R.set(pe,U,ee,Q,Z)}return e.makeTensorInfo(R.shape,R.dtype,R.values)}var Tue,Eue=D(()=>{"use strict";ve();Ln();oy();Tue={kernelName:T1,backendName:"cpu",kernelFunc:qFe}});function Nue(n,t,e,r,o){let s=Y.computeStrides(t),i=T2(n,t,e,s,o,"max"),a=NA(n,t,e,o,!0,r);return[i.values,a.values]}var kue=D(()=>{"use strict";ve();oy();});var Due,Aue=D(()=>{"use strict";ve();ve();Ln();kue();Due={kernelName:N1,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{x:r}=n,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=t,u=e;zt(r,"MaxPoolWithArgmax");let c=u.data.get(r.dataId).values,h=Re.computePool2DInfo(r.shape,o,s,[1,1],i),[f,g]=Nue(c,r.shape,r.dtype,a,h),d=u.write(f,h.outShape,r.dtype),p=u.write(g,h.outShape,r.dtype);return[{dataId:d,shape:h.outShape,dtype:r.dtype},{dataId:p,shape:h.outShape,dtype:"int32"}]}}});function Fx(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,keepDims:i}=r;zt(o,"sum");let a;o.dtype==="bool"?a=Kl({inputs:{x:o},backend:e,attrs:{dtype:"int32"}}):a=Na({inputs:{x:o},backend:e});let u=a.shape.length,c=Y.parseAxisParam(s,a.shape),h=Re.getAxesPermutation(c,u),f=c,g=a;h!=null&&(g=xi({inputs:{x:a},backend:e,attrs:{perm:h}}),f=Re.getInnerMostAxes(f.length,u)),Re.assertAxesAreInnerMostDims("sum",f,g.shape.length);let[d,p]=Re.computeOutAndReduceShapes(g.shape,f),m=Re.upcastType(g.dtype,"int32"),y=b2(e,d,m),v=Y.sizeFromShape(p),N=e.data.get(y.dataId).values,T=e.data.get(g.dataId).values;for(let O=0;O<N.length;++O){let S=O*v,F=0;for(let R=0;R<v;++R)F+=T[S+R];N[O]=F}if(i){let O=Re.expandShapeToKeepDim(y.shape,c),S=y;y=Ur({inputs:{x:y},backend:e,attrs:{shape:O}}),e.disposeIntermediateTensorInfo(S)}return e.disposeIntermediateTensorInfo(a),h!=null&&e.disposeIntermediateTensorInfo(g),y}var Oue,h_=D(()=>{"use strict";ve();Ln();y8();v2();of();Qa();Ql();Oue={kernelName:km,backendName:"cpu",kernelFunc:Fx}});function GFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,keepDims:i}=r,a=Y.parseAxisParam(s,o.shape),c=Re.computeOutAndReduceShapes(o.shape,a)[1],h=Y.sizeFromShape(c),f=[],g=e.makeTensorInfo([],"float32",new Float32Array([h]));f.push(g);let d=Kl({inputs:{x:o},backend:e,attrs:{dtype:"float32"}});f.push(d);let p=u_({inputs:{a:d,b:g},backend:e});f.push(p);let m=Fx({inputs:{x:p},backend:e,attrs:{axis:s,keepDims:i}});return f.forEach(y=>e.disposeIntermediateTensorInfo(y)),m}var Rue,Mue=D(()=>{"use strict";ve();v2();l_();h_();Rue={kernelName:fm,backendName:"cpu",kernelFunc:GFe}});function WFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,keepDims:i}=r;zt(o,"min");let a=Y.parseAxisParam(s,o.shape),u=a,c=Re.getAxesPermutation(u,o.shape.length),h=o;c!=null&&(h=xi({inputs:{x:o},backend:e,attrs:{perm:c}}),u=Re.getInnerMostAxes(u.length,o.shape.length)),Re.assertAxesAreInnerMostDims("min",u,h.shape.length);let[f,g]=Re.computeOutAndReduceShapes(h.shape,u),d=Y.sizeFromShape(g),p=Y.makeZerosTypedArray(Y.sizeFromShape(f),h.dtype),m=e.data.get(h.dataId).values;for(let v=0;v<p.length;++v){let N=v*d,T=m[N];for(let O=0;O<d;++O){let S=m[N+O];S<T&&(T=S)}p[v]=T}c!=null&&e.disposeIntermediateTensorInfo(h);let y=e.makeTensorInfo(f,h.dtype,p);if(i){let v=Re.expandShapeToKeepDim(f,a),N=Ur({inputs:{x:y},backend:e,attrs:{shape:v}});return e.disposeIntermediateTensorInfo(y),N}return y}var Fue,Pue=D(()=>{"use strict";ve();Ln();Qa();Ql();Fue={kernelName:mm,backendName:"cpu",kernelFunc:WFe}});function HFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{paddings:s,mode:i}=r;zt(o,"mirrorPad");let a=s.map((T,O)=>T[0]+o.shape[O]+T[1]),u=s.map(T=>T[0]),c=s.map((T,O)=>T[0]+o.shape[O]),h=i==="reflect"?0:1,f=e.data.get(o.dataId).values,g=o.shape.length,d=Y.computeStrides(o.shape),p=Y.sizeFromShape(a),m=a.length,y=Y.computeStrides(a),v=Y.getTypedArrayFromDType(o.dtype,p);for(let T=0;T<p;T++){let O=Y.indexToLoc(T,m,y);for(let F=0;F<m;F++)O[F]<u[F]?O[F]=u[F]*2-O[F]-h:O[F]>=c[F]&&(O[F]=(c[F]-1)*2-O[F]+h);O=O.map((F,R)=>F-u[R]);let S=Y.locToIndex(O,g,d);v[T]=f[S]}return{dataId:e.write(v,a,o.dtype),shape:a,dtype:o.dtype}}var $ue,Lue=D(()=>{"use strict";ve();Ln();$ue={kernelName:gm,backendName:"cpu",kernelFunc:HFe}});var KFe,XFe,Bue,zue=D(()=>{"use strict";ve();yi();zi();KFe=Lr((n,t)=>{let e=n%t;return n<0&&t<0||n>=0&&t>=0?e:(e+t)%t}),XFe=Xr(od,KFe),Bue={kernelName:od,backendName:"cpu",kernelFunc:XFe}});var jue=uo((Vue,NL)=>{"use strict";(function(n,t,e){function r(a){var u=this,c=i();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(a),u.s0<0&&(u.s0+=1),u.s1-=c(a),u.s1<0&&(u.s1+=1),u.s2-=c(a),u.s2<0&&(u.s2+=1),c=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function s(a,u){var c=new r(a),h=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&o(h,c),f.state=function(){return o(c,{})}),f}function i(){var a=4022871197,u=function(c){c=c.toString();for(var h=0;h<c.length;h++){a+=c.charCodeAt(h);var f=.02519603282416938*a;a=f>>>0,f-=a,f*=a,a=f>>>0,f-=a,a+=f*4294967296}return(a>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.alea=s})(Vue,typeof NL=="object"&&NL,typeof define=="function"&&define)});var que=uo((Uue,kL)=>{"use strict";(function(n,t,e){function r(i){var a=this,u="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var h=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^h^h>>>8},i===(i|0)?a.x=i:u+=i;for(var c=0;c<u.length+64;c++)a.x^=u.charCodeAt(c)|0,a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a}function s(i,a){var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xor128=s})(Uue,typeof kL=="object"&&kL,typeof define=="function"&&define)});var Wue=uo((Gue,DL)=>{"use strict";(function(n,t,e){function r(i){var a=this,u="";a.next=function(){var h=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(h^h<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,i===(i|0)?a.x=i:u+=i;for(var c=0;c<u.length+64;c++)a.x^=u.charCodeAt(c)|0,c==u.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a.v=i.v,a.d=i.d,a}function s(i,a){var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xorwow=s})(Gue,typeof DL=="object"&&DL,typeof define=="function"&&define)});var Kue=uo((Hue,AL)=>{"use strict";(function(n,t,e){function r(i){var a=this;a.next=function(){var c=a.x,h=a.i,f,g,d;return f=c[h],f^=f>>>7,g=f^f<<24,f=c[h+1&7],g^=f^f>>>10,f=c[h+3&7],g^=f^f>>>3,f=c[h+4&7],g^=f^f<<7,f=c[h+7&7],f=f^f<<13,g^=f^f<<9,c[h]=g,a.i=h+1&7,g};function u(c,h){var f,g,d=[];if(h===(h|0))g=d[0]=h;else for(h=""+h,f=0;f<h.length;++f)d[f&7]=d[f&7]<<15^h.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?g=d[7]=-1:g=d[f],c.x=d,c.i=0,f=256;f>0;--f)c.next()}u(a,i)}function o(i,a){return a.x=i.x.slice(),a.i=i.i,a}function s(i,a){i==null&&(i=+new Date);var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(c.x&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xorshift7=s})(Hue,typeof AL=="object"&&AL,typeof define=="function"&&define)});var Yue=uo((Xue,OL)=>{"use strict";(function(n,t,e){function r(i){var a=this;a.next=function(){var c=a.w,h=a.X,f=a.i,g,d;return a.w=c=c+1640531527|0,d=h[f+34&127],g=h[f=f+1&127],d^=d<<13,g^=g<<17,d^=d>>>15,g^=g>>>12,d=h[f]=d^g,a.i=f,d+(c^c>>>16)|0};function u(c,h){var f,g,d,p,m,y=[],v=128;for(h===(h|0)?(g=h,h=null):(h=h+"\0",g=0,v=Math.max(v,h.length)),d=0,p=-32;p<v;++p)h&&(g^=h.charCodeAt((p+32)%h.length)),p===0&&(m=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,p>=0&&(m=m+1640531527|0,f=y[p&127]^=g+m,d=f==0?d+1:0);for(d>=128&&(y[(h&&h.length||0)&127]=-1),d=127,p=4*128;p>0;--p)g=y[d+34&127],f=y[d=d+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,y[d]=g^f;c.w=m,c.X=y,c.i=d}u(a,i)}function o(i,a){return a.i=i.i,a.w=i.w,a.X=i.X.slice(),a}function s(i,a){i==null&&(i=+new Date);var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(c.X&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.xor4096=s})(Xue,typeof OL=="object"&&OL,typeof define=="function"&&define)});var Zue=uo((Que,RL)=>{"use strict";(function(n,t,e){function r(i){var a=this,u="";a.next=function(){var h=a.b,f=a.c,g=a.d,d=a.a;return h=h<<25^h>>>7^f,f=f-g|0,g=g<<24^g>>>8^d,d=d-h|0,a.b=h=h<<20^h>>>12^f,a.c=f=f-g|0,a.d=g<<16^f>>>16^d,a.a=d-h|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,i===Math.floor(i)?(a.a=i/4294967296|0,a.b=i|0):u+=i;for(var c=0;c<u.length+20;c++)a.b^=u.charCodeAt(c)|0,a.next()}function o(i,a){return a.a=i.a,a.b=i.b,a.c=i.c,a.d=i.d,a}function s(i,a){var u=new r(i),c=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(f+g)/(1<<21);while(d===0);return d},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&o(c,u),h.state=function(){return o(u,{})}),h}t&&t.exports?t.exports=s:e&&e.amd?e(function(){return s}):this.tychei=s})(Que,typeof RL=="object"&&RL,typeof define=="function"&&define)});var Jue=uo((Atn,MA)=>{"use strict";(function(n,t){var e=this,r=256,o=6,s=52,i="random",a=t.pow(r,o),u=t.pow(2,s),c=u*2,h=r-1,f;function g(T,O,S){var F=[];O=O==!0?{entropy:!0}:O||{};var R=y(m(O.entropy?[T,N(n)]:T??v(),3),F),L=new d(F),q=function(){for(var U=L.g(o),Z=a,ee=0;U<u;)U=(U+ee)*r,Z*=r,ee=L.g(1);for(;U>=c;)U/=2,Z/=2,ee>>>=1;return(U+ee)/Z};return q.int32=function(){return L.g(4)|0},q.quick=function(){return L.g(4)/4294967296},q.double=q,y(N(L.S),n),(O.pass||S||function(U,Z,ee,Q){return Q&&(Q.S&&p(Q,L),U.state=function(){return p(L,{})}),ee?(t[i]=U,Z):U})(q,R,"global"in O?O.global:this==t,O.state)}t["seed"+i]=g;function d(T){var O,S=T.length,F=this,R=0,L=F.i=F.j=0,q=F.S=[];for(S||(T=[S++]);R<r;)q[R]=R++;for(R=0;R<r;R++)q[R]=q[L=h&L+T[R%S]+(O=q[R])],q[L]=O;(F.g=function(U){for(var Z,ee=0,Q=F.i,oe=F.j,se=F.S;U--;)Z=se[Q=h&Q+1],ee=ee*r+se[h&(se[Q]=se[oe=h&oe+Z])+(se[oe]=Z)];return F.i=Q,F.j=oe,ee})(r)}function p(T,O){return O.i=T.i,O.j=T.j,O.S=T.S.slice(),O}function m(T,O){var S=[],F=typeof T,R;if(O&&F=="object")for(R in T)try{S.push(m(T[R],O-1))}catch{}return S.length?S:F=="string"?T:T+"\0"}function y(T,O){for(var S=T+"",F,R=0;R<S.length;)O[h&R]=h&(F^=O[h&R]*19)+S.charCodeAt(R++);return N(O)}function v(){try{var T;return f&&(T=f.randomBytes)?T=T(r):(T=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(T)),N(T)}catch{var O=e.navigator,S=O&&O.plugins;return[+new Date,e,S,e.screen,N(n)]}}function N(T){return String.fromCharCode.apply(0,T)}if(y(t.random(),n),typeof MA=="object"&&MA.exports){MA.exports=g;try{f=tk()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return g})})([],Math)});var tce=uo((Otn,ece)=>{"use strict";var YFe=jue(),QFe=que(),ZFe=Wue(),JFe=Kue(),ePe=Yue(),tPe=Zue(),Px=Jue();Px.alea=YFe;Px.xor128=QFe;Px.xorwow=ZFe;Px.xorshift7=JFe;Px.xor4096=ePe;Px.tychei=tPe;ece.exports=Px});function ML(n){let{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{dim:s}=r,i=o.shape.length,a=s;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);let u=Y.parseAxisParam([a],o.shape),c=TL({inputs:{x:o},backend:e,attrs:{reductionIndices:u,keepDims:!1}}),h=Re.expandShapeToKeepDim(c.shape,u),f=Ur({inputs:{x:c},backend:e,attrs:{shape:h}}),g=i_({inputs:{a:o,b:f},backend:e}),d=C8({inputs:{x:g},backend:e}),p=Fx({inputs:{x:d},backend:e,attrs:{axis:u,keepDims:!1}}),m=Ur({inputs:{x:p},backend:e,attrs:{shape:h}}),y=u_({inputs:{a:d,b:m},backend:e});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),y}var nce,FL=D(()=>{"use strict";ve();yA();EL();l_();Qa();a_();h_();nce={kernelName:Om,backendName:"cpu",kernelFunc:ML}});function nPe(n){let{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{numSamples:s,seed:i,normalized:a}=r;zt(o,"multinomial");let u=a?o:ML({inputs:{logits:o},backend:e,attrs:{dim:-1}}),c=u.shape[0],h=u.shape[1],f=e.data.get(u.dataId).values,g=[c,s],d=Y.makeZerosTypedArray(Y.sizeFromShape(g),"int32");for(let p=0;p<c;++p){let m=p*h,y=new Float32Array(h-1);y[0]=f[m];for(let T=1;T<y.length;++T)y[T]=y[T-1]+f[m+T];let v=rce.alea(i.toString()),N=p*s;for(let T=0;T<s;++T){let O=v();d[N+T]=y.length;for(let S=0;S<y.length;S++)if(O<y[S]){d[N+T]=S;break}}}return a||e.disposeIntermediateTensorInfo(u),e.makeTensorInfo(g,"int32",d)}var rce,oce,sce=D(()=>{"use strict";ve();rce=kS(tce());Ln();FL();oce={kernelName:k1,backendName:"cpu",kernelFunc:nPe}});function oPe(n){let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:s}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u}=r;zt(o,"NonMaxSuppression");let c=e.data.get(o.dataId).values,h=e.data.get(s.dataId).values,{selectedIndices:f}=rPe(c,h,i,a,u);return e.makeTensorInfo([f.length],"int32",new Int32Array(f))}var rPe,ice,ace=D(()=>{"use strict";ve();Ln();rPe=oa.nonMaxSuppressionV3Impl;ice={kernelName:D1,backendName:"cpu",kernelFunc:oPe}});function iPe(n){let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:s}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:c}=r;zt(o,"NonMaxSuppressionPadded");let h=e.data.get(o.dataId).values,f=e.data.get(s.dataId).values,{selectedIndices:g,validOutputs:d}=sPe(h,f,i,a,u,c);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([],"int32",new Int32Array([d]))]}var sPe,uce,cce=D(()=>{"use strict";ve();Ln();sPe=oa.nonMaxSuppressionV4Impl;uce={kernelName:A1,backendName:"cpu",kernelFunc:iPe}});function uPe(n){let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:s}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u,softNmsSigma:c}=r;zt(o,"NonMaxSuppressionWithScore");let h=e.data.get(o.dataId).values,f=e.data.get(s.dataId).values,g=i,d=a,p=u,m=c,{selectedIndices:y,selectedScores:v}=aPe(h,f,g,d,p,m);return[e.makeTensorInfo([y.length],"int32",new Int32Array(y)),e.makeTensorInfo([v.length],"float32",new Float32Array(v))]}var aPe,lce,pce=D(()=>{"use strict";ve();Ln();aPe=oa.nonMaxSuppressionV5Impl;lce={kernelName:O1,backendName:"cpu",kernelFunc:uPe}});function cPe(n){let{inputs:t,backend:e,attrs:r}=n,{indices:o}=t,{depth:s,onValue:i,offValue:a}=r;zt(o,"oneHot");let u=Y.sizeFromShape(o.shape),c=new Float32Array(u*s);c.fill(a);let h=e.data.get(o.dataId).values;for(let f=0;f<u;++f)h[f]>=0&&h[f]<s&&(c[f*s+h[f]]=i);return e.makeTensorInfo([...o.shape,s],"int32",c)}var hce,dce=D(()=>{"use strict";ve();Ln();hce={kernelName:bm,backendName:"cpu",kernelFunc:cPe}});function d_(n){let{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){let o=Hl({inputs:{input:r},backend:e}),s=d_({inputs:{x:o},backend:e}),i=sf({inputs:{input:r},backend:e}),a=d_({inputs:{x:i},backend:e}),u=Ni({inputs:{real:s,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(a),u}else return p_({backend:e,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var fce,PL=D(()=>{"use strict";ve();ag();RA();E2();Ox();fce={kernelName:Pm,backendName:"cpu",kernelFunc:d_}});function mce(n){let{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){let o=Hl({inputs:{input:r},backend:e}),s=mce({inputs:{x:o},backend:e}),i=sf({inputs:{input:r},backend:e}),a=d_({inputs:{x:i},backend:e}),u=Ni({inputs:{real:s,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(a),u}else return p_({backend:e,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var gce,yce=D(()=>{"use strict";ve();ag();RA();E2();Ox();PL();gce={kernelName:xm,backendName:"cpu",kernelFunc:mce}});function $L(n){let{inputs:t,backend:e,attrs:r}=n,{axis:o}=r;if(t.length===1)return N2({inputs:{input:t[0]},backend:e,attrs:{dim:o}});let s=t[0].shape,i=t[0].dtype;t.forEach(h=>{Y.assertShapesMatch(s,h.shape,"All tensors passed to stack must have matching shapes"),Y.assert(i===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],u=t.map(h=>{let f=N2({inputs:{input:h},backend:e,attrs:{dim:o}});return a.push(f),f}),c=sy({inputs:u,backend:e,attrs:{axis:o}});return a.forEach(h=>e.disposeIntermediateTensorInfo(h)),c}var xce,LL=D(()=>{"use strict";ve();DA();AA();xce={kernelName:vm,backendName:"cpu",kernelFunc:$L}});function lPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{paddings:s,constantValue:i}=r;zt(o,"pad");let a=s.map((N,T)=>N[0]+o.shape[T]+N[1]),u=s.map(N=>N[0]),c=e.data.get(o.dataId).values,h=Y.sizeFromShape(o.shape),f=o.shape.length,g=Y.computeStrides(o.shape),d=Y.sizeFromShape(a),p=a.length,m=Y.computeStrides(a),y=Y.getTypedArrayFromDType(o.dtype,d);i!==0&&y.fill(i);for(let N=0;N<h;N++){let O=Y.indexToLoc(N,f,g).map((F,R)=>F+u[R]),S=Y.locToIndex(O,p,m);y[S]=c[N]}return{dataId:e.write(y,a,o.dtype),shape:a,dtype:o.dtype}}var FA,BL=D(()=>{"use strict";ve();Ln();FA={kernelName:wm,backendName:"cpu",kernelFunc:lPe}});var pPe,hPe,bce,vce=D(()=>{"use strict";ve();yi();zi();pPe=Lr((n,t)=>Math.pow(n,t)),hPe=Xr(id,pPe),bce={kernelName:id,backendName:"cpu",kernelFunc:hPe}});function dPe(n){let{backend:t,attrs:e}=n,{start:r,stop:o,dtype:s,step:i}=e,a=SA(r,o,i,s);return t.makeTensorInfo([a.length],s,a)}var wce,Sce=D(()=>{"use strict";ve();H8();wce={kernelName:M1,backendName:"cpu",kernelFunc:dPe}});var fPe,Cce,Ice=D(()=>{"use strict";ve();Zr();fPe=Hn(ad,n=>1/n),Cce={kernelName:ad,backendName:"cpu",kernelFunc:fPe}});function mPe(n){let{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:s,halfPixelCenters:i,size:a}=r;zt(o,"resizeBilinear");let u=Y.computeStrides(o.shape),[c,h]=a,[f,g,d,p]=o.shape,m=e.data.get(o.dataId).values,y=new Float32Array(Y.sizeFromShape([f,c,h,p])),v=[s&&c>1?g-1:g,s&&h>1?d-1:d],N=[s&&c>1?c-1:c,s&&h>1?h-1:h],T=0,O=v[0]/N[0],S=v[1]/N[1];for(let F=0;F<f;F++)for(let R=0;R<c;R++){let L;i?L=O*(R+.5)-.5:L=O*R;let q=Math.max(0,Math.floor(L)),U=L-q,Z=Math.min(g-1,Math.ceil(L)),ee=F*u[0]+q*u[1],Q=F*u[0]+Z*u[1];for(let oe=0;oe<h;oe++){let se;i?se=S*(oe+.5)-.5:se=S*oe;let pe=Math.max(0,Math.floor(se)),ae=se-pe,fe=Math.min(d-1,Math.ceil(se)),he=ee+pe*u[2],Ee=Q+pe*u[2],Le=ee+fe*u[2],Ve=Q+fe*u[2];for(let qe=0;qe<p;qe++){let je=m[he+qe],Ce=m[Ee+qe],tt=m[Le+qe],ye=m[Ve+qe],z=je+(tt-je)*ae,M=Ce+(ye-Ce)*ae,W=z+(M-z)*U;y[T++]=W}}}return e.makeTensorInfo([f,c,h,p],"float32",y)}var _ce,Tce=D(()=>{"use strict";ve();Ln();_ce={kernelName:_m,backendName:"cpu",kernelFunc:mPe}});function gPe(n){let{inputs:t,backend:e,attrs:r}=n,{images:o,dy:s}=t,{alignCorners:i}=r;zt([s,o],"resizeBilinearGrad");let a=Y.computeStrides(o.shape),[u,c,h,f]=o.shape,[,g,d]=s.shape,p=new Float32Array(u*c*h*f),m=[i&&g>1?c-1:c,i&&d>1?h-1:h],y=[i&&g>1?g-1:g,i&&d>1?d-1:d],v=m[0]/y[0],N=m[1]/y[1],T=e.data.get(s.dataId).values,O=0;for(let S=0;S<u;S++){let F=S*a[0];for(let R=0;R<g;R++){let L=R*v,q=Math.floor(L),U=Math.min(Math.ceil(L),c-1),Z=F+q*a[1],ee=F+U*a[1],Q=L-q,oe=1-Q;for(let se=0;se<d;se++){let pe=se*N,ae=Math.floor(pe),fe=Math.min(Math.ceil(pe),h-1),he=pe-ae,Ee=1-he,Le=Z+ae*a[2],Ve=Z+fe*a[2],qe=ee+ae*a[2],je=ee+fe*a[2],Ce=oe*Ee,tt=oe*he,ye=Q*Ee,z=Q*he;for(let M=0;M<f;M++){let W=T[O++];p[Le+M]+=W*Ce,p[Ve+M]+=W*tt,p[qe+M]+=W*ye,p[je+M]+=W*z}}}}return e.makeTensorInfo([u,h,c,f],"float32",p)}var Ece,Nce=D(()=>{"use strict";ve();Ln();Ece={kernelName:$1,backendName:"cpu",kernelFunc:gPe}});function yPe(n){let{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:s,halfPixelCenters:i,size:a}=r;zt(o,"resizeNearestNeighbor");let u=Y.computeStrides(o.shape),[c,h]=a,[f,g,d,p]=o.shape,m=e.data.get(o.dataId).values,y=new Float32Array(f*c*h*p),v=[s&&c>1?g-1:g,s&&h>1?d-1:d],N=[s&&c>1?c-1:c,s&&h>1?h-1:h],T=v[0]/N[0],O=v[1]/N[1],S=0;for(let F=0;F<f;F++){let R=F*u[0];for(let L=0;L<c;L++){let q=i?T*(L+.5):T*L,U=Math.min(g-1,s?Math.round(q):Math.floor(q));i&&(U=Math.max(0,U));let Z=R+U*u[1];for(let ee=0;ee<h;ee++){let Q=i?O*(ee+.5):O*ee,oe=Math.min(d-1,s?Math.round(Q):Math.floor(Q));i&&(oe=Math.max(0,oe));let se=Z+oe*u[2];for(let pe=0;pe<p;pe++){let ae=m[se+pe];y[S++]=ae}}}}return e.makeTensorInfo([f,c,h,p],o.dtype,y)}var kce,Dce=D(()=>{"use strict";ve();Ln();kce={kernelName:Im,backendName:"cpu",kernelFunc:yPe}});function xPe(n){let{inputs:t,backend:e,attrs:r}=n,{images:o,dy:s}=t,{alignCorners:i}=r;zt([s,o],"resizeNearestNeighborGrad");let a=Y.computeStrides(o.shape),u=Y.computeStrides(s.shape),[c,h,f,g]=o.shape,[,d,p]=s.shape,m=new Float32Array(c*h*f*g),y=e.data.get(s.dataId).values,v=[i&&d>1?h-1:h,i&&p>1?f-1:f],N=[i&&d>1?d-1:d,i&&p>1?p-1:p],T=v[0]/N[0],O=v[1]/N[1],S=1/T,F=1/O,R=Math.ceil(S)*2+2,L=Math.ceil(F)*2+2;for(let q=0;q<c;q++){let U=q*a[0];for(let Z=0;Z<h;Z++){let ee=U+Z*a[1],Q=Math.floor(Z*S),oe=Math.floor(Q-R/2);for(let se=0;se<f;se++){let pe=ee+se*a[2],ae=Math.floor(se*F),fe=Math.floor(ae-L/2);for(let he=0;he<g;he++){let Ee=0;for(let Le=0;Le<R;Le++){let Ve=Le+oe;if(Ve<0||Ve>=d)continue;let qe=U+Ve*u[1],je=Ve*T,Ce=Math.min(h-1,i?Math.round(je):Math.floor(je));if(Z===Ce)for(let tt=0;tt<L;tt++){let ye=tt+fe;if(ye<0||ye>=p)continue;let z=qe+ye*u[2],M=ye*O,W=Math.min(f-1,i?Math.round(M):Math.floor(M));se===W&&(Ee+=y[z+he])}}m[pe+he]=Ee}}}}return e.makeTensorInfo(o.shape,o.dtype,m)}var Ace,Oce=D(()=>{"use strict";ve();Ln();Ace={kernelName:P1,backendName:"cpu",kernelFunc:xPe}});function bPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dims:s}=r;zt(o,"reverse");let i=o.shape.length,a=Y.parseAxisParam(s,o.shape);if(i===0)return Na({inputs:{x:o},backend:e});let u=new no(o.shape,o.dtype),c=e.bufferSync(o);for(let h=0;h<u.size;h++){let f=u.indexToLoc(h),g=f.slice();a.forEach(d=>g[d]=o.shape[d]-1-g[d]),u.set(c.get(...g),...f)}return e.makeTensorInfo(u.shape,u.dtype,u.values)}var Rce,Mce=D(()=>{"use strict";ve();Ln();of();Rce={kernelName:Tm,backendName:"cpu",kernelFunc:bPe}});var Fce,Pce=D(()=>{"use strict";ve();Fce={kernelName:q1,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{image:r}=n,{radians:o,fillValue:s,center:i}=t,a=e,u=Y.getTypedArrayFromDType(r.dtype,Y.sizeFromShape(r.shape)),[c,h,f,g]=r.shape,[d,p]=Re.getImageCenter(i,h,f),m=255,y=Math.sin(o),v=Math.cos(o),N=a.data.get(r.dataId).values;for(let O=0;O<c;O++){let S=O*f*h*g;for(let F=0;F<h;F++){let R=F*(f*g);for(let L=0;L<f;L++){let q=L*g;for(let U=0;U<g;U++){let Z=[c,F,L,U],ee=Z[2],Q=Z[1],oe=(ee-d)*v-(Q-p)*y,se=(ee-d)*y+(Q-p)*v;oe=Math.round(oe+d),se=Math.round(se+p);let pe=s;if(typeof s!="number"&&(U===3?pe=m:pe=s[U]),oe>=0&&oe<f&&se>=0&&se<h){let fe=se*(f*g),he=oe*g,Ee=S+fe+he+U;pe=N[Ee]}let ae=S+R+q+U;u[ae]=pe}}}}return{dataId:a.write(u,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}}});var vPe,$ce,Lce=D(()=>{"use strict";ve();Zr();vPe=Hn(ld,n=>{let t=Math.floor(n);return n-t<.5?Math.floor(n):n-t>.5?Math.ceil(n):t%2===0?t:t+1}),$ce={kernelName:ld,backendName:"cpu",kernelFunc:vPe}});function PA(n,t,e,r,o,s,i,a,u,c){let h=[r/o,o],f=n.values,g=t.values;if(r===0)return Rn(e,t.dtype);let d=Rn(h,t.dtype);d.values.fill(u);for(let p=0;p<s;p++){let m=[],y=0;for(let v=0;v<i;v++){let N=f[p*i+v];m.push(N),y+=N*a[v]}if(y<0||y>=r/o)throw new Error(`Invalid indices: ${m} does not index into ${e}`);for(let v=0;v<o;v++)c?d.values[y*o+v]+=g[p*o+v]:d.values[y*o+v]=t.rank===0?g[0]:g[p*o+v]}return d}var zL=D(()=>{"use strict";ve();});function wPe(n){let{inputs:t,backend:e,attrs:r}=n,{indices:o,updates:s}=t,{shape:i}=r,{sliceRank:a,numUpdates:u,sliceSize:c,strides:h,outputSize:f}=Re.calculateShapes(s,o,i),g=!0,d=e.bufferSync(o),p=e.bufferSync(s),m=PA(d,p,i,f,c,u,a,h,0,g);return e.makeTensorInfo(i,m.dtype,m.values)}var Bce,zce=D(()=>{"use strict";ve();zL();Bce={kernelName:L1,backendName:"cpu",kernelFunc:wPe}});function SPe(n){let{inputs:t,backend:e}=n,{condition:r,t:o,e:s}=t;zt([r,o,s],"select");let i=r.shape.length,a=e.data.get(r.dataId).values,u=e.data.get(o.dataId).values,c=e.data.get(s.dataId).values,h=ci(o.dtype,s.dtype),f=Y.makeZerosTypedArray(Y.sizeFromShape(o.shape),h),g=0,d=i===0||i>1||o.shape.length===1?1:Y.sizeFromShape(o.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<d;m++)a[p]===1?f[g++]=u[p]:f[g++]=c[p];return e.makeTensorInfo(o.shape,h,f)}var Vce,jce=D(()=>{"use strict";ve();Ln();Vce={kernelName:Em,backendName:"cpu",kernelFunc:SPe}});var CPe,IPe,_Pe,Uce,qce=D(()=>{"use strict";ve();Zr();CPe=Re.SELU_SCALEALPHA,IPe=Re.SELU_SCALE,_Pe=Hn(hd,n=>n>=0?IPe*n:CPe*(Math.exp(n)-1)),Uce={kernelName:hd,backendName:"cpu",kernelFunc:_Pe}});var TPe,Gce,Wce=D(()=>{"use strict";ve();Zr();TPe=Hn(gd,n=>1/(1+Math.exp(-n))),Gce={kernelName:gd,backendName:"cpu",kernelFunc:TPe}});var EPe,Hce,Kce=D(()=>{"use strict";ve();Zr();EPe=Hn(md,n=>n<0?-1:n>0?1:0),Hce={kernelName:md,backendName:"cpu",kernelFunc:EPe}});var NPe,Xce,Yce=D(()=>{"use strict";ve();Zr();NPe=Hn(dd,n=>Math.sin(n)),Xce={kernelName:dd,backendName:"cpu",kernelFunc:NPe}});var kPe,Qce,Zce=D(()=>{"use strict";ve();Zr();kPe=Hn(fd,n=>Math.sinh(n)),Qce={kernelName:fd,backendName:"cpu",kernelFunc:kPe}});var DPe,Jce,APe,ele,tle=D(()=>{"use strict";ve();Zr();DPe=11920928955078125e-23,Jce=Math.log(DPe)+2,APe=Hn(yd,n=>{let t=n>-Jce,e=n<Jce,r=Math.exp(n),o;return e?o=r:t?o=n:o=Math.log(1+r),o}),ele={kernelName:yd,backendName:"cpu",kernelFunc:APe}});function OPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:s,paddings:i}=r;zt([o],"spaceToBatchND");let a=Y.sizeFromShape(s),u=[[0,0]];u.push(...i);for(let F=1+s.length;F<o.shape.length;++F)u.push([0,0]);let c=FA.kernelFunc({inputs:{x:o},backend:e,attrs:{paddings:u,constantValue:0}}),h=Re.getReshaped(c.shape,s,a,!1),f=Re.getPermuted(h.length,s.length,!1),g=Re.getReshapedPermuted(c.shape,s,a,!1),m=Ur({inputs:{x:c},backend:e,attrs:{shape:h}}),N=xi({inputs:{x:m},backend:e,attrs:{perm:f}}),S=Ur({inputs:{x:N},backend:e,attrs:{shape:g}});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(N),S}var nle,rle=D(()=>{"use strict";ve();Ln();BL();Qa();Ql();nle={kernelName:Dm,backendName:"cpu",kernelFunc:OPe}});function RPe(n){let{inputs:t,backend:e,attrs:r}=n,{sparseIndices:o,sparseValues:s,defaultValue:i}=t,{outputShape:a}=r,{sliceRank:u,numUpdates:c,sliceSize:h,strides:f,outputSize:g}=Re.calculateShapes(s,o,a),d=!1,p=e.bufferSync(o),m=e.bufferSync(s),y=e.data.get(i.dataId).values[0],v=PA(p,m,a,g,h,c,u,f,y,d);return e.makeTensorInfo(a,v.dtype,v.values)}var ole,sle=D(()=>{"use strict";ve();zL();ole={kernelName:z1,backendName:"cpu",kernelFunc:RPe}});function MPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{numOrSizeSplits:s,axis:i}=r,a=Y.parseAxisParam(i,o.shape)[0],u=Re.prepareSplitSize(o,s,a),c=new Array(o.shape.length).fill(0),h=o.shape.slice();return u.map(f=>{let g=[...h];g[a]=f;let d=Zl({inputs:{x:o},backend:e,attrs:{begin:c,size:g}});return c[a]+=f,d})}var ile,ale=D(()=>{"use strict";ve();ve();ry();ile={kernelName:Am,backendName:"cpu",kernelFunc:MPe}});var FPe,ule,cle=D(()=>{"use strict";ve();Zr();FPe=Hn(xd,n=>Math.sqrt(n)),ule={kernelName:xd,backendName:"cpu",kernelFunc:FPe}});var lle,ple=D(()=>{"use strict";ve();Ln();lle={kernelName:B1,backendName:"cpu",kernelFunc:({inputs:n,backend:t})=>{let{x:e}=n,r=t;zt(e,"square");let o=r.data.get(e.dataId).values,s=new Float32Array(o.length);for(let a=0;a<o.length;++a){let u=o[a];s[a]=u*u}return{dataId:r.write(s,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}}});var PPe,hle,dle=D(()=>{"use strict";ve();Zr();PPe=Hn(Cd,(n,t)=>{let e=t;return isNaN(n)?NaN:n>0?1:e.alpha}),hle={kernelName:Cd,backendName:"cpu",kernelFunc:PPe}});function $Pe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:s,end:i,strides:a,beginMask:u,endMask:c,ellipsisMask:h,newAxisMask:f,shrinkAxisMask:g}=r;zt(o,"stridedSlice");let{nonStrided:d,$begin:p,$strides:m,size:y,newShape:v,outShape:N}=Ji.sliceInfo(o.shape,s,i,a,u,c,h,f,g),T=Ur({inputs:{x:o},backend:e,attrs:{shape:v}}),O;if(d){let F=Zl({inputs:{x:T},backend:e,attrs:{begin:p,size:y}});O=Ur({inputs:{x:F},backend:e,attrs:{shape:N}}),e.disposeIntermediateTensorInfo(F)}else if(N.some(F=>F===0))O=e.makeTensorInfo(N,o.dtype,[]);else{let F=e.bufferSync(T),R=CA(N,F,m,p);O=e.makeTensorInfo(R.shape,R.dtype,R.values)}let S=Ur({inputs:{x:O},backend:e,attrs:{shape:N}});return e.disposeIntermediateTensorInfo(T),e.disposeIntermediateTensorInfo(O),S}var fle,mle=D(()=>{"use strict";ve();Ln();Qa();ry();J8();fle={kernelName:V1,backendName:"cpu",kernelFunc:$Pe}});var LPe,gle,yle=D(()=>{"use strict";ve();Zr();LPe=Hn(wd,n=>Math.tan(n)),gle={kernelName:wd,backendName:"cpu",kernelFunc:LPe}});var BPe,xle,ble=D(()=>{"use strict";ve();Zr();BPe=Hn(Sd,n=>Math.tanh(n)),xle={kernelName:Sd,backendName:"cpu",kernelFunc:BPe}});function zPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reps:s}=r;zt(o,"tile");let i=IA(e.bufferSync(o),s);return e.makeTensorInfo(i.shape,i.dtype,i.values)}var vle,wle=D(()=>{"use strict";ve();Ln();tL();vle={kernelName:Ap,backendName:"cpu",kernelFunc:zPe}});function VPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{k:s,sorted:i}=r;zt(o,"topk");let a=e.data.get(o.dataId).values,[u,c]=_A(a,o.shape,o.dtype,s,i);return[e.makeTensorInfo(u.shape,u.dtype,u.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var Sle,Cle=D(()=>{"use strict";ve();Ln();nL();Sle={kernelName:j1,backendName:"cpu",kernelFunc:VPe}});function jPe(n){let{inputs:t,attrs:e,backend:r}=n,{axis:o}=e,{x:s}=t;zt(s,"unique");let i=r.data.get(s.dataId).values,{outputValues:a,outputShape:u,indices:c}=TA(i,o,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var Ile,_le=D(()=>{"use strict";ve();Ln();rL();Ile={kernelName:U1,backendName:"cpu",kernelFunc:jPe}});function UPe(n){let{inputs:t,backend:e,attrs:r}=n,{value:o}=t,{axis:s}=r;s<0&&(s+=o.shape.length);let i=o.shape.length,a=o.shape[s],u=new Array(i-1),c=0;for(let d=0;d<i;d++)d!==s&&(u[c++]=o.shape[d]);let h=new Array(i).fill(0),f=o.shape.slice();f[s]=1;let g=new Array(a);for(let d=0;d<g.length;d++){h[s]=d;let p=Zl({inputs:{x:o},backend:e,attrs:{begin:h,size:f}});g[d]=Ur({inputs:{x:p},backend:e,attrs:{shape:u}}),e.disposeIntermediateTensorInfo(p)}return g}var Tle,Ele=D(()=>{"use strict";ve();Qa();ry();Tle={kernelName:Mm,backendName:"cpu",kernelFunc:UPe}});function qPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,segmentIds:s}=t,{numSegments:i}=r;zt(o,"unsortedSegmentSum");let a=o.shape.length,u=s.shape.length,c=[],h=[],f=a-u,g=s;for(let p=0;p<f;++p){let m=N2({inputs:{input:g},backend:e,attrs:{dim:p+1}});g=m,h.push(m)}for(let p=0;p<i;++p){let m=Y.createScalarValue(p,"int32"),y=e.makeTensorInfo([],"int32",m),v=SL({inputs:{a:y,b:g},backend:e}),N=Kl({inputs:{x:v},backend:e,attrs:{dtype:"float32"}}),T=s_({inputs:{a:N,b:o},backend:e}),O=Fx({inputs:{x:T},backend:e,attrs:{axis:0,keepDims:!1}});c.push(O),h.push(y),h.push(v),h.push(N),h.push(T),h.push(O)}let d=$L({inputs:c,backend:e,attrs:{axis:0}});return h.forEach(p=>e.disposeIntermediateTensorInfo(p)),d}var Nle,kle=D(()=>{"use strict";ve();Ln();v2();CL();AA();C2();LL();h_();Nle={kernelName:Fm,backendName:"cpu",kernelFunc:qPe}});var GPe,Dle=D(()=>{"use strict";ve();Zse();g8();eie();nie();Rx();oie();iie();uie();lie();hie();fie();gie();xie();vie();Sie();_ie();Eie();kie();Aie();yL();Rie();Fie();$ie();v2();v8();Bie();ag();Vie();DA();bL();Wie();Kie();Yie();Zie();eae();nae();oae();iae();uae();lae();hae();wL();mae();yae();bae();wae();Cae();_ae();aL();Eae();CL();Dae();yA();AA();_8();Rae();RA();Pae();E8();Lae();zae();jae();qae();Wae();D8();Kae();of();Yae();E2();Zae();eue();nue();cL();O8();oue();iue();F8();uue();lue();hue();fue();gue();xue();EL();L8();wue();Cue();_ue();Eue();Aue();Mue();Pue();z8();Lue();zue();sce();C2();j8();ace();cce();pce();q8();dce();yce();LL();BL();vce();pL();W8();Sce();Ox();l_();Ice();dL();mL();Qa();Tce();Nce();Dce();Oce();Mce();Pce();Lce();X8();zce();jce();qce();Wce();Kce();Yce();Zce();ry();FL();tle();rle();sle();ale();cle();ple();Z8();dle();mle();a_();h_();yle();ble();wle();Cle();Ql();_le();Ele();kle();PL();GPe=[Qse,yse,Jse,tie,Sse,rie,sie,aie,cie,pie,die,mie,yie,bie,wie,Iie,Tie,Nie,Die,Yse,Oie,Mie,Pie,wse,Cse,Lie,xse,zie,Uie,Gie,Hie,qie,Qie,Jie,Xie,tae,rae,sae,aae,cae,pae,dae,fae,gae,xae,vae,Iae,Sae,c_,qse,Tae,Nae,kae,Ise,Aae,_se,Oae,Mae,Fae,Tse,$ae,Bae,Vae,Uae,Gae,Ese,Hae,bse,Xae,jie,Qae,Jae,tue,Gse,Nse,rue,sue,kse,aue,cue,pue,due,mue,yue,Dse,vue,Sue,Iue,Tue,Due,bue,Rue,Fue,Ase,$ue,Bue,oce,Ose,Rse,ice,uce,lce,Mse,hce,gce,xce,FA,bce,Wse,Pse,wce,vse,Cce,Hse,Kse,Xse,_ce,Ece,kce,Ace,Rce,Fce,$ce,$se,Bce,Vce,Uce,Gce,Hce,Xce,Qce,Lse,nce,ele,nle,ole,ile,ule,lle,Bse,hle,fle,zse,Oue,gle,xle,vle,Sle,Fse,Ile,Tle,Nle,fce];for(let n of GPe)Bv(n)});var VL=D(()=>{"use strict";Use();Dle();});function Ale(n,t){$x[n]=t}function nl(n){if(!(n in $x)){let e=HPe(n);if(e!==null)$x[n]=e;else return console.log("Could not get context for WebGL version",n),null}let t=$x[n];return t.isContextLost()?(delete $x[n],nl(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),$x[n])}function WPe(n){if(typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function HPe(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let t=WPe(n);return t.addEventListener("webglcontextlost",e=>{e.preventDefault(),delete $x[n]},!1),n===1?t.getContext("webgl",jL)||t.getContext("experimental-webgl",jL):t.getContext("webgl2",jL)}var $x,jL,$A=D(()=>{"use strict";$x={},jL={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0}});function Bx(n,t){return[t,n]}function Ole(n,t){return n*t}function iy(n){let t=Y.sizeFromShape(n),e=Math.ceil(t/4);return Y.sizeToSquarishShape(e)}function af(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function Rle(n,t){let[e,r]=af(n,t);return e*r*4}function f_(n,t){let e=n,r,o,s,i,a,u,c,h,f,g;return mt().getNumber("WEBGL_VERSION")===2?(r=e.R32F,o=e.R16F,s=e.RGBA16F,i=e.RGBA32F,a=e.RED,c=4,h=1,f=e.HALF_FLOAT,g=e.FLOAT):(r=n.RGBA,o=n.RGBA,s=n.RGBA,i=e.RGBA,a=n.RGBA,c=4,h=4,f=t!=null?t.HALF_FLOAT_OES:null,g=n.FLOAT),u=n.RGBA,{internalFormatFloat:r,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:h,textureTypeHalfFloat:f,textureTypeFloat:g}}var Lx,Za,ka,Jl=D(()=>{"use strict";ve();Lx=function(n){return n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH",n}(Lx||{}),Za=function(n){return n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD",n}(Za||{}),ka=function(n){return n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16",n}(ka||{})});function qn(n,t){let e=t();return mt().getBool("DEBUG")&&KPe(n),e}function KPe(n){let t=n.getError();if(t!==n.NO_ERROR)throw new Error("WebGL Error: "+QPe(n,t))}function Mle(n){return!!(mt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||XPe<Math.abs(n)&&Math.abs(n)<YPe)}function QPe(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function m_(n,t){return cg(n,()=>n.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function Fle(n,t){let e=cg(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(qn(n,()=>n.shaderSource(e,t)),qn(n,()=>n.compileShader(e)),n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function Ple(n,t){let e=cg(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(qn(n,()=>n.shaderSource(e,t)),qn(n,()=>n.compileShader(e)),n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw JPe(t,n.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}function JPe(n,t){let e=ZPe.exec(t);if(e==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(n);return}let r=+e[1],o=n.split(`
`),s=o.length.toString().length+2,i=o.map((f,g)=>Y.rightPad((g+1).toString(),s)+f),a=0;for(let f=0;f<i.length;f++)a=Math.max(i[f].length,a);let u=i.slice(0,r-1),c=i.slice(r-1,r),h=i.slice(r);console.log(u.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${Y.rightPad(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function $le(n){return cg(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function Lle(n,t){if(qn(n,()=>n.linkProgram(t)),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function BA(n,t){if(qn(n,()=>n.validateProgram(t)),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function Ble(n,t){let e=cg(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return qn(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),qn(n,()=>n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function zle(n,t){let e=cg(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return qn(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e)),qn(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function Vle(n){return cg(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function jle(n,t){let e=mt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){let r=`[${n}x${t}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(n>e||t>e){let r=`[${n}x${t}]`,o=`[${e}x${e}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}function Ule(n){return cg(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function HL(n,t,e,r,o,s,i){let a=n.getAttribLocation(t,e);return a===-1?!1:(qn(n,()=>n.bindBuffer(n.ARRAY_BUFFER,r)),qn(n,()=>n.vertexAttribPointer(a,o,n.FLOAT,!1,s,i)),qn(n,()=>n.enableVertexAttribArray(a)),!0)}function e5e(n,t,e){n5e(n,e),qn(n,()=>n.activeTexture(n.TEXTURE0+e)),qn(n,()=>n.bindTexture(n.TEXTURE_2D,t))}function qle(n,t,e){return cg(n,()=>n.getUniformLocation(t,e),'uniform "'+e+'" not present in program.')}function Gle(n,t,e){return n.getUniformLocation(t,e)}function Wle(n,t,e,r){qn(n,()=>e5e(n,t,r)),qn(n,()=>n.uniform1i(e,r))}function zA(n,t,e){qn(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),qn(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0))}function KL(n,t){qn(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),qn(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function g_(n){let t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+t5e(n,t))}function t5e(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function cg(n,t,e){let r=qn(n,()=>t());if(r==null)throw new Error(e);return r}function n5e(n,t){let e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+n.TEXTURE0;if(r<n.TEXTURE0||r>e){let o=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${o}.`)}}function ay(n,t=2){return Y.sizeFromShape(n.slice(0,n.length-t))}function uy(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function VA(n){let t=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(t=[ay(n),...uy(n)]),t}function Hle(n,t=!1){let e=mt().getNumber("WEBGL_MAX_TEXTURE_SIZE");t&&(e=e*2,n=n.map((o,s)=>s>=n.length-2?Y.nearestLargerEven(n[s]):n[s]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Y.squeezeShape(n).newShape);let r=Y.sizeFromShape(n);if(n.length<=1&&r<=e)return[1,r];if(n.length===2&&n[0]<=e&&n[1]<=e)return n;if(n.length===3&&n[0]*n[1]<=e&&n[2]<=e)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=e&&n[1]*n[2]<=e)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=e&&n[3]<=e)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=e&&n[1]*n[2]*n[3]<=e)return[n[0],n[1]*n[2]*n[3]];if(t){let o=ay(n),s=2,i=2;return n.length&&([s,i]=uy(n)),r=o*(s/2)*(i/2),Y.sizeToSquarishShape(r).map(a=>a*2)}return Y.sizeToSquarishShape(r)}function LA(n){return n%2===0}function zx(n,t){if(n=n.slice(-2),t=t.slice(-2),Y.arraysEqual(n,t)||!n.length||!t.length||n[0]===0||n[1]===0||t[0]===0||t[1]===0)return!0;if(n.length!==t.length){let e=n.slice(-1)[0],r=t.slice(-1)[0];if(e===r||LA(e)&&LA(r)&&(n[0]===1||t[0]===1))return!0}return n[1]===t[1]&&LA(n[0])&&LA(t[0])}function Kle(n){if(qL==null){let t=nl(n);qL=t.getParameter(t.MAX_TEXTURE_SIZE)}return qL}function Xle(n){if(GL==null){let t=nl(n);GL=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,GL)}function Yle(n){if(n===0)return 0;let t,e=nl(n);return rl(e,"EXT_disjoint_timer_query_webgl2")&&n===2?t=2:rl(e,"EXT_disjoint_timer_query")?t=1:t=0,t}function rl(n,t){return n.getExtension(t)!=null}function XL(n){try{if(nl(n)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function Qle(n){if(n===0)return!1;let t=nl(n);if(n===1){if(!rl(t,"OES_texture_float"))return!1}else if(!rl(t,"EXT_color_buffer_float"))return!1;return WL(t)}function Zle(n){if(n===0)return!1;let t=nl(n);if(n===1){if(!rl(t,"OES_texture_float")||!rl(t,"WEBGL_color_buffer_float"))return!1}else{if(rl(t,"EXT_color_buffer_float"))return WL(t);let r="EXT_color_buffer_half_float";if(rl(t,r)){let o=t.getExtension(r);return r5e(t,o)}return!1}return WL(t)}function WL(n){let t=f_(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);let s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);let i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(s),i}function r5e(n,t){let e=f_(n,t),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatHalfFloat,1,1,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);let i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);let a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(i),a}function Jle(n){return n!==2?!1:nl(n).fenceSync!=null}function uf(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&Y.assert(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}var XPe,YPe,ZPe,qL,GL,ol=D(()=>{"use strict";ve();$A();Jl();XPe=596e-10,YPe=65504;ZPe=/ERROR: [0-9]+:([0-9]+):/g});var dr,epe=D(()=>{"use strict";ve();ol();dr=mt();dr.registerFlag("HAS_WEBGL",()=>dr.getNumber("WEBGL_VERSION")>0);dr.registerFlag("WEBGL_VERSION",()=>XL(2)?2:XL(1)?1:0);dr.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);dr.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>dr.get("WEBGL_VERSION")===2);dr.registerFlag("WEBGL_CPU_FORWARD",()=>!0);dr.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);dr.registerFlag("WEBGL_PACK",()=>dr.getBool("HAS_WEBGL"));dr.registerFlag("WEBGL_PACK_NORMALIZATION",()=>dr.getBool("WEBGL_PACK"));dr.registerFlag("WEBGL_PACK_CLIP",()=>dr.getBool("WEBGL_PACK"));dr.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>!1);dr.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>dr.getBool("WEBGL_PACK"));dr.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>dr.getBool("WEBGL_PACK"));dr.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>dr.getBool("WEBGL_PACK"));dr.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>dr.getBool("WEBGL_PACK"));dr.registerFlag("WEBGL_PACK_REDUCE",()=>dr.getBool("WEBGL_PACK"));dr.registerFlag("WEBGL_LAZILY_UNPACK",()=>dr.getBool("WEBGL_PACK"));dr.registerFlag("WEBGL_CONV_IM2COL",()=>dr.getBool("WEBGL_PACK"));dr.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Kle(dr.getNumber("WEBGL_VERSION")));dr.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Xle(dr.getNumber("WEBGL_VERSION")));dr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let n=dr.getNumber("WEBGL_VERSION");return n===0?0:Yle(n)});dr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>dr.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!b0.isMobile());dr.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>Qle(dr.getNumber("WEBGL_VERSION")));dr.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>dr.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:dr.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));dr.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Zle(dr.getNumber("WEBGL_VERSION")));dr.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Jle(dr.getNumber("WEBGL_VERSION")));dr.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>dr.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);dr.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)})});function hs(){let n,t,e,r,o,s,i,a,u,c;return mt().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",t="in",e="out",r="in",o="texture",s="outputColor",i="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",t="attribute",e="varying",r="varying",o="texture2D",s="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:t,varyingVs:e,varyingFs:r,texture2D:o,output:s,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:u,defineRound:c}}var ep=D(()=>{"use strict";ve();});function Qp(n,t,e="index"){let r=Y.computeStrides(t);return r.map((o,s)=>{let i=`int ${n[s]} = ${e} / ${o}`,a=s===r.length-1?`int ${n[s+1]} = ${e} - ${n[s]} * ${o}`:`index -= ${n[s]} * ${o}`;return`${i}; ${a};`}).join("")}function k2(n){let t=Y.computeStrides(n).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}var UA,lg=D(()=>{"use strict";ve();UA=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`});var qA,tpe=D(()=>{"use strict";ep();lg();Jl();qA=class{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Lx.DENSE;let e=iy(t),r=hs();this.outputShape=t,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${Qp(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${r.output} = result;
      }
    `}}});var GA,npe=D(()=>{"use strict";ep();lg();Jl();GA=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Lx.DENSE;let e=iy(t),r=hs();this.outputShape=t,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${Qp(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${r.output} = result;
      }
    `}}});var WA,rpe=D(()=>{"use strict";ep();lg();Jl();WA=class{constructor(t){this.variableNames=["A"],this.outTexUsage=Za.DOWNLOAD;let e=hs();this.outputShape=t,this.userCode=`
      ${UA}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}}});var HA,ope=D(()=>{"use strict";ep();lg();Jl();HA=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Za.DOWNLOAD;let e=hs();this.outputShape=t,this.userCode=`
      ${UA}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}}});var KA,spe=D(()=>{"use strict";ep();lg();KA=class{constructor(t,e,r=!1){this.variableNames=["A"];let o=hs(),[s,i]=e;this.outputShape=t;let a="result";r&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      ${k2(t)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / ${i};
        int c = imod(flatIndex, ${i});
        vec2 uv = (vec2(c, r) + halfCR) / vec2(${i}.0, ${s}.0);
        vec4 values = ${o.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${o.output} = vec4(${a}, 0., 0., 0.);
      }
    `}}});var XA,ipe=D(()=>{"use strict";ep();lg();XA=class{constructor(t,e,r=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let o=hs(),[s,i]=e;this.outputShape=t;let a="",u="result";r&&(u="floor(result * 255. + 0.5)");for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){let f=c*2+h;a+=`
          localCoords = coords;
          if(localCoords[2] + ${h} < ${t[2]}) {
            localCoords[2] += ${h};
            if(localCoords[1] + ${c} < ${t[1]}) {
              localCoords[1] += ${c};

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / ${i};
              c = imod(flatIndex, ${i});
              uv = (vec2(c, r) + halfCR) / vec2(${i}.0, ${s}.0);
              values = ${o.texture2D}(A, uv);

              if(offset == 0) {
                result[${f}] = values[0];
              } else if(offset == 1) {
                result[${f}] = values[1];
              } else if(offset == 2) {
                result[${f}] = values[2];
              } else {
                result[${f}] = values[3];
              }
            }
          }
        `}this.userCode=`
      ${k2(t)}

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        ${a}

        ${o.output} = ${u};
      }
    `}}});function ape(n){let t=hs(),e=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return Fle(n,e)}function upe(n){let t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Ble(n,t)}function cpe(n){let t=new Uint16Array([0,1,2,2,1,3]);return zle(n,t)}function y_(n,t,e,r,o,s){jle(t,e);let i=Vle(n),a=n.TEXTURE_2D;return qn(n,()=>n.bindTexture(a,i)),qn(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),qn(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),qn(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),qn(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),qn(n,()=>n.texImage2D(a,0,r,t,e,0,o,s,null)),qn(n,()=>n.bindTexture(n.TEXTURE_2D,null)),i}function YL(n){return n.internalFormatFloat}function lpe(n,t,e,r){let[o,s]=Bx(t,e);return y_(n,o,s,YL(r),r.textureFormatFloat,n.FLOAT)}function QL(n){return n.internalFormatHalfFloat}function ppe(n,t,e,r){let[o,s]=Bx(t,e);return y_(n,o,s,QL(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function ZL(n){return n.downloadTextureFormat}function hpe(n,t,e,r){let[o,s]=Bx(t,e);return y_(n,o,s,ZL(r),n.RGBA,n.UNSIGNED_BYTE)}function JL(n){return n.internalFormatPackedFloat}function dpe(n,t,e,r){let[o,s]=af(t,e);return y_(n,o,s,JL(r),n.RGBA,n.FLOAT)}function e7(n){return n.internalFormatPackedHalfFloat}function fpe(n,t,e,r){let[o,s]=af(t,e);return y_(n,o,s,e7(r),n.RGBA,r.textureTypeHalfFloat)}function mpe(n,t,e){return qn(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),HL(n,t,"clipSpacePos",e,3,20,0)&&HL(n,t,"uv",e,2,20,12)}function gpe(n,t,e,r,o,s){qn(n,()=>n.bindTexture(n.TEXTURE_2D,t));let i,a,u;o instanceof Uint8Array?(i=new Uint8Array(e*r*4),a=n.UNSIGNED_BYTE,u=n.RGBA):(i=new Float32Array(e*r*4),a=n.FLOAT,u=s.internalFormatPackedFloat),i.set(o),qn(n,()=>n.texImage2D(n.TEXTURE_2D,0,u,e,r,0,n.RGBA,a,i)),qn(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function ype(n,t,e){qn(n,()=>n.bindTexture(n.TEXTURE_2D,t)),e.data instanceof Uint8Array?qn(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e.width,e.height,0,n.RGBA,n.UNSIGNED_BYTE,e.data)):qn(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)),qn(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function xpe(n,t,e,r){let o=n.createBuffer();qn(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,o));let a=4*4*t*e;return qn(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),qn(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,0)),qn(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),o}function bpe(n,t,e){let r=n,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function vpe(n,t,e,r){let[o,s]=Bx(t,e),i=4,a=new Uint8Array(Ole(t*e,i));return qn(n,()=>n.readPixels(0,0,o,s,r.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function wpe(n,t,e,r,o,s,i,a){let u=n,c=new Float32Array(Rle(s,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function Spe(n,t,e){let r=new Float32Array(t*e*4);return qn(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,r)),r}var t7=D(()=>{"use strict";ep();Jl();ol();});function s5e(n){let t=0;for(;t<n.length&&n[t]();++t);return t-1}var YA,Cpe=D(()=>{"use strict";ve();$A();t7();Jl();ol();YA=class{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];let e=mt().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,Ale(e,t)):this.gl=nl(e);let r="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(mt().getNumber("WEBGL_VERSION")===1){let s="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=m_(this.gl,s),rl(this.gl,i))this.textureHalfFloatExtension=m_(this.gl,i);else if(mt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),rl(this.gl,o))this.colorBufferHalfFloatExtension=m_(this.gl,o);else if(mt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",rl(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(rl(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=upe(this.gl),this.indexBuffer=cpe(this.gl),this.framebuffer=Ule(this.gl),this.textureConfig=f_(this.gl,this.textureHalfFloatExtension)}get debug(){return mt().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let t=this.gl;qn(t,()=>t.finish()),qn(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),qn(t,()=>t.deleteFramebuffer(this.framebuffer)),qn(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),qn(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),qn(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),lpe(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),ppe(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),hpe(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),ype(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,r,o){this.throwIfDisposed(),gpe(this.gl,t,e,r,o,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),fpe(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),dpe(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(KL(this.gl,this.framebuffer),this.outputTexture=null),qn(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,r){return this.downloadMatrixDriver(t,()=>vpe(this.gl,e,r,this.textureConfig))}downloadPackedMatrixFromBuffer(t,e,r,o,s,i){return wpe(this.gl,t,e,r,o,s,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return bpe(this.gl,t,e)}createBufferFromTexture(t,e,r){this.bindTextureToFrameBuffer(t);let o=xpe(this.gl,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,r;if(mt().getBool("WEBGL_FENCE_API_ENABLED")){let o=t,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=()=>{let i=o.clientWaitSync(s,0,0);return i===o.ALREADY_SIGNALED||i===o.CONDITION_SATISFIED},e=s}else mt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(e,mt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:e,isFencePassed:r}}downloadMatrixFromPackedTexture(t,e,r){return this.downloadMatrixDriver(t,()=>Spe(this.gl,e,r))}createProgram(t){this.throwIfDisposed();let e=this.gl,r=Ple(e,t),o=ape(e),s=$le(e);return qn(e,()=>e.attachShader(s,o)),qn(e,()=>e.attachShader(s,r)),Lle(e,s),this.debug&&BA(e,s),this.vertexAttrsAreBound||(this.setProgram(s),this.vertexAttrsAreBound=mpe(e,this.program,this.vertexBuffer)),s}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&qn(this.gl,()=>this.gl.deleteProgram(t))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&BA(this.gl,this.program),qn(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,e,r=!0){return this.throwIfDisposed(),r?qle(this.gl,t,e):Gle(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),qn(this.gl,()=>this.gl.getAttribLocation(t,e))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),Wle(this.gl,t,e,r)}setOutputMatrixTexture(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)}setOutputPackedMatrixTexture(t,e,r){this.throwIfDisposed();let[o,s]=af(e,r);this.setOutputMatrixTextureDriver(t,o,s)}setOutputMatrixWriteRegion(t,e,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,e)}setOutputPackedMatrixWriteRegion(t,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&BA(this.gl,this.program),g_(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let t=this.gl;this.debug&&this.debugValidate(),qn(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),qn(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=m_(this.gl,mt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(mt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=r.createQuery();return r.beginQuery(o.TIME_ELAPSED_EXT,s),s}let t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(mt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT);return}let t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}waitForQueryAndGetTime(t){return Te(this,null,function*(){return yield Y.repeatedTry(()=>this.disposed||this.isQueryAvailable(t,mt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,mt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})}getQueryTime(t,e){if(e===0)return null;if(e===2){let r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}else{let r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(e===0)return!0;if(e===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{let r=this.getQueryTimerExtensionWebGL1(),o=r.getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(t){return new Promise(e=>{this.addItemToPoll(()=>t.isFencePassed(),()=>e())})}pollItems(){let t=s5e(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=t;++e){let{resolveFn:r}=this.itemsToPoll[e];r()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),!(this.itemsToPoll.length>1)&&Y.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0))}bindTextureToFrameBuffer(t){this.throwIfDisposed(),zA(this.gl,t,this.framebuffer),this.debug&&g_(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(zA(this.gl,this.outputTexture,this.framebuffer),this.debug&&g_(this.gl)):KL(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);let r=e();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(t,e,r){this.throwIfDisposed();let o=this.gl;zA(o,t,this.framebuffer),this.debug&&g_(o),this.outputTexture=t,qn(o,()=>o.viewport(0,0,e,r)),qn(o,()=>o.scissor(0,0,e,r))}setOutputMatrixWriteRegionDriver(t,e,r,o){this.throwIfDisposed(),qn(this.gl,()=>this.gl.scissor(t,e,r,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}});function _pe(n,t,e,r){let o=[];n.forEach(p=>{let m=Y.sizeFromShape(p.shapeInfo.logicalShape);p.shapeInfo.isUniform?o.push(`uniform float ${p.name}${m>1?`[${m}]`:""};`):(o.push(`uniform sampler2D ${p.name};`),o.push(`uniform int offset${p.name};`))});let s=o.join(`
`),i=n.map(p=>i5e(p,t,r)).join(`
`),a=t.texShape,u=hs(),c=c5e(u),h,f,g=h5e(u);return t.isPacked?(h=a5e(t.logicalShape,a),f=p5e(u)):(h=u5e(t.logicalShape,a),f=l5e(u)),r&&(g+=g5e),[g,c,f,s,h,i,e].join(`
`)}function A2(n){let t=n.shapeInfo.logicalShape;switch(t.length){case 0:return N5e(n);case 1:return D5e(n);case 2:return O5e(n);case 3:return M5e(n);case 4:return P5e(n);case 5:return $5e(n);case 6:return L5e(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function Tpe(n){switch(n.shapeInfo.logicalShape.length){case 0:return E5e(n);case 1:return k5e(n);case 2:return A5e(n);case 3:return R5e(n);default:return F5e(n)}}function i5e(n,t,e=!1){let r="";e?r+=Tpe(n):r+=A2(n);let o=n.shapeInfo.logicalShape,s=t.logicalShape;return o.length<=s.length&&(e?r+=B5e(n,t):r+=z5e(n,t)),r}function a5e(n,t){switch(n.length){case 0:return Epe();case 1:return y5e(n,t);case 2:return _5e(n,t);case 3:return b5e(n,t);default:return w5e(n,t)}}function u5e(n,t){switch(n.length){case 0:return Epe();case 1:return x5e(n,t);case 2:return T5e(n,t);case 3:return v5e(n,t);case 4:return S5e(n,t);case 5:return C5e(n,t);case 6:return I5e(n,t);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function c5e(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function l5e(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function p5e(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function h5e(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${d5e}
    ${f5e}
    ${m5e}
  `}function Epe(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function y5e(n,t){let e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return e[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${e[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return 2 * (resTexRC.x * ${e[1]} + resTexRC.y);
    }
  `}function x5e(n,t){return t[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function b5e(n,t){let e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function v5e(n,t){let e=Qp(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${e}
      return ivec3(r, c, d);
    }
  `}function w5e(n,t){let e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2),s=o,i="",a="b, r, c";for(let u=2;u<n.length-1;u++)s*=n[n.length-u-1],i=`
      int b${u} = index / ${s};
      index -= b${u} * ${s};
    `+i,a=`b${u}, `+a;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${i}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${a});
    }
  `}function S5e(n,t){let e=Qp(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${e}
      return ivec4(r, c, d, d2);
    }
  `}function C5e(n,t){let e=Qp(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function I5e(n,t){let e=Qp(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function _5e(n,t){let e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Y.arraysEqual(n,t))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `;let r=Math.ceil(n[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function T5e(n,t){return Y.arraysEqual(n,t)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:n[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Vx(n){return`offset${n}`}function E5e(n){let t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),r=hs();return`
    vec4 ${e}() {
      return ${r.texture2D}(${t}, halfCR);
    }
  `}function N5e(n){let t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${e}() {return ${t};}`;let[r,o]=n.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${e}() {
        return sampleTexture(${t}, halfCR);
      }
    `;let[s,i]=n.shapeInfo.texShape,a=Vx(t);return`
    float ${e}() {
      vec2 uv = uvFromFlat(${s}, ${i}, ${a});
      return sampleTexture(${t}, uv);
    }
  `}function k5e(n){let t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],s=hs();return`
    vec4 ${e}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${s.texture2D}(${t}, uv);
    }
  `}function D5e(n){let t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${e}(int index) {
        ${O2(n)}
      }
    `;let r=n.shapeInfo.texShape,o=r[0],s=r[1];if(s===1&&o===1)return`
      float ${e}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;let i=Vx(t);return s===1?`
      float ${e}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${i}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?`
      float ${e}(int index) {
        vec2 uv = vec2((float(index + ${i}) + 0.5) / ${s}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
    float ${e}(int index) {
      vec2 uv = uvFromFlat(${o}, ${s}, index + ${i});
      return sampleTexture(${t}, uv);
    }
  `}function A5e(n){let t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n.shapeInfo.texShape,s=o[0],i=o[1],a=hs();if(o!=null&&Y.arraysEqual(t,o))return`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}.0, ${s}.0);

        return ${a.texture2D}(${e}, uv);
      }
    `;let u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${a.texture2D}(${e}, uv);
    }
  `}function O5e(n){let t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n.shapeInfo.texShape;if(o!=null&&Y.arraysEqual(t,o)){let f=o[0],g=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${f}.0);
      return sampleTexture(${e}, uv);
    }
  `}let{newShape:s,keptDims:i}=Y.squeezeShape(t),a=s;if(a.length<t.length){let f=R2(n,a),g=["row","col"];return`
      ${A2(f)}
      float ${r}(int row, int col) {
        return ${r}(${M2(g,i)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${O2(n)}
      }
    `;let u=o[0],c=o[1],h=Vx(e);return c===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${e}, uv);
    }
  `:u===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${e}, uv);
    }
  `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${h};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${e}, uv);
  }
`}function R5e(n){let t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n.shapeInfo.texShape,s=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){let f=t.slice(1),g=[1,2],d=R2(n,f),p=["b","row","col"];return`
        ${Tpe(d)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${M2(p,g)});
        }
      `}let i=s[0],a=s[1],u=Math.ceil(t[2]/2),c=u*Math.ceil(t[1]/2),h=hs();return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${i}, ${a}, ${c}, ${u}, b, row, col);
      return ${h.texture2D}(${e}, uv);
    }
  `}function M5e(n){let t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t[1]*t[2],s=t[2],{newShape:i,keptDims:a}=Y.squeezeShape(t),u=i;if(u.length<t.length){let p=R2(n,u),m=["row","col","depth"];return`
        ${A2(p)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${M2(m,a)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${s}, 1)));
        ${O2(n)}
      }
    `;let c=n.shapeInfo.texShape,h=c[0],f=c[1],g=n.shapeInfo.flatOffset;if(f===o&&g==null)return`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${s}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${h}.0);
          return sampleTexture(${e}, uv);
        }
      `;if(f===s&&g==null)return`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${e}, uv);
    }
  `;let d=Vx(e);return`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${s} + depth + ${d};
        vec2 uv = uvFromFlat(${h}, ${f}, index);
        return sampleTexture(${e}, uv);
      }
  `}function F5e(n){let t=n.shapeInfo.logicalShape,e=t.length,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n.shapeInfo.texShape,i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],a=i[0],u=i[1],c=Math.ceil(t[e-1]/2),h=c*Math.ceil(t[e-2]/2),f="int b, int row, int col",g=`b * ${h} + (row / 2) * ${c} + (col / 2)`;for(let p=2;p<e-1;p++)f=`int b${p}, `+f,h*=t[e-p-1],g=`b${p} * ${h} + `+g;let d=hs();return`
    vec4 ${o}(${f}) {
      int index = ${g};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${a});
      return ${d.texture2D}(${r}, uv);
    }
  `}function P5e(n){let t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t[3],s=t[2]*o,i=t[1]*s,{newShape:a,keptDims:u}=Y.squeezeShape(t);if(a.length<t.length){let p=R2(n,a),m=["row","col","depth","depth2"];return`
      ${A2(p)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${M2(m,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${i}, ${s}, ${o}, 1)));
        ${O2(n)}
      }
    `;let c=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,f=h[0],g=h[1];if(g===i&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${s}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(g===o&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;let d=Vx(e);return`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${i} + col * ${s} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${f}, ${g}, index + ${d});
      return sampleTexture(${e}, uv);
    }
  `}function $5e(n){let t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t[4],s=t[3]*o,i=t[2]*s,a=t[1]*i,{newShape:u,keptDims:c}=Y.squeezeShape(t);if(u.length<t.length){let m=R2(n,u),y=["row","col","depth","depth2","depth3"];return`
      ${A2(m)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${M2(y,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${s}, ${o})) +
          depth3;
        ${O2(n)}
      }
    `;let h=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,g=f[0],d=f[1];if(d===a&&h==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${s}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${g}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(d===o&&h==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${g}.0);
        return sampleTexture(${e}, uv);
      }
    `;let p=Vx(e);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${s} +
          depth2 * ${o} + depth3 + ${p};
      vec2 uv = uvFromFlat(${g}, ${d}, index);
      return sampleTexture(${e}, uv);
    }
  `}function L5e(n){let t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:o,keptDims:s}=Y.squeezeShape(t);if(o.length<t.length){let y=R2(n,o),v=["row","col","depth","depth2","depth3","depth4"];return`
      ${A2(y)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${M2(v,s)});
      }
    `}let i=t[5],a=t[4]*i,u=t[3]*a,c=t[2]*u,h=t[1]*c;if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${h}, ${c}, ${u}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${O2(n)}
      }
    `;let f=n.shapeInfo.flatOffset,g=n.shapeInfo.texShape,d=g[0],p=g[1];if(p===h&&f==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${u}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(p===i&&f==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;let m=Vx(e);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${c} + depth * ${u} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${m};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${e}, uv);
    }
  `}function O2(n){let t=n.name,e=Y.sizeFromShape(n.shapeInfo.logicalShape);return e<2?`return ${t};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function B5e(n,t){let e=n.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",s=n.shapeInfo.logicalShape.length,i=t.logicalShape.length,a=Ipe(n.shapeInfo.logicalShape,t.logicalShape),u=pr(i),c=i-s,h,f=["x","y","z","w","u","v"];s===0?h="":i<2&&a.length>=1?h="coords = 0;":h=a.map(N=>`coords.${f[N+c]} = 0;`).join(`
`);let g="";i<2&&s>0?g="coords":g=n.shapeInfo.logicalShape.map((N,T)=>`coords.${f[T+c]}`).join(", ");let d="return outputValue;",m=Y.sizeFromShape(n.shapeInfo.logicalShape)===1,v=Y.sizeFromShape(t.logicalShape)===1;if(s===1&&!m&&!v)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!v)i===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(a.length){let N=s-2,T=s-1;a.indexOf(N)>-1&&a.indexOf(T)>-1?d="return vec4(outputValue.x);":a.indexOf(N)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(T)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${u} coords = getOutputCoords();
      ${h}
      vec4 outputValue = get${r}(${g});
      ${d}
    }
  `}function z5e(n,t){let e=n.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",s=t.texShape,i=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!n.shapeInfo.isUniform&&a===u&&n.shapeInfo.flatOffset==null&&Y.arraysEqual(i,s))return`
      float ${o}() {
        return sampleTexture(${e}, resultUV);
      }
    `;let c=pr(u),h=Ipe(n.shapeInfo.logicalShape,t.logicalShape),f=u-a,g,d=["x","y","z","w","u","v"];a===0?g="":u<2&&h.length>=1?g="coords = 0;":g=h.map(m=>`coords.${d[m+f]} = 0;`).join(`
`);let p="";return u<2&&a>0?p="coords":p=n.shapeInfo.logicalShape.map((m,y)=>`coords.${d[y+f]}`).join(", "),`
    float ${o}() {
      ${c} coords = getOutputCoords();
      ${g}
      return get${r}(${p});
    }
  `}function pr(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function R2(n,t){let e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function M2(n,t){return t.map(e=>n[e]).join(", ")}var Ipe,d5e,f5e,m5e,g5e,Gs=D(()=>{"use strict";ve();ep();lg();({getBroadcastDims:Ipe}=Re);d5e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,f5e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,m5e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,g5e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`});function kpe(n,t,e,r){let o=t.userCode,s=e.map((d,p)=>{let m={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(m.flatOffset=d.texData.slice.flatOffset),{name:t.variableNames[p],shapeInfo:m}}),i=s.map(d=>d.shapeInfo),a={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=_pe(s,a,o,t.packedInputs),c=n.createProgram(u),h=null,f=n.getUniformLocation(c,"NAN",!1);mt().getNumber("WEBGL_VERSION")===1&&(h=n.getUniformLocation(c,"INFINITY",!1));let g={};for(let d=0;d<t.variableNames.length;d++){let p=t.variableNames[d],m=!1;g[p]=n.getUniformLocation(c,p,m),g[`offset${p}`]=n.getUniformLocation(c,`offset${p}`,m)}return{program:t,source:u,webGLProgram:c,uniformLocations:g,inShapeInfos:i,outShapeInfo:a,infLoc:h,nanLoc:f}}function Npe(n,t){if(n.length!==t.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${t.length} inputs`);n.forEach((e,r)=>{let o=e.logicalShape,s=t[r],i=s.shape;if(!Y.arraysEqual(o,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${i} must match`);if(e.isUniform&&s.isUniform)return;let a=e.texShape,u=s.isUniform?null:s.texData.texShape;if(!Y.arraysEqual(a,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${u} must match`)})}function Dpe(n,t,e,r,o){Npe(t.inShapeInfos,e),Npe([t.outShapeInfo],[r]);let s=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(s,i[0],i[1]):n.setOutputMatrixTexture(s,i[0],i[1]),n.setProgram(t.webGLProgram),mt().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&n.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&n.gl.uniform1f(t.nanLoc,NaN),e.forEach((a,u)=>{let c=t.program.variableNames[u],h=t.uniformLocations[c],f=t.uniformLocations[`offset${c}`];if(h!=null){if(a.isUniform){if(Y.sizeFromShape(a.shape)<2)n.gl.uniform1f(h,a.uniformValues[0]);else{let g=a.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),n.gl.uniform1fv(h,g)}return}a.texData.slice!=null&&f!=null&&n.gl.uniform1i(f,a.texData.slice.flatOffset),n.setInputMatrixTexture(a.texData.texture,h,u)}}),o?.(n,t.webGLProgram),n.executeProgram()}function Ape(n,t,e){let r="";t.concat(e).forEach(i=>{let a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0,u=i.isUniform?"uniform":i.texData.texShape;r+=`${i.shape}_${u}_${a}`});let o=n.userCode,s=n.constructor.name;return s+="_"+r+"_"+o,s}var Ope=D(()=>{"use strict";ve();Gs();});var Rpe,QA,Mpe,Fpe,Ppe,$pe,Lpe,Bpe,zpe,Vpe,jpe,Upe,qpe,Gpe,Wpe,Hpe,Kpe,Xpe,Ype,Qpe,Zpe,ZA,Jpe,ehe,the,nhe,rhe,jx,ohe,Vo=D(()=>{"use strict";Vse();({addImpl:Rpe,bincountImpl:QA,bincountReduceImpl:Mpe,ceilImpl:Fpe,concatImpl:Ppe,expImpl:$pe,expm1Impl:Lpe,floorImpl:Bpe,gatherV2Impl:zpe,greaterImpl:Vpe,lessImpl:jpe,linSpaceImpl:Upe,logImpl:qpe,maxImpl:Gpe,maximumImpl:Wpe,minimumImpl:Hpe,multiplyImpl:Kpe,negImpl:Xpe,prodImpl:Ype,rangeImpl:Qpe,rsqrtImpl:Zpe,simpleAbsImpl:ZA,sliceImpl:Jpe,stridedSliceImpl:ehe,subImpl:the,tileImpl:nhe,topKImpl:rhe,transposeImpl:jx,uniqueImpl:ohe}=oL)});function n7(n,t){return["x","y","z","w","u","v"].slice(0,t).map(e=>`${n}.${e}`)}function Ms(n,t){return t===1?[n]:n7(n,t)}function she(n,t){if(n===1)return"rc";let e="";for(let r=0;r<n;r++)e+=t[r],r<n-1&&(e+=",");return e}var Zp=D(()=>{"use strict";});function U5e(n,t){let e=[];for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let s=`${r===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let i=2;i<n;i++)s=`${t[t.length-1-i]},`+s;e.push(s)}return e}function q5e(n,t,e){if(n===1)return`rc > ${t[0]}`;let r="";for(let o=n-2;o<n;o++)r+=`${e[o]} >= ${t[o]}`,o<n-1&&(r+="||");return r}function G5e(n,t,e,r){if(n===1)return"";let o=r.slice(-2);return`
    int r = ${o[0]};
    int c = ${o[1]};
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= ${t};
    bool rEdge = rp1 >= ${e};
  `}function W5e(n,t){let e=n.length,r=U5e(e,t);return e===1?`getA(rc),
            rc + 1 >= ${n[0]} ? 0. : getA(rc + 1),
            0, 0`:`getA(${r[0]}),
          cEdge ? 0. : getA(${r[1]}),
          rEdge ? 0. : getA(${r[2]}),
          rEdge || cEdge ? 0. : getA(${r[3]})`}var JA,ihe=D(()=>{"use strict";Zp();Gs();JA=class{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;let e=t.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let r=Ms("rc",e),o=pr(e),s=q5e(e,t,r),i=G5e(e,t[t.length-1],t[t.length-2],r),a=W5e(t,r);this.userCode=`
        void main() {
          ${o} rc = getOutputCoords();

          if(${s}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${a}));
          }
        }
      `}}}});function H5e(n){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${Qp(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}var F2,r7=D(()=>{"use strict";lg();F2=class{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;let r="";for(let o=0;o<4;o++){let s="thisRC = rc;";o%2===1&&(s+="thisRC.z += 1;"),o>1&&(s+="thisRC.y += 1;"),r+=`
        ${s}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${H5e(e)}
      ${k2(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${t[1]};
        int cols = ${t[2]};

        ${r}

        setOutput(result);
      }
    `}}});function K5e(n,t){let e=n;if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===n.RGBA)return 16;if(t===e.RGBA16F)return 8;throw new Error(`Unknown internal format ${t}`)}function ahe(n,t,e,r,o){let s=X5e(t,r),i;if(o){let[u,c]=af(n[0],n[1]);i=u*c}else{let[u,c]=Bx(n[0],n[1]);i=u*c}let a=K5e(e,s);return i*a}function X5e(n,t){switch(n){case ka.PACKED_2X2_FLOAT32:return JL(t);case ka.PACKED_2X2_FLOAT16:return e7(t);case ka.UNPACKED_FLOAT32:return YL(t);case ka.UNPACKED_FLOAT16:return QL(t);case ka.PACKED_4X1_UNSIGNED_BYTE:return ZL(t);default:throw new Error(`Unknown physical texture type ${n}`)}}function Y5e(n){return mt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?ka.PACKED_2X2_FLOAT32:ka.UNPACKED_FLOAT32:n?ka.PACKED_2X2_FLOAT16:ka.UNPACKED_FLOAT16}function uhe(n,t){if(n===Za.UPLOAD)return ka.PACKED_2X2_FLOAT32;if(n===Za.RENDER||n==null)return Y5e(t);if(n===Za.DOWNLOAD||n===Za.PIXELS)return ka.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function che(n,t,e){return`${n[0]}_${n[1]}_${t}_${e}`}var e3,lhe=D(()=>{"use strict";ve();t7();Jl();e3=class{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(t,e,r){let o=uhe(e,r),s=che(t,o,r);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);let i=ahe(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();let u=this.freeTextures[s].shift();return this.usedTextures[s].push(u),u}let a;return o===ka.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===ka.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===ka.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===ka.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===ka.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(t,e,r,o){if(this.freeTextures==null)return;let s=uhe(r,o),i=che(e,s,o);i in this.freeTextures||(this.freeTextures[i]=[]);let a=ahe(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,o),u=mt().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(t),this._numBytesAllocated-=a):(this.freeTextures[i].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let c=this.usedTextures[i],h=c.indexOf(t);if(h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(h,1),this.log()}log(){if(!this.logEnabled)return;let t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);let e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let t in this.freeTextures)this.freeTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});for(let t in this.usedTextures)this.usedTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}});var Eu,Vi,phe,o7,hhe,dhe,fhe,x_,Ja=D(()=>{"use strict";Eu=class{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},Vi="if (isnan(x)) return x;",phe="return x;",o7="return abs(x);",hhe="return (x >= 0.0) ? x : (exp(x) - 1.0);",dhe=Vi+`
  return (x < 0.0) ? 0.0 : x;
`,fhe=Vi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,x_="return x;"});var ghe,yhe,xhe,bhe,tp,P2=D(()=>{"use strict";ghe="return x;",yhe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,xhe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,bhe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tp=class{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}});var t3,vhe=D(()=>{"use strict";Zp();Gs();t3=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;let e=t.length,r=Ms("rc",e),o=pr(e),s=she(e,r),i=r.slice(-2),a=e<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}});function t6e(n){return n in n3||(n3[n]={}),n3[n]}function o6e(){return mt().global.screen==null?1024:mt().global.screen.height*mt().global.screen.width*window.devicePixelRatio*r6e/1024/1024}function s6e(n,t){if(t==="float32"||t==="complex64")return n;if(t==="int32"||t==="bool"){let e=t==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let r=0;r<e.length;++r)e[r]=Math.round(n[r]);return e}else throw new Error(`Unknown dtype ${t}`)}var Z5e,J5e,e6e,n3,n6e,r6e,r3,whe=D(()=>{"use strict";epe();ve();$A();tpe();npe();rpe();ope();spe();ipe();Cpe();Ope();Vo();ihe();r7();Jl();Jl();lhe();Ja();Ja();P2();vhe();ol();Z5e=oa.whereImpl,J5e=1e-7,e6e=1e-4,n3={};n6e=128,r6e=600;r3=class extends kh{constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.warnedAboutCPUBackend=!1,this.pendingDeletes=0,this.disposed=!1,!mt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){let e=nl(mt().getNumber("WEBGL_VERSION"));this.binaryCache=t6e(mt().getNumber("WEBGL_VERSION")),this.gpgpu=new YA(e),this.canvas=e.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=t,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;this.textureManager=new e3(this.gpgpu),this.numMBBeforeWarning=o6e(),this.texData=new s0(this,Vm())}numDataIds(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}write(t,e,r){if((mt().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||mt().getBool("DEBUG"))&&this.checkNumericalProblems(t),r==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let o={};return this.texData.set(o,{shape:e,dtype:r,values:t,usage:Za.UPLOAD,refCount:1,complexParentRefCount:0}),o}incRef(t){let e=this.texData.get(t);e.refCount++}decRef(t){if(this.texData.has(t)){let e=this.texData.get(t);e.refCount--}}decComplexRef(t){if(this.texData.has(t)){let e=this.texData.get(t);e.complexParentRefCount>0&&e.refCount--}}move(t,e,r,o){if(mt().getBool("DEBUG")&&this.checkNumericalProblems(e),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:r,dtype:o,values:e,usage:Za.UPLOAD,refCount:1,complexParentRefCount:0})}disposeIntermediateTensorInfo(t){let e=t.dataId;if(this.texData.has(e)){let r=this.texData.get(e);r.refCount--,r.refCount<1&&this.disposeData(e)}}readSync(t){let e=this.texData.get(t),{values:r,dtype:o,complexTensorInfos:s,slice:i,shape:a,isPacked:u}=e;if(i!=null){let g;u?g=new tp(a,x_):g=new Eu(a,x_);let d=this.runWebGLProgram(g,[{dataId:t,shape:a,dtype:o}],o),p=this.readSync(d.dataId);return this.disposeIntermediateTensorInfo(d),p}if(r!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return r;let c=this.activeTimers!=null,h;c&&(h=Y.now());let f;if(o==="complex64"){let g=this.readSync(s.real.dataId),d=this.readSync(s.imag.dataId);f=Re.mergeRealAndImagArrays(g,d)}else f=this.getValuesFromTexture(t);return c&&(this.downloadWaitMs+=Y.now()-h),this.convertAndCacheOnCPU(t,f)}read(t){return Te(this,null,function*(){if(this.pendingRead.has(t)){let p=this.pendingRead.get(t);return new Promise(m=>p.push(m))}let e=this.texData.get(t),{values:r,shape:o,slice:s,dtype:i,complexTensorInfos:a,isPacked:u}=e;if(s!=null){let p;u?p=new tp(o,x_):p=new Eu(o,x_);let m=this.runWebGLProgram(p,[{dataId:t,shape:o,dtype:i}],i),y=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),y}if(r!=null)return this.convertAndCacheOnCPU(t);if(!mt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&mt().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,h;if(i!=="complex64"&&mt().get("WEBGL_BUFFER_SUPPORTED")){h=this.decode(t);let p=this.texData.get(h.dataId);c=this.gpgpu.createBufferFromTexture(p.texture,...iy(o))}this.pendingRead.set(t,[]),i!=="complex64"&&(yield this.gpgpu.createAndWaitForFence());let f;if(i==="complex64"){let p=yield Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],y=p[1];f=Re.mergeRealAndImagArrays(m,y)}else if(c==null)f=this.getValuesFromTexture(t);else{let p=Y.sizeFromShape(o);f=this.gpgpu.downloadFloat32MatrixFromBuffer(c,p)}h!=null&&this.disposeIntermediateTensorInfo(h);let g=this.convertAndCacheOnCPU(t,f),d=this.pendingRead.get(t);return this.pendingRead.delete(t),d.forEach(p=>p(g)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),g})}bufferSync(t){let e=this.readSync(t.dataId),r=e;if(t.dtype==="string")try{r=e.map(o=>Y.decodeString(o))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Rn(t.shape,t.dtype,r)}checkNumericalProblems(t){if(t!=null)for(let e=0;e<t.length;e++){let r=t[e];if(!Mle(r))throw mt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(t){let{shape:e,dtype:r,isPacked:o}=this.texData.get(t),s=Y.sizeFromShape(e);if(mt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let g=this.decode(t),d=this.texData.get(g.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(d.texture,...iy(e)).subarray(0,s);return this.disposeIntermediateTensorInfo(g),p}let i=mt().getBool("WEBGL_PACK")&&o===!0,a=i?VA(e):e,u=i?new HA(a):new WA(a),c=this.runWebGLProgram(u,[{shape:a,dtype:r,dataId:t}],"float32"),h=this.texData.get(c.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture,h.texShape[0],h.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(c),f}time(t){return Te(this,null,function*(){let e=this.activeTimers,r=[],o=!1;this.programTimersStack==null?(this.programTimersStack=r,o=!0):this.activeTimers.push(r),this.activeTimers=r,t();let s=Y.flatten(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),i=Y.flatten(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=e,o&&(this.programTimersStack=null);let a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(mt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let u=yield Promise.all(s);a.kernelMs=Y.sum(u),a.getExtraProfileInfo=()=>u.map((c,h)=>({name:i[h],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return mt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Y.now(),endMs:null}}endTimer(t){return mt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Y.now(),t)}getQueryTime(t){return Te(this,null,function*(){if(mt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);let e=t;return e.endMs-e.startMs})}disposeData(t){if(this.pendingDisposal.has(t))return;if(this.pendingRead.has(t)){this.pendingDisposal.add(t),this.pendingDeletes++;return}if(!this.texData.has(t))return;if(this.texData.get(t).complexParentRefCount>0){this.texData.get(t).refCount--;return}this.releaseGPUData(t);let{complexTensorInfos:e}=this.texData.get(t);e!=null&&(this.texData.get(e.real.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(e.real),this.texData.get(e.imag.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(e.imag)),this.texData.delete(t)}releaseGPUData(t){let{texture:e,dtype:r,texShape:o,usage:s,isPacked:i,slice:a}=this.texData.get(t),u=a&&a.origDataId||t,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),e!=null&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(e,o,s,i)));let h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture}getDataInfo(t){return this.texData.get(t)}getCPUBackend(){return mt().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Vm().findBackend("cpu")),this.cpuBackend):null}shouldExecuteOnCPU(t,e=n6e){let r=this.getCPUBackend();return!mt().getBool("IS_TEST")&&!this.warnedAboutCPUBackend&&r==null&&(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),r!=null&&t.every(o=>this.texData.get(o.dataId).texture==null&&Y.sizeFromShape(o.shape)<e)}getGPGPUContext(){return this.gpgpu}where(t){Re.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let e=t.dataSync();return Z5e(t.shape,e)}packedUnaryOp(t,e,r){let o=new tp(t.shape,e);return this.compileAndRun(o,[t],r)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){let r=ZA(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,r)}if(mt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,o7,t.dtype);let e=new Eu(t.shape,o7);return this.compileAndRun(e,[t])}makeTensorInfo(t,e,r){let o;if(e==="string"&&r!=null&&r.length>0&&Y.isString(r[0])){let s=r.map(i=>Y.encodeString(i));o=this.write(s,t,e)}else o=this.write(r,t,e);return this.texData.get(o).usage=null,{dataId:o,shape:t,dtype:e}}makeOutput(t,e,r){let{dataId:o}=this.makeTensorInfo(t,e,r);return Vm().makeTensorFromDataId(o,t,e,this)}unpackTensor(t){let e=new t3(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){let e=new JA(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){let r=[ay(t.shape),...uy(t.shape)],o={dtype:t.dtype,shape:r,dataId:t.dataId},s=[ay(e),...uy(e)],i=new F2(s,r),u=this.runWebGLProgram(i,[o],t.dtype,null,!0);return{dataId:u.dataId,shape:e,dtype:u.dtype}}decode(t){let e=this.texData.get(t),{isPacked:r,shape:o,dtype:s}=e,i=VA(o),a;r?a=new GA(i):a=new qA(i);let c=this.runWebGLProgram(a,[{shape:i,dtype:s,dataId:t}],s,null,!0);return{dtype:s,shape:o,dataId:c.dataId}}runWebGLProgram(t,e,r,o,s=!1){let i=this.makeTensorInfo(t.outputShape,r),a=this.texData.get(i.dataId);if(t.packedOutput&&(a.isPacked=!0),t.outPackingScheme===Lx.DENSE){let m=iy(t.outputShape);a.texShape=m.map(y=>y*2)}if(t.outTexUsage!=null&&(a.usage=t.outTexUsage),Y.sizeFromShape(i.shape)===0)return a.values=Y.getTypedArrayFromDType(i.dtype,0),i;let u=[],c=e.map(m=>{if(m.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let y=this.texData.get(m.dataId);if(y.texture==null){if(!t.packedInputs&&Y.sizeFromShape(m.shape)<=mt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:m.shape,texData:null,isUniform:!0,uniformValues:y.values};t.packedInputs&&(y.isPacked=!0,y.shape=m.shape)}else if(!!y.isPacked!=!!t.packedInputs)m=y.isPacked?this.unpackTensor(m):this.packTensor(m),u.push(m),y=this.texData.get(m.dataId);else if(y.isPacked&&!zx(y.shape,m.shape)){let v=m,N=m.shape;m.shape=y.shape,m=this.packedReshape(m,N),u.push(m),y=this.texData.get(m.dataId),v.shape=N}return this.uploadToGPU(m.dataId),{shape:m.shape,texData:y,isUniform:!1}});this.uploadToGPU(i.dataId);let h={shape:i.shape,texData:a,isUniform:!1},f=Ape(t,c,h),g=this.getAndSaveBinary(f,()=>kpe(this.gpgpu,t,c,h)),d=this.activeTimers!=null,p;if(d&&(p=this.startTimer()),Dpe(this.gpgpu,g,c,h,o),u.forEach(m=>this.disposeIntermediateTensorInfo(m)),d&&(p=this.endTimer(p),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(p)})),!mt().getBool("WEBGL_LAZILY_UNPACK")&&a.isPacked&&s===!1){let m=this.unpackTensor(i);return this.disposeIntermediateTensorInfo(i),m}return i}compileAndRun(t,e,r,o,s=!1){r=r||e[0].dtype;let i=this.runWebGLProgram(t,e,r,o,s);return Vm().makeTensorFromDataId(i.dataId,i.shape,i.dtype)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(mt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=st(()=>{if(!mt().get("WEBGL_RENDER_FLOAT32_ENABLED")){let t=mt().getBool("DEBUG");mt().set("DEBUG",!1);let e=this.abs(sn(1e-8)).dataSync()[0];if(mt().set("DEBUG",t),e>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?J5e:e6e}uploadToGPU(t){let e=this.texData.get(t),{shape:r,dtype:o,values:s,texture:i,usage:a,isPacked:u}=e;if(i!=null)return;let c=this.activeTimers!=null,h;c&&(h=Y.now());let f=e.texShape;if(f==null&&(f=Hle(r,u),e.texShape=f),s!=null){let g=VA(r),d,p=f[1],m=f[0],y=s instanceof Uint8Array;u?([p,m]=af(f[0],f[1]),d=new XA(g,[m,p],y)):d=new KA(g,[m,p],y);let v=this.makeTensorInfo([m,p],o);y?this.texData.get(v.dataId).usage=Za.PIXELS:this.texData.get(v.dataId).usage=Za.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),p,m,s);let T=this.runWebGLProgram(d,[v],o,null,!0),O=this.texData.get(T.dataId);e.texture=O.texture,e.texShape=O.texShape,e.isPacked=O.isPacked,e.usage=O.usage,this.disposeIntermediateTensorInfo(v),this.texData.delete(T.dataId),e.values=null,c&&(this.uploadWaitMs+=Y.now()-h)}else{let g=this.acquireTexture(f,a,o,u);e.texture=g}}convertAndCacheOnCPU(t,e){let r=this.texData.get(t),{dtype:o}=r;return this.releaseGPUData(t),e!=null&&(r.values=s6e(e,o)),r.values}acquireTexture(t,e,r,o){if(this.numBytesInGPU+=this.computeBytes(t,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,o)}computeBytes(t,e){return t[0]*t[1]*Y.bytesPerElement(e)}}});var s7,She=D(()=>{"use strict";s7="2.8.6"});var Che=D(()=>{"use strict";ve();});var Ihe=D(()=>{"use strict";ve();whe();She();Che();b0.isBrowser()&&UC("webgl",()=>new r3,2)});var o3,sl,cy=D(()=>{"use strict";ve();o3=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,sl=class{constructor(t,e,r){this.variableNames=["A","B"],this.outputShape=Re.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}});var ly,np,cf=D(()=>{"use strict";ve();Zp();Gs();ly=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`,np=class{constructor(t,e,r,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Re.assertAndGetBroadcastShape(e,r);let s=this.outputShape.length,i="";if(o)if(s===0||Y.sizeFromShape(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${pr(s)} coords = getOutputCoords();
        `,s===1)i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let u=Ms("coords",s);i+=`
            bool nextRowOutOfBounds =
              (${u[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${u[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}});function Fs(n){let{inputs:t,backend:e}=n,{x:r}=t;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var _he,il=D(()=>{"use strict";ve();_he={kernelName:um,backendName:"webgl",kernelFunc:Fs}});function Xu(n){let{inputs:t,backend:e}=n,{real:r,imag:o}=t,s=e.makeTensorInfo(r.shape,"complex64"),i=e.texData.get(s.dataId),a=Fs({inputs:{x:r},backend:e}),u=e.texData.get(a.dataId);u.complexParentRefCount++;let c=Fs({inputs:{x:o},backend:e}),h=e.texData.get(c.dataId);return h.complexParentRefCount++,i.complexTensorInfos={real:a,imag:c},s}var The,pg=D(()=>{"use strict";ve();il();The={kernelName:a1,backendName:"webgl",kernelFunc:Xu}});function i6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{alpha:s}=r,i=e.makeTensorInfo([],"float32",Y.createScalarValue(s,"float32")),a=mt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new np(a7,o.shape,i.shape):new sl(i7,o.shape,i.shape),u=e.runWebGLProgram(a,[o,i],o.dtype);return e.disposeIntermediateTensorInfo(i),u}var i7,a7,Ehe,u7=D(()=>{"use strict";ve();cy();cf();i7="return (a < 0.) ? b * a : a;",a7=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;Ehe={kernelName:cm,backendName:"webgl",kernelFunc:i6e}});function a6e(n){let{inputs:t,backend:e}=n,{x:r,alpha:o}=t,s=mt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new np(l7,r.shape,o.shape):new sl(c7,r.shape,o.shape);return e.runWebGLProgram(s,[r,o],r.dtype)}var c7,l7,Nhe,p7=D(()=>{"use strict";ve();cy();cf();c7="return (a < 0.) ? b * a : a;",l7=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;Nhe={kernelName:Sm,backendName:"webgl",kernelFunc:a6e}});function An({opSnippet:n,packedOpSnippet:t,cpuKernelImpl:e,dtype:r}){return({inputs:o,backend:s})=>{let{x:i}=o,a=s,u=r||i.dtype;if(a.shouldExecuteOnCPU([i])&&e!=null){let f=a.texData.get(i.dataId),g=e(f.values,u);return a.makeTensorInfo(i.shape,u,g)}let c=mt().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,h;return c?h=new tp(i.shape,t):h=new Eu(i.shape,n),a.runWebGLProgram(h,[i],u)}}function ro({opSnippet:n,packedOpSnippet:t,checkOutOfBounds:e=!1,supportsComplex:r=!1,cpuKernelImpl:o,dtype:s}){return({inputs:i,backend:a})=>{let{a:u,b:c}=i,h=a;if(r&&u.dtype==="complex64"){let p=h.texData.get(u.dataId),m=h.texData.get(c.dataId),[y,v]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(T=>{let[O,S]=T,F={dataId:O.dataId,dtype:O.dtype,shape:u.shape},R={dataId:S.dataId,dtype:S.dtype,shape:c.shape},L=new sl(n,u.shape,c.shape);return h.runWebGLProgram(L,[F,R],ci(O.dtype,S.dtype))}),N=Xu({inputs:{real:y,imag:v},backend:h});return h.disposeIntermediateTensorInfo(y),h.disposeIntermediateTensorInfo(v),N}let f=s||ci(u.dtype,c.dtype);if(h.shouldExecuteOnCPU([u,c])&&o!=null){let p=h.texData.get(u.dataId),m=h.texData.get(c.dataId),[y,v]=o(u.shape,c.shape,p.values,m.values,f),N=h.makeTensorInfo(v,f),T=h.texData.get(N.dataId);return T.values=y,N}let g=mt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,d;return g?d=new np(t,u.shape,c.shape,e):d=new sl(n,u.shape,c.shape),h.runWebGLProgram(d,[u,c],f)}}function py(n,t=!1){if(n==="linear")return t?ghe:phe;if(n==="relu")return t?xhe:dhe;if(n==="elu")return t?yhe:hhe;if(n==="relu6")return t?bhe:fhe;if(n==="prelu")return t?l7:c7;if(n==="leakyrelu")return t?a7:i7;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}var s3,khe,Dhe,Xn=D(()=>{"use strict";ve();cy();cf();pg();u7();p7();Ja();Ja();P2();P2();s3="if (isnan(x)) return x;",khe=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,Dhe=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`});var $2,h7=D(()=>{"use strict";$2=class{constructor(t,e,r,o=!1,s=!1,i=!1,a=null,u=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;let h=o?t[1]:t[2],f=Math.ceil(h/2),g=o?"i * 2, rc.y":"rc.y, i * 2",d=s?"rc.z, i * 2":"i * 2, rc.z",p=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],y="",v="";a&&(u?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:y=`vec4 activation(vec4 x) {
          ${a}
        }`,v="result = activation(result);");let N=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let T="rc.x",O="rc.x";t[0]<e[0]?T=`int(min(float(rc.x), ${t[0]-1}.))`:e[0]<t[0]&&(O=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`
      ${y}

      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${f}; i++) {
          int batchA = ${T};
          int batchB = ${O};
          vec4 a = getMatrixA(batchA, ${g});
          vec4 b = getMatrixB(batchB, ${d});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${N}

        ${v}

        setOutput(result);
      }
    `}}});var d7,b_,f7=D(()=>{"use strict";ve();d7={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},b_=class{constructor(t,e,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Re.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}});function m7(n){let{inputs:t,backend:e}=n,{a:r,b:o}=t,s=Re.upcastType(r.dtype,o.dtype);if(r.dtype==="complex64"){let a=e.texData.get(r.dataId),u=e.texData.get(o.dataId),c=new b_(d7.REAL,r.shape,o.shape),h=new b_(d7.IMAG,r.shape,o.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:o.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:o.shape}],g=e.runWebGLProgram(c,f,"float32"),d=e.runWebGLProgram(h,f,"float32"),p=Xu({inputs:{real:g,imag:d},backend:e});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(d),p}if(e.shouldExecuteOnCPU([r,o])){let a=e.texData.get(r.dataId),u=e.texData.get(o.dataId),[c,h]=Kpe(r.shape,o.shape,a.values,u.values,s),f=e.makeTensorInfo(h,s),g=e.texData.get(f.dataId);return g.values=c,f}let i;return mt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new np(Ahe,r.shape,o.shape):i=new sl(Ahe,r.shape,o.shape),e.runWebGLProgram(i,[r,o],s)}var Ahe,Ohe,g7=D(()=>{"use strict";ve();f7();f7();cy();cf();Vo();pg();Ahe="return a * b;";Ohe={kernelName:sd,backendName:"webgl",kernelFunc:m7}});function Rhe(n,t,e){let r=[ay(n.shape),...uy(n.shape)],o={dtype:n.dtype,shape:r,dataId:n.dataId},s=[ay(t),...uy(t)],i=new F2(s,r),u=e.runWebGLProgram(i,[o],n.dtype,null,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}var Mhe=D(()=>{"use strict";r7();ol();});function dn(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{shape:s}=r,i=e,a=Y.sizeFromShape(o.shape),u=Y.inferFromImplicitShape(s,a),c=Y.sizeFromShape(u);Y.assert(a===c,()=>`The new shape (${u}) has ${c} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let h=i.texData.get(o.dataId);return h.isPacked&&!zx(o.shape,u)&&!(h.texture!==null&&zx(h.shape,u))?Rhe(o,u,i):(i.incRef(o.dataId),{dataId:o.dataId,shape:u,dtype:o.dtype})}var Fhe,Wo=D(()=>{"use strict";ve();Mhe();ol();Fhe={kernelName:Cm,backendName:"webgl",kernelFunc:dn}});var v_,Phe=D(()=>{"use strict";ve();v_=class{constructor(t,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:s,outSize:i}=t;this.outputShape=[o,i];let a=Math.floor(r/4)*4,u=r%4,c="sumValue += dot(values, ones);";if(e!=null){let f=1/e;c=`sumValue += dot(values * ${Y.isInt(f)?f.toPrecision(2):f}, ones);`}let h="";s%r>0&&(h=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}});var i3,$he=D(()=>{"use strict";i3=class{constructor(t,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:s,outSize:i}=t;this.outputShape=[o,i];let a="0.0",u="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",u="min"):e==="max"&&(a="-1.0 / 1e-20",u="max");let c=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?c="sumValue":e==="prod"?c="prodValue":e==="all"?c="allValue":e==="any"&&(c="anyValue");let h=Math.floor(r/4)*4,f=r%4,g=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
      }
    `,d="vec4";e==="all"?(a="1.0",g=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):e==="any"&&(a="0.0",g=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let p="";s%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${g}
        }

        int inIdx = inOffset + ${h};
        if (${f===1}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${g}
        } else if (${f===2}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${g}
        } else if (${f===3}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${g}
        }
        setOutput(${c});
      }
    `}}});function c6e(n){let t=[];for(;t.length===0||t[t.length-1].outSize!==1;){let e=t.length?t[t.length-1].outSize:n[1],r=Re.computeOptimalWindowSize(e);t.push({inSize:e,windowSize:r,outSize:Math.ceil(e/r)})}return t}function bc(n,t,e,r){let o=c6e(n.shape),s=n;for(let i=0;i<o.length;i++){let{inSize:a,windowSize:u,outSize:c}=o[i],h,f;e==="mean"?h=i===0?new v_({windowSize:u,inSize:a,batchSize:n.shape[0],outSize:c},a):new v_({windowSize:u,inSize:a,batchSize:n.shape[0],outSize:c}):h=new i3({windowSize:u,inSize:a,batchSize:n.shape[0],outSize:c},e),f=s,s=r.runWebGLProgram(h,[s],t),f.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(f)}return s}var hy=D(()=>{"use strict";ve();Phe();$he();});function l6e(n){let t=n.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let o=0;o<n.length;o++)r[n[o]]=e[o];return r.join()}var a3,Lhe=D(()=>{"use strict";Gs();a3=class{constructor(t,e){this.variableNames=["A"];let r=new Array(t.length);for(let i=0;i<r.length;i++)r[i]=t[e[i]];this.outputShape=r,this.rank=r.length;let o=pr(this.rank),s=l6e(e);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}}});var u3,Bhe=D(()=>{"use strict";Zp();Gs();u3=class{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let r=new Array(t.length);for(let h=0;h<r.length;h++)r[h]=t[e[h]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=pr(this.rank),s=n7("rc",this.rank),i=new Array(this.rank);for(let h=0;h<e.length;h++)i[e[h]]=s[h];let a=`vec2(${i.slice(-2).join()})`,u=`++${s[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${u}) {
        result[1] = ${c};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${u}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}});function dy(n,t,e){let r=mt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new u3(n.shape,t):new a3(n.shape,t);return e.runWebGLProgram(r,[n],n.dtype)}var L2=D(()=>{"use strict";ve();Vo();Lhe();Bhe();});function zhe(n,t,e,r){let o=t,s=n.shape.length,i=Y.parseAxisParam(o,n.shape),a=i,u=Re.getAxesPermutation(a,s),c=u!=null,h=n;c&&(h=dy(n,u,r),a=Re.getInnerMostAxes(a.length,s)),Re.assertAxesAreInnerMostDims("sum",a,s);let[f,g]=Re.computeOutAndReduceShapes(h.shape,a),d=f;e&&(d=Re.expandShapeToKeepDim(f,i));let p=Y.sizeFromShape(g),y=Y.sizeFromShape(n.shape)/p,v=dn({inputs:{x:h},attrs:{shape:[y,p]},backend:r}),N=x0(n.dtype),T=bc(v,N,"sum",r),O=dn({inputs:{x:T},attrs:{shape:d},backend:r});return r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(T),c&&r.disposeIntermediateTensorInfo(h),O}var Vhe=D(()=>{"use strict";ve();hy();Wo();L2();});function w_(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,keepDims:i}=r;return zhe(o,s,i,e)}var jhe,c3=D(()=>{"use strict";ve();Vhe();jhe={kernelName:km,backendName:"webgl",kernelFunc:w_}});function Ss(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{perm:s}=r,i=e,a=o.shape.length,u=new Array(a);for(let h=0;h<u.length;h++)u[h]=o.shape[s[h]];let c;if(i.shouldExecuteOnCPU([o])){let f=i.texData.get(o.dataId).values,g=jx(f,o.shape,o.dtype,s,u);c=i.makeTensorInfo(u,o.dtype);let d=i.texData.get(c.dataId);d.values=g}else c=dy(o,s,i);return c}var Uhe,al=D(()=>{"use strict";ve();L2();L2();Uhe={kernelName:Rm,backendName:"webgl",kernelFunc:Ss}});function Ux({a:n,b:t,transposeA:e,transposeB:r,backend:o,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:u=null}){let c=n.shape.length,h=t.shape.length,f=e?n.shape[c-2]:n.shape[c-1],g=r?t.shape[h-1]:t.shape[h-2],d=e?n.shape[c-1]:n.shape[c-2],p=r?t.shape[h-2]:t.shape[h-1],m=n.shape.slice(0,-2),y=t.shape.slice(0,-2),v=Y.sizeFromShape(m),N=Y.sizeFromShape(y),T=v===N||v===1||N===1;Y.assert(c>=2&&h>=2&&T,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${m}) and (${y}).`);let S=(v>N?n.shape.slice(0,-2):t.shape.slice(0,-2)).concat([d,p]);Y.assert(f===g,()=>`Error in matMul: inner shapes (${f}) and (${g}) of Tensors with shapes ${n.shape} and ${t.shape} and transposeA=${e} and transposeB=${r} must match.`);let F=e?[v,f,d]:[v,d,f],R=r?[N,p,g]:[N,g,p],L=dn({inputs:{x:n},backend:o,attrs:{shape:F}}),q=dn({inputs:{x:t},backend:o,attrs:{shape:R}}),U=[L,q],Z=Math.max(v,N),ee=e?L.shape[1]:L.shape[2],Q=s!=null,oe=i!=null,se=u==="leakyrelu",pe=u!=null?py(u,!0):null,ae=Q||oe||se||pe!=null,fe;if((d===1||p===1)&&ee>y7&&ae===!1){let Ee=L,Le=q;e&&(Ee=Ss({inputs:{x:L},backend:o,attrs:{perm:[0,2,1]}}),U.push(Ee)),r&&(Le=Ss({inputs:{x:q},backend:o,attrs:{perm:[0,2,1]}}),U.push(Le));let Ve=p!==1,qe=p===1,je=Ee;Ve&&(je=dn({inputs:{x:Ee},backend:o,attrs:{shape:[Z,ee,1]}}),U.push(je));let Ce=p===1?2:1,tt=Le;qe&&(tt=dn({inputs:{x:Le},backend:o,attrs:{shape:[Z,1,ee]}}),U.push(tt));let ye=m7({inputs:{a:je,b:tt},backend:o});fe=w_({inputs:{x:ye},backend:o,attrs:{axis:Ce,keepDims:!0}}),U.push(ye)}else{let Ee=ci(n.dtype,t.dtype),Le=new $2(F,R,[Z,d,p],e,r,Q,pe,oe,se),Ve=[L,q];if(s!=null&&Ve.push(s),oe&&Ve.push(i),se){let qe=o.makeTensorInfo([],"float32",Y.createScalarValue(a,"float32"));Ve.push(qe),U.push(qe)}fe=o.runWebGLProgram(Le,Ve,Ee)}let he=dn({inputs:{x:fe},backend:o,attrs:{shape:S}});U.push(fe);for(let Ee of U)o.disposeIntermediateTensorInfo(Ee);return he}var y7,l3=D(()=>{"use strict";ve();Xn();h7();g7();Wo();c3();al();y7=1e3});function p6e(n){let{inputs:t,backend:e,attrs:r}=n,{a:o,b:s,bias:i,preluActivationWeights:a}=t,{transposeA:u,transposeB:c,activation:h,leakyreluAlpha:f}=r;return Ux({a:o,b:s,transposeA:u,transposeB:c,backend:e,bias:i,preluActivationWeights:a,leakyreluAlpha:f,activation:h})}var qhe,Ghe=D(()=>{"use strict";ve();l3();qhe={kernelName:f0,backendName:"webgl",kernelFunc:p6e}});function h6e(n){let{inputs:t,backend:e}=n,{x:r}=t;if(e.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let s=e.texData.get(r.dataId),i=ZA(s.values);return e.makeTensorInfo(r.shape,r.dtype,i)}let o;return mt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new tp(r.shape,Whe):o=new Eu(r.shape,Whe),e.runWebGLProgram(o,[r],r.dtype)}var Whe,Hhe,Khe=D(()=>{"use strict";ve();Vo();Ja();P2();Whe="return abs(x);";Hhe={kernelName:Uf,backendName:"webgl",kernelFunc:h6e}});var d6e,f6e,Xhe,Yhe=D(()=>{"use strict";ve();Xn();Ja();d6e=Vi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,f6e=An({opSnippet:d6e}),Xhe={kernelName:Oh,backendName:"webgl",kernelFunc:f6e}});var m6e,g6e,Qhe,Zhe=D(()=>{"use strict";ve();Xn();Ja();m6e=Vi+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,g6e=An({opSnippet:m6e}),Qhe={kernelName:Rh,backendName:"webgl",kernelFunc:g6e}});var Jhe,y6e,ede,tde=D(()=>{"use strict";ve();Xn();Vo();Jhe="return a + b;",y6e=ro({opSnippet:Jhe,packedOpSnippet:Jhe,supportsComplex:!0,cpuKernelImpl:Rpe}),ede={kernelName:Nl,backendName:"webgl",kernelFunc:y6e}});var p3,nde=D(()=>{"use strict";p3=class{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map((s,i)=>`T${i}`);let r=[];this.variableNames.forEach(s=>{r.push(`float v${s} = get${s}AtOutCoords();`)});let o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}}});var h3,rde=D(()=>{"use strict";h3=class{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map((s,i)=>`T${i}`);let r=[];this.variableNames.forEach(s=>{r.push(`vec4 v${s} = get${s}AtOutCoords();`)});let o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}}});function d3(n){let{inputs:t,backend:e}=n,r=t;if(r.length===1)return Fs({inputs:{x:r[0]},backend:e});if(r.length>mt().get("WEBGL_MAX_TEXTURES_IN_SHADER")){let u=Math.floor(r.length/2),c=d3({inputs:r.slice(0,u),backend:e}),h=d3({inputs:r.slice(u),backend:e});return d3({inputs:[c,h],backend:e})}let o=r.map(u=>u.dtype).reduce((u,c)=>ci(u,c)),s=r.map(u=>u.shape),a=mt().getBool("WEBGL_PACK")?new h3(r[0].shape,s):new p3(r[0].shape,s);return e.runWebGLProgram(a,r,o)}var ode,sde=D(()=>{"use strict";ve();nde();rde();il();ode={kernelName:qf,backendName:"webgl",kernelFunc:d3}});function x6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,keepDims:i}=r,a=o.shape.length,u=Y.parseAxisParam(s,o.shape),c=u,h=Re.getAxesPermutation(c,a),f=o;h!=null&&(f=Ss({inputs:{x:o},backend:e,attrs:{perm:h}}),c=Re.getInnerMostAxes(c.length,a)),Re.assertAxesAreInnerMostDims("all",c,a);let[g,d]=Re.computeOutAndReduceShapes(f.shape,c),p=Y.sizeFromShape(d),m=dn({inputs:{x:f},backend:e,attrs:{shape:[-1,p]}}),y=bc(m,m.dtype,"all",e),v;if(i){let N=Re.expandShapeToKeepDim(g,u);v=dn({inputs:{x:y},backend:e,attrs:{shape:N}})}else v=dn({inputs:{x:y},backend:e,attrs:{shape:g}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),h!=null&&e.disposeIntermediateTensorInfo(f),v}var ide,ade=D(()=>{"use strict";ve();hy();Wo();al();ide={kernelName:n1,backendName:"webgl",kernelFunc:x6e}});function b6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,keepDims:i}=r,a=o.shape.length,u=Y.parseAxisParam(s,o.shape),c=u,h=Re.getAxesPermutation(c,a),f=o;h!=null&&(f=Ss({inputs:{x:o},backend:e,attrs:{perm:h}}),c=Re.getInnerMostAxes(c.length,a)),Re.assertAxesAreInnerMostDims("any",c,a);let[g,d]=Re.computeOutAndReduceShapes(f.shape,c),p=Y.sizeFromShape(d),m=dn({inputs:{x:f},backend:e,attrs:{shape:[-1,p]}}),y=bc(m,m.dtype,"any",e),v;if(i){let N=Re.expandShapeToKeepDim(g,u);v=dn({inputs:{x:y},backend:e,attrs:{shape:N}})}else v=dn({inputs:{x:y},backend:e,attrs:{shape:g}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),h!=null&&e.disposeIntermediateTensorInfo(f),v}var ude,cde=D(()=>{"use strict";ve();hy();Wo();al();ude={kernelName:r1,backendName:"webgl",kernelFunc:b6e}});var f3,lde=D(()=>{"use strict";f3=class{constructor(t,e,r){this.variableNames=["A"];let{windowSize:o,batchSize:s,outSize:i}=t;r||this.variableNames.push("bestIndicesA"),this.outputShape=[s,i];let a=e==="max"?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}});var m3,pde=D(()=>{"use strict";ve();Zp();Gs();m3=class{constructor(t,e,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Y.assert(t.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);let s=t[t.length-1],i=Math.ceil(s/e);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,u=a.length,c=pr(u),h=Ms("coords",u),f,g;if(i===1){g=u+1;let L=pr(g);f=`
        ${L} sourceLocR = ${L}(${h.join()}, 0);
        ++${h[u-1]};
        ${L} sourceLocG = ${L}(${h.join()}, 0);
        ++${h[u-2]};
        ${L} sourceLocA = ${L}(${h.join()}, 0);
        --${h[u-1]};
        ${L} sourceLocB = ${L}(${h.join()}, 0);
        --${h[u-2]};`}else g=u,f=`
        ${c} sourceLocR = coords;
        ++${h[u-1]};
        ${c} sourceLocG = coords;
        ++${h[u-2]};
        ${c} sourceLocA = coords;
        --${h[u-1]};
        ${c} sourceLocB = coords;
        --${h[u-2]};`;let d=["x","y","z","w","u","v"].slice(0,g),p="."+d[g-1],m=d.map(L=>"int "+L),y=Ms("sourceLocR",g-1).concat("inIdx.r"),v=Ms("sourceLocG",g-1).concat("inIdx.g"),N=Ms("sourceLocB",g-1).concat("inIdx.b"),T=Ms("sourceLocA",g-1).concat("inIdx.a"),O=r==="max"?"greaterThan":"lessThan",S=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${N.join()}),
                             getBestIndicesAChannel(${T.join()})));`,F=`vec4(
            getAChannel(${y.join()}),
            hasNextCol ? getAChannel(${v.join()}) : 0.,
            hasNextRow ? getAChannel(${N.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${T.join()}) : 0.)`,R=o?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${d.join()}),
                                          vec2(${d.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${d.join()}),
                               vec2(${d.slice(-2).join()}));
      }
      ${R}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${h[u-1]} < ${a[u-1]-1};
        bool hasNextRow = ${h[u-2]} < ${a[u-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${F};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${F};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${O}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}});function hde(n,t,e,r=null){let o=t.shape[0],s=t.shape[1];r!=null&&(o=r.shape[0],s=r.shape[1]);let i=Re.computeOptimalWindowSize(s),a={windowSize:i,inSize:s,batchSize:o,outSize:Math.ceil(s/i)},u=new f3(a,e,r==null),c=[t];r!=null&&c.push(r);let h=n.runWebGLProgram(u,c,"int32");if(h.shape[1]===1)return h;let f=hde(n,t,e,h);return n.disposeIntermediateTensorInfo(h),f}function dde(n,t,e,r=null){let o=r!=null?r.shape:t.shape,s=o[o.length-1],i=Re.computeOptimalWindowSize(s),a=new m3(o,i,e,r==null),u=r==null?[t]:[t,r],c=n.runWebGLProgram(a,u,"int32");if(c.shape.length===t.shape.length){let h=dde(n,t,e,c);return n.disposeIntermediateTensorInfo(c),h}return c}function g3(n,t,e,r){let o=[e];if(Re.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,t.shape.length),!mt().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){let s=[],[i,a]=Re.computeOutAndReduceShapes(t.shape,o),u=Y.sizeFromShape(a),c=dn({inputs:{x:t},backend:n,attrs:{shape:[-1,u]}});s.push(c);let h=hde(n,c,r);s.push(h);let f=dn({inputs:{x:h},backend:n,attrs:{shape:i}});return s.forEach(g=>n.disposeIntermediateTensorInfo(g)),f}return dde(n,t,r)}var x7=D(()=>{"use strict";ve();lde();pde();Wo();});function v6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s}=r,i=Y.parseAxisParam(s,o.shape),a=Re.getAxesPermutation(i,o.shape.length),u=o,c=[];a!=null&&(u=Ss({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(u),i=Re.getInnerMostAxes(i.length,u.shape.length)),Re.assertAxesAreInnerMostDims("argMax",[i[0]],u.shape.length);let h=g3(e,u,i[0],"max");return c.forEach(f=>e.disposeIntermediateTensorInfo(f)),h}var fde,mde=D(()=>{"use strict";ve();x7();al();fde={kernelName:Gf,backendName:"webgl",kernelFunc:v6e}});function w6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s}=r,i=Y.parseAxisParam(s,o.shape),a=Re.getAxesPermutation(i,o.shape.length),u=o,c=[];a!=null&&(u=Ss({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(u),i=Re.getInnerMostAxes(i.length,u.shape.length)),Re.assertAxesAreInnerMostDims("argMin",[i[0]],u.shape.length);let h=g3(e,u,i[0],"min");return c.forEach(f=>e.disposeIntermediateTensorInfo(f)),h}var gde,yde=D(()=>{"use strict";ve();x7();al();gde={kernelName:Wf,backendName:"webgl",kernelFunc:w6e}});var S6e,C6e,xde,bde=D(()=>{"use strict";ve();Xn();Ja();S6e=Vi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,C6e=An({opSnippet:S6e}),xde={kernelName:Mh,backendName:"webgl",kernelFunc:C6e}});var I6e,_6e,vde,wde=D(()=>{"use strict";ve();Xn();Ja();I6e=Vi+"return log(x + sqrt(x * x + 1.0));",_6e=An({opSnippet:I6e}),vde={kernelName:Fh,backendName:"webgl",kernelFunc:_6e}});var T6e,E6e,Sde,Cde=D(()=>{"use strict";ve();Xn();Ja();T6e=Vi+`
  return atan(x);
`,E6e=An({opSnippet:T6e}),Sde={kernelName:Ph,backendName:"webgl",kernelFunc:E6e}});var N6e,k6e,D6e,Ide,_de=D(()=>{"use strict";ve();Xn();N6e=khe+`
  return atan(a, b);
`,k6e=`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Dhe+`
  return result;
`,D6e=ro({opSnippet:N6e,packedOpSnippet:k6e}),Ide={kernelName:Lh,backendName:"webgl",kernelFunc:D6e}});var A6e,O6e,Tde,Ede=D(()=>{"use strict";ve();Xn();Ja();A6e=Vi+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,O6e=An({opSnippet:A6e}),Tde={kernelName:$h,backendName:"webgl",kernelFunc:O6e}});var Jp,fy,my=D(()=>{"use strict";Jp=class{constructor(t,e,r,o=!1,s=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let i=t.filterWidth,a=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,h=t.dilationWidth,f=t.effectiveFilterHeight,g=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;let m=e==="avg",y=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,v=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`,N="0.0";if(m||(N="-1.0 / 1e-20"),r){let L=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${u});
        const ivec2 pads = ivec2(${d}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g};
                wC += ${h}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${L} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?s?y:v:`wR * ${g} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let T="max",O=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(O="avgValue / count");let S=Math.floor(i/4)*4,F=i%4,R=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${T}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${u});
      const ivec2 pads = ivec2(${d}, ${p});
      const float initializationValue = ${N};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${N});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${h};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              getValue(batch, xR, xC + 3 * ${h}, d)
            );

            ${R}
          }

          int xC = xCCorner + ${S};
          if (${F===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${R}
          } else if (${F===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              initializationValue,
              initializationValue
            );

            ${R}
          } else if (${F===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              initializationValue
            );

            ${R}
          }
        }
        setOutput(${O});
      }
    `}},fy=class{constructor(t,e,r,o=!1,s=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let i=t.filterWidth,a=t.strideDepth,u=t.strideHeight,c=t.strideWidth,h=t.dilationDepth,f=t.dilationHeight,g=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,m=t.effectiveFilterWidth,y=t.padInfo.front,v=t.padInfo.top,N=t.padInfo.left;this.outputShape=t.outShape;let T=e==="avg",O="0.0";if(T||(O="-1.0 / 1e-20"),r){let U=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${u}, ${c});
        const ivec3 pads = ivec3(${y}, ${v}, ${N});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${h}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${g}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${U} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?s?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let S="max",F=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(F="avgValue / count");let R=Math.floor(i/4)*4,L=i%4,q=`
      if (${T}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${u}, ${c});
      const ivec3 pads = ivec3(${y}, ${v}, ${N});
      const float initializationValue = ${O};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${O});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${h}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${R}; wC += 4) {
              int xC = xCCorner + wC * ${g};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${g}, ch),
                getValue(batch, xD, xR, xC + 2 * ${g}, ch),
                getValue(batch, xD, xR, xC + 3 * ${g}, ch)
              );

              ${q}
            }

            int xC = xCCorner + ${R};
            if (${L===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${q}
            } else if (${L===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${g}, ch),
                initializationValue,
                initializationValue
              );

              ${q}
            } else if (${L===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${g}, ch),
                getValue(batch, xD, xR, xC + 2 * ${g}, ch),
                initializationValue
              );

              ${q}
            }
          }
          setOutput(${F});
        }
      }
    `}}});function R6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t;uf(o,"avgPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:u}=r,c=1;Y.assert(Re.eitherStridesOrDilationsAreOne(i,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let h=Re.computePool2DInfo(o.shape,s,i,c,a,u);if(h.filterWidth===1&&h.filterHeight===1&&Y.arraysEqual(h.inShape,h.outShape))return Fs({inputs:{x:o},backend:e});let f=new Jp(h,"avg",!1);return e.runWebGLProgram(f,[o],"float32")}var Nde,kde=D(()=>{"use strict";ve();my();ol();il();Nde={kernelName:Hf,backendName:"webgl",kernelFunc:R6e}});function M6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:s,strides:i,pad:a,dimRoundingMode:u,dataFormat:c}=r,h=[1,1,1],f=Re.computePool3DInfo(o.shape,s,i,h,a,u,c),g=new fy(f,"avg",!1);return e.runWebGLProgram(g,[o],"float32")}var Dde,Ade=D(()=>{"use strict";ve();my();Dde={kernelName:Kf,backendName:"webgl",kernelFunc:M6e}});var y3,x3,b7=D(()=>{"use strict";y3=class{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;let e=t.filterHeight,r=t.filterWidth,o=t.strideHeight,s=t.strideWidth,i=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,h=u-1-t.padInfo.top,f=c-1-t.padInfo.left,g=1/(e*r);this.userCode=`
      const ivec2 pads = ivec2(${h}, ${f});
      const float avgMultiplier = float(${g});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},x3=class{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;let e=t.filterDepth,r=t.filterHeight,o=t.filterWidth,s=t.strideDepth,i=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,h=t.dilationWidth,f=t.effectiveFilterDepth,g=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=f-1-t.padInfo.front,m=g-1-t.padInfo.top,y=d-1-t.padInfo.left,v=1/(e*r*o);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${y});
      const float avgMultiplier = float(${v});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${g};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}});function F6e(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:s}=t,i=s,{filterSize:a,strides:u,pad:c,dimRoundingMode:h}=r,f=[1,1,1],g=Re.computePool3DInfo(i.shape,a,u,f,c,h),d=new x3(g);return e.runWebGLProgram(d,[o],i.dtype)}var Ode,Rde=D(()=>{"use strict";ve();b7();Ode={kernelName:s1,backendName:"webgl",kernelFunc:F6e}});function P6e(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:s}=t,i=s;uf([o,s],"avgPoolGrad");let{filterSize:a,strides:u,pad:c}=r,h=Re.computePool2DInfo(i.shape,a,u,1,c),f=new y3(h);return e.runWebGLProgram(f,[o],i.dtype)}var Mde,Fde=D(()=>{"use strict";ve();b7();ol();Mde={kernelName:o1,backendName:"webgl",kernelFunc:P6e}});function $6e(n){let{inputs:t,backend:e,attrs:r}=n,{a:o,b:s}=t,{transposeA:i,transposeB:a}=r;return Ux({a:o,b:s,transposeA:i,transposeB:a,backend:e})}var Pde,$de=D(()=>{"use strict";ve();l3();Pde={kernelName:Xf,backendName:"webgl",kernelFunc:$6e}});var b3,Lde=D(()=>{"use strict";ve();b3=class{constructor(t,e,r,o,s,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Re.assertAndGetBroadcastShape(t,e),Re.assertAndGetBroadcastShape(t,r);let a="0.0";o!=null&&(Re.assertAndGetBroadcastShape(t,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="1.0";s!=null&&(Re.assertAndGetBroadcastShape(t,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}});var v3,Bde=D(()=>{"use strict";ve();v3=class{constructor(t,e,r,o,s,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Re.assertAndGetBroadcastShape(t,e),Re.assertAndGetBroadcastShape(t,r);let a="vec4(0.0)";o!=null&&(Re.assertAndGetBroadcastShape(t,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="vec4(1.0)";s!=null&&(Re.assertAndGetBroadcastShape(t,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}});var L6e,zde,Vde=D(()=>{"use strict";ve();Lde();Bde();L6e=({inputs:n,backend:t,attrs:e})=>{let{x:r,mean:o,variance:s,offset:i,scale:a}=n;Y.assert(o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),Y.assert(i==null||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),Y.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=e;u==null&&(u=.001);let c=[r,o,s],h=null;i!=null&&(h=i.shape,c.push(i));let f=null;a!=null&&(f=a.shape,c.push(a));let g=mt().getBool("WEBGL_PACK_NORMALIZATION")?new v3(r.shape,o.shape,s.shape,h,f,u):new b3(r.shape,o.shape,s.shape,h,f,u);return t.runWebGLProgram(g,c,c[0].dtype)},zde={kernelName:im,backendName:"webgl",kernelFunc:L6e}});function B6e(n){if(n===1)return"sourceLoc";if(n<=6)return v7.slice(0,n).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}var w3,v7,jde=D(()=>{"use strict";Gs();w3=class{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;let e=pr(this.rank),r=`uniform int start[${this.rank}];`,o=B6e(this.rank),s,i=t.map((a,u)=>`sourceLoc.${v7[u]} = start[${u}] + coords.${v7[u]};`);s=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      ${r}
      void main() {
        ${s}
        setOutput(getSource(${o}));
      }
    `}getCustomSetupFunc(t){if(t.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${t.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,t)}}},v7=["x","y","z","w","u","v"]});var S3,Ude=D(()=>{"use strict";Zp();Gs();S3=class{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;let e=pr(this.rank),r=Ms("coords",this.rank),o=Ms("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,i=`getChannel(getSource(${o.join()}), ${s})`,a=`
      result.x = ${i};
      if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${i};
        --${o[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${t[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${i};
        if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${i};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${e}(${t.map((h,f)=>`start[${f}]`).join()});`:t.map((h,f)=>`${o[f]} = ${r[f]} + start[${f}];`).join(`
`);this.userCode=`
      uniform int start[${this.rank}];
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${u}
        setOutput(result);
      }
    `}getCustomSetupFunc(t){if(t.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${t.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,t)}}}});function z6e(n,t,e,r){let o=r.texData.get(n.dataId),s=r.makeTensorInfo(e,n.dtype),i=r.texData.get(s.dataId);Object.assign(i,o),i.complexParentRefCount=0,i.refCount=1,i.shape=e,i.dtype=n.dtype;let a=Ji.computeFlatOffset(t,Y.computeStrides(n.shape));o.slice&&(a+=o.slice.flatOffset),i.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||n.dataId};let u=r.dataRefCount.get(i.slice.origDataId)||1;return r.dataRefCount.set(i.slice.origDataId,u+1),s}function hg(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:s,size:i}=r,[a,u]=Ji.parseSliceParams(o,s,i);if(Ji.assertParamsValid(o,a,u),Y.sizeFromShape(u)===0)return e.makeTensorInfo(u,o.dtype,[]);if(e.shouldExecuteOnCPU([o])||o.dtype==="string"){let f=e.texData.get(o.dataId),g=Jpe(f.values,a,u,o.shape,o.dtype);return e.makeTensorInfo(u,o.dtype,g)}let{isPacked:c}=e.texData.get(o.dataId),h=Ji.isSliceContinous(o.shape,a,u);if(c||!h){let f=mt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new S3(u):new w3(u),g=f.getCustomSetupFunc(a);return e.runWebGLProgram(f,[o],o.dtype,g)}return e.uploadToGPU(o.dataId),z6e(o,a,u,e)}var qde,B2=D(()=>{"use strict";ve();Vo();jde();Ude();qde={kernelName:Nm,backendName:"webgl",kernelFunc:hg}});var V6e,Gde,Wde=D(()=>{"use strict";ve();Wo();B2();al();V6e=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:s,crops:i}=r;Y.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=s.reduce((N,T)=>N*T),u=Re.getReshaped(o.shape,s,a),c=Re.getPermuted(u.length,s.length),h=Re.getReshapedPermuted(o.shape,s,a),f=Re.getSliceBeginCoords(i,s.length),g=Re.getSliceSize(h,i,s.length),d=[],p=dn({inputs:{x:o},backend:e,attrs:{shape:u}}),m=Ss({inputs:{x:p},backend:e,attrs:{perm:c}}),y=dn({inputs:{x:m},backend:e,attrs:{shape:h}}),v=hg({inputs:{x:y},backend:e,attrs:{begin:f,size:g}});return d.push(p),d.push(m),d.push(y),d.forEach(N=>e.disposeIntermediateTensorInfo(N)),v},Gde={kernelName:Yf,backendName:"webgl",kernelFunc:V6e}});function j6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,weights:s}=t,{size:i}=r,a=e.readSync(o.dataId),u=e.readSync(s.dataId),c=QA(a,u,s.dtype,s.shape,i);return e.makeTensorInfo([i],s.dtype,c)}var Hde,Kde=D(()=>{"use strict";ve();Vo();Hde={kernelName:i1,backendName:"webgl",kernelFunc:j6e}});var U6e,w7,Xde,S7=D(()=>{"use strict";ve();Xn();U6e="return float(a != b);",w7=ro({opSnippet:U6e,dtype:"bool"}),Xde={kernelName:d0,backendName:"webgl",kernelFunc:w7}});function dg(n){let{inputs:t,backend:e}=n,{input:r}=t,o=e.texData.get(r.dataId);return Fs({inputs:{x:o.complexTensorInfos.real},backend:e})}var Yde,z2=D(()=>{"use strict";ve();il();Yde={kernelName:F1,backendName:"webgl",kernelFunc:dg}});function Qde(n,t){let e=new Eu(n.shape,q6e),r=t.runWebGLProgram(e,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var q6e,Zde=D(()=>{"use strict";Ja();q6e="return float(int(x));"});function C7(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dtype:s}=r;if(s==="complex64"){if(o.dtype==="complex64")return Fs({inputs:{x:o},backend:e});let i=so(o.shape),a=C7({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),u=Xu({inputs:{real:a,imag:i},backend:e});return i.dispose(),e.disposeIntermediateTensorInfo(a),u}if(o.dtype==="complex64"){let i=dg({inputs:{input:o},backend:e}),a=C7({inputs:{x:i},backend:e,attrs:{dtype:s}});return e.disposeIntermediateTensorInfo(i),a}if(!Y.hasEncodingLoss(o.dtype,s)){let i=Fs({inputs:{x:o},backend:e});return{dataId:i.dataId,shape:i.shape,dtype:s}}if(s==="int32")return Qde(o,e);if(s==="bool"){let i=e.makeTensorInfo([],"bool",Y.getTypedArrayFromDType("bool",1)),u=w7({inputs:{a:o,b:i},backend:e});return e.disposeIntermediateTensorInfo(i),u}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${s}`)}var Jde,efe=D(()=>{"use strict";ve();ve();pg();il();S7();z2();Zde();Jde={kernelName:Dp,backendName:"webgl",kernelFunc:C7}});var tfe,G6e,nfe,rfe=D(()=>{"use strict";ve();Xn();Vo();tfe="return ceil(x);",G6e=An({opSnippet:tfe,packedOpSnippet:tfe,cpuKernelImpl:Fpe}),nfe={kernelName:Bh,backendName:"webgl",kernelFunc:G6e}});var C3,ofe=D(()=>{"use strict";C3=class{constructor(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}getCustomSetupFunc(t,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,t),r.gl.uniform1f(this.maxLoc,e)}}}});var I3,sfe=D(()=>{"use strict";I3=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}getCustomSetupFunc(t,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,t),r.gl.uniform1f(this.maxLoc,e)}}}});function W6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{clipValueMin:s,clipValueMax:i}=r,a;mt().getBool("WEBGL_PACK_CLIP")?a=new I3(o.shape):a=new C3(o.shape);let u=a.getCustomSetupFunc(s,i);return e.runWebGLProgram(a,[o],o.dtype,u)}var ife,afe=D(()=>{"use strict";ve();ofe();sfe();ife={kernelName:zh,backendName:"webgl",kernelFunc:W6e}});var _3,ufe=D(()=>{"use strict";_3=class{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}});function cfe(n,t){return{dataId:t.dataId,dtype:t.dtype,shape:n.shape}}function H6e(n){let{inputs:t,backend:e}=n,{x:r}=t,o=e.texData.get(r.dataId),s=new _3(r.shape),i=[cfe(r,o.complexTensorInfos.real),cfe(r,o.complexTensorInfos.imag)];return e.runWebGLProgram(s,i,i[0].dtype)}var lfe,pfe=D(()=>{"use strict";ve();ufe();lfe={kernelName:Qf,backendName:"webgl",kernelFunc:H6e}});var T3,hfe=D(()=>{"use strict";ve();T3=class{constructor(t){this.outputShape=[],this.outputShape=Re.computeOutShape(t,1),this.variableNames=t.map((i,a)=>`T${a}`);let e=new Array(t.length-1);e[0]=t[0][1];for(let i=1;i<e.length;i++)e[i]=e[i-1]+t[i][1];let r=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<e.length;i++){let a=e[i-1];r.push(`else if (yC < ${e[i]}) setOutput(getT${i}(yR, yC-${a}));`)}let o=e.length,s=e[e.length-1];r.push(`else setOutput(getT${o}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}});function E3(n,t,e){let r=n.indexOf(t);return n.map((s,i)=>i===r?`${s} - ${e}`:s).join()}var N3,dfe=D(()=>{"use strict";ve();Zp();Gs();N3=class{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Re.computeOutShape(t,e);let r=this.outputShape,o=r.length,s=pr(o),i=Ms("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=t.map((m,y)=>`T${y}`);let u=new Array(t.length-1);u[0]=t[0][e];for(let m=1;m<u.length;m++)u[m]=u[m-1]+t[m][e];let c=a[e],h=a.slice(-2),f=a.join(),g=`if (${c} < ${u[0]}) {
        return getChannel(
            getT0(${f}), vec2(${h.join()}));
        }`;for(let m=1;m<u.length;m++){let y=u[m-1];g+=`
        if (${c} < ${u[m]}  && ${c} >= ${u[m-1]}) {
          return getChannel(
            getT${m}(${E3(a,c,y)}),
            vec2(${E3(h,c,y)}));
        }`}let d=u.length,p=u[u.length-1];g+=`
        return getChannel(
          getT${d}(${E3(a,c,p)}),
          vec2(${E3(h,c,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${g}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[o-1]} = ${i[o-1]} + 1;
        if (${i[o-1]} < ${r[o-1]}) {
          result.g = getValue(${i});
        }

        ${i[o-2]} = ${i[o-2]} + 1;
        if (${i[o-2]} < ${r[o-2]}) {
          result.a = getValue(${i});
        }

        ${i[o-1]} = ${i[o-1]} - 1;
        if (${i[o-2]} < ${r[o-2]} &&
            ${i[o-1]} < ${r[o-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}});function qx(n){let{inputs:t,backend:e}=n,{input:r}=t,o=e.texData.get(r.dataId);return Fs({inputs:{x:o.complexTensorInfos.imag},backend:e})}var ffe,S_=D(()=>{"use strict";ve();il();ffe={kernelName:C1,backendName:"webgl",kernelFunc:qx}});function Gx(n,t,e){let r=n[0].dtype;if(r==="complex64"){let c=n.map(p=>dg({inputs:{input:p},backend:e})),h=n.map(p=>qx({inputs:{input:p},backend:e})),f=Gx(c,t,e),g=Gx(h,t,e),d=Xu({inputs:{real:f,imag:g},backend:e});return c.forEach(p=>e.disposeIntermediateTensorInfo(p)),h.forEach(p=>e.disposeIntermediateTensorInfo(p)),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(g),d}if(r==="string"){let{tensors2D:c,outShape:h}=mfe(n,t,e),f=c.map(y=>({vals:e.readSync(y.dataId),shape:y.shape})),g=c[0].shape[0]===1,d=Ppe(f,h,r,g),p=Re.computeOutShape(n.map(y=>y.shape),t),m=e.makeTensorInfo(p,r,d);return c.forEach(y=>e.disposeIntermediateTensorInfo(y)),m}if(n.length>mt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let c=Math.floor(n.length/2),h=Gx(n.slice(0,c),t,e),f=Gx(n.slice(c),t,e),g=Gx([h,f],t,e);return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(f),g}if(mt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].shape.length>1){let c=new N3(n.map(h=>h.shape),t);return e.runWebGLProgram(c,n,r)}let{tensors2D:o,outShape:s}=mfe(n,t,e),i=new T3(o.map(c=>c.shape)),a=e.runWebGLProgram(i,o,r);o.forEach(c=>e.disposeIntermediateTensorInfo(c));let u=dn({inputs:{x:a},attrs:{shape:s},backend:e});return e.disposeIntermediateTensorInfo(a),u}function mfe(n,t,e){let r=Re.computeOutShape(n.map(s=>s.shape),t);return{tensors2D:n.map(s=>dn({inputs:{x:s},attrs:{shape:[-1,Y.sizeFromShape(s.shape.slice(t))]},backend:e})),outShape:r}}var gfe=D(()=>{"use strict";ve();hfe();dfe();Vo();pg();S_();z2();Wo();});function I7(n){let{inputs:t,backend:e,attrs:r}=n,{axis:o}=r,s=Y.parseAxisParam(o,t[0].shape)[0],i=Re.computeOutShape(t.map(c=>c.shape),s);if(Y.sizeFromShape(i)===0)return e.makeTensorInfo(i,t[0].dtype,[]);let a=t.filter(c=>Y.sizeFromShape(c.shape)>0);if(a.length===1)return Fs({inputs:{x:a[0]},backend:e});let u=a.map(c=>c.shape);return Re.assertParamsConsistent(u,s),Gx(a,s,e)}var yfe,_7=D(()=>{"use strict";ve();gfe();il();yfe={kernelName:Zf,backendName:"webgl",kernelFunc:I7}});var V2,k3,D3=D(()=>{"use strict";V2=class{constructor(t,e=!1,r=null,o=!1,s=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;let i=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,h=t.dilationHeight,f=t.dilationWidth,g=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,m=t.inChannels%4,y=t.dataFormat==="channelsLast",v=y?1:2,N=y?2:3,T=y?3:1,O="",S="";r&&(o?O=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?O=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:O=`
          float activation(float x) {
            ${r}
          }
        `,S="result = activation(result);");let F=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${O}

      const ivec2 strides = ivec2(${u}, ${c});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${T}];

        ivec2 xRCCorner =
            ivec2(coords[${v}], coords[${N}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${g}; wR++) {
          int xR = xRCorner + wR * ${h};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${y}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${y}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${y}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${y}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${F}
        ${S}
        setOutput(result);
      }
    `}},k3=class{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;let e=t.padInfo.front,r=t.padInfo.top,o=t.padInfo.left,s=t.strideDepth,i=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,h=t.dilationWidth,f=t.filterDepth,g=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,m=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${i}, ${a});
      const ivec3 pads = ivec3(${e}, ${r}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${g}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${h};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}});var A3,xfe=D(()=>{"use strict";ep();A3=class{constructor(t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;let{filterWidth:o,inChannels:s,strideWidth:i,strideHeight:a,padInfo:u,outWidth:c,dilationWidth:h,dilationHeight:f,dataFormat:g}=r,{left:d,top:p}=u,m=s*o,y=hs(),v=g==="channelsLast",N=v?0:1,T=v?1:2,O="";for(let S=0;S<=1;S++)for(let F=0;F<=1;F++)O+=`
          blockIndex = rc.y + ${F};
          pos = rc.x + ${S};

          if(blockIndex < ${t[1]} && pos < ${t[0]}) {
            offsetY = int(blockIndex / (${c})) * ${a} - ${p};
            d0 = offsetY + ${f} * (pos / ${m});

            if(d0 < ${e[N]} && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), ${c}.) * ${i}. - ${d}.);
              d1 = offsetX + ${h} * (int(mod(float(pos), ${m}.) / ${s}.));

              if(d1 < ${e[T]} && d1 >= 0) {

                ch = int(mod(float(pos), ${s}.));

                if (${v}) {
                  innerDims = vec2(d1, ch);
                  result[${S*2+F}] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${S*2+F}] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${O}

        ${y.output} = result;
      }
    `}}});function O3({x:n,filter:t,convInfo:e,backend:r,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let u=n.shape,c=r.texData.get(n.dataId),h=e.inChannels,f=u[0]*u[1]*u[2],g=e.outChannels,d=e.dataFormat==="channelsLast",p=!1,m=!1,y,v=[],N=(f===1||g===1)&&h>y7,T=u[2]%2!==0&&!!c.isPacked;if(N||!mt().getBool("WEBGL_LAZILY_UNPACK")||!mt().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!T){let O=d?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],S=dn({inputs:{x:n},backend:r,attrs:{shape:[1,O,e.inChannels]}}),F=dn({inputs:{x:t},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}}),R=Ux({a:S,b:F,transposeA:p,transposeB:m,backend:r,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i});y=dn({inputs:{x:R},backend:r,attrs:{shape:e.outShape}}),v.push(S),v.push(F),v.push(R)}else{let O=d?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),S={dataId:n.dataId,shape:[1,O,e.inChannels],dtype:n.dtype},F=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,Y.assert(zx(c.shape,S.shape),()=>`packed reshape ${c.shape} to ${S.shape} isn't free`);let R=dn({inputs:{x:t},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}});v.push(R);let L=Ux({a:S,b:R,backend:r,transposeA:p,transposeB:m,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i}),q=r.texData.get(L.dataId);Y.assert(q.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=F,q.shape=e.outShape,y=Fs({inputs:{x:L},backend:r}),y.shape=e.outShape,v.push(L)}for(let O of v)r.disposeIntermediateTensorInfo(O);return y}function R3({x:n,filter:t,convInfo:e,backend:r,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let{filterWidth:u,filterHeight:c,inChannels:h,outWidth:f,outHeight:g,dataFormat:d}=e,p=d==="channelsLast",m=u*c*h,y=g*f,v=[m,y],N=!0,T=!1,O=[],S=dn({inputs:{x:n},backend:r,attrs:{shape:n.shape.slice(1)}}),F=dn({inputs:{x:t},backend:r,attrs:{shape:[1,m,Y.sizeFromShape(t.shape)/m]}});O.push(S),O.push(F);let R=new A3(v,S.shape,e),L=r.runWebGLProgram(R,[S],"float32"),q=dn({inputs:{x:L},backend:r,attrs:{shape:[1,v[0],v[1]]}});O.push(L),O.push(q);let U=o!=null,Z=s!=null,ee=a==="leakyrelu",Q=a?py(a,!0):null,oe=new $2(q.shape,F.shape,[1,y,e.outChannels],N,T,U,Q,Z,ee),se=[q,F];if(o&&se.push(o),Z&&se.push(s),ee){let he=r.makeTensorInfo([],"float32",Y.createScalarValue(i,"float32"));se.push(he),O.push(he)}let pe=r.runWebGLProgram(oe,se,"float32"),ae=p?[1,g,f,e.outChannels]:[1,e.outChannels,g,f],fe=dn({inputs:{x:pe},backend:r,attrs:{shape:ae}});O.push(pe);for(let he of O)r.disposeIntermediateTensorInfo(he);return fe}var T7=D(()=>{"use strict";ve();xfe();Xn();h7();ol();l3();il();Wo();});function K6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:s}=t,{strides:i,pad:a,dataFormat:u,dilations:c,dimRoundingMode:h}=r,f=Re.convertConv2DDataFormat(u),g=Re.computeConv2DInfo(o.shape,s.shape,i,c,a,h,!1,f),d;if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))d=O3({x:o,filter:s,convInfo:g,backend:e});else if(mt().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)d=R3({x:o,filter:s,convInfo:g,backend:e});else{let m=new V2(g);d=e.runWebGLProgram(m,[o,s],"float32")}let p=dn({inputs:{x:d},backend:e,attrs:{shape:g.outShape}});return e.disposeIntermediateTensorInfo(d),p}var bfe,vfe=D(()=>{"use strict";ve();D3();T7();Wo();bfe={kernelName:Jf,backendName:"webgl",kernelFunc:K6e}});var M3,F3,P3,$3,C_=D(()=>{"use strict";M3=class{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let e=t.strideHeight,r=t.strideWidth,o=t.padInfo.top,s=t.padInfo.left,i=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              if (${i}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},F3=class{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let e=t.filterHeight,r=t.filterWidth,o=t.strideHeight,s=t.strideWidth,i=t.dataFormat==="channelsLast",a=e-1-t.padInfo.top,u=r-1-t.padInfo.left,c=i?1:2,h=i?2:3,f=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${h}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},P3=class{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let e=t.strideDepth,r=t.strideHeight,o=t.strideWidth,s=t.padInfo.front,i=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${s};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${i};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},$3=class{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let e=t.filterDepth,r=t.filterHeight,o=t.filterWidth,s=t.strideDepth,i=t.strideHeight,a=t.strideWidth,u=e-1-t.padInfo.front,c=r-1-t.padInfo.top,h=o-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${c}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}});function X6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:s}=t,{strides:i,pad:a,dataFormat:u,dimRoundingMode:c,filterShape:h}=r,f=Re.convertConv2DDataFormat(u),g=Re.computeConv2DInfo(o.shape,h,i,1,a,c,!1,f),d=new M3(g);return e.runWebGLProgram(d,[o,s],"float32")}var wfe,Sfe=D(()=>{"use strict";ve();C_();wfe={kernelName:u1,backendName:"webgl",kernelFunc:X6e}});function Y6e(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:s}=t,{inputShape:i,strides:a,pad:u,dataFormat:c,dimRoundingMode:h}=r,f=Re.convertConv2DDataFormat(c),g=Re.computeConv2DInfo(i,s.shape,a,1,u,h,!1,f),d=new F3(g);return e.runWebGLProgram(d,[o,s],"float32")}var Cfe,Ife=D(()=>{"use strict";ve();C_();Cfe={kernelName:em,backendName:"webgl",kernelFunc:Y6e}});function Q6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:s}=t,{strides:i,pad:a,dilations:u}=r,c=Re.computeConv3DInfo(o.shape,s.shape,i,u,a),h=new k3(c);return e.runWebGLProgram(h,[o,s],"float32")}var _fe,Tfe=D(()=>{"use strict";ve();D3();_fe={kernelName:tm,backendName:"webgl",kernelFunc:Q6e}});function Z6e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:s}=t,{strides:i,pad:a,filterShape:u}=r,c=Re.computeConv3DInfo(o.shape,u,i,1,a),h=new P3(c);return e.runWebGLProgram(h,[o,s],"float32")}var Efe,Nfe=D(()=>{"use strict";ve();C_();Efe={kernelName:c1,backendName:"webgl",kernelFunc:Z6e}});function J6e(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:s}=t,{pad:i,strides:a,inputShape:u}=r,c=Re.computeConv3DInfo(u,s.shape,a,1,i),h=new $3(c);return e.runWebGLProgram(h,[o,s],"float32")}var kfe,Dfe=D(()=>{"use strict";ve();C_();kfe={kernelName:l1,backendName:"webgl",kernelFunc:J6e}});var e$e,t$e,Afe,Ofe=D(()=>{"use strict";ve();Xn();e$e=s3+`
  return cos(x);
`,t$e=An({opSnippet:e$e}),Afe={kernelName:Vh,backendName:"webgl",kernelFunc:t$e}});var n$e,r$e,Rfe,Mfe=D(()=>{"use strict";ve();Xn();n$e=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,r$e=An({opSnippet:n$e}),Rfe={kernelName:jh,backendName:"webgl",kernelFunc:r$e}});var L3,Ffe=D(()=>{"use strict";L3=class{constructor(t,e,r,o,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[i,a,u,c]=t,[h]=e,[f,g]=r;this.outputShape=[h,f,g,c];let d=o==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${u-1}.0`],[y,v,N]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[T,O,S]=g>1?[`${(u-1)/(g-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${y});
      const float width_ratio = float(${T});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${v};
        float width_scale = ${O};

        float in_y = ${N};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}});var o$e,Pfe,$fe=D(()=>{"use strict";ve();Ffe();o$e=n=>{let{inputs:t,backend:e,attrs:r}=n,{image:o,boxes:s,boxInd:i}=t,{cropSize:a,method:u,extrapolationValue:c}=r,h=new L3(o.shape,s.shape,a,u,c);return e.runWebGLProgram(h,[o,s,i],"float32")},Pfe={kernelName:p1,backendName:"webgl",kernelFunc:o$e}});function Lfe(n,t){if(n===1)return`${t}`;if(n===2)return`${t}.x, ${t}.y`;if(n===3)return`${t}.x, ${t}.y, ${t}.z`;if(n===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw Error(`Cumulative sum for rank ${n} is not yet supported`)}function Bfe(n,t){if(n===1)return`${t}`;if(n===2)return`${t}.y`;if(n===3)return`${t}.z`;if(n===4)return`${t}.w`;throw Error(`Cumulative sum for rank ${n} is not yet supported`)}var I_,zfe=D(()=>{"use strict";Gs();I_=class{constructor(t,e,r){this.variableNames=["x"],this.outputShape=t;let o=t.length,s=e?"0.0":`getX(${Lfe(o,"coords")})`,i=t[t.length-1],a="",u="";e?(a=r?`end != ${i-1}`:"end != 0",u=r?"end + 1":"end - 1"):(a=r?`end + pow2 < ${i}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`
      uniform float index;
      void main() {
        ${pr(o)} coords = getOutputCoords();
        int end = ${Bfe(o,"coords")};
        float val = ${s};
        int pow2 = int(pow(2.0, index));
        if (${a}) {
          int idx = ${u};
          ${Bfe(o,"coords")} = idx;
          val += getX(${Lfe(o,"coords")});
        }
        setOutput(val);
      }
    `}getCustomSetupFunc(t){return(e,r)=>{this.index==null&&(this.index=e.getUniformLocation(r,"index")),e.gl.uniform1f(this.index,t)}}}});function s$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,exclusive:i,reverse:a}=r,u=o.shape.length,c=Re.getAxesPermutation([s],u),h=o;c!=null&&(h=Ss({inputs:{x:o},backend:e,attrs:{perm:c}}));let f=Re.getInnerMostAxes(1,u)[0];if(f!==u-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${o.shape.length-1} but got axis=${s}`);let g=h.shape[f],d=Fs({inputs:{x:h},backend:e});for(let p=0;p<=Math.ceil(Math.log2(g))-1;p++){let m=new I_(h.shape,!1,a),y=m.getCustomSetupFunc(p),v=d;d=e.runWebGLProgram(m,[d],d.dtype,y),e.disposeIntermediateTensorInfo(v)}if(i){let p=new I_(h.shape,i,a),m=d;d=e.runWebGLProgram(p,[d],d.dtype),e.disposeIntermediateTensorInfo(m)}if(c!=null){let p=Re.getUndoAxesPermutation(c),m=Ss({inputs:{x:d},backend:e,attrs:{perm:p}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(h),m}return d}var Vfe,jfe=D(()=>{"use strict";ve();zfe();il();al();Vfe={kernelName:nm,backendName:"webgl",kernelFunc:s$e}});function i$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,weights:s}=t,{size:i,binaryOutput:a}=r;if(o.shape.length===1){let u=e.readSync(o.dataId),c=e.readSync(s.dataId),h=QA(u,c,s.dtype,s.shape,i);return e.makeTensorInfo([i],s.dtype,h)}else if(o.shape.length===2){let u=e.bufferSync(o),c=e.bufferSync(s),h=Mpe(u,c,i,a);return e.makeTensorInfo(h.shape,s.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var Ufe,qfe=D(()=>{"use strict";ve();Vo();Ufe={kernelName:h1,backendName:"webgl",kernelFunc:i$e}});var B3,Gfe=D(()=>{"use strict";B3=class{constructor(t,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}});function a$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockSize:s,dataFormat:i}=r;Y.assert(s>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${s}`);let a=o.shape[0],u=i==="NHWC"?o.shape[1]:o.shape[2],c=i==="NHWC"?o.shape[2]:o.shape[3],h=i==="NHWC"?o.shape[3]:o.shape[1],f=u*s,g=c*s,d=h/(s*s),p=i==="NHWC"?[a,f,g,d]:[a,d,f,g],m=new B3(p,s,i);return e.runWebGLProgram(m,[o],o.dtype)}var Wfe,Hfe=D(()=>{"use strict";ve();Gfe();Wfe={kernelName:d1,backendName:"webgl",kernelFunc:a$e}});var j2,E7=D(()=>{"use strict";j2=class{constructor(t,e=!1,r=null,o=!1,s=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;let i=t.inHeight,a=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,h=t.strideHeight,f=t.strideWidth,g=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,m=t.filterWidth,y=t.outChannels/t.inChannels,v="",N="";r&&(o?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:v=`
          float activation(float x) {
            ${r}
          }
        `,N="result = activation(result);");let T=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${h}, ${f});
      const ivec2 pads = ivec2(${u}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${y};
        int q = d2 - d1 * ${y};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${g};

          if (xR < 0 || xR >= ${i}) {
            continue;
          }

          for (int wC = 0; wC < ${m}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${a}) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${T}
        ${N}
        setOutput(result);
      }
    `}}});var U2,N7=D(()=>{"use strict";ve();U2=class{constructor(t,e=!1,r=null,o=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;let i=t.inHeight,a=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,h=t.strideHeight,f=t.strideWidth,g=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,m=t.filterWidth,y=m,v="int xR; int xC; int xCOffset;";for(let S=0;S<p;S++)for(let F=0;F<m;F++)v+=`
          vec4 xTexelR${S}C${F*2} = vec4(0.);
          vec4 wR${S}C${F} = vec4(0.);
          vec4 xR${S}C${F} = vec4(0.);`;for(let S=0;S<p;S++)for(let F=0;F<y;F++){let R=F*2;if(v+=`
          xR = xRCorner + ${S*g};
          xC = xCCorner + ${R*d};
        `,f===1){if(R<m&&(c%2===1?v+=`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < ${i} && xCOffset >= 0 && xCOffset < ${a}) {
                  xTexelR${S}C${R} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= ${a}) {
                    xTexelR${S}C${R}.zw = vec2(0.);
                  }
                } else {
                  xTexelR${S}C${R} = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < ${i} && xCOffset >= 0 && xCOffset < ${a}) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= ${a}) {
                    previous.zw = vec2(0.);
                  }

                  xR${S}C${R} = vec4(previous.zw, xTexelR${S}C${R}.xy);
                } else {
                  xR${S}C${R} = vec4(0, 0, xTexelR${S}C${R}.xy);
                }
              `:v+=`
                if(xR >= 0 && xR < ${i} && xC >= 0 && xC < ${a}) {
                  xTexelR${S}C${R} = getX(batch, xR, xC, d1);
                } else {
                  xTexelR${S}C${R} = vec4(0.);
                }

                xR${S}C${R} = xTexelR${S}C${R};
              `,R+1<m)){let L=c%2===0?Y.nearestLargerEven(d):d;d%2===0&&c%2===1||d%2!==0&&c%2!==1?(v+=`
                  xCOffset = xC + ${c%2} + ${L};

                  if(xR >= 0 && xR < ${i} &&
                    xCOffset >= 0 && xCOffset < ${a}) {
                    xTexelR${S}C${R+2} = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < ${i} &&
                      xCOffset >= 0 && xCOffset < ${a}) {
                      xTexelR${S}C${R} = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR${S}C${R} = vec4(0.);
                    }
                  `),v+=`
                  xR${S}C${R+1} = vec4(
                    xTexelR${S}C${R}.zw, xTexelR${S}C${R+2}.xy);
                `):v+=`
                  xCOffset = xC + ${L};

                  if(xR >= 0 && xR < ${i} &&
                    xCOffset >= 0 && xCOffset < ${a}) {
                    xTexelR${S}C${R+2} = getX(batch, xR, xCOffset, d1);
                  }

                  xR${S}C${R+1} = xTexelR${S}C${R+2};
                `}}else R<m&&(v+=`
              if(xR >= 0 && xR < ${i}) {
            `,c%2===1?(v+=`
                xCOffset = xC + 1 - ${f};
                if(xCOffset >= 0 && xCOffset < ${a}) {
                  xTexelR${S}C${R} = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR${S}C${R} = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < ${a}) {
                  xTexelR${S}C${R+2} = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR${S}C${R+2} = vec4(0.);
                }

                xR${S}C${R} = vec4(
                  xTexelR${S}C${R}.zw, xTexelR${S}C${R+2}.zw);
              `,R+1<m&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + ${f};
                  if(xCOffset >= 0 && xCOffset < ${a}) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR${S}C${R+1} = vec4(xTexelR${S}C${R+2}.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < ${a}) {
                  xTexelR${S}C${R} = getX(batch, xR, xC, d1);
                } else {
                  xTexelR${S}C${R} = vec4(0.);
                }

                xCOffset = xC + ${f};
                if(xCOffset >= 0 && xCOffset < ${a}) {
                  xTexelR${S}C${R+2} = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR${S}C${R+2} = vec4(0.);
                }

                xR${S}C${R} = vec4(
                  xTexelR${S}C${R}.xy, xTexelR${S}C${R+2}.xy);
              `,R+1<m&&(v+=`
                  xR${S}C${R+1} = vec4(
                    xTexelR${S}C${R}.zw, xTexelR${S}C${R+2}.zw);
                `)),v+="}");R<m&&(v+=`
            vec4 wTexelR${S}C${R} = getW(${S}, ${R}, d1, q);
            wR${S}C${R} = vec4(wTexelR${S}C${R}.xz, wTexelR${S}C${R}.xz);
          `,R+1<m&&(v+=`
              vec4 wTexelR${S}C${R+1} = getW(${S}, ${R+1}, d1, q);
              wR${S}C${R+1} =
                vec4(wTexelR${S}C${R+1}.xz, wTexelR${S}C${R+1}.xz);`))}for(let S=0;S<p;S++)for(let F=0;F<m;F++)v+=`dotProd += xR${S}C${F} * wR${S}C${F};`;let N="",T="";r&&(o?N=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?N=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:N=`vec4 activation(vec4 x) {
          ${r}
        }`,T="result = activation(result);");let O=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${N}

      const ivec2 strides = ivec2(${h}, ${f});
      const ivec2 pads = ivec2(${u}, ${c});

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        ${v}

        vec4 result = dotProd;
        ${O}
        ${T}
        setOutput(result);
      }
    `}}});function u$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:s}=t,{strides:i,pad:a,dilations:u,dimRoundingMode:c}=r,h=u;h==null&&(h=[1,1]),Y.assert(Re.eitherStridesOrDilationsAreOne(i,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);let f=Re.computeConv2DInfo(o.shape,s.shape,i,h,a,c,!0),g;return mt().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?g=new U2(f):g=new j2(f),e.runWebGLProgram(g,[o,s],"float32")}var Kfe,Xfe=D(()=>{"use strict";ve();E7();N7();Kfe={kernelName:rm,backendName:"webgl",kernelFunc:u$e}});var z3,V3,k7=D(()=>{"use strict";z3=class{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let e=t.strideHeight,r=t.strideWidth,o=t.padInfo.top,s=t.padInfo.left,i=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},V3=class{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let e=t.filterHeight,r=t.filterWidth,o=t.strideHeight,s=t.strideWidth,i=e-1-t.padInfo.top,a=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}});function c$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:s}=t,{strides:i,dilations:a,pad:u,dimRoundingMode:c,filterShape:h}=r,f=Re.computeConv2DInfo(o.shape,h,i,a,u,c,!0),g=new z3(f);return e.runWebGLProgram(g,[o,s],"float32")}var Yfe,Qfe=D(()=>{"use strict";ve();k7();Yfe={kernelName:f1,backendName:"webgl",kernelFunc:c$e}});function l$e(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:s}=t,{strides:i,dilations:a,pad:u,dimRoundingMode:c,inputShape:h}=r,f=Re.computeConv2DInfo(h,s.shape,i,a,u,c,!0),g=new V3(f);return e.runWebGLProgram(g,[o,s],"float32")}var Zfe,Jfe=D(()=>{"use strict";ve();k7();Zfe={kernelName:m1,backendName:"webgl",kernelFunc:l$e}});var j3,eme=D(()=>{"use strict";j3=class{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}});function p$e(n){let{inputs:t,backend:e}=n,{x:r}=t,o=[...r.shape,...r.shape],s=Y.sizeFromShape(r.shape),i=dn({inputs:{x:r},backend:e,attrs:{shape:[s]}}),a=new j3(s),u=e.runWebGLProgram(a,[i],i.dtype),c=dn({inputs:{x:u},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(u),c}var tme,nme=D(()=>{"use strict";ve();eme();Wo();tme={kernelName:g1,backendName:"webgl",kernelFunc:p$e}});var U3,rme=D(()=>{"use strict";U3=class{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;let{inHeight:e,inWidth:r,padInfo:o,strideHeight:s,strideWidth:i,filterHeight:a,filterWidth:u,dilationHeight:c,dilationWidth:h}=t,{top:f,left:g}=o;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${i});
      const ivec2 pads = ivec2(${f}, ${g});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${h};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}});function h$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:s}=t,{strides:i,pad:a,dilations:u}=r,c=Re.computeDilation2DInfo(o.shape,s.shape,i,a,"NHWC",u),h,f=new U3(c);h=e.runWebGLProgram(f,[o,s],"float32");let g=dn({inputs:{x:h},backend:e,attrs:{shape:c.outShape}});return e.disposeIntermediateTensorInfo(h),g}var ome,sme=D(()=>{"use strict";ve();rme();Wo();ome={kernelName:om,backendName:"webgl",kernelFunc:h$e}});var d$e,f$e,m$e,ime,ame=D(()=>{"use strict";ve();Xn();d$e="return (x >= 0.0) ? x : (exp(x) - 1.0);",f$e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,m$e=An({opSnippet:d$e,packedOpSnippet:f$e}),ime={kernelName:qh,backendName:"webgl",kernelFunc:m$e}});var g$e,y$e,x$e,ume,cme=D(()=>{"use strict";ve();cy();cf();g$e="return (b >= 1.0) ? a : a * (b + 1.0);",y$e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,x$e=n=>{let{inputs:t,backend:e}=n,{dy:r,y:o}=t,s=mt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new np(y$e,r.shape,o.shape):new sl(g$e,r.shape,o.shape);return e.runWebGLProgram(s,[r,o],r.dtype)},ume={kernelName:y1,backendName:"webgl",kernelFunc:x$e}});var b$e,v$e,w$e,lme,pme=D(()=>{"use strict";ve();Xn();b$e=`
  return vec4(equal(a, b));
`,v$e="return float(a == b);",w$e=ro({opSnippet:v$e,packedOpSnippet:b$e,dtype:"bool"}),lme={kernelName:i0,backendName:"webgl",kernelFunc:w$e}});var S$e,C$e,hme,dme=D(()=>{"use strict";ve();Xn();S$e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Re.ERF_P};
  float a1 = ${Re.ERF_A1};
  float a2 = ${Re.ERF_A2};
  float a3 = ${Re.ERF_A3};
  float a4 = ${Re.ERF_A4};
  float a5 = ${Re.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,C$e=An({opSnippet:S$e}),hme={kernelName:Gh,backendName:"webgl",kernelFunc:C$e}});var fme,D7,mme,A7=D(()=>{"use strict";ve();Xn();Vo();fme="return exp(x);",D7=An({opSnippet:fme,packedOpSnippet:fme,cpuKernelImpl:$pe}),mme={kernelName:Wh,backendName:"webgl",kernelFunc:D7}});function q3(n){let{inputs:t,attrs:e,backend:r}=n,{dim:o}=e,{input:s}=t,i=s.shape.length,a=s.shape.slice(),u=o;return o<0&&(Y.assert(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),u=i+o+1),a.splice(u,0,1),dn({inputs:{x:s},backend:r,attrs:{shape:a}})}var gme,O7=D(()=>{"use strict";ve();Wo();gme={kernelName:sm,backendName:"webgl",kernelFunc:q3}});var yme,I$e,xme,bme=D(()=>{"use strict";ve();Xn();Vo();yme="return exp(x) - 1.0;",I$e=An({opSnippet:yme,packedOpSnippet:yme,cpuKernelImpl:Lpe}),xme={kernelName:Hh,backendName:"webgl",kernelFunc:I$e}});var __,vme=D(()=>{"use strict";__=class{constructor(t,e,r){this.variableNames=["real","imag"];let o=e[1];this.outputShape=e;let s=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=r?`${o}.0`:"1.0",a;if(t==="real")a="return real * expR - imag * expI;";else if(t==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}});function G3(n,t,e){let r=e.texData.get(n.dataId),o=Y.sizeFromShape(n.shape),s=n.shape[n.shape.length-1],i=o/s,a=dn({inputs:{x:n},backend:e,attrs:{shape:[i,s]}}),u=a.shape,c=new __("real",u,t),h=new __("imag",u,t),f=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],g=e.runWebGLProgram(c,f,"float32"),d=e.runWebGLProgram(h,f,"float32"),p=Xu({inputs:{real:g,imag:d},backend:e});e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(d);let m=dn({inputs:{x:p},backend:e,attrs:{shape:n.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(p),m}var R7=D(()=>{"use strict";ve();vme();pg();Wo();});function _$e(n){let{inputs:t,backend:e}=n,{input:r}=t;return G3(r,!1,e)}var wme,Sme=D(()=>{"use strict";ve();R7();wme={kernelName:x1,backendName:"webgl",kernelFunc:_$e}});var W3,Cme=D(()=>{"use strict";W3=class{constructor(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}getCustomSetupFunc(t){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,t)}}}});function T_(n){let{backend:t,attrs:e}=n,{shape:r,value:o}=e,{dtype:s}=e;if(s=s||Y.inferDtype(o),s==="string"){let i=Y.getArrayFromDType(s,Y.sizeFromShape(r));return i.fill(o),t.makeTensorInfo(r,s,i)}else{let i=new W3(r,o),a=i.getCustomSetupFunc(o);return t.runWebGLProgram(i,[],s,a)}}var Ime,H3=D(()=>{"use strict";ve();Cme();Ime={kernelName:b1,backendName:"webgl",kernelFunc:T_}});var K3,_me=D(()=>{"use strict";K3=class{constructor(t){this.variableNames=["Image"],this.outputShape=[];let e=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}});var Tme,Eme=D(()=>{"use strict";ve();_me();Tme={kernelName:v1,backendName:"webgl",kernelFunc:({inputs:n,backend:t})=>{let{image:e}=n,r=t,o=new K3(e.shape);return r.runWebGLProgram(o,[e],e.dtype)}}});var Nme,T$e,kme,Dme=D(()=>{"use strict";ve();Xn();Vo();Nme="return floor(x);",T$e=An({opSnippet:Nme,packedOpSnippet:Nme,cpuKernelImpl:Bpe}),kme={kernelName:Kh,backendName:"webgl",kernelFunc:T$e}});var E$e,N$e,k$e,Ame,Ome=D(()=>{"use strict";ve();Xn();E$e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,N$e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,k$e=ro({opSnippet:E$e,packedOpSnippet:N$e,dtype:"int32"}),Ame={kernelName:Xh,backendName:"webgl",kernelFunc:k$e}});var X3,Rme=D(()=>{"use strict";ep();X3=class{constructor(t){this.variableNames=["A"];let e=hs(),[r,o]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${r}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}});var Y3,Mme=D(()=>{"use strict";ep();Y3=class{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let e=hs(),[r,o]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${r}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}}});function D$e(n){let{inputs:t,backend:e,attrs:r}=n,{pixels:o}=t,{numChannels:s}=r,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=typeof ImageBitmap<"u"&&o instanceof ImageBitmap,[c,h]=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],f=[h,c],g=[h,c,s];(a||i||u)&&(q2==null&&(q2=document.createElement("canvas").getContext("2d")),q2.canvas.width=c,q2.canvas.height=h,q2.drawImage(o,0,0,c,h),o=q2.canvas);let d=e.makeTensorInfo(f,"int32");e.texData.get(d.dataId).usage=Za.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(d.dataId),o);let p=mt().getBool("WEBGL_PACK")?new Y3(g):new X3(g),m=e.runWebGLProgram(p,[d],"int32");return e.disposeData(d.dataId),m}var Fme,q2,Pme=D(()=>{"use strict";ve();ve();Jl();Rme();Mme();Fme={kernelName:$v,backendName:"webgl",kernelFunc:D$e}});function A$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:s,bias:i,preluActivationWeights:a}=t,{strides:u,pad:c,dataFormat:h,dilations:f,dimRoundingMode:g,activation:d,leakyreluAlpha:p}=r,m=Re.convertConv2DDataFormat(h),y=Re.computeConv2DInfo(o.shape,s.shape,u,f,c,g,!1,m),v,N=[];if(y.filterHeight===1&&y.filterWidth===1&&y.dilationHeight===1&&y.dilationWidth===1&&y.strideHeight===1&&y.strideWidth===1&&(y.padInfo.type==="SAME"||y.padInfo.type==="VALID"))v=O3({x:o,filter:s,convInfo:y,backend:e,bias:i,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else if(mt().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)v=R3({x:o,filter:s,convInfo:y,backend:e,bias:i,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else{let O=i!=null,S=a!=null,F=d==="leakyrelu",R=d?py(d,!1):null,L=new V2(y,O,R,S,F),q=[o,s];if(i&&q.push(i),a&&q.push(a),F){let U=e.makeTensorInfo([],"float32",Y.createScalarValue(p,"float32"));q.push(U),N.push(U)}v=e.runWebGLProgram(L,q,"float32")}let T=dn({inputs:{x:v},backend:e,attrs:{shape:y.outShape}});return N.push(v),N.forEach(O=>e.disposeIntermediateTensorInfo(O)),T}var $me,Lme=D(()=>{"use strict";ve();D3();Xn();T7();Wo();$me={kernelName:m0,backendName:"webgl",kernelFunc:A$e}});function O$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:s,bias:i,preluActivationWeights:a}=t,{strides:u,pad:c,dilations:h,dimRoundingMode:f,activation:g,leakyreluAlpha:d}=r,p=[],m=h;m==null&&(m=[1,1]),Y.assert(Re.eitherStridesOrDilationsAreOne(u,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`);let y=Re.computeConv2DInfo(o.shape,s.shape,u,m,c,f,!0),v=mt().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels===1,N=g?py(g,v):null,T=[o,s],O=i!=null,S=a!=null,F=g==="leakyrelu";if(O&&T.push(i),S&&T.push(a),F){let q=e.makeTensorInfo([],"float32",Y.createScalarValue(d,"float32"));T.push(q),p.push(q)}let R;v?R=new U2(y,O,N,S,F):R=new j2(y,O,N,S,F);let L=e.runWebGLProgram(R,T,"float32");return p.forEach(q=>e.disposeIntermediateTensorInfo(q)),L}var Bme,zme=D(()=>{"use strict";ve();E7();N7();Xn();Bme={kernelName:g0,backendName:"webgl",kernelFunc:O$e}});var Q3,Vme=D(()=>{"use strict";Gs();Q3=class{constructor(t,e,r){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=r;let o=pr(e.length),s=pr(r.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        ${o} strides = ${o}(${this.strides});
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < ${this.sliceDim}; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * ${i};
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}});function R$e(n){let{inputs:t,backend:e}=n,{params:r,indices:o}=t,s=o.shape,i=s[s.length-1],[a,u,c,h]=Re.prepareAndValidate(r,o),f=dn({inputs:{x:o},backend:e,attrs:{shape:[u,i]}}),g=dn({inputs:{x:r},backend:e,attrs:{shape:[Y.sizeFromShape(r.shape)/c,c]}}),d=new Q3(i,h,[u,c]),p=e.runWebGLProgram(d,[g,f],g.dtype),m=dn({inputs:{x:p},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(p),m}var jme,Ume=D(()=>{"use strict";ve();Vme();Wo();jme={kernelName:w1,backendName:"webgl",kernelFunc:R$e}});function M$e(n,t){let e=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let o=0;o<n.length;o++)o===2?r.push("int(getIndices(resRC.x, resRC.z))"):r.push(`${e[o]}`);return r.join()}var Z3,qme=D(()=>{"use strict";Gs();Z3=class{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;let r=pr(this.rank),o=M$e(t,2);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}});function F$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,indices:s}=t,{axis:i,batchDims:a}=r,u=Y.parseAxisParam(i,o.shape)[0],c=Re.segment_util.collectGatherOpShapeInfo(o,s,u,a),h=Y.sizeFromShape(s.shape),f=[],g=dn({inputs:{x:o},backend:e,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),d=dn({inputs:{x:s},backend:e,attrs:{shape:[c.batchSize,h/c.batchSize]}});f.push(g),f.push(d);let p=[c.batchSize,c.outerSize,h/c.batchSize,c.sliceSize];if(e.shouldExecuteOnCPU([o,s])||o.dtype==="string"){let N=e.bufferSync(d),T=e.bufferSync(g),O=zpe(T,N,p);return f.forEach(S=>e.disposeIntermediateTensorInfo(S)),e.makeTensorInfo(c.outputShape,O.dtype,O.values)}let m=new Z3(g.shape,p),y=e.runWebGLProgram(m,[g,d],g.dtype);f.push(y);let v=dn({inputs:{x:y},backend:e,attrs:{shape:c.outputShape}});return f.forEach(N=>e.disposeIntermediateTensorInfo(N)),v}var Gme,Wme=D(()=>{"use strict";ve();qme();Vo();Wo();Gme={kernelName:am,backendName:"webgl",kernelFunc:F$e}});var P$e,$$e,L$e,Hme,Kme=D(()=>{"use strict";ve();Xn();Vo();P$e="return float(a > b);",$$e=`
  return vec4(greaterThan(a, b));
`,L$e=ro({opSnippet:P$e,packedOpSnippet:$$e,cpuKernelImpl:Vpe,dtype:"bool"}),Hme={kernelName:a0,backendName:"webgl",kernelFunc:L$e}});var B$e,z$e,V$e,Xme,Yme=D(()=>{"use strict";ve();Xn();B$e="return float(a >= b);",z$e=`
  return vec4(greaterThanEqual(a, b));
`,V$e=ro({opSnippet:B$e,packedOpSnippet:z$e,dtype:"bool"}),Xme={kernelName:Yh,backendName:"webgl",kernelFunc:V$e}});function j$e(n){let{inputs:t,backend:e}=n,{input:r}=t;return G3(r,!0,e)}var Qme,Zme=D(()=>{"use strict";ve();R7();Qme={kernelName:S1,backendName:"webgl",kernelFunc:j$e}});var U$e,q$e,Jme,ege=D(()=>{"use strict";ve();Xn();U$e="return float(!isnan(x) && !isinf(x));",q$e=An({opSnippet:U$e,dtype:"bool"}),Jme={kernelName:Qh,backendName:"webgl",kernelFunc:q$e}});var G$e,W$e,tge,nge=D(()=>{"use strict";ve();Xn();G$e="return float(isinf(x));",W$e=An({opSnippet:G$e,dtype:"bool"}),tge={kernelName:Zh,backendName:"webgl",kernelFunc:W$e}});var H$e,K$e,rge,oge=D(()=>{"use strict";ve();Xn();H$e="return float(isnan(x));",K$e=An({opSnippet:H$e,dtype:"bool"}),rge={kernelName:Jh,backendName:"webgl",kernelFunc:K$e}});var X$e,Y$e,Q$e,sge,ige=D(()=>{"use strict";ve();Xn();Vo();X$e="return float(a < b);",Y$e=`
  return vec4(lessThan(a, b));
`,Q$e=ro({opSnippet:X$e,packedOpSnippet:Y$e,cpuKernelImpl:jpe,dtype:"bool"}),sge={kernelName:u0,backendName:"webgl",kernelFunc:Q$e}});var Z$e,J$e,e8e,age,uge=D(()=>{"use strict";ve();Xn();Z$e="return float(a <= b);",J$e=`
  return vec4(lessThanEqual(a, b));
`,e8e=ro({opSnippet:Z$e,packedOpSnippet:J$e,dtype:"bool"}),age={kernelName:c0,backendName:"webgl",kernelFunc:e8e}});function t8e(n){let{backend:t,attrs:e}=n,{start:r,stop:o,num:s}=e,i=Upe(r,o,s);return t.makeTensorInfo([i.length],"float32",i)}var cge,lge=D(()=>{"use strict";ve();Vo();cge={kernelName:I1,backendName:"webgl",kernelFunc:t8e}});var n8e,r8e,o8e,pge,hge=D(()=>{"use strict";ve();Xn();Vo();n8e=`if (x < 0.0) return NAN;
  return log(x);`,r8e=`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,o8e=An({opSnippet:n8e,packedOpSnippet:r8e,cpuKernelImpl:qpe}),pge={kernelName:ed,backendName:"webgl",kernelFunc:o8e}});var s8e,i8e,dge,fge=D(()=>{"use strict";ve();Xn();s8e="return log(1.0 + x);",i8e=An({opSnippet:s8e}),dge={kernelName:td,backendName:"webgl",kernelFunc:i8e}});var a8e,u8e,c8e,mge,gge=D(()=>{"use strict";ve();Xn();a8e="return float(a >= 1.0 && b >= 1.0);",u8e=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,c8e=ro({opSnippet:a8e,packedOpSnippet:u8e,dtype:"bool"}),mge={kernelName:l0,backendName:"webgl",kernelFunc:c8e}});var l8e,p8e,yge,xge=D(()=>{"use strict";ve();Xn();l8e="return float(!(x >= 1.0));",p8e=An({opSnippet:l8e}),yge={kernelName:p0,backendName:"webgl",kernelFunc:p8e}});var h8e,d8e,f8e,bge,vge=D(()=>{"use strict";ve();Xn();h8e="return float(a >= 1.0 || b >= 1.0);",d8e=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,f8e=ro({opSnippet:h8e,packedOpSnippet:d8e,dtype:"bool"}),bge={kernelName:h0,backendName:"webgl",kernelFunc:f8e}});var J3,wge=D(()=>{"use strict";J3=class{constructor(t,e,r,o,s){this.variableNames=["x"],this.outputShape=[];let i=e,a=t[3]-1;this.outputShape=t;let u,c=`float(${r}) + float(${o}) * sum`;s===.5?u=`inversesqrt(${c})`:s===1?u=`1.0/(${c})`:u=`exp(log(${c}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}}});var eO,Sge=D(()=>{"use strict";eO=class{constructor(t,e,r,o,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let i=e,a=t[3]-1;this.outputShape=t;let u,c=`float(${r}) + float(${o}) * sum`;s===.5?u=`inversesqrt(${c})`:s===1?u=`1.0/(${c})`:u=`exp(log(${c}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}}});var m8e,Cge,Ige=D(()=>{"use strict";ve();wge();Sge();m8e=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{depthRadius:s,bias:i,alpha:a,beta:u}=r,c=mt().getBool("WEBGL_PACK_NORMALIZATION")?new eO(o.shape,s,i,a,u):new J3(o.shape,s,i,a,u);return e.runWebGLProgram(c,[o],o.dtype)},Cge={kernelName:lm,backendName:"webgl",kernelFunc:m8e}});var tO,_ge=D(()=>{"use strict";tO=class{constructor(t,e,r,o,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=r,this.alpha=o,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${s})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}});var g8e,Tge,Ege=D(()=>{"use strict";ve();_ge();g8e=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o,y:s,dy:i}=t,{depthRadius:a,bias:u,alpha:c,beta:h}=r,f=new tO(o.shape,a,u,c,h);return e.runWebGLProgram(f,[o,s,i],o.dtype)},Tge={kernelName:_1,backendName:"webgl",kernelFunc:g8e}});function Nge(n,t,e,r){let o=Y.sizeFromShape(t),i=Y.sizeFromShape(n.shape)/o,a=dn({inputs:{x:n},attrs:{shape:[i,o]},backend:r}),u=bc(a,n.dtype,"max",r),c=dn({inputs:{x:u},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),c}var kge=D(()=>{"use strict";ve();hy();Wo();});function M7(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reductionIndices:s,keepDims:i}=r,a=o.shape.length,u=Y.parseAxisParam(s,o.shape),c=u,h=Re.getAxesPermutation(c,a),f=h!=null,g=e.shouldExecuteOnCPU([o]),d=o;if(f){if(g){let T=e.texData.get(d.dataId).values,O=new Array(a);for(let R=0;R<O.length;R++)O[R]=o.shape[h[R]];let S=jx(T,o.shape,o.dtype,h,O);d=e.makeTensorInfo(O,o.dtype);let F=e.texData.get(d.dataId);F.values=S}else d=dy(o,h,e);c=Re.getInnerMostAxes(c.length,a)}Re.assertAxesAreInnerMostDims("max",c,a);let[p,m]=Re.computeOutAndReduceShapes(d.shape,c),y=p;i&&(y=Re.expandShapeToKeepDim(p,u));let v;if(g){let T=e.texData.get(d.dataId).values,O=Gpe(T,Y.sizeFromShape(m),y,o.dtype);v=e.makeTensorInfo(y,o.dtype);let S=e.texData.get(v.dataId);S.values=O}else v=Nge(d,m,y,e);return f&&e.disposeIntermediateTensorInfo(d),v}var Dge,F7=D(()=>{"use strict";ve();ve();Vo();kge();L2();Dge={kernelName:pm,backendName:"webgl",kernelFunc:M7}});var y8e,x8e,b8e,Age,Oge=D(()=>{"use strict";ve();cy();cf();Xn();Vo();y8e=o3+`
  return max(a, b);
`,x8e=`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+ly+`
  return result;
`,b8e=ro({opSnippet:y8e,packedOpSnippet:x8e,cpuKernelImpl:Wpe}),Age={kernelName:nd,backendName:"webgl",kernelFunc:b8e}});function v8e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t;uf(o,"maxPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:u}=r,c=1;Y.assert(Re.eitherStridesOrDilationsAreOne(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let h=Re.computePool2DInfo(o.shape,s,i,c,a,u);if(h.filterWidth===1&&h.filterHeight===1&&Y.arraysEqual(h.inShape,h.outShape))return Fs({inputs:{x:o},backend:e});let f=new Jp(h,"max",!1);return e.runWebGLProgram(f,[o],o.dtype)}var Rge,Mge=D(()=>{"use strict";ve();my();ol();il();Rge={kernelName:hm,backendName:"webgl",kernelFunc:v8e}});function w8e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:s,strides:i,pad:a,dataFormat:u,dimRoundingMode:c}=r,h=[1,1,1],f=Re.computePool3DInfo(o.shape,s,i,h,a,c,u),g=new fy(f,"max",!1);return e.runWebGLProgram(g,[o],o.dtype)}var Fge,Pge=D(()=>{"use strict";ve();my();Fge={kernelName:dm,backendName:"webgl",kernelFunc:w8e}});var nO,rO,P7=D(()=>{"use strict";nO=class{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;let e=t.strideHeight,r=t.strideWidth,o=t.dilationHeight,s=t.effectiveFilterHeight,i=t.effectiveFilterWidth,a=s-1-t.padInfo.top,u=i-1-t.padInfo.left,c=s*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},rO=class{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;let e=t.strideDepth,r=t.strideHeight,o=t.strideWidth,s=t.dilationDepth,i=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=u-1-t.padInfo.front,g=c-1-t.padInfo.top,d=h-1-t.padInfo.left,p=u*c*h-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${g}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${h} +
                  wR * ${h} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}});function S8e(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:s}=t,i=s,{filterSize:a,strides:u,pad:c,dimRoundingMode:h}=r,f=[1,1,1],g=Re.computePool3DInfo(i.shape,a,u,f,c,h),d=new fy(g,"max",!0),p=e.runWebGLProgram(d,[i],i.dtype),m=new rO(g),y=e.runWebGLProgram(m,[o,p],i.dtype);return e.disposeIntermediateTensorInfo(p),y}var $ge,Lge=D(()=>{"use strict";ve();P7();my();$ge={kernelName:E1,backendName:"webgl",kernelFunc:S8e}});function C8e(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:s,output:i}=t,a=s;uf([s,i],"maxPoolGrad");let{filterSize:u,strides:c,pad:h,dimRoundingMode:f}=r,g=Re.computePool2DInfo(a.shape,u,c,1,h,f),d=!0,p=new Jp(g,"max",d),m=e.runWebGLProgram(p,[a],a.dtype),y=new nO(g),v=e.runWebGLProgram(y,[o,m],a.dtype);return e.disposeIntermediateTensorInfo(m),v}var Bge,zge=D(()=>{"use strict";ve();P7();my();ol();Bge={kernelName:T1,backendName:"webgl",kernelFunc:C8e}});function Vge(n,t,e,r){let o=new Jp(e,"max",!1),s=r.runWebGLProgram(o,[n],"float32");o=new Jp(e,"max",!0,!0,t);let i=r.runWebGLProgram(o,[n],"float32");return[s,i]}var jge=D(()=>{"use strict";my();});var Uge,qge=D(()=>{"use strict";ve();ve();jge();Uge={kernelName:N1,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{x:r}=n,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=t,u=e;Y.assert(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let c=[1,1];Y.assert(Re.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let h=Re.computePool2DInfo(r.shape,o,s,c,i),[f,g]=Vge(r,a,h,u);return[f,g]}}});function Gge(n,t,e,r){let o=Y.sizeFromShape(t),i=Y.sizeFromShape(n.shape)/o,a=dn({inputs:{x:n},attrs:{shape:[i,o]},backend:r}),u=bc(a,"float32","mean",r),c=dn({inputs:{x:u},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),c}var Wge=D(()=>{"use strict";ve();hy();Wo();});var Hge,Kge=D(()=>{"use strict";ve();Wge();L2();Hge={kernelName:fm,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{x:r}=n,{keepDims:o,axis:s}=t,i=e,a=r.shape.length,u=Y.parseAxisParam(s,r.shape),c=u,h=Re.getAxesPermutation(c,a),f=h!=null,g=i.shouldExecuteOnCPU([r]),d=[],p=r;if(f){if(g){let O=i.texData.get(p.dataId).values,S=new Array(a);for(let L=0;L<S.length;L++)S[L]=r.shape[h[L]];let F=jx(O,r.shape,r.dtype,h,S);p=i.makeTensorInfo(S,r.dtype);let R=i.texData.get(p.dataId);R.values=F}else p=dy(r,h,i);d.push(p),c=Re.getInnerMostAxes(c.length,a)}Re.assertAxesAreInnerMostDims("sum",c,a);let[m,y]=Re.computeOutAndReduceShapes(p.shape,c),v=m;o&&(v=Re.expandShapeToKeepDim(m,u));let N=Gge(p,y,v,i);for(let T of d)i.disposeIntermediateTensorInfo(T);return N}}});function I8e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,keepDims:i}=r,a=o.shape.length,u=Y.parseAxisParam(s,o.shape),c=u,h=Re.getAxesPermutation(c,a),f=o;h!=null&&(f=Ss({inputs:{x:o},backend:e,attrs:{perm:h}}),c=Re.getInnerMostAxes(c.length,o.shape.length)),Re.assertAxesAreInnerMostDims("min",c,a);let[g,d]=Re.computeOutAndReduceShapes(f.shape,c),p=Y.sizeFromShape(d),m=dn({inputs:{x:f},backend:e,attrs:{shape:[-1,p]}}),y=bc(m,m.dtype,"min",e),v;if(i){let N=Re.expandShapeToKeepDim(g,u);v=dn({inputs:{x:y},backend:e,attrs:{shape:N}})}else v=dn({inputs:{x:y},backend:e,attrs:{shape:g}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),h!=null&&e.disposeIntermediateTensorInfo(f),v}var Xge,Yge=D(()=>{"use strict";ve();hy();Wo();al();Xge={kernelName:mm,backendName:"webgl",kernelFunc:I8e}});var _8e,T8e,E8e,Qge,Zge=D(()=>{"use strict";ve();cy();cf();Xn();Vo();_8e=o3+`
  return min(a, b);
`,T8e=`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+ly+`
  return result;
`,E8e=ro({opSnippet:_8e,packedOpSnippet:T8e,cpuKernelImpl:Hpe}),Qge={kernelName:rd,backendName:"webgl",kernelFunc:E8e}});var oO,Jge=D(()=>{"use strict";Gs();oO=class{constructor(t,e,r){this.variableNames=["x"],this.outputShape=e.map((h,f)=>h[0]+t[f]+h[1]);let o=t.length,s=pr(o),i=e.map(h=>h[0]).join(","),a=e.map((h,f)=>h[0]+t[f]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),c=r==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}}});var sO,e0e=D(()=>{"use strict";Zp();Gs();sO=class{constructor(t,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((p,m)=>p[0]+t[m]+p[1]);let o=t.length,s=pr(o),i=e.map(p=>p[0]).join(","),a=e.map((p,m)=>p[0]+t[m]).join(","),u=Ms("rc",o),c=Ms("source",o),h=`${u[o-1]} < ${this.outputShape[o-1]}`,f=o===1?"source":`vec2(${c.slice(-2).join()})`,g=r==="reflect"?0:1,d="";if(o===1){let p=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${g};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${g};
        }
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${f});
        ${u[o-1]} += 1;
        if(${h}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${f});
        }
      `}else{let p=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${g}) +
                gte * ((end - 1) * 2 - source + ${g});
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${f});
        ${u[o-1]} += 1;
        if(${h}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${f});
        }
        rc = outputLoc;
        ${u[o-2]} += 1;
        if(${u[o-2]} < ${this.outputShape[o-2]}) {
          ${p}
          result[2] = getChannel(getX(${c.join()}), ${f});
          ${u[o-1]} += 1;
          if(${h}) {
            ${p}
            result[3] = getChannel(getX(${c.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}}});var N8e,t0e,n0e=D(()=>{"use strict";ve();Jge();e0e();N8e=({inputs:n,backend:t,attrs:e})=>{let{x:r}=n,{paddings:o,mode:s}=e,i=mt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sO(r.shape,o,s):new oO(r.shape,o,s);return t.runWebGLProgram(i,[r],r.dtype)},t0e={kernelName:gm,backendName:"webgl",kernelFunc:N8e}});var k8e,D8e,A8e,r0e,o0e=D(()=>{"use strict";ve();cf();Xn();k8e=`if (b == 0.0) return NAN;
  return mod(a, b);`,D8e=`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  `+ly+`
  return result;
`,A8e=ro({opSnippet:k8e,packedOpSnippet:D8e}),r0e={kernelName:od,backendName:"webgl",kernelFunc:A8e}});var iO,s0e=D(()=>{"use strict";iO=class{constructor(t,e,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}getCustomSetupFunc(t){return(e,r)=>{this.seedLoc==null&&(this.seedLoc=e.getUniformLocation(r,"seed")),e.gl.uniform1f(this.seedLoc,t)}}}});var O8e,R8e,$7,i0e,L7=D(()=>{"use strict";ve();Xn();O8e=`
if (a == b) {
  return 1.0;
};
return a / b;`,R8e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,$7=ro({opSnippet:O8e,packedOpSnippet:R8e,checkOutOfBounds:!0}),i0e={kernelName:Uh,backendName:"webgl",kernelFunc:$7}});var a0e,B7,u0e,z7=D(()=>{"use strict";ve();Xn();Vo();a0e="return a - b;",B7=ro({opSnippet:a0e,packedOpSnippet:a0e,supportsComplex:!0,cpuKernelImpl:the}),u0e={kernelName:vd,backendName:"webgl",kernelFunc:B7}});function V7(n){let{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{dim:s}=r,i=Y.parseAxisParam([s],o.shape),a=M7({inputs:{x:o},backend:e,attrs:{reductionIndices:i,keepDims:!1}}),u=Re.expandShapeToKeepDim(a.shape,i),c=dn({inputs:{x:a},backend:e,attrs:{shape:u}}),h=B7({inputs:{a:o,b:c},backend:e}),f=D7({inputs:{x:h},backend:e}),g=w_({inputs:{x:f},backend:e,attrs:{axis:i,keepDims:!1}}),d=dn({inputs:{x:g},backend:e,attrs:{shape:u}}),p=$7({inputs:{a:f,b:d},backend:e});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(d),p}var c0e,j7=D(()=>{"use strict";ve();A7();F7();L7();Wo();z7();c3();c0e={kernelName:Om,backendName:"webgl",kernelFunc:V7}});function M8e(n){let{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{numSamples:s,seed:i,normalized:a}=r,u=a?o:V7({inputs:{logits:o},backend:e,attrs:{dim:o.shape.length-1}}),c=u.shape[0],h=u.shape[1],f=new iO(c,h,s),g=f.getCustomSetupFunc(i),d=e.runWebGLProgram(f,[u],"int32",g);return a||e.disposeIntermediateTensorInfo(u),d}var l0e,p0e=D(()=>{"use strict";ve();s0e();j7();l0e={kernelName:k1,backendName:"webgl",kernelFunc:M8e}});function F8e(n){let{inputs:t,backend:e}=n,{x:r}=t;if(e.shouldExecuteOnCPU([r])){let s=e.texData.get(r.dataId),[i,a]=Xpe(s.values,r.shape,r.dtype);return e.makeTensorInfo(a,r.dtype,i)}let o;return mt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new tp(r.shape,h0e):o=new Eu(r.shape,h0e),e.runWebGLProgram(o,[r],r.dtype)}var h0e,d0e,f0e=D(()=>{"use strict";ve();Vo();Ja();P2();h0e="return -x;";d0e={kernelName:ym,backendName:"webgl",kernelFunc:F8e}});function $8e(n){Re.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:s}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u}=r,c=e.readSync(o.dataId),h=e.readSync(s.dataId),{selectedIndices:f}=P8e(c,h,i,a,u);return e.makeTensorInfo([f.length],"int32",new Int32Array(f))}var P8e,m0e,g0e=D(()=>{"use strict";ve();P8e=oa.nonMaxSuppressionV3Impl;m0e={kernelName:D1,backendName:"webgl",kernelFunc:$8e}});function B8e(n){Re.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:s}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:c}=r,h=e.readSync(o.dataId),f=e.readSync(s.dataId),{selectedIndices:g,validOutputs:d}=L8e(h,f,i,a,u,c);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([],"int32",new Int32Array([d]))]}var L8e,y0e,x0e=D(()=>{"use strict";ve();L8e=oa.nonMaxSuppressionV4Impl;y0e={kernelName:A1,backendName:"webgl",kernelFunc:B8e}});function V8e(n){Re.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:s}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u,softNmsSigma:c}=r,h=e.readSync(o.dataId),f=e.readSync(s.dataId),g=i,d=a,p=u,m=c,{selectedIndices:y,selectedScores:v}=z8e(h,f,g,d,p,m);return[e.makeTensorInfo([y.length],"int32",new Int32Array(y)),e.makeTensorInfo([v.length],"float32",new Float32Array(v))]}var z8e,b0e,v0e=D(()=>{"use strict";ve();z8e=oa.nonMaxSuppressionV5Impl;b0e={kernelName:O1,backendName:"webgl",kernelFunc:V8e}});var aO,w0e=D(()=>{"use strict";aO=class{constructor(t,e,r,o){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${r}),
                      float(index == coords.y)));
      }
    `}}});var j8e,S0e,C0e=D(()=>{"use strict";ve();w0e();Wo();j8e=n=>{let{inputs:t,backend:e,attrs:r}=n,{indices:o}=t,{depth:s,onValue:i,offValue:a}=r,u=Y.sizeFromShape(o.shape),c=new aO(u,s,i,a),h=dn({inputs:{x:o},backend:e,attrs:{shape:[u]}}),f=e.runWebGLProgram(c,[h],o.dtype);e.disposeIntermediateTensorInfo(h);let g=[...o.shape,s],d=dn({inputs:{x:f},backend:e,attrs:{shape:g}});return e.disposeIntermediateTensorInfo(f),d},S0e={kernelName:bm,backendName:"webgl",kernelFunc:j8e}});function E_(n){let{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="complex64"){let o=dg({inputs:{input:r},backend:e}),s=E_({inputs:{x:o},backend:e}),i=qx({inputs:{input:r},backend:e}),a=E_({inputs:{x:i},backend:e}),u=Xu({inputs:{real:s,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(a),u}else return T_({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:e})}var I0e,U7=D(()=>{"use strict";ve();pg();H3();S_();z2();I0e={kernelName:Pm,backendName:"webgl",kernelFunc:E_}});function _0e(n){let{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let o=dg({inputs:{input:r},backend:e}),s=_0e({inputs:{x:o},backend:e}),i=qx({inputs:{input:r},backend:e}),a=E_({inputs:{x:i},backend:e}),u=Xu({inputs:{real:s,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(a),u}else return T_({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:e})}var T0e,E0e=D(()=>{"use strict";ve();pg();H3();S_();z2();U7();T0e={kernelName:xm,backendName:"webgl",kernelFunc:_0e}});function U8e(n){let{inputs:t,backend:e,attrs:r}=n,{axis:o}=r;if(t.length===1)return q3({inputs:{input:t[0]},backend:e,attrs:{dim:o}});let s=t[0].shape,i=t[0].dtype;t.forEach(h=>{Y.assertShapesMatch(s,h.shape,"All tensors passed to stack must have matching shapes"),Y.assert(i===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],u=t.map(h=>{let f=q3({inputs:{input:h},backend:e,attrs:{dim:o}});return a.push(f),f}),c=I7({inputs:u,backend:e,attrs:{axis:o}});return a.forEach(h=>e.disposeIntermediateTensorInfo(h)),c}var N0e,k0e=D(()=>{"use strict";ve();_7();O7();N0e={kernelName:vm,backendName:"webgl",kernelFunc:U8e}});var uO,D0e=D(()=>{"use strict";Gs();uO=class{constructor(t,e,r){this.variableNames=["x"],this.outputShape=e.map((c,h)=>c[0]+t[h]+c[1]);let o=t.length,s=pr(o),i=e.map(c=>c[0]).join(","),a=e.map((c,h)=>c[0]+t[h]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(${r}));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(${r}));
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}}});var cO,A0e=D(()=>{"use strict";Zp();Gs();cO=class{constructor(t,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((m,y)=>m[0]+t[y]+m[1]);let o=t.length,s=pr(o),i=e.map(m=>m[0]).join(","),a=e.map((m,y)=>m[0]+t[y]).join(","),u=Ms("rc",o),c=Ms("source",o),h=`${u[o-1]} < ${this.outputShape[o-1]}`,f=o===1?"source":`vec2(${c.slice(-2).join()})`,g=[`${s} rc = outputLoc;`,`${u[o-1]} += 1;
       if(${h}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${u[o-2]} += 1;
       if(${u[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${u[o-1]} += 1;
         if(${h}) {`],d=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="";for(let m=0,y=o===1?2:4;m<y;m++)p+=`
        ${g[m]}
        if (${d}) {
          result[${m}] = float(${r});
        } else {
          ${s} source = rc - start;
          result[${m}] = getChannel(getX(${c.join()}), ${f});
        }
      `;p+=o===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}});var q7,O0e,G7=D(()=>{"use strict";ve();D0e();A0e();q7=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{paddings:s,constantValue:i}=r,a=mt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new cO(o.shape,s,i):new uO(o.shape,s,i);return e.runWebGLProgram(a,[o],o.dtype)},O0e={kernelName:wm,backendName:"webgl",kernelFunc:q7}});var q8e,G8e,W8e,R0e,M0e=D(()=>{"use strict";ve();cf();Xn();q8e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,G8e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  `+ly+`
  return result;
`,W8e=ro({opSnippet:q8e,packedOpSnippet:G8e}),R0e={kernelName:id,backendName:"webgl",kernelFunc:W8e}});function H8e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:s,keepDims:i}=r,a=o.shape.length,u=[],c=Y.parseAxisParam(s,o.shape),h=c,f=Re.getAxesPermutation(h,a),g=o;f!=null&&(g=Ss({inputs:{x:o},backend:e,attrs:{perm:f}}),h=Re.getInnerMostAxes(h.length,a),u.push(g)),Re.assertAxesAreInnerMostDims("prod",h,a);let d;if(e.shouldExecuteOnCPU([g])){let p=e.texData.get(g.dataId).values,{outVals:m,outShape:y,outDtype:v}=Ype(g.shape,g.dtype,p,h);d=e.makeTensorInfo(y,v,m)}else{let[p,m]=Re.computeOutAndReduceShapes(g.shape,h),y=Y.sizeFromShape(m),v=dn({inputs:{x:g},backend:e,attrs:{shape:[-1,y]}}),N=x0(o.dtype),T=bc(v,N,"prod",e);d=dn({inputs:{x:T},backend:e,attrs:{shape:p}}),u.push(v),u.push(T)}if(i){u.push(d);let p=Re.expandShapeToKeepDim(d.shape,c);d=dn({inputs:{x:d},backend:e,attrs:{shape:p}})}return u.forEach(p=>e.disposeIntermediateTensorInfo(p)),d}var F0e,P0e=D(()=>{"use strict";ve();hy();Vo();Wo();al();F0e={kernelName:R1,backendName:"webgl",kernelFunc:H8e}});var W7,$0e,H7=D(()=>{"use strict";ve();Vo();W7=n=>{let{backend:t,attrs:e}=n,{start:r,stop:o,step:s,dtype:i}=e,a=Qpe(r,o,s,i);return t.makeTensorInfo([a.length],i,a)},$0e={kernelName:M1,backendName:"webgl",kernelFunc:W7}});var K8e,X8e,L0e,B0e=D(()=>{"use strict";ve();Xn();K8e="return 1.0 / x;",X8e=An({opSnippet:K8e}),L0e={kernelName:ad,backendName:"webgl",kernelFunc:X8e}});var Y8e,Q8e,Z8e,z0e,V0e=D(()=>{"use strict";ve();Xn();Ja();Y8e=Vi+`
  return (x < 0.0) ? 0.0 : x;
`,Q8e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Z8e=An({opSnippet:Y8e,packedOpSnippet:Q8e}),z0e={kernelName:ud,backendName:"webgl",kernelFunc:Z8e}});var J8e,eLe,tLe,j0e,U0e=D(()=>{"use strict";ve();Xn();Ja();J8e=Vi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,eLe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tLe=An({opSnippet:J8e,packedOpSnippet:eLe}),j0e={kernelName:cd,backendName:"webgl",kernelFunc:tLe}});var lO,q0e=D(()=>{"use strict";lO=class{constructor(t,e,r,o,s){this.variableNames=["A"],this.outputShape=[];let[i,a,u,c]=t;this.outputShape=[i,e,r,c];let h=[o&&e>1?a-1:a,o&&r>1?u-1:u],f=[o&&e>1?e-1:e,o&&r>1?r-1:r],g;s?g="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/f[0]},
          ${h[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}});var pO,G0e=D(()=>{"use strict";pO=class{constructor(t,e,r,o,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[i,a,u,c]=t;this.outputShape=[i,e,r,c];let h=[o&&e>1?a-1:a,o&&r>1?u-1:u],f=[o&&e>1?e-1:e,o&&r>1?r-1:r],g;s?g="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/f[0]},
          ${h[1]/f[1]},
          ${h[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}});function nLe(n){let{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:s,halfPixelCenters:i,size:a}=r,[u,c]=a,h=mt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new pO(o.shape,u,c,s,i):new lO(o.shape,u,c,s,i);return e.runWebGLProgram(h,[o],"float32")}var W0e,H0e=D(()=>{"use strict";ve();q0e();G0e();W0e={kernelName:_m,backendName:"webgl",kernelFunc:nLe}});var hO,K0e=D(()=>{"use strict";hO=class{constructor(t,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,s]=e,[,i,a]=t,u=[r&&i>1?o-1:o,r&&a>1?s-1:s],c=[r&&i>1?i-1:i,r&&a>1?a-1:a],h=u[0]/c[0],f=u[1]/c[1],g=1/h,d=1/f,p=Math.ceil(g)*2+2,m=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${f});

        const float invHeightScale = float(${g});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}});function rLe(n){let{inputs:t,backend:e,attrs:r}=n,{images:o,dy:s}=t,{alignCorners:i}=r,a=new hO(s.shape,o.shape,i);return e.runWebGLProgram(a,[s],s.dtype)}var X0e,Y0e=D(()=>{"use strict";ve();K0e();X0e={kernelName:$1,backendName:"webgl",kernelFunc:rLe}});var dO,Q0e=D(()=>{"use strict";dO=class{constructor(t,e,r,o,s){this.variableNames=["A"],this.outputShape=[];let[i,a,u,c]=t;this.outputShape=[i,e,r,c];let h=[o&&e>1?a-1:a,o&&r>1?u-1:u],f=[o&&e>1?e-1:e,o&&r>1?r-1:r],g=o?"0.5":"0.0",d;s?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/f[0]},
          ${h[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${g})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}});function oLe(n){let{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:s,halfPixelCenters:i,size:a}=r,[u,c]=a,h=new dO(o.shape,u,c,s,i);return e.runWebGLProgram(h,[o],o.dtype)}var Z0e,J0e=D(()=>{"use strict";ve();Q0e();Z0e={kernelName:Im,backendName:"webgl",kernelFunc:oLe}});var fO,eye=D(()=>{"use strict";fO=class{constructor(t,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,s]=e,[,i,a]=t,u=[r&&i>1?o-1:o,r&&a>1?s-1:s],c=[r&&i>1?i-1:i,r&&a>1?a-1:a],h=u[0]/c[0],f=u[1]/c[1],g=1/h,d=1/f,p=Math.ceil(g)*2+2,m=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${f});

        const float invHeightScale = float(${g});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}});function sLe(n){let{inputs:t,backend:e,attrs:r}=n,{images:o,dy:s}=t,{alignCorners:i}=r,a=new fO(s.shape,o.shape,i);return e.runWebGLProgram(a,[s],s.dtype)}var tye,nye=D(()=>{"use strict";ve();eye();tye={kernelName:P1,backendName:"webgl",kernelFunc:sLe}});var mO,rye=D(()=>{"use strict";Gs();mO=class{constructor(t,e){this.variableNames=["x"];let r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=t,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}let o=a=>e.indexOf(a)!==-1&&t[a]!==1?`${t[a]} - coords[${a}] - 1`:`coords[${a}]`,s=t.map((a,u)=>o(u)).join(","),i=pr(r);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}}});var gO,oye=D(()=>{"use strict";Zp();Gs();gO=class{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=t;let o=Ms("rc",r),s=`${o[r-1]} + 1 < ${this.outputShape[r-1]}`,i=`${o[r-2]} + 1 < ${this.outputShape[r-2]}`,a=pr(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(o.slice())};
          if(${s}){
            result.g = ${c(o.slice())};
          }
          if(${i}) {
            result.b = ${h(o.slice())};
            if(${s}) {
              result.a = ${f(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(p){return g(p)}function c(p){return p[r-1]="("+p[r-1]+" + 1)",g(p)}function h(p){return p[r-2]="("+p[r-2]+" + 1)",g(p)}function f(p){return p[r-1]="("+p[r-1]+" + 1)",p[r-2]="("+p[r-2]+" + 1)",g(p)}function g(p){let m=t.map((N,T)=>d(T,p)),y=m.join(","),v=m.slice(-2).join(",");return`getChannel(getX(${y}), vec2(${v}))`}function d(p,m){return e.indexOf(p)!==-1&&t[p]!==1?`${t[p]} - ${m[p]} - 1`:`${m[p]}`}}}});function iLe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dims:s}=r,i=o.shape.length,a=Y.parseAxisParam(s,o.shape);if(i===0)return Fs({inputs:{x:o},backend:e});let u=mt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gO(o.shape,a):new mO(o.shape,a);return e.runWebGLProgram(u,[o],o.dtype)}var sye,iye=D(()=>{"use strict";ve();rye();oye();il();sye={kernelName:Tm,backendName:"webgl",kernelFunc:iLe}});var yO,aye=D(()=>{"use strict";ve();yO=class{constructor(t,e,r,o){this.variableNames=["Image"],this.outputShape=[];let s=t[1],i=t[2],a=Math.sin(e).toFixed(3),u=Math.cos(e).toFixed(3);this.outputShape=t;let[c,h]=Re.getImageCenter(o,s,i),f=c.toFixed(3),g=h.toFixed(3),d="";typeof r=="number"?d=`float outputValue = ${r.toFixed(2)};`:d=`
        vec3 fill = vec3(${r.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - ${f}) * ${u} - (float(y) - ${g}) * ${a};
          float coordYFloat = (float(x) - ${f}) * ${a} + (float(y) - ${g}) * ${u};
          int coordX = int(round(coordXFloat + ${f}));
          int coordY = int(round(coordYFloat + ${g}));
          ${d}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}});var uye,cye=D(()=>{"use strict";ve();aye();uye={kernelName:q1,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{image:r}=n,{radians:o,fillValue:s,center:i}=t,a=e,u=new yO(r.shape,o,s,i);return a.runWebGLProgram(u,[r],r.dtype)}}});var aLe,uLe,lye,pye=D(()=>{"use strict";ve();Xn();aLe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,uLe=An({opSnippet:aLe}),lye={kernelName:ld,backendName:"webgl",kernelFunc:uLe}});var cLe,lLe,hye,dye=D(()=>{"use strict";ve();Xn();Vo();cLe="return inversesqrt(x);",lLe=An({opSnippet:cLe,cpuKernelImpl:Zpe}),hye={kernelName:pd,backendName:"webgl",kernelFunc:lLe}});var G2,K7=D(()=>{"use strict";Gs();G2=class{constructor(t,e,r,o,s,i,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;let u=pr(s.length),c=pr(i.length),h="";r===1?h="i":r===2&&(h="i, j");let f=`getIndices(${h})`,g="";o===1?g="i":o===2&&(g="i, coords[1]");let d=`getUpdates(${g})`,p=e>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${s});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${p};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${d};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}});function pLe(n){let{inputs:t,backend:e,attrs:r}=n,{indices:o,updates:s}=t,{shape:i}=r,{sliceRank:a,numUpdates:u,sliceSize:c,strides:h,outputSize:f}=Re.calculateShapes(s,o,i),g=[f/c,c];if(f===0)return e.makeTensorInfo(i,o.dtype);let d=dn({inputs:{x:o},backend:e,attrs:{shape:[u,a]}}),p=dn({inputs:{x:s},backend:e,attrs:{shape:[u,c]}}),m=e.makeTensorInfo([],"float32",new Float32Array([0])),y=new G2(u,a,d.shape.length,p.shape.length,h,g),v=e.runWebGLProgram(y,[p,d,m],p.dtype),N=dn({inputs:{x:v},backend:e,attrs:{shape:i}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(m),N}var fye,mye=D(()=>{"use strict";ve();K7();Wo();fye={kernelName:L1,backendName:"webgl",kernelFunc:pLe}});var xO,gye=D(()=>{"use strict";Gs();xO=class{constructor(t,e,r){this.variableNames=["c","a","b"],this.outputShape=e;let o,s;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)s="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],c=[];for(let h=0;h<e.length;h++)c.push(`${a[h]}`),h<t&&u.push(`${a[h]}`);o=u.join(),s=c.join()}let i=pr(r);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}}});function hLe(n){let{inputs:t,backend:e}=n,{condition:r,t:o,e:s}=t,i=new xO(r.shape.length,o.shape,o.shape.length);return e.runWebGLProgram(i,[r,o,s],ci(o.dtype,s.dtype))}var yye,xye=D(()=>{"use strict";ve();gye();yye={kernelName:Em,backendName:"webgl",kernelFunc:hLe}});var dLe,fLe,bye,vye=D(()=>{"use strict";ve();Xn();dLe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Re.SELU_SCALEALPHA};
  float scale = ${Re.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,fLe=An({opSnippet:dLe}),bye={kernelName:hd,backendName:"webgl",kernelFunc:fLe}});var mLe,gLe,wye,Sye=D(()=>{"use strict";ve();Xn();mLe="return 1.0 / (1.0 + exp(-1.0 * x));",gLe=An({opSnippet:mLe}),wye={kernelName:gd,backendName:"webgl",kernelFunc:gLe}});var yLe,xLe,Cye,Iye=D(()=>{"use strict";ve();Xn();yLe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,xLe=An({opSnippet:yLe}),Cye={kernelName:md,backendName:"webgl",kernelFunc:xLe}});var bLe,vLe,_ye,Tye=D(()=>{"use strict";ve();Xn();bLe=s3+`
  return sin(x);
`,vLe=An({opSnippet:bLe}),_ye={kernelName:dd,backendName:"webgl",kernelFunc:vLe}});var wLe,SLe,Eye,Nye=D(()=>{"use strict";ve();Xn();wLe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,SLe=An({opSnippet:wLe}),Eye={kernelName:fd,backendName:"webgl",kernelFunc:SLe}});var CLe,ILe,kye,Dye=D(()=>{"use strict";ve();Xn();CLe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,ILe=An({opSnippet:CLe}),kye={kernelName:yd,backendName:"webgl",kernelFunc:ILe}});var _Le,Aye,Oye=D(()=>{"use strict";ve();G7();Wo();al();_Le=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:s,paddings:i}=r;Y.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=s.reduce((v,N)=>v*N),u=[[0,0]];u.push(...i);for(let v=1+s.length;v<o.shape.length;++v)u.push([0,0]);let c=[],h=q7({inputs:{x:o},backend:e,attrs:{paddings:u,constantValue:0}}),f=Re.getReshaped(h.shape,s,a,!1),g=Re.getPermuted(f.length,s.length,!1),d=Re.getReshapedPermuted(h.shape,s,a,!1),p=dn({inputs:{x:h},backend:e,attrs:{shape:f}}),m=Ss({inputs:{x:p},backend:e,attrs:{perm:g}}),y=dn({inputs:{x:m},backend:e,attrs:{shape:d}});return c.push(h),c.push(p),c.push(m),c.forEach(v=>e.disposeIntermediateTensorInfo(v)),y},Aye={kernelName:Dm,backendName:"webgl",kernelFunc:_Le}});function TLe(n){let{inputs:t,backend:e,attrs:r}=n,{sparseIndices:o,sparseValues:s,defaultValue:i}=t,{outputShape:a}=r,{sliceRank:u,numUpdates:c,strides:h,outputSize:f}=Re.calculateShapes(s,o,a),g=!1,d=new G2(c,u,o.shape.length,s.shape.length,h,[f,1],g),p=e.runWebGLProgram(d,[s,o,i],s.dtype),m=dn({inputs:{x:p},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(p),m}var Rye,Mye=D(()=>{"use strict";ve();K7();Wo();Rye={kernelName:z1,backendName:"webgl",kernelFunc:TLe}});function ELe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{numOrSizeSplits:s,axis:i}=r,a=Y.parseAxisParam(i,o.shape)[0],u=Re.prepareSplitSize(o,s,a),c=o.shape.length,h=new Array(c).fill(0),f=o.shape.slice();return u.map(g=>{let d=[...f];d[a]=g;let p=hg({inputs:{x:o},backend:e,attrs:{begin:h,size:d}});return h[a]+=g,p})}var Fye,Pye=D(()=>{"use strict";ve();B2();Fye={kernelName:Am,backendName:"webgl",kernelFunc:ELe}});var NLe,kLe,$ye,Lye=D(()=>{"use strict";ve();Xn();NLe="return sqrt(x);",kLe=An({opSnippet:NLe}),$ye={kernelName:xd,backendName:"webgl",kernelFunc:kLe}});var DLe,ALe,Bye,zye=D(()=>{"use strict";ve();Xn();DLe="return x * x;",ALe=An({opSnippet:DLe}),Bye={kernelName:B1,backendName:"webgl",kernelFunc:ALe}});var Vye,OLe,jye,Uye=D(()=>{"use strict";ve();Xn();Vye="return (a - b) * (a - b);",OLe=ro({opSnippet:Vye,packedOpSnippet:Vye}),jye={kernelName:bd,backendName:"webgl",kernelFunc:OLe}});function RLe({inputs:n,attrs:t,backend:e}){let{x:r}=n,o=Vi+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,s=new Eu(r.shape,o);return e.runWebGLProgram(s,[r],r.dtype)}var qye,Gye=D(()=>{"use strict";ve();Ja();qye={kernelName:Cd,backendName:"webgl",kernelFunc:RLe}});var bO,Wye=D(()=>{"use strict";Gs();bO=class{constructor(t,e,r){this.variableNames=["x"],this.outputShape=r;let o=r.length,s=pr(r.length),i=pr(r.length),a="";if(o===1)a="coords * strides + begin";else{let u=0;a=r.map((c,h)=>(u++,r.length===1?`coords * strides[${h}] + begin[${h}]`:`coords[${u-1}] * strides[${h}] + begin[${h}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${t});
      ${s} strides = ${s}(${e});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}});function MLe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:s,end:i,strides:a,beginMask:u,endMask:c,ellipsisMask:h,newAxisMask:f,shrinkAxisMask:g}=r,{nonStrided:d,$begin:p,$strides:m,size:y,newShape:v,outShape:N}=Ji.sliceInfo(o.shape,s,i,a,u,c,h,f,g),T=dn({inputs:{x:o},backend:e,attrs:{shape:v}}),O;if(d){let F=hg({inputs:{x:T},backend:e,attrs:{begin:p,size:y}});O=dn({inputs:{x:F},backend:e,attrs:{shape:N}}),e.disposeIntermediateTensorInfo(F)}else if(N.some(F=>F===0))O=e.makeTensorInfo(N,o.dtype,[]);else if(e.shouldExecuteOnCPU([T])){let L=e.texData.get(T.dataId).values,q=Rn(T.shape,T.dtype,L),U=ehe(N,q,m,p);O=e.makeTensorInfo(N,T.dtype,U.values)}else{let R=new bO(p,m,N);O=e.runWebGLProgram(R,[T],T.dtype)}let S=dn({inputs:{x:O},backend:e,attrs:{shape:N}});return e.disposeIntermediateTensorInfo(T),e.disposeIntermediateTensorInfo(O),S}var Hye,Kye=D(()=>{"use strict";ve();Vo();Wye();Wo();B2();Hye={kernelName:V1,backendName:"webgl",kernelFunc:MLe}});var FLe,PLe,Xye,Yye=D(()=>{"use strict";ve();Xn();FLe="return tan(x);",PLe=An({opSnippet:FLe}),Xye={kernelName:wd,backendName:"webgl",kernelFunc:PLe}});var $Le,LLe,Qye,Zye=D(()=>{"use strict";ve();Xn();$Le=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,LLe=An({opSnippet:$Le}),Qye={kernelName:Sd,backendName:"webgl",kernelFunc:LLe}});function BLe(n){let t=n.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${n[0]})`;let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let o=0;o<n.length;o++)r.push(`imod(${e[o]}, ${n[o]})`);return r.join()}var vO,Jye=D(()=>{"use strict";Gs();vO=class{constructor(t,e){this.variableNames=["A"];let r=new Array(t.length);for(let i=0;i<r.length;i++)r[i]=t[i]*e[i];this.outputShape=r,this.rank=r.length;let o=pr(this.rank),s=BLe(t);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}}});function X7(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reps:s}=r;if(o.dtype==="string"){let c=e.readSync(o.dataId).map(g=>Y.decodeString(g)),h=Rn(o.shape,o.dtype,c),f=nhe(h,s);return e.makeTensorInfo(f.shape,f.dtype,f.values)}let i=new vO(o.shape,s);return e.runWebGLProgram(i,[o],o.dtype)}var e1e,Y7=D(()=>{"use strict";ve();Vo();Jye();e1e={kernelName:Ap,backendName:"webgl",kernelFunc:X7}});function zLe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{k:s,sorted:i}=r,a=e.readSync(o.dataId),[u,c]=rhe(a,o.shape,o.dtype,s,i);return[e.makeTensorInfo(u.shape,u.dtype,u.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var t1e,n1e=D(()=>{"use strict";ve();Vo();t1e={kernelName:j1,backendName:"webgl",kernelFunc:zLe}});function VLe(n){let{inputs:t,attrs:e,backend:r}=n,{axis:o}=e,{x:s}=t;uf(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let i=r.readSync(s.dataId),{outputValues:a,outputShape:u,indices:c}=ohe(i,o,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var r1e,o1e=D(()=>{"use strict";ve();Vo();ol();r1e={kernelName:U1,backendName:"webgl",kernelFunc:VLe}});function jLe(n){let{inputs:t,backend:e,attrs:r}=n,{value:o}=t,{axis:s}=r;s<0&&(s+=o.shape.length);let i=o,a=i.shape.length,u=o.shape[s],c=new Array(a-1),h=0;for(let m=0;m<a;m++)m!==s&&(c[h++]=i.shape[m]);let f=[],g=new Array(a).fill(0),d=i.shape.slice();d[s]=1;let p=new Array(u);for(let m=0;m<p.length;m++){g[s]=m;let y=hg({inputs:{x:i},backend:e,attrs:{begin:g,size:d}}),v=dn({inputs:{x:y},backend:e,attrs:{shape:c}});p[m]=v,f.push(y)}return f.forEach(m=>e.disposeIntermediateTensorInfo(m)),p}var s1e,i1e=D(()=>{"use strict";ve();Wo();B2();s1e={kernelName:Mm,backendName:"webgl",kernelFunc:jLe}});var wO,a1e=D(()=>{"use strict";wO=class{constructor(t,e){this.variableNames=["x","segmentIds"];let r=t.windowSize,o=t.batchSize,s=t.inSize,i=t.numSegments,a=i*Math.ceil(s/r);this.outputShape=[o,a];let u="0.0",c="sumValue",h=Math.floor(r/4)*4,f=r%4,g=`
        sumValue += dot(values, segFilter);
    `,d="";s%r>0&&(d=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let p="";s%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${g}
        }

        int inIdx = inOffset + ${h};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${g}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${g}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${g}
        }
        setOutput(${c});
      }
    `}}});function ULe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,segmentIds:s}=t,{numSegments:i}=r,a=o.shape.length,u=[],c=0,h=Re.getAxesPermutation([c],a),f=o;h!=null&&(f=Ss({inputs:{x:o},backend:e,attrs:{perm:h}}),u.push(f),c=Re.getInnerMostAxes(1,a)[0]);let g=Re.segment_util.computeOutShape(f.shape,c,i),d=Y.sizeFromShape([f.shape[c]]),p=dn({inputs:{x:f},backend:e,attrs:{shape:[-1,d]}});u.push(p);let m=x0(o.dtype),y=(O,S,F,R,L)=>{let q=O.shape[0],U=O.shape[1],Z=Re.segment_util.segOpComputeOptimalWindowSize(U,L),ee={windowSize:Z,inSize:U,batchSize:q,numSegments:L},Q=new wO(ee,S),oe=e.compileAndRun(Q,[O,F],R);if(u.push(oe),oe.shape[1]===L)return oe;let se=W7({backend:e,attrs:{start:0,stop:L,step:1,dtype:"float32"}}),pe=X7({inputs:{x:se},backend:e,attrs:{reps:[U/Z]}});return u.push(se),u.push(pe),y(oe,S,pe,R,L)},v=y(p,"unsortedSegmentSum",s,m,i),N=dn({inputs:{x:v},backend:e,attrs:{shape:g}}),T=N;if(h!=null){u.push(N);let O=Re.getUndoAxesPermutation(h);T=Ss({inputs:{x:T},backend:e,attrs:{perm:O}})}return u.forEach(O=>e.disposeIntermediateTensorInfo(O)),T}var u1e,c1e=D(()=>{"use strict";ve();a1e();H7();Wo();Y7();al();u1e={kernelName:Fm,backendName:"webgl",kernelFunc:ULe}});var qLe,l1e=D(()=>{"use strict";ve();Ghe();Khe();Yhe();Zhe();tde();sde();ade();cde();mde();yde();bde();wde();Cde();_de();Ede();kde();Ade();Rde();Fde();$de();Vde();Wde();Kde();efe();rfe();afe();pg();pfe();_7();vfe();Sfe();Ife();Tfe();Nfe();Dfe();Ofe();Mfe();$fe();jfe();qfe();Hfe();Xfe();Qfe();Jfe();nme();sme();ame();cme();pme();dme();A7();O7();bme();Sme();H3();Eme();Dme();Ome();Pme();Lme();zme();Ume();Wme();Kme();Yme();il();Zme();S_();ege();nge();oge();u7();ige();uge();lge();hge();fge();gge();xge();vge();Ige();Ege();F7();Oge();Mge();Pge();Lge();zge();qge();Kge();Yge();Zge();n0e();o0e();p0e();g7();f0e();g0e();x0e();v0e();S7();C0e();E0e();k0e();G7();M0e();p7();P0e();H7();z2();L7();B0e();V0e();U0e();Wo();H0e();Y0e();J0e();nye();iye();cye();pye();dye();mye();xye();vye();Sye();Iye();Tye();Nye();B2();j7();Dye();Oye();Mye();Pye();Lye();zye();Uye();Gye();Kye();z7();c3();Yye();Zye();Y7();n1e();al();o1e();i1e();c1e();U7();qLe=[Cge,Tge,qhe,Hhe,Xhe,Qhe,ede,ode,ide,ude,fde,gde,xde,vde,Ide,Sde,Tde,Dde,Nde,Ode,Mde,Pde,zde,Gde,Hde,Jde,nfe,ife,lfe,The,yfe,wfe,Cfe,bfe,Efe,kfe,_fe,Afe,Rfe,Pfe,Vfe,Ufe,Wfe,Yfe,Zfe,Kfe,tme,ome,ime,ume,lme,hme,mme,gme,xme,wme,Ime,Tme,kme,Ame,Fme,$me,Bme,jme,Gme,Hme,Xme,_he,Qme,ffe,Jme,tge,rge,Ehe,sge,age,cge,dge,pge,mge,yge,bge,Dge,Fge,Rge,$ge,Bge,Uge,Age,Hge,Xge,Qge,t0e,r0e,l0e,Ohe,d0e,m0e,y0e,b0e,Xde,S0e,T0e,N0e,O0e,R0e,Nhe,F0e,$0e,Yde,i0e,L0e,j0e,z0e,Fhe,W0e,X0e,Z0e,tye,sye,uye,lye,hye,fye,yye,bye,wye,Cye,_ye,Eye,qde,c0e,kye,Aye,Rye,Fye,$ye,Bye,jye,qye,Hye,u0e,jhe,Xye,Qye,e1e,t1e,Uhe,r1e,s1e,u1e,I0e];for(let n of qLe)Bv(n)});var Q7=D(()=>{"use strict";Ihe();l1e();});var p1e,h1e=D(()=>{"use strict";p1e="2.8.6"});var Z7={};Br(Z7,{Abs:()=>Uf,Acos:()=>Oh,Acosh:()=>Rh,AdadeltaOptimizer:()=>hI,AdagradOptimizer:()=>dI,AdamOptimizer:()=>fI,AdamaxOptimizer:()=>mI,Add:()=>Nl,AddN:()=>qf,All:()=>n1,Any:()=>r1,ArgMax:()=>Gf,ArgMin:()=>Wf,Asin:()=>Mh,Asinh:()=>Fh,Atan:()=>Ph,Atan2:()=>Lh,Atanh:()=>$h,AvgPool:()=>Hf,AvgPool3D:()=>Kf,AvgPool3DGrad:()=>s1,AvgPoolGrad:()=>o1,BatchMatMul:()=>Xf,BatchToSpaceND:()=>Yf,Bincount:()=>i1,BroadcastTo:()=>kM,Callback:()=>WI,CallbackList:()=>_I,Cast:()=>Dp,Ceil:()=>Bh,ClipByValue:()=>zh,Complex:()=>a1,ComplexAbs:()=>Qf,Concat:()=>Zf,Conv2D:()=>Jf,Conv2DBackpropFilter:()=>u1,Conv2DBackpropInput:()=>em,Conv3D:()=>tm,Conv3DBackpropFilterV2:()=>c1,Conv3DBackpropInputV2:()=>l1,Cos:()=>Vh,Cosh:()=>jh,CropAndResize:()=>p1,Cumsum:()=>nm,CustomCallback:()=>EI,DataStorage:()=>s0,DenseBincount:()=>h1,DepthToSpace:()=>d1,DepthwiseConv2dNative:()=>rm,DepthwiseConv2dNativeBackpropFilter:()=>f1,DepthwiseConv2dNativeBackpropInput:()=>m1,Diag:()=>g1,Dilation2D:()=>om,Dilation2DBackpropFilter:()=>Pv,Dilation2DBackpropInput:()=>Fv,ENV:()=>qE,EarlyStopping:()=>HI,Elu:()=>qh,EluGrad:()=>y1,Environment:()=>Mv,Equal:()=>i0,Erf:()=>Gh,Exp:()=>Wh,ExpandDims:()=>sm,Expm1:()=>Hh,FFT:()=>x1,Fill:()=>b1,FlipLeftRight:()=>v1,Floor:()=>Kh,FloorDiv:()=>Xh,FromPixels:()=>$v,FusedBatchNorm:()=>im,FusedConv2D:()=>m0,FusedDepthwiseConv2D:()=>g0,GatherNd:()=>w1,GatherV2:()=>am,GraphModel:()=>ZI,Greater:()=>a0,GreaterEqual:()=>Yh,History:()=>TI,IFFT:()=>S1,Identity:()=>um,Imag:()=>C1,InputSpec:()=>zo,IsFinite:()=>Qh,IsInf:()=>Zh,IsNan:()=>Jh,KernelBackend:()=>kh,LRN:()=>lm,LRNGrad:()=>_1,LayerVariable:()=>Zw,LayersModel:()=>Gl,LeakyRelu:()=>cm,Less:()=>u0,LessEqual:()=>c0,LinSpace:()=>I1,Log:()=>ed,Log1p:()=>td,LogSoftmax:()=>DM,LogicalAnd:()=>l0,LogicalNot:()=>p0,LogicalOr:()=>h0,Max:()=>pm,MaxPool:()=>hm,MaxPool3D:()=>dm,MaxPool3DGrad:()=>E1,MaxPoolGrad:()=>T1,MaxPoolWithArgmax:()=>N1,Maximum:()=>nd,Mean:()=>fm,Min:()=>mm,Minimum:()=>rd,MirrorPad:()=>gm,Mod:()=>od,MomentumOptimizer:()=>gI,Multinomial:()=>k1,Multiply:()=>sd,Neg:()=>ym,NonMaxSuppressionV3:()=>D1,NonMaxSuppressionV4:()=>A1,NonMaxSuppressionV5:()=>O1,NotEqual:()=>d0,OP_SCOPE_SUFFIX:()=>zM,OneHot:()=>bm,OnesLike:()=>xm,Optimizer:()=>ra,Pack:()=>vm,PadV2:()=>wm,Pool:()=>oIe,Pow:()=>id,Prelu:()=>Sm,Prod:()=>R1,RMSPropOptimizer:()=>yI,RNN:()=>Hp,Range:()=>M1,Rank:()=>FM,Real:()=>F1,RealDiv:()=>Uh,Reciprocal:()=>ad,Reduction:()=>As,Relu:()=>ud,Relu6:()=>cd,Reshape:()=>Cm,ResizeBilinear:()=>_m,ResizeBilinearGrad:()=>$1,ResizeNearestNeighbor:()=>Im,ResizeNearestNeighborGrad:()=>P1,Reverse:()=>Tm,RotateWithOffset:()=>q1,Round:()=>ld,Rsqrt:()=>pd,SGDOptimizer:()=>xx,ScatterNd:()=>L1,Select:()=>Em,Selu:()=>hd,Sequential:()=>PI,Sigmoid:()=>gd,Sign:()=>md,Sin:()=>dd,Sinh:()=>fd,Slice:()=>Nm,Softmax:()=>Om,Softplus:()=>yd,SpaceToBatchND:()=>Dm,SparseToDense:()=>z1,SplitV:()=>Am,Sqrt:()=>xd,Square:()=>B1,SquaredDifference:()=>bd,Step:()=>Cd,StridedSlice:()=>V1,Sub:()=>vd,Sum:()=>km,SymbolicTensor:()=>Ta,Tan:()=>wd,Tanh:()=>Sd,Tensor:()=>Me,TensorBuffer:()=>no,Tile:()=>Ap,TopK:()=>j1,Transpose:()=>Rm,Unique:()=>U1,Unpack:()=>Mm,UnsortedSegmentSum:()=>Fm,Variable:()=>_d,ZerosLike:()=>Pm,_FusedMatMul:()=>f0,abs:()=>$o,acos:()=>Qv,acosh:()=>Zv,add:()=>Pt,addN:()=>gN,addStrict:()=>yP,all:()=>C0,any:()=>jm,argMax:()=>Um,argMin:()=>Jv,asin:()=>ew,asinh:()=>tw,atan:()=>nw,atan2:()=>rw,atanh:()=>ow,avgPool:()=>Dd,avgPool3d:()=>iw,backend:()=>yF,backend_util:()=>Re,basicLSTMCell:()=>Qq,batchNorm:()=>Qc,batchNorm2d:()=>bN,batchNorm3d:()=>vN,batchNorm4d:()=>wN,batchToSpaceND:()=>Ad,bincount:()=>SN,booleanMaskAsync:()=>UNe,broadcastTo:()=>qm,browser:()=>VC,buffer:()=>Rn,callbacks:()=>One,cast:()=>Wt,ceil:()=>uw,clipByValue:()=>li,clone:()=>hc,complex:()=>Bu,concat:()=>$r,concat1d:()=>IN,concat2d:()=>_N,concat3d:()=>TN,concat4d:()=>EN,constraints:()=>c5,conv1d:()=>I0,conv2d:()=>Wa,conv2dTranspose:()=>_0,conv3d:()=>lw,conv3dTranspose:()=>hG,copyRegisteredKernels:()=>aIe,cos:()=>Od,cosh:()=>T0,cosineWindow:()=>cI,cumsum:()=>E0,customGrad:()=>Ka,data:()=>d8,denseBincount:()=>ON,deprecationWarn:()=>Ns,depthToSpace:()=>pw,depthwiseConv2d:()=>fc,deregisterOp:()=>$ne,device_util:()=>b0,diag:()=>mG,dilation2d:()=>dw,disableDeprecationWarnings:()=>g_e,dispose:()=>Vn,disposeVariables:()=>y_e,div:()=>hn,divNoNan:()=>mw,divStrict:()=>xP,dot:()=>RN,dropout:()=>NP,elu:()=>Al,enableDebugMode:()=>m_e,enableProdMode:()=>f_e,enclosingPowerOfTwo:()=>kP,engine:()=>Vm,env:()=>mt,equal:()=>Ha,equalStrict:()=>pP,erf:()=>gw,exp:()=>Us,expandDims:()=>Pi,expm1:()=>yw,eye:()=>nx,fft:()=>Ud,fill:()=>Md,findBackend:()=>C_e,findBackendFactory:()=>I_e,floor:()=>Ol,floorDiv:()=>S0,fused:()=>Jc,gather:()=>Zc,gatherND:()=>EP,gather_util:()=>cF,getBackend:()=>w_e,getGradient:()=>GE,getKernel:()=>OC,getKernelsForBackend:()=>RC,grad:()=>CG,grads:()=>IG,greater:()=>ks,greaterEqual:()=>Sa,greaterEqualStrict:()=>hP,greaterStrict:()=>dP,ifft:()=>Pp,imag:()=>D0,image:()=>zp,inTopKAsync:()=>fke,initializers:()=>S5,input:()=>fD,io:()=>Zi,irfft:()=>U0,isFinite:()=>LN,isInf:()=>BN,isNaN:()=>zN,keep:()=>Ko,kernel_impls:()=>oa,layers:()=>q6,leakyRelu:()=>Pd,less:()=>$d,lessEqual:()=>yu,lessEqualStrict:()=>fP,lessStrict:()=>mP,linalg:()=>$P,linspace:()=>jN,loadGraphModel:()=>eoe,loadLayersModel:()=>one,localResponseNormalization:()=>xw,log:()=>pi,log1p:()=>O0,logSigmoid:()=>qN,logSoftmax:()=>R0,logSumExp:()=>ww,logicalAnd:()=>Ti,logicalNot:()=>Ld,logicalOr:()=>M0,logicalXor:()=>HN,losses:()=>rDe,matMul:()=>Ir,math:()=>aF,max:()=>hi,maxPool:()=>Bd,maxPool3d:()=>Sw,maxPoolWithArgmax:()=>XN,maximum:()=>ea,maximumStrict:()=>bP,mean:()=>vo,memory:()=>Yv,metrics:()=>G6,min:()=>Fp,minimum:()=>gc,minimumStrict:()=>vP,mirrorPad:()=>Iw,mod:()=>F0,modStrict:()=>wP,model:()=>nne,models:()=>W6,moments:()=>ox,movingAverage:()=>ake,mul:()=>Qe,mulStrict:()=>SP,multiRNNCell:()=>RG,multinomial:()=>ZN,neg:()=>Er,nextFrame:()=>qw,norm:()=>hx,notEqual:()=>ju,notEqualStrict:()=>gP,oneHot:()=>kl,ones:()=>ta,onesLike:()=>ei,op:()=>Se,outerProduct:()=>$G,pad:()=>Ia,pad1d:()=>BG,pad2d:()=>VG,pad3d:()=>UG,pad4d:()=>GG,pool:()=>JN,pow:()=>$i,powStrict:()=>CP,prelu:()=>Vd,print:()=>rN,prod:()=>$0,profile:()=>x_e,rand:()=>HG,randomGamma:()=>lW,randomNormal:()=>oI,randomUniform:()=>Fl,range:()=>ux,ready:()=>v_e,real:()=>Hm,reciprocal:()=>Tw,registerBackend:()=>UC,registerCallbackConstructor:()=>sne,registerGradient:()=>AM,registerKernel:()=>Bv,registerOp:()=>Pne,regularizers:()=>H6,relu:()=>na,relu6:()=>L0,removeBackend:()=>S_e,reshape:()=>nt,reverse:()=>Ds,reverse1d:()=>fW,reverse2d:()=>gW,reverse3d:()=>xW,reverse4d:()=>vW,rfft:()=>qd,round:()=>Nw,rsqrt:()=>B0,scalar:()=>sn,scatterND:()=>TP,scatter_util:()=>cN,selu:()=>z0,separableConv2d:()=>kw,sequential:()=>rne,serialization:()=>Lt,setBackend:()=>zq,setPlatform:()=>__e,setdiff1dAsync:()=>uk,sigmoid:()=>Ga,sign:()=>Dw,signal:()=>nDe,sin:()=>V0,sinh:()=>j0,slice:()=>Jn,slice1d:()=>Aw,slice2d:()=>sI,slice3d:()=>Ow,slice4d:()=>cx,slice_util:()=>Ji,softmax:()=>jd,softplus:()=>Rl,spaceToBatchND:()=>zd,sparseToDense:()=>uI,spectral:()=>tDe,split:()=>fi,sqrt:()=>wo,square:()=>sr,squaredDifference:()=>Gd,squaredDifferenceStrict:()=>IP,squeeze:()=>Uu,stack:()=>xs,step:()=>Pl,stridedSlice:()=>Fw,sub:()=>un,subStrict:()=>_P,sum:()=>vn,sumOutType:()=>x0,tan:()=>Pw,tanh:()=>Rp,tensor:()=>wa,tensor1d:()=>bs,tensor2d:()=>Lp,tensor3d:()=>aN,tensor4d:()=>OW,tensor5d:()=>MW,tensor6d:()=>PW,tensor_util:()=>Kc,test_util:()=>gF,tidy:()=>st,tile:()=>mc,time:()=>b_e,topk:()=>Lw,train:()=>W0,transpose:()=>Dr,truncatedNormal:()=>q0,unique:()=>px,unregisterGradient:()=>iIe,unregisterKernel:()=>sIe,unsortedSegmentSum:()=>Bw,unstack:()=>mi,upcastType:()=>ci,util:()=>Y,valueAndGrad:()=>_G,valueAndGrads:()=>TG,variable:()=>fk,variableGrads:()=>YC,version:()=>GLe,version_converter:()=>KD,version_core:()=>fN,version_layers:()=>Q0,where:()=>Yo,whereAsync:()=>Vw,zeros:()=>so,zerosLike:()=>Mn});var GLe,J7=D(()=>{"use strict";ve();K6();v$();f8();VL();Q7();ve();VL();Q7();f8();K6();v$();h1e();GLe={"tfjs-core":fN,"tfjs-backend-cpu":sL,"tfjs-backend-webgl":s7,"tfjs-data":hA,"tfjs-layers":Q0,"tfjs-converter":KD,tfjs:p1e}});var m1e={};var e9=D(()=>{"use strict";(function(n,t){typeof exports=="object"&&typeof module=="object"?module.exports=t():typeof define=="function"&&define.amd?define([],t):typeof exports=="object"?exports.Tone=t():n.Tone=t()})(typeof self<"u"?self:void 0,()=>(()=>{var n={382:function(o,s,i){(function(a,u,c,h){"use strict";var f=function(se,pe,ae){return{endTime:pe,insertTime:ae,type:"exponentialRampToValue",value:se}},g=function(se,pe,ae){return{endTime:pe,insertTime:ae,type:"linearRampToValue",value:se}},d=function(se,pe){return{startTime:pe,type:"setValue",value:se}},p=function(se,pe,ae){return{duration:ae,startTime:pe,type:"setValueCurve",values:se}},m=function(se,pe,ae){var fe=ae.startTime,he=ae.target,Ee=ae.timeConstant;return he+(pe-he)*Math.exp((fe-se)/Ee)},y=function(se){return se.type==="exponentialRampToValue"},v=function(se){return se.type==="linearRampToValue"},N=function(se){return y(se)||v(se)},T=function(se){return se.type==="setValue"},O=function(se){return se.type==="setValueCurve"},S=function se(pe,ae,fe,he){var Ee=pe[ae];return Ee===void 0?he:N(Ee)||T(Ee)?Ee.value:O(Ee)?Ee.values[Ee.values.length-1]:m(fe,se(pe,ae-1,Ee.startTime,he),Ee)},F=function(se,pe,ae,fe,he){return ae===void 0?[fe.insertTime,he]:N(ae)?[ae.endTime,ae.value]:T(ae)?[ae.startTime,ae.value]:O(ae)?[ae.startTime+ae.duration,ae.values[ae.values.length-1]]:[ae.startTime,S(se,pe-1,ae.startTime,he)]},R=function(se){return se.type==="cancelAndHold"},L=function(se){return se.type==="cancelScheduledValues"},q=function(se){return R(se)||L(se)?se.cancelTime:y(se)||v(se)?se.endTime:se.startTime},U=function(se,pe,ae,fe){var he=fe.endTime,Ee=fe.value;return ae===Ee?Ee:0<ae&&0<Ee||ae<0&&Ee<0?ae*Math.pow(Ee/ae,(se-pe)/(he-pe)):0},Z=function(se,pe,ae,fe){return ae+(se-pe)/(fe.endTime-pe)*(fe.value-ae)},ee=function(se,pe){var ae=pe.duration,fe=pe.startTime,he=pe.values;return function(Ee,Le){var Ve=Math.floor(Le),qe=Math.ceil(Le);return Ve===qe?Ee[Ve]:(1-(Le-Ve))*Ee[Ve]+(1-(qe-Le))*Ee[qe]}(he,(se-fe)/ae*(he.length-1))},Q=function(se){return se.type==="setTarget"},oe=function(){return h(function se(pe){c(this,se),this._automationEvents=[],this._currenTime=0,this._defaultValue=pe},[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(se){var pe=q(se);if(R(se)||L(se)){var ae=this._automationEvents.findIndex(function(Fe){return L(se)&&O(Fe)?Fe.startTime+Fe.duration>=pe:q(Fe)>=pe}),fe=this._automationEvents[ae];if(ae!==-1&&(this._automationEvents=this._automationEvents.slice(0,ae)),R(se)){var he=this._automationEvents[this._automationEvents.length-1];if(fe!==void 0&&N(fe)){if(he!==void 0&&Q(he))throw new Error("The internal list is malformed.");var Ee=he===void 0?fe.insertTime:O(he)?he.startTime+he.duration:q(he),Le=he===void 0?this._defaultValue:O(he)?he.values[he.values.length-1]:he.value,Ve=y(fe)?U(pe,Ee,Le,fe):Z(pe,Ee,Le,fe),qe=y(fe)?f(Ve,pe,this._currenTime):g(Ve,pe,this._currenTime);this._automationEvents.push(qe)}if(he!==void 0&&Q(he)&&this._automationEvents.push(d(this.getValue(pe),pe)),he!==void 0&&O(he)&&he.startTime+he.duration>pe){var je=pe-he.startTime,Ce=(he.values.length-1)/he.duration,tt=Math.max(2,1+Math.ceil(je*Ce)),ye=je/(tt-1)*Ce,z=he.values.slice(0,tt);if(ye<1)for(var M=1;M<tt;M+=1){var W=ye*M%1;z[M]=he.values[M-1]*(1-W)+he.values[M]*W}this._automationEvents[this._automationEvents.length-1]=p(z,he.startTime,je)}}}else{var ce=this._automationEvents.findIndex(function(Fe){return q(Fe)>pe}),J=ce===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[ce-1];if(J!==void 0&&O(J)&&q(J)+J.duration>pe)return!1;var Ie=y(se)?f(se.value,se.endTime,this._currenTime):v(se)?g(se.value,pe,this._currenTime):se;if(ce===-1)this._automationEvents.push(Ie);else{if(O(se)&&pe+se.duration>q(this._automationEvents[ce]))return!1;this._automationEvents.splice(ce,0,Ie)}}return!0}},{key:"flush",value:function(se){var pe=this._automationEvents.findIndex(function(he){return q(he)>se});if(pe>1){var ae=this._automationEvents.slice(pe-1),fe=ae[0];Q(fe)&&ae.unshift(d(S(this._automationEvents,pe-2,fe.startTime,this._defaultValue),fe.startTime)),this._automationEvents=ae}}},{key:"getValue",value:function(se){if(this._automationEvents.length===0)return this._defaultValue;var pe=this._automationEvents.findIndex(function(z){return q(z)>se}),ae=this._automationEvents[pe],fe=(pe===-1?this._automationEvents.length:pe)-1,he=this._automationEvents[fe];if(he!==void 0&&Q(he)&&(ae===void 0||!N(ae)||ae.insertTime>se))return m(se,S(this._automationEvents,fe-1,he.startTime,this._defaultValue),he);if(he!==void 0&&T(he)&&(ae===void 0||!N(ae)))return he.value;if(he!==void 0&&O(he)&&(ae===void 0||!N(ae)||he.startTime+he.duration>se))return se<he.startTime+he.duration?ee(se,he):he.values[he.values.length-1];if(he!==void 0&&N(he)&&(ae===void 0||!N(ae)))return he.value;if(ae!==void 0&&y(ae)){var Ee=F(this._automationEvents,fe,he,ae,this._defaultValue),Le=u(Ee,2),Ve=Le[0],qe=Le[1];return U(se,Ve,qe,ae)}if(ae!==void 0&&v(ae)){var je=F(this._automationEvents,fe,he,ae,this._defaultValue),Ce=u(je,2),tt=Ce[0],ye=Ce[1];return Z(se,tt,ye,ae)}return this._defaultValue}}])}();a.AutomationEventList=oe,a.createCancelAndHoldAutomationEvent=function(se){return{cancelTime:se,type:"cancelAndHold"}},a.createCancelScheduledValuesAutomationEvent=function(se){return{cancelTime:se,type:"cancelScheduledValues"}},a.createExponentialRampToValueAutomationEvent=function(se,pe){return{endTime:pe,type:"exponentialRampToValue",value:se}},a.createLinearRampToValueAutomationEvent=function(se,pe){return{endTime:pe,type:"linearRampToValue",value:se}},a.createSetTargetAutomationEvent=function(se,pe,ae){return{startTime:pe,target:se,timeConstant:ae,type:"setTarget"}},a.createSetValueAutomationEvent=d,a.createSetValueCurveAutomationEvent=p})(s,i(424),i(690),i(728))},897:o=>{o.exports=function(s,i){(i==null||i>s.length)&&(i=s.length);for(var a=0,u=new Array(i);a<i;a++)u[a]=s[a];return u},o.exports.__esModule=!0,o.exports.default=o.exports},372:o=>{o.exports=function(s){if(Array.isArray(s))return s},o.exports.__esModule=!0,o.exports.default=o.exports},690:o=>{o.exports=function(s,i){if(!(s instanceof i))throw new TypeError("Cannot call a class as a function")},o.exports.__esModule=!0,o.exports.default=o.exports},728:(o,s,i)=>{var a=i(62);function u(c,h){for(var f=0;f<h.length;f++){var g=h[f];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(c,a(g.key),g)}}o.exports=function(c,h,f){return h&&u(c.prototype,h),f&&u(c,f),Object.defineProperty(c,"prototype",{writable:!1}),c},o.exports.__esModule=!0,o.exports.default=o.exports},872:o=>{o.exports=function(s,i){var a=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(a!=null){var u,c,h,f,g=[],d=!0,p=!1;try{if(h=(a=a.call(s)).next,i===0){if(Object(a)!==a)return;d=!1}else for(;!(d=(u=h.call(a)).done)&&(g.push(u.value),g.length!==i);d=!0);}catch(m){p=!0,c=m}finally{try{if(!d&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(p)throw c}}return g}},o.exports.__esModule=!0,o.exports.default=o.exports},218:o=>{o.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},o.exports.__esModule=!0,o.exports.default=o.exports},424:(o,s,i)=>{var a=i(372),u=i(872),c=i(116),h=i(218);o.exports=function(f,g){return a(f)||u(f,g)||c(f,g)||h()},o.exports.__esModule=!0,o.exports.default=o.exports},36:(o,s,i)=>{var a=i(698).default;o.exports=function(u,c){if(a(u)!="object"||!u)return u;var h=u[Symbol.toPrimitive];if(h!==void 0){var f=h.call(u,c||"default");if(a(f)!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return(c==="string"?String:Number)(u)},o.exports.__esModule=!0,o.exports.default=o.exports},62:(o,s,i)=>{var a=i(698).default,u=i(36);o.exports=function(c){var h=u(c,"string");return a(h)=="symbol"?h:h+""},o.exports.__esModule=!0,o.exports.default=o.exports},698:o=>{function s(i){return o.exports=s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},o.exports.__esModule=!0,o.exports.default=o.exports,s(i)}o.exports=s,o.exports.__esModule=!0,o.exports.default=o.exports},116:(o,s,i)=>{var a=i(897);o.exports=function(u,c){if(u){if(typeof u=="string")return a(u,c);var h=Object.prototype.toString.call(u).slice(8,-1);return h==="Object"&&u.constructor&&(h=u.constructor.name),h==="Map"||h==="Set"?Array.from(u):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?a(u,c):void 0}},o.exports.__esModule=!0,o.exports.default=o.exports}},t={};function e(o){var s=t[o];if(s!==void 0)return s.exports;var i=t[o]={exports:{}};return n[o].call(i.exports,i,i.exports,e),i.exports}e.d=(o,s)=>{for(var i in s)e.o(s,i)&&!e.o(o,i)&&Object.defineProperty(o,i,{enumerable:!0,get:s[i]})},e.o=(o,s)=>Object.prototype.hasOwnProperty.call(o,s),e.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var r={};return(()=>{"use strict";e.r(r),e.d(r,{AMOscillator:()=>Og,AMSynth:()=>vS,Abs:()=>D_,Add:()=>gl,AmplitudeEnvelope:()=>Fg,Analyser:()=>ga,AudioToGain:()=>Ib,AutoFilter:()=>Bb,AutoPanner:()=>C,AutoWah:()=>E,BaseContext:()=>hh,BiquadFilter:()=>Pg,BitCrusher:()=>V,Buffer:()=>E1e,BufferSource:()=>k1e,Buffers:()=>N1e,Channel:()=>pu,Chebyshev:()=>ne,Chorus:()=>bt,Clock:()=>ii,Compressor:()=>$u,Context:()=>dp,Convolver:()=>Vb,CrossFade:()=>kf,DCMeter:()=>Pa,Delay:()=>fo,Destination:()=>x1e,Distortion:()=>St,Draw:()=>C1e,DuoSynth:()=>Db,EQ3:()=>zb,Emitter:()=>fl,Envelope:()=>Oi,FFT:()=>Xi,FMOscillator:()=>Sf,FMSynth:()=>Ab,FatOscillator:()=>Rg,FeedbackCombFilter:()=>Bg,FeedbackDelay:()=>Gt,Filter:()=>uu,Follower:()=>I,Freeverb:()=>Or,Frequency:()=>on,FrequencyClass:()=>Je,FrequencyEnvelope:()=>$g,FrequencyShifter:()=>Zn,Gain:()=>mn,GainToAudio:()=>A_,Gate:()=>xp,GrainPlayer:()=>Eb,GreaterThan:()=>Ay,GreaterThanZero:()=>Nb,IntervalTimeline:()=>N_,JCReverb:()=>Wr,LFO:()=>fa,Limiter:()=>Vc,Listener:()=>w1e,Loop:()=>jg,LowpassCombFilter:()=>Vg,Master:()=>b1e,MembraneSynth:()=>Lg,Merge:()=>Ae,MetalSynth:()=>Ob,Meter:()=>ya,MidSideCompressor:()=>gh,MidSideMerge:()=>nc,MidSideSplit:()=>Zs,Midi:()=>IO,MidiClass:()=>fh,Mono:()=>yp,MonoSynth:()=>mh,MultibandCompressor:()=>Df,MultibandSplit:()=>hu,Multiply:()=>is,Negate:()=>bS,Noise:()=>Mc,NoiseSynth:()=>Rb,Offline:()=>Oc,OfflineContext:()=>te,OmniOscillator:()=>Pc,OnePoleFilter:()=>zg,Oscillator:()=>da,PWMOscillator:()=>Mg,PanVol:()=>Bc,Panner:()=>w,Panner3D:()=>bl,Param:()=>Ut,Part:()=>Nf,Pattern:()=>Pb,Phaser:()=>lu,PingPongDelay:()=>Jo,PitchShift:()=>cu,Player:()=>If,Players:()=>Tb,PluckSynth:()=>Mb,PolySynth:()=>Fb,Pow:()=>bf,PulseOscillator:()=>Cf,Recorder:()=>zc,Reverb:()=>ys,Sampler:()=>Ef,Scale:()=>yl,ScaleExp:()=>Oy,Sequence:()=>$b,Signal:()=>Sn,Solo:()=>Eo,Split:()=>be,StateTimeline:()=>In,StereoWidener:()=>Lc,Subtract:()=>_f,SyncedSignal:()=>NO,Synth:()=>gp,Ticks:()=>_O,TicksClass:()=>gs,Time:()=>Ke,TimeClass:()=>He,Timeline:()=>pa,ToneAudioBuffer:()=>Hr,ToneAudioBuffers:()=>Rc,ToneAudioNode:()=>kt,ToneBufferSource:()=>fp,ToneEvent:()=>$c,ToneOscillatorNode:()=>Ag,Transport:()=>TS,TransportTime:()=>Bt,TransportTimeClass:()=>dt,Tremolo:()=>rc,Unit:()=>s,UserMedia:()=>vf,Vibrato:()=>Pu,Volume:()=>ml,WaveShaper:()=>au,Waveform:()=>$a,Zero:()=>_b,connect:()=>er,connectSeries:()=>cr,connectSignal:()=>Ls,context:()=>_1e,dbToGain:()=>H,debug:()=>o,defaultArg:()=>Fa,disconnect:()=>kr,fanIn:()=>Kr,ftom:()=>_e,gainToDb:()=>re,getContext:()=>A,getDestination:()=>v1e,getDraw:()=>I1e,getListener:()=>S1e,getTransport:()=>y1e,immediate:()=>_S,intervalToFrequencyRatio:()=>ie,isArray:()=>vi,isBoolean:()=>ll,isDefined:()=>mr,isFunction:()=>yb,isNote:()=>uh,isNumber:()=>Ra,isObject:()=>kc,isString:()=>Ma,isUndef:()=>la,loaded:()=>T1e,mtof:()=>Be,now:()=>IS,optionsFromArguments:()=>ot,setContext:()=>j,start:()=>G,supported:()=>lS,version:()=>i});var o={};e.r(o),e.d(o,{assert:()=>Pn,assertContextRunning:()=>gf,assertRange:()=>wi,assertUsedScheduleTime:()=>vb,enterScheduledCallback:()=>Ty,log:()=>wb,setLogger:()=>pS,warn:()=>ch});var s={};e.r(s);let i="14.9.17";var a=e(382);let u=new WeakSet,c=new WeakMap,h=new WeakMap,f=new WeakMap,g=new WeakMap,d=new WeakMap,p=new WeakMap,m=new WeakMap,y=new WeakMap,v=new WeakMap,N={construct:()=>N},T=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,O=($,l)=>{let x=[],_=$.replace(/^[\s]+/,""),P=_.match(T);for(;P!==null;){let X=P[1].slice(1,-1),ue=P[0].replace(/([\s]+)?;?$/,"").replace(X,new URL(X,l).toString());x.push(ue),_=_.slice(P[0].length).replace(/^[\s]+/,""),P=_.match(T)}return[x.join(";"),_]},S=$=>{if($!==void 0&&!Array.isArray($))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},F=$=>{if(!(l=>{try{new new Proxy(l,N)}catch{return!1}return!0})($))throw new TypeError("The given value for processorCtor should be a constructor.");if($.prototype===null||typeof $.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},R=($,l)=>{let x=$.get(l);if(x===void 0)throw new Error("A value with the given key could not be found.");return x},L=($,l)=>{let x=Array.from($).filter(l);if(x.length>1)throw Error("More than one element was found.");if(x.length===0)throw Error("No element was found.");let[_]=x;return $.delete(_),_},q=($,l,x,_)=>{let P=R($,l),X=L(P,ue=>ue[0]===x&&ue[1]===_);return P.size===0&&$.delete(l),X},U=$=>R(p,$),Z=$=>{if(u.has($))throw new Error("The AudioNode is already stored.");u.add($),U($).forEach(l=>l(!0))},ee=$=>"port"in $,Q=$=>{if(!u.has($))throw new Error("The AudioNode is not stored.");u.delete($),U($).forEach(l=>l(!1))},oe=($,l)=>{!ee($)&&l.every(x=>x.size===0)&&Q($)},se={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},pe=($,l)=>$.context===l,ae=$=>{try{$.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},fe=()=>new DOMException("","IndexSizeError"),he=$=>{var l;$.getChannelData=(l=$.getChannelData,x=>{try{return l.call($,x)}catch(_){throw _.code===12?fe():_}})},Ee={numberOfChannels:1},Le=-34028234663852886e22,Ve=-Le,qe=$=>u.has($),je={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Ce=$=>R(c,$),tt=$=>R(f,$),ye=($,l)=>{let{activeInputs:x}=Ce($);x.forEach(P=>P.forEach(([X])=>{l.includes($)||ye(X,[...l,$])}));let _=(P=>"playbackRate"in P)($)?[$.playbackRate]:ee($)?Array.from($.parameters.values()):(P=>"frequency"in P&&"gain"in P)($)?[$.Q,$.detune,$.frequency,$.gain]:(P=>"offset"in P)($)?[$.offset]:(P=>!("frequency"in P)&&"gain"in P)($)?[$.gain]:(P=>"detune"in P&&"frequency"in P)($)?[$.detune,$.frequency]:(P=>"pan"in P)($)?[$.pan]:[];for(let P of _){let X=tt(P);X!==void 0&&X.activeInputs.forEach(([ue])=>ye(ue,l))}qe($)&&Q($)},z=$=>{ye($.destination,[])},M=$=>"context"in $,W=$=>M($[0]),ce=($,l,x,_)=>{for(let P of $)if(x(P)){if(_)return!1;throw Error("The set contains at least one similar element.")}return $.add(l),!0},J=($,l,[x,_],P)=>{ce($,[l,x,_],X=>X[0]===l&&X[1]===x,P)},Ie=($,[l,x,_],P)=>{let X=$.get(l);X===void 0?$.set(l,new Set([[x,_]])):ce(X,[x,_],ue=>ue[0]===x,P)},Fe=$=>"inputs"in $,lt=($,l,x,_)=>{if(Fe(l)){let P=l.inputs[_];return $.connect(P,x,0),[P,x,0]}return $.connect(l,x,_),[l,x,_]},Dt=($,l,x)=>{for(let _ of $)if(_[0]===l&&_[1]===x)return $.delete(_),_;return null},Ht=($,l)=>{if(!U($).delete(l))throw new Error("Missing the expected event listener.")},an=($,l,x)=>{let _=R($,l),P=L(_,X=>X[0]===x);return _.size===0&&$.delete(l),P},cn=($,l,x,_)=>{Fe(l)?$.disconnect(l.inputs[_],x,0):$.disconnect(l,x,_)},nn=$=>R(h,$),Yn=$=>R(g,$),ln=$=>m.has($),Qn=$=>!u.has($),wn=($,l)=>new Promise(x=>{if(l!==null)x(!0);else{let _=$.createScriptProcessor(256,1,1),P=$.createGain(),X=$.createBuffer(1,2,44100),ue=X.getChannelData(0);ue[0]=1,ue[1]=1;let de=$.createBufferSource();de.buffer=X,de.loop=!0,de.connect(_).connect($.destination),de.connect(P),de.disconnect(P),_.onaudioprocess=we=>{let Ne=we.inputBuffer.getChannelData(0);Array.prototype.some.call(Ne,Oe=>Oe===1)?x(!0):x(!1),de.stop(),_.onaudioprocess=null,de.disconnect(_),_.disconnect($.destination)},de.start()}}),_r=($,l)=>{let x=new Map;for(let _ of $)for(let P of _){let X=x.get(P);x.set(P,X===void 0?1:X+1)}x.forEach((_,P)=>l(P,_))},Ar=$=>"context"in $,ss=$=>{let l=new Map;$.connect=(x=>(_,P=0,X=0)=>{let ue=Ar(_)?x(_,P,X):x(_,P),de=l.get(_);return de===void 0?l.set(_,[{input:X,output:P}]):de.every(we=>we.input!==X||we.output!==P)&&de.push({input:X,output:P}),ue})($.connect.bind($)),$.disconnect=(x=>(_,P,X)=>{if(x.apply($),_===void 0)l.clear();else if(typeof _=="number")for(let[ue,de]of l){let we=de.filter(Ne=>Ne.output!==_);we.length===0?l.delete(ue):l.set(ue,we)}else if(l.has(_))if(P===void 0)l.delete(_);else{let ue=l.get(_);if(ue!==void 0){let de=ue.filter(we=>we.output!==P&&(we.input!==X||X===void 0));de.length===0?l.delete(_):l.set(_,de)}}for(let[ue,de]of l)de.forEach(we=>{Ar(ue)?$.connect(ue,we.output,we.input):$.connect(ue,we.output)})})($.disconnect)},Qo=($,l,x,_,P)=>{let[X,ue]=((de,we,Ne,Oe)=>{let{activeInputs:$e,passiveInputs:et}=Ce(we),Xe=Dt($e[Oe],de,Ne);return Xe===null?[q(et,de,Ne,Oe)[2],!1]:[Xe[2],!0]})($,x,_,P);if(X!==null&&(Ht($,X),!ue||l||ln($)||cn(nn($),nn(x),_,P)),qe(x)){let{activeInputs:de}=Ce(x);oe(x,de)}},Ws=($,l,x,_)=>{let[P,X]=((ue,de,we)=>{let{activeInputs:Ne,passiveInputs:Oe}=tt(de),$e=Dt(Ne,ue,we);return $e===null?[an(Oe,ue,we)[1],!1]:[$e[2],!0]})($,x,_);P!==null&&(Ht($,P),!X||l||ln($)||nn($).disconnect(Yn(x),_))};class ki{constructor(l){this._map=new Map(l)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(l,x=null){return this._map.forEach((_,P)=>l.call(x,_,P,this))}get(l){return this._map.get(l)}has(l){return this._map.has(l)}keys(){return this._map.keys()}values(){return this._map.values()}}let Di={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function Ai($,l,x,_,P){if(typeof $.copyFromChannel=="function")l[x].byteLength===0&&(l[x]=new Float32Array(128)),$.copyFromChannel(l[x],_,P);else{let X=$.getChannelData(_);if(l[x].byteLength===0)l[x]=X.slice(P,P+128);else{let ue=new Float32Array(X.buffer,P*Float32Array.BYTES_PER_ELEMENT,128);l[x].set(ue)}}}let ia=($,l,x,_,P)=>{typeof $.copyToChannel=="function"?l[x].byteLength!==0&&$.copyToChannel(l[x],_,P):l[x].byteLength!==0&&$.getChannelData(_).set(l[x],P)},aa=($,l)=>{let x=[];for(let _=0;_<$;_+=1){let P=[],X=typeof l=="number"?l:l[_];for(let ue=0;ue<X;ue+=1)P.push(new Float32Array(128));x.push(P)}return x},Nu=($,l,x,_,P,X,ue)=>Te(void 0,null,function*(){let de=l===null?128*Math.ceil($.context.length/128):l.length,we=_.channelCount*_.numberOfInputs,Ne=P.reduce((it,vt)=>it+vt,0),Oe=Ne===0?null:x.createBuffer(Ne,de,x.sampleRate);if(X===void 0)throw new Error("Missing the processor constructor.");let $e=Ce($),et=yield((it,vt)=>{let It=R(v,it),Mt=nn(vt);return R(It,Mt)})(x,$),Xe=aa(_.numberOfInputs,_.channelCount),ct=aa(_.numberOfOutputs,P),ft=Array.from($.parameters.keys()).reduce((it,vt)=>Tn(Tt({},it),{[vt]:new Float32Array(128)}),{});for(let it=0;it<de;it+=128){if(_.numberOfInputs>0&&l!==null)for(let vt=0;vt<_.numberOfInputs;vt+=1)for(let It=0;It<_.channelCount;It+=1)Ai(l,Xe[vt],It,It,it);X.parameterDescriptors!==void 0&&l!==null&&X.parameterDescriptors.forEach(({name:vt},It)=>{Ai(l,ft,vt,we+It,it)});for(let vt=0;vt<_.numberOfInputs;vt+=1)for(let It=0;It<P[vt];It+=1)ct[vt][It].byteLength===0&&(ct[vt][It]=new Float32Array(128));try{let vt=Xe.map((Mt,$t)=>$e.activeInputs[$t].size===0?[]:Mt),It=ue(it/x.sampleRate,x.sampleRate,()=>et.process(vt,ct,ft));if(Oe!==null)for(let Mt=0,$t=0;Mt<_.numberOfOutputs;Mt+=1){for(let _t=0;_t<P[Mt];_t+=1)ia(Oe,ct[Mt],_t,$t+_t,it);$t+=P[Mt]}if(!It)break}catch(vt){$.dispatchEvent(new ErrorEvent("processorerror",{colno:vt.colno,filename:vt.filename,lineno:vt.lineno,message:vt.message}));break}}return Oe}),vc={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},eu={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},ds={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},wc={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},ku={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},fs=$=>{let{port1:l,port2:x}=new MessageChannel;return new Promise(_=>{let P=()=>{x.onmessage=null,l.close(),x.close(),_()};x.onmessage=()=>P();try{l.postMessage($,[$])}catch{}finally{P()}})},Ao={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Hs=($,l,x)=>{let _=l[x];if(_===void 0)throw $();return _},bi={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Sc={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},po=()=>new DOMException("","InvalidStateError"),Da=()=>new DOMException("","InvalidAccessError"),Oo={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},xt=($,l,x,_,P,X,ue,de,we,Ne,Oe)=>{let $e=Ne.length,et=de;for(let Xe=0;Xe<$e;Xe+=1){let ct=x[0]*Ne[Xe];for(let ft=1;ft<P;ft+=1){let it=et-ft&we-1;ct+=x[ft]*X[it],ct-=$[ft]*ue[it]}for(let ft=P;ft<_;ft+=1)ct+=x[ft]*X[et-ft&we-1];for(let ft=P;ft<l;ft+=1)ct-=$[ft]*ue[et-ft&we-1];X[et]=Ne[Xe],ue[et]=ct,et=et+1&we-1,Oe[Xe]=ct}return et},ze={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Xt=$=>{let l=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{let x=$.decodeAudioData(l.buffer,()=>{});return x!==void 0&&(x.catch(()=>{}),!0)}catch{}return!1},Yt=($,l,x)=>{let _=l[x];_!==void 0&&_!==$[x]&&($[x]=_)},Qt=($,l)=>{Yt($,l,"channelCount"),Yt($,l,"channelCountMode"),Yt($,l,"channelInterpretation")},Gn=$=>typeof $.getFloatTimeDomainData=="function",Un=($,l,x)=>{let _=l[x];_!==void 0&&_!==$[x].value&&($[x].value=_)},ar=$=>{$.start=(l=>(x=0,_=0,P)=>{if(typeof P=="number"&&P<0||_<0||x<0)throw new RangeError("The parameters can't be negative.");l.call($,x,_,P)})($.start)},xe=$=>{var l;$.stop=(l=$.stop,(x=0)=>{if(x<0)throw new RangeError("The parameter can't be negative.");l.call($,x)})},Pe=($,l)=>$===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2($*l))))),Ge=($,l)=>{let x=$.createBiquadFilter();return Qt(x,l),Un(x,l,"Q"),Un(x,l,"detune"),Un(x,l,"frequency"),Un(x,l,"gain"),Yt(x,l,"type"),x},pt=($,l)=>{let x=$.createChannelSplitter(l.numberOfOutputs);return Qt(x,l),(_=>{let P=_.numberOfOutputs;Object.defineProperty(_,"channelCount",{get:()=>P,set:X=>{if(X!==P)throw po()}}),Object.defineProperty(_,"channelCountMode",{get:()=>"explicit",set:X=>{if(X!=="explicit")throw po()}}),Object.defineProperty(_,"channelInterpretation",{get:()=>"discrete",set:X=>{if(X!=="discrete")throw po()}})})(x),x},At=($,l)=>($.connect=l.connect.bind(l),$.disconnect=l.disconnect.bind(l),$),qt=($,l)=>{let x=$.createDelay(l.maxDelayTime);return Qt(x,l),Un(x,l,"delayTime"),x},pn=($,l)=>{let x=$.createGain();return Qt(x,l),Un(x,l,"gain"),x};function Fn($,l){let x=l[0]*l[0]+l[1]*l[1];return[($[0]*l[0]+$[1]*l[1])/x,($[1]*l[0]-$[0]*l[1])/x]}function wr($,l){let x=[0,0];for(let X=$.length-1;X>=0;X-=1)P=l,x=[(_=x)[0]*P[0]-_[1]*P[1],_[0]*P[1]+_[1]*P[0]],x[0]+=$[X];var _,P;return x}let Kn=($,l,x,_)=>$.createScriptProcessor(l,x,_),yn=()=>new DOMException("","NotSupportedError"),Cn={numberOfChannels:1},Io={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Zo={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},ji={disableNormalization:!1},fg={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},mg=()=>new DOMException("","UnknownError"),Ui={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Ps=($,l,x)=>$.copyFromChannel===void 0?$.getChannelData(x)[0]:($.copyFromChannel(l,x),l[0]),qi=$=>{if($===null)return!1;let l=$.length;return l%2!=0?$[Math.floor(l/2)]!==0:$[l/2-1]+$[l/2]!==0},ni=($,l,x,_)=>{let P=$;for(;!P.hasOwnProperty(l);)P=Object.getPrototypeOf(P);let{get:X,set:ue}=Object.getOwnPropertyDescriptor(P,l);Object.defineProperty($,l,{get:x(X),set:_(ue)})},Aa=($,l,x)=>{try{$.setValueAtTime(l,x)}catch(_){if(_.code!==9)throw _;Aa($,l,x+1e-7)}},ms=$=>{let l=$.createOscillator();try{l.start(-1)}catch(x){return x instanceof RangeError}return!1},eh=$=>{let l=$.createBuffer(1,1,44100),x=$.createBufferSource();x.buffer=l,x.start(),x.stop();try{return x.stop(),!0}catch{return!1}},ul=$=>{let l=$.createOscillator();try{l.stop(-1)}catch(x){return x instanceof RangeError}return!1},gg=()=>{try{new DOMException}catch{return!1}return!0},qr=()=>new Promise($=>{let l=new ArrayBuffer(0),{port1:x,port2:_}=new MessageChannel;x.onmessage=({data:P})=>$(P!==null),_.postMessage(l,[l])}),jo=($,l)=>{let x=l.createGain();$.connect(x);let _=(P=>()=>{P.call($,x),$.removeEventListener("ended",_)})($.disconnect);$.addEventListener("ended",_),At($,x),$.stop=(P=>{let X=!1;return(ue=0)=>{if(X)try{P.call($,ue)}catch{x.gain.setValueAtTime(0,ue)}else P.call($,ue),X=!0}})($.stop)},ua=($,l)=>x=>{let _={value:$};return Object.defineProperties(x,{currentTarget:_,target:_}),typeof l=="function"?l.call($,x):l.handleEvent.call($,x)},lf=($=>(l,x,[_,P,X],ue)=>{$(l[P],[x,_,X],de=>de[0]===x&&de[1]===_,ue)})(ce),rn=($=>(l,x,[_,P,X],ue)=>{let de=l.get(_);de===void 0?l.set(_,new Set([[P,x,X]])):$(de,[P,x,X],we=>we[0]===P&&we[1]===x,ue)})(ce),yg=($=>(l,x,_,P)=>$(l[P],X=>X[0]===x&&X[1]===_))(L),Yu=new WeakMap,xg=($=>l=>{var x;return(x=$.get(l))!==null&&x!==void 0?x:0})(Yu),ca=(rp=new Map,Qu=new WeakMap,($,l)=>{let x=Qu.get($);if(x!==void 0)return x;let _=rp.get($);if(_!==void 0)return _;try{let P=l();return P instanceof Promise?(rp.set($,P),P.catch(()=>!1).then(X=>(rp.delete($),Qu.set($,X),X))):(Qu.set($,P),P)}catch{return Qu.set($,!1),!1}});var rp,Qu;let ri=typeof window>"u"?null:window,Cc=(($,l)=>(x,_)=>{let P=x.createAnalyser();if(Qt(P,_),!(_.maxDecibels>_.minDecibels))throw l();return Yt(P,_,"fftSize"),Yt(P,_,"maxDecibels"),Yt(P,_,"minDecibels"),Yt(P,_,"smoothingTimeConstant"),$(Gn,()=>Gn(P))||(X=>{X.getFloatTimeDomainData=ue=>{let de=new Uint8Array(ue.length);X.getByteTimeDomainData(de);let we=Math.max(de.length,X.fftSize);for(let Ne=0;Ne<we;Ne+=1)ue[Ne]=.0078125*(de[Ne]-128);return ue}})(P),P})(ca,fe),Oa=($=>l=>{let x=$(l);if(x.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return x.renderer})(Ce),Cs=(($,l,x)=>(_,P,X)=>Te(void 0,null,function*(){let ue=$(_);yield Promise.all(ue.activeInputs.map((de,we)=>Array.from(de).map($e=>Te(void 0,[$e],function*([Ne,Oe]){let et=l(Ne),Xe=yield et.render(Ne,P),ct=_.context.destination;x(Ne)||_===ct&&x(_)||Xe.connect(X,Oe,we)}))).reduce((de,we)=>[...de,...we],[]))}))(Ce,Oa,ln),yr=(($,l,x)=>()=>{let _=new WeakMap;return{render(P,X){let ue=_.get(X);return ue!==void 0?Promise.resolve(ue):((de,we)=>Te(null,null,function*(){let Ne=l(de);if(!pe(Ne,we)){let Oe={channelCount:Ne.channelCount,channelCountMode:Ne.channelCountMode,channelInterpretation:Ne.channelInterpretation,fftSize:Ne.fftSize,maxDecibels:Ne.maxDecibels,minDecibels:Ne.minDecibels,smoothingTimeConstant:Ne.smoothingTimeConstant};Ne=$(we,Oe)}return _.set(we,Ne),yield x(de,we,Ne),Ne}))(P,X)}}})(Cc,nn,Cs),ho=(pf=d,$=>{let l=pf.get($);if(l===void 0)throw po();return l});var pf;let Is=($=>$===null?null:$.hasOwnProperty("OfflineAudioContext")?$.OfflineAudioContext:$.hasOwnProperty("webkitOfflineAudioContext")?$.webkitOfflineAudioContext:null)(ri),Gr=($=>l=>$!==null&&l instanceof $)(Is),th=new WeakMap,xr=($=>class{constructor(l){this._nativeEventTarget=l,this._listeners=new WeakMap}addEventListener(l,x,_){if(x!==null){let P=this._listeners.get(x);P===void 0&&(P=$(this,x),typeof x=="function"&&this._listeners.set(x,P)),this._nativeEventTarget.addEventListener(l,P,_)}}dispatchEvent(l){return this._nativeEventTarget.dispatchEvent(l)}removeEventListener(l,x,_){let P=x===null?void 0:this._listeners.get(x);this._nativeEventTarget.removeEventListener(l,P===void 0?null:P,_)}})(ua),Gi=($=>$===null?null:$.hasOwnProperty("AudioContext")?$.AudioContext:$.hasOwnProperty("webkitAudioContext")?$.webkitAudioContext:null)(ri),op=($=>l=>$!==null&&l instanceof $)(Gi),hf=($=>l=>$!==null&&typeof $.AudioNode=="function"&&l instanceof $.AudioNode)(ri),_s=($=>l=>$!==null&&typeof $.AudioParam=="function"&&l instanceof $.AudioParam)(ri),oo=($=>$===null?null:$.hasOwnProperty("AudioWorkletNode")?$.AudioWorkletNode:null)(ri),Jr=(($,l,x,_,P,X,ue,de,we,Ne,Oe,$e,et,Xe,ct,ft)=>class extends Ne{constructor(it,vt,It,Mt){super(It),this._context=it,this._nativeAudioNode=It;let $t=Oe(it);$e($t)&&x(wn,()=>wn($t,ft))!==!0&&ss(It),h.set(this,It),p.set(this,new Set),it.state!=="closed"&&vt&&Z(this),$(this,Mt,It)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(it){this._nativeAudioNode.channelCount=it}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(it){this._nativeAudioNode.channelCountMode=it}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(it){this._nativeAudioNode.channelInterpretation=it}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(it,vt=0,It=0){if(vt<0||vt>=this._nativeAudioNode.numberOfOutputs)throw P();let Mt=Oe(this._context),$t=ct(Mt);if(et(it)||Xe(it))throw X();if(M(it)){let gt=nn(it);try{let Ft=lt(this._nativeAudioNode,gt,vt,It),Et=Qn(this);($t||Et)&&this._nativeAudioNode.disconnect(...Ft),this.context.state!=="closed"&&!Et&&Qn(it)&&Z(it)}catch(Ft){throw Ft.code===12?X():Ft}if(l(this,it,vt,It,$t)){let Ft=we([this],it);_r(Ft,_($t))}return it}let _t=Yn(it);if(_t.name==="playbackRate"&&_t.maxValue===1024)throw ue();try{this._nativeAudioNode.connect(_t,vt),($t||Qn(this))&&this._nativeAudioNode.disconnect(_t,vt)}catch(gt){throw gt.code===12?X():gt}if(((gt,Ft,Et,Zt)=>{let{activeInputs:Vt,passiveInputs:tn}=tt(Ft),{outputs:en}=Ce(gt),fn=U(gt),On=Nn=>{let $n=nn(gt),gr=Yn(Ft);if(Nn){let kn=an(tn,gt,Et);J(Vt,gt,kn,!1),Zt||ln(gt)||$n.connect(gr,Et)}else{let kn=((Tr,Qr,Vs)=>L(Tr,Js=>Js[0]===Qr&&Js[1]===Vs))(Vt,gt,Et);Ie(tn,kn,!1),Zt||ln(gt)||$n.disconnect(gr,Et)}};return!!ce(en,[Ft,Et],Nn=>Nn[0]===Ft&&Nn[1]===Et,!0)&&(fn.add(On),qe(gt)?J(Vt,gt,[Et,On],!0):Ie(tn,[gt,Et,On],!0),!0)})(this,it,vt,$t)){let gt=we([this],it);_r(gt,_($t))}}disconnect(it,vt,It){let Mt,$t=Oe(this._context),_t=ct($t);if(it===void 0)Mt=((gt,Ft)=>{let Et=Ce(gt),Zt=[];for(let Vt of Et.outputs)W(Vt)?Qo(gt,Ft,...Vt):Ws(gt,Ft,...Vt),Zt.push(Vt[0]);return Et.outputs.clear(),Zt})(this,_t);else if(typeof it=="number"){if(it<0||it>=this.numberOfOutputs)throw P();Mt=((gt,Ft,Et)=>{let Zt=Ce(gt),Vt=[];for(let tn of Zt.outputs)tn[1]===Et&&(W(tn)?Qo(gt,Ft,...tn):Ws(gt,Ft,...tn),Vt.push(tn[0]),Zt.outputs.delete(tn));return Vt})(this,_t,it)}else{if(vt!==void 0&&(vt<0||vt>=this.numberOfOutputs)||M(it)&&It!==void 0&&(It<0||It>=it.numberOfInputs))throw P();if(Mt=((gt,Ft,Et,Zt,Vt)=>{let tn=Ce(gt);return Array.from(tn.outputs).filter(en=>!(en[0]!==Et||Zt!==void 0&&en[1]!==Zt||Vt!==void 0&&en[2]!==Vt)).map(en=>(W(en)?Qo(gt,Ft,...en):Ws(gt,Ft,...en),tn.outputs.delete(en),en[0]))})(this,_t,it,vt,It),Mt.length===0)throw X()}for(let gt of Mt){let Ft=we([this],gt);_r(Ft,de)}}})((_o=c,($,l,x)=>{let _=[];for(let P=0;P<x.numberOfInputs;P+=1)_.push(new Set);_o.set($,{activeInputs:_,outputs:new Set,passiveInputs:new WeakMap,renderer:l})}),(($,l,x,_,P,X,ue,de,we,Ne,Oe,$e,et)=>{let Xe=new WeakMap;return(ct,ft,it,vt,It)=>{let{activeInputs:Mt,passiveInputs:$t}=X(ft),{outputs:_t}=X(ct),gt=de(ct),Ft=Et=>{let Zt=we(ft),Vt=we(ct);if(Et){let tn=q($t,ct,it,vt);$(Mt,ct,tn,!1),It||$e(ct)||x(Vt,Zt,it,vt),et(ft)&&Z(ft)}else{let tn=_(Mt,ct,it,vt);l($t,vt,tn,!1),It||$e(ct)||P(Vt,Zt,it,vt);let en=ue(ft);if(en===0)Oe(ft)&&oe(ft,Mt);else{let fn=Xe.get(ft);fn!==void 0&&clearTimeout(fn),Xe.set(ft,setTimeout(()=>{Oe(ft)&&oe(ft,Mt)},1e3*en))}}};return!!Ne(_t,[ft,it,vt],Et=>Et[0]===ft&&Et[1]===it&&Et[2]===vt,!0)&&(gt.add(Ft),Oe(ct)?$(Mt,ct,[it,vt,Ft],!0):l($t,vt,[ct,it,Ft],!0),!0)}})(lf,rn,lt,yg,cn,Ce,xg,U,nn,ce,qe,ln,Qn),ca,(($,l,x,_,P,X)=>ue=>(de,we)=>{let Ne=$.get(de);if(Ne===void 0){if(!ue&&X(de)){let Oe=_(de),{outputs:$e}=x(de);for(let et of $e)if(W(et)){let Xe=_(et[0]);l(Oe,Xe,et[1],et[2])}else{let Xe=P(et[0]);Oe.disconnect(Xe,et[1])}}$.set(de,we)}else $.set(de,Ne+we)})(m,cn,Ce,nn,Yn,qe),fe,Da,yn,(($,l,x,_,P,X,ue,de)=>(we,Ne)=>{let Oe=l.get(we);if(Oe===void 0)throw new Error("Missing the expected cycle count.");let $e=X(we.context),et=de($e);if(Oe===Ne){if(l.delete(we),!et&&ue(we)){let Xe=_(we),{outputs:ct}=x(we);for(let ft of ct)if(W(ft)){let it=_(ft[0]);$(Xe,it,ft[1],ft[2])}else{let it=P(ft[0]);Xe.connect(it,ft[1])}}}else l.set(we,Oe-Ne)})(lt,m,Ce,nn,Yn,ho,qe,Gr),(($,l,x)=>function _(P,X){let ue=M(X)?X:x($,X);if((we=>"delayTime"in we)(ue))return[];if(P[0]===ue)return[P];if(P.includes(ue))return[];let{outputs:de}=l(ue);return Array.from(de).map(we=>_([...P,ue],we[0])).reduce((we,Ne)=>we.concat(Ne),[])})(th,Ce,R),xr,ho,op,hf,_s,Gr,oo);var _o;let bg=(($,l,x,_,P,X)=>class extends ${constructor(ue,de){let we=P(ue),Ne=Tt(Tt({},se),de),Oe=_(we,Ne);super(ue,!1,Oe,X(we)?l():null),this._nativeAnalyserNode=Oe}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(ue){this._nativeAnalyserNode.fftSize=ue}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(ue){let de=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=ue,!(ue>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=de,x()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(ue){let de=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=ue,!(this._nativeAnalyserNode.maxDecibels>ue))throw this._nativeAnalyserNode.minDecibels=de,x()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(ue){this._nativeAnalyserNode.smoothingTimeConstant=ue}getByteFrequencyData(ue){this._nativeAnalyserNode.getByteFrequencyData(ue)}getByteTimeDomainData(ue){this._nativeAnalyserNode.getByteTimeDomainData(ue)}getFloatFrequencyData(ue){this._nativeAnalyserNode.getFloatFrequencyData(ue)}getFloatTimeDomainData(ue){this._nativeAnalyserNode.getFloatTimeDomainData(ue)}})(Jr,yr,fe,Cc,ho,Gr),sp=new WeakSet,Uo=($=>$===null?null:$.hasOwnProperty("AudioBuffer")?$.AudioBuffer:null)(ri),gy=(vg=new Uint32Array(1),$=>(vg[0]=$,vg[0]));var vg;let nh=(($,l)=>x=>{x.copyFromChannel=(_,P,X=0)=>{let ue=$(X),de=$(P);if(de>=x.numberOfChannels)throw l();let we=x.length,Ne=x.getChannelData(de),Oe=_.length;for(let $e=ue<0?-ue:0;$e+ue<we&&$e<Oe;$e+=1)_[$e]=Ne[$e+ue]},x.copyToChannel=(_,P,X=0)=>{let ue=$(X),de=$(P);if(de>=x.numberOfChannels)throw l();let we=x.length,Ne=x.getChannelData(de),Oe=_.length;for(let $e=ue<0?-ue:0;$e+ue<we&&$e<Oe;$e+=1)Ne[$e+ue]=_[$e]}})(gy,fe),rh=($=>l=>{l.copyFromChannel=(x=>(_,P,X=0)=>{let ue=$(X),de=$(P);if(ue<l.length)return x.call(l,_,de,ue)})(l.copyFromChannel),l.copyToChannel=(x=>(_,P,X=0)=>{let ue=$(X),de=$(P);if(ue<l.length)return x.call(l,_,de,ue)})(l.copyToChannel)})(gy),Wx=(($,l,x,_,P,X,ue,de)=>{let we=null;return class d1e{constructor(Oe){if(P===null)throw new Error("Missing the native OfflineAudioContext constructor.");let{length:$e,numberOfChannels:et,sampleRate:Xe}=Tt(Tt({},Ee),Oe);we===null&&(we=new P(1,1,44100));let ct=_!==null&&l(X,X)?new _({length:$e,numberOfChannels:et,sampleRate:Xe}):we.createBuffer(et,$e,Xe);if(ct.numberOfChannels===0)throw x();return typeof ct.copyFromChannel!="function"?(ue(ct),he(ct)):l(ae,()=>ae(ct))||de(ct),$.add(ct),ct}static[Symbol.hasInstance](Oe){return Oe!==null&&typeof Oe=="object"&&Object.getPrototypeOf(Oe)===d1e.prototype||$.has(Oe)}}})(sp,ca,yn,Uo,Is,($=>()=>{if($===null)return!1;try{new $({length:1,sampleRate:44100})}catch{return!1}return!0})(Uo),nh,rh),df=($=>(l,x)=>{let _=$(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});x.connect(_).connect(l.destination);let P=()=>{x.removeEventListener("ended",P),x.disconnect(_),_.disconnect()};x.addEventListener("ended",P)})(pn),Hx=(($,l,x)=>(_,P,X)=>Te(void 0,null,function*(){let ue=l(_);yield Promise.all(Array.from(ue.activeInputs).map(Ne=>Te(void 0,[Ne],function*([de,we]){let Oe=$(de),$e=yield Oe.render(de,P);x(de)||$e.connect(X,we)})))}))(Oa,tt,ln),Zu=($=>(l,x,_)=>$(x,l,_))(Hx),Ic=(($,l,x,_,P,X,ue,de,we,Ne,Oe)=>($e,et)=>{let Xe=$e.createBufferSource();return Qt(Xe,et),Un(Xe,et,"playbackRate"),Yt(Xe,et,"buffer"),Yt(Xe,et,"loop"),Yt(Xe,et,"loopEnd"),Yt(Xe,et,"loopStart"),l(x,()=>x($e))||(ct=>{ct.start=(ft=>{let it=!1;return(vt=0,It=0,Mt)=>{if(it)throw po();ft.call(ct,vt,It,Mt),it=!0}})(ct.start)})(Xe),l(_,()=>_($e))||(ct=>{ct.start=(ft=>(it=0,vt=0,It)=>{let Mt=ct.buffer,$t=Mt===null?vt:Math.min(Mt.duration,vt);Mt!==null&&$t>Mt.duration-.5/ct.context.sampleRate?ft.call(ct,it,0,0):ft.call(ct,it,$t,It)})(ct.start)})(Xe),l(P,()=>P($e))||Ne(Xe,$e),l(X,()=>X($e))||ar(Xe),l(ue,()=>ue($e))||Oe(Xe,$e),l(de,()=>de($e))||xe(Xe),$($e,Xe),Xe})(df,ca,$=>{let l=$.createBufferSource();l.start();try{l.start()}catch{return!0}return!1},$=>{let l=$.createBufferSource(),x=$.createBuffer(1,1,44100);l.buffer=x;try{l.start(0,1)}catch{return!1}return!0},$=>{let l=$.createBufferSource();l.start();try{l.stop()}catch{return!1}return!0},ms,eh,ul,0,($=>(l,x)=>{let _=x.createBuffer(1,1,44100);l.buffer===null&&(l.buffer=_),$(l,"buffer",P=>()=>{let X=P.call(l);return X===_?null:X},P=>X=>P.call(l,X===null?_:X))})(ni),jo),tu=(($,l)=>(x,_,P)=>($(_).replay(P),l(_,x,P)))(($=>l=>{let x=$(l);if(x.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return x.renderer})(tt),Hx),yy=(($,l,x,_,P)=>()=>{let X=new WeakMap,ue=null,de=null;return{set start(we){ue=we},set stop(we){de=we},render(we,Ne){let Oe=X.get(Ne);return Oe!==void 0?Promise.resolve(Oe):(($e,et)=>Te(null,null,function*(){let Xe=x($e),ct=pe(Xe,et);if(!ct){let ft={buffer:Xe.buffer,channelCount:Xe.channelCount,channelCountMode:Xe.channelCountMode,channelInterpretation:Xe.channelInterpretation,loop:Xe.loop,loopEnd:Xe.loopEnd,loopStart:Xe.loopStart,playbackRate:Xe.playbackRate.value};Xe=l(et,ft),ue!==null&&Xe.start(...ue),de!==null&&Xe.stop(de)}return X.set(et,Xe),ct?yield $(et,$e.playbackRate,Xe.playbackRate):yield _(et,$e.playbackRate,Xe.playbackRate),yield P($e,et,Xe),Xe}))(we,Ne)}}})(Zu,Ic,nn,tu,Cs),Du=(($,l,x,_,P,X,ue,de,we,Ne,Oe,$e,et)=>(Xe,ct,ft,it=null,vt=null)=>{let It=ft.value,Mt=new a.AutomationEventList(It),$t=ct?(gt=>({replay(Ft){for(let Et of gt)if(Et.type==="exponentialRampToValue"){let{endTime:Zt,value:Vt}=Et;Ft.exponentialRampToValueAtTime(Vt,Zt)}else if(Et.type==="linearRampToValue"){let{endTime:Zt,value:Vt}=Et;Ft.linearRampToValueAtTime(Vt,Zt)}else if(Et.type==="setTarget"){let{startTime:Zt,target:Vt,timeConstant:tn}=Et;Ft.setTargetAtTime(Vt,Zt,tn)}else if(Et.type==="setValue"){let{startTime:Zt,value:Vt}=Et;Ft.setValueAtTime(Vt,Zt)}else{if(Et.type!=="setValueCurve")throw new Error("Can't apply an unknown automation.");{let{duration:Zt,startTime:Vt,values:tn}=Et;Ft.setValueCurveAtTime(tn,Vt,Zt)}}}}))(Mt):null,_t={get defaultValue(){return It},get maxValue(){return it===null?ft.maxValue:it},get minValue(){return vt===null?ft.minValue:vt},get value(){return ft.value},set value(gt){ft.value=gt,_t.setValueAtTime(gt,Xe.context.currentTime)},cancelAndHoldAtTime(gt){if(typeof ft.cancelAndHoldAtTime=="function")$t===null&&Mt.flush(Xe.context.currentTime),Mt.add(P(gt)),ft.cancelAndHoldAtTime(gt);else{let Ft=Array.from(Mt).pop();$t===null&&Mt.flush(Xe.context.currentTime),Mt.add(P(gt));let Et=Array.from(Mt).pop();ft.cancelScheduledValues(gt),Ft!==Et&&Et!==void 0&&(Et.type==="exponentialRampToValue"?ft.exponentialRampToValueAtTime(Et.value,Et.endTime):Et.type==="linearRampToValue"?ft.linearRampToValueAtTime(Et.value,Et.endTime):Et.type==="setValue"?ft.setValueAtTime(Et.value,Et.startTime):Et.type==="setValueCurve"&&ft.setValueCurveAtTime(Et.values,Et.startTime,Et.duration))}return _t},cancelScheduledValues:gt=>($t===null&&Mt.flush(Xe.context.currentTime),Mt.add(X(gt)),ft.cancelScheduledValues(gt),_t),exponentialRampToValueAtTime(gt,Ft){if(gt===0)throw new RangeError;if(!Number.isFinite(Ft)||Ft<0)throw new RangeError;let Et=Xe.context.currentTime;return $t===null&&Mt.flush(Et),Array.from(Mt).length===0&&(Mt.add(Ne(It,Et)),ft.setValueAtTime(It,Et)),Mt.add(ue(gt,Ft)),ft.exponentialRampToValueAtTime(gt,Ft),_t},linearRampToValueAtTime(gt,Ft){let Et=Xe.context.currentTime;return $t===null&&Mt.flush(Et),Array.from(Mt).length===0&&(Mt.add(Ne(It,Et)),ft.setValueAtTime(It,Et)),Mt.add(de(gt,Ft)),ft.linearRampToValueAtTime(gt,Ft),_t},setTargetAtTime:(gt,Ft,Et)=>($t===null&&Mt.flush(Xe.context.currentTime),Mt.add(we(gt,Ft,Et)),ft.setTargetAtTime(gt,Ft,Et),_t),setValueAtTime:(gt,Ft)=>($t===null&&Mt.flush(Xe.context.currentTime),Mt.add(Ne(gt,Ft)),ft.setValueAtTime(gt,Ft),_t),setValueCurveAtTime(gt,Ft,Et){let Zt=gt instanceof Float32Array?gt:new Float32Array(gt);if($e!==null&&$e.name==="webkitAudioContext"){let Vt=Ft+Et,tn=Xe.context.sampleRate,en=Math.ceil(Ft*tn),fn=Math.floor(Vt*tn),On=fn-en,Nn=new Float32Array(On);for(let gr=0;gr<On;gr+=1){let kn=(Zt.length-1)/Et*((en+gr)/tn-Ft),Tr=Math.floor(kn),Qr=Math.ceil(kn);Nn[gr]=Tr===Qr?Zt[Tr]:(1-(kn-Tr))*Zt[Tr]+(1-(Qr-kn))*Zt[Qr]}$t===null&&Mt.flush(Xe.context.currentTime),Mt.add(Oe(Nn,Ft,Et)),ft.setValueCurveAtTime(Nn,Ft,Et);let $n=fn/tn;$n<Vt&&et(_t,Nn[Nn.length-1],$n),et(_t,Zt[Zt.length-1],Vt)}else $t===null&&Mt.flush(Xe.context.currentTime),Mt.add(Oe(Zt,Ft,Et)),ft.setValueCurveAtTime(Zt,Ft,Et);return _t}};return x.set(_t,ft),l.set(_t,Xe),$(_t,$t),_t})((Kx=f,($,l)=>{Kx.set($,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:l})}),th,g,0,a.createCancelAndHoldAutomationEvent,a.createCancelScheduledValuesAutomationEvent,a.createExponentialRampToValueAutomationEvent,a.createLinearRampToValueAutomationEvent,a.createSetTargetAutomationEvent,a.createSetValueAutomationEvent,a.createSetValueCurveAutomationEvent,Gi,Aa);var Kx;let W2=(($,l,x,_,P,X,ue,de)=>class extends ${constructor(we,Ne){let Oe=X(we),$e=Tt(Tt({},je),Ne),et=P(Oe,$e),Xe=ue(Oe),ct=Xe?l():null;super(we,!1,et,ct),this._audioBufferSourceNodeRenderer=ct,this._isBufferNullified=!1,this._isBufferSet=$e.buffer!==null,this._nativeAudioBufferSourceNode=et,this._onended=null,this._playbackRate=x(this,Xe,et.playbackRate,Ve,Le)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(we){if(this._nativeAudioBufferSourceNode.buffer=we,we!==null){if(this._isBufferSet)throw _();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(we){this._nativeAudioBufferSourceNode.loop=we}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(we){this._nativeAudioBufferSourceNode.loopEnd=we}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(we){this._nativeAudioBufferSourceNode.loopStart=we}get onended(){return this._onended}set onended(we){let Ne=typeof we=="function"?de(this,we):null;this._nativeAudioBufferSourceNode.onended=Ne;let Oe=this._nativeAudioBufferSourceNode.onended;this._onended=Oe!==null&&Oe===Ne?we:Oe}get playbackRate(){return this._playbackRate}start(we=0,Ne=0,Oe){if(this._nativeAudioBufferSourceNode.start(we,Ne,Oe),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=Oe===void 0?[we,Ne]:[we,Ne,Oe]),this.context.state!=="closed"){Z(this);let $e=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",$e),qe(this)&&Q(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",$e)}}stop(we=0){this._nativeAudioBufferSourceNode.stop(we),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=we)}})(Jr,yy,Du,po,Ic,ho,Gr,ua),H2=(($,l,x,_,P,X,ue,de)=>class extends ${constructor(we,Ne){let Oe=X(we),$e=ue(Oe),et=P(Oe,Ne,$e);super(we,!1,et,$e?(Xe=>{let ct=new WeakMap;return{render(ft,it){let vt=ct.get(it);return vt!==void 0?Promise.resolve(vt):((It,Mt)=>Te(null,null,function*(){let $t=Mt.destination;return ct.set(Mt,$t),yield Xe(It,Mt,$t),$t}))(ft,it)}}})(de):null),this._isNodeOfNativeOfflineAudioContext=$e,this._nativeAudioDestinationNode=et}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(we){if(this._isNodeOfNativeOfflineAudioContext)throw _();if(we>this._nativeAudioDestinationNode.maxChannelCount)throw x();this._nativeAudioDestinationNode.channelCount=we}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(we){if(this._isNodeOfNativeOfflineAudioContext)throw _();this._nativeAudioDestinationNode.channelCountMode=we}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Jr,0,fe,po,(($,l)=>(x,_,P)=>{let X=x.destination;if(X.channelCount!==_)try{X.channelCount=_}catch{}P&&X.channelCountMode!=="explicit"&&(X.channelCountMode="explicit"),X.maxChannelCount===0&&Object.defineProperty(X,"maxChannelCount",{value:_});let ue=$(x,{channelCount:_,channelCountMode:X.channelCountMode,channelInterpretation:X.channelInterpretation,gain:1});return l(ue,"channelCount",de=>()=>de.call(ue),de=>we=>{de.call(ue,we);try{X.channelCount=we}catch(Ne){if(we>X.maxChannelCount)throw Ne}}),l(ue,"channelCountMode",de=>()=>de.call(ue),de=>we=>{de.call(ue,we),X.channelCountMode=we}),l(ue,"channelInterpretation",de=>()=>de.call(ue),de=>we=>{de.call(ue,we),X.channelInterpretation=we}),Object.defineProperty(ue,"maxChannelCount",{get:()=>X.maxChannelCount}),ue.connect(X),ue})(pn,ni),ho,Gr,Cs),ff=(($,l,x,_,P)=>()=>{let X=new WeakMap;return{render(ue,de){let we=X.get(de);return we!==void 0?Promise.resolve(we):((Ne,Oe)=>Te(null,null,function*(){let $e=x(Ne),et=pe($e,Oe);if(!et){let Xe={Q:$e.Q.value,channelCount:$e.channelCount,channelCountMode:$e.channelCountMode,channelInterpretation:$e.channelInterpretation,detune:$e.detune.value,frequency:$e.frequency.value,gain:$e.gain.value,type:$e.type};$e=l(Oe,Xe)}return X.set(Oe,$e),et?(yield $(Oe,Ne.Q,$e.Q),yield $(Oe,Ne.detune,$e.detune),yield $(Oe,Ne.frequency,$e.frequency),yield $(Oe,Ne.gain,$e.gain)):(yield _(Oe,Ne.Q,$e.Q),yield _(Oe,Ne.detune,$e.detune),yield _(Oe,Ne.frequency,$e.frequency),yield _(Oe,Ne.gain,$e.gain)),yield P(Ne,Oe,$e),$e}))(ue,de)}}})(Zu,Ge,nn,tu,Cs),Au=($=>(l,x)=>$.set(l,x))(Yu),Xx=(($,l,x,_,P,X,ue,de)=>class extends ${constructor(we,Ne){let Oe=X(we),$e=Tt(Tt({},vc),Ne),et=P(Oe,$e),Xe=ue(Oe);super(we,!1,et,Xe?x():null),this._Q=l(this,Xe,et.Q,Ve,Le),this._detune=l(this,Xe,et.detune,1200*Math.log2(Ve),-1200*Math.log2(Ve)),this._frequency=l(this,Xe,et.frequency,we.sampleRate/2,0),this._gain=l(this,Xe,et.gain,40*Math.log10(Ve),Le),this._nativeBiquadFilterNode=et,de(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(we){this._nativeBiquadFilterNode.type=we}getFrequencyResponse(we,Ne,Oe){try{this._nativeBiquadFilterNode.getFrequencyResponse(we,Ne,Oe)}catch($e){throw $e.code===11?_():$e}if(we.length!==Ne.length||Ne.length!==Oe.length)throw _()}})(Jr,Du,ff,Da,Ge,ho,Gr,Au),_c=(($,l)=>(x,_,P)=>{let X=new Set;return x.connect=(ue=>(de,we=0,Ne=0)=>{let Oe=X.size===0;if(l(de))return ue.call(x,de,we,Ne),$(X,[de,we,Ne],$e=>$e[0]===de&&$e[1]===we&&$e[2]===Ne,!0),Oe&&_(),de;ue.call(x,de,we),$(X,[de,we],$e=>$e[0]===de&&$e[1]===we,!0),Oe&&_()})(x.connect),x.disconnect=(ue=>(de,we,Ne)=>{let Oe=X.size>0;if(de===void 0)ue.apply(x),X.clear();else if(typeof de=="number"){ue.call(x,de);for(let et of X)et[1]===de&&X.delete(et)}else{l(de)?ue.call(x,de,we,Ne):ue.call(x,de,we);for(let et of X)et[0]!==de||we!==void 0&&et[1]!==we||Ne!==void 0&&et[2]!==Ne||X.delete(et)}let $e=X.size===0;Oe&&$e&&P()})(x.disconnect),x})(ce,hf),Yx=(($,l)=>(x,_)=>{_.channelCount=1,_.channelCountMode="explicit",Object.defineProperty(_,"channelCount",{get:()=>1,set:()=>{throw $()}}),Object.defineProperty(_,"channelCountMode",{get:()=>"explicit",set:()=>{throw $()}});let P=x.createBufferSource();l(_,()=>{let X=_.numberOfInputs;for(let ue=0;ue<X;ue+=1)P.connect(_,0,ue)},()=>P.disconnect(_))})(po,_c),cl=(($,l)=>(x,_)=>{let P=x.createChannelMerger(_.numberOfInputs);return $!==null&&$.name==="webkitAudioContext"&&l(x,P),Qt(P,_),P})(Gi,Yx),K2=(($,l,x)=>()=>{let _=new WeakMap;return{render(P,X){let ue=_.get(X);return ue!==void 0?Promise.resolve(ue):((de,we)=>Te(null,null,function*(){let Ne=l(de);if(!pe(Ne,we)){let Oe={channelCount:Ne.channelCount,channelCountMode:Ne.channelCountMode,channelInterpretation:Ne.channelInterpretation,numberOfInputs:Ne.numberOfInputs};Ne=$(we,Oe)}return _.set(we,Ne),yield x(de,we,Ne),Ne}))(P,X)}}})(cl,nn,Cs),oh=(($,l,x,_,P)=>class extends ${constructor(X,ue){let de=_(X),we=Tt(Tt({},eu),ue);super(X,!1,x(de,we),P(de)?l():null)}})(Jr,K2,cl,ho,Gr),sh=(($,l,x)=>()=>{let _=new WeakMap;return{render(P,X){let ue=_.get(X);return ue!==void 0?Promise.resolve(ue):((de,we)=>Te(null,null,function*(){let Ne=l(de);if(!pe(Ne,we)){let Oe={channelCount:Ne.channelCount,channelCountMode:Ne.channelCountMode,channelInterpretation:Ne.channelInterpretation,numberOfOutputs:Ne.numberOfOutputs};Ne=$(we,Oe)}return _.set(we,Ne),yield x(de,we,Ne),Ne}))(P,X)}}})(pt,nn,Cs),ih=(($,l,x,_,P,X)=>class extends ${constructor(ue,de){let we=_(ue),Ne=(Oe=>Tn(Tt({},Oe),{channelCount:Oe.numberOfOutputs}))(Tt(Tt({},ds),de));super(ue,!1,x(we,Ne),P(we)?l():null)}})(Jr,sh,pt,ho,Gr),Ju=(($,l,x,_)=>(P,de)=>{var we=de,{offset:X}=we,ue=NS(we,["offset"]);let Ne=P.createBuffer(1,2,44100),Oe=l(P,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),$e=x(P,Tn(Tt({},ue),{gain:X})),et=Ne.getChannelData(0);et[0]=1,et[1]=1,Oe.buffer=Ne,Oe.loop=!0;let Xe={get bufferSize(){},get channelCount(){return $e.channelCount},set channelCount(ct){$e.channelCount=ct},get channelCountMode(){return $e.channelCountMode},set channelCountMode(ct){$e.channelCountMode=ct},get channelInterpretation(){return $e.channelInterpretation},set channelInterpretation(ct){$e.channelInterpretation=ct},get context(){return $e.context},get inputs(){return[]},get numberOfInputs(){return Oe.numberOfInputs},get numberOfOutputs(){return $e.numberOfOutputs},get offset(){return $e.gain},get onended(){return Oe.onended},set onended(ct){Oe.onended=ct},addEventListener:(...ct)=>Oe.addEventListener(ct[0],ct[1],ct[2]),dispatchEvent:(...ct)=>Oe.dispatchEvent(ct[0]),removeEventListener:(...ct)=>Oe.removeEventListener(ct[0],ct[1],ct[2]),start(ct=0){Oe.start.call(Oe,ct)},stop(ct=0){Oe.stop.call(Oe,ct)}};return $(P,Oe),_(At(Xe,$e),()=>Oe.connect($e),()=>Oe.disconnect($e))})(df,Ic,pn,_c),nu=(($,l,x,_,P)=>(X,ue)=>{if(X.createConstantSource===void 0)return x(X,ue);let de=X.createConstantSource();return Qt(de,ue),Un(de,ue,"offset"),l(_,()=>_(X))||ar(de),l(P,()=>P(X))||xe(de),$(X,de),de})(df,ca,Ju,ms,ul),xy=(($,l,x,_,P)=>()=>{let X=new WeakMap,ue=null,de=null;return{set start(we){ue=we},set stop(we){de=we},render(we,Ne){let Oe=X.get(Ne);return Oe!==void 0?Promise.resolve(Oe):(($e,et)=>Te(null,null,function*(){let Xe=x($e),ct=pe(Xe,et);if(!ct){let ft={channelCount:Xe.channelCount,channelCountMode:Xe.channelCountMode,channelInterpretation:Xe.channelInterpretation,offset:Xe.offset.value};Xe=l(et,ft),ue!==null&&Xe.start(ue),de!==null&&Xe.stop(de)}return X.set(et,Xe),ct?yield $(et,$e.offset,Xe.offset):yield _(et,$e.offset,Xe.offset),yield P($e,et,Xe),Xe}))(we,Ne)}}})(Zu,nu,nn,tu,Cs),ru=(($,l,x,_,P,X,ue)=>class extends ${constructor(de,we){let Ne=P(de),Oe=Tt(Tt({},wc),we),$e=_(Ne,Oe),et=X(Ne),Xe=et?x():null;super(de,!1,$e,Xe),this._constantSourceNodeRenderer=Xe,this._nativeConstantSourceNode=$e,this._offset=l(this,et,$e.offset,Ve,Le),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(de){let we=typeof de=="function"?ue(this,de):null;this._nativeConstantSourceNode.onended=we;let Ne=this._nativeConstantSourceNode.onended;this._onended=Ne!==null&&Ne===we?de:Ne}start(de=0){if(this._nativeConstantSourceNode.start(de),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=de),this.context.state!=="closed"){Z(this);let we=()=>{this._nativeConstantSourceNode.removeEventListener("ended",we),qe(this)&&Q(this)};this._nativeConstantSourceNode.addEventListener("ended",we)}}stop(de=0){this._nativeConstantSourceNode.stop(de),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=de)}})(Jr,Du,xy,nu,ho,Gr,ua),wg=(($,l)=>(x,_)=>{let P=x.createConvolver();if(Qt(P,_),_.disableNormalization===P.normalize&&(P.normalize=!_.disableNormalization),Yt(P,_,"buffer"),_.channelCount>2||(l(P,"channelCount",X=>()=>X.call(P),X=>ue=>{if(ue>2)throw $();return X.call(P,ue)}),_.channelCountMode==="max"))throw $();return l(P,"channelCountMode",X=>()=>X.call(P),X=>ue=>{if(ue==="max")throw $();return X.call(P,ue)}),P})(yn,ni),ec=(($,l,x)=>()=>{let _=new WeakMap;return{render(P,X){let ue=_.get(X);return ue!==void 0?Promise.resolve(ue):((de,we)=>Te(null,null,function*(){let Ne=l(de);if(!pe(Ne,we)){let Oe={buffer:Ne.buffer,channelCount:Ne.channelCount,channelCountMode:Ne.channelCountMode,channelInterpretation:Ne.channelInterpretation,disableNormalization:!Ne.normalize};Ne=$(we,Oe)}return _.set(we,Ne),Fe(Ne)?yield x(de,we,Ne.inputs[0]):yield x(de,we,Ne),Ne}))(P,X)}}})(wg,nn,Cs),Ks=(($,l,x,_,P,X)=>class extends ${constructor(ue,de){let we=_(ue),Ne=Tt(Tt({},ku),de),Oe=x(we,Ne);super(ue,!1,Oe,P(we)?l():null),this._isBufferNullified=!1,this._nativeConvolverNode=Oe,Ne.buffer!==null&&X(this,Ne.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(ue){if(this._nativeConvolverNode.buffer=ue,ue===null&&this._nativeConvolverNode.buffer!==null){let de=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=de.createBuffer(1,1,de.sampleRate),this._isBufferNullified=!0,X(this,0)}else this._isBufferNullified=!1,X(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(ue){this._nativeConvolverNode.normalize=ue}})(Jr,ec,wg,ho,Gr,Au),fr=(($,l,x,_,P)=>X=>{let ue=new WeakMap;return{render(de,we){let Ne=ue.get(we);return Ne!==void 0?Promise.resolve(Ne):((Oe,$e)=>Te(null,null,function*(){let et=x(Oe),Xe=pe(et,$e);if(!Xe){let ct={channelCount:et.channelCount,channelCountMode:et.channelCountMode,channelInterpretation:et.channelInterpretation,delayTime:et.delayTime.value,maxDelayTime:X};et=l($e,ct)}return ue.set($e,et),Xe?yield $($e,Oe.delayTime,et.delayTime):yield _($e,Oe.delayTime,et.delayTime),yield P(Oe,$e,et),et}))(de,we)}}})(Zu,qt,nn,tu,Cs),by=(($,l,x,_,P,X,ue)=>class extends ${constructor(de,we){let Ne=P(de),Oe=Tt(Tt({},Ao),we),$e=_(Ne,Oe),et=X(Ne);super(de,!1,$e,et?x(Oe.maxDelayTime):null),this._delayTime=l(this,et,$e.delayTime),ue(this,Oe.maxDelayTime)}get delayTime(){return this._delayTime}})(Jr,Du,fr,qt,ho,Gr,Au),Xs=($=>(l,x)=>{let _=l.createDynamicsCompressor();if(Qt(_,x),x.channelCount>2||x.channelCountMode==="max")throw $();return Un(_,x,"attack"),Un(_,x,"knee"),Un(_,x,"ratio"),Un(_,x,"release"),Un(_,x,"threshold"),_})(yn),Qx=(($,l,x,_,P)=>()=>{let X=new WeakMap;return{render(ue,de){let we=X.get(de);return we!==void 0?Promise.resolve(we):((Ne,Oe)=>Te(null,null,function*(){let $e=x(Ne),et=pe($e,Oe);if(!et){let Xe={attack:$e.attack.value,channelCount:$e.channelCount,channelCountMode:$e.channelCountMode,channelInterpretation:$e.channelInterpretation,knee:$e.knee.value,ratio:$e.ratio.value,release:$e.release.value,threshold:$e.threshold.value};$e=l(Oe,Xe)}return X.set(Oe,$e),et?(yield $(Oe,Ne.attack,$e.attack),yield $(Oe,Ne.knee,$e.knee),yield $(Oe,Ne.ratio,$e.ratio),yield $(Oe,Ne.release,$e.release),yield $(Oe,Ne.threshold,$e.threshold)):(yield _(Oe,Ne.attack,$e.attack),yield _(Oe,Ne.knee,$e.knee),yield _(Oe,Ne.ratio,$e.ratio),yield _(Oe,Ne.release,$e.release),yield _(Oe,Ne.threshold,$e.threshold)),yield P(Ne,Oe,$e),$e}))(ue,de)}}})(Zu,Xs,nn,tu,Cs),Zx=(($,l,x,_,P,X,ue,de)=>class extends ${constructor(we,Ne){let Oe=X(we),$e=Tt(Tt({},bi),Ne),et=_(Oe,$e),Xe=ue(Oe);super(we,!1,et,Xe?x():null),this._attack=l(this,Xe,et.attack),this._knee=l(this,Xe,et.knee),this._nativeDynamicsCompressorNode=et,this._ratio=l(this,Xe,et.ratio),this._release=l(this,Xe,et.release),this._threshold=l(this,Xe,et.threshold),de(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(we){let Ne=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=we,we>2)throw this._nativeDynamicsCompressorNode.channelCount=Ne,P()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(we){let Ne=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=we,we==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=Ne,P()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Jr,Du,Qx,Xs,yn,ho,Gr,Au),Jx=(($,l,x,_,P)=>()=>{let X=new WeakMap;return{render(ue,de){let we=X.get(de);return we!==void 0?Promise.resolve(we):((Ne,Oe)=>Te(null,null,function*(){let $e=x(Ne),et=pe($e,Oe);if(!et){let Xe={channelCount:$e.channelCount,channelCountMode:$e.channelCountMode,channelInterpretation:$e.channelInterpretation,gain:$e.gain.value};$e=l(Oe,Xe)}return X.set(Oe,$e),et?yield $(Oe,Ne.gain,$e.gain):yield _(Oe,Ne.gain,$e.gain),yield P(Ne,Oe,$e),$e}))(ue,de)}}})(Zu,pn,nn,tu,Cs),Fr=(($,l,x,_,P,X)=>class extends ${constructor(ue,de){let we=P(ue),Ne=Tt(Tt({},Sc),de),Oe=_(we,Ne),$e=X(we);super(ue,!1,Oe,$e?x():null),this._gain=l(this,$e,Oe.gain,Ve,Le)}get gain(){return this._gain}})(Jr,Du,Jx,pn,ho,Gr),eb=(($,l,x,_)=>(P,X,{channelCount:ue,channelCountMode:de,channelInterpretation:we,feedback:Ne,feedforward:Oe})=>{let $e=Pe(X,P.sampleRate),et=Ne instanceof Float64Array?Ne:new Float64Array(Ne),Xe=Oe instanceof Float64Array?Oe:new Float64Array(Oe),ct=et.length,ft=Xe.length,it=Math.min(ct,ft);if(ct===0||ct>20)throw _();if(et[0]===0)throw l();if(ft===0||ft>20)throw _();if(Xe[0]===0)throw l();if(et[0]!==1){for(let gt=0;gt<ft;gt+=1)Xe[gt]/=et[0];for(let gt=1;gt<ct;gt+=1)et[gt]/=et[0]}let vt=x(P,$e,ue,ue);vt.channelCount=ue,vt.channelCountMode=de,vt.channelInterpretation=we;let It=[],Mt=[],$t=[];for(let gt=0;gt<ue;gt+=1){It.push(0);let Ft=new Float32Array(32),Et=new Float32Array(32);Ft.fill(0),Et.fill(0),Mt.push(Ft),$t.push(Et)}vt.onaudioprocess=gt=>{let Ft=gt.inputBuffer,Et=gt.outputBuffer,Zt=Ft.numberOfChannels;for(let Vt=0;Vt<Zt;Vt+=1){let tn=Ft.getChannelData(Vt),en=Et.getChannelData(Vt);It[Vt]=xt(et,ct,Xe,ft,it,Mt[Vt],$t[Vt],It[Vt],32,tn,en)}};let _t=P.sampleRate/2;return At({get bufferSize(){return $e},get channelCount(){return vt.channelCount},set channelCount(gt){vt.channelCount=gt},get channelCountMode(){return vt.channelCountMode},set channelCountMode(gt){vt.channelCountMode=gt},get channelInterpretation(){return vt.channelInterpretation},set channelInterpretation(gt){vt.channelInterpretation=gt},get context(){return vt.context},get inputs(){return[vt]},get numberOfInputs(){return vt.numberOfInputs},get numberOfOutputs(){return vt.numberOfOutputs},addEventListener:(...gt)=>vt.addEventListener(gt[0],gt[1],gt[2]),dispatchEvent:(...gt)=>vt.dispatchEvent(gt[0]),getFrequencyResponse(gt,Ft,Et){if(gt.length!==Ft.length||Ft.length!==Et.length)throw $();let Zt=gt.length;for(let Vt=0;Vt<Zt;Vt+=1){let tn=-Math.PI*(gt[Vt]/_t),en=[Math.cos(tn),Math.sin(tn)],fn=Fn(wr(Xe,en),wr(et,en));Ft[Vt]=Math.sqrt(fn[0]*fn[0]+fn[1]*fn[1]),Et[Vt]=Math.atan2(fn[1],fn[0])}},removeEventListener:(...gt)=>vt.removeEventListener(gt[0],gt[1],gt[2])},vt)})(Da,po,Kn,yn),Ou=(($,l,x,_)=>P=>$(Xt,()=>Xt(P))?Promise.resolve($(_,_)).then(X=>{if(!X){let ue=x(P,512,0,1);P.oncomplete=()=>{ue.onaudioprocess=null,ue.disconnect()},ue.onaudioprocess=()=>P.currentTime,ue.connect(P.destination)}return P.startRendering()}):new Promise(X=>{let ue=l(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});P.oncomplete=de=>{ue.disconnect(),X(de.renderedBuffer)},ue.connect(P.destination),P.startRendering()}))(ca,pn,Kn,(($,l)=>()=>{if(l===null)return Promise.resolve(!1);let x=new l(1,1,44100),_=$(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(P=>{x.oncomplete=()=>{_.disconnect(),P(x.currentTime!==0)},x.startRendering()})})(pn,Is)),$s=(($,l,x,_,P)=>(X,ue)=>{let de=new WeakMap,we=null;return{render(Ne,Oe){let $e=de.get(Oe);return $e!==void 0?Promise.resolve($e):((et,Xe)=>Te(null,null,function*(){let ct=null,ft=l(et),it=pe(ft,Xe);if(Xe.createIIRFilter===void 0?ct=$(Xe,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):it||(ft=Xe.createIIRFilter(ue,X)),de.set(Xe,ct===null?ft:ct),ct!==null){if(we===null){if(x===null)throw new Error("Missing the native OfflineAudioContext constructor.");let It=new x(et.context.destination.channelCount,et.context.length,Xe.sampleRate);we=Te(null,null,function*(){return yield _(et,It,It.destination),((Mt,$t,_t,gt)=>{let Ft=_t instanceof Float64Array?_t:new Float64Array(_t),Et=gt instanceof Float64Array?gt:new Float64Array(gt),Zt=Ft.length,Vt=Et.length,tn=Math.min(Zt,Vt);if(Ft[0]!==1){for(let $n=0;$n<Zt;$n+=1)Et[$n]/=Ft[0];for(let $n=1;$n<Vt;$n+=1)Ft[$n]/=Ft[0]}let en=new Float32Array(32),fn=new Float32Array(32),On=$t.createBuffer(Mt.numberOfChannels,Mt.length,Mt.sampleRate),Nn=Mt.numberOfChannels;for(let $n=0;$n<Nn;$n+=1){let gr=Mt.getChannelData($n),kn=On.getChannelData($n);en.fill(0),fn.fill(0),xt(Ft,Zt,Et,Vt,tn,en,fn,0,32,gr,kn)}return On})(yield P(It),Xe,X,ue)})}let vt=yield we;return ct.buffer=vt,ct.start(0),ct}return yield _(et,Xe,ft),ft}))(Ne,Oe)}}})(Ic,nn,Is,Cs,Ou),vy=($=>(l,x,_)=>{if(l.createIIRFilter===void 0)return $(l,x,_);let P=l.createIIRFilter(_.feedforward,_.feedback);return Qt(P,_),P})(eb),Wi=(($,l,x,_,P,X)=>class extends ${constructor(ue,de){let we=_(ue),Ne=P(we),Oe=Tt(Tt({},Oo),de),$e=l(we,Ne?null:ue.baseLatency,Oe);super(ue,!1,$e,Ne?x(Oe.feedback,Oe.feedforward):null),(et=>{var Xe;et.getFrequencyResponse=(Xe=et.getFrequencyResponse,(ct,ft,it)=>{if(ct.length!==ft.length||ft.length!==it.length)throw Da();return Xe.call(et,ct,ft,it)})})($e),this._nativeIIRFilterNode=$e,X(this,1)}getFrequencyResponse(ue,de,we){return this._nativeIIRFilterNode.getFrequencyResponse(ue,de,we)}})(Jr,vy,$s,ho,Gr,Au),Sg=(($,l,x,_,P,X,ue,de)=>(we,Ne)=>{let Oe=Ne.listener,{forwardX:$e,forwardY:et,forwardZ:Xe,positionX:ct,positionY:ft,positionZ:it,upX:vt,upY:It,upZ:Mt}=Oe.forwardX===void 0?(()=>{let $t=new Float32Array(1),_t=l(Ne,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),gt=ue(Ne),Ft=!1,Et=[0,0,-1,0,1,0],Zt=[0,0,0],Vt=()=>{if(Ft)return;Ft=!0;let On=_(Ne,256,9,0);On.onaudioprocess=({inputBuffer:Nn})=>{let $n=[X(Nn,$t,0),X(Nn,$t,1),X(Nn,$t,2),X(Nn,$t,3),X(Nn,$t,4),X(Nn,$t,5)];$n.some((kn,Tr)=>kn!==Et[Tr])&&(Oe.setOrientation(...$n),Et=$n);let gr=[X(Nn,$t,6),X(Nn,$t,7),X(Nn,$t,8)];gr.some((kn,Tr)=>kn!==Zt[Tr])&&(Oe.setPosition(...gr),Zt=gr)},_t.connect(On)},tn=On=>Nn=>{Nn!==Et[On]&&(Et[On]=Nn,Oe.setOrientation(...Et))},en=On=>Nn=>{Nn!==Zt[On]&&(Zt[On]=Nn,Oe.setPosition(...Zt))},fn=(On,Nn,$n)=>{let gr=x(Ne,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Nn});gr.connect(_t,0,On),gr.start(),Object.defineProperty(gr.offset,"defaultValue",{get:()=>Nn});let kn=$({context:we},gt,gr.offset,Ve,Le);var Tr,Qr,Vs,Js,qo,oc,du;return de(kn,"value",Mo=>()=>Mo.call(kn),Mo=>nr=>{try{Mo.call(kn,nr)}catch(_n){if(_n.code!==9)throw _n}Vt(),gt&&$n(nr)}),kn.cancelAndHoldAtTime=(Tr=kn.cancelAndHoldAtTime,gt?()=>{throw P()}:(...Mo)=>{let nr=Tr.apply(kn,Mo);return Vt(),nr}),kn.cancelScheduledValues=(Qr=kn.cancelScheduledValues,gt?()=>{throw P()}:(...Mo)=>{let nr=Qr.apply(kn,Mo);return Vt(),nr}),kn.exponentialRampToValueAtTime=(Vs=kn.exponentialRampToValueAtTime,gt?()=>{throw P()}:(...Mo)=>{let nr=Vs.apply(kn,Mo);return Vt(),nr}),kn.linearRampToValueAtTime=(Js=kn.linearRampToValueAtTime,gt?()=>{throw P()}:(...Mo)=>{let nr=Js.apply(kn,Mo);return Vt(),nr}),kn.setTargetAtTime=(qo=kn.setTargetAtTime,gt?()=>{throw P()}:(...Mo)=>{let nr=qo.apply(kn,Mo);return Vt(),nr}),kn.setValueAtTime=(oc=kn.setValueAtTime,gt?()=>{throw P()}:(...Mo)=>{let nr=oc.apply(kn,Mo);return Vt(),nr}),kn.setValueCurveAtTime=(du=kn.setValueCurveAtTime,gt?()=>{throw P()}:(...Mo)=>{let nr=du.apply(kn,Mo);return Vt(),nr}),kn};return{forwardX:fn(0,0,tn(0)),forwardY:fn(1,0,tn(1)),forwardZ:fn(2,-1,tn(2)),positionX:fn(6,0,en(0)),positionY:fn(7,0,en(1)),positionZ:fn(8,0,en(2)),upX:fn(3,0,tn(3)),upY:fn(4,1,tn(4)),upZ:fn(5,0,tn(5))}})():Oe;return{get forwardX(){return $e},get forwardY(){return et},get forwardZ(){return Xe},get positionX(){return ct},get positionY(){return ft},get positionZ(){return it},get upX(){return vt},get upY(){return It},get upZ(){return Mt}}})(Du,cl,nu,Kn,yn,Ps,Gr,ni),ip=new WeakMap,wy=(($,l,x,_,P,X)=>class extends x{constructor(ue,de){super(ue),this._nativeContext=ue,d.set(this,ue),_(ue)&&P.set(ue,new Set),this._destination=new $(this,de),this._listener=l(this,ue),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(ue){let de=typeof ue=="function"?X(this,ue):null;this._nativeContext.onstatechange=de;let we=this._nativeContext.onstatechange;this._onstatechange=we!==null&&we===de?ue:we}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(H2,Sg,xr,Gr,ip,ua),mf=(($,l,x,_,P,X)=>(ue,de)=>{let we=ue.createOscillator();return Qt(we,de),Un(we,de,"detune"),Un(we,de,"frequency"),de.periodicWave!==void 0?we.setPeriodicWave(de.periodicWave):Yt(we,de,"type"),l(x,()=>x(ue))||ar(we),l(_,()=>_(ue))||X(we,ue),l(P,()=>P(ue))||xe(we),$(ue,we),we})(df,ca,ms,eh,ul,jo),Tc=(($,l,x,_,P)=>()=>{let X=new WeakMap,ue=null,de=null,we=null;return{set periodicWave(Ne){ue=Ne},set start(Ne){de=Ne},set stop(Ne){we=Ne},render(Ne,Oe){let $e=X.get(Oe);return $e!==void 0?Promise.resolve($e):((et,Xe)=>Te(null,null,function*(){let ct=x(et),ft=pe(ct,Xe);if(!ft){let it={channelCount:ct.channelCount,channelCountMode:ct.channelCountMode,channelInterpretation:ct.channelInterpretation,detune:ct.detune.value,frequency:ct.frequency.value,periodicWave:ue===null?void 0:ue,type:ct.type};ct=l(Xe,it),de!==null&&ct.start(de),we!==null&&ct.stop(we)}return X.set(Xe,ct),ft?(yield $(Xe,et.detune,ct.detune),yield $(Xe,et.frequency,ct.frequency)):(yield _(Xe,et.detune,ct.detune),yield _(Xe,et.frequency,ct.frequency)),yield P(et,Xe,ct),ct}))(Ne,Oe)}}})(Zu,mf,nn,tu,Cs),Cg=(($,l,x,_,P,X,ue)=>class extends ${constructor(de,we){let Ne=P(de),Oe=Tt(Tt({},Io),we),$e=x(Ne,Oe),et=X(Ne),Xe=et?_():null,ct=de.sampleRate/2;super(de,!1,$e,Xe),this._detune=l(this,et,$e.detune,153600,-153600),this._frequency=l(this,et,$e.frequency,ct,-ct),this._nativeOscillatorNode=$e,this._onended=null,this._oscillatorNodeRenderer=Xe,this._oscillatorNodeRenderer!==null&&Oe.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=Oe.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(de){let we=typeof de=="function"?ue(this,de):null;this._nativeOscillatorNode.onended=we;let Ne=this._nativeOscillatorNode.onended;this._onended=Ne!==null&&Ne===we?de:Ne}get type(){return this._nativeOscillatorNode.type}set type(de){this._nativeOscillatorNode.type=de,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(de){this._nativeOscillatorNode.setPeriodicWave(de),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=de)}start(de=0){if(this._nativeOscillatorNode.start(de),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=de),this.context.state!=="closed"){Z(this);let we=()=>{this._nativeOscillatorNode.removeEventListener("ended",we),qe(this)&&Q(this)};this._nativeOscillatorNode.addEventListener("ended",we)}}stop(de=0){this._nativeOscillatorNode.stop(de),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=de)}})(Jr,Du,mf,Tc,ho,Gr,ua),ap=($=>(l,x)=>{let _=$(l,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),P=l.createBuffer(1,2,44100);return _.buffer=P,_.loop=!0,_.connect(x),_.start(),()=>{_.stop(),_.disconnect(x)}})(Ic),up=(($,l,x,_,P)=>(X,Ne)=>{var Oe=Ne,{curve:ue,oversample:de}=Oe,we=NS(Oe,["curve","oversample"]);let $e=X.createWaveShaper(),et=X.createWaveShaper();Qt($e,we),Qt(et,we);let Xe=x(X,Tn(Tt({},we),{gain:1})),ct=x(X,Tn(Tt({},we),{gain:-1})),ft=x(X,Tn(Tt({},we),{gain:1})),it=x(X,Tn(Tt({},we),{gain:-1})),vt=null,It=!1,Mt=null,$t={get bufferSize(){},get channelCount(){return $e.channelCount},set channelCount(_t){Xe.channelCount=_t,ct.channelCount=_t,$e.channelCount=_t,ft.channelCount=_t,et.channelCount=_t,it.channelCount=_t},get channelCountMode(){return $e.channelCountMode},set channelCountMode(_t){Xe.channelCountMode=_t,ct.channelCountMode=_t,$e.channelCountMode=_t,ft.channelCountMode=_t,et.channelCountMode=_t,it.channelCountMode=_t},get channelInterpretation(){return $e.channelInterpretation},set channelInterpretation(_t){Xe.channelInterpretation=_t,ct.channelInterpretation=_t,$e.channelInterpretation=_t,ft.channelInterpretation=_t,et.channelInterpretation=_t,it.channelInterpretation=_t},get context(){return $e.context},get curve(){return Mt},set curve(_t){if(_t!==null&&_t.length<2)throw l();if(_t===null)$e.curve=_t,et.curve=_t;else{let gt=_t.length,Ft=new Float32Array(gt+2-gt%2),Et=new Float32Array(gt+2-gt%2);Ft[0]=_t[0],Et[0]=-_t[gt-1];let Zt=Math.ceil((gt+1)/2),Vt=(gt+1)/2-1;for(let tn=1;tn<Zt;tn+=1){let en=tn/Zt*Vt,fn=Math.floor(en),On=Math.ceil(en);Ft[tn]=fn===On?_t[fn]:(1-(en-fn))*_t[fn]+(1-(On-en))*_t[On],Et[tn]=fn===On?-_t[gt-1-fn]:-(1-(en-fn))*_t[gt-1-fn]-(1-(On-en))*_t[gt-1-On]}Ft[Zt]=gt%2==1?_t[Zt-1]:(_t[Zt-2]+_t[Zt-1])/2,$e.curve=Ft,et.curve=Et}Mt=_t,It&&(_(Mt)&&vt===null?vt=$(X,Xe):vt!==null&&(vt(),vt=null))},get inputs(){return[Xe]},get numberOfInputs(){return $e.numberOfInputs},get numberOfOutputs(){return $e.numberOfOutputs},get oversample(){return $e.oversample},set oversample(_t){$e.oversample=_t,et.oversample=_t},addEventListener:(..._t)=>Xe.addEventListener(_t[0],_t[1],_t[2]),dispatchEvent:(..._t)=>Xe.dispatchEvent(_t[0]),removeEventListener:(..._t)=>Xe.removeEventListener(_t[0],_t[1],_t[2])};return ue!==null&&($t.curve=ue instanceof Float32Array?ue:new Float32Array(ue)),de!==$t.oversample&&($t.oversample=de),P(At($t,ft),()=>{Xe.connect($e).connect(ft),Xe.connect(ct).connect(et).connect(it).connect(ft),It=!0,_(Mt)&&(vt=$(X,Xe))},()=>{Xe.disconnect($e),$e.disconnect(ft),Xe.disconnect(ct),ct.disconnect(et),et.disconnect(it),it.disconnect(ft),It=!1,vt!==null&&(vt(),vt=null)})})(ap,po,pn,qi,_c),cp=(($,l,x,_,P,X,ue)=>(de,we)=>{let Ne=de.createWaveShaper();if(X!==null&&X.name==="webkitAudioContext"&&de.createGain().gain.automationRate===void 0)return x(de,we);Qt(Ne,we);let Oe=we.curve===null||we.curve instanceof Float32Array?we.curve:new Float32Array(we.curve);if(Oe!==null&&Oe.length<2)throw l();Yt(Ne,{curve:Oe},"curve"),Yt(Ne,we,"oversample");let $e=null,et=!1;return ue(Ne,"curve",Xe=>()=>Xe.call(Ne),Xe=>ct=>(Xe.call(Ne,ct),et&&(_(ct)&&$e===null?$e=$(de,Ne):_(ct)||$e===null||($e(),$e=null)),ct)),P(Ne,()=>{et=!0,_(Ne.curve)&&($e=$(de,Ne))},()=>{et=!1,$e!==null&&($e(),$e=null)})})(ap,po,up,qi,_c,Gi,ni),Ru=(($,l,x,_,P,X,ue,de,we,Ne)=>(Oe,Vt)=>{var tn=Vt,{coneInnerAngle:$e,coneOuterAngle:et,coneOuterGain:Xe,distanceModel:ct,maxDistance:ft,orientationX:it,orientationY:vt,orientationZ:It,panningModel:Mt,positionX:$t,positionY:_t,positionZ:gt,refDistance:Ft,rolloffFactor:Et}=tn,Zt=NS(tn,["coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","orientationX","orientationY","orientationZ","panningModel","positionX","positionY","positionZ","refDistance","rolloffFactor"]);let en=Oe.createPanner();if(Zt.channelCount>2||Zt.channelCountMode==="max")throw ue();Qt(en,Zt);let fn={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},On=x(Oe,Tn(Tt({},fn),{channelInterpretation:"speakers",numberOfInputs:6})),Nn=_(Oe,Tn(Tt({},Zt),{gain:1})),$n=_(Oe,Tn(Tt({},fn),{gain:1})),gr=_(Oe,Tn(Tt({},fn),{gain:0})),kn=_(Oe,Tn(Tt({},fn),{gain:0})),Tr=_(Oe,Tn(Tt({},fn),{gain:0})),Qr=_(Oe,Tn(Tt({},fn),{gain:0})),Vs=_(Oe,Tn(Tt({},fn),{gain:0})),Js=P(Oe,256,6,1),qo=X(Oe,Tn(Tt({},fn),{curve:new Float32Array([1,1]),oversample:"none"})),oc=[it,vt,It],du=[$t,_t,gt],Mo=new Float32Array(1);Js.onaudioprocess=({inputBuffer:_n})=>{let La=[we(_n,Mo,0),we(_n,Mo,1),we(_n,Mo,2)];La.some((Ry,My)=>Ry!==oc[My])&&(en.setOrientation(...La),oc=La);let qg=[we(_n,Mo,3),we(_n,Mo,4),we(_n,Mo,5)];qg.some((Ry,My)=>Ry!==du[My])&&(en.setPosition(...qg),du=qg)},Object.defineProperty(gr.gain,"defaultValue",{get:()=>0}),Object.defineProperty(kn.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Tr.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Qr.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Vs.gain,"defaultValue",{get:()=>0});let nr={get bufferSize(){},get channelCount(){return en.channelCount},set channelCount(_n){if(_n>2)throw ue();Nn.channelCount=_n,en.channelCount=_n},get channelCountMode(){return en.channelCountMode},set channelCountMode(_n){if(_n==="max")throw ue();Nn.channelCountMode=_n,en.channelCountMode=_n},get channelInterpretation(){return en.channelInterpretation},set channelInterpretation(_n){Nn.channelInterpretation=_n,en.channelInterpretation=_n},get coneInnerAngle(){return en.coneInnerAngle},set coneInnerAngle(_n){en.coneInnerAngle=_n},get coneOuterAngle(){return en.coneOuterAngle},set coneOuterAngle(_n){en.coneOuterAngle=_n},get coneOuterGain(){return en.coneOuterGain},set coneOuterGain(_n){if(_n<0||_n>1)throw l();en.coneOuterGain=_n},get context(){return en.context},get distanceModel(){return en.distanceModel},set distanceModel(_n){en.distanceModel=_n},get inputs(){return[Nn]},get maxDistance(){return en.maxDistance},set maxDistance(_n){if(_n<0)throw new RangeError;en.maxDistance=_n},get numberOfInputs(){return en.numberOfInputs},get numberOfOutputs(){return en.numberOfOutputs},get orientationX(){return $n.gain},get orientationY(){return gr.gain},get orientationZ(){return kn.gain},get panningModel(){return en.panningModel},set panningModel(_n){en.panningModel=_n},get positionX(){return Tr.gain},get positionY(){return Qr.gain},get positionZ(){return Vs.gain},get refDistance(){return en.refDistance},set refDistance(_n){if(_n<0)throw new RangeError;en.refDistance=_n},get rolloffFactor(){return en.rolloffFactor},set rolloffFactor(_n){if(_n<0)throw new RangeError;en.rolloffFactor=_n},addEventListener:(..._n)=>Nn.addEventListener(_n[0],_n[1],_n[2]),dispatchEvent:(..._n)=>Nn.dispatchEvent(_n[0]),removeEventListener:(..._n)=>Nn.removeEventListener(_n[0],_n[1],_n[2])};return $e!==nr.coneInnerAngle&&(nr.coneInnerAngle=$e),et!==nr.coneOuterAngle&&(nr.coneOuterAngle=et),Xe!==nr.coneOuterGain&&(nr.coneOuterGain=Xe),ct!==nr.distanceModel&&(nr.distanceModel=ct),ft!==nr.maxDistance&&(nr.maxDistance=ft),it!==nr.orientationX.value&&(nr.orientationX.value=it),vt!==nr.orientationY.value&&(nr.orientationY.value=vt),It!==nr.orientationZ.value&&(nr.orientationZ.value=It),Mt!==nr.panningModel&&(nr.panningModel=Mt),$t!==nr.positionX.value&&(nr.positionX.value=$t),_t!==nr.positionY.value&&(nr.positionY.value=_t),gt!==nr.positionZ.value&&(nr.positionZ.value=gt),Ft!==nr.refDistance&&(nr.refDistance=Ft),Et!==nr.rolloffFactor&&(nr.rolloffFactor=Et),oc[0]===1&&oc[1]===0&&oc[2]===0||en.setOrientation(...oc),du[0]===0&&du[1]===0&&du[2]===0||en.setPosition(...du),Ne(At(nr,en),()=>{Nn.connect(en),$(Nn,qo,0,0),qo.connect($n).connect(On,0,0),qo.connect(gr).connect(On,0,1),qo.connect(kn).connect(On,0,2),qo.connect(Tr).connect(On,0,3),qo.connect(Qr).connect(On,0,4),qo.connect(Vs).connect(On,0,5),On.connect(Js).connect(Oe.destination)},()=>{Nn.disconnect(en),de(Nn,qo,0,0),qo.disconnect($n),$n.disconnect(On),qo.disconnect(gr),gr.disconnect(On),qo.disconnect(kn),kn.disconnect(On),qo.disconnect(Tr),Tr.disconnect(On),qo.disconnect(Qr),Qr.disconnect(On),qo.disconnect(Vs),Vs.disconnect(On),On.disconnect(Js),Js.disconnect(Oe.destination)})})(lt,po,cl,pn,Kn,cp,yn,cn,Ps,_c),lp=($=>(l,x)=>{let _=l.createPanner();return _.orientationX===void 0?$(l,x):(Qt(_,x),Un(_,x,"orientationX"),Un(_,x,"orientationY"),Un(_,x,"orientationZ"),Un(_,x,"positionX"),Un(_,x,"positionY"),Un(_,x,"positionZ"),Yt(_,x,"coneInnerAngle"),Yt(_,x,"coneOuterAngle"),Yt(_,x,"coneOuterGain"),Yt(_,x,"distanceModel"),Yt(_,x,"maxDistance"),Yt(_,x,"panningModel"),Yt(_,x,"refDistance"),Yt(_,x,"rolloffFactor"),_)})(Ru),tb=(($,l,x,_,P,X,ue,de,we,Ne)=>()=>{let Oe=new WeakMap,$e=null;return{render(et,Xe){let ct=Oe.get(Xe);return ct!==void 0?Promise.resolve(ct):((ft,it)=>Te(null,null,function*(){let vt=null,It=X(ft),Mt={channelCount:It.channelCount,channelCountMode:It.channelCountMode,channelInterpretation:It.channelInterpretation},$t=Tn(Tt({},Mt),{coneInnerAngle:It.coneInnerAngle,coneOuterAngle:It.coneOuterAngle,coneOuterGain:It.coneOuterGain,distanceModel:It.distanceModel,maxDistance:It.maxDistance,panningModel:It.panningModel,refDistance:It.refDistance,rolloffFactor:It.rolloffFactor}),_t=pe(It,it);if("bufferSize"in It)vt=_(it,Tn(Tt({},Mt),{gain:1}));else if(!_t){let gt=Tn(Tt({},$t),{orientationX:It.orientationX.value,orientationY:It.orientationY.value,orientationZ:It.orientationZ.value,positionX:It.positionX.value,positionY:It.positionY.value,positionZ:It.positionZ.value});It=P(it,gt)}if(Oe.set(it,vt===null?It:vt),vt!==null){if($e===null){if(ue===null)throw new Error("Missing the native OfflineAudioContext constructor.");let fn=new ue(6,ft.context.length,it.sampleRate),On=l(fn,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});On.connect(fn.destination),$e=Te(null,null,function*(){let Nn=yield Promise.all([ft.orientationX,ft.orientationY,ft.orientationZ,ft.positionX,ft.positionY,ft.positionZ].map(($n,gr)=>Te(null,null,function*(){let kn=x(fn,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:gr===0?1:0});return yield de(fn,$n,kn.offset),kn})));for(let $n=0;$n<6;$n+=1)Nn[$n].connect(On,0,$n),Nn[$n].start(0);return Ne(fn)})}let gt=yield $e,Ft=_(it,Tn(Tt({},Mt),{gain:1}));yield we(ft,it,Ft);let Et=[];for(let fn=0;fn<gt.numberOfChannels;fn+=1)Et.push(gt.getChannelData(fn));let Zt=[Et[0][0],Et[1][0],Et[2][0]],Vt=[Et[3][0],Et[4][0],Et[5][0]],tn=_(it,Tn(Tt({},Mt),{gain:1})),en=P(it,Tn(Tt({},$t),{orientationX:Zt[0],orientationY:Zt[1],orientationZ:Zt[2],positionX:Vt[0],positionY:Vt[1],positionZ:Vt[2]}));Ft.connect(tn).connect(en.inputs[0]),en.connect(vt);for(let fn=128;fn<gt.length;fn+=128){let On=[Et[0][fn],Et[1][fn],Et[2][fn]],Nn=[Et[3][fn],Et[4][fn],Et[5][fn]];if(On.some(($n,gr)=>$n!==Zt[gr])||Nn.some(($n,gr)=>$n!==Vt[gr])){Zt=On,Vt=Nn;let $n=fn/it.sampleRate;tn.gain.setValueAtTime(0,$n),tn=_(it,Tn(Tt({},Mt),{gain:0})),en=P(it,Tn(Tt({},$t),{orientationX:Zt[0],orientationY:Zt[1],orientationZ:Zt[2],positionX:Vt[0],positionY:Vt[1],positionZ:Vt[2]})),tn.gain.setValueAtTime(1,$n),Ft.connect(tn).connect(en.inputs[0]),en.connect(vt)}}return vt}return _t?(yield $(it,ft.orientationX,It.orientationX),yield $(it,ft.orientationY,It.orientationY),yield $(it,ft.orientationZ,It.orientationZ),yield $(it,ft.positionX,It.positionX),yield $(it,ft.positionY,It.positionY),yield $(it,ft.positionZ,It.positionZ)):(yield de(it,ft.orientationX,It.orientationX),yield de(it,ft.orientationY,It.orientationY),yield de(it,ft.orientationZ,It.orientationZ),yield de(it,ft.positionX,It.positionX),yield de(it,ft.positionY,It.positionY),yield de(it,ft.positionZ,It.positionZ)),Fe(It)?yield we(ft,it,It.inputs[0]):yield we(ft,it,It),It}))(et,Xe)}}})(Zu,cl,nu,pn,lp,nn,Is,tu,Cs,Ou),Sy=(($,l,x,_,P,X,ue)=>class extends ${constructor(de,we){let Ne=P(de),Oe=Tt(Tt({},Zo),we),$e=x(Ne,Oe),et=X(Ne);super(de,!1,$e,et?_():null),this._nativePannerNode=$e,this._orientationX=l(this,et,$e.orientationX,Ve,Le),this._orientationY=l(this,et,$e.orientationY,Ve,Le),this._orientationZ=l(this,et,$e.orientationZ,Ve,Le),this._positionX=l(this,et,$e.positionX,Ve,Le),this._positionY=l(this,et,$e.positionY,Ve,Le),this._positionZ=l(this,et,$e.positionZ,Ve,Le),ue(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(de){this._nativePannerNode.coneInnerAngle=de}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(de){this._nativePannerNode.coneOuterAngle=de}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(de){this._nativePannerNode.coneOuterGain=de}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(de){this._nativePannerNode.distanceModel=de}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(de){this._nativePannerNode.maxDistance=de}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(de){this._nativePannerNode.panningModel=de}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(de){this._nativePannerNode.refDistance=de}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(de){this._nativePannerNode.rolloffFactor=de}})(Jr,Du,lp,tb,ho,Gr,Au),X2=($=>(l,{disableNormalization:x,imag:_,real:P})=>{let X=_ instanceof Float32Array?_:new Float32Array(_),ue=P instanceof Float32Array?P:new Float32Array(P),de=l.createPeriodicWave(ue,X,{disableNormalization:x});if(Array.from(_).length<2)throw $();return de})(fe),nb=(($,l,x,_)=>class f1e{constructor(X,ue){let de=l(X),we=(Oe=>{let{imag:$e,real:et}=Oe;return $e===void 0?et===void 0?Tn(Tt({},Oe),{imag:[0,0],real:[0,0]}):Tn(Tt({},Oe),{imag:Array.from(et,()=>0),real:et}):et===void 0?Tn(Tt({},Oe),{imag:$e,real:Array.from($e,()=>0)}):Tn(Tt({},Oe),{imag:$e,real:et})})(Tt(Tt({},ji),ue)),Ne=$(de,we);return x.add(Ne),Ne}static[Symbol.hasInstance](X){return X!==null&&typeof X=="object"&&Object.getPrototypeOf(X)===f1e.prototype||x.has(X)}})(X2,ho,new WeakSet),rb=(($,l,x,_,P,X)=>{let de=new Float32Array([1,1]),we=Math.PI/2,Ne={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},Oe=Tn(Tt({},Ne),{oversample:"none"}),$e=(et,Xe,ct,ft,it)=>{if(Xe===1)return((vt,It,Mt,$t)=>{let _t=new Float32Array(16385),gt=new Float32Array(16385);for(let en=0;en<16385;en+=1){let fn=en/16384*we;_t[en]=Math.cos(fn),gt[en]=Math.sin(fn)}let Ft=x(vt,Tn(Tt({},Ne),{gain:0})),Et=_(vt,Tn(Tt({},Oe),{curve:_t})),Zt=_(vt,Tn(Tt({},Oe),{curve:de})),Vt=x(vt,Tn(Tt({},Ne),{gain:0})),tn=_(vt,Tn(Tt({},Oe),{curve:gt}));return{connectGraph(){It.connect(Ft),It.connect(Zt.inputs===void 0?Zt:Zt.inputs[0]),It.connect(Vt),Zt.connect(Mt),Mt.connect(Et.inputs===void 0?Et:Et.inputs[0]),Mt.connect(tn.inputs===void 0?tn:tn.inputs[0]),Et.connect(Ft.gain),tn.connect(Vt.gain),Ft.connect($t,0,0),Vt.connect($t,0,1)},disconnectGraph(){It.disconnect(Ft),It.disconnect(Zt.inputs===void 0?Zt:Zt.inputs[0]),It.disconnect(Vt),Zt.disconnect(Mt),Mt.disconnect(Et.inputs===void 0?Et:Et.inputs[0]),Mt.disconnect(tn.inputs===void 0?tn:tn.inputs[0]),Et.disconnect(Ft.gain),tn.disconnect(Vt.gain),Ft.disconnect($t,0,0),Vt.disconnect($t,0,1)}}})(et,ct,ft,it);if(Xe===2)return((vt,It,Mt,$t)=>{let _t=new Float32Array(16385),gt=new Float32Array(16385),Ft=new Float32Array(16385),Et=new Float32Array(16385),Zt=Math.floor(8192.5);for(let Qr=0;Qr<16385;Qr+=1)if(Qr>Zt){let Vs=(Qr-Zt)/(16384-Zt)*we;_t[Qr]=Math.cos(Vs),gt[Qr]=Math.sin(Vs),Ft[Qr]=0,Et[Qr]=1}else{let Vs=Qr/(16384-Zt)*we;_t[Qr]=1,gt[Qr]=0,Ft[Qr]=Math.cos(Vs),Et[Qr]=Math.sin(Vs)}let Vt=l(vt,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),tn=x(vt,Tn(Tt({},Ne),{gain:0})),en=_(vt,Tn(Tt({},Oe),{curve:_t})),fn=x(vt,Tn(Tt({},Ne),{gain:0})),On=_(vt,Tn(Tt({},Oe),{curve:gt})),Nn=_(vt,Tn(Tt({},Oe),{curve:de})),$n=x(vt,Tn(Tt({},Ne),{gain:0})),gr=_(vt,Tn(Tt({},Oe),{curve:Ft})),kn=x(vt,Tn(Tt({},Ne),{gain:0})),Tr=_(vt,Tn(Tt({},Oe),{curve:Et}));return{connectGraph(){It.connect(Vt),It.connect(Nn.inputs===void 0?Nn:Nn.inputs[0]),Vt.connect(tn,0),Vt.connect(fn,0),Vt.connect($n,1),Vt.connect(kn,1),Nn.connect(Mt),Mt.connect(en.inputs===void 0?en:en.inputs[0]),Mt.connect(On.inputs===void 0?On:On.inputs[0]),Mt.connect(gr.inputs===void 0?gr:gr.inputs[0]),Mt.connect(Tr.inputs===void 0?Tr:Tr.inputs[0]),en.connect(tn.gain),On.connect(fn.gain),gr.connect($n.gain),Tr.connect(kn.gain),tn.connect($t,0,0),$n.connect($t,0,0),fn.connect($t,0,1),kn.connect($t,0,1)},disconnectGraph(){It.disconnect(Vt),It.disconnect(Nn.inputs===void 0?Nn:Nn.inputs[0]),Vt.disconnect(tn,0),Vt.disconnect(fn,0),Vt.disconnect($n,1),Vt.disconnect(kn,1),Nn.disconnect(Mt),Mt.disconnect(en.inputs===void 0?en:en.inputs[0]),Mt.disconnect(On.inputs===void 0?On:On.inputs[0]),Mt.disconnect(gr.inputs===void 0?gr:gr.inputs[0]),Mt.disconnect(Tr.inputs===void 0?Tr:Tr.inputs[0]),en.disconnect(tn.gain),On.disconnect(fn.gain),gr.disconnect($n.gain),Tr.disconnect(kn.gain),tn.disconnect($t,0,0),$n.disconnect($t,0,0),fn.disconnect($t,0,1),kn.disconnect($t,0,1)}}})(et,ct,ft,it);throw P()};return(et,vt)=>{var It=vt,{channelCount:Xe,channelCountMode:ct,pan:ft}=It,it=NS(It,["channelCount","channelCountMode","pan"]);if(ct==="max")throw P();let Mt=$(et,Tn(Tt({},it),{channelCount:1,channelCountMode:ct,numberOfInputs:2})),$t=x(et,Tn(Tt({},it),{channelCount:Xe,channelCountMode:ct,gain:1})),_t=x(et,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:ft}),{connectGraph:gt,disconnectGraph:Ft}=$e(et,Xe,$t,_t,Mt);Object.defineProperty(_t.gain,"defaultValue",{get:()=>0}),Object.defineProperty(_t.gain,"maxValue",{get:()=>1}),Object.defineProperty(_t.gain,"minValue",{get:()=>-1});let Et={get bufferSize(){},get channelCount(){return $t.channelCount},set channelCount(Vt){$t.channelCount!==Vt&&(Zt&&Ft(),{connectGraph:gt,disconnectGraph:Ft}=$e(et,Vt,$t,_t,Mt),Zt&&gt()),$t.channelCount=Vt},get channelCountMode(){return $t.channelCountMode},set channelCountMode(Vt){if(Vt==="clamped-max"||Vt==="max")throw P();$t.channelCountMode=Vt},get channelInterpretation(){return $t.channelInterpretation},set channelInterpretation(Vt){$t.channelInterpretation=Vt},get context(){return $t.context},get inputs(){return[$t]},get numberOfInputs(){return $t.numberOfInputs},get numberOfOutputs(){return $t.numberOfOutputs},get pan(){return _t.gain},addEventListener:(...Vt)=>$t.addEventListener(Vt[0],Vt[1],Vt[2]),dispatchEvent:(...Vt)=>$t.dispatchEvent(Vt[0]),removeEventListener:(...Vt)=>$t.removeEventListener(Vt[0],Vt[1],Vt[2])},Zt=!1;return X(At(Et,Mt),()=>{gt(),Zt=!0},()=>{Ft(),Zt=!1})}})(cl,pt,pn,cp,yn,_c),Cy=(($,l)=>(x,_)=>{let P=_.channelCountMode;if(P==="clamped-max")throw l();if(x.createStereoPanner===void 0)return $(x,_);let X=x.createStereoPanner();return Qt(X,_),Un(X,_,"pan"),Object.defineProperty(X,"channelCountMode",{get:()=>P,set:ue=>{if(ue!==P)throw l()}}),X})(rb,yn),pp=(($,l,x,_,P)=>()=>{let X=new WeakMap;return{render(ue,de){let we=X.get(de);return we!==void 0?Promise.resolve(we):((Ne,Oe)=>Te(null,null,function*(){let $e=x(Ne),et=pe($e,Oe);if(!et){let Xe={channelCount:$e.channelCount,channelCountMode:$e.channelCountMode,channelInterpretation:$e.channelInterpretation,pan:$e.pan.value};$e=l(Oe,Xe)}return X.set(Oe,$e),et?yield $(Oe,Ne.pan,$e.pan):yield _(Oe,Ne.pan,$e.pan),Fe($e)?yield P(Ne,Oe,$e.inputs[0]):yield P(Ne,Oe,$e),$e}))(ue,de)}}})(Zu,Cy,nn,tu,Cs),Ig=(($,l,x,_,P,X)=>class extends ${constructor(ue,de){let we=P(ue),Ne=Tt(Tt({},fg),de),Oe=x(we,Ne),$e=X(we);super(ue,!1,Oe,$e?_():null),this._pan=l(this,$e,Oe.pan)}get pan(){return this._pan}})(Jr,Du,Cy,pp,ho,Gr),Y2=(($,l,x)=>()=>{let _=new WeakMap;return{render(P,X){let ue=_.get(X);return ue!==void 0?Promise.resolve(ue):((de,we)=>Te(null,null,function*(){let Ne=l(de);if(!pe(Ne,we)){let Oe={channelCount:Ne.channelCount,channelCountMode:Ne.channelCountMode,channelInterpretation:Ne.channelInterpretation,curve:Ne.curve,oversample:Ne.oversample};Ne=$(we,Oe)}return _.set(we,Ne),Fe(Ne)?yield x(de,we,Ne.inputs[0]):yield x(de,we,Ne),Ne}))(P,X)}}})(cp,nn,Cs),Ec=(($,l,x,_,P,X,ue)=>class extends ${constructor(de,we){let Ne=P(de),Oe=Tt(Tt({},Ui),we),$e=x(Ne,Oe);super(de,!0,$e,X(Ne)?_():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=$e,ue(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(de){if(de===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(de.length<2)throw l();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=de}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(de){this._nativeWaveShaperNode.oversample=de}})(Jr,po,cp,Y2,ho,Gr,Au),ob=($=>$!==null&&$.isSecureContext)(ri),tc=($=>(l,x,_)=>{Object.defineProperties($,{currentFrame:{configurable:!0,get:()=>Math.round(l*x)},currentTime:{configurable:!0,get:()=>l}});try{return _()}finally{$!==null&&(delete $.currentFrame,delete $.currentTime)}})(ri),sb=new WeakMap,_g=(($,l)=>x=>{let _=$.get(x);if(_!==void 0)return _;if(l===null)throw new Error("Missing the native OfflineAudioContext constructor.");return _=new l(1,1,44100),$.set(x,_),_})(sb,Is),ah=ob?(($,l,x,_,P,X,ue,de,we,Ne,Oe,$e,et)=>{let Xe=0;return(ct,ft,it={credentials:"omit"})=>{let vt=Oe.get(ct);if(vt!==void 0&&vt.has(ft))return Promise.resolve();let It=Ne.get(ct);if(It!==void 0){let _t=It.get(ft);if(_t!==void 0)return _t}let Mt=X(ct),$t=Mt.audioWorklet===void 0?P(ft).then(([_t,gt])=>{let[Ft,Et]=O(_t,gt);return x(`${Ft};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${Et}
})})(window,'_AWGS')`)}).then(()=>{let _t=et._AWGS.pop();if(_t===void 0)throw new SyntaxError;_(Mt.currentTime,Mt.sampleRate,()=>_t(class{},void 0,(gt,Ft)=>{if(gt.trim()==="")throw l();let Et=y.get(Mt);if(Et!==void 0){if(Et.has(gt))throw l();F(Ft),S(Ft.parameterDescriptors),Et.set(gt,Ft)}else F(Ft),S(Ft.parameterDescriptors),y.set(Mt,new Map([[gt,Ft]]))},Mt.sampleRate,void 0,void 0))}):Promise.all([P(ft),Promise.resolve($($e,$e))]).then(([[_t,gt],Ft])=>{let Et=Xe+1;Xe=Et;let[Zt,Vt]=O(_t,gt),tn=new Blob([`${Zt};((AudioWorkletProcessor,registerProcessor)=>{${Vt}
})(${Ft?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${Ft?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${Ft?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${Et}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),en=URL.createObjectURL(tn);return Mt.audioWorklet.addModule(en,it).then(()=>{if(de(Mt))return Mt;let fn=ue(Mt);return fn.audioWorklet.addModule(en,it).then(()=>fn)}).then(fn=>{if(we===null)throw new SyntaxError;try{new we(fn,`__sac${Et}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(en))});return It===void 0?Ne.set(ct,new Map([[ft,$t]])):It.set(ft,$t),$t.then(()=>{let _t=Oe.get(ct);_t===void 0?Oe.set(ct,new Set([ft])):_t.add(ft)}).finally(()=>{let _t=Ne.get(ct);_t!==void 0&&_t.delete(ft)}),$t}})(ca,yn,($=>l=>new Promise((x,_)=>{if($===null)return void _(new SyntaxError);let P=$.document.head;if(P===null)_(new SyntaxError);else{let X=$.document.createElement("script"),ue=new Blob([l],{type:"application/javascript"}),de=URL.createObjectURL(ue),we=$.onerror,Ne=()=>{$.onerror=we,URL.revokeObjectURL(de)};$.onerror=(Oe,$e,et,Xe,ct)=>$e===de||$e===$.location.href&&et===1&&Xe===1?(Ne(),_(ct),!1):we!==null?we(Oe,$e,et,Xe,ct):void 0,X.onerror=()=>{Ne(),_(new SyntaxError)},X.onload=()=>{Ne(),x()},X.src=de,X.type="module",P.appendChild(X)}}))(ri),tc,$=>Te(void 0,null,function*(){try{let l=yield fetch($);if(l.ok)return[yield l.text(),l.url]}catch{}throw new DOMException("","AbortError")}),ho,_g,Gr,oo,new WeakMap,new WeakMap,(($,l)=>()=>Te(void 0,null,function*(){if($===null)return!0;if(l===null)return!1;let x=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),_=new l(1,128,44100),P=URL.createObjectURL(x),X=!1,ue=!1;try{yield _.audioWorklet.addModule(P);let de=new $(_,"a",{numberOfOutputs:0}),we=_.createOscillator();de.port.onmessage=()=>X=!0,de.onprocessorerror=()=>ue=!0,we.connect(de),we.start(0),yield _.startRendering(),yield new Promise(Ne=>setTimeout(Ne))}catch{}finally{URL.revokeObjectURL(P)}return X&&!ue}))(oo,Is),ri):void 0,ib=(($,l)=>x=>$(x)||l(x))(op,Gr),Q2=(($,l,x,_,P,X,ue,de,we,Ne,Oe)=>($e,et)=>{let Xe=ue($e)?$e:X($e);if(P.has(et)){let ct=new DOMException("","DataCloneError");return Promise.reject(ct)}try{P.add(et)}catch{}return l(we,()=>we(Xe))?Xe.decodeAudioData(et).then(ct=>(fs(et).catch(()=>{}),l(de,()=>de(ct))||Oe(ct),$.add(ct),ct)):new Promise((ct,ft)=>{let it=()=>Te(void 0,null,function*(){try{yield fs(et)}catch{}}),vt=It=>{ft(It),it()};try{Xe.decodeAudioData(et,It=>{typeof It.copyFromChannel!="function"&&(Ne(It),he(It)),$.add(It),it().then(()=>ct(It))},It=>{vt(It===null?new DOMException("","EncodingError"):It)})}catch(It){vt(It)}})})(sp,ca,0,0,new WeakSet,ho,ib,ae,Xt,nh,rh),ab=(($,l,x,_,P,X,ue,de,we,Ne,Oe,$e,et,Xe,ct,ft,it,vt,It,Mt)=>class extends ct{constructor($t,_t){super($t,_t),this._nativeContext=$t,this._audioWorklet=$===void 0?void 0:{addModule:(gt,Ft)=>$(this,gt,Ft)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new l(this)}createBiquadFilter(){return new P(this)}createBuffer($t,_t,gt){return new x({length:_t,numberOfChannels:$t,sampleRate:gt})}createBufferSource(){return new _(this)}createChannelMerger($t=6){return new X(this,{numberOfInputs:$t})}createChannelSplitter($t=6){return new ue(this,{numberOfOutputs:$t})}createConstantSource(){return new de(this)}createConvolver(){return new we(this)}createDelay($t=1){return new Oe(this,{maxDelayTime:$t})}createDynamicsCompressor(){return new $e(this)}createGain(){return new et(this)}createIIRFilter($t,_t){return new Xe(this,{feedback:_t,feedforward:$t})}createOscillator(){return new ft(this)}createPanner(){return new it(this)}createPeriodicWave($t,_t,gt={disableNormalization:!1}){return new vt(this,Tn(Tt({},gt),{imag:_t,real:$t}))}createStereoPanner(){return new It(this)}createWaveShaper(){return new Mt(this)}decodeAudioData($t,_t,gt){return Ne(this._nativeContext,$t).then(Ft=>(typeof _t=="function"&&_t(Ft),Ft),Ft=>{throw typeof gt=="function"&&gt(Ft),Ft})}})(ah,bg,Wx,W2,Xx,oh,ih,ru,Ks,Q2,by,Zx,Fr,Wi,wy,Cg,Sy,nb,Ig,Ec),Z2=(($,l,x,_)=>class extends ${constructor(P,X){let ue=x(P),de=((we,Ne)=>we.createMediaElementSource(Ne.mediaElement))(ue,X);if(_(ue))throw TypeError();super(P,!0,de,null),this._nativeMediaElementAudioSourceNode=de}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Jr,0,ho,Gr),J2=(($,l,x,_)=>class extends ${constructor(P,X){let ue=x(P);if(_(ue))throw new TypeError;let de=((we,Ne)=>{let Oe=we.createMediaStreamDestination();return Qt(Oe,Ne),Oe.numberOfOutputs===1&&Object.defineProperty(Oe,"numberOfOutputs",{get:()=>0}),Oe})(ue,Tt(Tt({},ze),X));super(P,!1,de,null),this._nativeMediaStreamAudioDestinationNode=de}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Jr,0,ho,Gr),ub=(($,l,x,_)=>class extends ${constructor(P,X){let ue=x(P),de=((we,{mediaStream:Ne})=>{let Oe=Ne.getAudioTracks();Oe.sort((Xe,ct)=>Xe.id<ct.id?-1:Xe.id>ct.id?1:0);let $e=Oe.slice(0,1),et=we.createMediaStreamSource(new MediaStream($e));return Object.defineProperty(et,"mediaStream",{value:Ne}),et})(ue,X);if(_(ue))throw new TypeError;super(P,!0,de,null),this._nativeMediaStreamAudioSourceNode=de}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Jr,0,ho,Gr),eS=(($,l)=>(x,{mediaStreamTrack:_})=>{if(typeof x.createMediaStreamTrackSource=="function")return x.createMediaStreamTrackSource(_);let P=new MediaStream([_]),X=x.createMediaStreamSource(P);if(_.kind!=="audio")throw $();if(l(x))throw new TypeError;return X})(po,Gr),tS=(($,l,x)=>class extends ${constructor(_,P){let X=x(_);super(_,!0,l(X,P),null)}})(Jr,eS,ho),cb=(($,l,x,_,P,X,ue,de,we)=>class extends ${constructor(Ne={}){if(we===null)throw new Error("Missing the native AudioContext constructor.");let Oe;try{Oe=new we(Ne)}catch(Xe){throw Xe.code===12&&Xe.message==="sampleRate is not in range"?x():Xe}if(Oe===null)throw _();if(!(Xe=>Xe===void 0||typeof Xe=="number"||typeof Xe=="string"&&(Xe==="balanced"||Xe==="interactive"||Xe==="playback"))(Ne.latencyHint))throw new TypeError(`The provided value '${Ne.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(Ne.sampleRate!==void 0&&Oe.sampleRate!==Ne.sampleRate)throw x();super(Oe,2);let{latencyHint:$e}=Ne,{sampleRate:et}=Oe;if(this._baseLatency=typeof Oe.baseLatency=="number"?Oe.baseLatency:$e==="balanced"?512/et:$e==="interactive"||$e===void 0?256/et:$e==="playback"?1024/et:128*Math.max(2,Math.min(128,Math.round($e*et/128)))/et,this._nativeAudioContext=Oe,we.name==="webkitAudioContext"?(this._nativeGainNode=Oe.createGain(),this._nativeOscillatorNode=Oe.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(Oe.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,Oe.state==="running"){this._state="suspended";let Xe=()=>{this._state==="suspended"&&(this._state=null),Oe.removeEventListener("statechange",Xe)};Oe.addEventListener("statechange",Xe)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw l()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),z(this)}))}createMediaElementSource(Ne){return new P(this,{mediaElement:Ne})}createMediaStreamDestination(){return new X(this)}createMediaStreamSource(Ne){return new ue(this,{mediaStream:Ne})}createMediaStreamTrackSource(Ne){return new de(this,{mediaStreamTrack:Ne})}resume(){return this._state==="suspended"?new Promise((Ne,Oe)=>{let $e=()=>{this._nativeAudioContext.removeEventListener("statechange",$e),this._nativeAudioContext.state==="running"?Ne():this.resume().then(Ne,Oe)};this._nativeAudioContext.addEventListener("statechange",$e)}):this._nativeAudioContext.resume().catch(Ne=>{throw Ne===void 0||Ne.code===15?l():Ne})}suspend(){return this._nativeAudioContext.suspend().catch(Ne=>{throw Ne===void 0?l():Ne})}})(ab,po,yn,mg,Z2,J2,ub,tS,Gi),Tg=($=>l=>{let x=$.get(l);if(x===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return x})(ip),lb=($=>(l,x)=>{$(l).add(x)})(Tg),pb=($=>(l,x,_=0,P=0)=>{let X=l[_];if(X===void 0)throw $();return Ar(x)?X.connect(x,0,P):X.connect(x,0)})(fe),Iy=($=>(l,x)=>{$(l).delete(x)})(Tg),hb=($=>(l,x,_,P=0)=>x===void 0?l.forEach(X=>X.disconnect()):typeof x=="number"?Hs($,l,x).disconnect():Ar(x)?_===void 0?l.forEach(X=>X.disconnect(x)):P===void 0?Hs($,l,_).disconnect(x,0):Hs($,l,_).disconnect(x,0,P):_===void 0?l.forEach(X=>X.disconnect(x)):Hs($,l,_).disconnect(x,0))(fe),db=new WeakMap,nS=(($,l)=>x=>l($,x))(db,R),rS=(($,l,x,_,P,X,ue,de,we,Ne,Oe,$e,et)=>(Xe,ct,ft,it)=>{if(it.numberOfInputs===0&&it.numberOfOutputs===0)throw we();let vt=Array.isArray(it.outputChannelCount)?it.outputChannelCount:Array.from(it.outputChannelCount);if(vt.some(gn=>gn<1))throw we();if(vt.length!==it.numberOfOutputs)throw l();if(it.channelCountMode!=="explicit")throw we();let It=it.channelCount*it.numberOfInputs,Mt=vt.reduce((gn,mo)=>gn+mo,0),$t=ft.parameterDescriptors===void 0?0:ft.parameterDescriptors.length;if(It+$t>6||Mt>6)throw we();let _t=new MessageChannel,gt=[],Ft=[];for(let gn=0;gn<it.numberOfInputs;gn+=1)gt.push(ue(Xe,{channelCount:it.channelCount,channelCountMode:it.channelCountMode,channelInterpretation:it.channelInterpretation,gain:1})),Ft.push(P(Xe,{channelCount:it.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:it.channelCount}));let Et=[];if(ft.parameterDescriptors!==void 0)for(let{defaultValue:gn,maxValue:mo,minValue:Ba,name:js}of ft.parameterDescriptors){let ao=X(Xe,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:it.parameterData[js]!==void 0?it.parameterData[js]:gn===void 0?0:gn});Object.defineProperties(ao.offset,{defaultValue:{get:()=>gn===void 0?0:gn},maxValue:{get:()=>mo===void 0?Ve:mo},minValue:{get:()=>Ba===void 0?Le:Ba}}),Et.push(ao)}let Zt=_(Xe,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,It+$t)}),Vt=Pe(ct,Xe.sampleRate),tn=de(Xe,Vt,It+$t,Math.max(1,Mt)),en=P(Xe,{channelCount:Math.max(1,Mt),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,Mt)}),fn=[];for(let gn=0;gn<it.numberOfOutputs;gn+=1)fn.push(_(Xe,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:vt[gn]}));for(let gn=0;gn<it.numberOfInputs;gn+=1){gt[gn].connect(Ft[gn]);for(let mo=0;mo<it.channelCount;mo+=1)Ft[gn].connect(Zt,mo,gn*it.channelCount+mo)}let On=new ki(ft.parameterDescriptors===void 0?[]:ft.parameterDescriptors.map(({name:gn},mo)=>{let Ba=Et[mo];return Ba.connect(Zt,0,It+mo),Ba.start(0),[gn,Ba.offset]}));Zt.connect(tn);let Nn=it.channelInterpretation,$n=null,gr=it.numberOfOutputs===0?[tn]:fn,kn={get bufferSize(){return Vt},get channelCount(){return it.channelCount},set channelCount(gn){throw x()},get channelCountMode(){return it.channelCountMode},set channelCountMode(gn){throw x()},get channelInterpretation(){return Nn},set channelInterpretation(gn){for(let mo of gt)mo.channelInterpretation=gn;Nn=gn},get context(){return tn.context},get inputs(){return gt},get numberOfInputs(){return it.numberOfInputs},get numberOfOutputs(){return it.numberOfOutputs},get onprocessorerror(){return $n},set onprocessorerror(gn){typeof $n=="function"&&kn.removeEventListener("processorerror",$n),$n=typeof gn=="function"?gn:null,typeof $n=="function"&&kn.addEventListener("processorerror",$n)},get parameters(){return On},get port(){return _t.port2},addEventListener:(...gn)=>tn.addEventListener(gn[0],gn[1],gn[2]),connect:$.bind(null,gr),disconnect:Ne.bind(null,gr),dispatchEvent:(...gn)=>tn.dispatchEvent(gn[0]),removeEventListener:(...gn)=>tn.removeEventListener(gn[0],gn[1],gn[2])},Tr=new Map;var Qr,Vs;_t.port1.addEventListener=(Qr=_t.port1.addEventListener,(...gn)=>{if(gn[0]==="message"){let mo=typeof gn[1]=="function"?gn[1]:typeof gn[1]=="object"&&gn[1]!==null&&typeof gn[1].handleEvent=="function"?gn[1].handleEvent:null;if(mo!==null){let Ba=Tr.get(gn[1]);Ba!==void 0?gn[1]=Ba:(gn[1]=js=>{Oe(Xe.currentTime,Xe.sampleRate,()=>mo(js))},Tr.set(mo,gn[1]))}}return Qr.call(_t.port1,gn[0],gn[1],gn[2])}),_t.port1.removeEventListener=(Vs=_t.port1.removeEventListener,(...gn)=>{if(gn[0]==="message"){let mo=Tr.get(gn[1]);mo!==void 0&&(Tr.delete(gn[1]),gn[1]=mo)}return Vs.call(_t.port1,gn[0],gn[1],gn[2])});let Js=null;Object.defineProperty(_t.port1,"onmessage",{get:()=>Js,set:gn=>{typeof Js=="function"&&_t.port1.removeEventListener("message",Js),Js=typeof gn=="function"?gn:null,typeof Js=="function"&&(_t.port1.addEventListener("message",Js),_t.port1.start())}}),ft.prototype.port=_t.port1;let qo=null;((gn,mo,Ba,js)=>{let ao=v.get(gn);ao===void 0&&(ao=new WeakMap,v.set(gn,ao));let Es=((sc,yh)=>Te(void 0,null,function*(){let xh=yield(MO=>new Promise((FO,D1e)=>{let{port1:$_,port2:PO}=new MessageChannel;$_.onmessage=({data:$O})=>{$_.close(),PO.close(),FO($O)},$_.onmessageerror=({data:$O})=>{$_.close(),PO.close(),D1e($O)},PO.postMessage(MO)}))(yh);return new sc(xh)}))(Ba,js);return ao.set(mo,Es),Es})(Xe,kn,ft,it).then(gn=>qo=gn);let du=aa(it.numberOfInputs,it.channelCount),Mo=aa(it.numberOfOutputs,vt),nr=ft.parameterDescriptors===void 0?[]:ft.parameterDescriptors.reduce((gn,{name:mo})=>Tn(Tt({},gn),{[mo]:new Float32Array(128)}),{}),_n=!0,La=()=>{it.numberOfOutputs>0&&tn.disconnect(en);for(let gn=0,mo=0;gn<it.numberOfOutputs;gn+=1){let Ba=fn[gn];for(let js=0;js<vt[gn];js+=1)en.disconnect(Ba,mo+js,js);mo+=vt[gn]}},qg=new Map;tn.onaudioprocess=({inputBuffer:gn,outputBuffer:mo})=>{if(qo!==null){let Ba=$e(kn);for(let js=0;js<Vt;js+=128){for(let ao=0;ao<it.numberOfInputs;ao+=1)for(let Es=0;Es<it.channelCount;Es+=1)Ai(gn,du[ao],Es,Es,js);ft.parameterDescriptors!==void 0&&ft.parameterDescriptors.forEach(({name:ao},Es)=>{Ai(gn,nr,ao,It+Es,js)});for(let ao=0;ao<it.numberOfInputs;ao+=1)for(let Es=0;Es<vt[ao];Es+=1)Mo[ao][Es].byteLength===0&&(Mo[ao][Es]=new Float32Array(128));try{let ao=du.map((sc,yh)=>{if(Ba[yh].size>0)return qg.set(yh,Vt/128),sc;let xh=qg.get(yh);return xh===void 0?[]:(sc.every(MO=>MO.every(FO=>FO===0))&&(xh===1?qg.delete(yh):qg.set(yh,xh-1)),sc)});_n=Oe(Xe.currentTime+js/Xe.sampleRate,Xe.sampleRate,()=>qo.process(ao,Mo,nr));for(let sc=0,yh=0;sc<it.numberOfOutputs;sc+=1){for(let xh=0;xh<vt[sc];xh+=1)ia(mo,Mo[sc],xh,yh+xh,js);yh+=vt[sc]}}catch(ao){_n=!1,kn.dispatchEvent(new ErrorEvent("processorerror",{colno:ao.colno,filename:ao.filename,lineno:ao.lineno,message:ao.message}))}if(!_n){for(let ao=0;ao<it.numberOfInputs;ao+=1){gt[ao].disconnect(Ft[ao]);for(let Es=0;Es<it.channelCount;Es+=1)Ft[js].disconnect(Zt,Es,ao*it.channelCount+Es)}if(ft.parameterDescriptors!==void 0){let ao=ft.parameterDescriptors.length;for(let Es=0;Es<ao;Es+=1){let sc=Et[Es];sc.disconnect(Zt,0,It+Es),sc.stop()}}Zt.disconnect(tn),tn.onaudioprocess=null,Ry?La():n9();break}}}};let Ry=!1,My=ue(Xe,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),t9=()=>tn.connect(My).connect(Xe.destination),n9=()=>{tn.disconnect(My),My.disconnect()};return t9(),et(kn,()=>{if(_n){n9(),it.numberOfOutputs>0&&tn.connect(en);for(let gn=0,mo=0;gn<it.numberOfOutputs;gn+=1){let Ba=fn[gn];for(let js=0;js<vt[gn];js+=1)en.connect(Ba,mo+js,js);mo+=vt[gn]}}Ry=!0},()=>{_n&&(t9(),La()),Ry=!1})})(pb,fe,po,cl,pt,nu,pn,Kn,yn,hb,tc,nS,_c),Eg=(($,l,x,_,P)=>(X,ue,de,we,Ne,Oe)=>{if(de!==null)try{let Xe=new de(X,we,Oe),ct=new Map,ft=null;if(Object.defineProperties(Xe,{channelCount:{get:()=>Oe.channelCount,set:()=>{throw $()}},channelCountMode:{get:()=>"explicit",set:()=>{throw $()}},onprocessorerror:{get:()=>ft,set:it=>{typeof ft=="function"&&Xe.removeEventListener("processorerror",ft),ft=typeof it=="function"?it:null,typeof ft=="function"&&Xe.addEventListener("processorerror",ft)}}}),Xe.addEventListener=(et=Xe.addEventListener,(...it)=>{if(it[0]==="processorerror"){let vt=typeof it[1]=="function"?it[1]:typeof it[1]=="object"&&it[1]!==null&&typeof it[1].handleEvent=="function"?it[1].handleEvent:null;if(vt!==null){let It=ct.get(it[1]);It!==void 0?it[1]=It:(it[1]=Mt=>{Mt.type==="error"?(Object.defineProperties(Mt,{type:{value:"processorerror"}}),vt(Mt)):vt(new ErrorEvent(it[0],Tt({},Mt)))},ct.set(vt,it[1]))}}return et.call(Xe,"error",it[1],it[2]),et.call(Xe,...it)}),Xe.removeEventListener=($e=Xe.removeEventListener,(...it)=>{if(it[0]==="processorerror"){let vt=ct.get(it[1]);vt!==void 0&&(ct.delete(it[1]),it[1]=vt)}return $e.call(Xe,"error",it[1],it[2]),$e.call(Xe,it[0],it[1],it[2])}),Oe.numberOfOutputs!==0){let it=x(X,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return Xe.connect(it).connect(X.destination),P(Xe,()=>it.disconnect(),()=>it.connect(X.destination))}return Xe}catch(Xe){throw Xe.code===11?_():Xe}var $e,et;if(Ne===void 0)throw _();return(Xe=>{let{port1:ct}=new MessageChannel;try{ct.postMessage(Xe)}finally{ct.close()}})(Oe),l(X,ue,Ne,Oe)})(po,rS,pn,yn,_c),fb=(($,l,x,_,P,X,ue,de,we,Ne,Oe,$e,et,Xe,ct,ft)=>(it,vt,It)=>{let Mt=new WeakMap,$t=null;return{render(_t,gt){de(gt,_t);let Ft=Mt.get(gt);return Ft!==void 0?Promise.resolve(Ft):((Et,Zt)=>Te(null,null,function*(){let Vt=Oe(Et),tn=null,en=pe(Vt,Zt),fn=Array.isArray(vt.outputChannelCount)?vt.outputChannelCount:Array.from(vt.outputChannelCount);if($e===null){let On=fn.reduce((kn,Tr)=>kn+Tr,0),Nn=P(Zt,{channelCount:Math.max(1,On),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,On)}),$n=[];for(let kn=0;kn<Et.numberOfOutputs;kn+=1)$n.push(_(Zt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:fn[kn]}));let gr=ue(Zt,{channelCount:vt.channelCount,channelCountMode:vt.channelCountMode,channelInterpretation:vt.channelInterpretation,gain:1});gr.connect=l.bind(null,$n),gr.disconnect=we.bind(null,$n),tn=[Nn,$n,gr]}else en||(Vt=new $e(Zt,it));if(Mt.set(Zt,tn===null?Vt:tn[2]),tn!==null){if($t===null){if(It===void 0)throw new Error("Missing the processor constructor.");if(et===null)throw new Error("Missing the native OfflineAudioContext constructor.");let Tr=Et.channelCount*Et.numberOfInputs,Qr=It.parameterDescriptors===void 0?0:It.parameterDescriptors.length,Vs=Tr+Qr;$t=Nu(Et,Vs===0?null:yield Te(null,null,function*(){let qo=new et(Vs,128*Math.ceil(Et.context.length/128),Zt.sampleRate),oc=[],du=[];for(let _n=0;_n<vt.numberOfInputs;_n+=1)oc.push(ue(qo,{channelCount:vt.channelCount,channelCountMode:vt.channelCountMode,channelInterpretation:vt.channelInterpretation,gain:1})),du.push(P(qo,{channelCount:vt.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:vt.channelCount}));let Mo=yield Promise.all(Array.from(Et.parameters.values()).map(_n=>Te(null,null,function*(){let La=X(qo,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:_n.value});return yield Xe(qo,_n,La.offset),La}))),nr=_(qo,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,Tr+Qr)});for(let _n=0;_n<vt.numberOfInputs;_n+=1){oc[_n].connect(du[_n]);for(let La=0;La<vt.channelCount;La+=1)du[_n].connect(nr,La,_n*vt.channelCount+La)}for(let[_n,La]of Mo.entries())La.connect(nr,0,Tr+_n),La.start(0);return nr.connect(qo.destination),yield Promise.all(oc.map(_n=>ct(Et,qo,_n))),ft(qo)}),Zt,vt,fn,It,Ne)}let On=yield $t,Nn=x(Zt,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[$n,gr,kn]=tn;On!==null&&(Nn.buffer=On,Nn.start(0)),Nn.connect($n);for(let Tr=0,Qr=0;Tr<Et.numberOfOutputs;Tr+=1){let Vs=gr[Tr];for(let Js=0;Js<fn[Tr];Js+=1)$n.connect(Vs,Qr+Js,Js);Qr+=fn[Tr]}return kn}if(en)for(let[On,Nn]of Et.parameters.entries())yield $(Zt,Nn,Vt.parameters.get(On));else for(let[On,Nn]of Et.parameters.entries())yield Xe(Zt,Nn,Vt.parameters.get(On));return yield ct(Et,Zt,Vt),Vt}))(_t,gt)}}})(Zu,pb,Ic,cl,pt,nu,pn,Iy,hb,tc,nn,oo,Is,tu,Cs,Ou),oS=($=>l=>$.get(l))(sb),Nc=($=>(l,x)=>{$.set(l,x)})(db),mb=ob?(($,l,x,_,P,X,ue,de,we,Ne,Oe,$e,et,Xe)=>class extends l{constructor(ct,ft,it){var vt;let It=de(ct),Mt=we(It),$t=(tn=>Tn(Tt({},tn),{outputChannelCount:tn.outputChannelCount!==void 0?tn.outputChannelCount:tn.numberOfInputs===1&&tn.numberOfOutputs===1?[tn.channelCount]:Array.from({length:tn.numberOfOutputs},()=>1)}))(Tt(Tt({},Di),it));(tn=>{let{port1:en,port2:fn}=new MessageChannel;try{en.postMessage(tn)}finally{en.close(),fn.close()}})($t);let _t=y.get(It),gt=_t?.get(ft),Ft=Mt||It.state!=="closed"?It:(vt=ue(It))!==null&&vt!==void 0?vt:It,Et=P(Ft,Mt?null:ct.baseLatency,Ne,ft,gt,$t);super(ct,!0,Et,Mt?_(ft,$t,gt):null);let Zt=[];Et.parameters.forEach((tn,en)=>{let fn=x(this,Mt,tn);Zt.push([en,fn])}),this._nativeAudioWorkletNode=Et,this._onprocessorerror=null,this._parameters=new ki(Zt),Mt&&$(It,this);let{activeInputs:Vt}=X(this);$e(Et,Vt)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(ct){let ft=typeof ct=="function"?Xe(this,ct):null;this._nativeAudioWorkletNode.onprocessorerror=ft;let it=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=it!==null&&it===ft?ct:it}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(lb,Jr,Du,fb,Eg,Ce,oS,ho,Gr,oo,0,Nc,0,ua):void 0,sS=(($,l)=>(x,_,P)=>{if(l===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new l(x,_,P)}catch(X){throw X.name==="SyntaxError"?$():X}})(yn,Is),iS=(($,l,x,_,P,X,ue,de)=>(we,Ne)=>x(we).render(we,Ne).then(()=>Promise.all(Array.from(_(Ne)).map(Oe=>x(Oe).render(Oe,Ne)))).then(()=>P(Ne)).then(Oe=>(typeof Oe.copyFromChannel!="function"?(ue(Oe),he(Oe)):l(X,()=>X(Oe))||de(Oe),$.add(Oe),Oe)))(sp,ca,Oa,Tg,Ou,ae,nh,rh),aS=(($,l,x,_,P)=>class extends ${constructor(X,ue,de){let we;if(typeof X=="number"&&ue!==void 0&&de!==void 0)we={length:ue,numberOfChannels:X,sampleRate:de};else{if(typeof X!="object")throw new Error("The given parameters are not valid.");we=X}let{length:Ne,numberOfChannels:Oe,sampleRate:$e}=Tt(Tt({},Cn),we),et=_(Oe,Ne,$e);l(Xt,()=>Xt(et))||et.addEventListener("statechange",(()=>{let Xe=0,ct=ft=>{this._state==="running"&&(Xe>0?(et.removeEventListener("statechange",ct),ft.stopImmediatePropagation(),this._waitForThePromiseToSettle(ft)):Xe+=1)};return ct})()),super(et,Oe),this._length=Ne,this._nativeOfflineAudioContext=et,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(x()):(this._state="running",P(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,z(this)}))}_waitForThePromiseToSettle(X){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(X):setTimeout(()=>this._waitForThePromiseToSettle(X))}})(ab,ca,po,sS,iS),uS=(($,l)=>x=>{let _=$.get(x);return l(_)||l(x)})(d,op),cS=(($,l)=>x=>$.has(x)||l(x))(h,hf),gb=(($,l)=>x=>$.has(x)||l(x))(g,_s),_y=(($,l)=>x=>{let _=$.get(x);return l(_)||l(x)})(d,Gr),lS=()=>(($,l,x,_,P,X,ue,de,we,Ne,Oe,$e,et,Xe,ct,ft)=>Te(void 0,null,function*(){return!!($(l,l)&&$(x,x)&&$(P,P)&&$(X,X)&&$(de,de)&&$(we,we)&&$(Ne,Ne)&&$(Oe,Oe)&&$($e,$e)&&$(et,et)&&$(Xe,Xe))&&(yield Promise.all([$(_,_),$(ue,ue),$(ct,ct),$(ft,ft)])).every(it=>it)}))(ca,($=>()=>{if($===null)return!1;let l=new $(1,1,44100).createBuffer(1,1,44100);if(l.copyToChannel===void 0)return!0;let x=new Float32Array(2);try{l.copyFromChannel(x,0,0)}catch{return!1}return!0})(Is),($=>()=>{if($===null)return!1;if($.prototype!==void 0&&$.prototype.close!==void 0)return!0;let l=new $,x=l.close!==void 0;try{l.close()}catch{}return x})(Gi),($=>()=>{if($===null)return Promise.resolve(!1);let l=new $(1,1,44100);return new Promise(x=>{let _=!0,P=ue=>{_&&(_=!1,l.startRendering(),x(ue instanceof TypeError))},X;try{X=l.decodeAudioData(null,()=>{},P)}catch(ue){P(ue)}X!==void 0&&X.catch(P)})})(Is),($=>()=>{if($===null)return!1;let l;try{l=new $({latencyHint:"balanced"})}catch{return!1}return l.close(),!0})(Gi),($=>()=>{if($===null)return!1;let l=new $(1,1,44100).createGain(),x=l.connect(l)===l;return l.disconnect(l),x})(Is),(($,l)=>()=>Te(void 0,null,function*(){if($===null)return!0;if(l===null)return!1;let x=new Blob(['let c,p;class A extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=(e)=>{p=e.data;p.onmessage=()=>{p.postMessage(c);p.close()};this.port.postMessage(0)}}process(){c=1}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),_=new MessageChannel,P=new l(1,128,44100),X=URL.createObjectURL(x),ue=!1;try{yield P.audioWorklet.addModule(X);let de=new $(P,"a",{numberOfOutputs:0}),we=P.createOscillator();yield new Promise(Ne=>{de.port.onmessage=()=>Ne(),de.port.postMessage(_.port2,[_.port2])}),de.port.onmessage=()=>ue=!0,we.connect(de),we.start(0),yield P.startRendering(),ue=yield new Promise(Ne=>{_.port1.onmessage=({data:Oe})=>Ne(Oe===1),_.port1.postMessage(0)})}catch{}finally{_.port1.close(),URL.revokeObjectURL(X)}return ue}))(oo,Is),($=>()=>{if($===null)return!1;let l=new $(1,1,44100).createChannelMerger();if(l.channelCountMode==="max")return!0;try{l.channelCount=2}catch{return!0}return!1})(Is),($=>()=>{if($===null)return!1;let l=new $(1,1,44100);return l.createConstantSource===void 0||l.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY})(Is),($=>()=>{if($===null)return!1;let l=new $(1,1,44100),x=l.createConvolver();x.buffer=l.createBuffer(1,1,l.sampleRate);try{x.buffer=l.createBuffer(1,1,l.sampleRate)}catch{return!1}return!0})(Is),($=>()=>{if($===null)return!1;let l=new $(1,1,44100).createConvolver();try{l.channelCount=1}catch{return!1}return!0})(Is),gg,($=>()=>$!==null&&$.hasOwnProperty("isSecureContext"))(ri),($=>()=>{if($===null)return!1;let l=new $;try{return l.createMediaStreamSource(new MediaStream),!1}catch{return!0}finally{l.close()}})(Gi),($=>()=>{if($===null)return Promise.resolve(!1);let l=new $(1,1,44100);if(l.createStereoPanner===void 0||l.createConstantSource===void 0)return Promise.resolve(!0);let x=l.createConstantSource(),_=l.createStereoPanner();return x.channelCount=1,x.offset.value=1,_.channelCount=1,x.start(),x.connect(_).connect(l.destination),l.startRendering().then(P=>P.getChannelData(0)[0]!==1)})(Is),qr);function la($){return $===void 0}function mr($){return $!==void 0}function yb($){return typeof $=="function"}function Ra($){return typeof $=="number"}function kc($){return Object.prototype.toString.call($)==="[object Object]"&&$.constructor===Object}function ll($){return typeof $=="boolean"}function vi($){return Array.isArray($)}function Ma($){return typeof $=="string"}function uh($){return Ma($)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test($)}function Pn($,l){if(!$)throw new Error(l)}function wi($,l,x=1/0){if(!(l<=$&&$<=x))throw new RangeError(`Value must be within [${l}, ${x}], got: ${$}`)}function gf($){$.isOffline||$.state==="running"||ch('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let xb=!1,bb=!1;function Ty($){xb=$}function vb($){la($)&&xb&&!bb&&(bb=!0,ch("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let Ey=console;function pS($){Ey=$}function wb(...$){Ey.log(...$)}function ch(...$){Ey.warn(...$)}let Dc=typeof self=="object"?self:null,hS=Dc&&(Dc.hasOwnProperty("AudioContext")||Dc.hasOwnProperty("webkitAudioContext"));function ou($,l,x,_){var P,X=arguments.length,ue=X<3?l:_===null?_=Object.getOwnPropertyDescriptor(l,x):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")ue=Reflect.decorate($,l,x,_);else for(var de=$.length-1;de>=0;de--)(P=$[de])&&(ue=(X<3?P(ue):X>3?P(l,x,ue):P(l,x))||ue);return X>3&&ue&&Object.defineProperty(l,x,ue),ue}function To($,l,x,_){return new(x||(x=Promise))(function(P,X){function ue(Ne){try{we(_.next(Ne))}catch(Oe){X(Oe)}}function de(Ne){try{we(_.throw(Ne))}catch(Oe){X(Oe)}}function we(Ne){var Oe;Ne.done?P(Ne.value):(Oe=Ne.value,Oe instanceof x?Oe:new x(function($e){$e(Oe)})).then(ue,de)}we((_=_.apply($,l||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;class dS{constructor(l,x,_,P){this._callback=l,this._type=x,this._minimumUpdateInterval=Math.max(128/(P||44100),.001),this.updateInterval=_,this._createClock()}_createWorker(){let l=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),x=URL.createObjectURL(l),_=new Worker(x);_.onmessage=this._callback.bind(this),this._worker=_}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},1e3*this._updateInterval)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(l){var x;this._updateInterval=Math.max(l,this._minimumUpdateInterval),this._type==="worker"&&((x=this._worker)===null||x===void 0||x.postMessage(1e3*this._updateInterval))}get type(){return this._type}set type(l){this._disposeClock(),this._type=l,this._createClock()}dispose(){this._disposeClock()}}function Ac($){return gb($)}function pl($){return cS($)}function Ng($){return _y($)}function lh($){return uS($)}function fS($,l){return $==="value"||Ac(l)||pl(l)||function(x){return x instanceof Wx}(l)}function su($,...l){if(!l.length)return $;let x=l.shift();if(kc($)&&kc(x))for(let _ in x)fS(_,x[_])?$[_]=x[_]:kc(x[_])?($[_]||Object.assign($,{[_]:{}}),su($[_],x[_])):Object.assign($,{[_]:x[_]});return su($,...l)}function ot($,l,x=[],_){let P={},X=Array.from(l);if(kc(X[0])&&_&&!Reflect.has(X[0],_)&&(Object.keys(X[0]).some(ue=>Reflect.has($,ue))||(su(P,{[_]:X[0]}),x.splice(x.indexOf(_),1),X.shift())),X.length===1&&kc(X[0]))su(P,X[0]);else for(let ue=0;ue<x.length;ue++)mr(X[ue])&&(P[x[ue]]=X[ue]);return su($,P)}function Fa($,l){return la($)?l:$}function oi($,l){return l.forEach(x=>{Reflect.has($,x)&&delete $[x]}),$}let hl=(()=>{class ${constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...x){(this.debug||Dc&&this.toString()===Dc.TONE_DEBUG_CLASS)&&wb(this,...x)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}return $.version=i,$})(),Ny=1e-6;function ph($,l){return $>l+Ny}function ky($,l){return ph($,l)||iu($,l)}function yf($,l){return $+Ny<l}function iu($,l){return Math.abs($-l)<Ny}function hp($,l,x){return Math.max(Math.min($,x),l)}class pa extends hl{constructor(){super(),this.name="Timeline",this._timeline=[];let l=ot(pa.getDefaults(),arguments,["memory"]);this.memory=l.memory,this.increasing=l.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(l){if(Pn(Reflect.has(l,"time"),"Timeline: events must have a time attribute"),l.time=l.time.valueOf(),this.increasing&&this.length){let x=this._timeline[this.length-1];Pn(ky(l.time,x.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(l)}else{let x=this._search(l.time);this._timeline.splice(x+1,0,l)}if(this.length>this.memory){let x=this.length-this.memory;this._timeline.splice(0,x)}return this}remove(l){let x=this._timeline.indexOf(l);return x!==-1&&this._timeline.splice(x,1),this}get(l,x="time"){let _=this._search(l,x);return _!==-1?this._timeline[_]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(l,x="time"){let _=this._search(l,x);return _+1<this._timeline.length?this._timeline[_+1]:null}getBefore(l){let x=this._timeline.length;if(x>0&&this._timeline[x-1].time<l)return this._timeline[x-1];let _=this._search(l);return _-1>=0?this._timeline[_-1]:null}cancel(l){if(this._timeline.length>1){let x=this._search(l);if(x>=0)if(iu(this._timeline[x].time,l)){for(let _=x;_>=0&&iu(this._timeline[_].time,l);_--)x=_;this._timeline=this._timeline.slice(0,x)}else this._timeline=this._timeline.slice(0,x+1);else this._timeline=[]}else this._timeline.length===1&&ky(this._timeline[0].time,l)&&(this._timeline=[]);return this}cancelBefore(l){let x=this._search(l);return x>=0&&(this._timeline=this._timeline.slice(x+1)),this}previousEvent(l){let x=this._timeline.indexOf(l);return x>0?this._timeline[x-1]:null}_search(l,x="time"){if(this._timeline.length===0)return-1;let _=0,P=this._timeline.length,X=P;if(P>0&&this._timeline[P-1][x]<=l)return P-1;for(;_<X;){let ue=Math.floor(_+(X-_)/2),de=this._timeline[ue],we=this._timeline[ue+1];if(iu(de[x],l)){for(let Ne=ue;Ne<this._timeline.length&&iu(this._timeline[Ne][x],l);Ne++)ue=Ne;return ue}if(yf(de[x],l)&&ph(we[x],l))return ue;ph(de[x],l)?X=ue:_=ue+1}return-1}_iterate(l,x=0,_=this._timeline.length-1){this._timeline.slice(x,_+1).forEach(l)}forEach(l){return this._iterate(l),this}forEachBefore(l,x){let _=this._search(l);return _!==-1&&this._iterate(x,0,_),this}forEachAfter(l,x){let _=this._search(l);return this._iterate(x,_+1),this}forEachBetween(l,x,_){let P=this._search(l),X=this._search(x);return P!==-1&&X!==-1?(this._timeline[P].time!==l&&(P+=1),this._timeline[X].time===x&&(X-=1),this._iterate(_,P,X)):P===-1&&this._iterate(_,0,X),this}forEachFrom(l,x){let _=this._search(l);for(;_>=0&&this._timeline[_].time>=l;)_--;return this._iterate(x,_+1),this}forEachAtTime(l,x){let _=this._search(l);if(_!==-1&&iu(this._timeline[_].time,l)){let P=_;for(let X=_;X>=0&&iu(this._timeline[X].time,l);X--)P=X;this._iterate(X=>{x(X)},P,_)}return this}dispose(){return super.dispose(),this._timeline=[],this}}let Sb=[];function eo($){Sb.push($)}let dl=[];function xf($){dl.push($)}class fl extends hl{constructor(){super(...arguments),this.name="Emitter"}on(l,x){return l.split(/\W+/).forEach(_=>{la(this._events)&&(this._events={}),this._events.hasOwnProperty(_)||(this._events[_]=[]),this._events[_].push(x)}),this}once(l,x){let _=(...P)=>{x(...P),this.off(l,_)};return this.on(l,_),this}off(l,x){return l.split(/\W+/).forEach(_=>{if(la(this._events)&&(this._events={}),this._events.hasOwnProperty(_))if(la(x))this._events[_]=[];else{let P=this._events[_];for(let X=P.length-1;X>=0;X--)P[X]===x&&P.splice(X,1)}}),this}emit(l,...x){if(this._events&&this._events.hasOwnProperty(l)){let _=this._events[l].slice(0);for(let P=0,X=_.length;P<X;P++)_[P].apply(this,x)}return this}static mixin(l){["on","once","off","emit"].forEach(x=>{let _=Object.getOwnPropertyDescriptor(fl.prototype,x);Object.defineProperty(l.prototype,x,_)})}dispose(){return super.dispose(),this._events=void 0,this}}class hh extends fl{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class dp extends hh{constructor(){var l,x;super(),this.name="Context",this._constants=new Map,this._timeouts=new pa,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;let _=ot(dp.getDefaults(),arguments,["context"]);_.context?(this._context=_.context,this._latencyHint=((l=arguments[0])===null||l===void 0?void 0:l.latencyHint)||""):(this._context=function(P){return new cb(P)}({latencyHint:_.latencyHint}),this._latencyHint=_.latencyHint),this._ticker=new dS(this.emit.bind(this,"tick"),_.clockSource,_.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((x=arguments[0])===null||x===void 0)&&x.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=_.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var l;return this._initialized||(l=this,Sb.forEach(x=>x(l)),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(l,x,_){return this._context.createBuffer(l,x,_)}createChannelMerger(l){return this._context.createChannelMerger(l)}createChannelSplitter(l){return this._context.createChannelSplitter(l)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(l){return this._context.createDelay(l)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(l,x){return this._context.createIIRFilter(l,x)}createPanner(){return this._context.createPanner()}createPeriodicWave(l,x,_){return this._context.createPeriodicWave(l,x,_)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(l){return Pn(lh(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(l)}createMediaElementSource(l){return Pn(lh(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(l)}createMediaStreamDestination(){return Pn(lh(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(l){return this._context.decodeAudioData(l)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(l){Pn(!this._initialized,"The listener cannot be set after initialization."),this._listener=l}get transport(){return this.initialize(),this._transport}set transport(l){Pn(!this._initialized,"The transport cannot be set after initialization."),this._transport=l}get draw(){return this.initialize(),this._draw}set draw(l){Pn(!this._initialized,"Draw cannot be set after initialization."),this._draw=l}get destination(){return this.initialize(),this._destination}set destination(l){Pn(!this._initialized,"The destination cannot be set after initialization."),this._destination=l}createAudioWorkletNode(l,x){return function(_,P,X){return Pn(mr(mb),"This node only works in a secure context (https or localhost)"),new mb(_,P,X)}(this.rawContext,l,x)}addAudioWorkletModule(l){return To(this,void 0,void 0,function*(){Pn(mr(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(l)),yield this._workletPromise})}workletsAreReady(){return To(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(l){this._ticker.updateInterval=l}get clockSource(){return this._ticker.type}set clockSource(l){this._ticker.type=l}get lookAhead(){return this._lookAhead}set lookAhead(l){this._lookAhead=l,this.updateInterval=l?l/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return lh(this._context)?this._context.resume():Promise.resolve()}close(){return To(this,void 0,void 0,function*(){var l;lh(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&(l=this,dl.forEach(x=>x(l)))})}getConstant(l){if(this._constants.has(l))return this._constants.get(l);{let x=this._context.createBuffer(1,128,this._context.sampleRate),_=x.getChannelData(0);for(let X=0;X<_.length;X++)_[X]=l;let P=this._context.createBufferSource();return P.channelCount=1,P.channelCountMode="explicit",P.buffer=x,P.loop=!0,P.start(0),this._constants.set(l,P),P}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(l=>this._constants[l].disconnect()),this.close(),this}_timeoutLoop(){let l=this.now(),x=this._timeouts.peek();for(;this._timeouts.length&&x&&x.time<=l;)x.callback(),this._timeouts.shift(),x=this._timeouts.peek()}setTimeout(l,x){this._timeoutIds++;let _=this.now();return this._timeouts.add({callback:l,id:this._timeoutIds,time:_+x}),this._timeoutIds}clearTimeout(l){return this._timeouts.forEach(x=>{x.id===l&&this._timeouts.remove(x)}),this}clearInterval(l){return this.clearTimeout(l)}setInterval(l,x){let _=++this._timeoutIds,P=()=>{let X=this.now();this._timeouts.add({callback:()=>{l(),P()},id:_,time:X+x})};return P(),_}}function Wn($,l){vi(l)?l.forEach(x=>Wn($,x)):Object.defineProperty($,l,{enumerable:!0,writable:!1})}function dh($,l){vi(l)?l.forEach(x=>dh($,x)):Object.defineProperty($,l,{writable:!0})}let Nr=()=>{};class Hr extends hl{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Nr;let l=ot(Hr.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=l.reverse,this.onload=l.onload,Ma(l.url)?this.load(l.url).catch(l.onerror):l.url&&this.set(l.url)}static getDefaults(){return{onerror:Nr,onload:Nr,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:A().sampleRate}set(l){return l instanceof Hr?l.loaded?this._buffer=l.get():l.onload=()=>{this.set(l),this.onload(this)}:this._buffer=l,this._reversed&&this._reverse(),this}get(){return this._buffer}load(l){return To(this,void 0,void 0,function*(){let x=Hr.load(l).then(_=>{this.set(_),this.onload(this)});Hr.downloads.push(x);try{yield x}finally{let _=Hr.downloads.indexOf(x);Hr.downloads.splice(_,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(l){let x=vi(l)&&l[0].length>0,_=x?l.length:1,P=x?l[0].length:l.length,X=A(),ue=X.createBuffer(_,P,X.sampleRate),de=x||_!==1?l:[l];for(let we=0;we<_;we++)ue.copyToChannel(de[we],we);return this._buffer=ue,this}toMono(l){if(Ra(l))this.fromArray(this.toArray(l));else{let x=new Float32Array(this.length),_=this.numberOfChannels;for(let P=0;P<_;P++){let X=this.toArray(P);for(let ue=0;ue<X.length;ue++)x[ue]+=X[ue]}x=x.map(P=>P/_),this.fromArray(x)}return this}toArray(l){if(Ra(l))return this.getChannelData(l);if(this.numberOfChannels===1)return this.toArray(0);{let x=[];for(let _=0;_<this.numberOfChannels;_++)x[_]=this.getChannelData(_);return x}}getChannelData(l){return this._buffer?this._buffer.getChannelData(l):new Float32Array(0)}slice(l,x=this.duration){Pn(this.loaded,"Buffer is not loaded");let _=Math.floor(l*this.sampleRate),P=Math.floor(x*this.sampleRate);Pn(_<P,"The start time must be less than the end time");let X=P-_,ue=A().createBuffer(this.numberOfChannels,X,this.sampleRate);for(let de=0;de<this.numberOfChannels;de++)ue.copyToChannel(this.getChannelData(de).subarray(_,P),de);return new Hr(ue)}_reverse(){if(this.loaded)for(let l=0;l<this.numberOfChannels;l++)this.getChannelData(l).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(l){this._reversed!==l&&(this._reversed=l,this._reverse())}static fromArray(l){return new Hr().fromArray(l)}static fromUrl(l){return To(this,void 0,void 0,function*(){return yield new Hr().load(l)})}static load(l){return To(this,void 0,void 0,function*(){let x=l.match(/\[([^\]\[]+\|.+)\]$/);if(x){let de=x[1].split("|"),we=de[0];for(let Ne of de)if(Hr.supportsType(Ne)){we=Ne;break}l=l.replace(x[0],we)}let _=Hr.baseUrl===""||Hr.baseUrl.endsWith("/")?Hr.baseUrl:Hr.baseUrl+"/",P=document.createElement("a");P.href=_+l,P.pathname=(P.pathname+P.hash).split("/").map(encodeURIComponent).join("/");let X=yield fetch(P.href);if(!X.ok)throw new Error(`could not load url: ${l}`);let ue=yield X.arrayBuffer();return yield A().decodeAudioData(ue)})}static supportsType(l){let x=l.split("."),_=x[x.length-1];return document.createElement("audio").canPlayType("audio/"+_)!==""}static loaded(){return To(this,void 0,void 0,function*(){for(yield Promise.resolve();Hr.downloads.length;)yield Hr.downloads[0]})}}Hr.baseUrl="",Hr.downloads=[];class te extends dp{constructor(){var l,x,_;super({clockSource:"offline",context:Ng(arguments[0])?arguments[0]:(l=arguments[0],x=arguments[1]*arguments[2],_=arguments[2],new aS(l,x,_)),lookAhead:0,updateInterval:Ng(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Ng(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(l){return To(this,void 0,void 0,function*(){let x=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,x++;let _=Math.floor(this.sampleRate/128);l&&x%_==0&&(yield new Promise(P=>setTimeout(P,1)))}})}render(l=!0){return To(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(l);let x=yield this._context.startRendering();return new Hr(x)})}close(){return Promise.resolve()}}let b=new class extends hh{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer($,l,x){return{}}createChannelMerger($){return{}}createChannelSplitter($){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay($){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter($,l){return{}}createPanner(){return{}}createPeriodicWave($,l,x){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource($){return{}}createMediaElementSource($){return{}}createMediaStreamDestination(){return{}}decodeAudioData($){return Promise.resolve({})}createAudioWorkletNode($,l){return{}}get rawContext(){return{}}addAudioWorkletModule($){return To(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout($,l){return 0}clearTimeout($){return this}setInterval($,l){return 0}clearInterval($){return this}getConstant($){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw($){}get destination(){return{}}set destination($){}now(){return 0}immediate(){return 0}},k=b;function A(){return k===b&&hS&&j(new dp),k}function j($,l=!1){l&&k.dispose(),k=lh($)?new dp($):Ng($)?new te($):$}function G(){return k.resume()}if(Dc&&!Dc.TONE_SILENCE_LOGGING){let $="v";i==="dev"&&($="");let l=` * Tone.js ${$}${i} * `;console.log(`%c${l}`,"background: #000; color: #fff")}function H($){return Math.pow(10,$/20)}function re($){return Math.log($)/Math.LN10*20}function ie($){return Math.pow(2,$/12)}let me=440;function _e($){return Math.round(Ue($))}function Ue($){return 69+12*Math.log2($/me)}function Be($){return me*Math.pow(2,($-69)/12)}class Ye extends hl{constructor(l,x,_){super(),this.defaultUnits="s",this._val=x,this._units=_,this.context=l,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:l=>this._frequencyToUnits(parseFloat(l)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:l=>this._ticksToUnits(parseInt(l,10)),regexp:/^(\d+)i$/i},m:{method:l=>this._beatsToUnits(parseInt(l,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(l,x)=>{let _=parseInt(l,10),P=x==="."?1.5:1;return _===1?this._beatsToUnits(this._getTimeSignature())*P:this._beatsToUnits(4/_)*P},regexp:/^(\d+)n(\.?)$/i},number:{method:l=>this._expressions[this.defaultUnits].method.call(this,l),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:l=>this._secondsToUnits(parseFloat(l)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:l=>parseInt(l,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:l=>{let x=parseInt(l,10);return this._beatsToUnits(8/(3*Math.floor(x)))},regexp:/^(\d+)t$/i},tr:{method:(l,x,_)=>{let P=0;return l&&l!=="0"&&(P+=this._beatsToUnits(this._getTimeSignature()*parseFloat(l))),x&&x!=="0"&&(P+=this._beatsToUnits(parseFloat(x))),_&&_!=="0"&&(P+=this._beatsToUnits(parseFloat(_)/4)),P},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Ye&&this.fromType(this._val),la(this._val))return this._noArg();if(Ma(this._val)&&la(this._units)){for(let l in this._expressions)if(this._expressions[l].regexp.test(this._val.trim())){this._units=l;break}}else if(kc(this._val)){let l=0;for(let x in this._val)if(mr(this._val[x])){let _=this._val[x];l+=new this.constructor(this.context,x).valueOf()*_}return l}if(mr(this._units)){let l=this._expressions[this._units],x=this._val.toString().trim().match(l.regexp);return x?l.method.apply(this,x.slice(1)):l.method.call(this,this._val)}return Ma(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(l){return 1/l}_beatsToUnits(l){return 60/this._getBpm()*l}_secondsToUnits(l){return l}_ticksToUnits(l){return l*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(l){switch(this._units=void 0,this.defaultUnits){case"s":this._val=l.toSeconds();break;case"i":this._val=l.toTicks();break;case"hz":this._val=l.toFrequency();break;case"midi":this._val=l.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class He extends Ye{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:l=>this._now()+new this.constructor(this.context,l).valueOf(),regexp:/^\+(.+)/},quantize:{method:l=>{let x=new He(this.context,l).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(x))},regexp:/^@(.+)/}})}quantize(l,x=1){let _=new this.constructor(this.context,l).valueOf(),P=this.valueOf();return P+(Math.round(P/_)*_-P)*x}toNotation(){let l=this.toSeconds(),x=["1m"];for(let X=1;X<9;X++){let ue=Math.pow(2,X);x.push(ue+"n."),x.push(ue+"n"),x.push(ue+"t")}x.push("0");let _=x[0],P=new He(this.context,x[0]).toSeconds();return x.forEach(X=>{let ue=new He(this.context,X).toSeconds();Math.abs(ue-l)<Math.abs(P-l)&&(_=X,P=ue)}),_}toBarsBeatsSixteenths(){let l=this._beatsToUnits(1),x=this.valueOf()/l;x=parseFloat(x.toFixed(4));let _=Math.floor(x/this._getTimeSignature()),P=x%1*4;x=Math.floor(x)%this._getTimeSignature();let X=P.toString();return X.length>3&&(P=parseFloat(parseFloat(X).toFixed(3))),[_,x,P].join(":")}toTicks(){let l=this._beatsToUnits(1);return this.valueOf()/l*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return _e(this.toFrequency())}_now(){return this.context.now()}}function Ke($,l){return new He(A(),$,l)}class Je extends He{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return me}static set A4(l){(function(x){me=x})(l)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(l){return this.defaultUnits==="midi"?l:Je.mtof(l)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(l,x){let _=Nt[l.toLowerCase()]+12*(parseInt(x,10)+1);return this.defaultUnits==="midi"?_:Je.mtof(_)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(l,x,_){let P=1;return l&&l!=="0"&&(P*=this._beatsToUnits(this._getTimeSignature()*parseFloat(l))),x&&x!=="0"&&(P*=this._beatsToUnits(parseFloat(x))),_&&_!=="0"&&(P*=this._beatsToUnits(parseFloat(_)/4)),P}}})}transpose(l){return new Je(this.context,this.valueOf()*ie(l))}harmonize(l){return l.map(x=>this.transpose(x))}toMidi(){return _e(this.valueOf())}toNote(){let l=this.toFrequency(),x=Math.log2(l/Je.A4),_=Math.round(12*x)+57,P=Math.floor(_/12);return P<0&&(_+=-12*P),Jt[_%12]+P.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){let l=this._beatsToUnits(1),x=this.valueOf()/l;return Math.floor(x*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(l){return l}_ticksToUnits(l){return 1/(60*l/(this._getBpm()*this._getPPQ()))}_beatsToUnits(l){return 1/super._beatsToUnits(l)}_secondsToUnits(l){return 1/l}static mtof(l){return Be(l)}static ftom(l){return _e(l)}}let Nt={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},Jt=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function on($,l){return new Je(A(),$,l)}class dt extends He{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function Bt($,l){return new dt(A(),$,l)}class wt extends hl{constructor(){super();let l=ot(wt.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=l.context}static getDefaults(){return{context:A()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(l){return vb(l),new He(this.context,l).toSeconds()}toFrequency(l){return new Je(this.context,l).toFrequency()}toTicks(l){return new dt(this.context,l).toTicks()}_getPartialProperties(l){let x=this.get();return Object.keys(x).forEach(_=>{la(l[_])&&delete x[_]}),x}get(){let l=this.constructor.getDefaults();return Object.keys(l).forEach(x=>{if(Reflect.has(this,x)){let _=this[x];mr(_)&&mr(_.value)&&mr(_.setValueAtTime)?l[x]=_.value:_ instanceof wt?l[x]=_._getPartialProperties(l[x]):vi(_)||Ra(_)||Ma(_)||ll(_)?l[x]=_:delete l[x]}}),l}set(l){return Object.keys(l).forEach(x=>{Reflect.has(this,x)&&mr(this[x])&&(this[x]&&mr(this[x].value)&&mr(this[x].setValueAtTime)?this[x].value!==l[x]&&(this[x].value=l[x]):this[x]instanceof wt?this[x].set(l[x]):this[x]=l[x])}),this}}class In extends pa{constructor(l="stopped"){super(),this.name="StateTimeline",this._initial=l,this.setStateAtTime(this._initial,0)}getValueAtTime(l){let x=this.get(l);return x!==null?x.state:this._initial}setStateAtTime(l,x,_){return wi(x,0),this.add(Object.assign({},_,{state:l,time:x})),this}getLastState(l,x){for(let _=this._search(x);_>=0;_--){let P=this._timeline[_];if(P.state===l)return P}}getNextState(l,x){let _=this._search(x);if(_!==-1)for(let P=_;P<this._timeline.length;P++){let X=this._timeline[P];if(X.state===l)return X}}}class Ut extends wt{constructor(){super(ot(Ut.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;let l=ot(Ut.getDefaults(),arguments,["param","units","convert"]);for(Pn(mr(l.param)&&(Ac(l.param)||l.param instanceof Ut),"param must be an AudioParam");!Ac(l.param);)l.param=l.param._param;this._swappable=!!mr(l.swappable)&&l.swappable,this._swappable?(this.input=this.context.createGain(),this._param=l.param,this.input.connect(this._param)):this._param=this.input=l.param,this._events=new pa(1e3),this._initialValue=this._param.defaultValue,this.units=l.units,this.convert=l.convert,this._minValue=l.minValue,this._maxValue=l.maxValue,mr(l.value)&&l.value!==this._toType(this._initialValue)&&this.setValueAtTime(l.value,0)}static getDefaults(){return Object.assign(wt.getDefaults(),{convert:!0,units:"number"})}get value(){let l=this.now();return this.getValueAtTime(l)}set value(l){this.cancelScheduledValues(this.now()),this.setValueAtTime(l,this.now())}get minValue(){return mr(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return mr(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(l,x){return this.units===x}_assertRange(l){return mr(this.maxValue)&&mr(this.minValue)&&wi(l,this._fromType(this.minValue),this._fromType(this.maxValue)),l}_fromType(l){return this.convert&&!this.overridden?this._is(l,"time")?this.toSeconds(l):this._is(l,"decibels")?H(l):this._is(l,"frequency")?this.toFrequency(l):l:this.overridden?0:l}_toType(l){return this.convert&&this.units==="decibels"?re(l):l}setValueAtTime(l,x){let _=this.toSeconds(x),P=this._fromType(l);return Pn(isFinite(P)&&isFinite(_),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(l)}, ${JSON.stringify(x)}`),this._assertRange(P),this.log(this.units,"setValueAtTime",l,_),this._events.add({time:_,type:"setValueAtTime",value:P}),this._param.setValueAtTime(P,_),this}getValueAtTime(l){let x=Math.max(this.toSeconds(l),0),_=this._events.getAfter(x),P=this._events.get(x),X=this._initialValue;if(P===null)X=this._initialValue;else if(P.type!=="setTargetAtTime"||_!==null&&_.type!=="setValueAtTime")if(_===null)X=P.value;else if(_.type==="linearRampToValueAtTime"||_.type==="exponentialRampToValueAtTime"){let ue=P.value;if(P.type==="setTargetAtTime"){let de=this._events.getBefore(P.time);ue=de===null?this._initialValue:de.value}X=_.type==="linearRampToValueAtTime"?this._linearInterpolate(P.time,ue,_.time,_.value,x):this._exponentialInterpolate(P.time,ue,_.time,_.value,x)}else X=P.value;else{let ue=this._events.getBefore(P.time),de;de=ue===null?this._initialValue:ue.value,P.type==="setTargetAtTime"&&(X=this._exponentialApproach(P.time,de,P.value,P.constant,x))}return this._toType(X)}setRampPoint(l){l=this.toSeconds(l);let x=this.getValueAtTime(l);return this.cancelAndHoldAtTime(l),this._fromType(x)===0&&(x=this._toType(this._minOutput)),this.setValueAtTime(x,l),this}linearRampToValueAtTime(l,x){let _=this._fromType(l),P=this.toSeconds(x);return Pn(isFinite(_)&&isFinite(P),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(l)}, ${JSON.stringify(x)}`),this._assertRange(_),this._events.add({time:P,type:"linearRampToValueAtTime",value:_}),this.log(this.units,"linearRampToValueAtTime",l,P),this._param.linearRampToValueAtTime(_,P),this}exponentialRampToValueAtTime(l,x){let _=this._fromType(l);_=iu(_,0)?this._minOutput:_,this._assertRange(_);let P=this.toSeconds(x);return Pn(isFinite(_)&&isFinite(P),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(l)}, ${JSON.stringify(x)}`),this._events.add({time:P,type:"exponentialRampToValueAtTime",value:_}),this.log(this.units,"exponentialRampToValueAtTime",l,P),this._param.exponentialRampToValueAtTime(_,P),this}exponentialRampTo(l,x,_){return _=this.toSeconds(_),this.setRampPoint(_),this.exponentialRampToValueAtTime(l,_+this.toSeconds(x)),this}linearRampTo(l,x,_){return _=this.toSeconds(_),this.setRampPoint(_),this.linearRampToValueAtTime(l,_+this.toSeconds(x)),this}targetRampTo(l,x,_){return _=this.toSeconds(_),this.setRampPoint(_),this.exponentialApproachValueAtTime(l,_,x),this}exponentialApproachValueAtTime(l,x,_){x=this.toSeconds(x),_=this.toSeconds(_);let P=Math.log(_+1)/Math.log(200);return this.setTargetAtTime(l,x,P),this.cancelAndHoldAtTime(x+.9*_),this.linearRampToValueAtTime(l,x+_),this}setTargetAtTime(l,x,_){let P=this._fromType(l);Pn(isFinite(_)&&_>0,"timeConstant must be a number greater than 0");let X=this.toSeconds(x);return this._assertRange(P),Pn(isFinite(P)&&isFinite(X),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(l)}, ${JSON.stringify(x)}`),this._events.add({constant:_,time:X,type:"setTargetAtTime",value:P}),this.log(this.units,"setTargetAtTime",l,X,_),this._param.setTargetAtTime(P,X,_),this}setValueCurveAtTime(l,x,_,P=1){_=this.toSeconds(_),x=this.toSeconds(x);let X=this._fromType(l[0])*P;this.setValueAtTime(this._toType(X),x);let ue=_/(l.length-1);for(let de=1;de<l.length;de++){let we=this._fromType(l[de])*P;this.linearRampToValueAtTime(this._toType(we),x+de*ue)}return this}cancelScheduledValues(l){let x=this.toSeconds(l);return Pn(isFinite(x),`Invalid argument to cancelScheduledValues: ${JSON.stringify(l)}`),this._events.cancel(x),this._param.cancelScheduledValues(x),this.log(this.units,"cancelScheduledValues",x),this}cancelAndHoldAtTime(l){let x=this.toSeconds(l),_=this._fromType(this.getValueAtTime(x));Pn(isFinite(x),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(l)}`),this.log(this.units,"cancelAndHoldAtTime",x,"value="+_);let P=this._events.get(x),X=this._events.getAfter(x);return P&&iu(P.time,x)?X?(this._param.cancelScheduledValues(X.time),this._events.cancel(X.time)):(this._param.cancelAndHoldAtTime(x),this._events.cancel(x+this.sampleTime)):X&&(this._param.cancelScheduledValues(X.time),this._events.cancel(X.time),X.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(_),x):X.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(_),x)),this._events.add({time:x,type:"setValueAtTime",value:_}),this._param.setValueAtTime(_,x),this}rampTo(l,x=.1,_){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(l,x,_):this.linearRampTo(l,x,_),this}apply(l){let x=this.context.currentTime;l.setValueAtTime(this.getValueAtTime(x),x);let _=this._events.get(x);if(_&&_.type==="setTargetAtTime"){let P=this._events.getAfter(_.time),X=P?P.time:x+2,ue=(X-x)/10;for(let de=x;de<X;de+=ue)l.linearRampToValueAtTime(this.getValueAtTime(de),de)}return this._events.forEachAfter(this.context.currentTime,P=>{P.type==="cancelScheduledValues"?l.cancelScheduledValues(P.time):P.type==="setTargetAtTime"?l.setTargetAtTime(P.value,P.time,P.constant):l[P.type](P.value,P.time)}),this}setParam(l){Pn(this._swappable,"The Param must be assigned as 'swappable' in the constructor");let x=this.input;return x.disconnect(this._param),this.apply(l),this._param=l,x.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(l,x,_,P,X){return _+(x-_)*Math.exp(-(X-l)/P)}_linearInterpolate(l,x,_,P,X){return x+(X-l)/(_-l)*(P-x)}_exponentialInterpolate(l,x,_,P,X){return x*Math.pow(P/x,(X-l)/(_-l))}}class kt extends wt{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return mr(this.input)?Ac(this.input)||this.input instanceof Ut?1:this.input.numberOfInputs:0}get numberOfOutputs(){return mr(this.output)?this.output.numberOfOutputs:0}_isAudioNode(l){return mr(l)&&(l instanceof kt||pl(l))}_getInternalNodes(){let l=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&l.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&l.push(this.output),l}_setChannelProperties(l){this._getInternalNodes().forEach(x=>{x.channelCount=l.channelCount,x.channelCountMode=l.channelCountMode,x.channelInterpretation=l.channelInterpretation})}_getChannelProperties(){let l=this._getInternalNodes();Pn(l.length>0,"ToneAudioNode does not have any internal nodes");let x=l[0];return{channelCount:x.channelCount,channelCountMode:x.channelCountMode,channelInterpretation:x.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(l){let x=this._getChannelProperties();this._setChannelProperties(Object.assign(x,{channelCount:l}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(l){let x=this._getChannelProperties();this._setChannelProperties(Object.assign(x,{channelCountMode:l}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(l){let x=this._getChannelProperties();this._setChannelProperties(Object.assign(x,{channelInterpretation:l}))}connect(l,x=0,_=0){return er(this,l,x,_),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return ch("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(l,x=0,_=0){return kr(this,l,x,_),this}chain(...l){return cr(this,...l),this}fan(...l){return l.forEach(x=>this.connect(x)),this}dispose(){return super.dispose(),mr(this.input)&&(this.input instanceof kt?this.input.dispose():pl(this.input)&&this.input.disconnect()),mr(this.output)&&(this.output instanceof kt?this.output.dispose():pl(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function cr(...$){let l=$.shift();$.reduce((x,_)=>(x instanceof kt?x.connect(_):pl(x)&&er(x,_),_),l)}function er($,l,x=0,_=0){for(Pn(mr($),"Cannot connect from undefined node"),Pn(mr(l),"Cannot connect to undefined node"),(l instanceof kt||pl(l))&&Pn(l.numberOfInputs>0,"Cannot connect to node with no inputs"),Pn($.numberOfOutputs>0,"Cannot connect from node with no outputs");l instanceof kt||l instanceof Ut;)mr(l.input)&&(l=l.input);for(;$ instanceof kt;)mr($.output)&&($=$.output);Ac(l)?$.connect(l,x):$.connect(l,x,_)}function kr($,l,x=0,_=0){if(mr(l))for(;l instanceof kt;)l=l.input;for(;!pl($);)mr($.output)&&($=$.output);Ac(l)?$.disconnect(l,x):pl(l)?$.disconnect(l,x,_):$.disconnect()}function Kr(...$){let l=$.pop();mr(l)&&$.forEach(x=>er(x,l))}class mn extends kt{constructor(){super(ot(mn.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;let l=ot(mn.getDefaults(),arguments,["gain","units"]);this.gain=new Ut({context:this.context,convert:l.convert,param:this._gainNode.gain,units:l.units,value:l.gain,minValue:l.minValue,maxValue:l.maxValue}),Wn(this,"gain")}static getDefaults(){return Object.assign(kt.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Ys extends kt{constructor(l){super(l),this.onended=Nr,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new mn({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(x){let _=this.toSeconds(x);return this._startTime!==-1&&_>=this._startTime&&(this._stopTime===-1||_<=this._stopTime)?"started":"stopped"},this._fadeIn=l.fadeIn,this._fadeOut=l.fadeOut,this._curve=l.curve,this.onended=l.onended}static getDefaults(){return Object.assign(kt.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Nr})}_startGain(l,x=1){Pn(this._startTime===-1,"Source cannot be started more than once");let _=this.toSeconds(this._fadeIn);return this._startTime=l+_,this._startTime=Math.max(this._startTime,this.context.currentTime),_>0?(this._gainNode.gain.setValueAtTime(0,l),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(x,l+_):this._gainNode.gain.exponentialApproachValueAtTime(x,l,_)):this._gainNode.gain.setValueAtTime(x,l),this}stop(l){return this.log("stop",l),this._stopGain(this.toSeconds(l)),this}_stopGain(l){Pn(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();let x=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(l)+x,this._stopTime=Math.max(this._stopTime,this.now()),x>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,x,l):this._gainNode.gain.targetRampTo(0,x,l):(this._gainNode.gain.cancelAndHoldAtTime(l),this._gainNode.gain.setValueAtTime(0,l)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{let _=this._curve==="exponential"?2*x:0;this._stopSource(this.now()+_),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Nr&&(this.onended(this),this.onended=Nr,!this.context.isOffline)){let l=()=>this.dispose();window.requestIdleCallback!==void 0?window.requestIdleCallback(l):setTimeout(l,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Pn(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Nr,this}}class Qs extends Ys{constructor(){super(ot(Qs.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();let l=ot(Qs.getDefaults(),arguments,["offset"]);er(this._source,this._gainNode),this.offset=new Ut({context:this.context,convert:l.convert,param:this._source.offset,units:l.units,value:l.offset,minValue:l.minValue,maxValue:l.maxValue})}static getDefaults(){return Object.assign(Ys.getDefaults(),{convert:!0,offset:1,units:"number"})}start(l){let x=this.toSeconds(l);return this.log("start",x),this._startGain(x),this._source.start(x),this}_stopSource(l){this._source.stop(l)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Sn extends kt{constructor(){super(ot(Sn.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;let l=ot(Sn.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Qs({context:this.context,convert:l.convert,offset:l.value,units:l.units,minValue:l.minValue,maxValue:l.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(kt.getDefaults(),{convert:!0,units:"number",value:0})}connect(l,x=0,_=0){return Ls(this,l,x,_),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(l,x){return this._param.setValueAtTime(l,x),this}getValueAtTime(l){return this._param.getValueAtTime(l)}setRampPoint(l){return this._param.setRampPoint(l),this}linearRampToValueAtTime(l,x){return this._param.linearRampToValueAtTime(l,x),this}exponentialRampToValueAtTime(l,x){return this._param.exponentialRampToValueAtTime(l,x),this}exponentialRampTo(l,x,_){return this._param.exponentialRampTo(l,x,_),this}linearRampTo(l,x,_){return this._param.linearRampTo(l,x,_),this}targetRampTo(l,x,_){return this._param.targetRampTo(l,x,_),this}exponentialApproachValueAtTime(l,x,_){return this._param.exponentialApproachValueAtTime(l,x,_),this}setTargetAtTime(l,x,_){return this._param.setTargetAtTime(l,x,_),this}setValueCurveAtTime(l,x,_,P){return this._param.setValueCurveAtTime(l,x,_,P),this}cancelScheduledValues(l){return this._param.cancelScheduledValues(l),this}cancelAndHoldAtTime(l){return this._param.cancelAndHoldAtTime(l),this}rampTo(l,x,_){return this._param.rampTo(l,x,_),this}get value(){return this._param.value}set value(l){this._param.value=l}get convert(){return this._param.convert}set convert(l){this._param.convert=l}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(l){this._param.overridden=l}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(l){return this._param.apply(l),this}}function Ls($,l,x,_){(l instanceof Ut||Ac(l)||l instanceof Sn&&l.override)&&(l.cancelScheduledValues(0),l.setValueAtTime(0,0),l instanceof Sn&&(l.overridden=!0)),er($,l,x,_)}class si extends Ut{constructor(){super(ot(si.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new pa(1/0),this._multiplier=1;let l=ot(si.getDefaults(),arguments,["value"]);this._multiplier=l.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(l.value)}),this.setValueAtTime(l.value,0)}static getDefaults(){return Object.assign(Ut.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(l,x,_){x=this.toSeconds(x),this.setRampPoint(x);let P=this._fromType(l),X=this._events.get(x),ue=Math.round(Math.max(1/_,1));for(let de=0;de<=ue;de++){let we=_*de+x,Ne=this._exponentialApproach(X.time,X.value,P,_,we);this.linearRampToValueAtTime(this._toType(Ne),we)}return this}setValueAtTime(l,x){let _=this.toSeconds(x);super.setValueAtTime(l,x);let P=this._events.get(_),X=this._events.previousEvent(P),ue=this._getTicksUntilEvent(X,_);return P.ticks=Math.max(ue,0),this}linearRampToValueAtTime(l,x){let _=this.toSeconds(x);super.linearRampToValueAtTime(l,x);let P=this._events.get(_),X=this._events.previousEvent(P),ue=this._getTicksUntilEvent(X,_);return P.ticks=Math.max(ue,0),this}exponentialRampToValueAtTime(l,x){x=this.toSeconds(x);let _=this._fromType(l),P=this._events.get(x),X=Math.round(Math.max(10*(x-P.time),1)),ue=(x-P.time)/X;for(let de=0;de<=X;de++){let we=ue*de+P.time,Ne=this._exponentialInterpolate(P.time,P.value,x,_,we);this.linearRampToValueAtTime(this._toType(Ne),we)}return this}_getTicksUntilEvent(l,x){if(l===null)l={ticks:0,time:0,type:"setValueAtTime",value:0};else if(la(l.ticks)){let ue=this._events.previousEvent(l);l.ticks=this._getTicksUntilEvent(ue,l.time)}let _=this._fromType(this.getValueAtTime(l.time)),P=this._fromType(this.getValueAtTime(x)),X=this._events.get(x);return X&&X.time===x&&X.type==="setValueAtTime"&&(P=this._fromType(this.getValueAtTime(x-this.sampleTime))),.5*(x-l.time)*(_+P)+l.ticks}getTicksAtTime(l){let x=this.toSeconds(l),_=this._events.get(x);return Math.max(this._getTicksUntilEvent(_,x),0)}getDurationOfTicks(l,x){let _=this.toSeconds(x),P=this.getTicksAtTime(x);return this.getTimeOfTick(P+l)-_}getTimeOfTick(l){let x=this._events.get(l,"ticks"),_=this._events.getAfter(l,"ticks");if(x&&x.ticks===l)return x.time;if(x&&_&&_.type==="linearRampToValueAtTime"&&x.value!==_.value){let P=this._fromType(this.getValueAtTime(x.time)),X=(this._fromType(this.getValueAtTime(_.time))-P)/(_.time-x.time),ue=Math.sqrt(Math.pow(P,2)-2*X*(x.ticks-l)),de=(-P+ue)/X,we=(-P-ue)/X;return(de>0?de:we)+x.time}return x?x.value===0?1/0:x.time+(l-x.ticks)/x.value:l/this._initialValue}ticksToTime(l,x){return this.getDurationOfTicks(l,x)}timeToTicks(l,x){let _=this.toSeconds(x),P=this.toSeconds(l),X=this.getTicksAtTime(_);return this.getTicksAtTime(_+P)-X}_fromType(l){return this.units==="bpm"&&this.multiplier?1/(60/l/this.multiplier):super._fromType(l)}_toType(l){return this.units==="bpm"&&this.multiplier?l/this.multiplier*60:super._toType(l)}get multiplier(){return this._multiplier}set multiplier(l){let x=this.value;this._multiplier=l,this.cancelScheduledValues(0),this.setValueAtTime(x,0)}}class Bs extends Sn{constructor(){super(ot(Bs.getDefaults(),arguments,["value"])),this.name="TickSignal";let l=ot(Bs.getDefaults(),arguments,["value"]);this.input=this._param=new si({context:this.context,convert:l.convert,multiplier:l.multiplier,param:this._constantSource.offset,units:l.units,value:l.value})}static getDefaults(){return Object.assign(Sn.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(l,x){return this._param.ticksToTime(l,x)}timeToTicks(l,x){return this._param.timeToTicks(l,x)}getTimeOfTick(l){return this._param.getTimeOfTick(l)}getDurationOfTicks(l,x){return this._param.getDurationOfTicks(l,x)}getTicksAtTime(l){return this._param.getTicksAtTime(l)}get multiplier(){return this._param.multiplier}set multiplier(l){this._param.multiplier=l}dispose(){return super.dispose(),this._param.dispose(),this}}class ha extends wt{constructor(){super(ot(ha.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new In,this._tickOffset=new pa,this._ticksAtTime=new pa,this._secondsAtTime=new pa;let l=ot(ha.getDefaults(),arguments,["frequency"]);this.frequency=new Bs({context:this.context,units:l.units,value:l.frequency}),Wn(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},wt.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(l,x){let _=this.toSeconds(l);return this._state.getValueAtTime(_)!=="started"&&(this._state.setStateAtTime("started",_),mr(x)&&this.setTicksAtTime(x,_),this._ticksAtTime.cancel(_),this._secondsAtTime.cancel(_)),this}stop(l){let x=this.toSeconds(l);if(this._state.getValueAtTime(x)==="stopped"){let _=this._state.get(x);_&&_.time>0&&(this._tickOffset.cancel(_.time),this._state.cancel(_.time))}return this._state.cancel(x),this._state.setStateAtTime("stopped",x),this.setTicksAtTime(0,x),this._ticksAtTime.cancel(x),this._secondsAtTime.cancel(x),this}pause(l){let x=this.toSeconds(l);return this._state.getValueAtTime(x)==="started"&&(this._state.setStateAtTime("paused",x),this._ticksAtTime.cancel(x),this._secondsAtTime.cancel(x)),this}cancel(l){return l=this.toSeconds(l),this._state.cancel(l),this._tickOffset.cancel(l),this._ticksAtTime.cancel(l),this._secondsAtTime.cancel(l),this}getTicksAtTime(l){let x=this.toSeconds(l),_=this._state.getLastState("stopped",x),P=this._ticksAtTime.get(x),X={state:"paused",time:x};this._state.add(X);let ue=P||_,de=P?P.ticks:0,we=null;return this._state.forEachBetween(ue.time,x+this.sampleTime,Ne=>{let Oe=ue.time,$e=this._tickOffset.get(Ne.time);$e&&$e.time>=ue.time&&(de=$e.ticks,Oe=$e.time),ue.state==="started"&&Ne.state!=="started"&&(de+=this.frequency.getTicksAtTime(Ne.time)-this.frequency.getTicksAtTime(Oe),Ne.time!==X.time&&(we={state:Ne.state,time:Ne.time,ticks:de})),ue=Ne}),this._state.remove(X),we&&this._ticksAtTime.add(we),de}get ticks(){return this.getTicksAtTime(this.now())}set ticks(l){this.setTicksAtTime(l,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(l){let x=this.now(),_=this.frequency.timeToTicks(l,x);this.setTicksAtTime(_,x)}getSecondsAtTime(l){l=this.toSeconds(l);let x=this._state.getLastState("stopped",l),_={state:"paused",time:l};this._state.add(_);let P=this._secondsAtTime.get(l),X=P||x,ue=P?P.seconds:0,de=null;return this._state.forEachBetween(X.time,l+this.sampleTime,we=>{let Ne=X.time,Oe=this._tickOffset.get(we.time);Oe&&Oe.time>=X.time&&(ue=Oe.seconds,Ne=Oe.time),X.state==="started"&&we.state!=="started"&&(ue+=we.time-Ne,we.time!==_.time&&(de={state:we.state,time:we.time,seconds:ue})),X=we}),this._state.remove(_),de&&this._secondsAtTime.add(de),ue}setTicksAtTime(l,x){return x=this.toSeconds(x),this._tickOffset.cancel(x),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(l,x),ticks:l,time:x}),this._ticksAtTime.cancel(x),this._secondsAtTime.cancel(x),this}getStateAtTime(l){return l=this.toSeconds(l),this._state.getValueAtTime(l)}getTimeOfTick(l,x=this.now()){let _=this._tickOffset.get(x),P=this._state.get(x),X=Math.max(_.time,P.time),ue=this.frequency.getTicksAtTime(X)+l-_.ticks;return this.frequency.getTimeOfTick(ue)}forEachTickBetween(l,x,_){let P=this._state.get(l);this._state.forEachBetween(l,x,ue=>{P&&P.state==="started"&&ue.state!=="started"&&this.forEachTickBetween(Math.max(P.time,l),ue.time-this.sampleTime,_),P=ue});let X=null;if(P&&P.state==="started"){let ue=Math.max(P.time,l),de=this.frequency.getTicksAtTime(ue),we=de-this.frequency.getTicksAtTime(P.time),Ne=Math.ceil(we)-we;Ne=iu(Ne,1)?0:Ne;let Oe=this.frequency.getTimeOfTick(de+Ne);for(;Oe<x;){try{_(Oe,Math.round(this.getTicksAtTime(Oe)))}catch($e){X=$e;break}Oe+=this.frequency.getDurationOfTicks(1,Oe)}}if(X)throw X;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class ii extends wt{constructor(){super(ot(ii.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Nr,this._lastUpdate=0,this._state=new In("stopped"),this._boundLoop=this._loop.bind(this);let l=ot(ii.getDefaults(),arguments,["callback","frequency"]);this.callback=l.callback,this._tickSource=new ha({context:this.context,frequency:l.frequency,units:l.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Wn(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(wt.getDefaults(),{callback:Nr,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(l,x){gf(this.context);let _=this.toSeconds(l);return this.log("start",_),this._state.getValueAtTime(_)!=="started"&&(this._state.setStateAtTime("started",_),this._tickSource.start(_,x),_<this._lastUpdate&&this.emit("start",_,x)),this}stop(l){let x=this.toSeconds(l);return this.log("stop",x),this._state.cancel(x),this._state.setStateAtTime("stopped",x),this._tickSource.stop(x),x<this._lastUpdate&&this.emit("stop",x),this}pause(l){let x=this.toSeconds(l);return this._state.getValueAtTime(x)==="started"&&(this._state.setStateAtTime("paused",x),this._tickSource.pause(x),x<this._lastUpdate&&this.emit("pause",x)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(l){this._tickSource.ticks=l}get seconds(){return this._tickSource.seconds}set seconds(l){this._tickSource.seconds=l}getSecondsAtTime(l){return this._tickSource.getSecondsAtTime(l)}setTicksAtTime(l,x){return this._tickSource.setTicksAtTime(l,x),this}getTimeOfTick(l,x=this.now()){return this._tickSource.getTimeOfTick(l,x)}getTicksAtTime(l){return this._tickSource.getTicksAtTime(l)}nextTickTime(l,x){let _=this.toSeconds(x),P=this.getTicksAtTime(_);return this._tickSource.getTimeOfTick(P+l,_)}_loop(){let l=this._lastUpdate,x=this.now();this._lastUpdate=x,this.log("loop",l,x),l!==x&&(this._state.forEachBetween(l,x,_=>{switch(_.state){case"started":let P=this._tickSource.getTicksAtTime(_.time);this.emit("start",_.time,P);break;case"stopped":_.time!==0&&this.emit("stop",_.time);break;case"paused":this.emit("pause",_.time)}}),this._tickSource.forEachTickBetween(l,x,(_,P)=>{this.callback(_,P)}))}getStateAtTime(l){let x=this.toSeconds(l);return this._state.getValueAtTime(x)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}fl.mixin(ii);class fo extends kt{constructor(){super(ot(fo.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";let l=ot(fo.getDefaults(),arguments,["delayTime","maxDelay"]),x=this.toSeconds(l.maxDelay);this._maxDelay=Math.max(x,this.toSeconds(l.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(x),this.delayTime=new Ut({context:this.context,param:this._delayNode.delayTime,units:"time",value:l.delayTime,minValue:0,maxValue:this.maxDelay}),Wn(this,"delayTime")}static getDefaults(){return Object.assign(kt.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}function Oc($,l,x=2,_=A().sampleRate){return To(this,void 0,void 0,function*(){let P=A(),X=new te(x,l,_);j(X),yield $(X);let ue=X.render();j(P);let de=yield ue;return new Hr(de)})}class Rc extends hl{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;let l=ot(Rc.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=l.baseUrl,Object.keys(l.urls).forEach(x=>{this._loadingCount++;let _=l.urls[x];this.add(x,_,this._bufferLoaded.bind(this,l.onload),l.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Nr,onload:Nr,urls:{}}}has(l){return this._buffers.has(l.toString())}get(l){return Pn(this.has(l),`ToneAudioBuffers has no buffer named: ${l}`),this._buffers.get(l.toString())}_bufferLoaded(l){this._loadingCount--,this._loadingCount===0&&l&&l()}get loaded(){return Array.from(this._buffers).every(([l,x])=>x.loaded)}add(l,x,_=Nr,P=Nr){return Ma(x)?(this.baseUrl&&x.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(l.toString(),new Hr(this.baseUrl+x,_,P))):this._buffers.set(l.toString(),new Hr(x,_,P)),this}dispose(){return super.dispose(),this._buffers.forEach(l=>l.dispose()),this._buffers.clear(),this}}class fh extends Je{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(l){return _e(super._frequencyToUnits(l))}_ticksToUnits(l){return _e(super._ticksToUnits(l))}_beatsToUnits(l){return _e(super._beatsToUnits(l))}_secondsToUnits(l){return _e(super._secondsToUnits(l))}toMidi(){return this.valueOf()}toFrequency(){return Be(this.toMidi())}transpose(l){return new fh(this.context,this.toMidi()+l)}}function IO($,l){return new fh(A(),$,l)}class gs extends dt{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(l){return this._getPPQ()*l}_secondsToUnits(l){return Math.floor(l/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(l){return l}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function _O($,l){return new gs(A(),$,l)}class TO extends wt{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new pa,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(l,x){return this._events.add({callback:l,time:this.toSeconds(x)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(l){return this._events.cancel(this.toSeconds(l)),this}_drawLoop(){let l=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=l;){let x=this._events.shift();x&&l-x.time<=this.expiration&&x.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}eo($=>{$.draw=new TO({context:$})}),xf($=>{$.draw.dispose()});class N_ extends hl{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(l){Pn(mr(l.time),"Events must have a time property"),Pn(mr(l.duration),"Events must have a duration parameter"),l.time=l.time.valueOf();let x=new mS(l.time,l.time+l.duration,l);for(this._root===null?this._root=x:this._root.insert(x),this._length++;x!==null;)x.updateHeight(),x.updateMax(),this._rebalance(x),x=x.parent;return this}remove(l){if(this._root!==null){let x=[];this._root.search(l.time,x);for(let _ of x)if(_.event===l){this._removeNode(_),this._length--;break}}return this}get length(){return this._length}cancel(l){return this.forEachFrom(l,x=>this.remove(x)),this}_setRoot(l){this._root=l,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(l,x){l.parent!==null?(l.isLeftChild()?l.parent.left=x:l.parent.right=x,this._rebalance(l.parent)):this._setRoot(x)}_removeNode(l){if(l.left===null&&l.right===null)this._replaceNodeInParent(l,null);else if(l.right===null)this._replaceNodeInParent(l,l.left);else if(l.left===null)this._replaceNodeInParent(l,l.right);else{let x,_=null;if(l.getBalance()>0)if(l.left.right===null)x=l.left,x.right=l.right,_=x;else{for(x=l.left.right;x.right!==null;)x=x.right;x.parent&&(x.parent.right=x.left,_=x.parent,x.left=l.left,x.right=l.right)}else if(l.right.left===null)x=l.right,x.left=l.left,_=x;else{for(x=l.right.left;x.left!==null;)x=x.left;x.parent&&(x.parent.left=x.right,_=x.parent,x.left=l.left,x.right=l.right)}l.parent!==null?l.isLeftChild()?l.parent.left=x:l.parent.right=x:this._setRoot(x),_&&this._rebalance(_)}l.dispose()}_rotateLeft(l){let x=l.parent,_=l.isLeftChild(),P=l.right;P&&(l.right=P.left,P.left=l),x!==null?_?x.left=P:x.right=P:this._setRoot(P)}_rotateRight(l){let x=l.parent,_=l.isLeftChild(),P=l.left;P&&(l.left=P.right,P.right=l),x!==null?_?x.left=P:x.right=P:this._setRoot(P)}_rebalance(l){let x=l.getBalance();x>1&&l.left?l.left.getBalance()<0?this._rotateLeft(l.left):this._rotateRight(l):x<-1&&l.right&&(l.right.getBalance()>0?this._rotateRight(l.right):this._rotateLeft(l))}get(l){if(this._root!==null){let x=[];if(this._root.search(l,x),x.length>0){let _=x[0];for(let P=1;P<x.length;P++)x[P].low>_.low&&(_=x[P]);return _.event}}return null}forEach(l){if(this._root!==null){let x=[];this._root.traverse(_=>x.push(_)),x.forEach(_=>{_.event&&l(_.event)})}return this}forEachAtTime(l,x){if(this._root!==null){let _=[];this._root.search(l,_),_.forEach(P=>{P.event&&x(P.event)})}return this}forEachFrom(l,x){if(this._root!==null){let _=[];this._root.searchAfter(l,_),_.forEach(P=>{P.event&&x(P.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(l=>l.dispose()),this._root=null,this}}class mS{constructor(l,x,_){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=_,this.low=l,this.high=x,this.max=this.high}insert(l){l.low<=this.low?this.left===null?this.left=l:this.left.insert(l):this.right===null?this.right=l:this.right.insert(l)}search(l,x){l>this.max||(this.left!==null&&this.left.search(l,x),this.low<=l&&this.high>l&&x.push(this),this.low>l||this.right!==null&&this.right.search(l,x))}searchAfter(l,x){this.low>=l&&(x.push(this),this.left!==null&&this.left.searchAfter(l,x)),this.right!==null&&this.right.searchAfter(l,x)}traverse(l){l(this),this.left!==null&&this.left.traverse(l),this.right!==null&&this.right.traverse(l)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let l=0;return this.left!==null&&this.right!==null?l=this.left.height-this.right.height:this.left!==null?l=this.left.height+1:this.right!==null&&(l=-(this.right.height+1)),l}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(l){this._left=l,l!==null&&(l.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(l){this._right=l,l!==null&&(l.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class ml extends kt{constructor(){super(ot(ml.getDefaults(),arguments,["volume"])),this.name="Volume";let l=ot(ml.getDefaults(),arguments,["volume"]);this.input=this.output=new mn({context:this.context,gain:l.volume,units:"decibels"}),this.volume=this.output.gain,Wn(this,"volume"),this._unmutedVolume=l.volume,this.mute=l.mute}static getDefaults(){return Object.assign(kt.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(l){!this.mute&&l?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!l&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Cb extends kt{constructor(){super(ot(Cb.getDefaults(),arguments)),this.name="Destination",this.input=new ml({context:this.context}),this.output=new mn({context:this.context}),this.volume=this.input.volume;let l=ot(Cb.getDefaults(),arguments);cr(this.input,this.output,this.context.rawContext.destination),this.mute=l.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(kt.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(l){this.input.mute=l}chain(...l){return this.input.disconnect(),l.unshift(this.input),l.push(this.output),cr(...l),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}eo($=>{$.destination=new Cb({context:$})}),xf($=>{$.destination.dispose()});class EO extends hl{constructor(l){super(),this.name="TimelineValue",this._timeline=new pa({memory:10}),this._initialValue=l}set(l,x){return this._timeline.add({value:l,time:x}),this}get(l){let x=this._timeline.get(l);return x?x.value:this._initialValue}}class Mu extends kt{constructor(){super(Object.assign(ot(Mu.getDefaults(),arguments,["context"])))}connect(l,x=0,_=0){return Ls(this,l,x,_),this}}class au extends Mu{constructor(){super(Object.assign(ot(au.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;let l=ot(au.getDefaults(),arguments,["mapping","length"]);vi(l.mapping)||l.mapping instanceof Float32Array?this.curve=Float32Array.from(l.mapping):yb(l.mapping)&&this.setMap(l.mapping,l.length)}static getDefaults(){return Object.assign(Sn.getDefaults(),{length:1024})}setMap(l,x=1024){let _=new Float32Array(x);for(let P=0,X=x;P<X;P++){let ue=P/(X-1)*2-1;_[P]=l(ue,P)}return this.curve=_,this}get curve(){return this._shaper.curve}set curve(l){this._shaper.curve=l}get oversample(){return this._shaper.oversample}set oversample(l){Pn(["none","2x","4x"].some(x=>x.includes(l)),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=l}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class bf extends Mu{constructor(){super(Object.assign(ot(bf.getDefaults(),arguments,["value"]))),this.name="Pow";let l=ot(bf.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new au({context:this.context,mapping:this._expFunc(l.value),length:8192}),this._exponent=l.value}static getDefaults(){return Object.assign(Mu.getDefaults(),{value:1})}_expFunc(l){return x=>Math.pow(Math.abs(x),l)}get value(){return this._exponent}set value(l){this._exponent=l,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}let Dy=(()=>{class ${constructor(x,_){this.id=$._eventId++,this._remainderTime=0;let P=Object.assign($.getDefaults(),_);this.transport=x,this.callback=P.callback,this._once=P.once,this.time=Math.floor(P.time),this._remainderTime=P.time-this.time}static getDefaults(){return{callback:Nr,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(x){if(this.callback){let _=this.transport.bpm.getDurationOfTicks(1,x);this.callback(x+this._remainderTime*_),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}return $._eventId=0,$})();class gS extends Dy{constructor(l,x){super(l,x),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);let _=Object.assign(gS.getDefaults(),x);this.duration=_.duration,this._interval=_.interval,this._nextTick=_.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Dy.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(l){this._createEvents(l),super.invoke(l)}_createEvent(){return yf(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new gs(this.context,this._nextTick).toSeconds()):-1}_createEvents(l){yf(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new gs(this.context,this._nextTick).toSeconds()))}_restart(l){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;let x=this.transport.getTicksAtTime(l);ph(x,this.time)&&(this._nextTick=this.floatTime+Math.ceil((x-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class kg extends wt{constructor(){super(ot(kg.getDefaults(),arguments)),this.name="Transport",this._loop=new EO(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new pa,this._repeatedEvents=new N_,this._syncedSignals=[],this._swingAmount=0;let l=ot(kg.getDefaults(),arguments);this._ppq=l.ppq,this._clock=new ii({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=l.ppq,this.bpm.setValueAtTime(l.bpm,0),Wn(this,"bpm"),this._timeSignature=l.timeSignature,this._swingTicks=l.ppq/2}static getDefaults(){return Object.assign(wt.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(l,x){if(this._loop.get(l)&&x>=this._loopEnd&&(this.emit("loopEnd",l),this._clock.setTicksAtTime(this._loopStart,l),x=this._loopStart,this.emit("loopStart",l,this._clock.getSecondsAtTime(l)),this.emit("loop",l)),this._swingAmount>0&&x%this._ppq!=0&&x%(2*this._swingTicks)!=0){let _=x%(2*this._swingTicks)/(2*this._swingTicks),P=Math.sin(_*Math.PI)*this._swingAmount;l+=new gs(this.context,2*this._swingTicks/3).toSeconds()*P}Ty(!0),this._timeline.forEachAtTime(x,_=>_.invoke(l)),Ty(!1)}schedule(l,x){let _=new Dy(this,{callback:l,time:new dt(this.context,x).toTicks()});return this._addEvent(_,this._timeline)}scheduleRepeat(l,x,_,P=1/0){let X=new gS(this,{callback:l,duration:new He(this.context,P).toTicks(),interval:new He(this.context,x).toTicks(),time:new dt(this.context,_).toTicks()});return this._addEvent(X,this._repeatedEvents)}scheduleOnce(l,x){let _=new Dy(this,{callback:l,once:!0,time:new dt(this.context,x).toTicks()});return this._addEvent(_,this._timeline)}clear(l){if(this._scheduledEvents.hasOwnProperty(l)){let x=this._scheduledEvents[l.toString()];x.timeline.remove(x.event),x.event.dispose(),delete this._scheduledEvents[l.toString()]}return this}_addEvent(l,x){return this._scheduledEvents[l.id.toString()]={event:l,timeline:x},x.add(l),l.id}cancel(l=0){let x=this.toTicks(l);return this._timeline.forEachFrom(x,_=>this.clear(_.id)),this._repeatedEvents.forEachFrom(x,_=>this.clear(_.id)),this}_bindClockEvents(){this._clock.on("start",(l,x)=>{x=new gs(this.context,x).toSeconds(),this.emit("start",l,x)}),this._clock.on("stop",l=>{this.emit("stop",l)}),this._clock.on("pause",l=>{this.emit("pause",l)})}get state(){return this._clock.getStateAtTime(this.now())}start(l,x){let _;return this.context.resume(),mr(x)&&(_=this.toTicks(x)),this._clock.start(l,_),this}stop(l){return this._clock.stop(l),this}pause(l){return this._clock.pause(l),this}toggle(l){return l=this.toSeconds(l),this._clock.getStateAtTime(l)!=="started"?this.start(l):this.stop(l),this}get timeSignature(){return this._timeSignature}set timeSignature(l){vi(l)&&(l=l[0]/l[1]*4),this._timeSignature=l}get loopStart(){return new He(this.context,this._loopStart,"i").toSeconds()}set loopStart(l){this._loopStart=this.toTicks(l)}get loopEnd(){return new He(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(l){this._loopEnd=this.toTicks(l)}get loop(){return this._loop.get(this.now())}set loop(l){this._loop.set(l,this.now())}setLoopPoints(l,x){return this.loopStart=l,this.loopEnd=x,this}get swing(){return this._swingAmount}set swing(l){this._swingAmount=l}get swingSubdivision(){return new gs(this.context,this._swingTicks).toNotation()}set swingSubdivision(l){this._swingTicks=this.toTicks(l)}get position(){let l=this.now(),x=this._clock.getTicksAtTime(l);return new gs(this.context,x).toBarsBeatsSixteenths()}set position(l){let x=this.toTicks(l);this.ticks=x}get seconds(){return this._clock.seconds}set seconds(l){let x=this.now(),_=this._clock.frequency.timeToTicks(l,x);this.ticks=_}get progress(){if(this.loop){let l=this.now();return(this._clock.getTicksAtTime(l)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(l){if(this._clock.ticks!==l){let x=this.now();if(this.state==="started"){let _=this._clock.getTicksAtTime(x),P=x+this._clock.frequency.getDurationOfTicks(Math.ceil(_)-_,x);this.emit("stop",P),this._clock.setTicksAtTime(l,P),this.emit("start",P,this._clock.getSecondsAtTime(P))}else this.emit("ticks",x),this._clock.setTicksAtTime(l,x)}}getTicksAtTime(l){return this._clock.getTicksAtTime(l)}getSecondsAtTime(l){return this._clock.getSecondsAtTime(l)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(l){this._clock.frequency.multiplier=l}nextSubdivision(l){if(l=this.toTicks(l),this.state!=="started")return 0;{let x=this.now(),_=l-this.getTicksAtTime(x)%l;return this._clock.nextTickTime(_,x)}}syncSignal(l,x){let _=this.now(),P=this.bpm,X=1/(60/P.getValueAtTime(_)/this.PPQ),ue=[];if(l.units==="time"){let we=.015625/X,Ne=new mn(we),Oe=new bf(-1),$e=new mn(we);P.chain(Ne,Oe,$e),P=$e,X=1/X,ue=[Ne,Oe,$e]}x||(x=l.getValueAtTime(_)!==0?l.getValueAtTime(_)/X:0);let de=new mn(x);return P.connect(de),de.connect(l._param),ue.push(de),this._syncedSignals.push({initial:l.value,nodes:ue,signal:l}),l.value=0,this}unsyncSignal(l){for(let x=this._syncedSignals.length-1;x>=0;x--){let _=this._syncedSignals[x];_.signal===l&&(_.nodes.forEach(P=>P.dispose()),_.signal.value=_.initial,this._syncedSignals.splice(x,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),dh(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}fl.mixin(kg),eo($=>{$.transport=new kg({context:$})}),xf($=>{$.transport.dispose()});class zs extends kt{constructor(l){super(l),this.input=void 0,this._state=new In("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Nr,this._syncedStop=Nr,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new ml({context:this.context,mute:l.mute,volume:l.volume}),this.volume=this._volume.volume,Wn(this,"volume"),this.onstop=l.onstop}static getDefaults(){return Object.assign(kt.getDefaults(),{mute:!1,onstop:Nr,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(l){this._volume.mute=l}_clampToCurrentTime(l){return this._synced?l:Math.max(l,this.context.currentTime)}start(l,x,_){let P=la(l)&&this._synced?this.context.transport.seconds:this.toSeconds(l);if(P=this._clampToCurrentTime(P),this._synced||this._state.getValueAtTime(P)!=="started")if(this.log("start",P),this._state.setStateAtTime("started",P),this._synced){let X=this._state.get(P);X&&(X.offset=this.toSeconds(Fa(x,0)),X.duration=_?this.toSeconds(_):void 0);let ue=this.context.transport.schedule(de=>{this._start(de,x,_)},P);this._scheduled.push(ue),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>P&&this._syncedStart(this.now(),this.context.transport.seconds)}else gf(this.context),this._start(P,x,_);else Pn(ph(P,this._state.get(P).time),"Start time must be strictly greater than previous start time"),this._state.cancel(P),this._state.setStateAtTime("started",P),this.log("restart",P),this.restart(P,x,_);return this}stop(l){let x=la(l)&&this._synced?this.context.transport.seconds:this.toSeconds(l);if(x=this._clampToCurrentTime(x),this._state.getValueAtTime(x)==="started"||mr(this._state.getNextState("started",x))){if(this.log("stop",x),this._synced){let _=this.context.transport.schedule(this._stop.bind(this),x);this._scheduled.push(_)}else this._stop(x);this._state.cancel(x),this._state.setStateAtTime("stopped",x)}return this}restart(l,x,_){return l=this.toSeconds(l),this._state.getValueAtTime(l)==="started"&&(this._state.cancel(l),this._restart(l,x,_)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(l,x)=>{if(ph(x,0)){let _=this._state.get(x);if(_&&_.state==="started"&&_.time!==x){let P=x-this.toSeconds(_.time),X;_.duration&&(X=this.toSeconds(_.duration)-P),this._start(l,this.toSeconds(_.offset)+P,X)}}},this._syncedStop=l=>{let x=this.context.transport.getSecondsAtTime(Math.max(l-this.sampleTime,0));this._state.getValueAtTime(x)==="started"&&this._stop(l)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(l=>this.context.transport.clear(l)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Nr,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class fp extends Ys{constructor(){super(ot(fp.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;let l=ot(fp.getDefaults(),arguments,["url","onload"]);er(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Ut({context:this.context,param:this._source.playbackRate,units:"positive",value:l.playbackRate}),this.loop=l.loop,this.loopStart=l.loopStart,this.loopEnd=l.loopEnd,this._buffer=new Hr(l.url,l.onload,l.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Ys.getDefaults(),{url:new Hr,loop:!1,loopEnd:0,loopStart:0,onload:Nr,onerror:Nr,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(l){this._fadeIn=l}get fadeOut(){return this._fadeOut}set fadeOut(l){this._fadeOut=l}get curve(){return this._curve}set curve(l){this._curve=l}start(l,x,_,P=1){Pn(this.buffer.loaded,"buffer is either not set or not loaded");let X=this.toSeconds(l);this._startGain(X,P),x=this.loop?Fa(x,this.loopStart):Fa(x,0);let ue=Math.max(this.toSeconds(x),0);if(this.loop){let de=this.toSeconds(this.loopEnd)||this.buffer.duration,we=this.toSeconds(this.loopStart),Ne=de-we;ky(ue,de)&&(ue=(ue-we)%Ne+we),iu(ue,this.buffer.duration)&&(ue=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,yf(ue,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(X,ue)),mr(_)){let de=this.toSeconds(_);de=Math.max(de,0),this.stop(X+de)}return this}_stopSource(l){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(l)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(l){this._source.loopStart=this.toSeconds(l)}get loopEnd(){return this._source.loopEnd}set loopEnd(l){this._source.loopEnd=this.toSeconds(l)}get buffer(){return this._buffer}set buffer(l){this._buffer.set(l)}get loop(){return this._source.loop}set loop(l){this._source.loop=l,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Mc extends zs{constructor(){super(ot(Mc.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;let l=ot(Mc.getDefaults(),arguments,["type"]);this._playbackRate=l.playbackRate,this.type=l.type,this._fadeIn=l.fadeIn,this._fadeOut=l.fadeOut}static getDefaults(){return Object.assign(zs.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(l){if(Pn(l in yS,"Noise: invalid type: "+l),this._type!==l&&(this._type=l,this.state==="started")){let x=this.now();this._stop(x),this._start(x)}}get playbackRate(){return this._playbackRate}set playbackRate(l){this._playbackRate=l,this._source&&(this._source.playbackRate.value=l)}_start(l){let x=yS[this._type];this._source=new fp({url:x,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(l),Math.random()*(x.duration-.001))}_stop(l){this._source&&(this._source.stop(this.toSeconds(l)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(l){this._fadeIn=l,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(l){this._fadeOut=l,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(l){this._stop(l),this._start(l)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}let Dg=220500,Fc={brown:null,pink:null,white:null},yS={get brown(){if(!Fc.brown){let $=[];for(let l=0;l<2;l++){let x=new Float32Array(Dg);$[l]=x;let _=0;for(let P=0;P<Dg;P++){let X=2*Math.random()-1;x[P]=(_+.02*X)/1.02,_=x[P],x[P]*=3.5}}Fc.brown=new Hr().fromArray($)}return Fc.brown},get pink(){if(!Fc.pink){let $=[];for(let l=0;l<2;l++){let x=new Float32Array(Dg),_,P,X,ue,de,we,Ne;$[l]=x,_=P=X=ue=de=we=Ne=0;for(let Oe=0;Oe<Dg;Oe++){let $e=2*Math.random()-1;_=.99886*_+.0555179*$e,P=.99332*P+.0750759*$e,X=.969*X+.153852*$e,ue=.8665*ue+.3104856*$e,de=.55*de+.5329522*$e,we=-.7616*we-.016898*$e,x[Oe]=_+P+X+ue+de+we+Ne+.5362*$e,x[Oe]*=.11,Ne=.115926*$e}}Fc.pink=new Hr().fromArray($)}return Fc.pink},get white(){if(!Fc.white){let $=[];for(let l=0;l<2;l++){let x=new Float32Array(Dg);$[l]=x;for(let _=0;_<Dg;_++)x[_]=2*Math.random()-1}Fc.white=new Hr().fromArray($)}return Fc.white}};class vf extends kt{constructor(){super(ot(vf.getDefaults(),arguments,["volume"])),this.name="UserMedia";let l=ot(vf.getDefaults(),arguments,["volume"]);this._volume=this.output=new ml({context:this.context,volume:l.volume}),this.volume=this._volume.volume,Wn(this,"volume"),this.mute=l.mute}static getDefaults(){return Object.assign(kt.getDefaults(),{mute:!1,volume:0})}open(l){return To(this,void 0,void 0,function*(){Pn(vf.supported,"UserMedia is not supported"),this.state==="started"&&this.close();let x=yield vf.enumerateDevices();Ra(l)?this._device=x[l]:(this._device=x.find(X=>X.label===l||X.deviceId===l),!this._device&&x.length>0&&(this._device=x[0]),Pn(mr(this._device),`No matching device ${l}`));let _={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(_.audio.deviceId=this._device.deviceId);let P=yield navigator.mediaDevices.getUserMedia(_);if(!this._stream){this._stream=P;let X=this.context.createMediaStreamSource(P);er(X,this.output),this._mediaStream=X}return this})}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach(l=>{l.stop()}),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return To(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(l=>l.kind==="audioinput")})}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(l){this._volume.mute=l}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return mr(navigator.mediaDevices)&&mr(navigator.mediaDevices.getUserMedia)}}function wf($,l){return To(this,void 0,void 0,function*(){let x=l/$.context.sampleRate,_=new te(1,x,$.context.sampleRate);return new $.constructor(Object.assign($.get(),{frequency:2/x,detune:0,context:_})).toDestination().start(0),(yield _.render()).getChannelData(0)})}class Ag extends Ys{constructor(){super(ot(Ag.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];let l=ot(Ag.getDefaults(),arguments,["frequency","type"]);er(this._oscillator,this._gainNode),this.type=l.type,this.frequency=new Ut({context:this.context,param:this._oscillator.frequency,units:"frequency",value:l.frequency}),this.detune=new Ut({context:this.context,param:this._oscillator.detune,units:"cents",value:l.detune}),Wn(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ys.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(l){let x=this.toSeconds(l);return this.log("start",x),this._startGain(x),this._oscillator.start(x),this}_stopSource(l){this._oscillator.stop(l)}setPeriodicWave(l){return this._oscillator.setPeriodicWave(l),this}get type(){return this._oscillator.type}set type(l){this._oscillator.type=l}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}let da=(()=>{class $ extends zs{constructor(){super(ot($.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;let x=ot($.getDefaults(),arguments,["frequency","type"]);this.frequency=new Sn({context:this.context,units:"frequency",value:x.frequency}),Wn(this,"frequency"),this.detune=new Sn({context:this.context,units:"cents",value:x.detune}),Wn(this,"detune"),this._partials=x.partials,this._partialCount=x.partialCount,this._type=x.type,x.partialCount&&x.type!=="custom"&&(this._type=this.baseType+x.partialCount.toString()),this.phase=x.phase}static getDefaults(){return Object.assign(zs.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(x){let _=this.toSeconds(x),P=new Ag({context:this.context,onended:()=>this.onstop(this)});this._oscillator=P,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(_)}_stop(x){let _=this.toSeconds(x);this._oscillator&&this._oscillator.stop(_)}_restart(x){let _=this.toSeconds(x);return this.log("restart",_),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(_),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return $._periodicWaveCache.find(x=>{return x.phase===this._phase&&(_=x.partials,P=this._partials,_.length===P.length&&_.every((X,ue)=>P[ue]===X));var _,P});{let x=$._periodicWaveCache.find(_=>_.type===this._type&&_.phase===this._phase);return this._partialCount=x?x.partialCount:this._partialCount,x}}get type(){return this._type}set type(x){this._type=x;let _=["sine","square","sawtooth","triangle"].indexOf(x)!==-1;if(this._phase===0&&_)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=x);else{let P=this._getCachedPeriodicWave();if(mr(P)){let{partials:X,wave:ue}=P;this._wave=ue,this._partials=X,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{let[X,ue]=this._getRealImaginary(x,this._phase),de=this.context.createPeriodicWave(X,ue);this._wave=de,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),$._periodicWaveCache.push({imag:ue,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:X,type:this._type,wave:this._wave}),$._periodicWaveCache.length>100&&$._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(x){this.partialCount&&this._type!=="custom"&&x!=="custom"?this.type=x+this.partialCount:this.type=x}get partialCount(){return this._partialCount}set partialCount(x){wi(x,0);let _=this._type,P=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(P&&(_=P[1]),this._type!=="custom")this.type=x===0?_:_+x.toString();else{let X=new Float32Array(x);this._partials.forEach((ue,de)=>X[de]=ue),this._partials=Array.from(X),this.type=this._type}}_getRealImaginary(x,_){let P=2048,X=new Float32Array(P),ue=new Float32Array(P),de=1;if(x==="custom"){if(de=this._partials.length+1,this._partialCount=this._partials.length,P=de,this._partials.length===0)return[X,ue]}else{let we=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(x);we?(de=parseInt(we[2],10)+1,this._partialCount=parseInt(we[2],10),x=we[1],de=Math.max(de,2),P=de):this._partialCount=0,this._partials=[]}for(let we=1;we<P;++we){let Ne=2/(we*Math.PI),Oe;switch(x){case"sine":Oe=we<=de?1:0,this._partials[we-1]=Oe;break;case"square":Oe=1&we?2*Ne:0,this._partials[we-1]=Oe;break;case"sawtooth":Oe=Ne*(1&we?1:-1),this._partials[we-1]=Oe;break;case"triangle":Oe=1&we?Ne*Ne*2*(we-1>>1&1?-1:1):0,this._partials[we-1]=Oe;break;case"custom":Oe=this._partials[we-1];break;default:throw new TypeError("Oscillator: invalid type: "+x)}Oe!==0?(X[we]=-Oe*Math.sin(_*we),ue[we]=Oe*Math.cos(_*we)):(X[we]=0,ue[we]=0)}return[X,ue]}_inverseFFT(x,_,P){let X=0,ue=x.length;for(let de=0;de<ue;de++)X+=x[de]*Math.cos(de*P)+_[de]*Math.sin(de*P);return X}getInitialValue(){let[x,_]=this._getRealImaginary(this._type,0),P=0,X=2*Math.PI;for(let ue=0;ue<32;ue++)P=Math.max(this._inverseFFT(x,_,ue/32*X),P);return hp(-this._inverseFFT(x,_,this._phase)/P,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(x){this._partials=x,this._partialCount=this._partials.length,x.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(x){this._phase=x*Math.PI/180,this.type=this._type}asArray(x=1024){return To(this,void 0,void 0,function*(){return wf(this,x)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}return $._periodicWaveCache=[],$})();class Ib extends Mu{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new au({context:this.context,mapping:l=>(l+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class is extends Sn{constructor(){super(Object.assign(ot(is.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;let l=ot(is.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new mn({context:this.context,minValue:l.minValue,maxValue:l.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(l.value,0)}static getDefaults(){return Object.assign(Sn.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Og extends zs{constructor(){super(ot(Og.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new Ib({context:this.context}),this._modulationNode=new mn({context:this.context});let l=ot(Og.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new da({context:this.context,detune:l.detune,frequency:l.frequency,onstop:()=>this.onstop(this),phase:l.phase,type:l.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new da({context:this.context,phase:l.phase,type:l.modulationType}),this.harmonicity=new is({context:this.context,units:"positive",value:l.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Wn(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(da.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(l){this._modulator.start(l),this._carrier.start(l)}_stop(l){this._modulator.stop(l),this._carrier.stop(l)}_restart(l){this._modulator.restart(l),this._carrier.restart(l)}get type(){return this._carrier.type}set type(l){this._carrier.type=l}get baseType(){return this._carrier.baseType}set baseType(l){this._carrier.baseType=l}get partialCount(){return this._carrier.partialCount}set partialCount(l){this._carrier.partialCount=l}get modulationType(){return this._modulator.type}set modulationType(l){this._modulator.type=l}get phase(){return this._carrier.phase}set phase(l){this._carrier.phase=l,this._modulator.phase=l}get partials(){return this._carrier.partials}set partials(l){this._carrier.partials=l}asArray(l=1024){return To(this,void 0,void 0,function*(){return wf(this,l)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Sf extends zs{constructor(){super(ot(Sf.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new mn({context:this.context,gain:0});let l=ot(Sf.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new da({context:this.context,detune:l.detune,frequency:0,onstop:()=>this.onstop(this),phase:l.phase,type:l.type}),this.detune=this._carrier.detune,this.frequency=new Sn({context:this.context,units:"frequency",value:l.frequency}),this._modulator=new da({context:this.context,phase:l.phase,type:l.modulationType}),this.harmonicity=new is({context:this.context,units:"positive",value:l.harmonicity}),this.modulationIndex=new is({context:this.context,units:"positive",value:l.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Wn(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(da.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(l){this._modulator.start(l),this._carrier.start(l)}_stop(l){this._modulator.stop(l),this._carrier.stop(l)}_restart(l){return this._modulator.restart(l),this._carrier.restart(l),this}get type(){return this._carrier.type}set type(l){this._carrier.type=l}get baseType(){return this._carrier.baseType}set baseType(l){this._carrier.baseType=l}get partialCount(){return this._carrier.partialCount}set partialCount(l){this._carrier.partialCount=l}get modulationType(){return this._modulator.type}set modulationType(l){this._modulator.type=l}get phase(){return this._carrier.phase}set phase(l){this._carrier.phase=l,this._modulator.phase=l}get partials(){return this._carrier.partials}set partials(l){this._carrier.partials=l}asArray(l=1024){return To(this,void 0,void 0,function*(){return wf(this,l)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Cf extends zs{constructor(){super(ot(Cf.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new mn({context:this.context,gain:0}),this._thresh=new au({context:this.context,mapping:x=>x<=0?-1:1});let l=ot(Cf.getDefaults(),arguments,["frequency","width"]);this.width=new Sn({context:this.context,units:"audioRange",value:l.width}),this._triangle=new da({context:this.context,detune:l.detune,frequency:l.frequency,onstop:()=>this.onstop(this),phase:l.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Wn(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(zs.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(l){l=this.toSeconds(l),this._triangle.start(l),this._widthGate.gain.setValueAtTime(1,l)}_stop(l){l=this.toSeconds(l),this._triangle.stop(l),this._widthGate.gain.cancelScheduledValues(l),this._widthGate.gain.setValueAtTime(0,l)}_restart(l){this._triangle.restart(l),this._widthGate.gain.cancelScheduledValues(l),this._widthGate.gain.setValueAtTime(1,l)}get phase(){return this._triangle.phase}set phase(l){this._triangle.phase=l}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(l){this._triangle.type=l}asArray(l=1024){return To(this,void 0,void 0,function*(){return wf(this,l)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Rg extends zs{constructor(){super(ot(Rg.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];let l=ot(Rg.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Sn({context:this.context,units:"frequency",value:l.frequency}),this.detune=new Sn({context:this.context,units:"cents",value:l.detune}),this._spread=l.spread,this._type=l.type,this._phase=l.phase,this._partials=l.partials,this._partialCount=l.partialCount,this.count=l.count,Wn(this,["frequency","detune"])}static getDefaults(){return Object.assign(da.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(l){l=this.toSeconds(l),this._forEach(x=>x.start(l))}_stop(l){l=this.toSeconds(l),this._forEach(x=>x.stop(l))}_restart(l){this._forEach(x=>x.restart(l))}_forEach(l){for(let x=0;x<this._oscillators.length;x++)l(this._oscillators[x],x)}get type(){return this._type}set type(l){this._type=l,this._forEach(x=>x.type=l)}get spread(){return this._spread}set spread(l){if(this._spread=l,this._oscillators.length>1){let x=-l/2,_=l/(this._oscillators.length-1);this._forEach((P,X)=>P.detune.value=x+_*X)}}get count(){return this._oscillators.length}set count(l){if(wi(l,1),this._oscillators.length!==l){this._forEach(x=>x.dispose()),this._oscillators=[];for(let x=0;x<l;x++){let _=new da({context:this.context,volume:-6-1.1*l,type:this._type,phase:this._phase+x/l*360,partialCount:this._partialCount,onstop:x===0?()=>this.onstop(this):Nr});this.type==="custom"&&(_.partials=this._partials),this.frequency.connect(_.frequency),this.detune.connect(_.detune),_.detune.overridden=!1,_.connect(this.output),this._oscillators[x]=_}this.spread=this._spread,this.state==="started"&&this._forEach(x=>x.start())}}get phase(){return this._phase}set phase(l){this._phase=l,this._forEach((x,_)=>x.phase=this._phase+_/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(l){this._forEach(x=>x.baseType=l),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(l){this._partials=l,this._partialCount=this._partials.length,l.length&&(this._type="custom",this._forEach(x=>x.partials=l))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(l){this._partialCount=l,this._forEach(x=>x.partialCount=l),this._type=this._oscillators[0].type}asArray(l=1024){return To(this,void 0,void 0,function*(){return wf(this,l)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(l=>l.dispose()),this}}class Mg extends zs{constructor(){super(ot(Mg.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new is({context:this.context,value:2});let l=ot(Mg.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Cf({context:this.context,frequency:l.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new da({context:this.context,detune:l.detune,frequency:l.frequency,onstop:()=>this.onstop(this),phase:l.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Wn(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(zs.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(l){l=this.toSeconds(l),this._modulator.start(l),this._pulse.start(l)}_stop(l){l=this.toSeconds(l),this._modulator.stop(l),this._pulse.stop(l)}_restart(l){this._modulator.restart(l),this._pulse.restart(l)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(l){this._modulator.phase=l}asArray(l=1024){return To(this,void 0,void 0,function*(){return wf(this,l)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}let k_={am:Og,fat:Rg,fm:Sf,oscillator:da,pulse:Cf,pwm:Mg};class Pc extends zs{constructor(){super(ot(Pc.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";let l=ot(Pc.getDefaults(),arguments,["frequency","type"]);this.frequency=new Sn({context:this.context,units:"frequency",value:l.frequency}),this.detune=new Sn({context:this.context,units:"cents",value:l.detune}),Wn(this,["frequency","detune"]),this.set(l)}static getDefaults(){return Object.assign(da.getDefaults(),Sf.getDefaults(),Og.getDefaults(),Rg.getDefaults(),Cf.getDefaults(),Mg.getDefaults())}_start(l){this._oscillator.start(l)}_stop(l){this._oscillator.stop(l)}_restart(l){return this._oscillator.restart(l),this}get type(){let l="";return["am","fm","fat"].some(x=>this._sourceType===x)&&(l=this._sourceType),l+this._oscillator.type}set type(l){l.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=l.substr(2)):l.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=l.substr(2)):l.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=l.substr(3)):l==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):l==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=l)}get partials(){return this._oscillator.partials}set partials(l){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=l)}get partialCount(){return this._oscillator.partialCount}set partialCount(l){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=l)}set(l){return Reflect.has(l,"type")&&l.type&&(this.type=l.type),super.set(l),this}_createNewOscillator(l){if(l!==this._sourceType){this._sourceType=l;let x=k_[l],_=this.now();if(this._oscillator){let P=this._oscillator;P.stop(_),this.context.setTimeout(()=>P.dispose(),this.blockTime)}this._oscillator=new x({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(_)}}get phase(){return this._oscillator.phase}set phase(l){this._oscillator.phase=l}get sourceType(){return this._sourceType}set sourceType(l){let x="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(x=this._oscillator.type),l==="fm"?this.type="fm"+x:l==="am"?this.type="am"+x:l==="fat"?this.type="fat"+x:l==="oscillator"?this.type=x:l==="pulse"?this.type="pulse":l==="pwm"&&(this.type="pwm")}_getOscType(l,x){return l instanceof k_[x]}get baseType(){return this._oscillator.baseType}set baseType(l){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||l==="pulse"||l==="pwm"||(this._oscillator.baseType=l)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(l){this._getOscType(this._oscillator,"fat")&&Ra(l)&&(this._oscillator.count=l)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(l){this._getOscType(this._oscillator,"fat")&&Ra(l)&&(this._oscillator.spread=l)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(l){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Ma(l)&&(this._oscillator.modulationType=l)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(l=1024){return To(this,void 0,void 0,function*(){return wf(this,l)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class gl extends Sn{constructor(){super(Object.assign(ot(gl.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new mn({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,cr(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Sn.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class yl extends Mu{constructor(){super(Object.assign(ot(yl.getDefaults(),arguments,["min","max"]))),this.name="Scale";let l=ot(yl.getDefaults(),arguments,["min","max"]);this._mult=this.input=new is({context:this.context,value:l.max-l.min}),this._add=this.output=new gl({context:this.context,value:l.min}),this._min=l.min,this._max=l.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Mu.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(l){this._min=l,this._setRange()}get max(){return this._max}set max(l){this._max=l,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class _b extends Mu{constructor(){super(Object.assign(ot(_b.getDefaults(),arguments))),this.name="Zero",this._gain=new mn({context:this.context}),this.output=this._gain,this.input=void 0,er(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),kr(this.context.getConstant(0),this._gain),this}}class fa extends kt{constructor(){super(ot(fa.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Ut.prototype._fromType,this._toType=Ut.prototype._toType,this._is=Ut.prototype._is,this._clampValue=Ut.prototype._clampValue;let l=ot(fa.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new da(l),this.frequency=this._oscillator.frequency,this._amplitudeGain=new mn({context:this.context,gain:l.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Sn({context:this.context,units:"audioRange",value:0}),this._zeros=new _b({context:this.context}),this._a2g=new Ib({context:this.context}),this._scaler=this.output=new yl({context:this.context,max:l.max,min:l.min}),this.units=l.units,this.min=l.min,this.max=l.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Wn(this,["amplitude","frequency"]),this.phase=l.phase}static getDefaults(){return Object.assign(da.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(l){return l=this.toSeconds(l),this._stoppedSignal.setValueAtTime(0,l),this._oscillator.start(l),this}stop(l){return l=this.toSeconds(l),this._stoppedSignal.setValueAtTime(this._stoppedValue,l),this._oscillator.stop(l),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(l){l=this._fromType(l),this._scaler.min=l}get max(){return this._toType(this._scaler.max)}set max(l){l=this._fromType(l),this._scaler.max=l}get type(){return this._oscillator.type}set type(l){this._oscillator.type=l,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(l){this._oscillator.partials=l,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(l){this._oscillator.phase=l,this._setStoppedValue()}get units(){return this._units}set units(l){let x=this.min,_=this.max;this._units=l,this.min=x,this.max=_}get state(){return this._oscillator.state}connect(l,x,_){return(l instanceof Ut||l instanceof Sn)&&(this.convert=l.convert,this.units=l.units),Ls(this,l,x,_),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function xS($,l=1/0){let x=new WeakMap;return function(_,P){Reflect.defineProperty(_,P,{configurable:!0,enumerable:!0,get:function(){return x.get(this)},set:function(X){wi(X,$,l),x.set(this,X)}})}}function mp($,l=1/0){let x=new WeakMap;return function(_,P){Reflect.defineProperty(_,P,{configurable:!0,enumerable:!0,get:function(){return x.get(this)},set:function(X){wi(this.toSeconds(X),$,l),x.set(this,X)}})}}class If extends zs{constructor(){super(ot(If.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;let l=ot(If.getDefaults(),arguments,["url","onload"]);this._buffer=new Hr({onload:this._onload.bind(this,l.onload),onerror:l.onerror,reverse:l.reverse,url:l.url}),this.autostart=l.autostart,this._loop=l.loop,this._loopStart=l.loopStart,this._loopEnd=l.loopEnd,this._playbackRate=l.playbackRate,this.fadeIn=l.fadeIn,this.fadeOut=l.fadeOut}static getDefaults(){return Object.assign(zs.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Nr,onerror:Nr,playbackRate:1,reverse:!1})}load(l){return To(this,void 0,void 0,function*(){return yield this._buffer.load(l),this._onload(),this})}_onload(l=Nr){l(),this.autostart&&this.start()}_onSourceEnd(l){this.onstop(this),this._activeSources.delete(l),this._activeSources.size!==0||this._synced||this._state.getValueAtTime(this.now())!=="started"||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(l,x,_){return super.start(l,x,_),this}_start(l,x,_){x=this._loop?Fa(x,this._loopStart):Fa(x,0);let P=this.toSeconds(x),X=_;_=Fa(_,Math.max(this._buffer.duration-P,0));let ue=this.toSeconds(_);ue/=this._playbackRate,l=this.toSeconds(l);let de=new fp({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(l+ue),this._state.setStateAtTime("stopped",l+ue,{implicitEnd:!0})),this._activeSources.add(de),this._loop&&la(X)?de.start(l,P):de.start(l,P,ue-this.toSeconds(this.fadeOut))}_stop(l){let x=this.toSeconds(l);this._activeSources.forEach(_=>_.stop(x))}restart(l,x,_){return super.restart(l,x,_),this}_restart(l,x,_){var P;(P=[...this._activeSources].pop())===null||P===void 0||P.stop(l),this._start(l,x,_)}seek(l,x){let _=this.toSeconds(x);if(this._state.getValueAtTime(_)==="started"){let P=this.toSeconds(l);this._stop(_),this._start(_,P)}return this}setLoopPoints(l,x){return this.loopStart=l,this.loopEnd=x,this}get loopStart(){return this._loopStart}set loopStart(l){this._loopStart=l,this.buffer.loaded&&wi(this.toSeconds(l),0,this.buffer.duration),this._activeSources.forEach(x=>{x.loopStart=l})}get loopEnd(){return this._loopEnd}set loopEnd(l){this._loopEnd=l,this.buffer.loaded&&wi(this.toSeconds(l),0,this.buffer.duration),this._activeSources.forEach(x=>{x.loopEnd=l})}get buffer(){return this._buffer}set buffer(l){this._buffer.set(l)}get loop(){return this._loop}set loop(l){if(this._loop!==l&&(this._loop=l,this._activeSources.forEach(x=>{x.loop=l}),l)){let x=this._state.getNextState("stopped",this.now());x&&this._state.cancel(x.time)}}get playbackRate(){return this._playbackRate}set playbackRate(l){this._playbackRate=l;let x=this.now(),_=this._state.getNextState("stopped",x);_&&_.implicitEnd&&(this._state.cancel(_.time),this._activeSources.forEach(P=>P.cancelStop())),this._activeSources.forEach(P=>{P.playbackRate.setValueAtTime(l,x)})}get reverse(){return this._buffer.reverse}set reverse(l){this._buffer.reverse=l}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(l=>l.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}ou([mp(0)],If.prototype,"fadeIn",void 0),ou([mp(0)],If.prototype,"fadeOut",void 0);class Tb extends kt{constructor(){super(ot(Tb.getDefaults(),arguments,["urls","onload"],"urls")),this.name="Players",this.input=void 0,this._players=new Map;let l=ot(Tb.getDefaults(),arguments,["urls","onload"],"urls");this._volume=this.output=new ml({context:this.context,volume:l.volume}),this.volume=this._volume.volume,Wn(this,"volume"),this._buffers=new Rc({urls:l.urls,onload:l.onload,baseUrl:l.baseUrl,onerror:l.onerror}),this.mute=l.mute,this._fadeIn=l.fadeIn,this._fadeOut=l.fadeOut}static getDefaults(){return Object.assign(zs.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:Nr,onerror:Nr,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(l){this._volume.mute=l}get fadeIn(){return this._fadeIn}set fadeIn(l){this._fadeIn=l,this._players.forEach(x=>{x.fadeIn=l})}get fadeOut(){return this._fadeOut}set fadeOut(l){this._fadeOut=l,this._players.forEach(x=>{x.fadeOut=l})}get state(){return Array.from(this._players).some(([l,x])=>x.state==="started")?"started":"stopped"}has(l){return this._buffers.has(l)}player(l){if(Pn(this.has(l),`No Player with the name ${l} exists on this object`),!this._players.has(l)){let x=new If({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(l)}).connect(this.output);this._players.set(l,x)}return this._players.get(l)}get loaded(){return this._buffers.loaded}add(l,x,_){return Pn(!this._buffers.has(l),"A buffer with that name already exists on this object"),this._buffers.add(l,x,_),this}stopAll(l){return this._players.forEach(x=>x.stop(l)),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach(l=>l.dispose()),this._buffers.dispose(),this}}class Eb extends zs{constructor(){super(ot(Eb.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];let l=ot(Eb.getDefaults(),arguments,["url","onload"]);this.buffer=new Hr({onload:l.onload,onerror:l.onerror,reverse:l.reverse,url:l.url}),this._clock=new ii({context:this.context,callback:this._tick.bind(this),frequency:1/l.grainSize}),this._playbackRate=l.playbackRate,this._grainSize=l.grainSize,this._overlap=l.overlap,this.detune=l.detune,this.overlap=l.overlap,this.loop=l.loop,this.playbackRate=l.playbackRate,this.grainSize=l.grainSize,this.loopStart=l.loopStart,this.loopEnd=l.loopEnd,this.reverse=l.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(zs.getDefaults(),{onload:Nr,onerror:Nr,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(l,x,_){x=Fa(x,0),x=this.toSeconds(x),l=this.toSeconds(l);let P=1/this._clock.frequency.getValueAtTime(l);this._clock.start(l,x/P),_&&this.stop(l+this.toSeconds(_))}restart(l,x,_){return super.restart(l,x,_),this}_restart(l,x,_){this._stop(l),this._start(l,x,_)}_stop(l){this._clock.stop(l)}_onstop(l){this._activeSources.forEach(x=>{x.fadeOut=0,x.stop(l)}),this.onstop(this)}_tick(l){let x=this._clock.getTicksAtTime(l),_=x*this._grainSize;if(this.log("offset",_),!this.loop&&_>this.buffer.duration)return void this.stop(l);let P=_<this._overlap?0:this._overlap,X=new fp({context:this.context,url:this.buffer,fadeIn:P,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:ie(this.detune/100)}).connect(this.output);X.start(l,this._grainSize*x),X.stop(l+this._grainSize/this.playbackRate),this._activeSources.push(X),X.onended=()=>{let ue=this._activeSources.indexOf(X);ue!==-1&&this._activeSources.splice(ue,1)}}get playbackRate(){return this._playbackRate}set playbackRate(l){wi(l,.001),this._playbackRate=l,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(l){this.buffer.loaded&&wi(this.toSeconds(l),0,this.buffer.duration),this._loopStart=this.toSeconds(l)}get loopEnd(){return this._loopEnd}set loopEnd(l){this.buffer.loaded&&wi(this.toSeconds(l),0,this.buffer.duration),this._loopEnd=this.toSeconds(l)}get reverse(){return this.buffer.reverse}set reverse(l){this.buffer.reverse=l}get grainSize(){return this._grainSize}set grainSize(l){this._grainSize=this.toSeconds(l),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(l){let x=this.toSeconds(l);wi(x,0),this._overlap=x}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach(l=>l.dispose()),this}}class D_ extends Mu{constructor(){super(...arguments),this.name="Abs",this._abs=new au({context:this.context,mapping:l=>Math.abs(l)<.001?0:Math.abs(l)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class A_ extends Mu{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new au({context:this.context,mapping:l=>2*Math.abs(l)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class bS extends Mu{constructor(){super(...arguments),this.name="Negate",this._multiply=new is({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class _f extends Sn{constructor(){super(Object.assign(ot(_f.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Subtract",this._sum=new mn({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new bS({context:this.context}),this.subtrahend=this._param,cr(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(Sn.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class Nb extends Mu{constructor(){super(Object.assign(ot(Nb.getDefaults(),arguments))),this.name="GreaterThanZero",this._thresh=this.output=new au({context:this.context,length:127,mapping:l=>l<=0?0:1}),this._scale=this.input=new is({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class Ay extends Sn{constructor(){super(Object.assign(ot(Ay.getDefaults(),arguments,["value"]))),this.name="GreaterThan",this.override=!1;let l=ot(Ay.getDefaults(),arguments,["value"]);this._subtract=this.input=new _f({context:this.context,value:l.value}),this._gtz=this.output=new Nb({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,Wn(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(Sn.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class Oy extends yl{constructor(){super(Object.assign(ot(Oy.getDefaults(),arguments,["min","max","exponent"]))),this.name="ScaleExp";let l=ot(Oy.getDefaults(),arguments,["min","max","exponent"]);this.input=this._exp=new bf({context:this.context,value:l.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(yl.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(l){this._exp.value=l}dispose(){return super.dispose(),this._exp.dispose(),this}}class NO extends Sn{constructor(){super(ot(Sn.getDefaults(),arguments,["value","units"])),this.name="SyncedSignal",this.override=!1;let l=ot(Sn.getDefaults(),arguments,["value","units"]);this._lastVal=l.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new Qs({context:this.context,offset:l.value,units:l.units}).start(0),this.setValueAtTime(l.value,0)}_onTick(l){let x=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==x&&(this._lastVal=x,this._constantSource.offset.setValueAtTime(x,l))}_anchorValue(l){let x=super.getValueAtTime(this.context.transport.seconds);this._lastVal=x,this._constantSource.offset.cancelAndHoldAtTime(l),this._constantSource.offset.setValueAtTime(x,l)}getValueAtTime(l){let x=new dt(this.context,l).toSeconds();return super.getValueAtTime(x)}setValueAtTime(l,x){let _=new dt(this.context,x).toSeconds();return super.setValueAtTime(l,_),this}linearRampToValueAtTime(l,x){let _=new dt(this.context,x).toSeconds();return super.linearRampToValueAtTime(l,_),this}exponentialRampToValueAtTime(l,x){let _=new dt(this.context,x).toSeconds();return super.exponentialRampToValueAtTime(l,_),this}setTargetAtTime(l,x,_){let P=new dt(this.context,x).toSeconds();return super.setTargetAtTime(l,P,_),this}cancelScheduledValues(l){let x=new dt(this.context,l).toSeconds();return super.cancelScheduledValues(x),this}setValueCurveAtTime(l,x,_,P){let X=new dt(this.context,x).toSeconds();return _=this.toSeconds(_),super.setValueCurveAtTime(l,X,_,P),this}cancelAndHoldAtTime(l){let x=new dt(this.context,l).toSeconds();return super.cancelAndHoldAtTime(x),this}setRampPoint(l){let x=new dt(this.context,l).toSeconds();return super.setRampPoint(x),this}exponentialRampTo(l,x,_){let P=new dt(this.context,_).toSeconds();return super.exponentialRampTo(l,x,P),this}linearRampTo(l,x,_){let P=new dt(this.context,_).toSeconds();return super.linearRampTo(l,x,P),this}targetRampTo(l,x,_){let P=new dt(this.context,_).toSeconds();return super.targetRampTo(l,x,P),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class Oi extends kt{constructor(){super(ot(Oi.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Sn({context:this.context,value:0}),this.output=this._sig,this.input=void 0;let l=ot(Oi.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=l.attack,this.decay=l.decay,this.sustain=l.sustain,this.release=l.release,this.attackCurve=l.attackCurve,this.releaseCurve=l.releaseCurve,this.decayCurve=l.decayCurve}static getDefaults(){return Object.assign(kt.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(l,x){if(Ma(l))return l;{let _;for(_ in kb)if(kb[_][x]===l)return _;return l}}_setCurve(l,x,_){if(Ma(_)&&Reflect.has(kb,_)){let P=kb[_];kc(P)?l!=="_decayCurve"&&(this[l]=P[x]):this[l]=P}else{if(!vi(_)||l==="_decayCurve")throw new Error("Envelope: invalid curve: "+_);this[l]=_}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(l){this._setCurve("_attackCurve","In",l)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(l){this._setCurve("_releaseCurve","Out",l)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(l){this._setCurve("_decayCurve","Out",l)}triggerAttack(l,x=1){this.log("triggerAttack",l,x),l=this.toSeconds(l);let _=this.toSeconds(this.attack),P=this.toSeconds(this.decay),X=this.getValueAtTime(l);if(X>0&&(_=(1-X)/(1/_)),_<this.sampleTime)this._sig.cancelScheduledValues(l),this._sig.setValueAtTime(x,l);else if(this._attackCurve==="linear")this._sig.linearRampTo(x,_,l);else if(this._attackCurve==="exponential")this._sig.targetRampTo(x,_,l);else{this._sig.cancelAndHoldAtTime(l);let ue=this._attackCurve;for(let de=1;de<ue.length;de++)if(ue[de-1]<=X&&X<=ue[de]){ue=this._attackCurve.slice(de),ue[0]=X;break}this._sig.setValueCurveAtTime(ue,l,_,x)}if(P&&this.sustain<1){let ue=x*this.sustain,de=l+_;this.log("decay",de),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(ue,P+de):this._sig.exponentialApproachValueAtTime(ue,de,P)}return this}triggerRelease(l){this.log("triggerRelease",l),l=this.toSeconds(l);let x=this.getValueAtTime(l);if(x>0){let _=this.toSeconds(this.release);_<this.sampleTime?this._sig.setValueAtTime(0,l):this._releaseCurve==="linear"?this._sig.linearRampTo(0,_,l):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,_,l):(Pn(vi(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(l),this._sig.setValueCurveAtTime(this._releaseCurve,l,_,x))}return this}getValueAtTime(l){return this._sig.getValueAtTime(l)}triggerAttackRelease(l,x,_=1){return x=this.toSeconds(x),this.triggerAttack(x,_),this.triggerRelease(x+this.toSeconds(l)),this}cancel(l){return this._sig.cancelScheduledValues(this.toSeconds(l)),this}connect(l,x=0,_=0){return Ls(this,l,x,_),this}asArray(l=1024){return To(this,void 0,void 0,function*(){let x=l/this.context.sampleRate,_=new te(1,x,this.context.sampleRate),P=this.toSeconds(this.attack)+this.toSeconds(this.decay),X=P+this.toSeconds(this.release),ue=.1*X,de=X+ue,we=new this.constructor(Object.assign(this.get(),{attack:x*this.toSeconds(this.attack)/de,decay:x*this.toSeconds(this.decay)/de,release:x*this.toSeconds(this.release)/de,context:_}));return we._sig.toDestination(),we.triggerAttackRelease(x*(P+ue)/de,0),(yield _.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}ou([mp(0)],Oi.prototype,"attack",void 0),ou([mp(0)],Oi.prototype,"decay",void 0),ou([xS(0,1)],Oi.prototype,"sustain",void 0),ou([mp(0)],Oi.prototype,"release",void 0);let kb=(()=>{let l,x,_=[];for(l=0;l<128;l++)_[l]=Math.sin(l/127*(Math.PI/2));let P=[];for(l=0;l<127;l++){x=l/127;let Oe=Math.sin(x*(2*Math.PI)*6.4-Math.PI/2)+1;P[l]=Oe/10+.83*x}P[127]=1;let X=[];for(l=0;l<128;l++)X[l]=Math.ceil(l/127*5)/5;let ue=[];for(l=0;l<128;l++)x=l/127,ue[l]=.5*(1-Math.cos(Math.PI*x));let de=[];for(l=0;l<128;l++){x=l/127;let Oe=4*Math.pow(x,3)+.2,$e=Math.cos(Oe*Math.PI*2*x);de[l]=Math.abs($e*(1-x))}function we(Oe){let $e=new Array(Oe.length);for(let et=0;et<Oe.length;et++)$e[et]=1-Oe[et];return $e}return{bounce:{In:we(de),Out:de},cosine:{In:_,Out:(Ne=_,Ne.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:P,Out:we(P)},sine:{In:ue,Out:we(ue)},step:{In:X,Out:we(X)}};var Ne})();class Fu extends kt{constructor(){super(ot(Fu.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=x=>this._original_triggerRelease(x);let l=ot(Fu.getDefaults(),arguments);this._volume=this.output=new ml({context:this.context,volume:l.volume}),this.volume=this._volume.volume,Wn(this,"volume")}static getDefaults(){return Object.assign(kt.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let l=!1;return this._synced||(this._synced=!0,l=!0),l}_syncMethod(l,x){let _=this["_original_"+l]=this[l];this[l]=(...P)=>{let X=P[x],ue=this.context.transport.schedule(de=>{P[x]=de,_.apply(this,P)},X);this._scheduledEvents.push(ue)}}unsync(){return this._scheduledEvents.forEach(l=>this.context.transport.clear(l)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(l,x,_,P){let X=this.toSeconds(_),ue=this.toSeconds(x);return this.triggerAttack(l,X,P),this.triggerRelease(X+ue),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Ri extends Fu{constructor(){super(ot(Ri.getDefaults(),arguments));let l=ot(Ri.getDefaults(),arguments);this.portamento=l.portamento,this.onsilence=l.onsilence}static getDefaults(){return Object.assign(Fu.getDefaults(),{detune:0,onsilence:Nr,portamento:0})}triggerAttack(l,x,_=1){this.log("triggerAttack",l,x,_);let P=this.toSeconds(x);return this._triggerEnvelopeAttack(P,_),this.setNote(l,P),this}triggerRelease(l){this.log("triggerRelease",l);let x=this.toSeconds(l);return this._triggerEnvelopeRelease(x),this}setNote(l,x){let _=this.toSeconds(x),P=l instanceof Je?l.toFrequency():l;if(this.portamento>0&&this.getLevelAtTime(_)>.05){let X=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(P,X,_)}else this.frequency.setValueAtTime(P,_);return this}}ou([mp(0)],Ri.prototype,"portamento",void 0);class Fg extends Oi{constructor(){super(ot(Fg.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new mn({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class gp extends Ri{constructor(){super(ot(gp.getDefaults(),arguments)),this.name="Synth";let l=ot(gp.getDefaults(),arguments);this.oscillator=new Pc(Object.assign({context:this.context,detune:l.detune,onstop:()=>this.onsilence(this)},l.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Fg(Object.assign({context:this.context},l.envelope)),this.oscillator.chain(this.envelope,this.output),Wn(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Ri.getDefaults(),{envelope:Object.assign(oi(Oi.getDefaults(),Object.keys(kt.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(oi(Pc.getDefaults(),[...Object.keys(zs.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(l,x){if(this.envelope.triggerAttack(l,x),this.oscillator.start(l),this.envelope.sustain===0){let _=this.toSeconds(this.envelope.attack),P=this.toSeconds(this.envelope.decay);this.oscillator.stop(l+_+P)}}_triggerEnvelopeRelease(l){this.envelope.triggerRelease(l),this.oscillator.stop(l+this.toSeconds(this.envelope.release))}getLevelAtTime(l){return l=this.toSeconds(l),this.envelope.getValueAtTime(l)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Tf extends Ri{constructor(){super(ot(Tf.getDefaults(),arguments)),this.name="ModulationSynth";let l=ot(Tf.getDefaults(),arguments);this._carrier=new gp({context:this.context,oscillator:l.oscillator,envelope:l.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new gp({context:this.context,oscillator:l.modulation,envelope:l.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new Sn({context:this.context,units:"frequency"}),this.detune=new Sn({context:this.context,value:l.detune,units:"cents"}),this.harmonicity=new is({context:this.context,value:l.harmonicity,minValue:0}),this._modulationNode=new mn({context:this.context,gain:0}),Wn(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(Ri.getDefaults(),{harmonicity:3,oscillator:Object.assign(oi(Pc.getDefaults(),[...Object.keys(zs.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(oi(Oi.getDefaults(),Object.keys(kt.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(oi(Pc.getDefaults(),[...Object.keys(zs.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(oi(Oi.getDefaults(),Object.keys(kt.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(l,x){this._carrier._triggerEnvelopeAttack(l,x),this._modulator._triggerEnvelopeAttack(l,x)}_triggerEnvelopeRelease(l){return this._carrier._triggerEnvelopeRelease(l),this._modulator._triggerEnvelopeRelease(l),this}getLevelAtTime(l){return l=this.toSeconds(l),this.envelope.getValueAtTime(l)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class vS extends Tf{constructor(){super(ot(vS.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new Ib({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class Pg extends kt{constructor(){super(ot(Pg.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";let l=ot(Pg.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Ut({context:this.context,units:"number",value:l.Q,param:this._filter.Q}),this.frequency=new Ut({context:this.context,units:"frequency",value:l.frequency,param:this._filter.frequency}),this.detune=new Ut({context:this.context,units:"cents",value:l.detune,param:this._filter.detune}),this.gain=new Ut({context:this.context,units:"decibels",convert:!1,value:l.gain,param:this._filter.gain}),this.type=l.type}static getDefaults(){return Object.assign(kt.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(l){Pn(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(l)!==-1,`Invalid filter type: ${l}`),this._filter.type=l}getFrequencyResponse(l=128){let x=new Float32Array(l);for(let ue=0;ue<l;ue++){let de=19980*Math.pow(ue/l,2)+20;x[ue]=de}let _=new Float32Array(l),P=new Float32Array(l),X=this.context.createBiquadFilter();return X.type=this.type,X.Q.value=this.Q.value,X.frequency.value=this.frequency.value,X.gain.value=this.gain.value,X.getFrequencyResponse(x,_,P),_}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class uu extends kt{constructor(){super(ot(uu.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new mn({context:this.context}),this.output=new mn({context:this.context}),this._filters=[];let l=ot(uu.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new Sn({context:this.context,units:"positive",value:l.Q}),this.frequency=new Sn({context:this.context,units:"frequency",value:l.frequency}),this.detune=new Sn({context:this.context,units:"cents",value:l.detune}),this.gain=new Sn({context:this.context,units:"decibels",convert:!1,value:l.gain}),this._type=l.type,this.rolloff=l.rolloff,Wn(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(kt.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(l){Pn(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(l)!==-1,`Invalid filter type: ${l}`),this._type=l,this._filters.forEach(x=>x.type=l)}get rolloff(){return this._rolloff}set rolloff(l){let x=Ra(l)?l:parseInt(l,10),_=[-12,-24,-48,-96],P=_.indexOf(x);Pn(P!==-1,`rolloff can only be ${_.join(", ")}`),P+=1,this._rolloff=x,this.input.disconnect(),this._filters.forEach(X=>X.disconnect()),this._filters=new Array(P);for(let X=0;X<P;X++){let ue=new Pg({context:this.context});ue.type=this._type,this.frequency.connect(ue.frequency),this.detune.connect(ue.detune),this.Q.connect(ue.Q),this.gain.connect(ue.gain),this._filters[X]=ue}this._internalChannels=this._filters,cr(this.input,...this._internalChannels,this.output)}getFrequencyResponse(l=128){let x=new Pg({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),_=new Float32Array(l).map(()=>1);return this._filters.forEach(()=>{x.getFrequencyResponse(l).forEach((P,X)=>_[X]*=P)}),x.dispose(),_}dispose(){return super.dispose(),this._filters.forEach(l=>{l.dispose()}),dh(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class $g extends Oi{constructor(){super(ot($g.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";let l=ot($g.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=l.octaves,this._baseFrequency=this.toFrequency(l.baseFrequency),this._exponent=this.input=new bf({context:this.context,value:l.exponent}),this._scale=this.output=new yl({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Oi.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(l){let x=this.toFrequency(l);wi(x,0),this._baseFrequency=x,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(l){this._octaves=l,this._scale.max=this._baseFrequency*Math.pow(2,l)}get exponent(){return this._exponent.value}set exponent(l){this._exponent.value=l}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class mh extends Ri{constructor(){super(ot(mh.getDefaults(),arguments)),this.name="MonoSynth";let l=ot(mh.getDefaults(),arguments);this.oscillator=new Pc(Object.assign(l.oscillator,{context:this.context,detune:l.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new uu(Object.assign(l.filter,{context:this.context})),this.filterEnvelope=new $g(Object.assign(l.filterEnvelope,{context:this.context})),this.envelope=new Fg(Object.assign(l.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),Wn(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(Ri.getDefaults(),{envelope:Object.assign(oi(Oi.getDefaults(),Object.keys(kt.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(oi(uu.getDefaults(),Object.keys(kt.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(oi($g.getDefaults(),Object.keys(kt.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(oi(Pc.getDefaults(),Object.keys(zs.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(l,x=1){if(this.envelope.triggerAttack(l,x),this.filterEnvelope.triggerAttack(l),this.oscillator.start(l),this.envelope.sustain===0){let _=this.toSeconds(this.envelope.attack),P=this.toSeconds(this.envelope.decay);this.oscillator.stop(l+_+P)}}_triggerEnvelopeRelease(l){this.envelope.triggerRelease(l),this.filterEnvelope.triggerRelease(l),this.oscillator.stop(l+this.toSeconds(this.envelope.release))}getLevelAtTime(l){return l=this.toSeconds(l),this.envelope.getValueAtTime(l)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class Db extends Ri{constructor(){super(ot(Db.getDefaults(),arguments)),this.name="DuoSynth";let l=ot(Db.getDefaults(),arguments);this.voice0=new mh(Object.assign(l.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new mh(Object.assign(l.voice1,{context:this.context})),this.harmonicity=new is({context:this.context,units:"positive",value:l.harmonicity}),this._vibrato=new fa({frequency:l.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new mn({context:this.context,units:"normalRange",gain:l.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new Sn({context:this.context,units:"frequency",value:440}),this.detune=new Sn({context:this.context,units:"cents",value:l.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),Wn(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(l){return l=this.toSeconds(l),this.voice0.envelope.getValueAtTime(l)+this.voice1.envelope.getValueAtTime(l)}static getDefaults(){return su(Ri.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:su(oi(mh.getDefaults(),Object.keys(Ri.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:su(oi(mh.getDefaults(),Object.keys(Ri.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(l,x){this.voice0._triggerEnvelopeAttack(l,x),this.voice1._triggerEnvelopeAttack(l,x)}_triggerEnvelopeRelease(l){return this.voice0._triggerEnvelopeRelease(l),this.voice1._triggerEnvelopeRelease(l),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class Ab extends Tf{constructor(){super(ot(Ab.getDefaults(),arguments)),this.name="FMSynth";let l=ot(Ab.getDefaults(),arguments);this.modulationIndex=new is({context:this.context,value:l.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(Tf.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}let O_=[1,1.483,1.932,2.546,2.63,3.897];class Ob extends Ri{constructor(){super(ot(Ob.getDefaults(),arguments)),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];let l=ot(Ob.getDefaults(),arguments);this.detune=new Sn({context:this.context,units:"cents",value:l.detune}),this.frequency=new Sn({context:this.context,units:"frequency"}),this._amplitude=new mn({context:this.context,gain:0}).connect(this.output),this._highpass=new uu({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let x=0;x<O_.length;x++){let _=new Sf({context:this.context,harmonicity:l.harmonicity,modulationIndex:l.modulationIndex,modulationType:"square",onstop:x===0?()=>this.onsilence(this):Nr,type:"square"});_.connect(this._highpass),this._oscillators[x]=_;let P=new is({context:this.context,value:O_[x]});this._freqMultipliers[x]=P,this.frequency.chain(P,_.frequency),this.detune.connect(_.detune)}this._filterFreqScaler=new yl({context:this.context,max:7e3,min:this.toFrequency(l.resonance)}),this.envelope=new Oi({attack:l.envelope.attack,attackCurve:"linear",context:this.context,decay:l.envelope.decay,release:l.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=l.octaves,this.octaves=l.octaves}static getDefaults(){return su(Ri.getDefaults(),{envelope:Object.assign(oi(Oi.getDefaults(),Object.keys(kt.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(l,x=1){return this.envelope.triggerAttack(l,x),this._oscillators.forEach(_=>_.start(l)),this.envelope.sustain===0&&this._oscillators.forEach(_=>{_.stop(l+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(l){return this.envelope.triggerRelease(l),this._oscillators.forEach(x=>x.stop(l+this.toSeconds(this.envelope.release))),this}getLevelAtTime(l){return l=this.toSeconds(l),this.envelope.getValueAtTime(l)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(l){this._oscillators.forEach(x=>x.modulationIndex.value=l)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(l){this._oscillators.forEach(x=>x.harmonicity.value=l)}get resonance(){return this._filterFreqScaler.min}set resonance(l){this._filterFreqScaler.min=this.toFrequency(l),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(l){this._octaves=l,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,l)}dispose(){return super.dispose(),this._oscillators.forEach(l=>l.dispose()),this._freqMultipliers.forEach(l=>l.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class Lg extends gp{constructor(){super(ot(Lg.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;let l=ot(Lg.getDefaults(),arguments);this.pitchDecay=l.pitchDecay,this.octaves=l.octaves,Wn(this,["oscillator","envelope"])}static getDefaults(){return su(Ri.getDefaults(),gp.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(l,x){let _=this.toSeconds(x),P=this.toFrequency(l instanceof Je?l.toFrequency():l),X=P*this.octaves;return this.oscillator.frequency.setValueAtTime(X,_),this.oscillator.frequency.exponentialRampToValueAtTime(P,_+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}ou([xS(0)],Lg.prototype,"octaves",void 0),ou([mp(0)],Lg.prototype,"pitchDecay",void 0);class Rb extends Fu{constructor(){super(ot(Rb.getDefaults(),arguments)),this.name="NoiseSynth";let l=ot(Rb.getDefaults(),arguments);this.noise=new Mc(Object.assign({context:this.context},l.noise)),this.envelope=new Fg(Object.assign({context:this.context},l.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Fu.getDefaults(),{envelope:Object.assign(oi(Oi.getDefaults(),Object.keys(kt.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(oi(Mc.getDefaults(),Object.keys(zs.getDefaults())),{type:"white"})})}triggerAttack(l,x=1){return l=this.toSeconds(l),this.envelope.triggerAttack(l,x),this.noise.start(l),this.envelope.sustain===0&&this.noise.stop(l+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(l){return l=this.toSeconds(l),this.envelope.triggerRelease(l),this.noise.stop(l+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(l,x,_=1){return x=this.toSeconds(x),l=this.toSeconds(l),this.triggerAttack(x,_),this.triggerRelease(x+l),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}let wS=new Set;function SS($){wS.add($)}function R_($,l){let x=`registerProcessor("${$}", ${l})`;wS.add(x)}class CS extends kt{constructor(l){super(l),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=Nr;let x=URL.createObjectURL(new Blob([Array.from(wS).join(`
`)],{type:"text/javascript"})),_=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(x).then(()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(_,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))})}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}SS(`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`),SS(`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`),SS(`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`);let M_="feedback-comb-filter";R_(M_,`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`);class Bg extends CS{constructor(){super(ot(Bg.getDefaults(),arguments,["delayTime","resonance"])),this.name="FeedbackCombFilter";let l=ot(Bg.getDefaults(),arguments,["delayTime","resonance"]);this.input=new mn({context:this.context}),this.output=new mn({context:this.context}),this.delayTime=new Ut({context:this.context,value:l.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new Ut({context:this.context,value:l.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),Wn(this,["resonance","delayTime"])}_audioWorkletName(){return M_}static getDefaults(){return Object.assign(kt.getDefaults(),{delayTime:.1,resonance:.5})}onReady(l){cr(this.input,l,this.output);let x=l.parameters.get("delayTime");this.delayTime.setParam(x);let _=l.parameters.get("feedback");this.resonance.setParam(_)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class zg extends kt{constructor(){super(ot(zg.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";let l=ot(zg.getDefaults(),arguments,["frequency","type"]);this._frequency=l.frequency,this._type=l.type,this.input=new mn({context:this.context}),this.output=new mn({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(kt.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){let l=this._filter,x=this.toFrequency(this._frequency),_=1/(2*Math.PI*x);if(this._type==="lowpass"){let P=1/(_*this.context.sampleRate),X=P-1;this._filter=this.context.createIIRFilter([P,0],[1,X])}else{let P=1/(_*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,P])}this.input.chain(this._filter,this.output),l&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(l),l.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(l){this._frequency=l,this._createFilter()}get type(){return this._type}set type(l){this._type=l,this._createFilter()}getFrequencyResponse(l=128){let x=new Float32Array(l);for(let X=0;X<l;X++){let ue=19980*Math.pow(X/l,2)+20;x[X]=ue}let _=new Float32Array(l),P=new Float32Array(l);return this._filter.getFrequencyResponse(x,_,P),_}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class Vg extends kt{constructor(){super(ot(Vg.getDefaults(),arguments,["delayTime","resonance","dampening"])),this.name="LowpassCombFilter";let l=ot(Vg.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new Bg({context:this.context,delayTime:l.delayTime,resonance:l.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new zg({context:this.context,frequency:l.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(kt.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(l){this._lowpass.frequency=l}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class Mb extends Fu{constructor(){super(ot(Mb.getDefaults(),arguments)),this.name="PluckSynth";let l=ot(Mb.getDefaults(),arguments);this._noise=new Mc({context:this.context,type:"pink"}),this.attackNoise=l.attackNoise,this._lfcf=new Vg({context:this.context,dampening:l.dampening,resonance:l.resonance}),this.resonance=l.resonance,this.release=l.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return su(Fu.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(l){this._lfcf.dampening=l}triggerAttack(l,x){let _=this.toFrequency(l);x=this.toSeconds(x);let P=1/_;return this._lfcf.delayTime.setValueAtTime(P,x),this._noise.start(x),this._noise.stop(x+P*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(x),this._lfcf.resonance.setValueAtTime(this.resonance,x),this}triggerRelease(l){return this._lfcf.resonance.linearRampTo(0,this.release,l),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class Fb extends Fu{constructor(){super(ot(Fb.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=P=>this.releaseAll(P);let l=ot(Fb.getDefaults(),arguments,["voice","options"]);Pn(!Ra(l.voice),"DEPRECATED: The polyphony count is no longer the first argument.");let x=l.voice.getDefaults();this.options=Object.assign(x,l.options),this.voice=l.voice,this.maxPolyphony=l.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();let _=this._voices.indexOf(this._dummyVoice);this._voices.splice(_,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Fu.getDefaults(),{maxPolyphony:32,options:{},voice:gp})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(l){this._availableVoices.push(l);let x=this._activeVoices.findIndex(_=>_.voice===l);this._activeVoices.splice(x,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){let l=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return Pn(l instanceof Ri,"Voice must extend Monophonic class"),l.connect(this.output),this._voices.push(l),l}ch("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){let l=this._availableVoices.shift(),x=this._voices.indexOf(l);this._voices.splice(x,1),this.context.isOffline||l.dispose()}}_triggerAttack(l,x,_){l.forEach(P=>{let X=new fh(this.context,P).toMidi(),ue=this._getNextAvailableVoice();ue&&(ue.triggerAttack(P,x,_),this._activeVoices.push({midi:X,voice:ue,released:!1}),this.log("triggerAttack",P,x))})}_triggerRelease(l,x){l.forEach(_=>{let P=new fh(this.context,_).toMidi(),X=this._activeVoices.find(({midi:ue,released:de})=>ue===P&&!de);X&&(X.voice.triggerRelease(x),X.released=!0,this.log("triggerRelease",_,x))})}_scheduleEvent(l,x,_,P){Pn(!this.disposed,"Synth was already disposed"),_<=this.now()?l==="attack"?this._triggerAttack(x,_,P):this._triggerRelease(x,_):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(l,x,_,P)},_-this.now())}triggerAttack(l,x,_){Array.isArray(l)||(l=[l]);let P=this.toSeconds(x);return this._scheduleEvent("attack",l,P,_),this}triggerRelease(l,x){Array.isArray(l)||(l=[l]);let _=this.toSeconds(x);return this._scheduleEvent("release",l,_),this}triggerAttackRelease(l,x,_,P){let X=this.toSeconds(_);if(this.triggerAttack(l,X,P),vi(x)){Pn(vi(l),"If the duration is an array, the notes must also be an array");for(let ue=0;ue<l.length;ue++){let de=x[Math.min(ue,x.length-1)],we=this.toSeconds(de);Pn(we>0,"The duration must be greater than 0"),this.triggerRelease(l[ue],X+we)}}else{let ue=this.toSeconds(x);Pn(ue>0,"The duration must be greater than 0"),this.triggerRelease(l,X+ue)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(l){let x=oi(l,["onsilence","context"]);return this.options=su(this.options,x),this._voices.forEach(_=>_.set(x)),this._dummyVoice.set(x),this}get(){return this._dummyVoice.get()}releaseAll(l){let x=this.toSeconds(l);return this._activeVoices.forEach(({voice:_})=>{_.triggerRelease(x)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(l=>l.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Ef extends Fu{constructor(){super(ot(Ef.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;let l=ot(Ef.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),x={};Object.keys(l.urls).forEach(_=>{let P=parseInt(_,10);if(Pn(uh(_)||Ra(P)&&isFinite(P),`url key is neither a note or midi pitch: ${_}`),uh(_)){let X=new Je(this.context,_).toMidi();x[X]=l.urls[_]}else Ra(P)&&isFinite(P)&&(x[P]=l.urls[P])}),this._buffers=new Rc({urls:x,onload:l.onload,baseUrl:l.baseUrl,onerror:l.onerror}),this.attack=l.attack,this.release=l.release,this.curve=l.curve,this._buffers.loaded&&Promise.resolve().then(l.onload)}static getDefaults(){return Object.assign(Fu.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Nr,onerror:Nr,release:.1,urls:{}})}_findClosest(l){let x=0;for(;x<96;){if(this._buffers.has(l+x))return-x;if(this._buffers.has(l-x))return x;x++}throw new Error(`No available buffers for note: ${l}`)}triggerAttack(l,x,_=1){return this.log("triggerAttack",l,x,_),Array.isArray(l)||(l=[l]),l.forEach(P=>{let X=Ue(new Je(this.context,P).toFrequency()),ue=Math.round(X),de=X-ue,we=this._findClosest(ue),Ne=ue-we,Oe=this._buffers.get(Ne),$e=ie(we+de),et=new fp({url:Oe,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:$e}).connect(this.output);et.start(x,0,Oe.duration/$e,_),vi(this._activeSources.get(ue))||this._activeSources.set(ue,[]),this._activeSources.get(ue).push(et),et.onended=()=>{if(this._activeSources&&this._activeSources.has(ue)){let Xe=this._activeSources.get(ue),ct=Xe.indexOf(et);ct!==-1&&Xe.splice(ct,1)}}}),this}triggerRelease(l,x){return this.log("triggerRelease",l,x),Array.isArray(l)||(l=[l]),l.forEach(_=>{let P=new Je(this.context,_).toMidi();if(this._activeSources.has(P)&&this._activeSources.get(P).length){let X=this._activeSources.get(P);x=this.toSeconds(x),X.forEach(ue=>{ue.stop(x)}),this._activeSources.set(P,[])}}),this}releaseAll(l){let x=this.toSeconds(l);return this._activeSources.forEach(_=>{for(;_.length;)_.shift().stop(x)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(l,x,_,P=1){let X=this.toSeconds(_);return this.triggerAttack(l,X,P),vi(x)?(Pn(vi(l),"notes must be an array when duration is array"),l.forEach((ue,de)=>{let we=x[Math.min(de,x.length-1)];this.triggerRelease(ue,X+this.toSeconds(we))})):this.triggerRelease(l,X+this.toSeconds(x)),this}add(l,x,_){if(Pn(uh(l)||isFinite(l),`note must be a pitch or midi: ${l}`),uh(l)){let P=new Je(this.context,l).toMidi();this._buffers.add(P,x,_)}else this._buffers.add(l,x,_);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(l=>{l.forEach(x=>x.dispose())}),this._activeSources.clear(),this}}ou([mp(0)],Ef.prototype,"attack",void 0),ou([mp(0)],Ef.prototype,"release",void 0);class $c extends wt{constructor(){super(ot($c.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new In("stopped"),this._startOffset=0;let l=ot($c.getDefaults(),arguments,["callback","value"]);this._loop=l.loop,this.callback=l.callback,this.value=l.value,this._loopStart=this.toTicks(l.loopStart),this._loopEnd=this.toTicks(l.loopEnd),this._playbackRate=l.playbackRate,this._probability=l.probability,this._humanize=l.humanize,this.mute=l.mute,this._playbackRate=l.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(wt.getDefaults(),{callback:Nr,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(l=-1){this._state.forEachFrom(l,x=>{let _;if(x.state==="started"){x.id!==-1&&this.context.transport.clear(x.id);let P=x.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||Ra(this._loop)&&this._loop>1){_=1/0,Ra(this._loop)&&(_=this._loop*this._getLoopDuration());let X=this._state.getAfter(P);X!==null&&(_=Math.min(_,X.time-P)),_!==1/0&&(_=new gs(this.context,_));let ue=new gs(this.context,this._getLoopDuration());x.id=this.context.transport.scheduleRepeat(this._tick.bind(this),ue,new gs(this.context,P),_)}else x.id=this.context.transport.schedule(this._tick.bind(this),new gs(this.context,P))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(l){this._startOffset=l}get probability(){return this._probability}set probability(l){this._probability=l}get humanize(){return this._humanize}set humanize(l){this._humanize=l}start(l){let x=this.toTicks(l);return this._state.getValueAtTime(x)==="stopped"&&(this._state.add({id:-1,state:"started",time:x}),this._rescheduleEvents(x)),this}stop(l){this.cancel(l);let x=this.toTicks(l);if(this._state.getValueAtTime(x)==="started"){this._state.setStateAtTime("stopped",x,{id:-1});let _=this._state.getBefore(x),P=x;_!==null&&(P=_.time),this._rescheduleEvents(P)}return this}cancel(l){l=Fa(l,-1/0);let x=this.toTicks(l);return this._state.forEachFrom(x,_=>{this.context.transport.clear(_.id)}),this._state.cancel(x),this}_tick(l){let x=this.context.transport.getTicksAtTime(l);if(!this.mute&&this._state.getValueAtTime(x)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let _=.02;ll(this.humanize)||(_=this.toSeconds(this.humanize)),l+=(2*Math.random()-1)*_}this.callback(l,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(l){this._loop=l,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(l){this._playbackRate=l,this._rescheduleEvents()}get loopEnd(){return new gs(this.context,this._loopEnd).toSeconds()}set loopEnd(l){this._loopEnd=this.toTicks(l),this._loop&&this._rescheduleEvents()}get loopStart(){return new gs(this.context,this._loopStart).toSeconds()}set loopStart(l){this._loopStart=this.toTicks(l),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){let l=this.context.transport.ticks,x=this._state.get(l);if(x!==null&&x.state==="started"){let _=this._getLoopDuration();return(l-x.time)%_/_}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class jg extends wt{constructor(){super(ot(jg.getDefaults(),arguments,["callback","interval"])),this.name="Loop";let l=ot(jg.getDefaults(),arguments,["callback","interval"]);this._event=new $c({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:l.interval,playbackRate:l.playbackRate,probability:l.probability,humanize:l.humanize}),this.callback=l.callback,this.iterations=l.iterations}static getDefaults(){return Object.assign(wt.getDefaults(),{interval:"4n",callback:Nr,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(l){return this._event.start(l),this}stop(l){return this._event.stop(l),this}cancel(l){return this._event.cancel(l),this}_tick(l){this.callback(l)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(l){this._event.loopEnd=l}get playbackRate(){return this._event.playbackRate}set playbackRate(l){this._event.playbackRate=l}get humanize(){return this._event.humanize}set humanize(l){this._event.humanize=l}get probability(){return this._event.probability}set probability(l){this._event.probability=l}get mute(){return this._event.mute}set mute(l){this._event.mute=l}get iterations(){return this._event.loop===!0?1/0:this._event.loop}set iterations(l){this._event.loop=l===1/0||l}dispose(){return super.dispose(),this._event.dispose(),this}}class Nf extends $c{constructor(){super(ot(Nf.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new In("stopped"),this._events=new Set;let l=ot(Nf.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,l.events.forEach(x=>{vi(x)?this.add(x[0],x[1]):this.add(x)})}static getDefaults(){return Object.assign($c.getDefaults(),{events:[]})}start(l,x){let _=this.toTicks(l);if(this._state.getValueAtTime(_)!=="started"){x=Fa(x,this._loop?this._loopStart:0),x=this._loop?Fa(x,this._loopStart):Fa(x,0);let P=this.toTicks(x);this._state.add({id:-1,offset:P,state:"started",time:_}),this._forEach(X=>{this._startNote(X,_,P)})}return this}_startNote(l,x,_){x-=_,this._loop?l.startOffset>=this._loopStart&&l.startOffset<this._loopEnd?(l.startOffset<_&&(x+=this._getLoopDuration()),l.start(new gs(this.context,x))):l.startOffset<this._loopStart&&l.startOffset>=_&&(l.loop=!1,l.start(new gs(this.context,x))):l.startOffset>=_&&l.start(new gs(this.context,x))}get startOffset(){return this._startOffset}set startOffset(l){this._startOffset=l,this._forEach(x=>{x.startOffset+=this._startOffset})}stop(l){let x=this.toTicks(l);return this._state.cancel(x),this._state.setStateAtTime("stopped",x),this._forEach(_=>{_.stop(l)}),this}at(l,x){let _=new dt(this.context,l).toTicks(),P=new gs(this.context,1).toSeconds(),X=this._events.values(),ue=X.next();for(;!ue.done;){let de=ue.value;if(Math.abs(_-de.startOffset)<P)return mr(x)&&(de.value=x),de;ue=X.next()}return mr(x)?(this.add(l,x),this.at(l)):null}add(l,x){l instanceof Object&&Reflect.has(l,"time")&&(l=(x=l).time);let _=this.toTicks(l),P;return x instanceof $c?(P=x,P.callback=this._tick.bind(this)):P=new $c({callback:this._tick.bind(this),context:this.context,value:x}),P.startOffset=_,P.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(P),this._restartEvent(P),this}_restartEvent(l){this._state.forEach(x=>{x.state==="started"?this._startNote(l,x.time,x.offset):l.stop(new gs(this.context,x.time))})}remove(l,x){return kc(l)&&l.hasOwnProperty("time")&&(l=(x=l).time),l=this.toTicks(l),this._events.forEach(_=>{_.startOffset===l&&(la(x)||mr(x)&&_.value===x)&&(this._events.delete(_),_.dispose())}),this}clear(){return this._forEach(l=>l.dispose()),this._events.clear(),this}cancel(l){return this._forEach(x=>x.cancel(l)),this._state.cancel(this.toTicks(l)),this}_forEach(l){return this._events&&this._events.forEach(x=>{x instanceof Nf?x._forEach(l):l(x)}),this}_setAll(l,x){this._forEach(_=>{_[l]=x})}_tick(l,x){this.mute||this.callback(l,x)}_testLoopBoundries(l){this._loop&&(l.startOffset<this._loopStart||l.startOffset>=this._loopEnd)?l.cancel(0):l.state==="stopped"&&this._restartEvent(l)}get probability(){return this._probability}set probability(l){this._probability=l,this._setAll("probability",l)}get humanize(){return this._humanize}set humanize(l){this._humanize=l,this._setAll("humanize",l)}get loop(){return this._loop}set loop(l){this._loop=l,this._forEach(x=>{x.loopStart=this.loopStart,x.loopEnd=this.loopEnd,x.loop=l,this._testLoopBoundries(x)})}get loopEnd(){return new gs(this.context,this._loopEnd).toSeconds()}set loopEnd(l){this._loopEnd=this.toTicks(l),this._loop&&this._forEach(x=>{x.loopEnd=l,this._testLoopBoundries(x)})}get loopStart(){return new gs(this.context,this._loopStart).toSeconds()}set loopStart(l){this._loopStart=this.toTicks(l),this._loop&&this._forEach(x=>{x.loopStart=this.loopStart,this._testLoopBoundries(x)})}get playbackRate(){return this._playbackRate}set playbackRate(l){this._playbackRate=l,this._setAll("playbackRate",l)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*kO($){let l=0;for(;l<$;)l=hp(l,0,$-1),yield l,l++}function*DO($){let l=$-1;for(;l>=0;)l=hp(l,0,$-1),yield l,l--}function*Ug($,l){for(;;)yield*bp(l($))}function*F_($,l){let x=l?0:$-1;for(;;)x=hp(x,0,$-1),yield x,l?(x++,x>=$-1&&(l=!1)):(x--,x<=0&&(l=!0))}function*AO($){let l=0,x=0;for(;l<$;)l=hp(l,0,$-1),yield l,x++,l+=x%2?2:-1}function*OO($){let l=$-1,x=0;for(;l>=0;)l=hp(l,0,$-1),yield l,x++,l+=x%2?-2:1}function*RO($){let l=[];for(let x=0;x<$;x++)l.push(x);for(;l.length>0;)yield hp(l.splice(Math.floor(l.length*Math.random()),1)[0],0,$-1)}function*P_($,l="up",x=0){switch(Pn($>=1,"The number of values must be at least one"),l){case"up":yield*bp(Ug($,kO));case"down":yield*bp(Ug($,DO));case"upDown":yield*bp(F_($,!0));case"downUp":yield*bp(F_($,!1));case"alternateUp":yield*bp(Ug($,AO));case"alternateDown":yield*bp(Ug($,OO));case"random":yield*bp(function*(_){for(;;)yield Math.floor(Math.random()*_)}($));case"randomOnce":yield*bp(Ug($,RO));case"randomWalk":yield*bp(function*(_){let P=Math.floor(Math.random()*_);for(;;)P===0?P++:P===_-1||Math.random()<.5?P--:P++,yield P}($))}}class Pb extends jg{constructor(){super(ot(Pb.getDefaults(),arguments,["callback","values","pattern"])),this.name="Pattern";let l=ot(Pb.getDefaults(),arguments,["callback","values","pattern"]);this.callback=l.callback,this._values=l.values,this._pattern=P_(l.values.length,l.pattern),this._type=l.pattern}static getDefaults(){return Object.assign(jg.getDefaults(),{pattern:"up",values:[],callback:Nr})}_tick(l){let x=this._pattern.next();this._index=x.value,this._value=this._values[x.value],this.callback(l,this._value)}get values(){return this._values}set values(l){this._values=l,this.pattern=this._type}get value(){return this._value}get index(){return this._index}get pattern(){return this._type}set pattern(l){this._type=l,this._pattern=P_(this._values.length,this._type)}}class $b extends $c{constructor(){super(ot($b.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new Nf({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];let l=ot($b.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(l.subdivision),this.events=l.events,this.loop=l.loop,this.loopStart=l.loopStart,this.loopEnd=l.loopEnd,this.playbackRate=l.playbackRate,this.probability=l.probability,this.humanize=l.humanize,this.mute=l.mute,this.playbackRate=l.playbackRate}static getDefaults(){return Object.assign(oi($c.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(l,x){x===null||this.mute||this.callback(l,x)}get events(){return this._events}set events(l){this.clear(),this._eventsArray=l,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(l,x){return this._part.start(l,x&&this._indexTime(x)),this}stop(l){return this._part.stop(l),this}get subdivision(){return new gs(this.context,this._subdivision).toSeconds()}_createSequence(l){return new Proxy(l,{get:(x,_)=>x[_],set:(x,_,P)=>(Ma(_)&&isFinite(parseInt(_,10))&&vi(P)?x[_]=this._createSequence(P):x[_]=P,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(l,x,_){l.forEach((P,X)=>{let ue=X*x+_;if(vi(P))this._rescheduleSequence(P,x/P.length,ue);else{let de=new gs(this.context,ue,"i").toSeconds();this._part.add(de,P)}})}_indexTime(l){return new gs(this.context,l*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(l){this._part.loop=l}get loopStart(){return this._loopStart}set loopStart(l){this._loopStart=l,this._part.loopStart=this._indexTime(l)}get loopEnd(){return this._loopEnd}set loopEnd(l){this._loopEnd=l,this._part.loopEnd=l===0?this._indexTime(this._eventsArray.length):this._indexTime(l)}get startOffset(){return this._part.startOffset}set startOffset(l){this._part.startOffset=l}get playbackRate(){return this._part.playbackRate}set playbackRate(l){this._part.playbackRate=l}get probability(){return this._part.probability}set probability(l){this._part.probability=l}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(l){this._part.humanize=l}get length(){return this._part.length}}class kf extends kt{constructor(){super(Object.assign(ot(kf.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new A_({context:this.context}),this.a=new mn({context:this.context,gain:0}),this.b=new mn({context:this.context,gain:0}),this.output=new mn({context:this.context}),this._internalChannels=[this.a,this.b];let l=ot(kf.getDefaults(),arguments,["fade"]);this.fade=new Sn({context:this.context,units:"normalRange",value:l.fade}),Wn(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",er(this._split,this.a.gain,0),er(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(kt.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Si extends kt{constructor(l){super(l),this.name="Effect",this._dryWet=new kf({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new mn({context:this.context}),this.effectReturn=new mn({context:this.context}),this.input=new mn({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(l.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Wn(this,"wet")}static getDefaults(){return Object.assign(kt.getDefaults(),{wet:1})}connectEffect(l){return this._internalChannels.push(l),this.effectSend.chain(l,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class Lb extends Si{constructor(l){super(l),this.name="LFOEffect",this._lfo=new fa({context:this.context,frequency:l.frequency,amplitude:l.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=l.type,Wn(this,["frequency","depth"])}static getDefaults(){return Object.assign(Si.getDefaults(),{frequency:1,type:"sine",depth:1})}start(l){return this._lfo.start(l),this}stop(l){return this._lfo.stop(l),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(l){this._lfo.type=l}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Bb extends Lb{constructor(){super(ot(Bb.getDefaults(),arguments,["frequency","baseFrequency","octaves"])),this.name="AutoFilter";let l=ot(Bb.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);this.filter=new uu(Object.assign(l.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=l.octaves,this.baseFrequency=l.baseFrequency}static getDefaults(){return Object.assign(Lb.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(l){this._lfo.min=this.toFrequency(l),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(l){this._octaves=l,this._lfo.max=this._lfo.min*Math.pow(2,l)}dispose(){return super.dispose(),this.filter.dispose(),this}}class w extends kt{constructor(){super(Object.assign(ot(w.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;let l=ot(w.getDefaults(),arguments,["pan"]);this.pan=new Ut({context:this.context,param:this._panner.pan,value:l.pan,minValue:-1,maxValue:1}),this._panner.channelCount=l.channelCount,this._panner.channelCountMode="explicit",Wn(this,"pan")}static getDefaults(){return Object.assign(kt.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class C extends Lb{constructor(){super(ot(C.getDefaults(),arguments,["frequency"])),this.name="AutoPanner";let l=ot(C.getDefaults(),arguments,["frequency"]);this._panner=new w({context:this.context,channelCount:l.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(Lb.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class I extends kt{constructor(){super(ot(I.getDefaults(),arguments,["smoothing"])),this.name="Follower";let l=ot(I.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new D_({context:this.context}),this._lowpass=this.output=new zg({context:this.context,frequency:1/this.toSeconds(l.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=l.smoothing}static getDefaults(){return Object.assign(kt.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(l){this._smoothing=l,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class E extends Si{constructor(){super(ot(E.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"])),this.name="AutoWah";let l=ot(E.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);this._follower=new I({context:this.context,smoothing:l.follower}),this._sweepRange=new Oy({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(l.baseFrequency),this._octaves=l.octaves,this._inputBoost=new mn({context:this.context}),this._bandpass=new uu({context:this.context,rolloff:-48,frequency:0,Q:l.Q}),this._peaking=new uu({context:this.context,type:"peaking"}),this._peaking.gain.value=l.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=l.sensitivity,Wn(this,["gain","Q"])}static getDefaults(){return Object.assign(Si.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(l){this._octaves=l,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(l){this._follower.smoothing=l}get baseFrequency(){return this._baseFrequency}set baseFrequency(l){this._baseFrequency=this.toFrequency(l),this._setSweepRange()}get sensitivity(){return re(1/this._inputBoost.gain.value)}set sensitivity(l){this._inputBoost.gain.value=1/H(l)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}let B="bit-crusher";R_(B,`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`);class V extends Si{constructor(){super(ot(V.getDefaults(),arguments,["bits"])),this.name="BitCrusher";let l=ot(V.getDefaults(),arguments,["bits"]);this._bitCrusherWorklet=new K({context:this.context,bits:l.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(Si.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class K extends CS{constructor(){super(ot(K.getDefaults(),arguments)),this.name="BitCrusherWorklet";let l=ot(K.getDefaults(),arguments);this.input=new mn({context:this.context}),this.output=new mn({context:this.context}),this.bits=new Ut({context:this.context,value:l.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(CS.getDefaults(),{bits:12})}_audioWorkletName(){return B}onReady(l){cr(this.input,l,this.output);let x=l.parameters.get("bits");this.bits.setParam(x)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class ne extends Si{constructor(){super(ot(ne.getDefaults(),arguments,["order"])),this.name="Chebyshev";let l=ot(ne.getDefaults(),arguments,["order"]);this._shaper=new au({context:this.context,length:4096}),this._order=l.order,this.connectEffect(this._shaper),this.order=l.order,this.oversample=l.oversample}static getDefaults(){return Object.assign(Si.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(l,x,_){return _.has(x)||(x===0?_.set(x,0):x===1?_.set(x,l):_.set(x,2*l*this._getCoefficient(l,x-1,_)-this._getCoefficient(l,x-2,_))),_.get(x)}get order(){return this._order}set order(l){Pn(Number.isInteger(l),"'order' must be an integer"),this._order=l,this._shaper.setMap(x=>this._getCoefficient(x,l,new Map))}get oversample(){return this._shaper.oversample}set oversample(l){this._shaper.oversample=l}dispose(){return super.dispose(),this._shaper.dispose(),this}}class be extends kt{constructor(){super(ot(be.getDefaults(),arguments,["channels"])),this.name="Split";let l=ot(be.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(l.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(kt.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Ae extends kt{constructor(){super(ot(Ae.getDefaults(),arguments,["channels"])),this.name="Merge";let l=ot(Ae.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(l.channels)}static getDefaults(){return Object.assign(kt.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class We extends kt{constructor(l){super(l),this.name="StereoEffect",this.input=new mn({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new kf({context:this.context,fade:l.wet}),this.wet=this._dryWet.fade,this._split=new be({context:this.context,channels:2}),this._merge=new Ae({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),Wn(this,["wet"])}connectEffectLeft(...l){this._split.connect(l[0],0,0),cr(...l),er(l[l.length-1],this._merge,0,0)}connectEffectRight(...l){this._split.connect(l[0],1,0),cr(...l),er(l[l.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(kt.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class ut extends We{constructor(l){super(l),this.feedback=new Sn({context:this.context,value:l.feedback,units:"normalRange"}),this._feedbackL=new mn({context:this.context}),this._feedbackR=new mn({context:this.context}),this._feedbackSplit=new be({context:this.context,channels:2}),this._feedbackMerge=new Ae({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),Wn(this,["feedback"])}static getDefaults(){return Object.assign(We.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class bt extends ut{constructor(){super(ot(bt.getDefaults(),arguments,["frequency","delayTime","depth"])),this.name="Chorus";let l=ot(bt.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=l.depth,this._delayTime=l.delayTime/1e3,this._lfoL=new fa({context:this.context,frequency:l.frequency,min:0,max:1}),this._lfoR=new fa({context:this.context,frequency:l.frequency,min:0,max:1,phase:180}),this._delayNodeL=new fo({context:this.context}),this._delayNodeR=new fo({context:this.context}),this.frequency=this._lfoL.frequency,Wn(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=l.type,this.spread=l.spread}static getDefaults(){return Object.assign(ut.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(l){this._depth=l;let x=this._delayTime*l;this._lfoL.min=Math.max(this._delayTime-x,0),this._lfoL.max=this._delayTime+x,this._lfoR.min=Math.max(this._delayTime-x,0),this._lfoR.max=this._delayTime+x}get delayTime(){return 1e3*this._delayTime}set delayTime(l){this._delayTime=l/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(l){this._lfoL.type=l,this._lfoR.type=l}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(l){this._lfoL.phase=90-l/2,this._lfoR.phase=l/2+90}start(l){return this._lfoL.start(l),this._lfoR.start(l),this}stop(l){return this._lfoL.stop(l),this._lfoR.stop(l),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class St extends Si{constructor(){super(ot(St.getDefaults(),arguments,["distortion"])),this.name="Distortion";let l=ot(St.getDefaults(),arguments,["distortion"]);this._shaper=new au({context:this.context,length:4096}),this._distortion=l.distortion,this.connectEffect(this._shaper),this.distortion=l.distortion,this.oversample=l.oversample}static getDefaults(){return Object.assign(Si.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(l){this._distortion=l;let x=100*l,_=Math.PI/180;this._shaper.setMap(P=>Math.abs(P)<.001?0:(3+x)*P*20*_/(Math.PI+x*Math.abs(P)))}get oversample(){return this._shaper.oversample}set oversample(l){this._shaper.oversample=l}dispose(){return super.dispose(),this._shaper.dispose(),this}}class jt extends Si{constructor(l){super(l),this.name="FeedbackEffect",this._feedbackGain=new mn({context:this.context,gain:l.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Wn(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(Si.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class Gt extends jt{constructor(){super(ot(Gt.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";let l=ot(Gt.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new fo({context:this.context,delayTime:l.delayTime,maxDelay:l.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Wn(this,"delayTime")}static getDefaults(){return Object.assign(jt.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class bn extends kt{constructor(l){super(l),this.name="PhaseShiftAllpass",this.input=new mn({context:this.context}),this.output=new mn({context:this.context}),this.offset90=new mn({context:this.context}),this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),cr(this.input,...this._bank0,this._oneSampleDelay,this.output),cr(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(l){return l.map(x=>{let _=[[x*x,0,-1],[1,0,-x*x]];return this.context.createIIRFilter(_[0],_[1])})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach(l=>l.disconnect()),this._bank1.forEach(l=>l.disconnect()),this._oneSampleDelay.disconnect(),this}}class Zn extends Si{constructor(){super(ot(Zn.getDefaults(),arguments,["frequency"])),this.name="FrequencyShifter";let l=ot(Zn.getDefaults(),arguments,["frequency"]);this.frequency=new Sn({context:this.context,units:"frequency",value:l.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new Ag({context:this.context,type:"sine"}),this._cosine=new da({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new is({context:this.context}),this._cosineMultiply=new is({context:this.context}),this._negate=new bS({context:this.context}),this._add=new gl({context:this.context}),this._phaseShifter=new bn({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);let x=this.immediate();this._sine.start(x),this._cosine.start(x)}static getDefaults(){return Object.assign(Si.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}let zn=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],tr=[225,556,441,341];class Or extends We{constructor(){super(ot(Or.getDefaults(),arguments,["roomSize","dampening"])),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];let l=ot(Or.getDefaults(),arguments,["roomSize","dampening"]);this.roomSize=new Sn({context:this.context,value:l.roomSize,units:"normalRange"}),this._allpassFiltersL=tr.map(x=>{let _=this.context.createBiquadFilter();return _.type="allpass",_.frequency.value=x,_}),this._allpassFiltersR=tr.map(x=>{let _=this.context.createBiquadFilter();return _.type="allpass",_.frequency.value=x,_}),this._combFilters=zn.map((x,_)=>{let P=new Vg({context:this.context,dampening:l.dampening,delayTime:x});return _<zn.length/2?this.connectEffectLeft(P,...this._allpassFiltersL):this.connectEffectRight(P,...this._allpassFiltersR),this.roomSize.connect(P.resonance),P}),Wn(this,["roomSize"])}static getDefaults(){return Object.assign(We.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(l){this._combFilters.forEach(x=>x.dampening=l)}dispose(){return super.dispose(),this._allpassFiltersL.forEach(l=>l.disconnect()),this._allpassFiltersR.forEach(l=>l.disconnect()),this._combFilters.forEach(l=>l.dispose()),this.roomSize.dispose(),this}}let Yr=[.06748,.06404,.08212,.09004],Ro=[.773,.802,.753,.733],ma=[347,113,37];class Wr extends We{constructor(){super(ot(Wr.getDefaults(),arguments,["roomSize"])),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[];let l=ot(Wr.getDefaults(),arguments,["roomSize"]);this.roomSize=new Sn({context:this.context,value:l.roomSize,units:"normalRange"}),this._scaleRoomSize=new yl({context:this.context,min:-.733,max:.197}),this._allpassFilters=ma.map(x=>{let _=this.context.createBiquadFilter();return _.type="allpass",_.frequency.value=x,_}),this._feedbackCombFilters=Yr.map((x,_)=>{let P=new Bg({context:this.context,delayTime:x});return this._scaleRoomSize.connect(P.resonance),P.resonance.value=Ro[_],_<Yr.length/2?this.connectEffectLeft(...this._allpassFilters,P):this.connectEffectRight(...this._allpassFilters,P),P}),this.roomSize.connect(this._scaleRoomSize),Wn(this,["roomSize"])}static getDefaults(){return Object.assign(We.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach(l=>l.disconnect()),this._feedbackCombFilters.forEach(l=>l.dispose()),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class Ts extends ut{constructor(l){super(l),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),Wn(this,["feedback"])}}class Jo extends Ts{constructor(){super(ot(Jo.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";let l=ot(Jo.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new fo({context:this.context,maxDelay:l.maxDelay}),this._rightDelay=new fo({context:this.context,maxDelay:l.maxDelay}),this._rightPreDelay=new fo({context:this.context,maxDelay:l.maxDelay}),this.delayTime=new Sn({context:this.context,units:"time",value:l.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),Wn(this,["delayTime"])}static getDefaults(){return Object.assign(Ts.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class cu extends jt{constructor(){super(ot(cu.getDefaults(),arguments,["pitch"])),this.name="PitchShift";let l=ot(cu.getDefaults(),arguments,["pitch"]);this._frequency=new Sn({context:this.context}),this._delayA=new fo({maxDelay:1,context:this.context}),this._lfoA=new fa({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new fo({maxDelay:1,context:this.context}),this._lfoB=new fa({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new kf({context:this.context}),this._crossFadeLFO=new fa({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new fo({delayTime:l.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,Wn(this,"delayTime"),this._pitch=l.pitch,this._windowSize=l.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);let x=this.now();this._lfoA.start(x),this._lfoB.start(x),this._crossFadeLFO.start(x),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(jt.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(l){this._pitch=l;let x=0;l<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,x=ie(l-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,x=ie(l)-1),this._frequency.value=x*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(l){this._windowSize=this.toSeconds(l),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class lu extends We{constructor(){super(ot(lu.getDefaults(),arguments,["frequency","octaves","baseFrequency"])),this.name="Phaser";let l=ot(lu.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);this._lfoL=new fa({context:this.context,frequency:l.frequency,min:0,max:1}),this._lfoR=new fa({context:this.context,frequency:l.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(l.baseFrequency),this._octaves=l.octaves,this.Q=new Sn({context:this.context,value:l.Q,units:"positive"}),this._filtersL=this._makeFilters(l.stages,this._lfoL),this._filtersR=this._makeFilters(l.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=l.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=l.baseFrequency,this.octaves=l.octaves,this._lfoL.start(),this._lfoR.start(),Wn(this,["frequency","Q"])}static getDefaults(){return Object.assign(We.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(l,x){let _=[];for(let P=0;P<l;P++){let X=this.context.createBiquadFilter();X.type="allpass",this.Q.connect(X.Q),x.connect(X.frequency),_.push(X)}return _}get octaves(){return this._octaves}set octaves(l){this._octaves=l;let x=this._baseFrequency*Math.pow(2,l);this._lfoL.max=x,this._lfoR.max=x}get baseFrequency(){return this._baseFrequency}set baseFrequency(l){this._baseFrequency=this.toFrequency(l),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(l=>l.disconnect()),this._filtersR.forEach(l=>l.disconnect()),this.frequency.dispose(),this}}class ys extends Si{constructor(){super(ot(ys.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();let l=ot(ys.getDefaults(),arguments,["decay"]);this._decay=l.decay,this._preDelay=l.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Si.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(l){wi(l=this.toSeconds(l),.001),this._decay=l,this.generate()}get preDelay(){return this._preDelay}set preDelay(l){wi(l=this.toSeconds(l),0),this._preDelay=l,this.generate()}generate(){return To(this,void 0,void 0,function*(){let l=this.ready,x=new te(2,this._decay+this._preDelay,this.context.sampleRate),_=new Mc({context:x}),P=new Mc({context:x}),X=new Ae({context:x});_.connect(X,0,0),P.connect(X,0,1);let ue=new mn({context:x}).toDestination();X.connect(ue),_.start(0),P.start(0),ue.gain.setValueAtTime(0,0),ue.gain.setValueAtTime(1,this._preDelay),ue.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);let de=x.render();return this.ready=de.then(Nr),yield l,this._convolver.buffer=(yield de).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Zs extends kt{constructor(){super(ot(Zs.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new be({channels:2,context:this.context}),this._midAdd=new gl({context:this.context}),this.mid=new is({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new _f({context:this.context}),this.side=new is({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class nc extends kt{constructor(){super(ot(nc.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new mn({context:this.context}),this.side=new mn({context:this.context}),this._left=new gl({context:this.context}),this._leftMult=new is({context:this.context,value:Math.SQRT1_2}),this._right=new _f({context:this.context}),this._rightMult=new is({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new Ae({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class Hi extends Si{constructor(l){super(l),this.name="MidSideEffect",this._midSideMerge=new nc({context:this.context}),this._midSideSplit=new Zs({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...l){this._midSend.chain(...l,this._midReturn)}connectEffectSide(...l){this._sideSend.chain(...l,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class Lc extends Hi{constructor(){super(ot(Lc.getDefaults(),arguments,["width"])),this.name="StereoWidener";let l=ot(Lc.getDefaults(),arguments,["width"]);this.width=new Sn({context:this.context,value:l.width,units:"normalRange"}),Wn(this,["width"]),this._twoTimesWidthMid=new is({context:this.context,value:2}),this._twoTimesWidthSide=new is({context:this.context,value:2}),this._midMult=new is({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new _f({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),er(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new is({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(Hi.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class rc extends We{constructor(){super(ot(rc.getDefaults(),arguments,["frequency","depth"])),this.name="Tremolo";let l=ot(rc.getDefaults(),arguments,["frequency","depth"]);this._lfoL=new fa({context:this.context,type:l.type,min:1,max:0}),this._lfoR=new fa({context:this.context,type:l.type,min:1,max:0}),this._amplitudeL=new mn({context:this.context}),this._amplitudeR=new mn({context:this.context}),this.frequency=new Sn({context:this.context,value:l.frequency,units:"frequency"}),this.depth=new Sn({context:this.context,value:l.depth,units:"normalRange"}),Wn(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=l.spread}static getDefaults(){return Object.assign(We.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(l){return this._lfoL.start(l),this._lfoR.start(l),this}stop(l){return this._lfoL.stop(l),this._lfoR.stop(l),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(l){this._lfoL.type=l,this._lfoR.type=l}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(l){this._lfoL.phase=90-l/2,this._lfoR.phase=l/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Pu extends Si{constructor(){super(ot(Pu.getDefaults(),arguments,["frequency","depth"])),this.name="Vibrato";let l=ot(Pu.getDefaults(),arguments,["frequency","depth"]);this._delayNode=new fo({context:this.context,delayTime:0,maxDelay:l.maxDelay}),this._lfo=new fa({context:this.context,type:l.type,min:0,max:l.maxDelay,frequency:l.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=l.depth,Wn(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(Si.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(l){this._lfo.type=l}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class ga extends kt{constructor(){super(ot(ga.getDefaults(),arguments,["type","size"])),this.name="Analyser",this._analysers=[],this._buffers=[];let l=ot(ga.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new mn({context:this.context}),this._split=new be({context:this.context,channels:l.channels}),this.input.connect(this._split),wi(l.channels,1);for(let x=0;x<l.channels;x++)this._analysers[x]=this.context.createAnalyser(),this._split.connect(this._analysers[x],x,0);this.size=l.size,this.type=l.type,this.smoothing=l.smoothing}static getDefaults(){return Object.assign(kt.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((l,x)=>{let _=this._buffers[x];this._type==="fft"?l.getFloatFrequencyData(_):this._type==="waveform"&&l.getFloatTimeDomainData(_)}),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(l){this._analysers.forEach((x,_)=>{x.fftSize=2*l,this._buffers[_]=new Float32Array(l)})}get channels(){return this._analysers.length}get type(){return this._type}set type(l){Pn(l==="waveform"||l==="fft",`Analyser: invalid type: ${l}`),this._type=l}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(l){this._analysers.forEach(x=>x.smoothingTimeConstant=l)}dispose(){return super.dispose(),this._analysers.forEach(l=>l.disconnect()),this._split.dispose(),this._gain.dispose(),this}}class Ki extends kt{constructor(){super(ot(Ki.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new ga({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class ya extends Ki{constructor(){super(ot(ya.getDefaults(),arguments,["smoothing"])),this.name="Meter";let l=ot(ya.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new ga({context:this.context,size:256,type:"waveform",channels:l.channelCount}),this.smoothing=l.smoothing,this.normalRange=l.normalRange,this._rms=new Array(l.channelCount),this._rms.fill(0)}static getDefaults(){return Object.assign(Ki.getDefaults(),{smoothing:.8,normalRange:!1,channelCount:1})}getLevel(){return ch("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){let l=this._analyser.getValue(),x=(this.channels===1?[l]:l).map((_,P)=>{let X=_.reduce((de,we)=>de+we*we,0),ue=Math.sqrt(X/_.length);return this._rms[P]=Math.max(ue,this._rms[P]*this.smoothing),this.normalRange?this._rms[P]:re(this._rms[P])});return this.channels===1?x[0]:x}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class Xi extends Ki{constructor(){super(ot(Xi.getDefaults(),arguments,["size"])),this.name="FFT";let l=ot(Xi.getDefaults(),arguments,["size"]);this.normalRange=l.normalRange,this._analyser.type="fft",this.size=l.size}static getDefaults(){return Object.assign(kt.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map(l=>this.normalRange?H(l):l)}get size(){return this._analyser.size}set size(l){this._analyser.size=l}get smoothing(){return this._analyser.smoothing}set smoothing(l){this._analyser.smoothing=l}getFrequencyOfIndex(l){return Pn(0<=l&&l<this.size,`index must be greater than or equal to 0 and less than ${this.size}`),l*this.context.sampleRate/(2*this.size)}}class Pa extends Ki{constructor(){super(ot(Pa.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}}class $a extends Ki{constructor(){super(ot($a.getDefaults(),arguments,["size"])),this.name="Waveform";let l=ot($a.getDefaults(),arguments,["size"]);this._analyser.type="waveform",this.size=l.size}static getDefaults(){return Object.assign(Ki.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(l){this._analyser.size=l}}class Eo extends kt{constructor(){super(ot(Eo.getDefaults(),arguments,["solo"])),this.name="Solo";let l=ot(Eo.getDefaults(),arguments,["solo"]);this.input=this.output=new mn({context:this.context}),Eo._allSolos.has(this.context)||Eo._allSolos.set(this.context,new Set),Eo._allSolos.get(this.context).add(this),this.solo=l.solo}static getDefaults(){return Object.assign(kt.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(l){l?this._addSolo():this._removeSolo(),Eo._allSolos.get(this.context).forEach(x=>x._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Eo._soloed.has(this.context)||Eo._soloed.set(this.context,new Set),Eo._soloed.get(this.context).add(this)}_removeSolo(){Eo._soloed.has(this.context)&&Eo._soloed.get(this.context).delete(this)}_isSoloed(){return Eo._soloed.has(this.context)&&Eo._soloed.get(this.context).has(this)}_noSolos(){return!Eo._soloed.has(this.context)||Eo._soloed.has(this.context)&&Eo._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Eo._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Eo._allSolos=new Map,Eo._soloed=new Map;class Bc extends kt{constructor(){super(ot(Bc.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";let l=ot(Bc.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new w({context:this.context,pan:l.pan,channelCount:l.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new ml({context:this.context,volume:l.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=l.mute,Wn(this,["pan","volume"])}static getDefaults(){return Object.assign(kt.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(l){this._volume.mute=l}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class pu extends kt{constructor(){super(ot(pu.getDefaults(),arguments,["volume","pan"])),this.name="Channel";let l=ot(pu.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Eo({solo:l.solo,context:this.context}),this._panVol=this.output=new Bc({context:this.context,pan:l.pan,volume:l.volume,mute:l.mute,channelCount:l.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Wn(this,["pan","volume"])}static getDefaults(){return Object.assign(kt.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(l){this._solo.solo=l}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(l){this._panVol.mute=l}_getBus(l){return pu.buses.has(l)||pu.buses.set(l,new mn({context:this.context})),pu.buses.get(l)}send(l,x=0){let _=this._getBus(l),P=new mn({context:this.context,units:"decibels",gain:x});return this.connect(P),P.connect(_),P}receive(l){return this._getBus(l).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}pu.buses=new Map;class yp extends kt{constructor(){super(ot(yp.getDefaults(),arguments)),this.name="Mono",this.input=new mn({context:this.context}),this._merge=this.output=new Ae({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class hu extends kt{constructor(){super(ot(hu.getDefaults(),arguments,["lowFrequency","highFrequency"])),this.name="MultibandSplit",this.input=new mn({context:this.context}),this.output=void 0,this.low=new uu({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new uu({context:this.context,frequency:0,type:"highpass"}),this.mid=new uu({context:this.context,frequency:0,type:"lowpass"}),this.high=new uu({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high];let l=ot(hu.getDefaults(),arguments,["lowFrequency","highFrequency"]);this.lowFrequency=new Sn({context:this.context,units:"frequency",value:l.lowFrequency}),this.highFrequency=new Sn({context:this.context,units:"frequency",value:l.highFrequency}),this.Q=new Sn({context:this.context,units:"positive",value:l.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),Wn(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(kt.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),dh(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class xl extends kt{constructor(){super(...arguments),this.name="Listener",this.positionX=new Ut({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Ut({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Ut({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Ut({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Ut({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Ut({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Ut({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Ut({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Ut({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(kt.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}eo($=>{$.listener=new xl({context:$})}),xf($=>{$.listener.dispose()});class bl extends kt{constructor(){super(ot(bl.getDefaults(),arguments,["positionX","positionY","positionZ"])),this.name="Panner3D";let l=ot(bl.getDefaults(),arguments,["positionX","positionY","positionZ"]);this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=l.panningModel,this.maxDistance=l.maxDistance,this.distanceModel=l.distanceModel,this.coneOuterGain=l.coneOuterGain,this.coneOuterAngle=l.coneOuterAngle,this.coneInnerAngle=l.coneInnerAngle,this.refDistance=l.refDistance,this.rolloffFactor=l.rolloffFactor,this.positionX=new Ut({context:this.context,param:this._panner.positionX,value:l.positionX}),this.positionY=new Ut({context:this.context,param:this._panner.positionY,value:l.positionY}),this.positionZ=new Ut({context:this.context,param:this._panner.positionZ,value:l.positionZ}),this.orientationX=new Ut({context:this.context,param:this._panner.orientationX,value:l.orientationX}),this.orientationY=new Ut({context:this.context,param:this._panner.orientationY,value:l.orientationY}),this.orientationZ=new Ut({context:this.context,param:this._panner.orientationZ,value:l.orientationZ})}static getDefaults(){return Object.assign(kt.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(l,x,_){return this.positionX.value=l,this.positionY.value=x,this.positionZ.value=_,this}setOrientation(l,x,_){return this.orientationX.value=l,this.orientationY.value=x,this.orientationZ.value=_,this}get panningModel(){return this._panner.panningModel}set panningModel(l){this._panner.panningModel=l}get refDistance(){return this._panner.refDistance}set refDistance(l){this._panner.refDistance=l}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(l){this._panner.rolloffFactor=l}get distanceModel(){return this._panner.distanceModel}set distanceModel(l){this._panner.distanceModel=l}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(l){this._panner.coneInnerAngle=l}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(l){this._panner.coneOuterAngle=l}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(l){this._panner.coneOuterGain=l}get maxDistance(){return this._panner.maxDistance}set maxDistance(l){this._panner.maxDistance=l}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class zc extends kt{constructor(){super(ot(zc.getDefaults(),arguments)),this.name="Recorder";let l=ot(zc.getDefaults(),arguments);this.input=new mn({context:this.context}),Pn(zc.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:l.mimeType})}static getDefaults(){return kt.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return Dc!==null&&Reflect.has(Dc,"MediaRecorder")}get state(){return this._recorder.state==="inactive"?"stopped":this._recorder.state==="paused"?"paused":"started"}start(){return To(this,void 0,void 0,function*(){Pn(this.state!=="started","Recorder is already started");let l=new Promise(x=>{let _=()=>{this._recorder.removeEventListener("start",_,!1),x()};this._recorder.addEventListener("start",_,!1)});return this._recorder.start(),yield l})}stop(){return To(this,void 0,void 0,function*(){Pn(this.state!=="stopped","Recorder is not started");let l=new Promise(x=>{let _=P=>{this._recorder.removeEventListener("dataavailable",_,!1),x(P.data)};this._recorder.addEventListener("dataavailable",_,!1)});return this._recorder.stop(),yield l})}pause(){return Pn(this.state==="started","Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class $u extends kt{constructor(){super(ot($u.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;let l=ot($u.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new Ut({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:l.threshold}),this.attack=new Ut({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:l.attack}),this.release=new Ut({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:l.release}),this.knee=new Ut({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:l.knee}),this.ratio=new Ut({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:l.ratio}),Wn(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(kt.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class xp extends kt{constructor(){super(Object.assign(ot(xp.getDefaults(),arguments,["threshold","smoothing"]))),this.name="Gate";let l=ot(xp.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new I({context:this.context,smoothing:l.smoothing}),this._gt=new Ay({context:this.context,value:H(l.threshold)}),this.input=new mn({context:this.context}),this._gate=this.output=new mn({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(kt.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return re(this._gt.value)}set threshold(l){this._gt.value=H(l)}get smoothing(){return this._follower.smoothing}set smoothing(l){this._follower.smoothing=l}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class Vc extends kt{constructor(){super(Object.assign(ot(Vc.getDefaults(),arguments,["threshold"]))),this.name="Limiter";let l=ot(Vc.getDefaults(),arguments,["threshold"]);this._compressor=this.input=this.output=new $u({context:this.context,ratio:20,attack:.003,release:.01,threshold:l.threshold}),this.threshold=this._compressor.threshold,Wn(this,"threshold")}static getDefaults(){return Object.assign(kt.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class gh extends kt{constructor(){super(Object.assign(ot(gh.getDefaults(),arguments))),this.name="MidSideCompressor";let l=ot(gh.getDefaults(),arguments);this._midSideSplit=this.input=new Zs({context:this.context}),this._midSideMerge=this.output=new nc({context:this.context}),this.mid=new $u(Object.assign(l.mid,{context:this.context})),this.side=new $u(Object.assign(l.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),Wn(this,["mid","side"])}static getDefaults(){return Object.assign(kt.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class Df extends kt{constructor(){super(Object.assign(ot(Df.getDefaults(),arguments))),this.name="MultibandCompressor";let l=ot(Df.getDefaults(),arguments);this._splitter=this.input=new hu({context:this.context,lowFrequency:l.lowFrequency,highFrequency:l.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new mn({context:this.context}),this.low=new $u(Object.assign(l.low,{context:this.context})),this.mid=new $u(Object.assign(l.mid,{context:this.context})),this.high=new $u(Object.assign(l.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),Wn(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(kt.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class zb extends kt{constructor(){super(ot(zb.getDefaults(),arguments,["low","mid","high"])),this.name="EQ3",this.output=new mn({context:this.context}),this._internalChannels=[];let l=ot(zb.getDefaults(),arguments,["low","mid","high"]);this.input=this._multibandSplit=new hu({context:this.context,highFrequency:l.highFrequency,lowFrequency:l.lowFrequency}),this._lowGain=new mn({context:this.context,gain:l.low,units:"decibels"}),this._midGain=new mn({context:this.context,gain:l.mid,units:"decibels"}),this._highGain=new mn({context:this.context,gain:l.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),Wn(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(kt.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),dh(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class Vb extends kt{constructor(){super(ot(Vb.getDefaults(),arguments,["url","onload"])),this.name="Convolver",this._convolver=this.context.createConvolver();let l=ot(Vb.getDefaults(),arguments,["url","onload"]);this._buffer=new Hr(l.url,x=>{this.buffer=x,l.onload()}),this.input=new mn({context:this.context}),this.output=new mn({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=l.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(kt.getDefaults(),{normalize:!0,onload:Nr})}load(l){return To(this,void 0,void 0,function*(){this.buffer=yield this._buffer.load(l)})}get buffer(){return this._buffer.length?this._buffer:null}set buffer(l){l&&this._buffer.set(l),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));let x=this._buffer.get();this._convolver.buffer=x||null}get normalize(){return this._convolver.normalize}set normalize(l){this._convolver.normalize=l}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function IS(){return A().now()}function _S(){return A().immediate()}let TS=A().transport;function y1e(){return A().transport}let x1e=A().destination,b1e=A().destination;function v1e(){return A().destination}let w1e=A().listener;function S1e(){return A().listener}let C1e=A().draw;function I1e(){return A().draw}let _1e=A();function T1e(){return Hr.loaded()}let E1e=Hr,N1e=Rc,k1e=fp})(),r})())});var g1e=uo((exports,module)=>{"use strict";(function(n,t){typeof exports=="object"&&typeof module=="object"?module.exports=t((J7(),B_(Z7)),(e9(),B_(m1e))):typeof define=="function"&&define.amd?define(["tf","Tone"],t):typeof exports=="object"?exports.index=t((J7(),B_(Z7)),(e9(),B_(m1e))):n.index=t(n.tf,n.Tone)})(self,function(__WEBPACK_EXTERNAL_MODULE__2__,__WEBPACK_EXTERNAL_MODULE__9__){return function(n){var t={};function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=n,e.c=t,e.d=function(r,o,s){e.o(r,o)||Object.defineProperty(r,o,{enumerable:!0,get:s})},e.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,o){if(1&o&&(r=e(r)),8&o||4&o&&typeof r=="object"&&r&&r.__esModule)return r;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:r}),2&o&&typeof r!="string")for(var i in r)e.d(s,i,function(a){return r[a]}.bind(null,i));return s},e.n=function(r){var o=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(o,"a",o),o},e.o=function(r,o){return Object.prototype.hasOwnProperty.call(r,o)},e.p="",e(e.s=190)}([function(n,t,e){"use strict";e.d(t,"T",function(){return Ce.b}),e.d(t,"Fb",function(){return Da.a}),e.d(t,"Kb",function(){return Da.b}),e.d(t,"W",function(){return xt}),e.d(t,"Y",function(){return Yt}),e.d(t,"Z",function(){return tt}),e.d(t,"ab",function(){return W}),e.d(t,"bb",function(){return ar}),e.d(t,"cb",function(){return Zo}),e.d(t,"db",function(){return eh}),e.d(t,"eb",function(){return ul}),e.d(t,"hb",function(){return qr}),e.d(t,"mb",function(){return jo}),e.d(t,"nb",function(){return ua}),e.d(t,"ob",function(){return lf}),e.d(t,"pb",function(){return rn}),e.d(t,"rb",function(){return yg}),e.d(t,"sb",function(){return Yu}),e.d(t,"tb",function(){return rp}),e.d(t,"ub",function(){return Cs}),e.d(t,"xb",function(){return ze}),e.d(t,"yb",function(){return yr}),e.d(t,"zb",function(){return ho}),e.d(t,"Bb",function(){return pf}),e.d(t,"Cb",function(){return Gr}),e.d(t,"Db",function(){return th}),e.d(t,"Eb",function(){return xr}),e.d(t,"Gb",function(){return Un.a}),e.d(t,"Ib",function(){return Gi}),e.d(t,"Mb",function(){return Jr}),e.d(t,"Nb",function(){return Oa}),e.d(t,"Ob",function(){return _o}),e.d(t,"Jb",function(){return ms}),e.d(t,"ib",function(){return Qx}),e.d(t,"Hb",function(){return Zx}),e.d(t,"gb",function(){return Jx}),e.d(t,"vb",function(){return Fr}),e.d(t,"wb",function(){return Sy.e}),e.d(t,"jb",function(){return c.b}),e.d(t,"qb",function(){return X2.a}),e.d(t,"kb",function(){return r}),e.d(t,"Lb",function(){return po}),e.d(t,"X",function(){return i}),e.d(t,"Ab",function(){return o}),e.d(t,"fb",function(){return yb}),e.d(t,"lb",function(){return a}),e.d(t,"w",function(){return Ma.b}),e.d(t,"k",function(){return Ma.a}),e.d(t,"a",function(){return ye.a}),e.d(t,"b",function(){return ye.d}),e.d(t,"c",function(){return ye.m}),e.d(t,"d",function(){return ye.o}),e.d(t,"e",function(){return ye.r}),e.d(t,"f",function(){return ye.v}),e.d(t,"g",function(){return ye.w}),e.d(t,"h",function(){return ye.y}),e.d(t,"i",function(){return ye.z}),e.d(t,"j",function(){return ye.G}),e.d(t,"l",function(){return ye.R}),e.d(t,"m",function(){return ye.W}),e.d(t,"n",function(){return ye.X}),e.d(t,"o",function(){return ye.Y}),e.d(t,"p",function(){return ye.ab}),e.d(t,"q",function(){return ye.bb}),e.d(t,"s",function(){return ye.eb}),e.d(t,"u",function(){return ye.jb}),e.d(t,"t",function(){return ye.ib}),e.d(t,"v",function(){return ye.kb}),e.d(t,"x",function(){return ye.sb}),e.d(t,"y",function(){return ye.yb}),e.d(t,"z",function(){return ye.zb}),e.d(t,"A",function(){return ye.Cb}),e.d(t,"B",function(){return ye.Db}),e.d(t,"C",function(){return ye.Fb}),e.d(t,"D",function(){return ye.Ib}),e.d(t,"E",function(){return ye.Kb}),e.d(t,"I",function(){return ye.Pb}),e.d(t,"F",function(){return ye.Mb}),e.d(t,"G",function(){return ye.Nb}),e.d(t,"H",function(){return ye.Ob}),e.d(t,"J",function(){return ye.Xb}),e.d(t,"K",function(){return ye.bc}),e.d(t,"M",function(){return ye.jc}),e.d(t,"O",function(){return ye.qc}),e.d(t,"N",function(){return ye.oc}),e.d(t,"Q",function(){return ye.xc}),e.d(t,"P",function(){return ye.wc}),e.d(t,"R",function(){return ye.Ac}),e.d(t,"S",function(){return ye.Cc}),e.d(t,"U",function(){return ye.Gc}),e.d(t,"V",function(){return ye.Hc}),e.d(t,"r",function(){return ye.db}),e.d(t,"L",function(){return ye.hc});var r={};e.r(r),e.d(r,"copyModel",function(){return Ve}),e.d(r,"listModels",function(){return Ee}),e.d(r,"moveModel",function(){return qe}),e.d(r,"removeModel",function(){return Le}),e.d(r,"browserFiles",function(){return Dt}),e.d(r,"browserHTTPRequest",function(){return Ar}),e.d(r,"concatenateArrayBuffers",function(){return h.d}),e.d(r,"decodeWeights",function(){return h.e}),e.d(r,"encodeWeights",function(){return h.f}),e.d(r,"fromMemory",function(){return Ws}),e.d(r,"getLoadHandlers",function(){return m}),e.d(r,"getModelArtifactsInfoForJSON",function(){return h.g}),e.d(r,"getSaveHandlers",function(){return p}),e.d(r,"http",function(){return _r}),e.d(r,"isHTTPScheme",function(){return Qn}),e.d(r,"loadWeights",function(){return nn}),e.d(r,"registerLoadRouter",function(){return d}),e.d(r,"registerSaveRouter",function(){return g}),e.d(r,"weightsLoaderFactory",function(){return Yn}),e.d(r,"withSaveHandler",function(){return ki});var o={};e.r(o),e.d(o,"assertParamsValid",function(){return Di}),e.d(o,"maskToAxes",function(){return Ai}),e.d(o,"computeOutShape",function(){return ia}),e.d(o,"stridesWithElidedDims",function(){return aa}),e.d(o,"getNormalizedAxes",function(){return eu}),e.d(o,"startIndicesWithElidedDims",function(){return ds}),e.d(o,"stopIndicesWithElidedDims",function(){return wc}),e.d(o,"stridesForAxis",function(){return ku}),e.d(o,"startForAxis",function(){return fs}),e.d(o,"stopForAxis",function(){return Ao}),e.d(o,"isSliceContinous",function(){return Hs}),e.d(o,"computeFlatOffset",function(){return bi}),e.d(o,"parseSliceParams",function(){return Sc});var s={};e.r(s),e.d(s,"segOpComputeOptimalWindowSize",function(){return cS}),e.d(s,"computeOutShape",function(){return gb}),e.d(s,"collectGatherOpShapeInfo",function(){return _y});var i={};e.r(i),e.d(i,"axesAreInnerMostDims",function(){return ji}),e.d(i,"combineLocations",function(){return fg}),e.d(i,"computeOutAndReduceShapes",function(){return mg}),e.d(i,"expandShapeToKeepDim",function(){return Ui}),e.d(i,"assertAxesAreInnerMostDims",function(){return Ps}),e.d(i,"getAxesPermutation",function(){return qi}),e.d(i,"getUndoAxesPermutation",function(){return ni}),e.d(i,"getInnerMostAxes",function(){return Aa}),e.d(i,"getBroadcastDims",function(){return hf}),e.d(i,"getReductionAxes",function(){return _s}),e.d(i,"assertAndGetBroadcastShape",function(){return oo}),e.d(i,"assertParamsConsistent",function(){return Qt}),e.d(i,"computeOutShape",function(){return Gn}),e.d(i,"computeDilation2DInfo",function(){return xe}),e.d(i,"computePool2DInfo",function(){return Pe}),e.d(i,"computePool3DInfo",function(){return Ge}),e.d(i,"computeConv2DInfo",function(){return pt}),e.d(i,"computeConv3DInfo",function(){return At}),e.d(i,"computeDefaultPad",function(){return qt}),e.d(i,"tupleValuesAreOne",function(){return yn}),e.d(i,"eitherStridesOrDilationsAreOne",function(){return Cn}),e.d(i,"convertConv2DDataFormat",function(){return Io}),e.d(i,"getFusedDyActivation",function(){return Ig}),e.d(i,"getFusedBiasGradient",function(){return Y2}),e.d(i,"applyActivation",function(){return Ec}),e.d(i,"shouldFuse",function(){return ob}),e.d(i,"PARALLELIZE_THRESHOLD",function(){return tc}),e.d(i,"computeOptimalWindowSize",function(){return sb}),e.d(i,"slice_util",function(){return o}),e.d(i,"upcastType",function(){return Da.b}),e.d(i,"getImageCenter",function(){return _g}),e.d(i,"getReshaped",function(){return ah}),e.d(i,"getPermuted",function(){return ib}),e.d(i,"getReshapedPermuted",function(){return Q2}),e.d(i,"getSliceBeginCoords",function(){return ab}),e.d(i,"getSliceSize",function(){return Z2}),e.d(i,"prepareAndValidate",function(){return J2}),e.d(i,"validateUpdateShape",function(){return ub}),e.d(i,"validateInput",function(){return eS}),e.d(i,"calculateShapes",function(){return tS}),e.d(i,"SELU_SCALEALPHA",function(){return cb}),e.d(i,"SELU_SCALE",function(){return Tg}),e.d(i,"ERF_P",function(){return lb}),e.d(i,"ERF_A1",function(){return pb}),e.d(i,"ERF_A2",function(){return Iy}),e.d(i,"ERF_A3",function(){return hb}),e.d(i,"ERF_A4",function(){return db}),e.d(i,"ERF_A5",function(){return nS}),e.d(i,"warn",function(){return rS}),e.d(i,"log",function(){return Eg}),e.d(i,"mergeRealAndImagArrays",function(){return fb}),e.d(i,"splitRealAndImagArrays",function(){return oS}),e.d(i,"complexWithEvenIndex",function(){return Nc}),e.d(i,"complexWithOddIndex",function(){return mb}),e.d(i,"getComplexWithIndex",function(){return sS}),e.d(i,"assignToTypedArray",function(){return iS}),e.d(i,"exponents",function(){return aS}),e.d(i,"exponent",function(){return uS}),e.d(i,"prepareSplitSize",function(){return Is}),e.d(i,"segment_util",function(){return s}),e.d(i,"castTensor",function(){return lS}),e.d(i,"reshapeTensor",function(){return la}),e.d(i,"linspaceImpl",function(){return mr});var a={};e.r(a),e.d(a,"nonMaxSuppressionV3Impl",function(){return W2}),e.d(a,"nonMaxSuppressionV4Impl",function(){return H2}),e.d(a,"nonMaxSuppressionV5Impl",function(){return ff}),e.d(a,"split",function(){return Ra}),e.d(a,"tile",function(){return kc}),e.d(a,"topkImpl",function(){return ll}),e.d(a,"whereImpl",function(){return vi});var u=e(6),c=(e(38),e(11)),h=e(17);class f{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return f.instance==null&&(f.instance=new f),f.instance}static registerSaveRouter(C){f.getInstance().saveRouters.push(C)}static registerLoadRouter(C){f.getInstance().loadRouters.push(C)}static getSaveHandlers(C){return f.getHandlers(C,"save")}static getLoadHandlers(C,I){return f.getHandlers(C,"load",I)}static getHandlers(C,I,E){let B=[];return(I==="load"?f.getInstance().loadRouters:f.getInstance().saveRouters).forEach(V=>{let K=V(C,E);K!==null&&B.push(K)}),B}}let g=w=>f.registerSaveRouter(w),d=w=>f.registerLoadRouter(w),p=w=>f.getSaveHandlers(w),m=(w,C)=>f.getLoadHandlers(w,C);function y(){if(!Object(c.b)().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let w=typeof window>"u"?self:window,C=w.indexedDB||w.mozIndexedDB||w.webkitIndexedDB||w.msIndexedDB||w.shimIndexedDB;if(C==null)throw new Error("The current browser does not appear to support IndexedDB.");return C}function v(w){let C=w.result;C.createObjectStore("models_store",{keyPath:"modelPath"}),C.createObjectStore("model_info_store",{keyPath:"modelPath"})}let N=(()=>{class w{constructor(I){if(this.indexedDB=y(),I==null||!I)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=I}save(I){return Te(this,null,function*(){if(I.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,I)})}load(){return Te(this,null,function*(){return this.databaseAction(this.modelPath)})}databaseAction(I,E){return new Promise((B,V)=>{let K=this.indexedDB.open("tensorflowjs",1);K.onupgradeneeded=()=>v(K),K.onsuccess=()=>{let ne=K.result;if(E==null){let be=ne.transaction("models_store","readonly"),Ae=be.objectStore("models_store").get(this.modelPath);Ae.onsuccess=()=>{if(Ae.result==null)return ne.close(),V(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));B(Ae.result.modelArtifacts)},Ae.onerror=We=>(ne.close(),V(Ae.error)),be.oncomplete=()=>ne.close()}else{let be=Object(h.g)(E),Ae=ne.transaction("model_info_store","readwrite"),We=Ae.objectStore("model_info_store"),ut=We.put({modelPath:this.modelPath,modelArtifactsInfo:be}),bt;ut.onsuccess=()=>{bt=ne.transaction("models_store","readwrite");let St=bt.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:E,modelArtifactsInfo:be});St.onsuccess=()=>B({modelArtifactsInfo:be}),St.onerror=jt=>{We=Ae.objectStore("model_info_store");let Gt=We.delete(this.modelPath);Gt.onsuccess=()=>(ne.close(),V(St.error)),Gt.onerror=bn=>(ne.close(),V(St.error))}},ut.onerror=St=>(ne.close(),V(ut.error)),Ae.oncomplete=()=>{bt==null?ne.close():bt.oncomplete=()=>ne.close()}}},K.onerror=ne=>V(K.error)})}}return w.URL_SCHEME="indexeddb://",w})(),T=w=>{return Object(c.b)().getBool("IS_BROWSER")&&!Array.isArray(w)&&w.startsWith(N.URL_SCHEME)?(C=w.slice(N.URL_SCHEME.length),new N(C)):null;var C};f.registerSaveRouter(T),f.registerLoadRouter(T);class O{constructor(){this.indexedDB=y()}listModels(){return Te(this,null,function*(){return new Promise((C,I)=>{let E=this.indexedDB.open("tensorflowjs",1);E.onupgradeneeded=()=>v(E),E.onsuccess=()=>{let B=E.result,V=B.transaction("model_info_store","readonly"),K=V.objectStore("model_info_store").getAll();K.onsuccess=()=>{let ne={};for(let be of K.result)ne[be.modelPath]=be.modelArtifactsInfo;C(ne)},K.onerror=ne=>(B.close(),I(K.error)),V.oncomplete=()=>B.close()},E.onerror=B=>I(E.error)})})}removeModel(C){return Te(this,null,function*(){var I;return C=(I=C).startsWith(N.URL_SCHEME)?I.slice(N.URL_SCHEME.length):I,new Promise((E,B)=>{let V=this.indexedDB.open("tensorflowjs",1);V.onupgradeneeded=()=>v(V),V.onsuccess=()=>{let K=V.result,ne=K.transaction("model_info_store","readwrite"),be=ne.objectStore("model_info_store"),Ae=be.get(C),We;Ae.onsuccess=()=>{if(Ae.result==null)return K.close(),B(new Error(`Cannot find model with path '${C}' in IndexedDB.`));{let ut=be.delete(C),bt=()=>{We=K.transaction("models_store","readwrite");let St=We.objectStore("models_store").delete(C);St.onsuccess=()=>E(Ae.result.modelArtifactsInfo),St.onerror=jt=>B(Ae.error)};ut.onsuccess=bt,ut.onerror=St=>(bt(),K.close(),B(Ae.error))}},Ae.onerror=ut=>(K.close(),B(Ae.error)),ne.oncomplete=()=>{We==null?K.close():We.oncomplete=()=>K.close()}},V.onerror=K=>B(V.error)})})}}var S=e(16);let F="tensorflowjs_models",R="info",L="model_topology",q="weight_specs",U="weight_data",Z="model_metadata";function ee(w){return{info:[F,w,R].join("/"),topology:[F,w,L].join("/"),weightSpecs:[F,w,q].join("/"),weightData:[F,w,U].join("/"),modelMetadata:[F,w,Z].join("/")}}function Q(w){let C=w.split("/");if(C.length<3)throw new Error("Invalid key format: "+w);return C.slice(1,C.length-1).join("/")}let oe=(()=>{class w{constructor(I){if(!Object(c.b)().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,I==null||!I)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=I,this.keys=ee(this.modelPath)}save(I){return Te(this,null,function*(){if(I.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let E=JSON.stringify(I.modelTopology),B=JSON.stringify(I.weightSpecs),V=Object(h.g)(I);try{return this.LS.setItem(this.keys.info,JSON.stringify(V)),this.LS.setItem(this.keys.topology,E),this.LS.setItem(this.keys.weightSpecs,B),this.LS.setItem(this.keys.weightData,Object(h.a)(I.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:I.format,generatedBy:I.generatedBy,convertedBy:I.convertedBy,userDefinedMetadata:I.userDefinedMetadata})),{modelArtifactsInfo:V}}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${V.modelTopologyBytes}, weightSpecsBytes=${V.weightSpecsBytes}, weightDataBytes=${V.weightDataBytes}.`)}}})}load(){return Te(this,null,function*(){let I=JSON.parse(this.LS.getItem(this.keys.info));if(I==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(I.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let E={},B=JSON.parse(this.LS.getItem(this.keys.topology));if(B==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);E.modelTopology=B;let V=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(V==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);E.weightSpecs=V;let K=this.LS.getItem(this.keys.modelMetadata);if(K!=null){let be=JSON.parse(K);E.format=be.format,E.generatedBy=be.generatedBy,E.convertedBy=be.convertedBy,E.userDefinedMetadata=be.userDefinedMetadata}let ne=this.LS.getItem(this.keys.weightData);if(ne==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return E.weightData=Object(h.b)(ne),E})}}return w.URL_SCHEME="localstorage://",w})(),se=w=>{return Object(c.b)().getBool("IS_BROWSER")&&!Array.isArray(w)&&w.startsWith(oe.URL_SCHEME)?(C=w.slice(oe.URL_SCHEME.length),new oe(C)):null;var C};f.registerSaveRouter(se),f.registerLoadRouter(se);class pe{constructor(){Object(S.b)(Object(c.b)().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),Object(S.b)(typeof window>"u"||window.localStorage!==void 0,()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}listModels(){return Te(this,null,function*(){let C={},I=F+"/",E="/"+R;for(let B=0;B<this.LS.length;++B){let V=this.LS.key(B);V.startsWith(I)&&V.endsWith(E)&&(C[Q(V)]=JSON.parse(this.LS.getItem(V)))}return C})}removeModel(C){return Te(this,null,function*(){var I;let E=ee(C=(I=C).startsWith(oe.URL_SCHEME)?I.slice(oe.URL_SCHEME.length):I);if(this.LS.getItem(E.info)==null)throw new Error(`Cannot find model at path '${C}'`);let B=JSON.parse(this.LS.getItem(E.info));return this.LS.removeItem(E.info),this.LS.removeItem(E.topology),this.LS.removeItem(E.weightSpecs),this.LS.removeItem(E.weightData),B})}}class ae{constructor(){this.managers={}}static getInstance(){return ae.instance==null&&(ae.instance=new ae),ae.instance}static registerManager(C,I){Object(S.b)(C!=null,()=>"scheme must not be undefined or null."),C.endsWith("://")&&(C=C.slice(0,C.indexOf("://"))),Object(S.b)(C.length>0,()=>"scheme must not be an empty string.");let E=ae.getInstance();Object(S.b)(E.managers[C]==null,()=>`A model store manager is already registered for scheme '${C}'.`),E.managers[C]=I}static getManager(C){let I=this.getInstance().managers[C];if(I==null)throw new Error(`Cannot find model manager for scheme '${C}'`);return I}static getSchemes(){return Object.keys(this.getInstance().managers)}}function fe(w){if(w.indexOf("://")===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ae.getSchemes().join(","));return{scheme:w.split("://")[0],path:w.split("://")[1]}}function he(w,C,I=!1){return Te(this,null,function*(){Object(S.b)(w!==C,()=>`Old path and new path are the same: '${w}'`);let E=f.getLoadHandlers(w);Object(S.b)(E.length>0,()=>`Copying failed because no load handler is found for source URL ${w}.`),Object(S.b)(E.length<2,()=>`Copying failed because more than one (${E.length}) load handlers for source URL ${w}.`);let B=E[0],V=f.getSaveHandlers(C);Object(S.b)(V.length>0,()=>`Copying failed because no save handler is found for destination URL ${C}.`),Object(S.b)(V.length<2,()=>`Copying failed because more than one (${E.length}) save handlers for destination URL ${C}.`);let K=V[0],ne=fe(w).scheme,be=fe(w).path,Ae=ne===fe(w).scheme,We=yield B.load();I&&Ae&&(yield ae.getManager(ne).removeModel(be));let ut=yield K.save(We);return I&&!Ae&&(yield ae.getManager(ne).removeModel(be)),ut.modelArtifactsInfo})}function Ee(){return Te(this,null,function*(){let w=ae.getSchemes(),C={};for(let I of w){let E=yield ae.getManager(I).listModels();for(let B in E)C[I+"://"+B]=E[B]}return C})}function Le(w){return Te(this,null,function*(){let C=fe(w);return ae.getManager(C.scheme).removeModel(C.path)})}function Ve(w,C){return Te(this,null,function*(){return he(w,C,!1)})}function qe(w,C){return Te(this,null,function*(){return he(w,C,!0)})}class je{fetch(C,I){return fetch(C,I)}now(){return performance.now()}encode(C,I){if(I!=="utf-8"&&I!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+I);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(C)}decode(C,I){return new TextDecoder(I).decode(C)}}if(Object(c.b)().get("IS_BROWSER")){Object(c.b)().setPlatform("browser",new je);try{ae.registerManager(oe.URL_SCHEME,new pe)}catch{}try{ae.registerManager(N.URL_SCHEME,new O)}catch{}}e(159);var Ce=e(5);function tt(w,C="float32",I){return C=C||"float32",S.c(w),new Ce.b(w,C,I)}var ye=e(1),z=e(3),M=e(4);let W=Object(M.a)({cast_:function(w,C){let I=Object(z.a)(w,"x","cast");if(!S.B(C))throw new Error("Failed to cast to unknown dtype "+C);if(C==="string"&&I.dtype!=="string"||C!=="string"&&I.dtype==="string")throw new Error("Only strings can be casted to strings");let E={x:I},B={dtype:C};return u.a.runKernelFunc(V=>V.cast(I,C),E,null,ye.v,B)}});let ce=Object(M.a)({clone_:function(w){let C=Object(z.a)(w,"x","clone",null),I={x:C};return u.a.runKernelFunc(()=>u.a.makeTensorFromDataId(C.dataId,C.shape,C.dtype),I,null,ye.jb)}});Object(u.b)();let J={buffer:tt,cast:W,clone:ce,print:function(w,C=!1){console.log(w.toString(C))}};Object(Ce.e)(J);function Ie(w){return new Promise(C=>setTimeout(C)).then(w)}let Fe=(()=>{class w{constructor(I){if(!Object(c.b)().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");I.startsWith(w.URL_SCHEME)&&(I=I.slice(w.URL_SCHEME.length)),I!=null&&I.length!==0||(I="model"),this.modelTopologyFileName=I+".json",this.weightDataFileName=I+".weights.bin"}save(I){return Te(this,null,function*(){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let E=window.URL.createObjectURL(new Blob([I.weightData],{type:"application/octet-stream"}));if(I.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let B=[{paths:["./"+this.weightDataFileName],weights:I.weightSpecs}],V={modelTopology:I.modelTopology,format:I.format,generatedBy:I.generatedBy,convertedBy:I.convertedBy,weightsManifest:B},K=window.URL.createObjectURL(new Blob([JSON.stringify(V)],{type:"application/json"})),ne=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor;if(ne.download=this.modelTopologyFileName,ne.href=K,yield Ie(()=>ne.dispatchEvent(new MouseEvent("click"))),I.weightData!=null){let be=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;be.download=this.weightDataFileName,be.href=E,yield Ie(()=>be.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Object(h.g)(I)}}})}}return w.URL_SCHEME="downloads://",w})();class lt{constructor(C){if(C==null||C.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+C);this.files=C}load(){return Te(this,null,function*(){let C=this.files[0],I=this.files.slice(1);return new Promise((E,B)=>{let V=new FileReader;V.onload=K=>{let ne=JSON.parse(K.target.result),be=ne.modelTopology;if(be==null)return void B(new Error("modelTopology field is missing from file "+C.name));I.length===0&&E({modelTopology:be});let Ae=ne.weightsManifest;if(Ae==null)return void B(new Error("weightManifest field is missing from file "+C.name));let We;try{We=this.checkManifestAndWeightFiles(Ae,I)}catch(jt){return void B(jt)}let ut=[],bt=[],St=[];Ae.forEach(jt=>{jt.paths.forEach(Gt=>{bt.push(Gt),St.push(null)}),ut.push(...jt.weights)}),Ae.forEach(jt=>{jt.paths.forEach(Gt=>{let bn=new FileReader;bn.onload=Zn=>{let zn=Zn.target.result,tr=bt.indexOf(Gt);St[tr]=zn,St.indexOf(null)===-1&&E({modelTopology:be,weightSpecs:ut,weightData:Object(h.d)(St),format:ne.format,generatedBy:ne.generatedBy,convertedBy:ne.convertedBy,userDefinedMetadata:ne.userDefinedMetadata})},bn.onerror=Zn=>B(`Failed to weights data from file of path '${Gt}'.`),bn.readAsArrayBuffer(We[Gt])})})},V.onerror=K=>B(`Failed to read model topology and weights manifest JSON from file '${C.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),V.readAsText(C)})})}checkManifestAndWeightFiles(C,I){let E=[],B=I.map(K=>Object(h.c)(K.name)),V={};for(let K of C)K.paths.forEach(ne=>{let be=Object(h.c)(ne);if(E.indexOf(be)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${be}'`);if(E.push(be),B.indexOf(be)===-1)throw new Error(`Weight file with basename '${be}' is not provided.`);V[ne]=I[B.indexOf(be)]});if(E.length!==I.length)throw new Error(`Mismatch in the number of files in weights manifest (${E.length}) and the number of weight files provided (${I.length}).`);return V}}function Dt(w){return new lt(w)}function Ht(w,C,I,E){(function(V){Object(S.b)(V!=null&&Array.isArray(V)&&V.length>0,()=>"promises must be a none empty array")})(w),function(V,K){Object(S.b)(V>=0&&V<=1,()=>"Progress fraction must be in range [0, 1], but got startFraction "+V),Object(S.b)(K>=0&&K<=1,()=>"Progress fraction must be in range [0, 1], but got endFraction "+K),Object(S.b)(K>=V,()=>`startFraction must be no more than endFraction, but got startFraction ${V} and endFraction `+K)}(I=I??0,E=E??1);let B=0;return Promise.all(w.map(V=>(V.then(K=>{let ne=I+ ++B/w.length*(E-I);return C(ne),K}),V)))}f.registerSaveRouter(w=>Object(c.b)().getBool("IS_BROWSER")&&!Array.isArray(w)&&w.startsWith(Fe.URL_SCHEME)?function(C="model"){return new Fe(C)}(w.slice(Fe.URL_SCHEME.length)):null);var an=e(41);function cn(w,C){return Te(this,null,function*(){C==null&&(C={});let I=C.fetchFunc==null?Object(c.b)().platform.fetch:C.fetchFunc,E=w.map(V=>I(V,C.requestInit,{isBinary:!0})),B=(C.onProgress==null?yield Promise.all(E):yield Ht(E,C.onProgress,0,.5)).map(V=>V.arrayBuffer());return C.onProgress==null?yield Promise.all(B):yield Ht(B,C.onProgress,.5,1)})}function nn(w,C="",I,E){return Te(this,null,function*(){return Yn(B=>cn(B,{requestInit:E}))(w,C,I)})}function Yn(w){return(C,I="",E)=>Te(null,null,function*(){let B=C.map(()=>!1),V={},K=E!=null?E.map(()=>!1):[],ne=[];if(C.forEach((St,jt)=>{let Gt=0;St.weights.forEach(bn=>{let Zn="quantization"in bn?bn.quantization.dtype:bn.dtype,zn=an.a[Zn]*S.N(bn.shape),tr=()=>{B[jt]=!0,V[jt]==null&&(V[jt]=[]),V[jt].push({manifestEntry:bn,groupOffset:Gt,sizeBytes:zn})};E!=null?E.forEach((Or,Yr)=>{Or===bn.name&&(tr(),K[Yr]=!0)}):tr(),ne.push(bn.name),Gt+=zn})}),!K.every(St=>St)){let St=E.filter((jt,Gt)=>!K[Gt]);throw new Error("Could not find weights in manifest with names: "+St.join(", ")+`. 
Manifest JSON has weights with names: `+ne.join(", ")+".")}let be=B.reduce((St,jt,Gt)=>(jt&&St.push(Gt),St),[]),Ae=[];be.forEach(St=>{C[St].paths.forEach(jt=>{let Gt=I+(I.endsWith("/")?"":"/")+jt;Ae.push(Gt)})});let We=yield w(Ae),ut={},bt=0;return be.forEach(St=>{let jt=C[St].paths.length,Gt=0;for(let tr=0;tr<jt;tr++)Gt+=We[bt+tr].byteLength;let bn=new ArrayBuffer(Gt),Zn=new Uint8Array(bn),zn=0;for(let tr=0;tr<jt;tr++){let Or=new Uint8Array(We[bt+tr]);Zn.set(Or,zn),zn+=Or.byteLength}V[St].forEach(tr=>{let Or=bn.slice(tr.groupOffset,tr.groupOffset+tr.sizeBytes),Yr=Object(h.e)(Or,[tr.manifestEntry]);for(let Ro in Yr)ut[Ro]=Yr[Ro]}),bt+=jt}),ut})}class ln{constructor(C,I){if(this.DEFAULT_METHOD="POST",I==null&&(I={}),this.weightPathPrefix=I.weightPathPrefix,this.onProgress=I.onProgress,this.weightUrlConverter=I.weightUrlConverter,I.fetchFunc!=null?(Object(S.b)(typeof I.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=I.fetchFunc):this.fetch=Object(c.b)().platform.fetch,Object(S.b)(C!=null&&C.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(C)&&Object(S.b)(C.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${C.length}).`),this.path=C,I.requestInit!=null&&I.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=I.requestInit||{}}save(C){return Te(this,null,function*(){if(C.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let I=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);I.body=new FormData;let E=[{paths:["./model.weights.bin"],weights:C.weightSpecs}],B={modelTopology:C.modelTopology,format:C.format,generatedBy:C.generatedBy,convertedBy:C.convertedBy,userDefinedMetadata:C.userDefinedMetadata,weightsManifest:E};I.body.append("model.json",new Blob([JSON.stringify(B)],{type:"application/json"}),"model.json"),C.weightData!=null&&I.body.append("model.weights.bin",new Blob([C.weightData],{type:"application/octet-stream"}),"model.weights.bin");let V=yield this.fetch(this.path,I);if(V.ok)return{modelArtifactsInfo:Object(h.g)(C),responses:[V]};throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+V.status+".")})}load(){return Te(this,null,function*(){let C=yield this.fetch(this.path,this.requestInit);if(!C.ok)throw new Error(`Request to ${this.path} failed with status code `+C.status+". Please verify this URL points to the model JSON of the model to load.");let I;try{I=yield C.json()}catch{let jt=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?jt+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":jt+=" Please make sure the server is serving valid JSON for this request.",new Error(jt)}let E=I.modelTopology,B=I.weightsManifest,V=I.generatedBy,K=I.convertedBy,ne=I.format,be=I.userDefinedMetadata;if(E==null&&B==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let Ae,We;B!=null&&([Ae,We]=yield this.loadWeights(B));let ut={modelTopology:E,weightSpecs:Ae,weightData:We,userDefinedMetadata:be,generatedBy:V,convertedBy:K,format:ne},bt=I.modelInitializer;return bt&&(ut.modelInitializer=bt),ut})}loadWeights(C){return Te(this,null,function*(){let I=Array.isArray(this.path)?this.path[1]:this.path,[E,B]=function(We){let ut=We.lastIndexOf("/"),bt=We.lastIndexOf("?"),St=We.substring(0,ut),jt=bt>ut?We.substring(bt):"";return[St+"/",jt]}(I),V=this.weightPathPrefix||E,K=[];for(let We of C)K.push(...We.weights);let ne=[],be=[];for(let We of C)for(let ut of We.paths)this.weightUrlConverter!=null?be.push(this.weightUrlConverter(ut)):ne.push(V+ut+B);this.weightUrlConverter&&ne.push(...yield Promise.all(be));let Ae=yield cn(ne,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[K,Object(h.d)(Ae)]})}}function Qn(w){return w.match(ln.URL_SCHEME_REGEX)!=null}ln.URL_SCHEME_REGEX=/^https?:\/\//;let wn=(w,C)=>{if(typeof fetch>"u"&&(C==null||C.fetchFunc==null))return null;{let I=!0;if(I=Array.isArray(w)?w.every(E=>Qn(E)):Qn(w),I)return _r(w,C)}return null};function _r(w,C){return new ln(w,C)}function Ar(w,C){return _r(w,C)}f.registerSaveRouter(wn),f.registerLoadRouter(wn);class ss{constructor(C){this.modelArtifacts=C}load(){return Te(this,null,function*(){return this.modelArtifacts})}}class Qo{constructor(C){this.saveHandler=C}save(C){return Te(this,null,function*(){return this.saveHandler(C)})}}function Ws(w,C,I,E){return arguments.length===1?w.modelTopology!=null||w.weightSpecs!=null?new ss(w):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ss({modelTopology:w})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ss({modelTopology:w,weightSpecs:C,weightData:I,trainingConfig:E}))}function ki(w){return new Qo(w)}function Di(w,C,I){let E=w.shape.length;S.b(E===C.length,()=>`Error in slice${E}D: Length of begin ${C} must match the rank of the array (${E}).`),S.b(E===I.length,()=>`Error in slice${E}D: Length of size ${I} must match the rank of the array (${E}).`);for(let B=0;B<E;++B)S.b(C[B]+I[B]<=w.shape[B],()=>`Error in slice${E}D: begin[${B}] + size[${B}] (${C[B]+I[B]}) would overflow input.shape[${B}] (${w.shape[B]})`)}function Ai(w){let C=[],I=0;for(;w>0;)1&w&&C.push(I),w/=2,I++;return C}function ia(w,C,I){let E=[];for(let B=0;B<w.length;B++)E[B]=Math.ceil((C[B]-w[B])/I[B]);return E}function aa(w,C,I,E){let B=[...w];for(let V=B.length;V<E.length;V++)B.push(1);for(let V=0;V<I;V++)V===0?B[C]=1:(B.splice(C,0,1),B.pop());return B}function Nu(w,C,I){return I<=w?I:I-(C-1)}function vc(w,C){let I=[];for(let E=0;E<w;E++)I.push(C+E);return I}function eu(w,C,I,E,B,V,K,ne,be){let Ae=w.length,We=new Array(Ae),ut=new Array(Ae),bt=new Array(Ae);if(C.length&&I>0){let St=C[0],jt=I+1;We=ds(K,St,jt,E,w),ut=wc(ne,St,jt,B,w),bt=aa(V,St,jt,w)}else for(let St=0;St<Ae;St++)We[St]=fs(K,E,V,w,St,be),ut[St]=Ao(ne,B,V,w,St,be),bt[St]=ku(V,St,be);return{begin:We,end:ut,strides:bt}}function ds(w,C,I,E,B){let V=[...B],K=vc(I,C);for(let ne=0;ne<V.length;ne++)if(K.indexOf(ne)>-1)V[ne]=0;else{let be=Nu(C,I,ne),Ae=E[be];w&1<<be&&(Ae=0),V[ne]=Ae}return V}function wc(w,C,I,E,B){let V=[...B],K=vc(I,C);for(let ne=0;ne<V.length;ne++)if(K.indexOf(ne)>-1)V[ne]=Number.MAX_SAFE_INTEGER;else{let be=Nu(C,I,ne),Ae=E[be];w&1<<be&&(Ae=Number.MAX_SAFE_INTEGER),V[ne]=Ae}for(let ne=0;ne<V.length;ne++){let be=B[ne];V[ne]<0&&(V[ne]+=be),V[ne]=S.i(0,V[ne],B[ne])}return V}function ku(w,C,I){let E=w[C];return(I&1<<C||E==null)&&(E=1),E}function fs(w,C,I,E,B,V){let K=C[B],ne=I[B]||1;(w&1<<B||V&1<<B||K==null)&&(K=ne>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);let be=E[B];return K<0&&(K+=be),K=S.i(0,K,be-1),K}function Ao(w,C,I,E,B,V){let K=C[B],ne=I[B]||1;(w&1<<B||V&1<<B||K==null)&&(K=ne>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);let be=E[B];return K<0&&(K+=be),K=ne>0?S.i(0,K,be):S.i(-1,K,be-1),K}function Hs(w,C,I){let E=I.length;for(let B=0;B<I.length;B++)if(I[B]>1){E=B;break}for(let B=E+1;B<I.length;B++)if(C[B]>0||I[B]!==w[B])return!1;return!0}function bi(w,C){let I=w.length>0?w[w.length-1]:1;for(let E=0;E<w.length-1;E++)I+=w[E]*C[E];return I}function Sc(w,C,I){let E,B=w.shape.length,V;return E=typeof C=="number"?[C,...new Array(B-1).fill(0)]:C.length<B?C.concat(new Array(B-C.length).fill(0)):C.slice(),E.forEach(K=>{S.b(K!==-1,()=>"slice() does not support negative begin indexing.")}),V=I==null?new Array(B).fill(-1):typeof I=="number"?[I,...new Array(B-1).fill(-1)]:I.length<B?I.concat(new Array(B-I.length).fill(-1)):I,V=V.map((K,ne)=>K>=0?K:(S.b(K===-1,()=>`Negative size values should be exactly -1 but got ${K} for the slice() size at index ${ne}.`),w.shape[ne]-E[ne])),[E,V]}var po=e(7),Da=e(27),Oo=e(14);let xt=Object(M.a)({add_:function(w,C){let I=Object(z.a)(w,"a","add"),E=Object(z.a)(C,"b","add");[I,E]=Object(Oo.b)(I,E);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.add(I,E);return K([I,E]),ne},B,null,ye.d)}});let ze=Object(M.a)({reshape_:function(w,C){let I=Object(z.a)(w,"x","reshape",null),E={x:I},B={shape:C};return u.a.runKernelFunc((V,K)=>(C=S.s(C,I.size),S.b(I.size===S.N(C),()=>"new shape and old shape must have the same number of elements."),K([I]),V.reshape(I,C)),E,null,ye.bc,B)}});function Xt(w){return w==null?null:w.rank===0?ze(w,[w.size]):w.rank===1?w:w.rank===2?ze(w,[1,1,w.shape[0],w.shape[1]]):w.rank===3?ze(w,[1,w.shape[0],w.shape[1],w.shape[2]]):w}let Yt=Object(M.a)({batchNorm_:function(w,C,I,E,B,V){V==null&&(V=.001);let K=Object(z.a)(w,"x","batchNorm"),ne=Object(z.a)(C,"mean","batchNorm"),be=Object(z.a)(I,"variance","batchNorm"),Ae,We;B!=null&&(Ae=Object(z.a)(B,"scale","batchNorm")),E!=null&&(We=Object(z.a)(E,"offset","batchNorm")),S.b(ne.rank===be.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),S.b(We==null||ne.rank===We.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),S.b(Ae==null||ne.rank===Ae.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let ut=function(Gt){let bn;return bn=Gt.rank===0||Gt.rank===1?ze(Gt,[1,1,1,Gt.size]):Gt.rank===2?ze(Gt,[1,1,Gt.shape[0],Gt.shape[1]]):Gt.rank===3?ze(Gt,[1,Gt.shape[0],Gt.shape[1],Gt.shape[2]]):Gt,bn}(K),bt={x:ut,scale:Ae,offset:We,mean:ne,variance:be},St={varianceEpsilon:V},jt=u.a.runKernelFunc((Gt,bn)=>(bn([ut,ne,be,Ae]),Gt.batchNorm(ut,Xt(ne),Xt(be),Xt(We),Xt(Ae),V)),bt,null,ye.eb,St);return ze(jt,K.shape)}});function Qt(w,C){let I=w[0].length;w.forEach((B,V)=>{S.b(B.length===I,()=>`Error in concat${I}D: rank of tensors[${V}] must be the same as the rank of the rest (${I})`)}),S.b(C>=0&&C<I,()=>`Error in concat${I}D: axis must be between 0 and ${I-1}.`);let E=w[0];w.forEach((B,V)=>{for(let K=0;K<I;K++)S.b(K===C||B[K]===E[K],()=>`Error in concat${I}D: Shape of tensors[${V}] (${B}) does not match the shape of the rest (${E}) along the non-concatenated axis ${V}.`)})}function Gn(w,C){let I=w[0].slice();for(let E=1;E<w.length;E++)I[C]+=w[E][C];return I}var Un=e(24);let ar=Object(M.a)({concat_:function(w,C=0){Object(S.b)(w.length>=1,()=>"Pass at least one tensor to concat");let I=Object(z.b)(w,"tensors","concat");I[0].dtype==="complex64"&&I.forEach(V=>{if(V.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${V.dtype}. `)});let E=I,B={axis:C};return u.a.runKernelFunc((V,K)=>{let ne=Object(S.I)(C,I[0].shape)[0],be=Gn(I.map(We=>We.shape),ne);if(Object(S.N)(be)===0)return Object(Un.a)([],be);if(I=I.filter(We=>We.size>0),I.length===1)return I[0];Qt(I.map(We=>We.shape),ne);let Ae=V.concat(I,ne);return K(I),Ae},E,null,ye.z,B)}});function xe(w,C,I,E,B="NHWC",V){return pt(w,[...C,w[3]],I,V,E,null,null,Io(B))}function Pe(w,C,I,E,B,V,K="channelsLast"){let[ne,be]=pn(C),Ae;if(K==="channelsLast")Ae=[ne,be,w[3],w[3]];else{if(K!=="channelsFirst")throw new Error("Unknown dataFormat "+K);Ae=[ne,be,w[1],w[1]]}return pt(w,Ae,I,E,B,V,!1,K)}function Ge(w,C,I,E,B,V,K="NDHWC"){let[ne,be,Ae]=Fn(C),We,ut;if(K==="NDHWC")ut="channelsLast",We=[ne,be,Ae,w[4],w[4]];else{if(K!=="NCDHW")throw new Error("Unknown dataFormat "+K);ut="channelsFirst",We=[ne,be,Ae,w[1],w[1]]}return At(w,We,I,E,B,!1,ut,V)}function pt(w,C,I,E,B,V,K=!1,ne="channelsLast"){let[be,Ae,We,ut]=[-1,-1,-1,-1];if(ne==="channelsLast")[be,Ae,We,ut]=w;else{if(ne!=="channelsFirst")throw new Error("Unknown dataFormat "+ne);[be,ut,Ae,We]=w}let[bt,St,,jt]=C,[Gt,bn]=pn(I),[Zn,zn]=pn(E),tr=wr(bt,Zn),Or=wr(St,zn),{padInfo:Yr,outHeight:Ro,outWidth:ma}=function(Jo,cu,lu,ys,Zs,nc,Hi,Lc,rc){let Pu,ga,Ki;if(typeof Jo=="number"){Pu={top:Jo,bottom:Jo,left:Jo,right:Jo,type:Jo===0?"VALID":"NUMBER"};let ya=function(Xi,Pa,$a,Eo,Bc){Eo==null&&(Eo=qt(Xi,Pa,$a));let pu=Xi[0],yp=Xi[1],hu=Kn((pu-Pa+2*Eo)/$a+1,Bc);S.b(S.v(hu),()=>`The output # of rows (${hu}) must be an integer. Change the stride and/or zero pad parameters`);let xl=Kn((yp-Pa+2*Eo)/$a+1,Bc);return S.b(S.v(xl),()=>`The output # of columns (${xl}) must be an integer. Change the stride and/or zero pad parameters`),[hu,xl]}([cu,lu],nc,ys,Jo,Lc);ga=ya[0],Ki=ya[1]}else if(Jo==="same"){ga=Math.ceil(cu/ys),Ki=Math.ceil(lu/Zs);let ya=Math.max(0,(ga-1)*ys+nc-cu),Xi=Math.max(0,(Ki-1)*Zs+Hi-lu),Pa=Math.floor(ya/2),$a=ya-Pa,Eo=Math.floor(Xi/2);Pu={top:Pa,bottom:$a,left:Eo,right:Xi-Eo,type:"SAME"}}else if(Jo==="valid")Pu={top:0,bottom:0,left:0,right:0,type:"VALID"},ga=Math.ceil((cu-nc+1)/ys),Ki=Math.ceil((lu-Hi+1)/Zs);else{if(typeof Jo!="object")throw Error("Unknown padding parameter: "+Jo);{let ya=rc==="channelsLast"?Jo[1][0]:Jo[2][0],Xi=rc==="channelsLast"?Jo[1][1]:Jo[2][1],Pa=rc==="channelsLast"?Jo[2][0]:Jo[3][0],$a=rc==="channelsLast"?Jo[2][1]:Jo[3][1];Pu={top:ya,bottom:Xi,left:Pa,right:$a,type:ya===0&&Xi===0&&Pa===0&&$a===0?"VALID":"EXPLICIT"},ga=Kn((cu-nc+ya+Xi)/ys+1,Lc),Ki=Kn((lu-Hi+Pa+$a)/Zs+1,Lc)}}return{padInfo:Pu,outHeight:ga,outWidth:Ki}}(B,Ae,We,Gt,bn,tr,Or,V,ne),Wr=K?jt*ut:jt,Ts;return ne==="channelsFirst"?Ts=[be,Wr,Ro,ma]:ne==="channelsLast"&&(Ts=[be,Ro,ma,Wr]),{batchSize:be,dataFormat:ne,inHeight:Ae,inWidth:We,inChannels:ut,outHeight:Ro,outWidth:ma,outChannels:Wr,padInfo:Yr,strideHeight:Gt,strideWidth:bn,filterHeight:bt,filterWidth:St,effectiveFilterHeight:tr,effectiveFilterWidth:Or,dilationHeight:Zn,dilationWidth:zn,inShape:w,outShape:Ts,filterShape:C}}function At(w,C,I,E,B,V=!1,K="channelsLast",ne){let[be,Ae,We,ut,bt]=[-1,-1,-1,-1,-1];if(K==="channelsLast")[be,Ae,We,ut,bt]=w;else{if(K!=="channelsFirst")throw new Error("Unknown dataFormat "+K);[be,bt,Ae,We,ut]=w}let[St,jt,Gt,,bn]=C,[Zn,zn,tr]=Fn(I),[Or,Yr,Ro]=Fn(E),ma=wr(St,Or),Wr=wr(jt,Yr),Ts=wr(Gt,Ro),{padInfo:Jo,outDepth:cu,outHeight:lu,outWidth:ys}=function(Hi,Lc,rc,Pu,ga,Ki,ya,Xi,Pa,$a,Eo){let Bc,pu,yp,hu;if(typeof Hi=="number"){Bc={top:Hi,bottom:Hi,left:Hi,right:Hi,front:Hi,back:Hi,type:Hi===0?"VALID":"NUMBER"};let xl=function(bl,zc,$u,xp,Vc,gh){Vc==null&&(Vc=qt(bl,zc,xp));let Df=bl[0],zb=bl[1],Vb=bl[2],IS=Kn((Df-zc+2*Vc)/xp+1,gh);S.b(S.v(IS),()=>`The output # of depths (${IS}) must be an integer. Change the stride and/or zero pad parameters`);let _S=Kn((zb-zc+2*Vc)/xp+1,gh);S.b(S.v(_S),()=>`The output # of rows (${_S}) must be an integer. Change the stride and/or zero pad parameters`);let TS=Kn((Vb-zc+2*Vc)/xp+1,gh);return S.b(S.v(TS),()=>`The output # of columns (${TS}) must be an integer. Change the stride and/or zero pad parameters`),[IS,_S,TS,$u]}([Lc,rc,Pu,1],Xi,1,ga,Hi,Eo);pu=xl[0],yp=xl[1],hu=xl[2]}else if(Hi==="same"){pu=Math.ceil(Lc/ga),yp=Math.ceil(rc/Ki),hu=Math.ceil(Pu/ya);let xl=(pu-1)*ga+Xi-Lc,bl=(yp-1)*Ki+Pa-rc,zc=(hu-1)*ya+$a-Pu,$u=Math.floor(xl/2),xp=xl-$u,Vc=Math.floor(bl/2),gh=bl-Vc,Df=Math.floor(zc/2);Bc={top:Vc,bottom:gh,left:Df,right:zc-Df,front:$u,back:xp,type:"SAME"}}else{if(Hi!=="valid")throw Error("Unknown padding parameter: "+Hi);Bc={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},pu=Math.ceil((Lc-Xi+1)/ga),yp=Math.ceil((rc-Pa+1)/Ki),hu=Math.ceil((Pu-$a+1)/ya)}return{padInfo:Bc,outDepth:pu,outHeight:yp,outWidth:hu}}(B,Ae,We,ut,Zn,zn,tr,ma,Wr,Ts,ne),Zs=V?bn*bt:bn,nc;return K==="channelsFirst"?nc=[be,Zs,cu,lu,ys]:K==="channelsLast"&&(nc=[be,cu,lu,ys,Zs]),{batchSize:be,dataFormat:K,inDepth:Ae,inHeight:We,inWidth:ut,inChannels:bt,outDepth:cu,outHeight:lu,outWidth:ys,outChannels:Zs,padInfo:Jo,strideDepth:Zn,strideHeight:zn,strideWidth:tr,filterDepth:St,filterHeight:jt,filterWidth:Gt,effectiveFilterDepth:ma,effectiveFilterHeight:Wr,effectiveFilterWidth:Ts,dilationDepth:Or,dilationHeight:Yr,dilationWidth:Ro,inShape:w,outShape:nc,filterShape:C}}function qt(w,C,I,E=1){let B=wr(C,E);return Math.floor((w[0]*(I-1)-I+B)/2)}function pn(w){return typeof w=="number"?[w,w,w]:w.length===2?[w[0],w[1],1]:w}function Fn(w){return typeof w=="number"?[w,w,w]:w}function wr(w,C){return C<=1?w:w+(w-1)*(C-1)}function Kn(w,C){if(!C)return w;switch(C){case"round":return Math.round(w);case"ceil":return Math.ceil(w);case"floor":return Math.floor(w);default:throw new Error("Unknown roundingMode "+C)}}function yn(w){let[C,I,E]=pn(w);return C===1&&I===1&&E===1}function Cn(w,C){return yn(w)||yn(C)}function Io(w){if(w==="NHWC")return"channelsLast";if(w==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+w)}let Zo=Object(M.a)({conv2d_:function(w,C,I,E,B="NHWC",V=[1,1],K){let ne=Object(z.a)(w,"x","conv2d"),be=Object(z.a)(C,"filter","conv2d"),Ae=ne,We=!1;ne.rank===3&&(We=!0,Ae=ze(ne,[1,ne.shape[0],ne.shape[1],ne.shape[2]])),S.b(Ae.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${Ae.rank}.`),S.b(be.rank===4,()=>"Error in conv2d: filter must be rank 4, but got rank "+be.rank+"."),K!=null&&S.b(S.v(E),()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${K} but got pad ${E}.`);let ut=B==="NHWC"?Ae.shape[3]:Ae.shape[1];S.b(ut===be.shape[2],()=>`Error in conv2d: depth of input (${ut}) must match input depth for filter ${be.shape[2]}.`),S.b(Cn(I,V),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${I} and dilations '${V}'`);let bt={x:Ae,filter:be},St={strides:I,pad:E,dataFormat:B,dilations:V,dimRoundingMode:K},jt=u.a.runKernelFunc((Gt,bn)=>{let Zn=Io(B),zn=pt(Ae.shape,be.shape,I,V,E,K,!1,Zn),tr=Gt.conv2d(Ae,be,zn);return bn([Ae,be]),tr},bt,null,ye.A,St);return We?ze(jt,[jt.shape[1],jt.shape[2],jt.shape[3]]):jt}});function ji(w,C){for(let I=0;I<w.length;++I)if(w[w.length-I-1]!==C-1-I)return!1;return!0}function fg(w,C,I){let E=w.length+C.length,B=[],V=0,K=0;for(let ne=0;ne<E;ne++)I.indexOf(ne)===-1?B.push(w[V++]):B.push(C[K++]);return B}function mg(w,C){let I=[],E=w.length;for(let B=0;B<E;B++)C.indexOf(B)===-1&&I.push(w[B]);return[I,C.map(B=>w[B])]}function Ui(w,C){return fg(w,C.map(I=>1),C)}function Ps(w,C,I){S.b(ji(C,I),()=>w+` supports only inner-most axes for now. Got axes ${C} and rank-${I} input.`)}function qi(w,C){if(ji(w,C))return null;let I=[];for(let E=0;E<C;++E)w.indexOf(E)===-1&&I.push(E);return w.forEach(E=>I.push(E)),I}function ni(w){return w.map((C,I)=>[I,C]).sort((C,I)=>C[1]-I[1]).map(C=>C[0])}function Aa(w,C){let I=[];for(let E=C-w;E<C;++E)I.push(E);return I}let ms=Object(M.a)({transpose_:function(w,C){let I=Object(z.a)(w,"x","transpose");if(C==null&&(C=I.shape.map((V,K)=>K).reverse()),S.b(I.rank===C.length,()=>`Error in transpose: rank of input ${I.rank} must match length of perm ${C}.`),C.forEach(V=>{S.b(V>=0&&V<I.rank,()=>"All entries in 'perm' must be between 0 and "+(I.rank-1)+" but got "+C)}),I.rank<=1)return I.clone();let E={x:I},B={perm:C};return u.a.runKernelFunc(V=>V.transpose(I,C),E,null,ye.Gc,B)}});let eh=Object(M.a)({cumsum_:function(w,C=0,I=!1,E=!1){let B=Object(z.a)(w,"x","cumsum"),V={x:B},K={axis:C,exclusive:I,reverse:E};return u.a.runKernelFunc((ne,be)=>{let Ae=qi([C],B.rank),We=B;Ae!=null&&(We=ms(B,Ae));let ut=Aa(1,B.rank)[0],bt=ne.cumsum(We,ut,I,E);if(be([B]),Ae!=null){let St=ni(Ae);bt=ms(bt,St)}return bt},V,null,ye.J,K)}});let ul=Object(M.a)({depthwiseConv2d_:function(w,C,I,E,B="NHWC",V=[1,1],K){let ne=Object(z.a)(w,"x","depthwiseConv2d"),be=Object(z.a)(C,"filter","depthwiseConv2d"),Ae=ne,We=!1;ne.rank===3&&(We=!0,Ae=ze(ne,[1,ne.shape[0],ne.shape[1],ne.shape[2]])),S.b(Ae.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${Ae.rank}.`),S.b(be.rank===4,()=>"Error in depthwiseConv2d: filter must be rank 4, but got rank "+be.rank+"."),S.b(Ae.shape[3]===be.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${Ae.shape[3]}) must match the inChannels dimension in filter ${be.shape[2]}.`),K!=null&&S.b(S.v(E),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${K} but got pad ${E}.`);let ut={x:Ae,filter:be},bt={strides:I,pad:E,dataFormat:B,dilations:V,dimRoundingMode:K},St=u.a.runKernelFunc((jt,Gt)=>{V==null&&(V=[1,1]),S.b(Cn(I,V),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${I} and dilations '${V}'`);let bn=pt(Ae.shape,be.shape,I,V,E,K,!0),Zn=jt.depthwiseConv2D(Ae,be,bn);return Gt([Ae,be]),Zn},ut,null,ye.L,bt);return We?ze(St,[St.shape[1],St.shape[2],St.shape[3]]):St}});let gg=Object(M.a)({floorDiv_:function(w,C){let I=Object(z.a)(w,"a","floorDiv"),E=Object(z.a)(C,"b","floorDiv");[I,E]=Object(Oo.b)(I,E);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.floorDiv(I,E);return K([I,E]),ne},B,null,ye.cb)}});let qr=Object(M.a)({div_:function(w,C){let I=Object(z.a)(w,"a","div"),E=Object(z.a)(C,"b","div");if([I,E]=Object(Oo.b)(I,E),I.dtype==="int32"&&E.dtype==="int32")return gg(I,E);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.realDivide(I,E);return K([I,E]),ne},B,null,ye.R,{})}});let jo=Object(M.a)({matMul_:function(w,C,I=!1,E=!1){let B=Object(z.a)(w,"a","matMul"),V=Object(z.a)(C,"b","matMul");[B,V]=Object(Oo.b)(B,V);let K={a:B,b:V},ne={transposeA:I,transposeB:E};return u.a.runKernelFunc((be,Ae)=>{Ae([B,V]);let We=I?B.shape[B.rank-2]:B.shape[B.rank-1],ut=E?V.shape[V.rank-1]:V.shape[V.rank-2],bt=I?B.shape[B.rank-1]:B.shape[B.rank-2],St=E?V.shape[V.rank-2]:V.shape[V.rank-1],jt=B.shape.slice(0,-2),Gt=V.shape.slice(0,-2),bn=S.N(jt),Zn=S.N(Gt),zn=bn===Zn||bn===1||Zn===1;S.b(B.rank>=2&&V.rank>=2&&zn,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${jt}) and (${Gt}).`),S.b(We===ut,()=>`Error in matMul: inner shapes (${We}) and (${ut}) of Tensors with shapes ${B.shape} and ${V.shape} and transposeA=${I} and transposeB=${E} must match.`);let tr=(bn>Zn?jt:Gt).concat([bt,St]),Or=ze(B,I?[bn,We,bt]:[bn,bt,We]),Yr=ze(V,E?[Zn,St,ut]:[Zn,ut,St]),Ro=be.batchMatMul(Or,Yr,I,E);return ze(Ro,tr)},K,null,ye.s,ne)}});let ua=Object(M.a)({max_:function(w,C=null,I=!1){let E=Object(z.a)(w,"x","max"),B={x:E},V={reductionIndices:C,keepDims:I};return u.a.runKernelFunc((K,ne)=>{let be=S.I(C,E.shape),Ae=qi(be,E.rank),We=E;Ae!=null&&(We=ms(E,Ae),be=Aa(be.length,We.rank));let ut=K.max(We,be);Ae!=null&&We.dispose();let bt=ut;if(I){let St=Ui(bt.shape,S.I(C,E.shape));bt=ze(bt,St),ut.dispose()}return ne([E,bt]),bt},B,null,ye.yb,V)}});let lf=Object(M.a)({maxPool_:function(w,C,I,E,B){let V=Object(z.a)(w,"x","maxPool"),K=V,ne=!1;V.rank===3&&(ne=!0,K=ze(V,[1,V.shape[0],V.shape[1],V.shape[2]])),S.b(K.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${K.rank}.`),S.b(Cn(I,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${I} and dilations '1'`),B!=null&&S.b(S.v(E),()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${B} but got pad ${E}.`);let be={x:K},Ae={filterSize:C,strides:I,pad:E,dimRoundingMode:B},We=u.a.runKernelFunc((ut,bt)=>{let St=Pe(K.shape,C,I,1,E,B),jt;return jt=St.filterWidth===1&&St.filterHeight===1&&S.a(St.inShape,St.outShape)?K.clone():ut.maxPool(K,St),bt([K,jt]),jt},be,null,ye.zb,Ae);return ne?ze(We,[We.shape[1],We.shape[2],We.shape[3]]):We}});let rn=Object(M.a)({mul_:function(w,C){let I=Object(z.a)(w,"a","mul"),E=Object(z.a)(C,"b","mul");[I,E]=Object(Oo.b)(I,E);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.multiply(I,E);return K([I,E]),ne},B,null,ye.Kb)}});let yg=Object(M.a)({oneHot_:function(w,C,I=1,E=0){if(C<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+C);let B=Object(z.a)(w,"indices","oneHot","int32"),V=[...B.shape,C],K={indices:B},ne={depth:C,onValue:I,offValue:E};return u.a.runKernelFunc((be,Ae)=>(Ae([B]),ze(be.oneHot(ze(B,[B.size]),C,I,E),V)),K,null,ye.Qb,ne)}});let Yu=Object(M.a)({pow_:function(w,C){let I=Object(z.a)(w,"base","pow"),E=Object(z.a)(C,"exp","pow");[I,E]=Object(Oo.b)(I,E);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.pow(I,E);return K([I,E,ne]),ne},B,null,ye.Tb)}});var xg=e(47);class ca{constructor(C=0,I=1,E,B){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=C,this.range=I-C,this.dtype=E,B==null&&(B=Math.random()),typeof B=="number"&&(B=B.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${C} - ${I} <= 1 and dtype is not float`);this.random=xg.alea(B)}convertValue(C){return this.canReturnFloat()?C:Math.round(C)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}let rp=Object(M.a)({randomUniform_:function(w,C=0,I=1,E="float32",B){let V=tt(w,E),K=new ca(C,I,null,B);for(let ne=0;ne<V.values.length;ne++)V.values[ne]=K.nextValue();return V.toTensor()}});var Qu=e(28);function ri(w,C){Object(S.d)(w);let I=Object(z.c)(w,C);if(I.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Object(Qu.a)(w,null,I,C)}var Cc=e(19);function Oa(w,C="float32"){if(C==="complex64"){let E=Oa(w,"float32"),B=Oa(w,"float32");return Object(Cc.a)(E,B)}let I=Object(S.F)(Object(S.N)(w),C);return u.a.makeTensor(I,w,C)}function Cs(w,C,I=1,E="float32"){if(I===0)throw new Error("Cannot have a step of zero");let B={start:w,stop:C,step:I,dtype:E};return u.a.runKernelFunc(()=>{if(w===C||w<C&&I<0||C<w&&I>1)return Oa([0],E);let V=Math.abs(Math.ceil((C-w)/I)),K=Object(S.F)(V,E);C<w&&I===1&&(I=-1),K[0]=w;for(let ne=1;ne<K.length;ne++)K[ne]=K[ne-1]+I;return ri(K,E)},{},null,ye.Wb,B)}function yr(w,C){if((Object(S.A)(w)&&C!=="string"||Array.isArray(w))&&C!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(C==="string"&&Object(S.A)(w)&&!(w instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Object(Qu.a)(w,[],[],C)}let ho=Object(M.a)({separableConv2d_:function(w,C,I,E,B,V=[1,1],K="NHWC"){let ne=Object(z.a)(w,"x","separableConv2d"),be=Object(z.a)(C,"depthwiseFilter","separableConv2d"),Ae=Object(z.a)(I,"pointwiseFilter","separableConv2d"),We=ne,ut=!1;if(ne.rank===3&&(ut=!0,We=ze(ne,[1,ne.shape[0],ne.shape[1],ne.shape[2]])),K==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");S.b(We.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${We.rank}.`),S.b(be.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${be.rank}.`),S.b(Ae.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${be.rank}.`),S.b(Ae.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${Ae.shape[0]}.`),S.b(Ae.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${Ae.shape[1]}.`);let bt=be.shape[2],St=be.shape[3];S.b(Ae.shape[2]===bt*St,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${bt*St}, but got ${Ae.shape[2]}.`);let jt=ul(We,be,E,B,K,V),Gt=Zo(jt,Ae,1,"valid",K);return ut?ze(Gt,[Gt.shape[1],Gt.shape[2],Gt.shape[3]]):Gt}});let pf=Object(M.a)({softmax_:function(w,C=-1){let I=Object(z.a)(w,"logits","softmax","float32");if(C===-1&&(C=I.rank-1),C!==I.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${I.rank} and dim was ${C}`);let E={logits:I},B={dim:C};return u.a.runKernelFunc((V,K)=>{let ne=V.softmax(I,C);return K([ne]),ne},E,null,ye.rc,B)}});function Is(w,C,I=0){let E=[];if(typeof C=="number")Object(S.b)(w.shape[I]%C==0,()=>"Number of splits must evenly divide the axis."),E=new Array(C).fill(w.shape[I]/C);else{let B=C.reduce((K,ne)=>(ne===-1&&(K+=1),K),0);Object(S.b)(B<=1,()=>"There should be only one negative value in split array.");let V=C.indexOf(-1);if(V!==-1){let K=C.reduce((ne,be)=>be>0?ne+be:ne);C[V]=w.shape[I]-K}Object(S.b)(w.shape[I]===C.reduce((K,ne)=>K+ne),()=>"The sum of sizes must match the size of the axis dimension."),E=C}return E}let Gr=Object(M.a)({split_:function(w,C,I=0){let E=Object(z.a)(w,"x","split"),B={x:E},V={numOrSizeSplits:C,axis:I};return u.a.runKernelFunc((K,ne)=>{let be=Object(S.I)(I,E.shape)[0],Ae=Is(E,C,be);return K.split(E,Ae,be)},B,null,ye.uc,V)}});let th=Object(M.a)({squeeze_:function(w,C){let I=Object(z.a)(w,"x","squeeze");return ze(I,Object(S.P)(I.shape,C).newShape)}});let xr=Object(M.a)({sub_:function(w,C){let I=Object(z.a)(w,"a","sub"),E=Object(z.a)(C,"b","sub");[I,E]=Object(Oo.b)(I,E);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.subtract(I,E);return K([I,E]),ne},B,null,ye.Ac)}});let Gi=Object(M.a)({tile_:function(w,C){let I=Object(z.a)(w,"x","tile",null);S.b(I.rank===C.length,()=>`Error in transpose: rank of input ${I.rank} must match length of reps ${C}.`);let E=[I],B={x:I},V={reps:C};return u.a.runKernelFunc((K,ne)=>{let be=K.tile(I,C);return ne([I]),be},B,null,ye.Ec,V,E)}});let op=Object(M.a)({broadcastTo_:function(w,C){let I=Object(z.a)(w,"broadcastTo","x"),E=I.shape;if(C.some(be=>!(be>0)||be%1!=0))throw new Error(`broadcastTo(): Invalid broadcast shape [${C}].`);if(C.length<I.rank)throw new Error(`broadcastTo(): shape.length=${C.length} < input.rank=${I.rank}.`);if(C.length>I.rank){let be=I.shape.slice();for(;be.length<C.length;)be.unshift(1);I=ze(I,be)}let B=I.shape,V=Array.from(C);for(let be=C.length-1;be>=0;be--)if(B[be]===C[be])V[be]=1;else if(I.shape[be]!==1)throw new Error(`broadcastTo(): [${E}] cannot be broadcast to [${C}].`);if(V.map((be,Ae)=>be>1?Ae:-1).filter(be=>be>=0).length===0)return ce(I);let K={x:I},ne={shape:C,inputShape:B};return u.a.runKernelFunc(be=>be.tile(I,V),K,null,ye.u,ne)}});function hf(w,C){let I=w.length,E=[];for(let B=0;B<I;B++){let V=I-1-B,K=w[V]||1;(C[C.length-1-B]||1)>1&&K===1&&E.unshift(V)}return E}function _s(w,C){let I=[];for(let E=0;E<C.length;E++){let B=w[w.length-E-1],V=C.length-E-1,K=C[V];(B==null||B===1&&K>1)&&I.unshift(V)}return I}function oo(w,C){let I=[],E=Math.max(w.length,C.length);for(let B=0;B<E;B++){let V=w[w.length-B-1];V==null&&(V=1);let K=C[C.length-B-1];if(K==null&&(K=1),V===1)I.unshift(K);else if(K===1)I.unshift(V);else{if(V!==K)throw Error(`Operands could not be broadcast together with shapes ${w} and ${C}.`);I.unshift(V)}}return I}let Jr=Object(M.a)({where_:function(w,C,I){let E=Object(z.a)(C,"a","where"),B=Object(z.a)(I,"b","where"),V=Object(z.a)(w,"condition","where","bool"),K=oo(E.shape,B.shape),ne=op(E,K),be=op(B,K);V.rank===1&&Object(S.b)(V.shape[0]===E.shape[0],()=>"The first dimension of `a` must match the size of `condition`."),V.rank!==1&&Object(S.e)(V.shape,be.shape,"Error in where: ");let Ae={condition:V,t:ne,e:be};return u.a.runKernelFunc((We,ut)=>{let bt=We.select(V,ne,be);return ut([V]),bt},Ae,null,ye.kc)}});let _o=Object(M.a)({zerosLike_:function(w){let C=Object(z.a)(w,"x","zerosLike"),I={x:C};return u.a.runKernelFunc(E=>E.zerosLike(C),I,null,ye.Kc)}});let bg=Object(M.a)({imag_:function(w){let C=Object(z.a)(w,"input","imag"),I={input:C};return u.a.runKernelFunc(E=>E.imag(C),I,null,ye.kb)}});let sp=Object(M.a)({real_:function(w){let C=Object(z.a)(w,"input","real"),I={input:C};return u.a.runKernelFunc(E=>E.real(C),I,null,ye.Xb)}});let Uo=Object(M.a)({slice_:function(w,C,I){let E=Object(z.a)(w,"x","slice");if(E.rank===0)throw new Error("Slicing scalar is not possible");let B={x:E},V={begin:C,size:I};return u.a.runKernelFunc((K,ne)=>{let[be,Ae]=Sc(E,C,I);return Di(E,be,Ae),ne([E]),K.slice(E,be,Ae)},B,null,ye.qc,V)}});let gy=Object(M.a)({fft_:function(w){Object(S.b)(w.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${w.dtype}.`);let C={input:w};return u.a.runKernelFunc(I=>{let E=w.shape[w.shape.length-1],B=w.size/E,V=w.as2D(B,E);return I.fft(V).reshape(w.shape)},C,null,ye.Y)}});let vg=Object(M.a)({rfft_:function(w,C){Object(S.b)(w.dtype==="float32",()=>"The dtype for rfft() must be real value but got "+w.dtype);let I=w.shape[w.shape.length-1],E=w.size/I,B;if(C!=null&&C<I){let jt=w.shape.map(bn=>0),Gt=w.shape.map(bn=>bn);Gt[w.shape.length-1]=C,B=Uo(w,jt,Gt),I=C}else if(C!=null&&C>I){let jt=w.shape.map(Gt=>Gt);jt[w.shape.length-1]=C-I,B=ar([w,Oa(jt)],w.shape.length-1),I=C}else B=w;let V=_o(B),K=ze(Object(Cc.a)(B,V),[E,I]),ne=gy(K),be=Math.floor(I/2)+1,Ae=sp(ne),We=bg(ne),ut=Gr(Ae,[be,I-be],Ae.shape.length-1),bt=Gr(We,[be,I-be],We.shape.length-1),St=B.shape.slice();return St[B.shape.length-1]=be,ze(Object(Cc.a)(ut[0],bt[0]),St)}});let nh=Object(M.a)({ifft_:function(w){Object(S.b)(w.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${w.dtype}.`);let C={input:w};return u.a.runKernelFunc(I=>{let E=w.shape[w.shape.length-1],B=w.size/E,V=ze(w,[B,E]),K=I.ifft(V);return ze(K,w.shape)},C,null,ye.ib)}});let rh=Object(M.a)({reverse_:function(w,C){let I=Object(z.a)(w,"x","reverse"),E={x:I},B={dims:C};return u.a.runKernelFunc(V=>{let K=Object(S.I)(C,I.shape);if(I.rank===0)return ce(I);let ne=V.reverse(I,K);return ze(ne,I.shape)},E,null,ye.gc,B)}});let Wx=Object(M.a)({irfft_:function(w){let C=w.shape[w.shape.length-1],I=w.size/C,E;if(C<=2){let B=ze(w,[I,C]);E=nh(B)}else{let B=[I,2*(C-1)],V=ze(sp(w),[I,C]),K=ze(bg(w),[I,C]),ne=rh(Uo(V,[0,1],[I,C-2]),1),be=rn(rh(Uo(K,[0,1],[I,C-2]),1),yr(-1)),Ae=ar([V,ne],1),We=ar([K,be],1),ut=ze(Object(Cc.a)(Ae,We),[B[0],B[1]]);E=nh(ut)}if(E=sp(E),w.rank===3&&w.shape[0]!==0){let B=E,V=w.shape[0];E=ze(E,[V,E.shape[0]/V,E.shape[1]]),B.dispose()}return E}});function df(w,C,I){let E=1-w%2,B=new Float32Array(w);for(let V=0;V<w;++V){let K=2*Math.PI*V/(w+E-1);B[V]=C-I*Math.cos(K)}return ri(B,"float32")}Object(M.a)({hammingWindow_:function(w){return df(w,.54,.46)}});let Hx=Object(M.a)({hannWindow_:function(w){return df(w,.5,.5)}});function Zu(w,C,I){let E={shape:w,value:C,dtype:I};return u.a.runKernelFunc(B=>B.fill(w,C,I),{},null,ye.Z,E)}function Ic(w,C,I){if(Object(S.d)(w),C!=null&&C.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let E=Object(z.c)(w,I);if(E.length!==2&&E.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(E.length===1&&C==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Object(Qu.a)(w,C,E,I)}let tu=Object(M.a)({frame_:function(w,C,I,E=!1,B=0){let V=0,K=[];for(;V+C<=w.size;)K.push(Uo(w,V,C)),V+=I;if(E)for(;V<w.size;){let ne=V+C-w.size,be=ar([Uo(w,V,C-ne),Zu([ne],B)]);K.push(be),V+=I}return K.length===0?Ic([],[0,C]):ze(ar(K),[K.length,C])}});Object(M.a)({stft_:function(w,C,I,E,B=Hx){var V;E==null&&(V=C,E=Math.floor(Math.pow(2,Math.ceil(Math.log(V)/Math.log(2)))));let K=tu(w,C,I),ne=rn(K,B(C)),be=[];for(let Ae=0;Ae<K.shape[0];Ae++)be.push(vg(Uo(ne,[Ae,0],[1,C]),E));return ar(be)}});Object(M.a)({cropAndResize_:function(w,C,I,E,B,V){let K=Object(z.a)(w,"image","cropAndResize"),ne=Object(z.a)(C,"boxes","cropAndResize","float32"),be=Object(z.a)(I,"boxInd","cropAndResize","int32");B=B||"bilinear",V=V||0;let Ae=ne.shape[0];S.b(K.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${K.rank}.`),S.b(ne.rank===2&&ne.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${Ae},4] but had shape ${ne.shape}.`),S.b(be.rank===1&&be.shape[0]===Ae,()=>`Error in cropAndResize: boxInd must be have size [${Ae}] but had shape ${ne.shape}.`),S.b(E.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${E.length}.`),S.b(E[0]>=1&&E[1]>=1,()=>"cropSize must be atleast [1,1], but was "+E),S.b(B==="bilinear"||B==="nearest",()=>"method must be bilinear or nearest, but was "+B);let We={image:K,boxes:ne,boxInd:be},ut={method:B,extrapolationValue:V,cropSize:E};return u.a.runKernelFunc(bt=>bt.cropAndResize(K,ne,be,E,B,V),We,null,ye.I,ut)}});Object(M.a)({flipLeftRight_:function(w){let C=Object(z.a)(w,"image","flipLeftRight","float32");S.b(C.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${C.rank}.`);let I={image:C};return u.a.runKernel(ye.ab,I,{})}});Object(M.a)({rotateWithOffset_:function(w,C,I=0,E=.5){let B=Object(z.a)(w,"image","rotateWithOffset","float32");S.b(B.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${B.rank}.`);let V={image:B},K={radians:C,fillValue:I,center:E};return u.a.runKernel(ye.hc,V,K)}});function yy(w,C,I,E,B,V){E==null&&(E=.5),B==null&&(B=Number.NEGATIVE_INFINITY),V==null&&(V=0);let K=w.shape[0];return I=Math.min(I,K),S.b(0<=E&&E<=1,()=>`iouThreshold must be in [0, 1], but was '${E}'`),S.b(w.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${w.rank}'`),S.b(w.shape[1]===4,()=>"boxes must have 4 columns, but 2nd dimension was "+w.shape[1]),S.b(C.rank===1,()=>"scores must be a 1D tensor"),S.b(C.shape[0]===K,()=>`scores has incompatible shape with boxes. Expected ${K}, but was `+C.shape[0]),S.b(0<=V&&V<=1,()=>`softNmsSigma must be in [0, 1], but was '${V}'`),{maxOutputSize:I,iouThreshold:E,scoreThreshold:B,softNmsSigma:V}}Object(M.a)({nonMaxSuppression_:function(w,C,I,E=.5,B=Number.NEGATIVE_INFINITY){let V=Object(z.a)(w,"boxes","nonMaxSuppression"),K=Object(z.a)(C,"scores","nonMaxSuppression"),ne=yy(V,K,I,E,B);I=ne.maxOutputSize,E=ne.iouThreshold,B=ne.scoreThreshold;let be={maxOutputSize:I,iouThreshold:E,scoreThreshold:B};return u.a.runKernelFunc(Ae=>Ae.nonMaxSuppression(V,K,I,E,B),{boxes:V,scores:K},null,ye.Mb,be)}});function Du(w,C,I){let E=function(V,K,ne){return function(be,Ae,We){let ut=0,bt=be.length,St=0,jt=!1;for(;ut<bt;){St=ut+(bt-ut>>>1);let Gt=We(Ae,be[St]);Gt>0?ut=St+1:(bt=St,jt=!Gt)}return jt?ut:-ut-1}(V,K,ne||Kx)}(w,C,I),B=E<0?-(E+1):E;w.splice(B,0,C)}function Kx(w,C){return w>C?1:w<C?-1:0}function W2(w,C,I,E,B){return Au(w,C,I,E,B,0).selectedIndices}function H2(w,C,I,E,B,V){return Au(w,C,I,E,B,0,!1,V,!0)}function ff(w,C,I,E,B,V){return Au(w,C,I,E,B,V,!0)}function Au(w,C,I,E,B,V,K=!1,ne=!1,be=!1){let Ae=[];for(let bn=0;bn<C.length;bn++)C[bn]>B&&Ae.push({score:C[bn],boxIndex:bn,suppressBeginIndex:0});Ae.sort(Yx);let We=V>0?-.5/V:0,ut=[],bt=[];for(;ut.length<I&&Ae.length>0;){let bn=Ae.pop(),{score:Zn,boxIndex:zn,suppressBeginIndex:tr}=bn;if(Zn<B)break;let Or=!1;for(let Yr=ut.length-1;Yr>=tr;--Yr){let Ro=Xx(w,zn,ut[Yr]);if(Ro>=E){Or=!0;break}if(bn.score=bn.score*_c(E,We,Ro),bn.score<=B)break}bn.suppressBeginIndex=ut.length,Or||(bn.score===Zn?(ut.push(zn),bt.push(bn.score)):bn.score>B&&Du(Ae,bn,Yx))}let St=ut.length,jt=I-St;ne&&jt>0&&(ut.push(...new Array(jt).fill(0)),bt.push(...new Array(jt).fill(0)));let Gt={selectedIndices:ri(ut,"int32")};return K&&(Gt.selectedScores=ri(bt,"float32")),be&&(Gt.validOutputs=yr(St,"int32")),Gt}function Xx(w,C,I){let E=w.subarray(4*C,4*C+4),B=w.subarray(4*I,4*I+4),V=Math.min(E[0],E[2]),K=Math.min(E[1],E[3]),ne=Math.max(E[0],E[2]),be=Math.max(E[1],E[3]),Ae=Math.min(B[0],B[2]),We=Math.min(B[1],B[3]),ut=Math.max(B[0],B[2]),bt=Math.max(B[1],B[3]),St=(ne-V)*(be-K),jt=(ut-Ae)*(bt-We);if(St<=0||jt<=0)return 0;let Gt=Math.max(V,Ae),bn=Math.max(K,We),Zn=Math.min(ne,ut),zn=Math.min(be,bt),tr=Math.max(Zn-Gt,0)*Math.max(zn-bn,0);return tr/(St+jt-tr)}function _c(w,C,I){let E=Math.exp(C*I*I);return I<=w?E:0}function Yx(w,C){return w.score-C.score||w.score===C.score&&C.boxIndex-w.boxIndex}Object(M.a)({nonMaxSuppressionWithScore_:function(w,C,I,E=.5,B=Number.NEGATIVE_INFINITY,V=0){let K=Object(z.a)(w,"boxes","nonMaxSuppression"),ne=Object(z.a)(C,"scores","nonMaxSuppression"),be=yy(K,ne,I,E,B,V),Ae={boxes:K,scores:ne},We={maxOutputSize:I=be.maxOutputSize,iouThreshold:E=be.iouThreshold,scoreThreshold:B=be.scoreThreshold,softNmsSigma:V=be.softNmsSigma},ut=u.a.runKernel(ye.Ob,Ae,We);return{selectedIndices:ut[0],selectedScores:ut[1]}}});Object(M.a)({nonMaxSuppressionPadded_:function(w,C,I,E=.5,B=Number.NEGATIVE_INFINITY,V=!1){let K=Object(z.a)(w,"boxes","nonMaxSuppression"),ne=Object(z.a)(C,"scores","nonMaxSuppression"),be=yy(K,ne,I,E,B,null),Ae={boxes:K,scores:ne},We={maxOutputSize:be.maxOutputSize,iouThreshold:be.iouThreshold,scoreThreshold:be.scoreThreshold,padToMaxOutputSize:V},ut=u.a.runKernel(ye.Nb,Ae,We);return{selectedIndices:ut[0],validOutputs:ut[1]}}});let cl=Object(M.a)({resizeBilinear_:function(w,C,I=!1){let E=Object(z.a)(w,"images","resizeBilinear");S.b(E.rank===3||E.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${E.rank}.`),S.b(C.length===2,()=>"Error in resizeBilinear: new shape must 2D, but got shape "+C+".");let B=E,V=!1;E.rank===3&&(V=!0,B=ze(E,[1,E.shape[0],E.shape[1],E.shape[2]]));let[K,ne]=C,be={images:B},Ae={alignCorners:I,size:C},We=u.a.runKernelFunc((ut,bt)=>(bt([B]),ut.resizeBilinear(B,K,ne,I)),be,null,ye.cc,Ae);return V?ze(We,[We.shape[1],We.shape[2],We.shape[3]]):We}});let K2=Object(M.a)({resizeNearestNeighbor_:function(w,C,I=!1){let E=Object(z.a)(w,"images","resizeNearestNeighbor");S.b(E.rank===3||E.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${E.rank}.`),S.b(C.length===2,()=>"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+C+"."),S.b(E.dtype==="float32"||E.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype");let B=E,V=!1;E.rank===3&&(V=!0,B=ze(E,[1,E.shape[0],E.shape[1],E.shape[2]]));let[K,ne]=C,be={images:B},Ae={alignCorners:I,size:C},We=u.a.runKernelFunc((ut,bt)=>(bt([B]),ut.resizeNearestNeighbor(B,K,ne,I)),be,null,ye.ec,Ae);return V?ze(We,[We.shape[1],We.shape[2],We.shape[3]]):We}});let oh=Object(M.a)({greaterEqual_:function(w,C){let I=Object(z.a)(w,"a","greaterEqual"),E=Object(z.a)(C,"b","greaterEqual");[I,E]=Object(Oo.b)(I,E),oo(I.shape,E.shape);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.greaterEqual(I,E);return K([I,E]),ne},B,null,ye.hb)}});let sh=Object(M.a)({lessEqual_:function(w,C){let I=Object(z.a)(w,"a","lessEqual"),E=Object(z.a)(C,"b","lessEqual");[I,E]=Object(Oo.b)(I,E),oo(I.shape,E.shape);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.lessEqual(I,E);return K([I,E]),ne},B,null,ye.rb)}});let ih=Object(M.a)({logicalAnd_:function(w,C){let I=Object(z.a)(w,"a","logicalAnd","bool"),E=Object(z.a)(C,"b","logicalAnd","bool");oo(I.shape,E.shape);let B={a:I,b:E};return u.a.runKernelFunc(V=>V.logicalAnd(I,E),B,null,ye.vb)}});let Ju=Object(M.a)({expandDims_:function(w,C=0){let I=Object(z.a)(w,"x","expandDims",null);S.b(C<=I.rank,()=>"Axis must be <= rank of the tensor");let E=I.shape.slice();return C<0&&(S.b(-(I.rank+1)<=C,()=>`Axis must be in the interval [${-(I.rank+1)}, ${I.rank}]`),C=I.rank+C+1),E.splice(C,0,1),ze(I,E)}});let nu=Object(M.a)({stack_:function(w,C=0){let I=Object(z.b)(w,"tensors","stack");if(S.b(I.length>=1,()=>"Pass at least one tensor to tf.stack"),I.length===1)return Ju(I[0],C);let E=I[0].rank,B=I[0].shape,V=I[0].dtype;S.b(C<=E,()=>"Axis must be <= rank of the tensor"),I.forEach(ne=>{S.e(B,ne.shape,"All tensors passed to stack must have matching shapes"),S.b(V===ne.dtype,()=>"All tensors passed to stack must have matching dtypes")});let K=I.map(ne=>Ju(ne,C));return ar(K,C)}});let xy=Object(M.a)({unstack_:function(w,C=0){let I=Object(z.a)(w,"x","unstack");S.b(C>=-I.shape.length&&C<I.shape.length,()=>`Axis = ${C} is not in [-${I.shape.length}, ${I.shape.length})`),C<0&&(C+=I.shape.length);let E={value:I},B={axis:C};return u.a.runKernelFunc(V=>V.unstack(I,C),E,null,ye.Ic,B)}});Object(M.a)({bandPart_:function(w,C,I){Object(S.b)(C%1==0,()=>`bandPart(): numLower must be an integer, got ${C}.`),Object(S.b)(I%1==0,()=>`bandPart(): numUpper must be an integer, got ${I}.`);let E=Object(z.a)(w,"a","bandPart");Object(S.b)(E.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${E.rank}.`);let B=E.shape,[V,K]=E.shape.slice(-2);if(!(C<=V))throw new Error(`bandPart(): numLower (${C}) must not be greater than the number of rows (${V}).`);if(!(I<=K))throw new Error(`bandPart(): numUpper (${I}) must not be greater than the number of columns (${K}).`);C<0&&(C=V),I<0&&(I=K);let ne=ze(Cs(0,V,1,"int32"),[-1,1]),be=Cs(0,K,1,"int32"),Ae=xr(ne,be),We=ih(sh(Ae,yr(+C,"int32")),oh(Ae,yr(-I,"int32"))),ut=Oa([V,K],E.dtype);return ze(nu(xy(ze(E,[-1,V,K])).map(bt=>Jr(We,bt,ut))),B)}});let ru=Object(M.a)({abs_:function(w){let C=Object(z.a)(w,"x","abs"),I={x:C};return u.a.runKernelFunc((E,B)=>(B([C]),C.dtype==="complex64"?E.complexAbs(C):E.abs(C)),I,null,ye.a)}}),wg=Object(M.a)({min_:function(w,C=null,I=!1){let E=Object(z.a)(w,"x","min"),B={x:E},V={axis:C,keepDims:I};return u.a.runKernelFunc((K,ne)=>{let be=Object(S.I)(C,E.shape),Ae=be,We=qi(Ae,E.rank),ut=E;We!=null&&(ut=ms(E,We),Ae=Aa(Ae.length,E.rank));let bt=K.min(ut,Ae);We!=null&&ut.dispose();let St=bt;if(I){let jt=Ui(St.shape,be);St=ze(bt,jt),bt.dispose()}return ne([E,St]),St},B,null,ye.Gb,V)}});let ec=Object(M.a)({sqrt_:function(w){let C=Object(z.a)(w,"x","sqrt"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.sqrt(C);return B([C]),V},I,null,ye.vc)}});let Ks=Object(M.a)({square_:function(w){let C=Object(z.a)(w,"x","square"),I=[C];return u.a.runKernelFunc((E,B)=>(B([C]),E.square(C)),{x:C},null,"Square",{},I,[])}});let fr=Object(M.a)({sum_:function(w,C=null,I=!1){let E=Object(z.a)(w,"x","sum");E.dtype==="bool"&&(E=W(E,"int32"));let B={x:E},V={axis:C,keepDims:I};return u.a.runKernelFunc((K,ne)=>{ne([E]);let be=Object(S.I)(C,E.shape),Ae=qi(be,E.rank),We=be,ut=E;Ae!=null&&(ut=ms(E,Ae),We=Aa(We.length,E.rank));let bt=K.sum(ut,We);if(I){let St=Ui(bt.shape,be);bt=ze(bt,St)}return bt},B,null,ye.Bc,V)}});let by=Object(M.a)({norm_:function(w,C="euclidean",I=null,E=!1){let B=function K(ne,be,Ae=null){if(ne.rank===0)return ru(ne);if(ne.rank!==1&&Ae===null)return K(ze(ne,[-1]),be,Ae);if(ne.rank===1||typeof Ae=="number"||Array.isArray(Ae)&&Ae.length===1){if(be===1)return fr(ru(ne),Ae);if(be===1/0)return ua(ru(ne),Ae);if(be===-1/0)return wg(ru(ne),Ae);if(be==="euclidean"||be===2)return ec(fr(Yu(ru(ne),yr(2,"int32")),Ae));throw new Error("Error in norm: invalid ord value: "+be)}if(Array.isArray(Ae)&&Ae.length===2){if(be===1)return ua(fr(ru(ne),Ae[0]),Ae[1]-1);if(be===1/0)return ua(fr(ru(ne),Ae[1]),Ae[0]);if(be===-1/0)return wg(fr(ru(ne),Ae[1]),Ae[0]);if(be==="fro"||be==="euclidean")return ec(fr(Ks(ne),Ae));throw new Error("Error in norm: invalid ord value: "+be)}throw new Error("Error in norm: invalid axis: "+Ae)}(w=Object(z.a)(w,"x","norm"),C,I),V=B.shape;if(E){let K=Object(S.I)(I,w.shape);V=Ui(B.shape,K)}return ze(B,V)}});Object(M.a)({gramSchmidt_:function(w){let C;if(Array.isArray(w)){C=!1,Object(S.b)(w!=null&&w.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let B=w[0].shape[0];for(let V=1;V<w.length;++V)Object(S.b)(w[V].shape[0]===B,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${w[V].shape[0]} vs. ${B})`)}else C=!0,w=Gr(w,w.shape[0],0).map(B=>th(B,[0]));Object(S.b)(w.length<=w[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${w.length}) exceeds number of dimensions (${w[0].shape[0]}).`);let I=[],E=w;for(let B=0;B<w.length;++B)I.push(u.a.tidy(()=>{let V=E[B];if(B>0)for(let K=0;K<B;++K){let ne=rn(fr(rn(I[K],V)),I[K]);V=xr(V,ne)}return qr(V,by(V,"euclidean"))}));return C?nu(I,0):I}});function Xs(w){Object(c.b)().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(w+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Qx(){return u.a}function Zx(w,C){return u.a.tidy(w,C)}function Jx(w){Object(Oo.a)(w).forEach(C=>C.dispose())}function Fr(w,C,I=1){return u.a.registerBackend(w,C,I)}Object(Ce.d)(Xs);let eb=Object(M.a)({eye_:function(w,C,I,E="float32"){C==null&&(C=w);let B=tt([w,C],E),V=w<=C?w:C;for(let ne=0;ne<V;++ne)B.set(1,ne,ne);let K=ze(B.toTensor(),[w,C]);if(I==null)return K;if(I.length===1)return Gi(Ju(K,0),[I[0],1,1]);if(I.length===2)return Gi(Ju(Ju(K,0),0),[I[0],I[1],1,1]);if(I.length===3)return Gi(Ju(Ju(Ju(K,0),0),0),[I[0],I[1],I[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${I.length}D.`)}});let Ou=Object(M.a)({greater_:function(w,C){let I=Object(z.a)(w,"a","greater"),E=Object(z.a)(C,"b","greater");[I,E]=Object(Oo.b)(I,E),oo(I.shape,E.shape);let B={a:I,b:E};return u.a.runKernelFunc(V=>V.greater(I,E),B,null,ye.gb)}});let $s=Object(M.a)({neg_:function(w){let C=Object(z.a)(w,"x","neg"),I={x:C};return u.a.runKernelFunc(E=>E.neg(C),I,null,ye.Lb)}});function vy(w,C=!1){return u.a.tidy(()=>{Object(S.b)(w.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${w.shape.length}D Tensor.`);let I=w.shape[0],E=w.shape[1],B=eb(I),V=ce(w),K=Ic([[1]],[1,1]),ne=ce(K),be=I>=E?E:I;for(let Ae=0;Ae<be;++Ae){let We=V,ut=ne,bt=B;[ne,V,B]=u.a.tidy(()=>{let St=Uo(V,[Ae,Ae],[I-Ae,1]),jt=by(St),Gt=Uo(V,[Ae,Ae],[1,1]),bn=Jr(Ou(Gt,0),Ic([[-1]]),Ic([[1]])),Zn=xr(Gt,rn(bn,jt)),zn=qr(St,Zn);ne=zn.shape[0]===1?ce(K):ar([K,Uo(zn,[1,0],[zn.shape[0]-1,zn.shape[1]])],0);let tr=$s(qr(jo(bn,Zn),jt)),Or=Uo(V,[Ae,0],[I-Ae,E]),Yr=rn(tr,ne),Ro=ms(ne);if(Ae===0)V=xr(Or,jo(Yr,jo(Ro,Or)));else{let Ts=xr(Or,jo(Yr,jo(Ro,Or)));V=ar([Uo(V,[0,0],[Ae,E]),Ts],0)}let ma=ms(Yr),Wr=Uo(B,[0,Ae],[I,B.shape[1]-Ae]);if(Ae===0)B=xr(Wr,jo(jo(Wr,ne),ma));else{let Ts=xr(Wr,jo(jo(Wr,ne),ma));B=ar([Uo(B,[0,0],[I,Ae]),Ts],1)}return[ne,V,B]}),Jx([We,ut,bt])}return!C&&I>E&&(B=Uo(B,[0,0],[I,E]),V=Uo(V,[0,0],[E,E])),[B,V]})}Object(M.a)({qr_:function(w,C=!1){if(Object(S.b)(w.rank>=2,()=>"qr() requires input tensor to have a rank >= 2, but got rank "+w.rank),w.rank===2)return vy(w,C);{let I=w.shape.slice(0,w.shape.length-2).reduce((K,ne)=>K*ne),E=xy(ze(w,[I,w.shape[w.shape.length-2],w.shape[w.shape.length-1]]),0),B=[],V=[];return E.forEach(K=>{let[ne,be]=vy(K,C);B.push(ne),V.push(be)}),[ze(nu(B,0),w.shape),ze(nu(V,0),w.shape)]}}});var Wi;function Sg(w){return u.a.customGrad(w)}function ip(w,C="float32"){if(C==="complex64"){let E=ip(w,"float32"),B=Oa(w,"float32");return Object(Cc.a)(E,B)}let I=Object(S.D)(Object(S.N)(w),C);return u.a.makeTensor(I,w,C)}(function(w){w[w.NONE=0]="NONE",w[w.MEAN=1]="MEAN",w[w.SUM=2]="SUM",w[w.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Wi||(Wi={}));let wy=Object(M.a)({mean_:function(w,C=null,I=!1){let E=Object(z.a)(w,"x","mean"),B=Object(S.I)(C,E.shape),V=mg(E.shape,B)[1],K=Object(S.N)(V),ne={x:E},be={axis:C,keepDims:I},Ae=()=>{let We=yr(K),ut=We.dtype===E.dtype?E:W(E,We.dtype),bt=qr(ut,We);return fr(bt,C,I)};return Sg(We=>({value:u.a.runKernelFunc(Ae,ne,null,ye.Fb,be),gradFunc:ut=>{let bt=We.shape.slice();B.forEach(jt=>{bt[jt]=1});let St=ze(ut,bt);return qr(rn(St,ip(We.shape,"float32")),K)}}))(E)}});let mf=Object(M.a)({notEqual_:function(w,C){let I=Object(z.a)(w,"a","notEqual"),E=Object(z.a)(C,"b","notEqual");[I,E]=Object(Oo.b)(I,E),oo(I.shape,E.shape);let B={a:I,b:E};return u.a.runKernelFunc(V=>V.notEqual(I,E),B,null,ye.Pb)}}),Tc=Object(M.a)({computeWeightedLoss_:function(w,C,I=Wi.SUM_BY_NONZERO_WEIGHTS){let E=Object(z.a)(w,"losses","computeWeightedLoss"),B=null;C!=null&&(B=Object(z.a)(C,"weights","computeWeightedLoss"));let V=B==null?E:rn(E,B);if(I===Wi.NONE)return V;if(I===Wi.SUM)return fr(V);if(I===Wi.MEAN){if(B==null)return wy(V);{let K=E.size/B.size,ne=qr(fr(V),fr(B));return K>1?qr(ne,yr(K)):ne}}if(I===Wi.SUM_BY_NONZERO_WEIGHTS){if(B==null)return qr(fr(V),yr(E.size));{let K=rn(B,ip(E.shape)),ne=W(fr(mf(K,yr(0))),"float32");return qr(fr(V),ne)}}throw Error("Unknown reduction: "+I)}});Object(M.a)({absoluteDifference_:function(w,C,I,E=Wi.SUM_BY_NONZERO_WEIGHTS){let B=Object(z.a)(w,"labels","absoluteDifference"),V=Object(z.a)(C,"predictions","absoluteDifference"),K=null;I!=null&&(K=Object(z.a)(I,"weights","absoluteDifference")),Object(S.e)(B.shape,V.shape,"Error in absoluteDifference: ");let ne=ru(xr(B,V));return Tc(ne,K,E)}}),Object(M.a)({cosineDistance_:function(w,C,I,E,B=Wi.SUM_BY_NONZERO_WEIGHTS){let V=Object(z.a)(w,"labels","cosineDistance"),K=Object(z.a)(C,"predictions","cosineDistance"),ne=null;E!=null&&(ne=Object(z.a)(E,"weights","cosineDistance")),Object(S.e)(V.shape,K.shape,"Error in cosineDistance: ");let be=yr(1),Ae=xr(be,fr(rn(V,K),I,!0));return Tc(Ae,ne,B)}});let Cg=Object(M.a)({relu_:function(w){let C=Object(z.a)(w,"x","relu"),I={x:C};return u.a.runKernelFunc((E,B)=>(B([C]),C.dtype==="bool"?W(C,"int32"):E.relu(C)),I,null,ye.Zb)}});Object(M.a)({hingeLoss_:function(w,C,I,E=Wi.SUM_BY_NONZERO_WEIGHTS){let B=Object(z.a)(w,"labels","hingeLoss"),V=Object(z.a)(C,"predictions","hingeLoss"),K=null;I!=null&&(K=Object(z.a)(I,"weights","hingeLoss")),Object(S.e)(B.shape,V.shape,"Error in hingeLoss: ");let ne=yr(1);B=xr(rn(yr(2),B),ne);let be=Cg(xr(ne,rn(B,V)));return Tc(be,K,E)}});let ap=Object(M.a)({minimum_:function(w,C){let I=Object(z.a)(w,"a","minimum"),E=Object(z.a)(C,"b","minimum");[I,E]=Object(Oo.b)(I,E),I.dtype==="bool"&&(I=W(I,"int32"),E=W(E,"int32")),oo(I.shape,E.shape);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.minimum(I,E);return K([I,E]),ne},B,null,ye.Hb)}});Object(M.a)({huberLoss_:function(w,C,I,E=1,B=Wi.SUM_BY_NONZERO_WEIGHTS){let V=Object(z.a)(w,"labels","huberLoss"),K=Object(z.a)(C,"predictions","huberLoss"),ne=null;I!=null&&(ne=Object(z.a)(I,"weights","huberLoss")),Object(S.e)(V.shape,K.shape,"Error in huberLoss: ");let be=yr(E),Ae=ru(xr(K,V)),We=ap(Ae,be),ut=xr(Ae,We),bt=xt(rn(yr(.5),Ks(We)),rn(be,ut));return Tc(bt,ne,B)}});let up=Object(M.a)({log_:function(w){let C=Object(z.a)(w,"x","log"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.log(C);return B([C]),V},I,null,ye.sb)}});Object(M.a)({logLoss_:function(w,C,I,E=1e-7,B=Wi.SUM_BY_NONZERO_WEIGHTS){let V=Object(z.a)(w,"labels","logLoss"),K=Object(z.a)(C,"predictions","logLoss"),ne=null;I!=null&&(ne=Object(z.a)(I,"weights","logLoss")),Object(S.e)(V.shape,K.shape,"Error in logLoss: ");let be=yr(1),Ae=yr(E),We=$s(rn(V,up(xt(K,Ae)))),ut=rn(xr(be,V),up(xt(xr(be,K),Ae))),bt=xr(We,ut);return Tc(bt,ne,B)}});let cp=Object(M.a)({squaredDifference_:function(w,C){let I=Object(z.a)(w,"a","squaredDifference"),E=Object(z.a)(C,"b","squaredDifference");[I,E]=Object(Oo.b)(I,E),oo(I.shape,E.shape);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.squaredDifference(I,E);return K([I,E]),ne},B,null,ye.xc,{})}});Object(M.a)({meanSquaredError_:function(w,C,I,E=Wi.SUM_BY_NONZERO_WEIGHTS){let B=Object(z.a)(w,"labels","meanSquaredError"),V=Object(z.a)(C,"predictions","meanSquaredError"),K=null;I!=null&&(K=Object(z.a)(I,"weights","meanSquaredError")),Object(S.e)(B.shape,V.shape,"Error in meanSquaredError: ");let ne=cp(B,V);return Tc(ne,K,E)}});let Ru=Object(M.a)({exp_:function(w){let C=Object(z.a)(w,"x","exp"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.exp(C);return B([V]),V},I,null,ye.W)}});let lp=Object(M.a)({log1p_:function(w){let C=Object(z.a)(w,"x","log1p"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.log1p(C);return B([C]),V},I,null,ye.tb)}});Object(M.a)({sigmoidCrossEntropy_:function(w,C,I,E=0,B=Wi.SUM_BY_NONZERO_WEIGHTS){let V=Object(z.a)(w,"multiClassLabels","sigmoidCrossEntropy"),K=Object(z.a)(C,"logits","sigmoidCrossEntropy"),ne=null;if(I!=null&&(ne=Object(z.a)(I,"weights","sigmoidCrossEntropy")),Object(S.e)(V.shape,K.shape,"Error in sigmoidCrossEntropy: "),E>0){let Ae=yr(E),We=yr(1),ut=yr(.5);V=xt(rn(V,xr(We,Ae)),rn(ut,Ae))}let be=function(Ae,We){let ut=Object(z.a)(Ae,"labels","sigmoidCrossEntropyWithLogits"),bt=Object(z.a)(We,"logits","sigmoidCrossEntropyWithLogits");Object(S.e)(ut.shape,bt.shape,"Error in sigmoidCrossEntropyWithLogits: ");let St=Cg(bt),jt=rn(bt,ut),Gt=lp(Ru($s(ru(bt))));return xt(xr(St,jt),Gt)}(V,K);return Tc(be,ne,B)}});let tb=Object(M.a)({logSumExp_:function(w,C=null,I=!1){let E=Object(z.a)(w,"x","logSumExp"),B=Object(S.I)(C,E.shape),V=ua(E,B,!0),K=xr(E,V),ne=Ru(K),be=fr(ne,B),Ae=up(be),We=xt(ze(V,Ae.shape),Ae);if(I){let ut=Ui(We.shape,B);return ze(We,ut)}return We}});Object(M.a)({softmaxCrossEntropy_:function(w,C,I,E=0,B=Wi.SUM_BY_NONZERO_WEIGHTS){let V=Object(z.a)(w,"onehotLabels","softmaxCrossEntropy"),K=Object(z.a)(C,"logits","softmaxCrossEntropy"),ne=null;if(I!=null&&(ne=Object(z.a)(I,"weights","softmaxCrossEntropy")),Object(S.e)(V.shape,K.shape,"Error in softmaxCrossEntropy: "),E>0){let Ae=yr(E),We=yr(1),ut=yr(V.shape[1]);V=xt(rn(V,xr(We,Ae)),qr(Ae,ut))}let be=function(Ae,We,ut=-1){if(ut===-1&&(ut=We.rank-1),ut!==We.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${We.rank} and dim was `+ut);return Sg((bt,St,jt)=>{let Gt=tb(St,[ut],!0),bn=xr(W(St,"float32"),Gt);jt([bt,bn]);let Zn=$s(rn(bn,bt));return{value:fr(Zn,[ut]),gradFunc:(zn,tr)=>{let[Or,Yr]=tr,Ro=Ui(zn.shape,[ut]);return[rn(ze(zn,Ro),xr(W(Or,"float32"),Ru(Yr))),rn(ze(zn,Ro),xr(Ru(Yr),W(Or,"float32")))]}}})(Ae,We)}(V,K);return Tc(be,ne,B)}});var Sy=e(26),X2=e(78);let nb=Object(M.a)({elu_:function(w){let C=Object(z.a)(w,"x","elu"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.elu(C);return B([V]),V},I,null,ye.S)}});let rb=Object(M.a)({prelu_:function(w,C){let I=Object(z.a)(w,"x","prelu"),E=Object(z.a)(C,"alpha","prelu"),B={x:I,alpha:E};return u.a.runKernelFunc((V,K)=>{let ne=V.prelu(I,E);return K([I,E]),ne},B,null,ye.Ub)}});let Cy=Object(M.a)({relu6_:function(w){let C=Object(z.a)(w,"x","relu6"),I={x:C};return u.a.runKernelFunc((E,B)=>(B([C]),C.dtype==="bool"?W(C,"int32"):E.relu6(C)),I,null,ye.ac)}});let pp=Object(M.a)({step_:function(w,C=0){let I=Object(z.a)(w,"x","step"),E={x:I},B={alpha:C};return u.a.runKernelFunc(V=>V.step(I,C),E,null,ye.yc,B)}});function Ig(w,C,I){if(I==null||I==="linear")return w;if(I==="relu")return rn(w,pp(C));throw new Error(`Cannot compute gradient for fused activation ${I}.`)}function Y2(w,C){let I=C,E=_s(w.shape,C.shape);return E.length>0&&(I=fr(I,E)),ze(I,w.shape)}function Ec(w,C,I){if(C==="linear")return w;if(C==="relu")return Cg(w);if(C==="elu")return nb(w);if(C==="relu6")return Cy(w);if(C==="prelu")return rb(w,I);throw new Error(`Unknown fused activation ${C}.`)}let ob=(w,C)=>!(w>0)||C==="linear",tc=30;function sb(w){return w<=tc?w:Object(S.G)(w,Math.floor(Math.sqrt(w)))}function _g(w,C,I){return[I*(typeof w=="number"?w:w[0]),C*(typeof w=="number"?w:w[1])]}function ah(w,C,I,E=!0){let B=[];if(E)B=B.concat(C.slice(0)),B.push(w[0]/I),B=B.concat(w.slice(1));else{B=B.concat(w[0]);let V=C.length;for(let K=0;K<V;++K)B=B.concat([w[K+1]/C[K],C[K]]);B=B.concat(w.slice(V+1))}return B}function ib(w,C,I=!0){let E=[];if(I){E.push(C);for(let B=C+1;B<w;++B)B<=2*C?(E.push(B),E.push(B-(C+1))):E.push(B)}else{let B=[],V=[];for(let K=1;K<w;++K)K>=2*C+1||K%2==1?V.push(K):B.push(K);E.push(...B),E.push(0),E.push(...V)}return E}function Q2(w,C,I,E=!0){let B=[];E?B.push(w[0]/I):B.push(w[0]*I);for(let V=1;V<w.length;++V)V<=C.length?E?B.push(C[V-1]*w[V]):B.push(w[V]/C[V-1]):B.push(w[V]);return B}function ab(w,C){let I=[0];for(let E=0;E<C;++E)I.push(w[E][0]);return I}function Z2(w,C,I){let E=w.slice(0,1);for(let B=0;B<I;++B)E.push(w[B+1]-C[B][0]-C[B][1]);return E}function J2(w,C){if(w.rank<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${w.rank}.`);if(C.rank<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${C.rank}.`);if(C.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${C.dtype}.`);if(C.shape[C.rank-1]>w.rank)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${C.shape[C.rank-1]} vs. ${w.rank}`);if(w.size===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${w.shape}.`);let I=C.shape,E=I[I.length-1],B=1;for(let Ae=0;Ae<I.length-1;++Ae)B*=I[Ae];let V=w.shape,K=I.slice();K.pop();let ne=1;for(let Ae=E;Ae<w.rank;++Ae)ne*=V[Ae],K.push(V[Ae]);let be=[...Object(S.j)(w.shape).map(Ae=>Ae/ne),1].slice(0,E);return[K,B,ne,be]}function ub(w,C,I){let E=C.rank>1?C.shape[C.rank-1]:1,B=C.rank>1?C.rank-1:1,V="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+I.shape+`, indices.shape: ${C.shape}, shape: ${w}, sliceDim: ${E}, and batchDim: ${B}.`;if(I.rank<B)throw new Error(V+` update.rank < ${B}. `);if(w.length<E+(I.rank-B))throw new Error(V+" Output shape length < "+(E+(I.rank-B)));if(I.rank!==B+w.length-E)throw new Error(V+" update.rank != "+(B+w.length-E));for(let K=0;K<B;++K)if(I.shape[K]!==C.shape[K])throw new Error(V+` updates.shape[${K}] (${I.shape[K]}) != indices.shape[${K}] (${C.shape[K]}).`);for(let K=0;K<I.rank-B;++K)if(I.shape[K+B]!==w[K+E])throw new Error(V+` updates.shape[${K+B}] (${I.shape[K+B]}) != shape[${K+B}] (${w[K+B]})`)}function eS(w,C,I){if(C.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${C.rank}.`);if(w.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${w.rank}.`);if(C.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+C.dtype);if(I.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+I);if(I.length===0){if(C.size===0)throw new Error("Indices specified for empty output. indices shape: "+C.shape);if(w.size===0)throw new Error("Updates specified for empty output. updates shape: "+w.shape)}ub(I,C,w)}function tS(w,C,I){let E=C.shape.length,B=E>1?C.shape[E-1]:1,V=I.length,K=1;for(let be=B;be<V;++be)K*=I[be];let ne=B<1?1:B;return{sliceRank:B,numUpdates:Object(S.N)(C.shape)/ne,sliceSize:K,strides:[...Object(S.j)(I.slice(0,B)),1],outputSize:Object(S.N)(I)}}let cb=1.7580993408473768,Tg=1.0507009873554805,lb=.3275911,pb=.254829592,Iy=-.284496736,hb=1.421413741,db=-1.453152027,nS=1.061405429;function rS(...w){Object(c.b)().getBool("IS_TEST")||console.warn(...w)}function Eg(...w){Object(c.b)().getBool("IS_TEST")||console.log(...w)}function fb(w,C){if(w.length!==C.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${w.length}, imag: ${C.length}.`);let I=new Float32Array(2*w.length);for(let E=0;E<I.length;E+=2)I[E]=w[E/2],I[E+1]=C[E/2];return I}function oS(w){let C=new Float32Array(w.length/2),I=new Float32Array(w.length/2);for(let E=0;E<w.length;E+=2)C[E/2]=w[E],I[E/2]=w[E+1];return{real:C,imag:I}}function Nc(w){let C=Math.ceil(w.length/4),I=new Float32Array(C),E=new Float32Array(C);for(let B=0;B<w.length;B+=4)I[Math.floor(B/4)]=w[B],E[Math.floor(B/4)]=w[B+1];return{real:I,imag:E}}function mb(w){let C=Math.floor(w.length/4),I=new Float32Array(C),E=new Float32Array(C);for(let B=2;B<w.length;B+=4)I[Math.floor(B/4)]=w[B],E[Math.floor(B/4)]=w[B+1];return{real:I,imag:E}}function sS(w,C){return{real:w[2*C],imag:w[2*C+1]}}function iS(w,C,I,E){w[2*E]=C,w[2*E+1]=I}function aS(w,C){let I=new Float32Array(w/2),E=new Float32Array(w/2);for(let B=0;B<Math.ceil(w/2);B++){let V=(C?2:-2)*Math.PI*(B/w);I[B]=Math.cos(V),E[B]=Math.sin(V)}return{real:I,imag:E}}function uS(w,C,I){let E=(I?2:-2)*Math.PI*(w/C);return{real:Math.cos(E),imag:Math.sin(E)}}function cS(w,C){let I,E=!1;for(w<=tc?(I=w,E=!0):I=Object(S.G)(w,Math.floor(Math.sqrt(w)));!E;)I>C||I===w?E=!0:I=Object(S.G)(w,I+1);return I}function gb(w,C,I){let E=[],B=w.length;for(let V=0;V<B;V++)V!==C?E.push(w[V]):E.push(I);return E}function _y(w,C,I){let E=w.shape[I],B=[],V=1,K=1;for(let ne=0;ne<I;ne++)B.push(w.shape[ne]),V*=w.shape[ne];for(let ne=0;ne<C.rank;ne++)B.push(C.shape[ne]);for(let ne=I+1;ne<w.rank;ne++)B.push(w.shape[ne]),K*=w.shape[ne];return{batchSize:V,sliceSize:K,dimSize:E,outputShape:B}}function lS(w,C,I){if(C==="complex64"){if(w.dtype==="complex64")return w.clone();let E=Oa(w.shape),B=W(w,"float32"),V=I.complex(B,E);return E.dispose(),B.dispose(),V}if(!Object(S.p)(w.dtype,C))return u.a.makeTensorFromDataId(w.dataId,w.shape,C);if(w.dtype==="complex64"){let E=I.real(w),B=W(E,C);return E.dispose(),B}if(C==="int32")return I.int(w);if(C==="bool"){let E=yr(0,w.dtype),B=I.notEqual(w,E);return E.dispose(),B}throw new Error(`Error in Cast: failed to cast ${w.dtype} to ${C}`)}function la(w,C){return u.a.makeTensorFromDataId(w.dataId,C,w.dtype)}function mr(w,C,I){let E=(C-w)/(I-1),B=Object(S.F)(I,"float32");B[0]=w;for(let V=1;V<B.length;V++)B[V]=B[V-1]+E;return ri(B,"float32")}var yb=e(46);function Ra(w,C,I){let E=new Array(w.rank).fill(0),B=w.shape.slice();return C.map(V=>{let K=[...B];K[I]=V;let ne=Uo(w,E,K);return E[I]+=V,ne})}function kc(w,C){let I=new Array(w.rank);for(let B=0;B<I.length;B++)I[B]=w.shape[B]*C[B];let E=tt(I,w.dtype);for(let B=0;B<E.values.length;++B){let V=E.indexToLoc(B),K=new Array(w.rank);for(let be=0;be<K.length;be++)K[be]=V[be]%w.shape[be];let ne=w.locToIndex(K);E.values[B]=w.values[ne]}return E.toTensor()}function ll(w,C,I,E,B){let V=C[C.length-1],[K,ne]=[w.length/V,V],be=Object(S.o)(I,K*E),Ae=Object(S.o)("int32",K*E);for(let ut=0;ut<K;ut++){let bt=ut*ne,St=w.subarray(bt,bt+ne),jt=[];for(let zn=0;zn<St.length;zn++)jt.push({value:St[zn],index:zn});jt.sort((zn,tr)=>tr.value-zn.value);let Gt=ut*E,bn=be.subarray(Gt,Gt+E),Zn=Ae.subarray(Gt,Gt+E);for(let zn=0;zn<E;zn++)bn[zn]=jt[zn].value,Zn[zn]=jt[zn].index}let We=C.slice();return We[We.length-1]=E,[Object(Un.a)(be,We,I),Object(Un.a)(Ae,We,"int32")]}function vi(w,C){let I=[];for(let V=0;V<C.length;V++)C[V]&&I.push(V);let E=tt(w,"int32"),B=tt([I.length,w.length],"int32");for(let V=0;V<I.length;V++){let K=E.indexToLoc(I[V]),ne=V*w.length;B.values.set(K,ne)}return B.toTensor()}var Ma=e(39);let uh={kernelName:ye.a,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn(w,pp(W(I,"float32"),-1))}}},Pn={kernelName:ye.b,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>{let E=Ks(W(I,"float32")),B=ec(xr(yr(1),E));return $s(qr(w,B))}}}},wi={kernelName:ye.c,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>{let E=ec(xr(Ks(W(I,"float32")),1));return qr(w,E)}}}},gf={kernelName:ye.d,inputsToSave:["a","b"],gradFunc:(w,C)=>{let[I,E]=C,B=oo(I.shape,E.shape);return{a:()=>{let V=w,K=_s(I.shape,B);return K.length>0&&(V=fr(V,K)),ze(V,I.shape)},b:()=>{let V=w,K=_s(E.shape,B);return K.length>0&&(V=fr(V,K)),ze(V,E.shape)}}}},xb={kernelName:ye.e,saveAllInputs:!0,gradFunc:(w,C)=>{let I={};return C.forEach((E,B)=>{I[B]=()=>w.clone()}),I}},bb={kernelName:ye.h,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>_o(I)}}},Ty={kernelName:ye.i,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>_o(I)}}},vb={kernelName:ye.j,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>qr(w,ec(xr(yr(1),Ks(W(I,"float32")))))}}},Ey={kernelName:ye.k,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>{let E=ec(xt(yr(1),Ks(W(I,"float32"))));return qr(w,E)}}}},pS={kernelName:ye.m,inputsToSave:["a","b"],gradFunc:(w,C)=>{let[I,E]=C,B=oo(I.shape,E.shape);return{a:()=>{let V=xt(Ks(I),Ks(E)),K=rn(w,qr(E,V)),ne=_s(I.shape,B);return ne.length>0&&(K=fr(K,ne)),ze(K,I.shape)},b:()=>{let V=xt(Ks(I),Ks(E)),K=$s(rn(w,qr(I,V))),ne=_s(E.shape,B);return ne.length>0&&(K=fr(K,ne)),ze(K,E.shape)}}}},wb={kernelName:ye.l,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>qr(w,xt(Ks(W(I,"float32")),1))}}},ch={kernelName:ye.n,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>qr(w,xr(yr(1),Ks(W(I,"float32"))))}}};let Dc=Object(M.a)({avgPool3dBackprop_:function(w,C,I,E,B=[1,1,1],V,K){let ne=Object(z.a)(w,"dy","avgPool3dBackprop"),be=Object(z.a)(C,"input","avgPool3dBackprop"),Ae=ne,We=be,ut=!1;be.rank===4&&(ut=!0,Ae=ze(ne,[1,ne.shape[0],ne.shape[1],ne.shape[2],ne.shape[3]]),We=ze(be,[1,be.shape[0],be.shape[1],be.shape[2],be.shape[3]])),S.b(Ae.rank===5,()=>"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+Ae.rank+"."),S.b(We.rank===5,()=>"Error in avgPool3dBackprop: input must be rank 5 but got rank "+We.rank+"."),S.b(Cn(E,B),()=>`Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides ${E} and dilations '${B}'`),K!=null&&S.b(S.v(V),()=>`Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode ${K} but got pad ${V}.`);let bt={dy:Ae,input:We},St={filterSize:I,strides:E,dilations:B,pad:V,dimRoundingMode:K},jt=u.a.runKernelFunc(Gt=>{let bn=Ge(We.shape,I,E,B,V,K);return Gt.avgPool3dBackprop(Ae,We,bn)},bt,null,ye.q,St);return ut?ze(jt,[jt.shape[1],jt.shape[2],jt.shape[3],jt.shape[4]]):jt}}),hS={kernelName:ye.p,inputsToSave:["x"],gradFunc:(w,C,I)=>{let[E]=C,{filterSize:B,strides:V,dilations:K,pad:ne,dimRoundingMode:be}=I,Ae=K??[1,1,1];return{x:()=>Dc(w,E,B,V,Ae,ne,be)}}};let ou=Object(M.a)({avgPoolBackprop_:function(w,C,I,E,B){let V=Object(z.a)(w,"dy","avgPoolBackprop"),K=Object(z.a)(C,"input","avgPoolBackprop");S.b(K.rank===V.rank,()=>`Rank of input (${K.rank}) does not match rank of dy (${V.rank})`);let ne=K,be=V,Ae=!1;K.rank===3&&(Ae=!0,ne=ze(K,[1,K.shape[0],K.shape[1],K.shape[2]]),be=ze(V,[1,V.shape[0],V.shape[1],V.shape[2]])),S.b(be.rank===4,()=>"Error in avgPoolBackprop: dy must be rank 4 but got rank "+be.rank+"."),S.b(ne.rank===4,()=>"Error in avgPoolBackprop: input must be rank 4 but got rank "+ne.rank+".");let We={dy:be,input:ne},ut={filterSize:I,strides:E,pad:B},bt=u.a.runKernelFunc(St=>{let jt=Pe(ne.shape,I,E,1,B);return St.avgPoolBackprop(be,ne,jt)},We,null,ye.r,ut);return Ae?ze(bt,[bt.shape[1],bt.shape[2],bt.shape[3]]):bt}}),To={kernelName:ye.o,inputsToSave:["x"],gradFunc:(w,C,I)=>{let[E]=C,{filterSize:B,strides:V,pad:K}=I;return{x:()=>ou(w,E,B,V,K)}}},dS={kernelName:ye.s,inputsToSave:["a","b"],gradFunc:(w,C,I)=>{let[E,B]=C,{transposeA:V,transposeB:K}=I;return V||K?!V&&K?{a:()=>jo(w,B,!1,!1),b:()=>jo(w,E,!0,!1)}:V&&!K?{a:()=>jo(B,w,!1,!0),b:()=>jo(E,w,!1,!1)}:{a:()=>jo(B,w,!0,!0),b:()=>jo(w,E,!0,!0)}:{a:()=>jo(w,B,!1,!0),b:()=>jo(E,w,!0,!1)}}};let Ac=Object(M.a)({spaceToBatchND_:function(w,C,I){let E=Object(z.a)(w,"x","spaceToBatchND");S.b(E.rank>=1+C.length,()=>`input rank ${E.rank} should be > than [blockShape] ${C.length}`),S.b(I.length===C.length,()=>`paddings.shape[0] ${I.length} must be equal to [blockShape] ${C.length}`),S.b(E.shape.reduce((K,ne,be)=>be>0&&be<=C.length?K&&(ne+I[be-1][0]+I[be-1][1])%C[be-1]==0:K,!0),()=>`input spatial dimensions ${E.shape.slice(1)} with paddings ${I.toString()} must be divisible by blockShapes ${C.toString()}`);let B={x:E},V={blockShape:C,paddings:I};return u.a.runKernelFunc(K=>K.spaceToBatchND(E,C,I),B,null,ye.tc,V)}}),pl={kernelName:ye.t,gradFunc:(w,C,I)=>{let{blockShape:E,crops:B}=I;return{x:()=>Ac(w,E,B)}}},Ng={kernelName:ye.u,gradFunc:(w,C,I)=>{let E=I,B=E.inputShape,V=E.shape,K=Array.from(V);for(let be=B.length-1;be>=0;be--)if(B[be]===V[be])K[be]=1;else if(B[be]!==1)throw new Error(`broadcastTo(): [${B}] cannot be broadcast to [${V}].`);let ne=[];for(let be=0;be<K.length;be++)K[be]>1&&ne.push(be);return{x:()=>fr(w,ne,!0)}}},lh={kernelName:ye.v,gradFunc:w=>({x:()=>w.clone()})},fS={kernelName:ye.w,gradFunc:w=>({x:()=>_o(w)})},su={kernelName:ye.x,inputsToSave:["x"],gradFunc:(w,C,I)=>{let[E]=C,{clipValueMin:B,clipValueMax:V}=I;return{x:()=>Jr(ih(oh(E,B),sh(E,V)),w,_o(w))}}},ot={kernelName:ye.z,saveAllInputs:!0,gradFunc:(w,C,I)=>{let E=C.map(ne=>ne.shape),{axis:B}=I,V=Object(S.I)(B,C[0].shape)[0],K=E.map(ne=>ne[V]);return Gr(w,K,V).map(ne=>()=>ne)}};let Fa=Object(M.a)({conv2DBackpropFilter_:function(w,C,I,E,B,V="NHWC",K){let ne=w;w.rank===3&&(ne=ze(w,[1,w.shape[0],w.shape[1],w.shape[2]]));let be=C;be.rank===3&&(be=ze(C,[1,C.shape[0],C.shape[1],C.shape[2]])),S.b(ne.rank===4,()=>"Error in conv2dDerFilter: input must be rank 4, but got shape "+ne.shape+"."),S.b(be.rank===4,()=>"Error in conv2dDerFilter: dy must be rank 4, but got shape "+be.shape+"."),S.b(I.length===4,()=>"Error in conv2dDerFilter: filterShape must be length 4, but got "+I+".");let Ae=V==="NHWC"?ne.shape[3]:ne.shape[1],We=V==="NHWC"?be.shape[3]:be.shape[1];S.b(Ae===I[2],()=>`Error in conv2dDerFilter: depth of input ${Ae}) must match input depth in filter (${I[2]}.`),S.b(We===I[3],()=>`Error in conv2dDerFilter: depth of dy (${We}) must match output depth for filter (${I[3]}).`),K!=null&&S.b(S.v(B),()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${K} but got pad ${B}.`);let ut={x:ne,dy:be},bt={strides:E,pad:B,dataFormat:V,dimRoundingMode:K,filterShape:I};return u.a.runKernelFunc(St=>{let jt=Io(V),Gt=pt(ne.shape,I,E,1,B,K,!1,jt);return St.conv2dDerFilter(ne,be,Gt)},ut,null,ye.B,bt)}});let oi=Object(M.a)({conv2DBackpropInput_:function(w,C,I,E,B,V="NHWC",K){S.b(w.length===C.rank,()=>`Length of inShape (${w.length}) and rank of dy (${C.rank}) must match`);let ne=w,be=C,Ae=!1;C.rank===3&&(Ae=!0,be=ze(C,[1,C.shape[0],C.shape[1],C.shape[2]]),ne=[1,w[0],w[1],w[2]]),S.b(ne.length===4,()=>"Error in conv2dDerInput: inShape must be length 4, but got length "+ne.length+"."),S.b(be.rank===4,()=>"Error in conv2dDerInput: dy must be rank 4, but got rank "+be.rank),S.b(I.rank===4,()=>"Error in conv2dDerInput: filter must be rank 4, but got rank "+I.rank);let We=V==="NHWC"?ne[3]:ne[1],ut=V==="NHWC"?be.shape[3]:be.shape[1];S.b(We===I.shape[2],()=>`Error in conv2dDerInput: depth of input (${We}) must match input depth for filter ${I.shape[2]}.`),S.b(ut===I.shape[3],()=>`Error in conv2dDerInput: depth of output (${ut}) must match output depth for filter ${I.shape[3]}.`),K!=null&&S.b(S.v(B),()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${K} but got pad ${B}.`);let bt={dy:be,filter:I},St={strides:E,pad:B,dataFormat:V,dimRoundingMode:K,inputShape:ne},jt=u.a.runKernelFunc((Gt,bn)=>{let Zn=Io(V),zn=pt(ne,I.shape,E,1,B,K,!1,Zn),tr=Gt.conv2dDerInput(be,I,zn);return bn([be,I]),tr},bt,null,ye.C,St);return Ae?ze(jt,[jt.shape[1],jt.shape[2],jt.shape[3]]):jt}}),hl={kernelName:ye.A,inputsToSave:["x","filter"],gradFunc:(w,C,I)=>{let[E,B]=C,{dilations:V,strides:K,pad:ne,dataFormat:be}=I;return S.b(yn(V),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${V}'`),{x:()=>oi(E.shape,w,B,K,ne,be),filter:()=>Fa(E,w,B.shape,K,ne,be)}}},Ny={kernelName:ye.C,inputsToSave:["dy","filter"],gradFunc:(w,C,I)=>{let[E,B]=C,{strides:V,pad:K,dataFormat:ne,dimRoundingMode:be}=I;return{dy:()=>Zo(w,B,V,K,ne,1,be),filter:()=>Fa(w,E,B.shape,V,K,ne,be)}}};let ph=Object(M.a)({conv3DBackpropFilter_:function(w,C,I,E,B){let V=w;w.rank===4&&(V=ze(w,[1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]]));let K=C;K.rank===4&&(K=ze(C,[1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]])),S.b(V.rank===5,()=>"Error in conv3dDerFilter: input must be rank 5, but got shape "+V.shape+"."),S.b(K.rank===5,()=>"Error in conv3dDerFilter: dy must be rank 5, but got shape "+K.shape+"."),S.b(I.length===5,()=>"Error in conv3dDerFilter: filterShape must be length 5, but got "+I+"."),S.b(V.shape[4]===I[3],()=>`Error in conv3dDerFilter: depth of input ${V.shape[4]}) must match input depth in filter (${I[3]}.`),S.b(K.shape[4]===I[4],()=>`Error in conv3dDerFilter: depth of dy (${K.shape[4]}) must match output depth for filter (${I[4]}).`);let ne={x:V,dy:K},be={strides:E,pad:B,filterShape:I};return u.a.runKernelFunc(Ae=>{let We=At(V.shape,I,E,1,B);return Ae.conv3dDerFilter(V,K,We)},ne,null,ye.E,be)}});let ky=Object(M.a)({conv3DBackpropInput_:function(w,C,I,E,B){S.b(w.length===C.rank,()=>`Length of inShape (${w.length}) and rank of dy (${C.rank}) must match`);let V=w,K=C,ne=!1;C.rank===4&&(ne=!0,K=ze(C,[1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]]),V=[1,w[0],w[1],w[2],w[3]]);let be=V[4],Ae=K.shape[4];S.b(V.length===5,()=>"Error in conv3dDerInput: inShape must be length 5, but got length "+V.length+"."),S.b(K.rank===5,()=>"Error in conv3dDerInput: dy must be rank 5, but got rank "+K.rank),S.b(I.rank===5,()=>"Error in conv3dDerInput: filter must be rank 5, but got rank "+I.rank),S.b(be===I.shape[3],()=>`Error in conv3dDerInput: depth of input (${be}) must match input depth for filter ${I.shape[3]}.`),S.b(Ae===I.shape[4],()=>`Error in conv3dDerInput: depth of output (${Ae}) must match output depth for filter ${I.shape[4]}.`);let We={dy:K,filter:I},ut={pad:B,strides:E,inputShape:V},bt=u.a.runKernelFunc(St=>{let jt=At(V,I.shape,E,1,B);return St.conv3dDerInput(K,I,jt)},We,null,ye.F,ut);return ne?ze(bt,[bt.shape[1],bt.shape[2],bt.shape[3],bt.shape[4]]):bt}}),yf={kernelName:ye.D,inputsToSave:["x","filter"],gradFunc:(w,C,I)=>{let{dilations:E,strides:B,pad:V}=I;S.b(yn(E),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${E}'`);let[K,ne]=C;return{x:()=>ky(K.shape,w,ne,B,V),filter:()=>ph(K,w,ne.shape,B,V)}}};let iu=Object(M.a)({sin_:function(w){let C=Object(z.a)(w,"x","sin"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.sin(C);return B([C]),V},I,null,ye.oc)}}),hp={kernelName:ye.G,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn($s(iu(W(I,"float32"))),w)}}};let pa=Object(M.a)({sinh_:function(w){let C=Object(z.a)(w,"x","sinh"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.sinh(C);return B([C]),V},I,null,ye.pc)}}),Sb={kernelName:ye.H,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn(pa(W(I,"float32")),w)}}},eo={kernelName:ye.J,inputsToSave:["x"],gradFunc:(w,C,I)=>{let[E]=C,{axis:B,exclusive:V,reverse:K}=I;return{x:()=>{let ne=qi([B],E.rank),be=eh(w,B,V,!K);return ne!=null&&(be=ms(be,ne)),be}}}};let dl=Object(M.a)({depthwiseConv2dNativeBackpropFilter_:function(w,C,I,E,B,V=[1,1],K){let ne=w;w.rank===3&&(ne=ze(w,[1,w.shape[0],w.shape[1],w.shape[2]]));let be=C;be.rank===3&&(be=ze(C,[1,C.shape[0],C.shape[1],C.shape[2]]));let Ae={x:ne,dy:be},We={strides:E,pad:B,dimRoundingMode:K,dilations:V,filterShape:I};return u.a.runKernelFunc(ut=>{let bt=pt(w.shape,I,E,V,B,K,!0);return ut.depthwiseConv2DDerFilter(ne,be,bt)},Ae,null,ye.M,We)}});let xf=Object(M.a)({depthwiseConv2dNativeBackpropInput_:function(w,C,I,E,B,V=[1,1],K){let ne=C,be=!1;C.rank===3&&(be=!0,ne=ze(C,[1,C.shape[0],C.shape[1],C.shape[2]]));let Ae={dy:ne,filter:I},We={strides:E,pad:B,dimRoundingMode:K,dilations:V,inputShape:w},ut=u.a.runKernelFunc(bt=>{let St=pt(w,I.shape,E,V,B,K,!0);return bt.depthwiseConv2DDerInput(ne,I,St)},Ae,null,ye.N,We);return be?ze(ut,[ut.shape[1],ut.shape[2],ut.shape[3]]):ut}}),fl={kernelName:ye.L,inputsToSave:["x","filter"],gradFunc:(w,C,I)=>{let{dilations:E,strides:B,pad:V,dimRoundingMode:K}=I,ne=E??[1,1];S.b(yn(ne),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${ne}'`);let[be,Ae]=C;return S.b(be.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${be.rank}.`),S.b(Ae.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${Ae.rank}.`),S.b(be.shape[3]===Ae.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${be.shape[3]}) must match the inChannels dimension in filter ${Ae.shape[2]}.`),S.b(Cn(B,ne),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${B} and dilations '${ne}'.`),K!=null&&S.b(S.v(V),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${K} but got pad ${V}.`),{x:()=>xf(be.shape,w,Ae,B,V,E,K),filter:()=>dl(be,w,Ae.shape,B,V,E,K)}}},hh={kernelName:ye.O,inputsToSave:["x","filter"],gradFunc:(w,C,I)=>{let[E,B]=C,V={x:E,filter:B,dy:w},K={x:E,filter:B,dy:w};return{x:()=>u.a.runKernel(ye.Q,V,I),filter:()=>u.a.runKernel(ye.P,K,I)}}},dp={kernelName:ye.R,inputsToSave:["a","b"],gradFunc:(w,C)=>{let[I,E]=C,B=oo(I.shape,E.shape);return{a:()=>{let V=qr(w,W(E,"float32")),K=_s(I.shape,B);return K.length>0?ze(fr(V,K),I.shape):V},b:()=>{let V=rn(w,W(I,"float32")),K=_s(E.shape,B);K.length>0&&(V=ze(fr(V,K),E.shape));let ne=Ks(E);return $s(qr(V,W(ne,"float32")))}}}},Wn={kernelName:ye.S,outputsToSave:[!0],gradFunc:(w,C)=>{let[I]=C,E=V=>V.eluDer(w,I),B={dy:w,y:I};return{x:()=>u.a.runKernelFunc(E,B,null,ye.T)}}},dh={kernelName:ye.V,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C,E=rn(Ru($s(Ks(I))),2/Math.sqrt(Math.PI));return{x:()=>rn(w,E)}}},Nr={kernelName:ye.W,outputsToSave:[!0],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn(w,I)}}},Hr={kernelName:ye.X,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn(w,Ru(I))}}},te={kernelName:ye.bb,gradFunc:w=>({x:()=>_o(w)})},b={kernelName:ye.cb,inputsToSave:["a","b"],gradFunc:(w,C)=>{let[I,E]=C,B=oo(I.shape,E.shape);return{a:()=>{let V=qr(w,W(E,"float32")),K=_s(I.shape,B);return K.length>0?ze(fr(V,K),I.shape):V},b:()=>{let V=rn(w,W(I,"float32")),K=_s(E.shape,B);K.length>0&&(V=ze(fr(V,K),E.shape));let ne=Ks(E);return $s(qr(V,W(ne,"float32")))}}}};let k=Object(M.a)({rsqrt_:function(w){let C=Object(z.a)(w,"x","rsqrt"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.rsqrt(C);return B([C]),V},I,null,ye.jc)}}),A={kernelName:ye.eb,inputsToSave:["x","mean","variance","scale"],gradFunc:(w,C,I)=>{let{varianceEpsilon:E}=I,[B,V,K,ne]=C,be=ne??yr(1),Ae=_s(V.shape,B.shape),We=[];if(V.rank===1){for(let Gt=0;Gt<B.shape.length-1;++Gt)We.push(B.shape[Gt]);We.push(1)}let ut=xr(B,V),bt=rn(w,be),St=k(xt(K,yr(E))),jt=rn(rn(rn(St,St),St),yr(-.5));return{x:()=>V.rank===1?ze(rn(rn(w,Gi(ze(St,[1,1,1,V.shape[0]]),We)),be),B.shape):ze(rn(rn(w,St),be),B.shape),mean:()=>{let Gt=rn(rn(St,yr(-1)),bt);return V.rank===1&&(Gt=fr(Gt,Ae)),ze(Gt,V.shape)},variance:()=>{let Gt=rn(rn(jt,ut),bt);return V.rank===1&&(Gt=fr(Gt,Ae)),ze(Gt,V.shape)},scale:()=>{let Gt=rn(ut,St),bn=rn(w,Gt);return V.rank===1&&(bn=fr(bn,Ae)),ze(bn,V.shape)},offset:()=>{let Gt=w;return V.rank===1&&(Gt=fr(Gt,Ae)),ze(Gt,V.shape)}}}};let j=Object(M.a)({unsortedSegmentSum_:function(w,C,I){let E=Object(z.a)(w,"x","unsortedSegmentSum"),B=Object(z.a)(C,"segmentIds","unsortedSegmentSum","int32");Object(S.b)(Object(S.v)(I),()=>"numSegments must be of dtype int");let V={x:E,segmentIds:B},K={numSegments:I};return u.a.runKernelFunc((ne,be)=>{let Ae=ne.unsortedSegmentSum(E,B,I);return be([B]),Ae},V,null,ye.Jc,K)}}),G={kernelName:ye.fb,inputsToSave:["x","indices"],gradFunc:(w,C,I)=>{let[E,B]=C,{axis:V}=I,K=Object(S.I)(V,E.shape)[0];return{x:()=>{let ne=E.shape,be=B.size,Ae=ne.slice(0,K),We=Ae.length,ut=ne.slice(V,ne.length).slice(1),bt=ut.length,St=H(0,We),jt=H(We+1,We+1+bt),Gt=re([Ae,[be],ut]),bn=ze(w,Gt),Zn=ze(B,[be]),zn=re([[We],St,jt]),tr=ms(bn,zn),Or=j(tr,Zn,E.shape[K]),Yr=ni(zn);return Or=ms(Or,Yr),Or},indices:()=>B}}};function H(w,C){let I=[];for(let E=w;E<C;++E)I.push(E);return I}function re(w){let C=[];for(let I=0;I<w.length;++I)for(let E=0;E<w[I].length;++E)C.push(w[I][E]);return C}let ie={kernelName:ye.hb,inputsToSave:["a","b"],gradFunc:(w,C)=>{let[I,E]=C;return{a:()=>_o(I),b:()=>_o(E)}}},me={kernelName:ye.jb,gradFunc:w=>({x:()=>W(w,"float32")})},_e={kernelName:ye.lb,gradFunc:w=>({x:()=>_o(w)})},Ue={kernelName:ye.mb,gradFunc:w=>({x:()=>_o(w)})},Be={kernelName:ye.nb,gradFunc:w=>({x:()=>_o(w)})},Ye={kernelName:ye.tb,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>qr(w,xt(I,1))}}},He={kernelName:ye.sb,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>qr(w,W(I,"float32"))}}},Ke={kernelName:ye.ub,inputsToSave:[],outputsToSave:[!0],gradFunc:(w,C,I)=>{let[E]=C,{axis:B}=I;return{logits:()=>{let V=Ru(E);return xr(w,rn(fr(w,B,!0),V))}}}};let Je=Object(M.a)({localResponseNormalizationBackprop_:function(w,C,I,E=5,B=1,V=1,K=.5){let ne={x:w,y:C,dy:I},be={depthRadius:E,bias:B,alpha:V,beta:K};return u.a.runKernelFunc(Ae=>Ae.LRNGrad(I,w,C,E,B,V,K),ne,null,ye.pb,be)}}),Nt={kernelName:ye.ob,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(w,C,I)=>{let[E,B]=C,{depthRadius:V,bias:K,alpha:ne,beta:be}=I;return{x:()=>Je(E,B,w,V,K,ne,be)}}};let Jt=Object(M.a)({equal_:function(w,C){let I=Object(z.a)(w,"a","equal"),E=Object(z.a)(C,"b","equal");[I,E]=Object(Oo.b)(I,E),oo(I.shape,E.shape);let B={a:I,b:E};return u.a.runKernelFunc(V=>V.equal(I,E),B,null,ye.U)}});function on(w,C,I,E){return C.rank<I.rank&&(C=ze(C,Ui(C.shape,E))),w.rank<I.rank&&(w=ze(w,Ui(w.shape,E))),{x:()=>rn(w,W(Jt(I,C),w.dtype))}}let dt={kernelName:ye.yb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(w,C,I)=>{let E=I,{reductionIndices:B}=E,V=C[0],K=on(w,C[1],V,S.I(B,V.shape));return{x:()=>K.x()}}};let Bt=Object(M.a)({less_:function(w,C){let I=Object(z.a)(w,"a","less"),E=Object(z.a)(C,"b","less");[I,E]=Object(Oo.b)(I,E),oo(I.shape,E.shape);let B={a:I,b:E};return u.a.runKernelFunc(V=>V.less(I,E),B,null,ye.qb)}}),wt={kernelName:ye.Eb,inputsToSave:["a","b"],gradFunc:(w,C)=>{let[I,E]=C;return{a:()=>rn(w,W(oh(I,E),"float32")),b:()=>rn(w,W(Bt(I,E),"float32"))}}};let In=Object(M.a)({maxPool3dBackprop_:function(w,C,I,E,B,V=[1,1,1],K,ne){let be=Object(z.a)(w,"dy","maxPool3dBackprop"),Ae=Object(z.a)(C,"input","maxPool3dBackprop"),We=Object(z.a)(I,"output","maxPool3dBackprop"),ut=be,bt=Ae,St=We,jt=!1;Ae.rank===4&&(jt=!0,ut=ze(be,[1,be.shape[0],be.shape[1],be.shape[2],be.shape[3]]),bt=ze(Ae,[1,Ae.shape[0],Ae.shape[1],Ae.shape[2],Ae.shape[3]]),St=ze(We,[1,We.shape[0],We.shape[1],We.shape[2],We.shape[3]])),S.b(ut.rank===5,()=>"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+ut.rank+"."),S.b(bt.rank===5,()=>"Error in maxPool3dBackprop: input must be rank 5 but got rank "+bt.rank+"."),S.b(St.rank===5,()=>"Error in maxPool3dBackprop: output must be rank 5 but got rank "+St.rank+"."),S.b(Cn(B,V),()=>`Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides ${B} and dilations '${V}'`),ne!=null&&S.b(S.v(K),()=>`Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode ${ne} but got pad ${K}.`);let Gt={dy:ut,input:bt,output:St},bn={filterSize:E,strides:B,dilations:V,pad:K,dimRoundingMode:ne},Zn=u.a.runKernelFunc(zn=>{let tr=Ge(bt.shape,E,B,V,K,ne);return zn.maxPool3dBackprop(ut,bt,St,tr)},Gt,null,ye.Bb,bn);return jt?ze(Zn,[Zn.shape[1],Zn.shape[2],Zn.shape[3],Zn.shape[4]]):Zn}}),Ut={kernelName:ye.Ab,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(w,C,I)=>{let[E,B]=C,{filterSize:V,strides:K,dilations:ne,pad:be,dimRoundingMode:Ae}=I,We=ne??[1,1,1];return{x:()=>In(w,E,B,V,K,We,be,Ae)}}};let kt=Object(M.a)({maxPoolBackprop_:function(w,C,I,E,B,V,K){let ne=Object(z.a)(w,"dy","maxPoolBackprop"),be=Object(z.a)(C,"input","maxPoolBackprop"),Ae=Object(z.a)(I,"output","maxPoolBackprop");S.b(be.rank===ne.rank,()=>`Rank of input (${be.rank}) does not match rank of dy (${ne.rank})`),S.b(ne.rank===4,()=>"Error in maxPoolBackprop: dy must be rank 4 but got rank "+ne.rank+"."),S.b(be.rank===4,()=>"Error in maxPoolBackprop: input must be rank 4 but got rank "+be.rank+"."),K!=null&&S.b(S.v(V),()=>`Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode ${K} but got pad ${V}.`);let We={dy:ne,input:be,output:Ae},ut={filterSize:E,strides:B,pad:V,dimRoundingMode:K};return u.a.runKernelFunc(bt=>{let St=Pe(be.shape,E,B,1,V,K);return bt.maxPoolBackprop(ne,be,Ae,St)},We,null,ye.Cb,ut)}}),cr={kernelName:ye.zb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(w,C,I)=>{let[E,B]=C,{filterSize:V,strides:K,pad:ne}=I;return{x:()=>kt(w,E,B,V,K,ne)}}},er={kernelName:ye.Gb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(w,C,I)=>{let E=I,{axis:B}=E,[V,K]=C,ne=on(w,K,V,S.I(B,V.shape));return{x:()=>ne.x()}}},kr={kernelName:ye.Hb,inputsToSave:["a","b"],gradFunc:(w,C)=>{let[I,E]=C;return{a:()=>rn(w,W(sh(I,E),"float32")),b:()=>rn(w,W(Ou(I,E),"float32"))}}},Kr={kernelName:ye.Ib,inputsToSave:["x"],gradFunc:(w,C,I)=>{let E=C[0],{paddings:B}=I,V=B.map(K=>K[0]);return{x:()=>Uo(w,V,E.shape)}}};let mn=Object(M.a)({floor_:function(w){let C=Object(z.a)(w,"x","floor"),I={x:C};return u.a.runKernelFunc(E=>E.floor(C),I,null,ye.bb)}}),Ys={kernelName:ye.Jb,inputsToSave:["a","b"],gradFunc:(w,C)=>{let[I,E]=C,B=oo(I.shape,E.shape);return{a:()=>{let V=_s(I.shape,B);return V.length>0?ze(fr(w,V),I.shape):w},b:()=>{let V=rn(w,$s(mn(qr(I,E)))),K=_s(E.shape,B);return K.length>0?ze(fr(V,K),E.shape):V}}}},Qs={kernelName:ye.Kb,inputsToSave:["a","b"],gradFunc:(w,C)=>{let[I,E]=C,B=oo(I.shape,E.shape);return{a:()=>{let V=rn(w,W(E,"float32")),K=_s(I.shape,B);return K.length>0?ze(fr(V,K),I.shape):V},b:()=>{let V=rn(w,W(I,"float32")),K=_s(E.shape,B);return K.length>0?ze(fr(V,K),E.shape):V}}}},Sn={kernelName:ye.Lb,gradFunc:w=>({x:()=>$s(w)})},Ls={kernelName:ye.Qb,inputsToSave:["indices"],gradFunc:(w,C)=>{let I=C[0];return{indices:()=>Oa(I.shape,"float32")}}},si={kernelName:ye.Rb,gradFunc:w=>({x:()=>_o(w)})},Bs={kernelName:ye.Sb,inputsToSave:["x"],gradFunc:(w,C,I)=>{let E=C[0],{paddings:B}=I,V=B.map(K=>K[0]);return{x:()=>Uo(w,V,E.shape)}}},ha={kernelName:ye.Tb,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(w,C)=>{let[I,E,B]=C,V=I,K=E,ne=oo(V.shape,K.shape);return{a:()=>{let be=W(K,"float32"),Ae=rn(w,rn(be,Yu(V,xr(be,yr(1))))),We=_s(V.shape,ne);return We.length>0&&(Ae=fr(Ae,We)),ze(Ae,V.shape)},b:()=>{let be=Ou(V,0),Ae=Jr(be,up(V),_o(V)),We=rn(w,rn(B,Ae)),ut=_s(K.shape,ne);return ut.length>0&&(We=fr(We,ut)),ze(We,K.shape)}}}},ii={kernelName:ye.Ub,inputsToSave:["x","alpha"],gradFunc:(w,C)=>{let[I,E]=C,B=Ou(I,0);return{x:()=>Jr(B,w,rn(w,E)),alpha:()=>{let V=Jr(B,_o(w),rn(w,I)),K=_s(E.shape,w.shape);return K.length>0&&(V=fr(V,K)),ze(V,E.shape)}}}},fo={kernelName:ye.Yb,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>qr(w,$s(Ks(I)))}}},Oc={kernelName:ye.ac,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C,E=rn(sh(I,6),pp(I));return{x:()=>rn(w,W(E,"float32"))}}},Rc={kernelName:ye.Zb,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn(w,W(pp(I),"float32"))}}},fh={kernelName:ye.bc,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>ze(w,I.shape)}}},IO={kernelName:ye.cc,inputsToSave:["images"],gradFunc:(w,C,I)=>{let[E]=C,B=K=>{let{alignCorners:ne}=I;return K.resizeBilinearBackprop(w,E,ne)},V={images:E};return{images:()=>u.a.runKernelFunc(B,V,null,ye.dc,I)}}},gs={kernelName:ye.ec,inputsToSave:["images"],gradFunc:(w,C,I)=>{let[E]=C,B=K=>{let{alignCorners:ne}=I;return K.resizeNearestNeighborBackprop(w,E,ne)},V={images:E};return{images:()=>u.a.runKernelFunc(B,V,null,ye.fc,I)}}},_O={kernelName:ye.gc,gradFunc:(w,C,I)=>{let{dims:E}=I,B=Object(S.I)(E,w.shape);return{x:()=>rh(w,B)}}},TO={kernelName:ye.ic,gradFunc:w=>({x:()=>_o(w)})},N_={kernelName:ye.jc,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>$s(qr(w,rn(Yu(I,1.5),2)))}}};let mS=Object(M.a)({logicalNot_:function(w){let C=Object(z.a)(w,"x","logicalNot","bool"),I={x:C};return u.a.runKernelFunc(E=>E.logicalNot(C),I,null,ye.wb)}}),ml={kernelName:ye.kc,inputsToSave:["condition"],gradFunc:(w,C)=>{let[I]=C;return{condition:()=>W(_o(I),"float32"),t:()=>rn(w,W(I,w.dtype)),e:()=>rn(w,W(mS(I),w.dtype))}}},Cb={kernelName:ye.lc,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>{let E=Ou(I,yr(0)),B=yr(cb),V=yr(Tg),K=rn(w,V),ne=rn(rn(w,B),Ru(W(I,"float32")));return Jr(E,K,ne)}}}},EO={kernelName:ye.mc,outputsToSave:[!0],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn(w,rn(I,xr(yr(1),I)))}}},Mu={kernelName:ye.nc,gradFunc:w=>({x:()=>_o(w)})};let au=Object(M.a)({cos_:function(w){let C=Object(z.a)(w,"x","cos"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.cos(C);return B([C]),V},I,null,ye.G)}}),bf={kernelName:ye.oc,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn(au(W(I,"float32")),w)}}};let Dy=Object(M.a)({cosh_:function(w){let C=Object(z.a)(w,"x","cosh"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.cosh(C);return B([C]),V},I,null,ye.H)}}),gS={kernelName:ye.pc,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn(Dy(W(I,"float32")),w)}}};let kg=Object(M.a)({pad_:function(w,C,I=0){let E=Object(z.a)(w,"x","pad");if(E.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let B={paddings:C,constantValue:I},V={x:E};return u.a.runKernelFunc((K,ne)=>(ne([E]),K.pad(E,C,I)),V,null,ye.Sb,B)}}),zs={kernelName:ye.qc,inputsToSave:["x"],gradFunc:(w,C,I)=>{let[E]=C,{begin:B,size:V}=I,K=E.shape,[ne,be]=Sc(E,B,V),Ae=[];for(let We=0;We<w.rank;We++)Ae.push([ne[We],K[We]-ne[We]-be[We]]);return{x:()=>kg(w,Ae)}}},fp={kernelName:ye.rc,outputsToSave:[!0],gradFunc:(w,C,I)=>{let[E]=C,{dim:B}=I,V=rn(w,E);return{logits:()=>xr(V,rn(fr(V,[B],!0),E))}}};let Mc=Object(M.a)({sigmoid_:function(w){let C=Object(z.a)(w,"x","sigmoid"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.sigmoid(C);return B([V]),V},I,null,ye.mc)}}),Dg={kernelName:ye.sc,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn(w,Mc(I))}}};let Fc=Object(M.a)({batchToSpaceND_:function(w,C,I){let E=Object(z.a)(w,"x","batchToSpaceND"),B=C.reduce((ne,be)=>ne*be);S.b(E.rank>=1+C.length,()=>`input rank is ${E.rank} but should be > than blockShape.length ${C.length}`),S.b(I.length===C.length,()=>`crops.length is ${I.length} but should be equal to blockShape.length  ${C.length}`),S.b(E.shape[0]%B==0,()=>`input tensor batch is ${E.shape[0]} but is not divisible by the product of the elements of blockShape ${C.join(" * ")} === ${B}`);let V={x:E},K={blockShape:C,crops:I};return u.a.runKernelFunc(ne=>ne.batchToSpaceND(E,C,I),V,null,ye.t,K)}}),yS={kernelName:ye.tc,gradFunc:(w,C,I)=>{let{blockShape:E,paddings:B}=I;return{x:()=>Fc(w,E,B)}}},vf={kernelName:ye.uc,gradFunc:(w,C,I)=>{let{axis:E}=I;return{x:()=>ar(w,E)}}},wf={kernelName:ye.vc,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>qr(w,rn(ec(W(I,"float32")),2))}}},Ag={kernelName:ye.wc,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn(w,rn(W(I,"float32"),2))}}},da={kernelName:ye.xc,inputsToSave:["a","b"],gradFunc:(w,C)=>{let[I,E]=C,B=yr(2);return{a:()=>rn(w,rn(B,xr(I,E))),b:()=>rn(w,rn(B,xr(E,I)))}}},Ib={kernelName:ye.yc,gradFunc:w=>({x:()=>_o(w)})},is={kernelName:ye.Ac,inputsToSave:["a","b"],gradFunc:(w,C)=>{let[I,E]=C,B=oo(I.shape,E.shape);return{a:()=>{let V=w,K=_s(I.shape,B);return K.length>0&&(V=fr(V,K)),ze(V,I.shape)},b:()=>{let V=w,K=_s(E.shape,B);return K.length>0&&(V=fr(V,K)),ze($s(V),E.shape)}}}},Og={kernelName:ye.Bc,inputsToSave:["x"],gradFunc:(w,C,I)=>{let[E]=C,B=E.shape.slice(),{axis:V}=I;Object(S.I)(V,E.shape).forEach(be=>{B[be]=1});let K=ze(w,B),ne=rn(K,ip(E.shape,"float32"));return{x:()=>ne}}},Sf={kernelName:ye.Cc,inputsToSave:["x"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>qr(w,Ks(au(I)))}}},Cf={kernelName:ye.Dc,outputsToSave:[!0],gradFunc:(w,C)=>{let[I]=C;return{x:()=>rn(xr(yr(1),Ks(I)),w)}}},Rg={kernelName:ye.Ec,inputsToSave:["x"],gradFunc:(w,C,I)=>{let[E]=C,{reps:B}=I;return{x:()=>{let V=_o(E);if(E.rank===1)for(let K=0;K<B[0];++K)V=xt(V,Uo(w,[K*E.shape[0]],[E.shape[0]]));else if(E.rank===2)for(let K=0;K<B[0];++K)for(let ne=0;ne<B[1];++ne)V=xt(V,Uo(w,[K*E.shape[0],ne*E.shape[1]],[E.shape[0],E.shape[1]]));else if(E.rank===3)for(let K=0;K<B[0];++K)for(let ne=0;ne<B[1];++ne)for(let be=0;be<B[2];++be)V=xt(V,Uo(w,[K*E.shape[0],ne*E.shape[1],be*E.shape[2]],[E.shape[0],E.shape[1],E.shape[2]]));else{if(E.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+E.rank+" tensors yet.");for(let K=0;K<B[0];++K)for(let ne=0;ne<B[1];++ne)for(let be=0;be<B[2];++be)for(let Ae=0;Ae<B[3];++Ae)V=xt(V,Uo(w,[K*E.shape[0],ne*E.shape[1],be*E.shape[2],Ae*E.shape[3]],[E.shape[0],E.shape[1],E.shape[2],E.shape[3]]))}return V}}}},Mg={kernelName:ye.Gc,gradFunc:(w,C,I)=>{let E=I,{perm:B}=E,V=ni(B);return{x:()=>ms(w,V)}}},k_={kernelName:ye.Ic,gradFunc:(w,C,I)=>{let E=I,{axis:B}=E;return{value:()=>nu(w,B)}}};let Pc=Object(M.a)({gather_:function(w,C,I=0){let E=Object(z.a)(w,"x","gather"),B=Object(z.a)(C,"indices","gather","int32"),V={x:E,indices:B},K={axis:I};return u.a.runKernelFunc((ne,be)=>{let Ae=Object(S.I)(I,E.shape)[0],We=_y(E,B,Ae),ut=ne.gather(E,ze(B,[B.size]),Ae);return be([E,B]),ze(ut,We.outputShape)},V,null,ye.fb,K)}});let gl=Object(M.a)({maximum_:function(w,C){let I=Object(z.a)(w,"a","maximum"),E=Object(z.a)(C,"b","maximum");[I,E]=Object(Oo.b)(I,E),I.dtype==="bool"&&(I=W(I,"int32"),E=W(E,"int32")),oo(I.shape,E.shape);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.maximum(I,E);return K([I,E]),ne},B,null,ye.Eb)}});let yl=[uh,Pn,wi,gf,xb,bb,Ty,vb,Ey,pS,wb,ch,hS,To,dS,pl,Ng,lh,fS,su,ot,Ny,hl,yf,hp,Sb,eo,fl,hh,dp,Wn,dh,Nr,Hr,b,te,A,G,ie,me,_e,Ue,Be,Ye,He,Ke,Nt,dt,dt,wt,Ut,cr,er,kr,Kr,Ys,Qs,Sn,Ls,si,Bs,Bs,ha,ii,fo,Oc,Rc,fh,IO,gs,_O,TO,N_,ml,Cb,EO,Mu,bf,gS,zs,fp,Dg,yS,yS,vf,vf,wf,da,Ag,Ib,is,Og,Sf,Cf,Rg,Mg,k_,{kernelName:ye.Jc,inputsToSave:["segmentIds"],gradFunc:(w,C)=>{let[I]=C;return{x:()=>function(E,B){let V=gl(B,_o(B)),K=Pc(E,V),ne=oh(B,yr(0,"int32")),be=K.rank-ne.rank;for(let We=0;We<be;++We)ne=Ju(ne,We+1);ne=ih(ne,ip(K.shape,"bool"));let Ae=_o(K);return Jr(ne,K,Ae)}(w,I)}}},{kernelName:ye.Kc,gradFunc:w=>({x:()=>_o(w)})}];for(let w of yl)Object(Sy.d)(w);Ce.a.prototype.abs=function(){return this.throwIfDisposed(),ru(this)};let _b=Object(M.a)({acos_:function(w){let C=Object(z.a)(w,"x","acos"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.acos(C);return B([C]),V},I,null,ye.b)}});Ce.a.prototype.acos=function(){return this.throwIfDisposed(),_b(this)};let fa=Object(M.a)({acosh_:function(w){let C=Object(z.a)(w,"x","acosh"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.acosh(C);return B([C]),V},I,null,ye.c)}});Ce.a.prototype.acosh=function(){return this.throwIfDisposed(),fa(this)};let xS=Object(M.a)({mod_:function(w,C){let I=Object(z.a)(w,"a","mod"),E=Object(z.a)(C,"b","mod");[I,E]=Object(Oo.b)(I,E);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.mod(I,E);return K([I,E]),ne},B,null,ye.Jb)}});let mp=Object(M.a)({addStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","addStrict"),E=Object(z.a)(C,"b","addStrict");return S.e(I.shape,E.shape,"Error in addStrict: "),xt(I,E)}}),If=Object(M.a)({divStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","div"),E=Object(z.a)(C,"b","div");return S.e(I.shape,E.shape,"Error in divideStrict: "),qr(I,E)}}),Tb=Object(M.a)({maximumStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","maximumStrict"),E=Object(z.a)(C,"b","maximumStrict");return S.e(I.shape,E.shape,"Error in maximumStrict: "),gl(I,E)}}),Eb=Object(M.a)({minimumStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","minimumStrict"),E=Object(z.a)(C,"b","minimumStrict");return S.e(I.shape,E.shape,"Error in minimumStrict: "),ap(I,E)}}),D_=Object(M.a)({modStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","modStrict"),E=Object(z.a)(C,"b","modStrict");return S.e(I.shape,E.shape,"Error in modStrict: "),xS(I,E)}}),A_=Object(M.a)({mulStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","mul"),E=Object(z.a)(C,"b","mul");return S.e(I.shape,E.shape,"Error in multiplyStrict: "),rn(I,E)}}),bS=Object(M.a)({powStrict_:function(w,C){return Xs("strict variants of ops have been deprecated and will be removed in future"),S.e(w.shape,C.shape,"Error in powStrict: "),Yu(w,C)}}),_f=Object(M.a)({squaredDifferenceStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","squaredDifferenceStrict"),E=Object(z.a)(C,"b","squaredDifferenceStrict");return S.e(I.shape,E.shape,"Error in squaredDifferenceStrict: "),cp(I,E)}}),Nb=Object(M.a)({subStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","subStrict"),E=Object(z.a)(C,"b","subStrict");return S.e(I.shape,E.shape,"Error in subStrict: "),xr(I,E)}});Ce.a.prototype.addStrict=function(w){return this.throwIfDisposed(),mp(this,w)},Ce.a.prototype.add=function(w){return this.throwIfDisposed(),xt(this,w)};let Ay=Object(M.a)({all_:function(w,C=null,I=!1){let E=Object(z.a)(w,"x","all","bool"),B={x:E},V={axis:C,keepDims:I};return u.a.runKernelFunc(K=>{let ne=Object(S.I)(C,E.shape),be=ne,Ae=qi(be,E.rank);Ae!=null&&(E=ms(E,Ae),be=Aa(be.length,E.rank));let We=K.all(E,be);if(I){let ut=Ui(We.shape,ne);return ze(We,ut)}return We},B,null,ye.f,V)}});Ce.a.prototype.all=function(w,C){return this.throwIfDisposed(),Ay(this,w,C)};let Oy=Object(M.a)({any_:function(w,C=null,I=!1){let E=Object(z.a)(w,"x","any","bool"),B={x:E},V={axis:C,keepDims:I};return u.a.runKernelFunc(K=>{let ne=Object(S.I)(C,E.shape),be=ne,Ae=qi(be,E.rank);Ae!=null&&(E=ms(E,Ae),be=Aa(be.length,E.rank));let We=K.any(E,be);if(I){let ut=Ui(We.shape,ne);return ze(We,ut)}return We},B,null,ye.g,V)}});Ce.a.prototype.any=function(w,C){return this.throwIfDisposed(),Oy(this,w,C)};let NO=Object(M.a)({argMax_:function(w,C=0){let I=Object(z.a)(w,"x","argMax"),E={x:I},B={axis:C};return u.a.runKernelFunc((V,K)=>{K([I]);let ne=S.I(C,I.shape),be=qi(ne,I.rank);return be!=null&&(I=ms(I,be),ne=Aa(ne.length,I.rank)),V.argMax(I,ne[0])},E,null,ye.h,B)}});Ce.a.prototype.argMax=function(w){return this.throwIfDisposed(),NO(this,w)};let Oi=Object(M.a)({argMin_:function(w,C=0){let I=Object(z.a)(w,"x","argMin"),E={x:I},B={axis:C};return u.a.runKernelFunc((V,K)=>{K([I]),C==null&&(C=0);let ne=S.I(C,I.shape),be=qi(ne,I.rank);return be!=null&&(I=ms(I,be),ne=Aa(ne.length,I.rank)),V.argMin(I,ne[0])},E,null,ye.i,B)}});Ce.a.prototype.argMin=function(w){return this.throwIfDisposed(),Oi(this,w)},Ce.a.prototype.asScalar=function(){return this.throwIfDisposed(),Object(S.b)(this.size===1,()=>"The array must have only 1 element."),ze(this,[])},Ce.a.prototype.asType=function(w){return this.throwIfDisposed(),W(this,w)},Ce.a.prototype.as1D=function(){return this.throwIfDisposed(),ze(this,[this.size])},Ce.a.prototype.as2D=function(w,C){return this.throwIfDisposed(),ze(this,[w,C])},Ce.a.prototype.as3D=function(w,C,I){return this.throwIfDisposed(),ze(this,[w,C,I])},Ce.a.prototype.as4D=function(w,C,I,E){return this.throwIfDisposed(),ze(this,[w,C,I,E])},Ce.a.prototype.as5D=function(w,C,I,E,B){return this.throwIfDisposed(),ze(this,[w,C,I,E,B])};let kb=Object(M.a)({asin_:function(w){let C=Object(z.a)(w,"x","asin"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.asin(C);return B([C]),V},I,null,ye.j)}});Ce.a.prototype.asin=function(){return this.throwIfDisposed(),kb(this)};let Fu=Object(M.a)({asinh_:function(w){let C=Object(z.a)(w,"x","asinh"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.asinh(C);return B([C]),V},I,null,ye.k)}});Ce.a.prototype.asinh=function(){return this.throwIfDisposed(),Fu(this)};let Ri=Object(M.a)({atan_:function(w){let C=Object(z.a)(w,"x","atan"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.atan(C);return B([C]),V},I,null,ye.l)}});Ce.a.prototype.atan=function(){return this.throwIfDisposed(),Ri(this)};let Fg=Object(M.a)({atan2_:function(w,C){let I=Object(z.a)(w,"a","atan2"),E=Object(z.a)(C,"b","atan2");[I,E]=Object(Oo.b)(I,E);let B={a:I,b:E};return u.a.runKernelFunc((V,K)=>{let ne=V.atan2(I,E);return K([I,E]),ne},B,null,ye.m)}});Ce.a.prototype.atan2=function(w){return this.throwIfDisposed(),Fg(this,w)};let gp=Object(M.a)({atanh_:function(w){let C=Object(z.a)(w,"x","atanh"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.atanh(C);return B([C]),V},I,null,ye.n)}});Ce.a.prototype.atanh=function(){return this.throwIfDisposed(),gp(this)};let Tf=Object(M.a)({avgPool_:function(w,C,I,E,B){let V=Object(z.a)(w,"x","avgPool","float32");S.b(Cn(I,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${I} and dilations '1'`);let K=V,ne=!1;V.rank===3&&(ne=!0,K=ze(V,[1,V.shape[0],V.shape[1],V.shape[2]])),S.b(K.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${K.rank}.`),B!=null&&S.b(S.v(E),()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${B} but got pad ${E}.`);let be={x:K},Ae={filterSize:C,strides:I,pad:E,dimRoundingMode:B},We=u.a.runKernelFunc((ut,bt)=>{let St=Pe(K.shape,C,I,1,E,B);return bt([K]),St.filterWidth===1&&St.filterHeight===1&&S.a(St.inShape,St.outShape)?K.clone():ut.avgPool(K,St)},be,null,ye.o,Ae);return We=W(We,V.dtype),ne?ze(We,[We.shape[1],We.shape[2],We.shape[3]]):We}});Ce.a.prototype.avgPool=function(w,C,I,E){return this.throwIfDisposed(),Tf(this,w,C,I,E)},Ce.a.prototype.batchToSpaceND=function(w,C){return this.throwIfDisposed(),Fc(this,w,C)},Ce.a.prototype.batchNorm=function(w,C,I,E,B){return this.throwIfDisposed(),Yt(this,w,C,I,E,B)},Ce.a.prototype.broadcastTo=function(w){return this.throwIfDisposed(),op(this,w)},Ce.a.prototype.cast=function(w){return this.throwIfDisposed(),W(this,w)};let vS=Object(M.a)({ceil_:function(w){let C=Object(z.a)(w,"x","ceil"),I={x:C};return u.a.runKernelFunc(E=>E.ceil(C),I,null,ye.w)}});Ce.a.prototype.ceil=function(){return this.throwIfDisposed(),vS(this)};let Pg=Object(M.a)({clipByValue_:function(w,C,I){let E=Object(z.a)(w,"x","clipByValue");S.b(C<=I,()=>`Error in clip: min (${C}) must be less than or equal to max (${I}).`);let B={x:E},V={clipValueMin:C,clipValueMax:I};return u.a.runKernelFunc((K,ne)=>{let be=K.clip(E,C,I);return ne([E]),be},B,null,ye.x,V)}});Ce.a.prototype.clipByValue=function(w,C){return this.throwIfDisposed(),Pg(this,w,C)},Ce.a.prototype.concat=function(w,C){return this.throwIfDisposed(),w instanceof Ce.a&&(w=[w]),ar([this,...w],C)};let uu=Object(M.a)({conv1d_:function(w,C,I,E,B="NWC",V=1,K){let ne=Object(z.a)(w,"x","conv1d"),be=Object(z.a)(C,"filter","conv1d"),Ae=ne,We=!1;ne.rank===2&&(We=!0,Ae=ze(ne,[1,ne.shape[0],ne.shape[1]])),S.b(Ae.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${Ae.rank}.`),S.b(be.rank===3,()=>"Error in conv1d: filter must be rank 3, but got rank "+be.rank+"."),K!=null&&S.b(S.v(E),()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${K} but got pad ${E}.`),S.b(Ae.shape[2]===be.shape[1],()=>`Error in conv1d: depth of input (${Ae.shape[2]}) must match input depth for filter ${be.shape[1]}.`),S.b(Cn(I,V),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${I} and dilation '${V}'`),S.b(B==="NWC",()=>`Error in conv1d: got dataFormat of ${B} but only NWC is currently supported.`);let ut=ze(be,[1,be.shape[0],be.shape[1],be.shape[2]]),bt=ze(Ae,[Ae.shape[0],1,Ae.shape[1],Ae.shape[2]]),St=Zo(bt,ut,[1,I],E,"NHWC",[1,V],K);return ze(St,We?[St.shape[2],St.shape[3]]:[St.shape[0],St.shape[2],St.shape[3]])}});Ce.a.prototype.conv1d=function(w,C,I,E,B,V){return this.throwIfDisposed(),uu(this,w,C,I,E,B,V)};let $g=Object(M.a)({conv2dTranspose_:function(w,C,I,E,B,V){let K=Object(z.a)(w,"x","conv2dTranspose"),ne=Object(z.a)(C,"filter","conv2dTranspose");return oi(I,K,ne,E,B,"NHWC",V)}});Ce.a.prototype.conv2dTranspose=function(w,C,I,E,B){return this.throwIfDisposed(),$g(this,w,C,I,E,B)},Ce.a.prototype.conv2d=function(w,C,I,E,B,V){return this.throwIfDisposed(),Zo(this,w,C,I,E,B,V)},Ce.a.prototype.cos=function(){return this.throwIfDisposed(),au(this)},Ce.a.prototype.cosh=function(){return this.throwIfDisposed(),Dy(this)},Ce.a.prototype.cumsum=function(w,C,I){return this.throwIfDisposed(),eh(this,w,C,I)};let mh=Object(M.a)({depthToSpace_:function(w,C,I="NHWC"){let E=Object(z.a)(w,"x","depthToSpace"),B=I==="NHWC"?E.shape[1]:E.shape[2],V=I==="NHWC"?E.shape[2]:E.shape[3],K=I==="NHWC"?E.shape[3]:E.shape[1];S.b(B*C>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${B} and ${C}  for depthToSpace with input shape
    ${E.shape}`),S.b(V*C>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${V} and ${C} for depthToSpace with input shape
        ${E.shape}`),S.b(K%(C*C)==0,()=>`Dimension size must be evenly divisible by ${C*C} but is ${K} for depthToSpace with input shape ${E.shape}`);let ne={x:E},be={blockSize:C,dataFormat:I};return u.a.runKernelFunc(Ae=>Ae.depthToSpace(E,C,I),ne,null,ye.K,be)}});Ce.a.prototype.depthToSpace=function(w,C){return this.throwIfDisposed(),mh(this,w,C)},Ce.a.prototype.depthwiseConv2D=function(w,C,I,E,B,V){return Xs("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),ul(this,w,C,I,E,B,V)},Ce.a.prototype.depthwiseConv2d=function(w,C,I,E,B,V){return this.throwIfDisposed(),ul(this,w,C,I,E,B,V)};let Db=Object(M.a)({dilation2d_:function(w,C,I,E,B=[1,1],V="NHWC"){let K=Object(z.a)(w,"x","dilation2d"),ne=Object(z.a)(C,"filter","dilation2d");S.b(K.rank===3||K.rank===4,()=>"Error in dilation2d: input must be rank 3 or 4, but got rank "+K.rank+"."),S.b(ne.rank===3,()=>"Error in dilation2d: filter must be rank 3, but got rank "+ne.rank+"."),S.b(V==="NHWC",()=>"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of "+V);let be=K,Ae=!1;K.rank===3&&(be=ze(K,[1,K.shape[0],K.shape[1],K.shape[2]]),Ae=!0);let We={x:be,filter:ne},ut={strides:I,pad:E,dilations:B},bt=u.a.runKernel(ye.O,We,ut);return Ae?ze(bt,[bt.shape[1],bt.shape[2],bt.shape[3]]):bt}});Ce.a.prototype.dilation2d=function(w,C,I,E,B){return this.throwIfDisposed(),Db(this,w,C,I,E,B)};let Ab=Object(M.a)({divNoNan_:function(w,C){let I=Object(z.a)(w,"a","div"),E=Object(z.a)(C,"b","div");[I,E]=Object(Oo.b)(I,E);let B=qr(I,E),V=_o(B),K=Jt(E,V);return Jr(K,V,B)}});Ce.a.prototype.divNoNan=function(w){return this.throwIfDisposed(),Ab(this,w)},Ce.a.prototype.divStrict=function(w){return this.throwIfDisposed(),If(this,w)},Ce.a.prototype.div=function(w){return this.throwIfDisposed(),qr(this,w)};let O_=Object(M.a)({dot_:function(w,C){let I=Object(z.a)(w,"t1","dot"),E=Object(z.a)(C,"t2","dot");S.b(!(I.rank!==1&&I.rank!==2||E.rank!==1&&E.rank!==2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${I.rank} and ${E.rank}.`);let B=I.rank===1?I.size:I.shape[1],V=E.rank===1?E.size:E.shape[0];if(S.b(B===V,()=>`Error in dot: inner dimensions of inputs must match, but got ${B} and ${V}.`),I.rank===1&&E.rank===1){let K=ze(I,[1,-1]),ne=ze(E,[-1,1]),be=jo(K,ne);return ze(be,[])}if(I.rank===1&&E.rank===2){let K=ze(I,[1,-1]),ne=ze(E,[E.shape[0],E.shape[1]]),be=jo(K,ne);return ze(be,[be.size])}if(I.rank===2&&E.rank===1){let K=ze(E,[-1,1]),ne=jo(I,K);return ze(ne,[ne.size])}{let K=ze(E,[E.shape[0],E.shape[1]]);return jo(I,K)}}});Ce.a.prototype.dot=function(w){return this.throwIfDisposed(),O_(this,w)},Ce.a.prototype.elu=function(){return this.throwIfDisposed(),nb(this)};let Ob=Object(M.a)({equalStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","equalStrict"),E=Object(z.a)(C,"b","equalStrict");return Object(S.e)(I.shape,E.shape,"Error in equalStrict: "),Jt(I,E)}}),Lg=Object(M.a)({greaterEqualStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","greaterEqualStrict"),E=Object(z.a)(C,"b","greaterEqualStrict");return Object(S.e)(I.shape,E.shape,"Error in greaterEqualStrict: "),oh(I,E)}}),Rb=Object(M.a)({greaterStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","greaterStrict"),E=Object(z.a)(C,"b","greaterStrict");return Object(S.e)(I.shape,E.shape,"Error in greaterStrict: "),Ou(I,E)}}),wS=Object(M.a)({lessEqualStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","lessEqualStrict"),E=Object(z.a)(C,"b","lessEqualStrict");return Object(S.e)(I.shape,E.shape,"Error in lessEqualStrict: "),sh(I,E)}}),SS=Object(M.a)({lessStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","lessStrict"),E=Object(z.a)(C,"b","lessStrict");return Object(S.e)(I.shape,E.shape,"Error in lessStrict: "),Bt(I,E)}}),R_=Object(M.a)({notEqualStrict_:function(w,C){Xs("strict variants of ops have been deprecated and will be removed in future");let I=Object(z.a)(w,"a","notEqualStrict"),E=Object(z.a)(C,"b","notEqualStrict");return Object(S.e)(I.shape,E.shape,"Error in notEqualStrict: "),mf(I,E)}});Ce.a.prototype.equalStrict=function(w){return this.throwIfDisposed(),Ob(this,w)},Ce.a.prototype.equal=function(w){return this.throwIfDisposed(),Jt(this,w)};let CS=Object(M.a)({erf_:function(w){let C=Object(z.a)(w,"x","erf");S.b(C.dtype==="int32"||C.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),C.dtype==="int32"&&(C=W(C,"float32"));let I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.erf(C);return B([C]),V},I,null,ye.V)}});Ce.a.prototype.erf=function(){return this.throwIfDisposed(),CS(this)},Ce.a.prototype.exp=function(){return this.throwIfDisposed(),Ru(this)},Ce.a.prototype.expandDims=function(w){return this.throwIfDisposed(),Ju(this,w)};let M_=Object(M.a)({expm1_:function(w){let C=Object(z.a)(w,"x","expm1"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.expm1(C);return B([C]),V},I,null,ye.X)}});Ce.a.prototype.expm1=function(){return this.throwIfDisposed(),M_(this)},Ce.a.prototype.fft=function(){return this.throwIfDisposed(),gy(this)},Ce.a.prototype.flatten=function(){return this.throwIfDisposed(),ze(this,[this.size])},Ce.a.prototype.floor=function(){return this.throwIfDisposed(),mn(this)},Ce.a.prototype.floorDiv=function(w){return this.throwIfDisposed(),gg(this,w)},Ce.a.prototype.gather=function(w,C){return this.throwIfDisposed(),Pc(this,w,C)},Ce.a.prototype.greaterEqualStrict=function(w){return this.throwIfDisposed(),Lg(this,w)},Ce.a.prototype.greaterEqual=function(w){return this.throwIfDisposed(),oh(this,w)},Ce.a.prototype.greaterStrict=function(w){return this.throwIfDisposed(),Rb(this,w)},Ce.a.prototype.greater=function(w){return this.throwIfDisposed(),Ou(this,w)},Ce.a.prototype.ifft=function(){return this.throwIfDisposed(),nh(this)},Ce.a.prototype.irfft=function(){return this.throwIfDisposed(),Wx(this)};let Bg=Object(M.a)({isFinite_:function(w){let C=Object(z.a)(w,"x","isFinite"),I={x:C};return u.a.runKernelFunc(E=>E.isFinite(C),I,null,ye.lb)}});Ce.a.prototype.isFinite=function(){return this.throwIfDisposed(),Bg(this)};let zg=Object(M.a)({isInf_:function(w){let C=Object(z.a)(w,"x","isInf"),I={x:C};return u.a.runKernelFunc(E=>E.isInf(C),I,null,ye.mb)}});Ce.a.prototype.isInf=function(){return this.throwIfDisposed(),zg(this)};let Vg=Object(M.a)({isNaN_:function(w){let C=Object(z.a)(w,"x","isNaN"),I={x:C};return u.a.runKernelFunc(E=>E.isNaN(C),I,null,ye.nb)}});Ce.a.prototype.isNaN=function(){return this.throwIfDisposed(),Vg(this)};let Mb=Object(M.a)({leakyRelu_:function(w,C=.2){let I=Object(z.a)(w,"x","leakyRelu");return gl(rn(yr(C),I),I)}});Ce.a.prototype.leakyRelu=function(w){return this.throwIfDisposed(),Mb(this,w)},Ce.a.prototype.lessEqualStrict=function(w){return this.throwIfDisposed(),wS(this,w)},Ce.a.prototype.lessEqual=function(w){return this.throwIfDisposed(),sh(this,w)},Ce.a.prototype.lessStrict=function(w){return this.throwIfDisposed(),SS(this,w)},Ce.a.prototype.less=function(w){return this.throwIfDisposed(),Bt(this,w)};let Fb=Object(M.a)({localResponseNormalization_:function(w,C=5,I=1,E=1,B=.5){let V=Object(z.a)(w,"x","localResponseNormalization");S.b(V.rank===4||V.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${V.rank}.`),S.b(S.v(C),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${C}.`);let K=V,ne=!1;V.rank===3&&(ne=!0,K=ze(V,[1,V.shape[0],V.shape[1],V.shape[2]]));let be={x:K},Ae={depthRadius:C,bias:I,alpha:E,beta:B},We=u.a.runKernelFunc((ut,bt)=>{let St=ut.localResponseNormalization4D(K,C,I,E,B);return bt([K,St]),St},be,null,ye.ob,Ae);return ne?ze(We,[We.shape[1],We.shape[2],We.shape[3]]):We}});Ce.a.prototype.localResponseNormalization=function(w,C,I,E){return this.throwIfDisposed(),Fb(this,w,C,I,E)};let Ef=Object(M.a)({softplus_:function(w){let C=Object(z.a)(w,"x","softplus"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.softplus(C);return B([C]),V},I,null,ye.sc)}});let $c=Object(M.a)({logSigmoid_:function(w){let C=Object(z.a)(w,"x","logSigmoid");return Sg(I=>({value:$s(Ef($s(I))),gradFunc:E=>rn(E,Mc($s(I)))}))(C)}});Ce.a.prototype.logSigmoid=function(){return this.throwIfDisposed(),$c(this)};let jg=Object(M.a)({logSoftmax_:function(w,C=-1){let I=Object(z.a)(w,"logits","logSoftmax");if(C===-1&&(C=I.rank-1),C!==I.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${I.rank} and axis was ${C}`);let E={logits:I},B={axis:C};return u.a.runKernelFunc((V,K)=>{let ne=ua(w,C,!0),be=xr(w,ne),Ae=xr(W(be,"float32"),up(fr(Ru(be),C,!0)));return K([Ae]),Ae},E,null,ye.ub,B)}});Ce.a.prototype.logSoftmax=function(w){return this.throwIfDisposed(),jg(this,w)},Ce.a.prototype.logSumExp=function(w,C){return this.throwIfDisposed(),tb(this,w,C)},Ce.a.prototype.log=function(){return this.throwIfDisposed(),up(this)},Ce.a.prototype.log1p=function(){return this.throwIfDisposed(),lp(this)},Ce.a.prototype.logicalAnd=function(w){return this.throwIfDisposed(),ih(this,w)},Ce.a.prototype.logicalNot=function(){return this.throwIfDisposed(),mS(this)};let Nf=Object(M.a)({logicalOr_:function(w,C){let I=Object(z.a)(w,"a","logicalOr","bool"),E=Object(z.a)(C,"b","logicalOr","bool");oo(I.shape,E.shape);let B={a:I,b:E};return u.a.runKernelFunc(V=>V.logicalOr(I,E),B,null,ye.xb)}});Ce.a.prototype.logicalOr=function(w){return this.throwIfDisposed(),Nf(this,w)};let kO=Object(M.a)({logicalXor_:function(w,C){let I=Object(z.a)(w,"a","logicalXor","bool"),E=Object(z.a)(C,"b","logicalXor","bool");return oo(I.shape,E.shape),ih(Nf(w,C),mS(ih(w,C)))}});Ce.a.prototype.logicalXor=function(w){return this.throwIfDisposed(),kO(this,w)},Ce.a.prototype.matMul=function(w,C,I){return this.throwIfDisposed(),jo(this,w,C,I)},Ce.a.prototype.maxPool=function(w,C,I,E){return this.throwIfDisposed(),lf(this,w,C,I,E)},Ce.a.prototype.max=function(w,C){return this.throwIfDisposed(),ua(this,w,C)},Ce.a.prototype.maximumStrict=function(w){return this.throwIfDisposed(),Tb(this,w)},Ce.a.prototype.maximum=function(w){return this.throwIfDisposed(),gl(this,w)},Ce.a.prototype.mean=function(w,C){return this.throwIfDisposed(),wy(this,w,C)},Ce.a.prototype.min=function(w,C){return this.throwIfDisposed(),wg(this,w,C)},Ce.a.prototype.minimumStrict=function(w){return this.throwIfDisposed(),Eb(this,w)},Ce.a.prototype.minimum=function(w){return this.throwIfDisposed(),ap(this,w)};let DO=Object(M.a)({mirrorPad_:function(w,C,I){S.b(I==="reflect"||I==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${I}.`);let E=Object(z.a)(w,"x","mirrorPad");if(E.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");S.b(C.length===E.rank,()=>`Padding doesn't match input. Must be ${E.rank}. Got ${C.length}.`);let B=I==="reflect"?1:0;for(let ne=0;ne<E.rank;ne++)S.b(C[ne].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),S.b(C[ne][0]>=0&&C[ne][0]<=E.shape[ne]-B&&C[ne][1]>=0&&C[ne][1]<=E.shape[ne]-B,()=>`Padding in dimension ${ne} cannot be greater than or equal to ${E.shape[ne]-B} or less than 0 for input of shape `+E.shape);let V={paddings:C,mode:I},K={x:E};return u.a.runKernel(ye.Ib,K,V)}});Ce.a.prototype.mirrorPad=function(w,C){return this.throwIfDisposed(),DO(this,w,C)},Ce.a.prototype.modStrict=function(w){return this.throwIfDisposed(),D_(this,w)},Ce.a.prototype.mod=function(w){return this.throwIfDisposed(),xS(this,w)},Ce.a.prototype.mulStrict=function(w){return this.throwIfDisposed(),A_(this,w)},Ce.a.prototype.mul=function(w){return this.throwIfDisposed(),rn(this,w)},Ce.a.prototype.neg=function(){return this.throwIfDisposed(),$s(this)},Ce.a.prototype.norm=function(w,C,I){return this.throwIfDisposed(),by(this,w,C,I)},Ce.a.prototype.notEqualStrict=function(w){return this.throwIfDisposed(),R_(this,w)},Ce.a.prototype.notEqual=function(w){return this.throwIfDisposed(),mf(this,w)},Ce.a.prototype.oneHot=function(w,C=1,I=0){return this.throwIfDisposed(),yg(this,w,C,I)};let Ug=Object(M.a)({onesLike_:function(w){let C=Object(z.a)(w,"x","onesLike"),I={x:C};return u.a.runKernelFunc((E,B)=>{if(C.dtype==="complex64"){let V=Ug(sp(C)),K=_o(bg(C));return Object(Cc.a)(V,K)}return E.onesLike(C)},I,null,ye.Rb)}});Ce.a.prototype.onesLike=function(){return this.throwIfDisposed(),Ug(this)},Ce.a.prototype.pad=function(w,C){return this.throwIfDisposed(),kg(this,w,C)};let F_=Object(M.a)({pool_:function(w,C,I,E,B,V){B==null&&(B=[1,1]),V==null&&(V=1),E===0&&(E="valid");let K=Object(z.a)(w,"x","maxPool"),ne=K,be=!1;K.rank===3&&(be=!0,ne=ze(K,[1,K.shape[0],K.shape[1],K.shape[2]])),S.b(Cn(V,B),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${V} and dilations '${B}'`);let Ae=Pe(ne.shape,C,V,B,E),We=[Ae.dilationHeight,Ae.dilationWidth],ut;ut=E==="same"?function(tr,Or){let Yr=tr.map((Wr,Ts)=>Wr+(Wr-1)*(Or[Ts]-1)).map(Wr=>Wr-1),Ro=Yr.map(Wr=>Math.floor(Wr/2)),ma=Yr.map((Wr,Ts)=>Wr-Ro[Ts]);return Yr.map((Wr,Ts)=>[Ro[Ts],ma[Ts]])}([Ae.filterHeight,Ae.filterWidth],We):[[0,0],[0,0]];let bt=We[0]===1&&We[1]===1,[St,jt]=function(tr,Or,Yr){let Ro=Yr.map(ys=>ys[0]),ma=Yr.map(ys=>ys[1]),Wr=tr.concat(Ro,ma),Ts=Or.map((ys,Zs)=>(ys-Wr[Zs]%ys)%ys),Jo=ma.map((ys,Zs)=>ys+Ts[Zs]),cu=Or.map((ys,Zs)=>[Ro[Zs],Jo[Zs]]),lu=Or.map((ys,Zs)=>[0,Ts[Zs]]);return[cu,lu]}([Ae.inHeight,Ae.inWidth],We,ut),Gt=bt?E:"valid",bn=bt?ne:Ac(ne,We,St),Zn=(I==="avg"?()=>Tf(bn,C,V,Gt):()=>lf(bn,C,V,Gt))(),zn=bt?Zn:Fc(Zn,We,jt);return be?ze(zn,[zn.shape[1],zn.shape[2],zn.shape[3]]):zn}});Ce.a.prototype.pool=function(w,C,I,E,B){return this.throwIfDisposed(),F_(this,w,C,I,E,B)},Ce.a.prototype.powStrict=function(w){return this.throwIfDisposed(),bS(this,w)},Ce.a.prototype.pow=function(w){return this.throwIfDisposed(),Yu(this,w)},Ce.a.prototype.prelu=function(w){return this.throwIfDisposed(),rb(this,w)};let AO=Object(M.a)({prod_:function(w,C=null,I=!1){let E=Object(z.a)(w,"x","prod");E.dtype==="bool"&&(E=W(E,"int32"));let B={x:E},V={axis:C,keepDims:I};return u.a.runKernelFunc(K=>{let ne=Object(S.I)(C,E.shape),be=qi(ne,E.rank),Ae=ne,We=E;be!=null&&(We=ms(E,be),Ae=Aa(Ae.length,E.rank));let ut=K.prod(We,Ae);if(I){let bt=Ui(ut.shape,ne);ut=ze(ut,bt)}return ut},B,null,ye.Vb,V)}});Ce.a.prototype.prod=function(w,C){return this.throwIfDisposed(),AO(this,w,C)};let OO=Object(M.a)({reciprocal_:function(w){let C=Object(z.a)(w,"x","reciprocal"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.reciprocal(C);return B([C]),V},I,null,ye.Yb)}});Ce.a.prototype.reciprocal=function(){return this.throwIfDisposed(),OO(this)},Ce.a.prototype.relu=function(){return this.throwIfDisposed(),Cg(this)},Ce.a.prototype.relu6=function(){return this.throwIfDisposed(),Cy(this)},Ce.a.prototype.reshapeAs=function(w){return this.throwIfDisposed(),ze(this,w.shape)},Ce.a.prototype.reshape=function(w){return this.throwIfDisposed(),ze(this,w)},Ce.a.prototype.resizeBilinear=function(w,C){return this.throwIfDisposed(),cl(this,w,C)},Ce.a.prototype.resizeNearestNeighbor=function(w,C){return this.throwIfDisposed(),K2(this,w,C)},Ce.a.prototype.reverse=function(w){return this.throwIfDisposed(),rh(this,w)},Ce.a.prototype.rfft=function(){return this.throwIfDisposed(),vg(this)};let RO=Object(M.a)({round_:function(w){let C=Object(z.a)(w,"x","round"),I={x:C};return u.a.runKernelFunc(E=>E.round(C),I,null,ye.ic)}});Ce.a.prototype.round=function(){return this.throwIfDisposed(),RO(this)},Ce.a.prototype.rsqrt=function(){return this.throwIfDisposed(),k(this)};let P_=Object(M.a)({selu_:function(w){let C=Object(z.a)(w,"x","selu"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.selu(C);return B([C]),V},I,null,ye.lc)}});Ce.a.prototype.selu=function(){return this.throwIfDisposed(),P_(this)},Ce.a.prototype.separableConv2d=function(w,C,I,E,B,V){return this.throwIfDisposed(),ho(this,w,C,I,E,B,V)},Ce.a.prototype.sigmoid=function(){return this.throwIfDisposed(),Mc(this)};let Pb=Object(M.a)({sign_:function(w){let C=Object(z.a)(w,"x","sign"),I={x:C};return u.a.runKernelFunc(E=>E.sign(C),I,null,ye.nc)}});Ce.a.prototype.sign=function(){return this.throwIfDisposed(),Pb(this)},Ce.a.prototype.sin=function(){return this.throwIfDisposed(),iu(this)},Ce.a.prototype.sinh=function(){return this.throwIfDisposed(),pa(this)},Ce.a.prototype.slice=function(w,C){return this.throwIfDisposed(),Uo(this,w,C)},Ce.a.prototype.softmax=function(w){return this.throwIfDisposed(),pf(this,w)},Ce.a.prototype.softplus=function(){return this.throwIfDisposed(),Ef(this)},Ce.a.prototype.spaceToBatchND=function(w,C){return this.throwIfDisposed(),Ac(this,w,C)},Ce.a.prototype.split=function(w,C){return this.throwIfDisposed(),Gr(this,w,C)},Ce.a.prototype.sqrt=function(){return this.throwIfDisposed(),ec(this)},Ce.a.prototype.square=function(){return this.throwIfDisposed(),Ks(this)},Ce.a.prototype.squaredDifference=function(w){return this.throwIfDisposed(),cp(this,w)},Ce.a.prototype.squaredDifferenceStrict=function(w){return this.throwIfDisposed(),_f(this,w)},Ce.a.prototype.squeeze=function(w){return this.throwIfDisposed(),th(this,w)},Ce.a.prototype.stack=function(w,C){this.throwIfDisposed();let I=w instanceof Ce.a?[this,w]:[this,...w];return nu(I,C)},Ce.a.prototype.step=function(w){return this.throwIfDisposed(),pp(this,w)};let $b=Object(M.a)({stridedSlice_:function(w,C,I,E,B=0,V=0,K=0,ne=0,be=0){let Ae=Object(z.a)(w,"x","stridedSlice"),We={x:Ae},ut={begin:C,end:I,strides:E,beginMask:B,endMask:V,ellipsisMask:K,newAxisMask:ne,shrinkAxisMask:be};return u.a.runKernelFunc(bt=>{E==null&&(E=new Array(C.length));let St=Ai(K);if(St.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(K!==0&&ne!==0)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(K!==0&&be!==0)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");let jt=Ae.rank-C.length,Gt=Ai(ne),bn=Ae.shape.slice();Gt.forEach(Wr=>{C[Wr]=0,I[Wr]=1,bn.splice(Wr,0,1)}),Ae=ze(Ae,bn);let{begin:Zn,end:zn,strides:tr}=eu(Ae.shape,St,jt,C,I,E,B,V,K);C=Zn,I=zn,E=tr;let Or=Ai(be);Or.forEach(Wr=>{I[Wr]=C[Wr]+1,E[Wr]=1});let Yr=ia(C,I,E),Ro=Yr.filter((Wr,Ts)=>Or.indexOf(Ts)===-1);if(E.every(Wr=>Wr===1))return ze(Uo(Ae,C,Yr),Ro);let ma=bt.stridedSlice(Ae,C,I,E);return ze(ma,Ro)},We,null,ye.zc,ut)}});Ce.a.prototype.stridedSlice=function(w,C,I,E,B,V,K,ne){return this.throwIfDisposed(),$b(this,w,C,I,E,B,V,K,ne)},Ce.a.prototype.subStrict=function(w){return this.throwIfDisposed(),Nb(this,w)},Ce.a.prototype.sub=function(w){return this.throwIfDisposed(),xr(this,w)},Ce.a.prototype.sum=function(w,C){return this.throwIfDisposed(),fr(this,w,C)};let kf=Object(M.a)({tan_:function(w){let C=Object(z.a)(w,"x","tan"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.tan(C);return B([C]),V},I,null,ye.Cc)}});Ce.a.prototype.tan=function(){return this.throwIfDisposed(),kf(this)};let Si=Object(M.a)({tanh_:function(w){let C=Object(z.a)(w,"x","tanh"),I={x:C};return u.a.runKernelFunc((E,B)=>{let V=E.tanh(C);return B([V]),V},I,null,ye.Dc)}});Ce.a.prototype.tanh=function(){return this.throwIfDisposed(),Si(this)},Ce.a.prototype.tile=function(w){return this.throwIfDisposed(),Gi(this,w)},Ce.a.prototype.toBool=function(){return this.throwIfDisposed(),W(this,"bool")},Ce.a.prototype.toFloat=function(){return this.throwIfDisposed(),W(this,"float32")},Ce.a.prototype.toInt=function(){return this.throwIfDisposed(),W(this,"int32")};let Lb=Object(M.a)({topk_:function(w,C=1,I=!0){let E=Object(z.a)(w,"x","topk");if(E.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let B=E.shape[E.shape.length-1];if(C>B)throw new Error(`'k' passed to topk() must be <= the last dimension (${B}) but got `+C);let V={x:E},K={k:C,sorted:I},[ne,be]=u.a.runKernelFunc(Ae=>Ae.topk(E,C,I),V,null,ye.Fc,K);return{values:ne,indices:be}}});Ce.a.prototype.topk=function(w,C){return this.throwIfDisposed(),Lb(this,w,C)},Ce.a.prototype.transpose=function(w){return this.throwIfDisposed(),ms(this,w)};let Bb=Object(M.a)({unique_:function(w,C=0){let I=Object(z.a)(w,"x","unique",null);Object(S.b)(I.rank>0,()=>"The input tensor must be at least 1D");let E={x:I},B={axis:C},[V,K]=u.a.runKernel(ye.Hc,E,B);return{values:V,indices:K}}});Ce.a.prototype.unique=function(w){return this.throwIfDisposed(),Bb(this,w)},Ce.a.prototype.unsortedSegmentSum=function(w,C){return this.throwIfDisposed(),j(this,w,C)},Ce.a.prototype.unstack=function(w){return this.throwIfDisposed(),xy(this,w)},Ce.a.prototype.where=function(w,C){return this.throwIfDisposed(),Jr(w,this,C)},Ce.a.prototype.zerosLike=function(){return this.throwIfDisposed(),_o(this)}},function(n,t,e){"use strict";e.d(t,"a",function(){return r}),e.d(t,"b",function(){return o}),e.d(t,"c",function(){return s}),e.d(t,"d",function(){return i}),e.d(t,"e",function(){return a}),e.d(t,"f",function(){return u}),e.d(t,"g",function(){return c}),e.d(t,"h",function(){return h}),e.d(t,"i",function(){return f}),e.d(t,"j",function(){return g}),e.d(t,"k",function(){return d}),e.d(t,"l",function(){return p}),e.d(t,"n",function(){return m}),e.d(t,"m",function(){return y}),e.d(t,"o",function(){return v}),e.d(t,"r",function(){return N}),e.d(t,"p",function(){return T}),e.d(t,"q",function(){return O}),e.d(t,"s",function(){return S}),e.d(t,"t",function(){return F}),e.d(t,"u",function(){return R}),e.d(t,"v",function(){return L}),e.d(t,"w",function(){return q}),e.d(t,"x",function(){return U}),e.d(t,"y",function(){return Z}),e.d(t,"z",function(){return ee}),e.d(t,"A",function(){return Q}),e.d(t,"B",function(){return oe}),e.d(t,"C",function(){return se}),e.d(t,"D",function(){return pe}),e.d(t,"E",function(){return ae}),e.d(t,"F",function(){return fe}),e.d(t,"G",function(){return he}),e.d(t,"H",function(){return Ee}),e.d(t,"J",function(){return Le}),e.d(t,"I",function(){return Ve}),e.d(t,"K",function(){return qe}),e.d(t,"L",function(){return je}),e.d(t,"M",function(){return Ce}),e.d(t,"N",function(){return tt}),e.d(t,"O",function(){return ye}),e.d(t,"Q",function(){return z}),e.d(t,"P",function(){return M}),e.d(t,"R",function(){return W}),e.d(t,"S",function(){return ce}),e.d(t,"T",function(){return J}),e.d(t,"V",function(){return Ie}),e.d(t,"U",function(){return Fe}),e.d(t,"W",function(){return lt}),e.d(t,"X",function(){return Dt}),e.d(t,"Y",function(){return Ht}),e.d(t,"Z",function(){return an}),e.d(t,"ab",function(){return cn}),e.d(t,"bb",function(){return nn}),e.d(t,"cb",function(){return Yn}),e.d(t,"eb",function(){return ln}),e.d(t,"fb",function(){return Qn}),e.d(t,"gb",function(){return wn}),e.d(t,"hb",function(){return _r}),e.d(t,"jb",function(){return Ar}),e.d(t,"ib",function(){return ss}),e.d(t,"kb",function(){return Qo}),e.d(t,"lb",function(){return Ws}),e.d(t,"mb",function(){return ki}),e.d(t,"nb",function(){return Di}),e.d(t,"qb",function(){return Ai}),e.d(t,"rb",function(){return ia}),e.d(t,"sb",function(){return aa}),e.d(t,"tb",function(){return Nu}),e.d(t,"vb",function(){return vc}),e.d(t,"wb",function(){return eu}),e.d(t,"xb",function(){return ds}),e.d(t,"ub",function(){return wc}),e.d(t,"ob",function(){return ku}),e.d(t,"pb",function(){return fs}),e.d(t,"yb",function(){return Ao}),e.d(t,"Eb",function(){return Hs}),e.d(t,"zb",function(){return bi}),e.d(t,"Cb",function(){return Sc}),e.d(t,"Ab",function(){return po}),e.d(t,"Bb",function(){return Da}),e.d(t,"Db",function(){return Oo}),e.d(t,"Fb",function(){return xt}),e.d(t,"Gb",function(){return ze}),e.d(t,"Hb",function(){return Xt}),e.d(t,"Ib",function(){return Yt}),e.d(t,"Jb",function(){return Qt}),e.d(t,"Kb",function(){return Gn}),e.d(t,"Lb",function(){return Un}),e.d(t,"Pb",function(){return ar}),e.d(t,"Mb",function(){return xe}),e.d(t,"Nb",function(){return Pe}),e.d(t,"Ob",function(){return Ge}),e.d(t,"Rb",function(){return pt}),e.d(t,"Qb",function(){return At}),e.d(t,"Sb",function(){return qt}),e.d(t,"Tb",function(){return pn}),e.d(t,"Ub",function(){return Fn}),e.d(t,"Vb",function(){return wr}),e.d(t,"Wb",function(){return Kn}),e.d(t,"Xb",function(){return yn}),e.d(t,"Yb",function(){return Cn}),e.d(t,"Zb",function(){return Io}),e.d(t,"bc",function(){return Zo}),e.d(t,"ec",function(){return ji}),e.d(t,"fc",function(){return fg}),e.d(t,"cc",function(){return mg}),e.d(t,"dc",function(){return Ui}),e.d(t,"ac",function(){return Ps}),e.d(t,"gc",function(){return qi}),e.d(t,"ic",function(){return ni}),e.d(t,"jc",function(){return Aa}),e.d(t,"kc",function(){return ms}),e.d(t,"lc",function(){return eh}),e.d(t,"qc",function(){return ul}),e.d(t,"oc",function(){return gg}),e.d(t,"pc",function(){return qr}),e.d(t,"nc",function(){return jo}),e.d(t,"mc",function(){return ua}),e.d(t,"sc",function(){return lf}),e.d(t,"vc",function(){return rn}),e.d(t,"Bc",function(){return yg}),e.d(t,"tc",function(){return Yu}),e.d(t,"uc",function(){return xg}),e.d(t,"rc",function(){return ca}),e.d(t,"xc",function(){return rp}),e.d(t,"wc",function(){return Qu}),e.d(t,"Ac",function(){return ri}),e.d(t,"zc",function(){return Cc}),e.d(t,"Cc",function(){return Oa}),e.d(t,"Dc",function(){return Cs}),e.d(t,"Ec",function(){return yr}),e.d(t,"Fc",function(){return ho}),e.d(t,"Gc",function(){return pf}),e.d(t,"Hc",function(){return Is}),e.d(t,"Ic",function(){return Gr}),e.d(t,"Jc",function(){return th}),e.d(t,"Kc",function(){return xr}),e.d(t,"yc",function(){return Gi}),e.d(t,"db",function(){return op}),e.d(t,"hc",function(){return hf});let r="Abs",o="Acos",s="Acosh",i="Add",a="AddN",u="All",c="Any",h="ArgMax",f="ArgMin",g="Asin",d="Asinh",p="Atan",m="Atanh",y="Atan2",v="AvgPool",N="AvgPoolBackprop",T="AvgPool3D",O="AvgPool3DBackprop",S="BatchMatMul",F="BatchToSpaceND",R="BroadcastTo",L="Cast",q="Ceil",U="ClipByValue",Z="Complex",ee="Concat",Q="Conv2D",oe="Conv2DBackpropFilter",se="Conv2DBackpropInput",pe="Conv3D",ae="Conv3DBackpropFilterV2",fe="Conv3DBackpropInputV2",he="Cos",Ee="Cosh",Le="Cumsum",Ve="CropAndResize",qe="DepthToSpace",je="DepthwiseConv2dNative",Ce="DepthwiseConv2dNativeBackpropFilter",tt="DepthwiseConv2dNativeBackpropInput",ye="Dilation2D",z="Dilation2DBackpropInput",M="Dilation2DBackpropFilter",W="Div",ce="Elu",J="EluGrad",Ie="Erf",Fe="Equal",lt="Exp",Dt="Expm1",Ht="FFT",an="Fill",cn="FlipLeftRight",nn="Floor",Yn="FloorDiv",ln="FusedBatchNorm",Qn="GatherV2",wn="Greater",_r="GreaterEqual",Ar="Identity",ss="IFFT",Qo="Imag",Ws="IsFinite",ki="IsInf",Di="IsNan",Ai="Less",ia="LessEqual",aa="Log",Nu="Log1p",vc="LogicalAnd",eu="LogicalNot",ds="LogicalOr",wc="LogSoftmax",ku="LRN",fs="LRNBackprop",Ao="Max",Hs="Maximum",bi="MaxPool",Sc="MaxPoolBackprop",po="MaxPool3D",Da="MaxPool3DBackprop",Oo="MaxPoolWithArgmax",xt="Mean",ze="Min",Xt="Minimum",Yt="MirrorPad",Qt="Mod",Gn="Multiply",Un="Negate",ar="NotEqual",xe="NonMaxSuppressionV3",Pe="NonMaxSuppressionV4",Ge="NonMaxSuppressionV5",pt="OnesLike",At="OneHot",qt="PadV2",pn="Pow",Fn="Prelu",wr="Prod",Kn="Range",yn="Real",Cn="Reciprocal",Io="Relu",Zo="Reshape",ji="ResizeNearestNeighbor",fg="ResizeNearestNeighborGrad",mg="ResizeBilinear",Ui="ResizeBilinearGrad",Ps="Relu6",qi="Reverse",ni="Round",Aa="Rsqrt",ms="SelectV2",eh="Selu",ul="Slice",gg="Sin",qr="Sinh",jo="Sign",ua="Sigmoid",lf="Softplus",rn="Sqrt",yg="Sum",Yu="SpaceToBatchND",xg="SplitV",ca="Softmax",rp="SquaredDifference",Qu="Square",ri="Sub",Cc="StridedSlice",Oa="Tan",Cs="Tanh",yr="Tile",ho="TopK",pf="Transpose",Is="Unique",Gr="Unpack",th="UnsortedSegmentSum",xr="ZerosLike",Gi="Step",op="FromPixels",hf="RotateWithOffset"},function(n,t){n.exports=__WEBPACK_EXTERNAL_MODULE__2__},function(n,t,e){"use strict";e.d(t,"c",function(){return u}),e.d(t,"a",function(){return h}),e.d(t,"b",function(){return f});var r=e(6),o=e(11),s=e(5),i=e(16),a=e(7);function u(g,d){let p=g;if(Object(i.A)(g))return d==="string"?[]:[g.length];if(!Array.isArray(g))return[];let m=[];for(;Array.isArray(p)||Object(i.A)(p)&&d!=="string";)m.push(p.length),p=p[0];return Array.isArray(g)&&Object(o.b)().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function y(v,N,T){if(T=T||[],!Array.isArray(v)&&!Object(i.A)(v))return void Object(i.b)(N.length===0,()=>`Element arr[${T.join("][")}] is a primitive, but should be an array/TypedArray of ${N[0]} elements`);Object(i.b)(N.length>0,()=>`Element arr[${T.join("][")}] should be a primitive, but is an array of ${v.length} elements`),Object(i.b)(v.length===N[0],()=>`Element arr[${T.join("][")}] should have ${N[0]} elements, but has ${v.length} elements`);let O=N.slice(1);for(let S=0;S<v.length;++S)y(v[S],O,T.concat(S))}(g,m,[]),m}function c(g,d,p,m){if(g!=null&&(g!=="numeric"&&g!==d||g==="numeric"&&d==="string"))throw new Error(`Argument '${p}' passed to '${m}' must be ${g} tensor, but got ${d} tensor`)}function h(g,d,p,m="numeric"){if(g instanceof s.a)return c(m,g.dtype,d,p),g;let y=Object(i.r)(g);if(y!=="string"&&["bool","int32","float32"].indexOf(m)>=0&&(y=m),c(m,y,d,p),g==null||!Object(i.A)(g)&&!Array.isArray(g)&&typeof g!="number"&&typeof g!="boolean"&&typeof g!="string"){let T=g==null?"null":g.constructor.name;throw new Error(`Argument '${d}' passed to '${p}' must be a Tensor or TensorLike, but got '${T}'`)}let v=u(g,y);Object(i.A)(g)||Array.isArray(g)||(g=[g]);let N=y!=="string"?Object(a.toTypedArray)(g,y):Object(i.m)(g,[],!0);return r.a.makeTensor(N,v,y)}function f(g,d,p,m="numeric"){if(!Array.isArray(g))throw new Error(`Argument ${d} passed to ${p} must be a \`Tensor[]\` or \`TensorLike[]\``);return g.map((y,v)=>h(y,`${d}[${v}]`,p),m)}},function(n,t,e){"use strict";e.d(t,"a",function(){return s});var r=e(6),o=e(16);function s(i){let a=Object.keys(i);if(a.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+a.length+" keys.");let u=a[0],c=i[u];u.endsWith("_")&&(u=u.substring(0,u.length-1)),u+="__op";let h=(...f)=>{r.a.startScope(u);try{let g=c(...f);return Object(o.x)(g)&&console.error("Cannot return a Promise inside of tidy."),r.a.endScope(g),g}catch(g){throw r.a.endScope(null),g}};return Object.defineProperty(h,"name",{value:u,configurable:!0}),h}},function(n,t,e){"use strict";e.d(t,"b",function(){return c}),e.d(t,"f",function(){return d}),e.d(t,"e",function(){return p}),e.d(t,"d",function(){return m}),e.d(t,"a",function(){return y}),e.d(t,"c",function(){return v});var r=e(16);function o(N,T,O,S){let F=Object(r.j)(T),R=function(Z,ee,Q,oe){let se=Object(r.N)(ee),pe=oe[oe.length-1],ae=new Array(pe).fill(0),fe=ee.length,he=Q==="complex64"?a(Z):Z;if(fe>1)for(let Ee=0;Ee<se/pe;Ee++){let Le=Ee*pe;for(let Ve=0;Ve<pe;Ve++)ae[Ve]=Math.max(ae[Ve],s(he[Le+Ve],0,Q).length)}return ae}(N,T,O,F),L=T.length,q=function Z(ee,Q,oe,se,pe,ae=!0){let fe=oe==="complex64"?2:1,he=Q[0],Ee=Q.length;if(Ee===0)return oe==="complex64"?[s(a(ee)[0],0,oe)]:oe==="bool"?[i(ee[0])]:[ee[0].toString()];if(Ee===1){if(he>20){let ye=3*fe,z=Array.from(ee.slice(0,ye)),M=Array.from(ee.slice((he-3)*fe,he*fe));return oe==="complex64"&&(z=a(z),M=a(M)),["["+z.map((W,ce)=>s(W,pe[ce],oe)).join(", ")+", ..., "+M.map((W,ce)=>s(W,pe[he-3+ce],oe)).join(", ")+"]"]}return["["+(oe==="complex64"?a(ee):Array.from(ee)).map((ye,z)=>s(ye,pe[z],oe)).join(", ")+"]"]}let Le=Q.slice(1),Ve=se.slice(1),qe=se[0]*fe,je=[];if(he>20){for(let ye=0;ye<3;ye++){let z=ye*qe,M=z+qe;je.push(...Z(ee.slice(z,M),Le,oe,Ve,pe,!1))}je.push("...");for(let ye=he-3;ye<he;ye++){let z=ye*qe,M=z+qe;je.push(...Z(ee.slice(z,M),Le,oe,Ve,pe,ye===he-1))}}else for(let ye=0;ye<he;ye++){let z=ye*qe,M=z+qe;je.push(...Z(ee.slice(z,M),Le,oe,Ve,pe,ye===he-1))}let Ce=Ee===2?",":"";je[0]="["+je[0]+Ce;for(let ye=1;ye<je.length-1;ye++)je[ye]=" "+je[ye]+Ce;let tt=`,
`;for(let ye=2;ye<Ee;ye++)tt+=`
`;return je[je.length-1]=" "+je[je.length-1]+"]"+(ae?"":tt),je}(N,T,O,F,R),U=["Tensor"];return S&&(U.push("  dtype: "+O),U.push("  rank: "+L),U.push(`  shape: [${T}]`),U.push("  values:")),U.push(q.map(Z=>"    "+Z).join(`
`)),U.join(`
`)}function s(N,T,O){let S;return S=Array.isArray(N)?parseFloat(N[0].toFixed(7))+" + "+parseFloat(N[1].toFixed(7))+"j":Object(r.z)(N)?`'${N}'`:O==="bool"?i(N):parseFloat(N.toFixed(7)).toString(),Object(r.L)(S,T)}function i(N){return N===0?"false":"true"}function a(N){let T=[];for(let O=0;O<N.length;O+=2)T.push([N[O],N[O+1]]);return T}var u=e(7);class c{constructor(T,O,S){if(this.dtype=O,this.shape=T.slice(),this.size=r.N(T),S!=null){let F=S.length;r.b(F===this.size,()=>`Length of values '${F}' does not match the size inferred by the shape '${this.size}'.`)}if(O==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=S||r.n(O,this.size),this.strides=Object(r.j)(T)}set(T,...O){O.length===0&&(O=[0]),r.b(O.length===this.rank,()=>`The number of provided coordinates (${O.length}) must match the rank (${this.rank})`);let S=this.locToIndex(O);this.values[S]=T}get(...T){T.length===0&&(T=[0]);let O=0;for(let F of T){if(F<0||F>=this.shape[O]){let R=`Requested out of range element at ${T}.   Buffer shape=`+this.shape;throw new Error(R)}O++}let S=T[T.length-1];for(let F=0;F<T.length-1;++F)S+=this.strides[F]*T[F];return this.values[S]}locToIndex(T){if(this.rank===0)return 0;if(this.rank===1)return T[0];let O=T[T.length-1];for(let S=0;S<T.length-1;++S)O+=this.strides[S]*T[S];return O}indexToLoc(T){if(this.rank===0)return[];if(this.rank===1)return[T];let O=new Array(this.shape.length);for(let S=0;S<O.length-1;++S)O[S]=Math.floor(T/this.strides[S]),T-=O[S]*this.strides[S];return O[O.length-1]=T,O}get rank(){return this.shape.length}toTensor(){return h().makeTensor(this.values,this.shape,this.dtype)}}let h=null,f=null,g=null;function d(N){h=N}function p(N){f=N}function m(N){g=N}class y{constructor(T,O,S,F){this.kept=!1,this.isDisposedInternal=!1,this.shape=T.slice(),this.dtype=O||"float32",this.size=r.N(T),this.strides=Object(r.j)(T),this.dataId=S,this.id=F,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}buffer(){return Te(this,null,function*(){let T=yield this.data();return f.buffer(this.shape,this.dtype,T)})}bufferSync(){return f.buffer(this.shape,this.dtype,this.dataSync())}array(){return Te(this,null,function*(){let T=yield this.data();return Object(r.S)(this.shape,T)})}arraySync(){return Object(r.S)(this.shape,this.dataSync())}data(){return Te(this,null,function*(){this.throwIfDisposed();let T=h().read(this.dataId);if(this.dtype==="string"){let O=yield T;try{return O.map(S=>u.decodeString(S))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return T})}dataSync(){this.throwIfDisposed();let T=h().readSync(this.dataId);if(this.dtype==="string")try{return T.map(O=>u.decodeString(O))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return T}bytes(){return Te(this,null,function*(){this.throwIfDisposed();let T=yield h().read(this.dataId);return this.dtype==="string"?T:new Uint8Array(T.buffer)})}dispose(){this.isDisposed||(h().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(T=!1){return f.print(this,T)}clone(){return this.throwIfDisposed(),f.clone(this)}toString(T=!1){return o(this.dataSync(),this.shape,this.dtype,T)}cast(T){return this.throwIfDisposed(),f.cast(this,T)}variable(T=!0,O,S){return this.throwIfDisposed(),h().makeVariable(this,T,O,S)}}Object.defineProperty(y,Symbol.hasInstance,{value:N=>!!N&&N.data!=null&&N.dataSync!=null&&N.throwIfDisposed!=null});class v extends y{constructor(T,O,S,F){super(T.shape,T.dtype,T.dataId,F),this.trainable=O,this.name=S}assign(T){if(T.dtype!==this.dtype)throw new Error(`dtype of the new value (${T.dtype}) and previous value (${this.dtype}) must match`);if(!r.a(T.shape,this.shape))throw new Error(`shape of the new value (${T.shape}) and previous value (${this.shape}) must match`);h().disposeTensor(this),this.dataId=T.dataId,h().incRef(this,null)}dispose(){h().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(v,Symbol.hasInstance,{value:N=>N instanceof y&&N.assign!=null&&N.assign instanceof Function})},function(n,t,e){"use strict";e.d(t,"b",function(){return v}),e.d(t,"a",function(){return N});var r=e(39),o=e(11),s=e(40),i=e(1),a=e(26),u=e(16);class c{constructor(S,F){this.backendTimer=S,this.logger=F,F==null&&(this.logger=new f)}profileKernel(S,F,R){let L,q=this.backendTimer.time(()=>{L=R()});for(let U=0;U<L.length;U++){let Z=L[U];Z.data().then(ee=>{h(ee,Z.dtype,S)})}return{kernelName:S,outputs:L,inputs:F,timeMs:q.then(U=>U.kernelMs),extraInfo:q.then(U=>U.getExtraProfileInfo!=null?U.getExtraProfileInfo():"")}}logKernelProfile(S){let{kernelName:F,outputs:R,timeMs:L,inputs:q,extraInfo:U}=S;R.forEach(Z=>{Promise.all([Z.data(),L,U]).then(ee=>{this.logger.logKernelProfile(F,Z,ee[0],ee[1],q,ee[2])})})}}function h(O,S,F){if(S!=="float32")return!1;for(let R=0;R<O.length;R++){let L=O[R];if(isNaN(L)||!isFinite(L))return console.warn(`Found ${L} in the result of '${F}'`),!0}return!1}class f{logKernelProfile(S,F,R,L,q,U){let Z=typeof L=="number"?u.L(L+"ms",9):L.error,ee=u.L(S,25),Q=F.rank,oe=F.size,se=u.L(F.shape.toString(),14),pe="";for(let ae in q){let fe=q[ae];if(fe!=null){let he=fe.shape||F.shape,Ee=he.length;pe+=`${ae}: ${Ee}D ${Ee>0?he:""} `}}console.log(`%c${ee}	%c${Z}	%c${Q}D ${se}	%c${oe}	%c${pe}	%c${U}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}var g=e(5),d=e(14),p=e(7);class m{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}dispose(){for(let S in this.registeredVariables)this.registeredVariables[S].dispose()}}class y{constructor(S){this.ENV=S,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new m}ready(){return Te(this,null,function*(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let S=this.getSortedBackends();for(let F=0;F<S.length;F++){let R=S[F];if(yield this.initializeBackend(R).success)return void(yield this.setBackend(R))}throw new Error("Could not initialize any backends, all backend initializations failed.")})}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:S,asyncInit:F}=this.initializeBackendsAndReturnBest();if(F)throw new Error(`The highest priority backend '${S}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(S)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(S){if(!(S in this.registry)){if(!(S in this.registryFactory))return null;{let{asyncInit:F}=this.initializeBackend(S);if(F)return null}}return this.registry[S]}findBackendFactory(S){return S in this.registryFactory?this.registryFactory[S].factory:null}registerBackend(S,F,R=1){return S in this.registryFactory?(console.warn(S+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[S]={factory:F,priority:R},!0)}setBackend(S){return Te(this,null,function*(){if(this.registryFactory[S]==null)throw new Error(`Backend name '${S}' not found in registry`);if(this.backendName=S,this.registry[S]==null){this.backendInstance=null;let{success:F,asyncInit:R}=this.initializeBackend(S);if(!(R?yield F:F))return!1}return this.backendInstance=this.registry[S],this.setupRegisteredKernels(),this.profiler=new c(this.backendInstance),!0})}setupRegisteredKernels(){Object(a.c)(this.backendName).forEach(S=>{S.setupFunc!=null&&S.setupFunc(this.backendInstance)})}disposeRegisteredKernels(S){Object(a.c)(S).forEach(F=>{F.disposeFunc!=null&&F.disposeFunc(this.registry[S])})}initializeBackend(S){let F=this.registryFactory[S];if(F==null)throw new Error(`Cannot initialize backend ${S}, no registration found.`);try{let R=F.factory();if(!R||R instanceof r.b||typeof R.then!="function")return this.registry[S]=R,{success:!0,asyncInit:!1};{let L=++this.pendingBackendInitId,q=R.then(U=>!(L<this.pendingBackendInitId)&&(this.registry[S]=U,this.pendingBackendInit=null,!0)).catch(U=>(L<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${S} failed`),console.warn(U.stack||U.message)),!1));return this.pendingBackendInit=q,{success:q,asyncInit:!0}}}catch(R){return console.warn(`Initialization of backend ${S} failed`),console.warn(R.stack||R.message),{success:!1,asyncInit:!1}}}removeBackend(S){if(!(S in this.registryFactory))throw new Error(S+" backend not found in registry");this.backendName===S&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,S in this.registry&&(this.disposeRegisteredKernels(S),this.registry[S].dispose(),delete this.registry[S]),delete this.registryFactory[S],this.backendName===S&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((S,F)=>this.registryFactory[F].priority-this.registryFactory[S].priority)}initializeBackendsAndReturnBest(){let S=this.getSortedBackends();for(let F=0;F<S.length;F++){let R=S[F],{success:L,asyncInit:q}=this.initializeBackend(R);if(q||L)return{name:R,asyncInit:q}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(S,F){let R=this.state.tensorInfo.get(F),L=R.backend,q=this.readSync(F);L.disposeData(F),R.backend=S,S.move(F,q,R.shape,R.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(S,F){let R,L=null;if(F==null){if(typeof S!="function")throw new Error("Please provide a function to tidy()");F=S}else{if(typeof S!="string"&&!(S instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof F!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");L=S}return this.scopedRun(()=>this.startScope(L),()=>this.endScope(R),()=>(R=F(),R instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),R))}scopedRun(S,F,R){S();try{let L=R();return F(),L}catch(L){throw F(),L}}nextTensorId(){return y.nextTensorId++}nextVariableId(){return y.nextVariableId++}clone(S){let F=this.makeTensorFromDataId(S.dataId,S.shape,S.dtype),R={x:S};return this.addTapeNode(this.state.activeScope.name,R,[F],L=>({x:()=>{let q={x:L},U={dtype:"float32"};return N.runKernelFunc(Z=>Z.cast(L,"float32"),q,null,i.v,U)}}),[],{}),F}runKernel(S,F,R,L,q){return this.runKernelFunc(null,F,null,S,R,L,q)}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(S,F,R){let L=this.backend.numDataIds(),q=0;R.forEach(ee=>{q+=ee.dtype==="complex64"?3:1});let U=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],Z=L-F-q-U;if(Z>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${Z} data ids) after running '${S}'`)}runKernelFunc(S,F,R,L,q,U,Z){let ee,Q=[],oe=this.isTapeOn();L==null&&(L=this.state.activeScope!=null?this.state.activeScope.name:"");let se=this.state.numBytes,pe=this.state.numTensors,ae;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let fe=Object(a.b)(L,this.backendName),he,Ee;if(fe!=null)ae=()=>{let Le=this.backend.numDataIds();he=fe.kernelFunc({inputs:F,attrs:q,backend:this.backend});let Ve=Array.isArray(he)?he:[he];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(L,Le,Ve);let qe=Ve.map(({dataId:je,shape:Ce,dtype:tt})=>this.makeTensorFromDataId(je,Ce,tt));if(oe){let je=this.getTensorsForGradient(L,F,qe);if(je==null){Z==null&&(Z=[]);let Ce=qe.filter((tt,ye)=>Z[ye]);je=(U||[]).slice().concat(Ce)}Q=this.saveTensorsForBackwardMode(je)}return qe};else{let Le=Ve=>{oe&&(Q=Ve.map(qe=>this.keep(this.clone(qe))))};ae=()=>{let Ve=this.backend.numDataIds();he=this.tidy(()=>S(this.backend,Le));let qe=Array.isArray(he)?he:[he];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(L,Ve,qe),qe}}return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(Ee=this.profiler.profileKernel(L,F,()=>ae()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(Ee),ee=Ee.outputs):ee=ae()}),oe&&this.addTapeNode(L,F,ee,R,Q,q),this.state.profiling&&this.state.activeProfile.kernels.push({name:L,bytesAdded:this.state.numBytes-se,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-pe,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(F).map(Le=>F[Le]!=null?F[Le].shape:null),outputShapes:ee.map(Le=>Le.shape),kernelTimeMs:Ee.timeMs,extraInfo:Ee.extraInfo}),Array.isArray(he)?ee:ee[0]}saveTensorsForBackwardMode(S){return S.map(F=>this.keep(this.clone(F)))}getTensorsForGradient(S,F,R){let L=Object(a.a)(S);if(L!=null){let q=L.inputsToSave||[],U=L.outputsToSave||[],Z;L.saveAllInputs?(u.b(Array.isArray(F),()=>"saveAllInputs is true, expected inputs to be an array."),Z=Object.keys(F).map(Q=>F[Q])):Z=q.map(Q=>F[Q]);let ee=R.filter((Q,oe)=>U[oe]);return Z.concat(ee)}return null}makeTensor(S,F,R,L){if(S==null)throw new Error("Values passed to engine.makeTensor() are null");R=R||"float32",L=L||this.backend;let q=S;R==="string"&&u.z(S[0])&&(q=S.map(ee=>p.encodeString(ee)));let U=L.write(q,F,R),Z=new g.a(F,R,U,this.nextTensorId());if(this.incRef(Z,L),R==="string"){let ee=this.state.tensorInfo.get(U),Q=Object(u.f)(q);this.state.numBytes+=Q-ee.bytes,ee.bytes=Q}return Z}makeTensorFromDataId(S,F,R,L){R=R||"float32";let q=new g.a(F,R,S,this.nextTensorId());return this.incRef(q,L),q}makeVariable(S,F=!0,R,L){R=R||this.nextVariableId().toString(),L!=null&&L!==S.dtype&&(S=S.cast(L));let q=new g.c(S,F,R,this.nextTensorId());if(this.state.registeredVariables[q.name]!=null)throw new Error(`Variable with name ${q.name} was already registered`);return this.state.registeredVariables[q.name]=q,this.incRef(q,this.backend),q}incRef(S,F){let R=this.state.tensorInfo.has(S.dataId)?this.state.tensorInfo.get(S.dataId).refCount:0;if(this.state.numTensors++,S.dtype==="string"&&this.state.numStringTensors++,R===0){this.state.numDataBuffers++;let L=0;S.dtype!=="complex64"&&S.dtype!=="string"&&(L=S.size*u.g(S.dtype)),this.state.tensorInfo.set(S.dataId,{backend:F||this.backend,dtype:S.dtype,shape:S.shape,bytes:L,refCount:0}),this.state.numBytes+=L}this.state.tensorInfo.get(S.dataId).refCount++,S instanceof g.c||this.track(S)}disposeTensor(S){if(!this.state.tensorInfo.has(S.dataId))return;this.state.numTensors--,S.dtype==="string"&&this.state.numStringTensors--;let F=this.state.tensorInfo.get(S.dataId);F.refCount<=1?(S.dtype!=="complex64"&&(this.state.numBytes-=F.bytes),this.state.numDataBuffers--,F.backend.disposeData(S.dataId),this.state.tensorInfo.delete(S.dataId)):this.state.tensorInfo.get(S.dataId).refCount--}disposeVariables(){for(let S in this.state.registeredVariables){let F=this.state.registeredVariables[S];this.disposeVariable(F)}}disposeVariable(S){this.disposeTensor(S),this.state.registeredVariables[S.name]!=null&&delete this.state.registeredVariables[S.name]}memory(){let S=this.backend.memory();return S.numTensors=this.state.numTensors,S.numDataBuffers=this.state.numDataBuffers,S.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(S.unreliable=!0,S.reasons==null&&(S.reasons=[]),S.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),S}profile(S){return Te(this,null,function*(){this.state.profiling=!0;let F=this.state.numBytes,R=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=yield S(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(L=>L.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-F,this.state.activeProfile.newTensors=this.state.numTensors-R;for(let L of this.state.activeProfile.kernels)L.kernelTimeMs=yield L.kernelTimeMs,L.extraInfo=yield L.extraInfo;return this.state.activeProfile})}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(S,F,R,L,q,U){let Z={id:this.state.nextTapeNodeId++,kernelName:S,inputs:F,outputs:R,saved:q},ee=Object(a.a)(S);ee!=null&&(L=ee.gradFunc),L!=null&&(Z.gradient=Q=>(Q=Q.map((oe,se)=>{if(oe==null){let pe=R[se],ae=u.F(pe.size,pe.dtype);return this.makeTensor(ae,pe.shape,pe.dtype)}return oe}),L(Q.length>1?Q:Q[0],q,U))),this.state.activeTape.push(Z)}keep(S){return S.kept=!0,S}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(S){let F={track:[],name:"unnamed scope",id:this.state.nextScopeId++};S&&(F.name=S),this.state.scopeStack.push(F),this.state.activeScope=F}endScope(S){let F=Object(d.a)(S),R=new Set(F.map(q=>q.id));for(let q=0;q<this.state.activeScope.track.length;q++){let U=this.state.activeScope.track[q];U.kept||R.has(U.id)||U.dispose()}let L=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],F.forEach(q=>{q.kept||q.scopeId!==L.id||this.track(q)})}gradients(S,F,R,L=!1){if(u.b(F.length>0,()=>"gradients() received an empty list of xs."),R!=null&&R.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${R.dtype}'`);let q=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",S));u.b(q instanceof g.a,()=>"The result y returned by f() must be a tensor.");let U=function(Z,ee,Q){let oe={},se={};for(let he=0;he<ee.length;he++)oe[ee[he].id]=!0;for(let he=0;he<Z.length;he++){let Ee=Z[he],Le=Ee.inputs;for(let Ve in Le){let qe=Le[Ve],je=!1;for(let Ce=0;Ce<ee.length;Ce++)if(oe[qe.id]){Ee.outputs.forEach(tt=>oe[tt.id]=!0),je=!0,se[Ee.id]=!0;break}if(je)break}}let pe={};pe[Q.id]=!0;let ae={};for(let he=Z.length-1;he>=0;he--){let Ee=Z[he],Le=Ee.inputs;for(let Ve=0;Ve<Ee.outputs.length;Ve++)if(pe[Ee.outputs[Ve].id]){for(let qe in Le)pe[Le[qe].id]=!0,ae[Ee.id]=!0;break}}let fe=[];for(let he=0;he<Z.length;he++){let Ee=Z[he];if(se[Ee.id]&&ae[Ee.id]){let Le={};for(let qe in Ee.inputs){let je=Ee.inputs[qe];oe[je.id]&&(Le[qe]=je)}let Ve=Object.assign({},Ee);Ve.inputs=Le,Ve.outputs=Ee.outputs,fe.push(Ve)}}return fe}(this.state.activeTape,F,q);if(!L&&U.length===0&&F.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let Z={};Z[q.id]=R??function(Q){let oe=Object(u.D)(Object(u.N)(Q),"float32");return N.makeTensor(oe,Q,"float32")}(q.shape),function(Q,oe,se,pe){for(let ae=oe.length-1;ae>=0;ae--){let fe=oe[ae],he=[];if(fe.outputs.forEach(Le=>{let Ve=Q[Le.id];Ve!=null?he.push(Ve):he.push(null)}),fe.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${fe.kernelName}.`);let Ee=fe.gradient(he);for(let Le in fe.inputs){if(!(Le in Ee))throw new Error(`Cannot backprop through input ${Le}. Available gradients found: ${Object.keys(Ee)}.`);let Ve=se(()=>Ee[Le]());if(Ve.dtype!=="float32")throw new Error(`Error in gradient for op ${fe.kernelName}. The gradient of input ${Le} must have 'float32' dtype, but has '${Ve.dtype}'`);let qe=fe.inputs[Le];if(!u.a(Ve.shape,qe.shape))throw new Error(`Error in gradient for op ${fe.kernelName}. The gradient of input '${Le}' has shape '${Ve.shape}', which does not match the shape of the input '${qe.shape}'`);if(Q[qe.id]==null)Q[qe.id]=Ve;else{let je=Q[qe.id];Q[qe.id]=pe(je,Ve),je.dispose()}}}}(Z,U,Q=>this.tidy(Q),T);let ee=F.map(Q=>Z[Q.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(Q=>{for(let oe of Q.saved)oe.dispose()}),this.state.activeTape=null),{value:q,grads:ee}})}customGrad(S){return u.b(u.u(S),()=>"The f passed in customGrad(f) must be a function."),(...F)=>{let R;u.b(F.every(q=>q instanceof g.a),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let L={};return F.forEach((q,U)=>{L[U]=q}),this.runKernelFunc((q,U)=>(R=S(...F,U),u.b(R.value instanceof g.a,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),u.b(u.u(R.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),R.value),L,(q,U)=>{let Z=R.gradFunc(q,U),ee=Array.isArray(Z)?Z:[Z];u.b(ee.length===F.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),u.b(ee.every(oe=>oe instanceof g.a),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let Q={};return ee.forEach((oe,se)=>{Q[se]=()=>oe}),Q})}}readSync(S){return this.state.tensorInfo.get(S).backend.readSync(S)}read(S){return this.state.tensorInfo.get(S).backend.read(S)}time(S){return Te(this,null,function*(){let F=Object(p.now)(),R=yield this.backend.time(S);return R.wallMs=Object(p.now)()-F,R})}track(S){return this.state.activeScope!=null&&(S.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(S)),S}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new m;for(let S in this.registry)this.disposeRegisteredKernels(S),this.registry[S].dispose(),delete this.registry[S];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function v(){let O=Object(s.b)();if(O._tfengine==null){let S=new o.a(O);O._tfengine=new y(S)}return Object(o.c)(O._tfengine.ENV),Object(g.f)(()=>O._tfengine),O._tfengine}y.nextTensorId=0,y.nextVariableId=0;let N=v();function T(O,S){let F={a:O,b:S};return N.runKernelFunc((R,L)=>{let q=R.add(O,S);return L([O,S]),q},F,null,i.d)}},function(n,t,e){"use strict";e.r(t),e.d(t,"createScalarValue",function(){return s}),e.d(t,"toTypedArray",function(){return i}),e.d(t,"now",function(){return a}),e.d(t,"fetch",function(){return u}),e.d(t,"encodeString",function(){return c}),e.d(t,"decodeString",function(){return h});var r=e(11),o=e(16);function s(f,g){return g==="string"?c(f):i([f],g)}function i(f,g){if(g==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(f)&&(f=o.m(f)),Object(r.b)().getBool("DEBUG")&&o.h(f,g),function(d,p){return d instanceof Float32Array&&p==="float32"||d instanceof Int32Array&&p==="int32"||d instanceof Uint8Array&&p==="bool"}(f,g))return f;if(g==null||g==="float32"||g==="complex64")return new Float32Array(f);if(g==="int32")return new Int32Array(f);if(g==="bool"){let d=new Uint8Array(f.length);for(let p=0;p<d.length;++p)Math.round(f[p])!==0&&(d[p]=1);return d}throw new Error("Unknown data type "+g)}function a(){return Object(r.b)().platform.now()}function u(f,g){return Object(r.b)().platform.fetch(f,g)}function c(f,g="utf-8"){return g=g||"utf-8",Object(r.b)().platform.encode(f,g)}function h(f,g="utf-8"){return g=g||"utf-8",Object(r.b)().platform.decode(f,g)}e.d(t,"shuffle",function(){return o.M}),e.d(t,"clamp",function(){return o.i}),e.d(t,"nearestLargerEven",function(){return o.H}),e.d(t,"sum",function(){return o.Q}),e.d(t,"randUniform",function(){return o.J}),e.d(t,"distSquared",function(){return o.l}),e.d(t,"assert",function(){return o.b}),e.d(t,"assertShapesMatch",function(){return o.e}),e.d(t,"assertNonNull",function(){return o.d}),e.d(t,"flatten",function(){return o.m}),e.d(t,"sizeFromShape",function(){return o.N}),e.d(t,"isScalarShape",function(){return o.y}),e.d(t,"arraysEqual",function(){return o.a}),e.d(t,"isInt",function(){return o.v}),e.d(t,"tanh",function(){return o.R}),e.d(t,"sizeToSquarishShape",function(){return o.O}),e.d(t,"createShuffledIndices",function(){return o.k}),e.d(t,"rightPad",function(){return o.L}),e.d(t,"repeatedTry",function(){return o.K}),e.d(t,"inferFromImplicitShape",function(){return o.s}),e.d(t,"parseAxisParam",function(){return o.I}),e.d(t,"squeezeShape",function(){return o.P}),e.d(t,"getTypedArrayFromDType",function(){return o.o}),e.d(t,"getArrayFromDType",function(){return o.n}),e.d(t,"checkConversionForErrors",function(){return o.h}),e.d(t,"isValidDtype",function(){return o.B}),e.d(t,"hasEncodingLoss",function(){return o.p}),e.d(t,"isTypedArray",function(){return o.A}),e.d(t,"bytesPerElement",function(){return o.g}),e.d(t,"bytesFromStringArray",function(){return o.f}),e.d(t,"isString",function(){return o.z}),e.d(t,"isBoolean",function(){return o.t}),e.d(t,"isNumber",function(){return o.w}),e.d(t,"inferDtype",function(){return o.r}),e.d(t,"isFunction",function(){return o.u}),e.d(t,"nearestDivisor",function(){return o.G}),e.d(t,"computeStrides",function(){return o.j}),e.d(t,"toNestedArray",function(){return o.S}),e.d(t,"makeOnesTypedArray",function(){return o.D}),e.d(t,"makeZerosTypedArray",function(){return o.F}),e.d(t,"makeZerosNestedTypedArray",function(){return o.E}),e.d(t,"assertNonNegativeIntegerDimensions",function(){return o.c}),e.d(t,"locToIndex",function(){return o.C}),e.d(t,"indexToLoc",function(){return o.q}),e.d(t,"isPromise",function(){return o.x})},function(n,t,e){"use strict";e.r(t),e.d(t,"DEFAULT_QUARTERS_PER_MINUTE",function(){return r}),e.d(t,"DEFAULT_STEPS_PER_BAR",function(){return o}),e.d(t,"DEFAULT_STEPS_PER_QUARTER",function(){return s}),e.d(t,"DEFAULT_STEPS_PER_SECOND",function(){return i}),e.d(t,"DEFAULT_VELOCITY",function(){return a}),e.d(t,"DEFAULT_PROGRAM",function(){return u}),e.d(t,"DEFAULT_TICKS_PER_QUARTER",function(){return c}),e.d(t,"DEFAULT_CHANNEL",function(){return h}),e.d(t,"DRUM_CHANNEL",function(){return f}),e.d(t,"NON_DRUM_CHANNELS",function(){return g}),e.d(t,"DEFAULT_DRUM_PITCH_CLASSES",function(){return d}),e.d(t,"MIN_MIDI_VELOCITY",function(){return p}),e.d(t,"MAX_MIDI_VELOCITY",function(){return m}),e.d(t,"MIDI_VELOCITIES",function(){return y}),e.d(t,"NO_CHORD",function(){return v}),e.d(t,"NUM_PITCH_CLASSES",function(){return N}),e.d(t,"MIN_MIDI_PITCH",function(){return T}),e.d(t,"MAX_MIDI_PITCH",function(){return O}),e.d(t,"MIDI_PITCHES",function(){return S}),e.d(t,"MIN_PIANO_PITCH",function(){return F}),e.d(t,"MAX_PIANO_PITCH",function(){return R}),e.d(t,"MIN_DRUM_PITCH",function(){return L}),e.d(t,"MAX_DRUM_PITCH",function(){return q}),e.d(t,"MIN_MIDI_PROGRAM",function(){return U}),e.d(t,"MAX_MIDI_PROGRAM",function(){return Z}),e.d(t,"LO_CLICK_PITCH",function(){return ee}),e.d(t,"HI_CLICK_PITCH",function(){return Q}),e.d(t,"LO_CLICK_CLASS",function(){return oe}),e.d(t,"HI_CLICK_CLASS",function(){return se});let r=120,o=16,s=4,i=100,a=80,u=0,c=220,h=0,f=9,g=[0,1,2,3,4,5,6,7,8,10,11,12,13,14,15],d=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]],p=0,m=127,y=m-p+1,v="N.C.",N=12,T=0,O=127,S=O-T+1,F=21,R=108,L=35,q=81,U=0,Z=127,ee=89,Q=90,oe=9,se=10},function(n,t){n.exports=__WEBPACK_EXTERNAL_MODULE__9__},function(n,t,e){"use strict";e.d(t,"a",function(){return o});var r=e(35),o=r.tensorflow.magenta.NoteSequence},function(n,t,e){"use strict";e.d(t,"a",function(){return o}),e.d(t,"b",function(){return s}),e.d(t,"c",function(){return a});var r=e(16);class o{constructor(c){this.global=c,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}setPlatform(c,h){this.platform!=null&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${h}.`),this.platformName=c,this.platform=h}registerFlag(c,h,f){if(this.flagRegistry[c]={evaluationFn:h,setHook:f},this.urlFlags[c]!=null){let g=this.urlFlags[c];console.warn(`Setting feature override from URL ${c}: ${g}.`),this.set(c,g)}}getAsync(c){return Te(this,null,function*(){return c in this.flags||(this.flags[c]=yield this.evaluateFlag(c)),this.flags[c]})}get(c){if(c in this.flags)return this.flags[c];let h=this.evaluateFlag(c);if(Object(r.x)(h))throw new Error(`Flag ${c} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[c]=h,this.flags[c]}getNumber(c){return this.get(c)}getBool(c){return this.get(c)}getFlags(){return this.flags}get features(){return this.flags}set(c,h){if(this.flagRegistry[c]==null)throw new Error(`Cannot set flag ${c} as it has not been registered.`);this.flags[c]=h,this.flagRegistry[c].setHook!=null&&this.flagRegistry[c].setHook(h)}evaluateFlag(c){if(this.flagRegistry[c]==null)throw new Error(`Cannot evaluate flag '${c}': no evaluation function found.`);return this.flagRegistry[c].evaluationFn()}setFlags(c){this.flags=Object.assign({},c)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(this.global===void 0||this.global.location===void 0||this.global.location.search===void 0)return;let c=function(h){let f={};return h.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(g,...d)=>(function(p,m,y){p[decodeURIComponent(m)]=decodeURIComponent(y||"")}(f,d[0],d[1]),d.join("="))),f}(this.global.location.search);"tfjsflags"in c&&c.tfjsflags.split(",").forEach(h=>{let[f,g]=h.split(":");this.urlFlags[f]=function(d,p){if((p=p.toLowerCase())==="true"||p==="false")return p==="true";if(""+ +p===p)return+p;throw new Error(`Could not parse value flag value ${p} for flag ${d}.`)}(f,g)})}}function s(){return i}let i=null;function a(u){i=u}},function(n,t,e){"use strict";e.r(t),e.d(t,"Level",function(){return r}),e.d(t,"verbosity",function(){return s}),e.d(t,"setVerbosity",function(){return i}),e.d(t,"log",function(){return a}),e.d(t,"logWithDuration",function(){return u});var r,o=e(15);(function(c){c[c.NONE=0]="NONE",c[c.WARN=5]="WARN",c[c.INFO=10]="INFO",c[c.DEBUG=20]="DEBUG"})(r||(r={}));let s=10;function i(c){c=c}function a(c,h="Magenta.js",f=10){if(f===0)throw Error("Logging level cannot be NONE.");s>=f&&(f===5?console.warn:console.log)(`%c ${h} `,"background:magenta; color:white",c)}function u(c,h,f="Magenta.js",g=10){a(`${c} in ${((o.d.now()-h)/1e3).toPrecision(3)}s`,f,g)}},function(n,t,e){"use strict";e.r(t),e.d(t,"MultipleTimeSignatureException",function(){return s}),e.d(t,"BadTimeSignatureException",function(){return i}),e.d(t,"NegativeTimeException",function(){return a}),e.d(t,"MultipleTempoException",function(){return u}),e.d(t,"QuantizationStatusException",function(){return c}),e.d(t,"clone",function(){return h}),e.d(t,"stepsPerQuarterToStepsPerSecond",function(){return f}),e.d(t,"quantizeToStep",function(){return g}),e.d(t,"quantizeNoteSequence",function(){return m}),e.d(t,"isQuantizedSequence",function(){return y}),e.d(t,"assertIsQuantizedSequence",function(){return v}),e.d(t,"isRelativeQuantizedSequence",function(){return N}),e.d(t,"assertIsRelativeQuantizedSequence",function(){return T}),e.d(t,"isAbsoluteQuantizedSequence",function(){return O}),e.d(t,"assertIsAbsoluteQuantizedSequence",function(){return S}),e.d(t,"unquantizeSequence",function(){return F}),e.d(t,"createQuantizedNoteSequence",function(){return R}),e.d(t,"mergeInstruments",function(){return L}),e.d(t,"replaceInstruments",function(){return q}),e.d(t,"mergeConsecutiveNotes",function(){return U}),e.d(t,"applySustainControlChanges",function(){return Z}),e.d(t,"concatenate",function(){return ee}),e.d(t,"trim",function(){return Q}),e.d(t,"split",function(){return pe});var r=e(10),o=e(8);class s extends Error{constructor(fe){super(fe),Object.setPrototypeOf(this,new.target.prototype)}}class i extends Error{constructor(fe){super(fe),Object.setPrototypeOf(this,new.target.prototype)}}class a extends Error{constructor(fe){super(fe),Object.setPrototypeOf(this,new.target.prototype)}}class u extends Error{constructor(fe){super(fe),Object.setPrototypeOf(this,new.target.prototype)}}class c extends Error{constructor(fe){super(fe),Object.setPrototypeOf(this,new.target.prototype)}}function h(ae){return r.a.decode(r.a.encode(ae).finish())}function f(ae,fe){return ae*fe/60}function g(ae,fe,he=.5){let Ee=ae*fe;return Math.floor(Ee+(1-he))}function d(ae){return ae.controlChanges.concat(ae.textAnnotations)}function p(ae){if(ae.tempos&&ae.tempos.length!==0){if(ae.tempos.sort((fe,he)=>fe.time-he.time),ae.tempos[0].time!==0&&ae.tempos[0].qpm!==o.DEFAULT_QUARTERS_PER_MINUTE)throw new u("NoteSequence has an implicit tempo change from initial "+o.DEFAULT_QUARTERS_PER_MINUTE+` qpm to ${ae.tempos[0].qpm} qpm at ${ae.tempos[0].time} seconds.`);for(let fe=1;fe<ae.tempos.length;fe++)if(ae.tempos[fe].qpm!==ae.tempos[0].qpm)throw new u(`NoteSequence has at least one tempo change from ${ae.tempos[0].qpm} qpm to ${ae.tempos[fe].qpm}qpm at ${ae.tempos[fe].time} seconds.`)}}function m(ae,fe){let he=h(ae);if(he.quantizationInfo=r.a.QuantizationInfo.create({stepsPerQuarter:fe}),he.timeSignatures.length>0){if(he.timeSignatures.sort((qe,je)=>qe.time-je.time),he.timeSignatures[0].time!==0&&(he.timeSignatures[0].numerator!==4||he.timeSignatures[0].denominator!==4))throw new s(`NoteSequence has an implicit change from initial 4/4 time signature to ${he.timeSignatures[0].numerator}/`+he.timeSignatures[0].denominator+" at "+he.timeSignatures[0].time+" seconds.");for(let qe=1;qe<he.timeSignatures.length;qe++){let je=he.timeSignatures[qe];if(je.numerator!==he.timeSignatures[0].numerator||je.denominator!==he.timeSignatures[0].denominator)throw new s("NoteSequence has at least one time signature change from "+he.timeSignatures[0].numerator+"/"+he.timeSignatures[0].denominator+` to ${je.numerator}/${je.denominator} at ${je.time} seconds`)}he.timeSignatures[0].time=0,he.timeSignatures=[he.timeSignatures[0]]}else{let qe=r.a.TimeSignature.create({numerator:4,denominator:4,time:0});he.timeSignatures.push(qe)}let Ee=he.timeSignatures[0];if(!(Le=Ee.denominator)||(Le&Le-1)!=0)throw new i(`Denominator is not a power of 2. Time signature: ${Ee.numerator}/${Ee.denominator}`);var Le;if(Ee.numerator===0)throw new i(`Numerator is 0. Time signature: ${Ee.numerator}/${Ee.denominator}`);if(he.tempos.length>0)p(he),he.tempos[0].time=0,he.tempos=[he.tempos[0]];else{let qe=r.a.Tempo.create({qpm:o.DEFAULT_QUARTERS_PER_MINUTE,time:0});he.tempos.push(qe)}let Ve=f(fe,he.tempos[0].qpm);return he.totalQuantizedSteps=g(ae.totalTime,Ve),function(qe,je){for(let Ce of qe.notes){if(Ce.quantizedStartStep=g(Ce.startTime,je),Ce.quantizedEndStep=g(Ce.endTime,je),Ce.quantizedEndStep===Ce.quantizedStartStep&&(Ce.quantizedEndStep+=1),Ce.quantizedStartStep<0||Ce.quantizedEndStep<0)throw new a("Got negative note time: start_step = "+Ce.quantizedStartStep+", end_step = "+Ce.quantizedEndStep);Ce.quantizedEndStep>qe.totalQuantizedSteps&&(qe.totalQuantizedSteps=Ce.quantizedEndStep)}d(qe).forEach(Ce=>{if(Ce.quantizedStep=g(Ce.time,je),Ce.quantizedStep<0)throw new a("Got negative event time: step = "+Ce.quantizedStep)})}(he,Ve),he}function y(ae){return ae.quantizationInfo&&(ae.quantizationInfo.stepsPerQuarter>0||ae.quantizationInfo.stepsPerSecond>0)}function v(ae){if(!y(ae))throw new c(`NoteSequence ${ae.id} is not quantized (missing quantizationInfo)`)}function N(ae){return ae.quantizationInfo&&ae.quantizationInfo.stepsPerQuarter>0}function T(ae){if(!N(ae))throw new c(`NoteSequence ${ae.id} is not quantized or is quantized based on absolute timing`)}function O(ae){return ae.quantizationInfo&&ae.quantizationInfo.stepsPerSecond>0}function S(ae){if(!O(ae))throw new c(`NoteSequence ${ae.id} is not quantized or is quantized based on relative timing`)}function F(ae,fe){T(ae),p(ae);let he=h(ae);fe?he.tempos&&he.tempos.length>0?he.tempos[0].qpm=fe:he.tempos.push(r.a.Tempo.create({time:0,qpm:fe})):fe=ae.tempos&&ae.tempos.length>0?he.tempos[0].qpm:o.DEFAULT_QUARTERS_PER_MINUTE;let Ee=Le=>Le/he.quantizationInfo.stepsPerQuarter*(60/fe);return he.totalTime=Ee(he.totalQuantizedSteps),he.notes.forEach(Le=>{Le.startTime=Ee(Le.quantizedStartStep),Le.endTime=Ee(Le.quantizedEndStep),he.totalTime=Math.max(he.totalTime,Le.endTime),delete Le.quantizedStartStep,delete Le.quantizedEndStep}),d(he).forEach(Le=>{Le.time=Ee(Le.time)}),delete he.totalQuantizedSteps,delete he.quantizationInfo,he}function R(ae=o.DEFAULT_STEPS_PER_QUARTER,fe=o.DEFAULT_QUARTERS_PER_MINUTE){return r.a.create({quantizationInfo:{stepsPerQuarter:ae},tempos:[{qpm:fe}]})}function L(ae){let fe=h(ae),he=fe.notes.concat(fe.pitchBends).concat(fe.controlChanges),Ee=Array.from(new Set(he.filter(Le=>!Le.isDrum).map(Le=>Le.program)));return he.forEach(Le=>{Le.isDrum?(Le.program=0,Le.instrument=Ee.length):Le.instrument=Ee.indexOf(Le.program)}),fe}function q(ae,fe){let he=new Set(ae.notes.map(qe=>qe.instrument)),Ee=new Set(fe.notes.map(qe=>qe.instrument)),Le=[];ae.notes.forEach(qe=>{Ee.has(qe.instrument)||Le.push(r.a.Note.create(qe))}),fe.notes.forEach(qe=>{he.has(qe.instrument)&&Le.push(r.a.Note.create(qe))});let Ve=h(ae);return Ve.notes=Le.sort((qe,je)=>qe.instrument-je.instrument||qe.quantizedStartStep-je.quantizedStartStep),Ve}function U(ae){v(ae);let fe=h(ae);fe.notes=[];let he=ae.notes.sort((Ve,qe)=>Ve.instrument-qe.instrument||Ve.quantizedStartStep-qe.quantizedStartStep),Ee=new r.a.Note;Ee.pitch=he[0].pitch,Ee.instrument=he[0].instrument,Ee.quantizedStartStep=he[0].quantizedStartStep,Ee.quantizedEndStep=he[0].quantizedEndStep,fe.notes.push(Ee);let Le=0;for(let Ve=1;Ve<he.length;Ve++){let qe=he[Ve],je=fe.notes[Le];if(je.instrument===qe.instrument&&je.pitch===qe.pitch&&qe.quantizedStartStep===je.quantizedEndStep&&qe.quantizedStartStep%16!=0)fe.notes[Le].quantizedEndStep+=qe.quantizedEndStep-qe.quantizedStartStep;else{let Ce=new r.a.Note;Ce.pitch=he[Ve].pitch,Ce.instrument=he[Ve].instrument,Ce.quantizedStartStep=he[Ve].quantizedStartStep,Ce.quantizedEndStep=he[Ve].quantizedEndStep,fe.notes.push(Ce),Le++}}return fe}function Z(ae,fe=64){let he;if(function(Ce){Ce[Ce.SUSTAIN_ON=0]="SUSTAIN_ON",Ce[Ce.SUSTAIN_OFF=1]="SUSTAIN_OFF",Ce[Ce.NOTE_ON=2]="NOTE_ON",Ce[Ce.NOTE_OFF=3]="NOTE_OFF"}(he||(he={})),y(ae))throw new Error("Can only apply sustain to unquantized NoteSequence.");let Ee=h(ae),Le=[];for(let Ce of Ee.notes)Ce.isDrum===!1&&(Ce.startTime!==null&&Le.push({time:Ce.startTime,type:he.NOTE_ON,event:Ce}),Ce.endTime!==null&&Le.push({time:Ce.endTime,type:he.NOTE_OFF,event:Ce}));for(let Ce of Ee.controlChanges)if(Ce.controlNumber===fe){let tt=Ce.controlValue;tt>=64?Le.push({time:Ce.time,type:he.SUSTAIN_ON,event:Ce}):tt<64&&Le.push({time:Ce.time,type:he.SUSTAIN_OFF,event:Ce})}Le.sort((Ce,tt)=>Ce.time-tt.time);let Ve={},qe={},je=0;for(let Ce of Le){je=Ce.time;let tt=Ce.type,ye=Ce.event;if(tt===he.SUSTAIN_ON)qe[ye.instrument]=!0;else if(tt===he.SUSTAIN_OFF){qe[ye.instrument]=!1;let z=[];ye.instrument in Ve||(Ve[ye.instrument]=[]);for(let M of Ve[ye.instrument])M.endTime<je?(M.endTime=je,je>Ee.totalTime&&(Ee.totalTime=je)):z.push(M);Ve[ye.instrument]=z}else if(tt===he.NOTE_ON){if(qe[ye.instrument]===!0){let z=[];ye.instrument in Ve||(Ve[ye.instrument]=[]);for(let M of Ve[ye.instrument])M.pitch===ye.pitch?(M.endTime=je,M.startTime===M.endTime&&Ee.notes.push(M)):z.push(M);Ve[ye.instrument]=z}ye.instrument in Ve||(Ve[ye.instrument]=[]),Ve[ye.instrument].push(ye)}else if(tt===he.NOTE_OFF&&qe[ye.instrument]!==!0){let z=Ve[ye.instrument].indexOf(ye);z>-1&&Ve[ye.instrument].splice(z,1)}}for(let Ce of Object.values(Ve))for(let tt of Ce)tt.endTime=je,Ee.totalTime=je;return Ee}function ee(ae,fe){if(fe&&fe.length!==ae.length)throw new Error(`Number of sequences to concatenate and their individual
 durations does not match.`);if(y(ae[0])){for(let he=0;he<ae.length;++he)if(v(ae[he]),ae[he].quantizationInfo.stepsPerQuarter!==ae[0].quantizationInfo.stepsPerQuarter)throw new Error("Not all sequences have the same quantizationInfo");return oe(ae,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",fe)}return oe(ae,"totalTime","startTime","endTime",fe)}function Q(ae,fe,he,Ee){return y(ae)?se(ae,fe,he,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",Ee):se(ae,fe,he,"totalTime","startTime","endTime",Ee)}function oe(ae,fe,he,Ee,Le){let Ve,qe=0;for(let je=0;je<ae.length;++je){let Ce=Le?Le[je]:ae[je][fe];if(Ce===0)throw Error(`Sequence ${ae[je].id} has no ${fe}, and no individual duration was provided.`);je===0?Ve=h(ae[0]):Array.prototype.push.apply(Ve.notes,ae[je].notes.map(tt=>{let ye=r.a.Note.create(tt);return ye[he]+=qe,ye[Ee]+=qe,ye})),qe+=Ce}return Ve[fe]=qe,Ve}function se(ae,fe,he,Ee,Le,Ve,qe){let je=h(ae);je[Ee]=he,je.notes=je.notes.filter(Ce=>Ce[Le]>=fe&&Ce[Le]<=he&&(qe||Ce[Ve]<=he)),je[Ee]-=fe;for(let Ce=0;Ce<je.notes.length;Ce++)je.notes[Ce][Le]-=fe,je.notes[Ce][Ve]-=fe,qe&&(je.notes[Ce][Ve]=Math.min(je.notes[Ce][Ve],je[Ee]));return je}function pe(ae,fe){v(ae);let he=h(ae),Ee=he.notes.sort((je,Ce)=>je.quantizedStartStep-Ce.quantizedStartStep),Le=[],Ve=0,qe=[];for(let je=0;je<Ee.length;je++){let Ce=Ee[je],tt=Ce.quantizedStartStep,ye=Ce.quantizedEndStep;if(Ce.quantizedStartStep-=Ve,Ce.quantizedEndStep-=Ve,!(Ce.quantizedStartStep<0))if(Ce.quantizedEndStep<=fe)qe.push(Ce);else{if(Ce.quantizedStartStep<fe){let z=r.a.Note.create(Ce);z.quantizedEndStep=fe,z.startTime=z.endTime=void 0,qe.push(z),Ce.quantizedStartStep=Ve+fe,Ce.quantizedEndStep=ye}else Ce.quantizedStartStep=tt,Ce.quantizedEndStep=ye;if((Ce.quantizedEndStep>fe||Ce.quantizedStartStep>fe)&&(je-=1),qe.length!==0){let z=h(he);z.notes=qe,z.totalQuantizedSteps=fe,Le.push(z)}qe=[],Ve+=fe}}if(qe.length!==0){let je=h(he);je.notes=qe,je.totalQuantizedSteps=fe,Le.push(je)}return Le}},function(n,t,e){"use strict";e.d(t,"b",function(){return s}),e.d(t,"a",function(){return i});var r=e(5),o=e(27);e(16);function s(a,u){if(a.dtype===u.dtype)return[a,u];let c=Object(o.b)(a.dtype,u.dtype);return[a.cast(c),u.cast(c)]}function i(a){let u=[];return function c(h,f,g){if(h==null)return;if(h instanceof r.a)return void f.push(h);if(d=h,!Array.isArray(d)&&typeof d!="object")return;var d;let p=h;for(let m in p){let y=p[m];g.has(y)||(g.add(y),c(y,f,g))}}(a,u,new Set),u}},function(n,t,e){"use strict";(function(r){e.d(t,"a",function(){return s}),e.d(t,"d",function(){return i}),e.d(t,"c",function(){return a}),e.d(t,"b",function(){return c});let o=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(r!==void 0)return r;throw new Error("cannot find the global object")}(),s=o.fetch.bind(o),i=o.performance,a=(o.navigator,!!o.webkitOfflineAudioContext),u=o.WorkerGlobalScope!==void 0;function c(h){if(h=a?44100:h,u)throw new Error("Cannot use offline audio context in a web worker.");let f=o.webkitOfflineAudioContext;return a?new f(1,h,h):new o.OfflineAudioContext(1,h,h)}}).call(this,e(21))},function(n,t,e){"use strict";function r(J){let Ie=J.length,Fe=0,lt=0;for(;Ie>0;)lt=Math.random()*Ie|0,Ie--,Fe=J[Ie],J[Ie]=J[lt],J[lt]=Fe}function o(J,Ie,Fe){return Math.max(J,Math.min(Ie,Fe))}function s(J){return J%2==0?J:J+1}function i(J){let Ie=0;for(let Fe=0;Fe<J.length;Fe++)Ie+=J[Fe];return Ie}function a(J,Ie){let Fe=Math.random();return Ie*Fe+(1-Fe)*J}function u(J,Ie){let Fe=0;for(let lt=0;lt<J.length;lt++){let Dt=Number(J[lt])-Number(Ie[lt]);Fe+=Dt*Dt}return Fe}function c(J,Ie){if(!J)throw new Error(typeof Ie=="string"?Ie:Ie())}function h(J,Ie,Fe=""){c(m(J,Ie),()=>Fe+` Shapes ${J} and ${Ie} must match`)}function f(J){c(J!=null,()=>"The input to the tensor constructor must be a non-null value.")}function g(J,Ie=[],Fe=!1){if(Ie==null&&(Ie=[]),Array.isArray(J)||oe(J)&&!Fe)for(let lt=0;lt<J.length;++lt)g(J[lt],Ie,Fe);else Ie.push(J);return Ie}function d(J){if(J.length===0)return 1;let Ie=J[0];for(let Fe=1;Fe<J.length;Fe++)Ie*=J[Fe];return Ie}function p(J){return J.length===0}function m(J,Ie){if(J===Ie)return!0;if(J==null||Ie==null||J.length!==Ie.length)return!1;for(let Fe=0;Fe<J.length;Fe++)if(J[Fe]!==Ie[Fe])return!1;return!0}function y(J){return J%1==0}function v(J){if(Math.tanh!=null)return Math.tanh(J);if(J===1/0)return 1;if(J===-1/0)return-1;{let Ie=Math.exp(2*J);return(Ie-1)/(Ie+1)}}function N(J){let Ie=Math.ceil(Math.sqrt(J));return[Ie,Math.ceil(J/Ie)]}function T(J){let Ie=new Uint32Array(J);for(let Fe=0;Fe<J;++Fe)Ie[Fe]=Fe;return r(Ie),Ie}function O(J,Ie){return Ie<=J.length?J:J+" ".repeat(Ie-J.length)}function S(J,Ie=lt=>0,Fe){return new Promise((lt,Dt)=>{let Ht=0,an=()=>{if(J())return void lt();Ht++;let cn=Ie(Ht);Fe!=null&&Ht>=Fe?Dt():setTimeout(an,cn)};an()})}function F(J,Ie){let Fe=1,lt=-1;for(let Ht=0;Ht<J.length;++Ht)if(J[Ht]>=0)Fe*=J[Ht];else if(J[Ht]===-1){if(lt!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${lt} and dim ${Ht}`);lt=Ht}else if(J[Ht]<0)throw Error(`Shapes can not be < 0. Found ${J[Ht]} at dim ${Ht}`);if(lt===-1){if(Ie>0&&Ie!==Fe)throw Error(`Size(${Ie}) must match the product of shape ${J}`);return J}if(Fe===0)throw Error(`Cannot infer the missing size in [${J}] when there are 0 elements`);if(Ie%Fe!=0)throw Error(`The implicit shape can't be a fractional number. Got ${Ie} / ${Fe}`);let Dt=J.slice();return Dt[lt]=Ie/Fe,Dt}function R(J,Ie){let Fe=Ie.length;return c((J=J==null?Ie.map((lt,Dt)=>Dt):[].concat(J)).every(lt=>lt>=-Fe&&lt<Fe),()=>`All values in axis param must be in range [-${Fe}, ${Fe}) but got axis `+J),c(J.every(lt=>y(lt)),()=>"All values in axis param must be integers but got axis "+J),J.map(lt=>lt<0?Fe+lt:lt)}function L(J,Ie){let Fe=[],lt=[],Dt=Ie!=null&&Array.isArray(Ie)&&Ie.length===0,Ht=Ie==null||Dt?null:R(Ie,J).sort(),an=0;for(let cn=0;cn<J.length;++cn){if(Ht!=null){if(Ht[an]===cn&&J[cn]!==1)throw new Error(`Can't squeeze axis ${cn} since its dim '${J[cn]}' is not 1`);(Ht[an]==null||Ht[an]>cn)&&J[cn]===1&&(Fe.push(J[cn]),lt.push(cn)),Ht[an]<=cn&&an++}J[cn]!==1&&(Fe.push(J[cn]),lt.push(cn))}return{newShape:Fe,keptDims:lt}}function q(J,Ie){let Fe=null;if(J==null||J==="float32")Fe=new Float32Array(Ie);else if(J==="int32")Fe=new Int32Array(Ie);else{if(J!=="bool")throw new Error("Unknown data type "+J);Fe=new Uint8Array(Ie)}return Fe}function U(J,Ie){let Fe=null;if(J==null||J==="float32")Fe=new Float32Array(Ie);else if(J==="int32")Fe=new Int32Array(Ie);else if(J==="bool")Fe=new Uint8Array(Ie);else{if(J!=="string")throw new Error("Unknown data type "+J);Fe=new Array(Ie)}return Fe}function Z(J,Ie){for(let Fe=0;Fe<J.length;Fe++){let lt=J[Fe];if(isNaN(lt)||!isFinite(lt))throw Error(`A tensor of type ${Ie} being uploaded contains ${lt}.`)}}function ee(J){return J==="bool"||J==="complex64"||J==="float32"||J==="int32"||J==="string"}function Q(J,Ie){return Ie!=="complex64"&&(Ie!=="float32"||J==="complex64")&&(Ie!=="int32"||J==="float32"||J==="complex64")&&(Ie!=="bool"||J!=="bool")}function oe(J){return J instanceof Float32Array||J instanceof Int32Array||J instanceof Uint8Array}function se(J){if(J==="float32"||J==="int32")return 4;if(J==="complex64")return 8;if(J==="bool")return 1;throw new Error("Unknown dtype "+J)}function pe(J){if(J==null)return 0;let Ie=0;return J.forEach(Fe=>Ie+=Fe.length),Ie}function ae(J){return typeof J=="string"||J instanceof String}function fe(J){return typeof J=="boolean"}function he(J){return typeof J=="number"}function Ee(J){return Array.isArray(J)?Ee(J[0]):J instanceof Float32Array?"float32":J instanceof Int32Array||J instanceof Uint8Array?"int32":he(J)?"float32":ae(J)?"string":fe(J)?"bool":"float32"}function Le(J){return!!(J&&J.constructor&&J.call&&J.apply)}function Ve(J,Ie){for(let Fe=Ie;Fe<J;++Fe)if(J%Fe==0)return Fe;return J}function qe(J){let Ie=J.length;if(Ie<2)return[];let Fe=new Array(Ie-1);Fe[Ie-2]=J[Ie-1];for(let lt=Ie-3;lt>=0;--lt)Fe[lt]=Fe[lt+1]*J[lt+1];return Fe}function je(J,Ie){if(J.length===0)return Ie[0];let Fe=J.reduce((lt,Dt)=>lt*Dt);if(Fe===0)return[];if(Fe!==Ie.length)throw new Error(`[${J}] does not match the input size ${Ie.length}.`);return function lt(Dt,Ht,an){let cn=new Array;if(Ht.length===1){let nn=Ht[0];for(let Yn=0;Yn<nn;Yn++)cn[Yn]=an[Dt+Yn]}else{let nn=Ht[0],Yn=Ht.slice(1),ln=Yn.reduce((Qn,wn)=>Qn*wn);for(let Qn=0;Qn<nn;Qn++)cn[Qn]=lt(Dt+Qn*ln,Yn,an)}return cn}(0,J,Ie)}function Ce(J,Ie){let Fe=tt(J,Ie);for(let lt=0;lt<Fe.length;lt++)Fe[lt]=1;return Fe}function tt(J,Ie){if(Ie==null||Ie==="float32"||Ie==="complex64")return new Float32Array(J);if(Ie==="int32")return new Int32Array(J);if(Ie==="bool")return new Uint8Array(J);throw new Error("Unknown data type "+Ie)}function ye(J,Ie){let Fe=J.reduce((lt,Dt)=>lt*Dt,1);if(Ie==null||Ie==="float32")return je(J,new Float32Array(Fe));if(Ie==="int32")return je(J,new Int32Array(Fe));if(Ie==="bool")return je(J,new Uint8Array(Fe));throw new Error("Unknown data type "+Ie)}function z(J){J.forEach(Ie=>{c(Number.isInteger(Ie)&&Ie>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${J}].`)})}function M(J,Ie,Fe){if(Ie===0)return 0;if(Ie===1)return J[0];let lt=J[J.length-1];for(let Dt=0;Dt<J.length-1;++Dt)lt+=Fe[Dt]*J[Dt];return lt}function W(J,Ie,Fe){if(Ie===0)return[];if(Ie===1)return[J];let lt=new Array(Ie);for(let Dt=0;Dt<lt.length-1;++Dt)lt[Dt]=Math.floor(J/Fe[Dt]),J-=lt[Dt]*Fe[Dt];return lt[lt.length-1]=J,lt}function ce(J){return J&&J.then&&typeof J.then=="function"}e.d(t,"M",function(){return r}),e.d(t,"i",function(){return o}),e.d(t,"H",function(){return s}),e.d(t,"Q",function(){return i}),e.d(t,"J",function(){return a}),e.d(t,"l",function(){return u}),e.d(t,"b",function(){return c}),e.d(t,"e",function(){return h}),e.d(t,"d",function(){return f}),e.d(t,"m",function(){return g}),e.d(t,"N",function(){return d}),e.d(t,"y",function(){return p}),e.d(t,"a",function(){return m}),e.d(t,"v",function(){return y}),e.d(t,"R",function(){return v}),e.d(t,"O",function(){return N}),e.d(t,"k",function(){return T}),e.d(t,"L",function(){return O}),e.d(t,"K",function(){return S}),e.d(t,"s",function(){return F}),e.d(t,"I",function(){return R}),e.d(t,"P",function(){return L}),e.d(t,"o",function(){return q}),e.d(t,"n",function(){return U}),e.d(t,"h",function(){return Z}),e.d(t,"B",function(){return ee}),e.d(t,"p",function(){return Q}),e.d(t,"A",function(){return oe}),e.d(t,"g",function(){return se}),e.d(t,"f",function(){return pe}),e.d(t,"z",function(){return ae}),e.d(t,"t",function(){return fe}),e.d(t,"w",function(){return he}),e.d(t,"r",function(){return Ee}),e.d(t,"u",function(){return Le}),e.d(t,"G",function(){return Ve}),e.d(t,"j",function(){return qe}),e.d(t,"S",function(){return je}),e.d(t,"D",function(){return Ce}),e.d(t,"F",function(){return tt}),e.d(t,"E",function(){return ye}),e.d(t,"c",function(){return z}),e.d(t,"C",function(){return M}),e.d(t,"q",function(){return W}),e.d(t,"x",function(){return ce})},function(n,t,e){"use strict";(function(r){e.d(t,"f",function(){return u}),e.d(t,"e",function(){return c}),e.d(t,"a",function(){return d}),e.d(t,"b",function(){return p}),e.d(t,"d",function(){return m}),e.d(t,"c",function(){return y}),e.d(t,"g",function(){return v});var o=e(19),s=e(24),i=e(16),a=e(41);function u(T,O){return Te(this,null,function*(){let S=[],F=[],R=Array.isArray(T)?T.map(L=>L.name):Object.keys(T);for(let L=0;L<R.length;++L){let q=R[L],U=Array.isArray(T)?T[L].tensor:T[q];if(U.dtype!=="float32"&&U.dtype!=="int32"&&U.dtype!=="bool"&&U.dtype!=="string"&&U.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${q}': ${U.dtype}`);let Z={name:q,shape:U.shape,dtype:U.dtype};if(U.dtype==="string"){let ee=new Promise(Q=>Te(null,null,function*(){let oe=yield U.bytes(),se=oe.reduce((fe,he)=>fe+he.length,0)+4*oe.length,pe=new Uint8Array(se),ae=0;for(let fe=0;fe<oe.length;fe++){let he=oe[fe],Ee=new Uint8Array(new Uint32Array([he.length]).buffer);pe.set(Ee,ae),ae+=4,pe.set(he,ae),ae+=he.length}Q(pe)}));F.push(ee)}else F.push(U.data());O!=null&&(Z.group=O),S.push(Z)}return{data:h(yield Promise.all(F)),specs:S}})}function c(T,O){let S={},F,R=0;for(let L of O){let q=L.name,U=L.dtype,Z=L.shape,ee=Object(i.N)(Z),Q;if("quantization"in L){let oe=L.quantization;if(oe.dtype==="uint8"||oe.dtype==="uint16"){if(!("min"in oe)||!("scale"in oe))throw new Error(`Weight ${L.name} with quantization ${oe.dtype} doesn't have corresponding metadata min and scale.`)}else{if(oe.dtype!=="float16")throw new Error(`Weight ${L.name} has unknown quantization dtype ${oe.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if(U!=="float32")throw new Error(`Weight ${L.name} is quantized with ${oe.dtype} which only supports weights of type float32 not ${U}.`)}let se=a.a[oe.dtype],pe=T.slice(R,R+ee*se),ae=oe.dtype==="uint8"?new Uint8Array(pe):new Uint16Array(pe);if(U==="float32")if(oe.dtype==="uint8"||oe.dtype==="uint16"){Q=new Float32Array(ae.length);for(let fe=0;fe<ae.length;fe++){let he=ae[fe];Q[fe]=he*oe.scale+oe.min}}else{if(oe.dtype!=="float16")throw new Error(`Unsupported quantization type ${oe.dtype} for weight type float32.`);F===void 0&&(F=N()),Q=F(ae)}else{if(U!=="int32")throw new Error(`Unsupported dtype in weight '${q}': ${U}`);if(oe.dtype!=="uint8"&&oe.dtype!=="uint16")throw new Error(`Unsupported quantization type ${oe.dtype} for weight type int32.`);Q=new Int32Array(ae.length);for(let fe=0;fe<ae.length;fe++){let he=ae[fe];Q[fe]=Math.round(he*oe.scale+oe.min)}}R+=ee*se}else if(U==="string"){let oe=Object(i.N)(L.shape);Q=[];for(let se=0;se<oe;se++){let pe=new Uint32Array(T.slice(R,R+4))[0];R+=4;let ae=new Uint8Array(T.slice(R,R+pe));Q.push(ae),R+=pe}}else{let oe=a.a[U],se=T.slice(R,R+ee*oe);if(U==="float32")Q=new Float32Array(se);else if(U==="int32")Q=new Int32Array(se);else if(U==="bool")Q=new Uint8Array(se);else{if(U!=="complex64")throw new Error(`Unsupported dtype in weight '${q}': ${U}`);{Q=new Float32Array(se);let pe=new Float32Array(Q.length/2),ae=new Float32Array(Q.length/2);for(let Ee=0;Ee<pe.length;Ee++)pe[Ee]=Q[2*Ee],ae[Ee]=Q[2*Ee+1];let fe=Object(s.a)(pe,Z,"float32"),he=Object(s.a)(ae,Z,"float32");S[q]=Object(o.a)(fe,he),fe.dispose(),he.dispose()}}R+=ee*oe}U!=="complex64"&&(S[q]=Object(s.a)(Q,Z,U))}return S}function h(T){if(T===null)throw new Error("Invalid input value: "+JSON.stringify(T));let O=0,S=[];T.forEach(L=>{if(O+=L.byteLength,S.push(L.byteLength===L.buffer.byteLength?L:new L.constructor(L)),!(L instanceof Float32Array||L instanceof Int32Array||L instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+L.constructor.name)});let F=new Uint8Array(O),R=0;return S.forEach(L=>{F.set(new Uint8Array(L.buffer),R),R+=L.byteLength}),F.buffer}let f=r!==void 0&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function g(T){return f?r.byteLength(T):new Blob([T]).size}function d(T){if(f)return r.from(T).toString("base64");let O=new Uint8Array(T),S="";for(let F=0,R=O.length;F<R;F++)S+=String.fromCharCode(O[F]);return btoa(S)}function p(T){if(f){let F=r.from(T,"base64");return F.buffer.slice(F.byteOffset,F.byteOffset+F.byteLength)}let O=atob(T),S=new Uint8Array(O.length);for(let F=0;F<O.length;++F)S.set([O.charCodeAt(F)],F);return S.buffer}function m(T){if(T.length===1)return T[0];let O=0;T.forEach(R=>{O+=R.byteLength});let S=new Uint8Array(O),F=0;return T.forEach(R=>{S.set(new Uint8Array(R),F),F+=R.byteLength}),S.buffer}function y(T){for(T=T.trim();T.endsWith("/");)T=T.slice(0,T.length-1);let O=T.split("/");return O[O.length-1]}function v(T){if(T.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:T.modelTopology==null?0:g(JSON.stringify(T.modelTopology)),weightSpecsBytes:T.weightSpecs==null?0:g(JSON.stringify(T.weightSpecs)),weightDataBytes:T.weightData==null?0:T.weightData.byteLength}}function N(){let T=function(){let F=L=>{let q=L<<13,U=0;for(;(8388608&q)==0;)U-=8388608,q<<=1;return q&=-8388609,U+=947912704,q|U},R=new Uint32Array(2048);R[0]=0;for(let L=1;L<1024;L++)R[L]=F(L);for(let L=1024;L<2048;L++)R[L]=939524096+(L-1024<<13);return R}(),O=function(){let F=new Uint32Array(64);F[0]=0,F[31]=1199570944,F[32]=2147483648,F[63]=3347054592;for(let R=1;R<31;R++)F[R]=R<<23;for(let R=33;R<63;R++)F[R]=2147483648+(R-32<<23);return F}(),S=function(){let F=new Uint32Array(64);for(let R=0;R<64;R++)F[R]=1024;return F[0]=F[32]=0,F}();return F=>{let R=new ArrayBuffer(4*F.length),L=new Uint32Array(R);for(let q=0;q<F.length;q++){let U=F[q],Z=T[S[U>>10]+(1023&U)]+O[U>>10];L[q]=Z}return new Float32Array(R)}}}).call(this,e(68).Buffer)},function(n,t,e){"use strict";(function(r){var o=t;function s(a,u,c){for(var h=Object.keys(u),f=0;f<h.length;++f)a[h[f]]!==void 0&&c||(a[h[f]]=u[h[f]]);return a}function i(a){function u(c,h){if(!(this instanceof u))return new u(c,h);Object.defineProperty(this,"message",{get:function(){return c}}),Error.captureStackTrace?Error.captureStackTrace(this,u):Object.defineProperty(this,"stack",{value:new Error().stack||""}),h&&s(this,h)}return(u.prototype=Object.create(Error.prototype)).constructor=u,Object.defineProperty(u.prototype,"name",{get:function(){return a}}),u.prototype.toString=function(){return this.name+": "+this.message},u}o.asPromise=e(51),o.base64=e(52),o.EventEmitter=e(53),o.float=e(54),o.inquire=e(55),o.utf8=e(56),o.pool=e(57),o.LongBits=e(58),o.isNode=!!(r!==void 0&&r&&r.process&&r.process.versions&&r.process.versions.node),o.global=o.isNode&&r||typeof window<"u"&&window||typeof self<"u"&&self||this,o.emptyArray=Object.freeze?Object.freeze([]):[],o.emptyObject=Object.freeze?Object.freeze({}):{},o.isInteger=Number.isInteger||function(a){return typeof a=="number"&&isFinite(a)&&Math.floor(a)===a},o.isString=function(a){return typeof a=="string"||a instanceof String},o.isObject=function(a){return a&&typeof a=="object"},o.isset=o.isSet=function(a,u){var c=a[u];return!(c==null||!a.hasOwnProperty(u))&&(typeof c!="object"||(Array.isArray(c)?c.length:Object.keys(c).length)>0)},o.Buffer=function(){try{var a=o.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch{return null}}(),o._Buffer_from=null,o._Buffer_allocUnsafe=null,o.newBuffer=function(a){return typeof a=="number"?o.Buffer?o._Buffer_allocUnsafe(a):new o.Array(a):o.Buffer?o._Buffer_from(a):typeof Uint8Array>"u"?a:new Uint8Array(a)},o.Array=typeof Uint8Array<"u"?Uint8Array:Array,o.Long=o.global.dcodeIO&&o.global.dcodeIO.Long||o.global.Long||o.inquire("long"),o.key2Re=/^true|false|0|1$/,o.key32Re=/^-?(?:0|[1-9][0-9]*)$/,o.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,o.longToHash=function(a){return a?o.LongBits.from(a).toHash():o.LongBits.zeroHash},o.longFromHash=function(a,u){var c=o.LongBits.fromHash(a);return o.Long?o.Long.fromBits(c.lo,c.hi,u):c.toNumber(!!u)},o.merge=s,o.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.substring(1)},o.newError=i,o.ProtocolError=i("ProtocolError"),o.oneOfGetter=function(a){for(var u={},c=0;c<a.length;++c)u[a[c]]=1;return function(){for(var h=Object.keys(this),f=h.length-1;f>-1;--f)if(u[h[f]]===1&&this[h[f]]!==void 0&&this[h[f]]!==null)return h[f]}},o.oneOfSetter=function(a){return function(u){for(var c=0;c<a.length;++c)a[c]!==u&&delete this[a[c]]}},o.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},o._configure=function(){var a=o.Buffer;a?(o._Buffer_from=a.from!==Uint8Array.from&&a.from||function(u,c){return new a(u,c)},o._Buffer_allocUnsafe=a.allocUnsafe||function(u){return new a(u)}):o._Buffer_from=o._Buffer_allocUnsafe=null}}).call(this,e(21))},function(n,t,e){"use strict";e.d(t,"a",function(){return u});var r=e(6),o=e(1),s=e(3),i=e(16),a=e(4);let u=Object(a.a)({complex_:function(c,h){let f=Object(s.a)(c,"real","complex"),g=Object(s.a)(h,"imag","complex");i.e(f.shape,g.shape,`real and imag shapes, ${f.shape} and ${g.shape}, must match in call to tf.complex().`);let d={real:f,imag:g};return r.a.runKernelFunc(p=>p.complex(f,g),d,null,o.y)}})},function(n,t,e){"use strict";e.d(t,"e",function(){return h}),e.d(t,"d",function(){return f}),e.d(t,"f",function(){return g}),e.d(t,"i",function(){return d}),e.d(t,"j",function(){return m}),e.d(t,"a",function(){return v}),e.d(t,"h",function(){return N}),e.d(t,"b",function(){return S}),e.d(t,"g",function(){return R}),e.d(t,"c",function(){return L});var r=e(2),o=e(43),s=e(30),i=e(74),a=e(15),u=e(12);let c=Object(a.b)(16e3);function h(U){return Te(this,null,function*(){return Object(a.a)(U).then(Z=>Z.arrayBuffer()).then(Z=>c.decodeAudioData(Z))})}function f(U){return Te(this,null,function*(){let Z=new FileReader;return new Promise((ee,Q)=>{Z.onerror=()=>{Z.abort(),Q(new DOMException("Something went wrong reading that file."))},Z.onload=()=>{ee(Z.result)},Z.readAsArrayBuffer(U)}).then(ee=>c.decodeAudioData(ee))})}function g(U,Z){Z.power||(Z.power=2);let ee=function(se,pe){let ae=pe.nFft||2048,fe=pe.winLength||ae,he=pe.hopLength||Math.floor(fe/4),Ee=S(fe);Ee=N(Ee,ae);let Le=function(Ce,tt,ye){let z=Math.floor((Ce.length-tt)/ye)+1,M=Array.from({length:z},(W,ce)=>new Float32Array(tt));for(let W=0;W<z;W++){let ce=W*ye,J=Ce.slice(ce,ce+tt);M[W].set(J),J.length}return M}(se=function(Ce,tt){let ye=T(Ce,tt);for(let z=0;z<tt;z++)ye[z]=ye[2*tt-z],ye[ye.length-z-1]=ye[ye.length-2*tt+z-1];return ye}(se,Math.floor(ae/2)),ae,he),Ve=[],qe=Le.length,je=ae+2;for(let Ce=0;Ce<qe;Ce++){let tt=new Float32Array(je);Ve[Ce]=tt}for(let Ce=0;Ce<qe;Ce++){let tt=O(v(Le[Ce],Ee));Ve[Ce].set(tt.slice(0,je))}return Ve}(U,Z),[Q,oe]=function(se,pe){let ae=se.map(he=>function(Ee,Le){return Ee.map(Ve=>Math.pow(Ve,Le))}(function(Ee){let Le=new Float32Array(Ee.length/2);for(let Ve=0;Ve<Ee.length/2;Ve++)Le[Ve]=Math.sqrt(Ee[2*Ve]*Ee[2*Ve]+Ee[2*Ve+1]*Ee[2*Ve+1]);return Le}(he),pe)),fe=se[0].length-1;return[ae,fe]}(ee,Z.power);return Z.nFft=oe,function(se,pe){let ae=[];for(let fe=0;fe<se.length;fe++)ae[fe]=y(se[fe],pe);return ae}(Q,function(se){let pe=se.fMin||0,ae=se.fMax||se.sampleRate/2,fe=se.nMels||128,he=se.nFft||2048,Ee=function(tt,ye){return F(0,tt/2,Math.floor(1+ye/2))}(se.sampleRate,he),Le=function(tt,ye,z){let M=q(ye),W=q(z);return F(M,W,tt).map(J=>function(Ie){return 700*(Math.exp(Ie/1125)-1)}(J))}(fe+2,pe,ae),Ve=function(tt){let ye=new Float32Array(tt.length-1);for(let z=0;z<tt.length;z++)ye[z]=tt[z+1]-tt[z];return ye}(Le),qe=function(tt,ye){let z=[];for(let M=0;M<tt.length;M++)z[M]=new Float32Array(ye.length);for(let M=0;M<tt.length;M++)for(let W=0;W<ye.length;W++)z[M][W]=tt[M]-ye[W];return z}(Le,Ee),je=qe[0].length,Ce=[];for(let tt=0;tt<fe;tt++){Ce[tt]=new Float32Array(je);for(let ye=0;ye<qe[tt].length;ye++){let z=-qe[tt][ye]/Ve[tt],M=qe[tt+2][ye]/Ve[tt+1],W=Math.max(0,Math.min(z,M));Ce[tt][ye]=W}}for(let tt=0;tt<Ce.length;tt++){let ye=2/(Le[2+tt]-Le[tt]);Ce[tt]=Ce[tt].map(z=>z*ye)}return Ce}(Z))}function d(U,Z=1e-10,ee=80){let Q=U.length,oe=U[0].length,se=[];for(let pe=0;pe<Q;pe++)se[pe]=new Float32Array(oe);for(let pe=0;pe<Q;pe++)for(let ae=0;ae<oe;ae++){let fe=U[pe][ae];se[pe][ae]=10*Math.log10(Math.max(Z,fe))}if(ee){if(ee<0)throw new Error("topDb must be non-negative.");for(let pe=0;pe<Q;pe++){let ae=se[pe].reduce((fe,he)=>Math.max(fe,he));for(let fe=0;fe<oe;fe++)se[pe][fe]=Math.max(se[pe][fe],ae-ee)}}return se}function p(U){if(U.numberOfChannels===1)return U.getChannelData(0);if(U.numberOfChannels!==2)throw Error(U.numberOfChannels+" channel audio is not supported.");let Z=U.getChannelData(0),ee=U.getChannelData(1),Q=new Float32Array(U.length);for(let oe=0;oe<U.length;++oe)Q[oe]=(Z[oe]+ee[oe])/2;return Q}function m(U,Z=16e3){return Te(this,null,function*(){if(U.sampleRate===Z)return p(U);let ee=U.sampleRate,Q=U.length*Z/ee;if(a.c){u.log("Safari does not support WebAudio resampling, so this may be slow.","O&F",5);let oe=p(U),se=new Float32Array(Q);return i(s(se,[Q]),s(oe,[oe.length])),se}{let oe=new OfflineAudioContext(U.numberOfChannels,U.duration*Z,Z),se=oe.createBufferSource();return se.buffer=U,se.connect(oe.destination),se.start(),oe.startRendering().then(pe=>pe.getChannelData(0))}})}function y(U,Z){if(U.length!==Z[0].length)throw new Error(`Each entry in filterbank should have dimensions matching FFT. |mags| = ${U.length}, |filterbank[0]| = ${Z[0].length}.`);let ee=new Float32Array(Z.length);for(let Q=0;Q<Z.length;Q++){let oe=v(U,Z[Q]);ee[Q]=oe.reduce((se,pe)=>se+pe)}return ee}function v(U,Z){if(U.length!==Z.length)return console.error(`Buffer length ${U.length} != window length ${Z.length}.`),null;let ee=new Float32Array(U.length);for(let Q=0;Q<U.length;Q++)ee[Q]=Z[Q]*U[Q];return ee}function N(U,Z){if(U.length>Z)throw new Error("Data is longer than length.");let ee=Math.floor((Z-U.length)/2);return T(U,[ee,Z-U.length-ee])}function T(U,Z){let ee,Q;typeof Z=="object"?[ee,Q]=Z:ee=Q=Z;let oe=new Float32Array(U.length+ee+Q);return oe.set(U,ee),oe}function O(U){let Z=new o(U.length),ee=Z.createComplexArray(),Q=Z.toComplexArray(U);return Z.transform(ee,Q),ee}function S(U){let Z=new Float32Array(U);for(let ee=0;ee<U;ee++)Z[ee]=.5*(1-Math.cos(2*Math.PI*ee/(U-1)));return Z}function F(U,Z,ee){let Q=(Z-U)/(ee-1),oe=new Float32Array(ee);for(let se=0;se<ee;se++)oe[se]=U+Q*se;return oe}function R(U){let Z=r.sub(U,69);return Z=r.div(Z,12),Z=r.pow(2,Z),Z=r.mul(440,Z),Z}function L(U){return Te(this,null,function*(){let Z=r.sub(r.div(r.log(U),r.log(2)),r.div(r.log(440),r.log(2)));return Z=r.mul(12,Z),Z=r.add(Z,69),yield Z.array()})}function q(U){return 1125*Math.log(1+U/700)}},function(n,t){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch{typeof window=="object"&&(e=window)}n.exports=e},function(n,t){n.exports=function(){throw new Error("define cannot be used indirect")}},function(n,t,e){"use strict";e.r(t),e.d(t,"NO_EVENT",function(){return i}),e.d(t,"NOTE_OFF",function(){return a}),e.d(t,"Melody",function(){return u}),e.d(t,"MelodyRhythm",function(){return c}),e.d(t,"MelodyShape",function(){return h}),e.d(t,"MelodyRegister",function(){return f});var r=e(2),o=e(10),s=e(13);let i=0,a=1;class u{constructor(d,p,m){this.events=d,this.minPitch=p,this.maxPitch=m}static fromNoteSequence(d,p,m,y=!0,v){s.assertIsQuantizedSequence(d);let N=d.notes.sort((S,F)=>S.quantizedStartStep===F.quantizedStartStep?F.pitch-S.pitch:S.quantizedStartStep-F.quantizedStartStep),T=new Int32Array(v||d.totalQuantizedSteps),O=-1;return N.forEach(S=>{if(S.quantizedStartStep===O){if(y)return;throw new Error("`NoteSequence` is not monophonic.")}if(S.pitch<p||S.pitch>m)throw Error("`NoteSequence` has a pitch outside of the valid range: "+S.pitch);T[S.quantizedStartStep]=S.pitch-p+2,T[S.quantizedEndStep]=a,O=S.quantizedStartStep}),new u(T,p,m)}toNoteSequence(d,p){let m=s.createQuantizedNoteSequence(d,p),y=null;for(let v=0;v<this.events.length;++v){let N=this.events[v];switch(N){case i:break;case a:y&&(y.quantizedEndStep=v,m.notes.push(y),y=null);break;default:y&&(y.quantizedEndStep=v,m.notes.push(y)),y=o.a.Note.create({pitch:N-2+this.minPitch,quantizedStartStep:v})}}return y&&(y.quantizedEndStep=this.events.length,m.notes.push(y)),m.totalQuantizedSteps=this.events.length,m}}class c{constructor(){this.depth=1}extract(d){let p=d.events.length,m=r.buffer([p,1]);for(let y=0;y<p;++y)m.set(d.events[y]>=2?1:0,y,0);return m.toTensor().as2D(p,1)}}class h{constructor(){this.depth=3}extract(d){let p=d.events.length,m=r.buffer([p,3]),y=null,v=null;for(let N=0;N<p;++N)if(d.events[N]>=2){if(y!==null){let T;m.get(y,0)===0&&m.get(y,1)===0&&m.get(y,2)===0&&(y=-1),T=d.events[N]<v?0:d.events[N]>v?2:1;for(let O=N;O>y;--O)m.set(1,O,T)}y=N,v=d.events[N]}if(y!==p-1)if(y===null||m.get(y,0)===0&&m.get(y,1)===0&&m.get(y,2)===0)for(let N=0;N<p;++N)m.set(1,N,1);else for(let N=p-1;N>y;--N)for(let T=0;T<3;T++)m.set(m.get(y,T),N,T);return m.toTensor().as2D(p,3)}}class f{constructor(d){this.boundaryPitches=d,this.depth=d.length+1}meanMelodyPitch(d){let p=0,m=0,y=null;for(let v=0;v<d.events.length;++v)d.events[v]===a?y=null:d.events[v]>=2&&(y=d.minPitch+d.events[v]-2),y!==null&&(p+=y,m+=1);return m?p/m:null}extract(d){let p=d.events.length,m=this.meanMelodyPitch(d);if(m===null)return r.zeros([p,this.depth]);let y=0;for(;y<this.boundaryPitches.length&&m>=this.boundaryPitches[y];)y++;let v=r.buffer([p,this.depth]);for(let N=0;N<p;++N)v.set(1,N,y);return v.toTensor().as2D(p,this.depth)}}},function(n,t,e){"use strict";e.d(t,"a",function(){return s});var r=e(3),o=e(28);function s(i,a,u){let c=Object(r.c)(i,u);return Object(o.a)(i,a,c,u)}},function(n,t,e){"use strict";e.d(t,"c",function(){return i}),e.d(t,"b",function(){return a}),e.d(t,"e",function(){return u}),e.d(t,"f",function(){return c}),e.d(t,"d",function(){return h}),e.d(t,"a",function(){return f}),e.d(t,"h",function(){return g}),e.d(t,"g",function(){return d});var r=e(2),o=e(20),s=e(42);let i=16e3,a=250,u=25.58,c=63.07,h=.002,f=.7;function g(p){return Te(this,null,function*(){let m;return m=yield r.loadGraphModel(p,{fromTFHub:!0}),m})}function d(p,m,y){return Te(this,null,function*(){if(r.getBackend()!=="webgl")throw new Error("Device does not support webgl.");let v=yield Object(o.j)(p,i),N=v.length,T=yield function(F){return Te(this,null,function*(){let R=Math.floor(i/a),L=r.tensor1d(F,"float32"),q=F.length;if(L===null)return[];let U=L.mul(L).reshape([q,1]),Z=r.conv1d(U,r.ones([1024,1,1]).div(1024),R,"same").sqrt().squeeze(),ee=r.mul(r.log(r.maximum(1e-20,Z)).div(r.log(10)),20),Q=ee.sub(20.7),oe=r.maximum(Q,-120),se=yield oe.array();return L.dispose(),U.dispose(),Z.dispose(),ee.dispose(),Q.dispose(),oe.dispose(),se})}(v),{pitches:O,confidences:S}=yield Object(s.a)(m,v,y);return{f0_hz:O,loudness_db:T,confidences:S,originalRecordedBufferLength:N}})}},function(n,t,e){"use strict";e.d(t,"b",function(){return a}),e.d(t,"a",function(){return u}),e.d(t,"c",function(){return c}),e.d(t,"e",function(){return h}),e.d(t,"d",function(){return f});var r=e(11),o=e(40);let s=Object(o.a)("kernelRegistry",()=>new Map),i=Object(o.a)("gradRegistry",()=>new Map);function a(d,p){let m=g(d,p);return s.get(m)}function u(d){return i.get(d)}function c(d){let p=s.entries(),m=[];for(;;){let{done:y,value:v}=p.next();if(y)break;let[N,T]=v,[O]=N.split("_");O===d&&m.push(T)}return m}function h(d){let{kernelName:p,backendName:m}=d,y=g(p,m);s.has(y)&&console.warn(`The kernel '${p}' for backend '${m}' is already registered`),s.set(y,d)}function f(d){let{kernelName:p}=d;i.has(p)&&Object(r.b)().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${p}'`),i.set(p,d)}function g(d,p){return`${p}_${d}`}},function(n,t,e){"use strict";var r,o,s,i,a;e.d(t,"b",function(){return c}),e.d(t,"a",function(){return h}),function(f){f.R0="R0",f.R1="R1",f.R2="R2",f.R3="R3",f.R4="R4",f.R5="R5",f.R6="R6"}(r||(r={})),function(f){f.float32="float32",f.int32="int32",f.bool="int32",f.complex64="complex64"}(o||(o={})),function(f){f.float32="float32",f.int32="int32",f.bool="bool",f.complex64="complex64"}(s||(s={})),function(f){f.float32="float32",f.int32="float32",f.bool="float32",f.complex64="complex64"}(i||(i={})),function(f){f.float32="complex64",f.int32="complex64",f.bool="complex64",f.complex64="complex64"}(a||(a={}));let u={float32:i,int32:o,bool:s,complex64:a};function c(f,g){if(f==="string"||g==="string"){if(f==="string"&&g==="string")return"string";throw new Error(`Can not upcast ${f} with ${g}`)}return u[f][g]}function h(f){return c(f,"int32")}},function(n,t,e){"use strict";e.d(t,"a",function(){return i});var r=e(6),o=e(16),s=e(7);function i(a,u,c,h){if(h==null&&(h=Object(o.r)(a)),h==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Object(o.A)(a)&&!Array.isArray(a)&&typeof a!="number"&&typeof a!="boolean"&&typeof a!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(u!=null){Object(o.c)(u);let f=Object(o.N)(u),g=Object(o.N)(c);Object(o.b)(f===g,()=>`Based on the provided shape, [${u}], the tensor should have ${f} values but has ${g}`);for(let d=0;d<c.length;++d){let p=c[d],m=d!==c.length-1||p!==Object(o.N)(u.slice(d));Object(o.b)(c[d]===u[d]||!m,()=>`Error creating a new Tensor. Inferred shape (${c}) does not match the provided shape (${u}). `)}}return Object(o.A)(a)||Array.isArray(a)||(a=[a]),u=u||c,a=h!=="string"?Object(s.toTypedArray)(a,h):Object(o.m)(a,[],!0),r.a.makeTensor(a,u,h)}},function(n,t,e){"use strict";e.r(t),e.d(t,"Performance",function(){return a});var r=e(10),o=e(8),s=e(13),i=e(12);class a{constructor(c,h,f,g,d){this.events=c,this.maxShiftSteps=h,this.numVelocityBins=f,this.program=g,this.isDrum=d}static fromNoteSequence(c,h,f,g){s.assertIsQuantizedSequence(c);let d=c.notes.filter((U,Z)=>g===void 0||U.instrument===g),p=d.sort((U,Z)=>U.startTime===Z.startTime?U.pitch-Z.pitch:U.startTime-Z.startTime),m=p.map((U,Z)=>({step:U.quantizedStartStep,index:Z,isOffset:0})),y=p.map((U,Z)=>({step:U.quantizedEndStep,index:Z,isOffset:1})),v=m.concat(y).sort((U,Z)=>U.step===Z.step?U.index===Z.index?U.isOffset-Z.isOffset:U.index-Z.index:U.step-Z.step),N=f?Math.ceil((o.MIDI_VELOCITIES-1)/f):void 0,T=[],O=0,S=f;for(let U of v){if(U.step>O){for(;U.step>O+h;)T.push({type:"time-shift",steps:h}),O+=h;T.push({type:"time-shift",steps:U.step-O}),O=U.step}if(U.isOffset)T.push({type:"note-off",pitch:p[U.index].pitch});else{if(N){let Z=Math.floor((p[U.index].velocity-o.MIN_MIDI_VELOCITY-1)/N)+1;Z!==S&&(T.push({type:"velocity-change",velocityBin:Z}),S=Z)}T.push({type:"note-on",pitch:p[U.index].pitch})}}let F=!!d.some(U=>U.isDrum)&&(!d.some(U=>!U.isDrum)||void 0),R=Array.from(new Set(d.map(U=>U.program))),L=F||R.length!==1?void 0:R[0],q=new a(T,h,f,L,F);return q.setNumSteps(c.totalQuantizedSteps),q}getNumSteps(){return this.events.filter(c=>c.type==="time-shift").map(c=>c.steps).reduce((c,h)=>c+h,0)}setNumSteps(c){let h=this.getNumSteps();if(h<c){if(this.events.length){let f=this.events[this.events.length-1];if(f.type==="time-shift"){let g=Math.min(c-h,this.maxShiftSteps-f.steps);f.steps+=g,h+=g}}for(;h<c;)h+this.maxShiftSteps>c?(this.events.push({type:"time-shift",steps:c-h}),h=c):(this.events.push({type:"time-shift",steps:this.maxShiftSteps}),h+=this.maxShiftSteps)}else if(h>c)for(;this.events.length&&h>c;){let f=this.events[this.events.length-1];f.type==="time-shift"?h-f.steps<c?(f.steps-=h-c,h=c):(this.events.pop(),h-=f.steps):this.events.pop()}}toNoteSequence(c){let h=this.numVelocityBins?Math.ceil((o.MIDI_VELOCITIES-1)/this.numVelocityBins):void 0,f=r.a.create(),g=0,d,p=new Map;for(let m=o.MIN_MIDI_PITCH;m<=o.MAX_MIDI_PITCH;++m)p.set(m,[]);for(let m of this.events)switch(m.type){case"note-on":p.get(m.pitch).push([g,d]);break;case"note-off":let y=p.get(m.pitch);if(y.length){let[v,N]=y.shift();g>v?f.notes.push(r.a.Note.create({pitch:m.pitch,velocity:N,instrument:c,quantizedStartStep:v,quantizedEndStep:g,program:this.program,isDrum:this.isDrum})):i.log(`Ignoring zero-length note: (pitch = ${m.pitch}, step = ${g})`,"Performance")}else i.log(`Ignoring note-off with no previous note-on:(pitch = ${m.pitch}, step = ${g})`,"Performance");break;case"time-shift":g+=m.steps;break;case"velocity-change":if(!h)throw new Error("Unexpected velocity change event: "+m);d=o.MIN_MIDI_VELOCITY+(m.velocityBin-1)*h+1;break;default:throw new Error("Unrecognized performance event: "+m)}return p.forEach((m,y)=>{for(let[v,N]of m)g>v?f.notes.push(r.a.Note.create({pitch:y,velocity:N,instrument:c,quantizedStartStep:v,quantizedEndStep:g,program:this.program,isDrum:this.isDrum})):i.log(`Ignoring zero-length note: (pitch = ${y}, step = ${g})`,"Performance")}),f.totalQuantizedSteps=g,f}}},function(n,t,e){var r=e(84),o=e(85),s=typeof Float64Array<"u";function i(h,f){return h[0]-f[0]}function a(){var h,f=this.stride,g=new Array(f.length);for(h=0;h<g.length;++h)g[h]=[Math.abs(f[h]),h];g.sort(i);var d=new Array(g.length);for(h=0;h<d.length;++h)d[h]=g[h][1];return d}function u(h,f){var g=["View",f,"d",h].join("");f<0&&(g="View_Nil"+h);var d=h==="generic";if(f===-1){var p="function "+g+"(a){this.data=a;};var proto="+g+".prototype;proto.dtype='"+h+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+g+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+g+"(a){return new "+g+"(a);}";return new Function(p)()}if(f===0)return p="function "+g+"(a,d) {this.data = a;this.offset = d};var proto="+g+".prototype;proto.dtype='"+h+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+g+"_copy() {return new "+g+"(this.data,this.offset)};proto.pick=function "+g+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+g+"_get(){return "+(d?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+g+"_set(v){return "+(d?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+g+"(a,b,c,d){return new "+g+"(a,d)}",new Function("TrivialArray",p)(c[h][0]);p=["'use strict'"];var m=r(f),y=m.map(function(q){return"i"+q}),v="this.offset+"+m.map(function(q){return"this.stride["+q+"]*i"+q}).join("+"),N=m.map(function(q){return"b"+q}).join(","),T=m.map(function(q){return"c"+q}).join(",");p.push("function "+g+"(a,"+N+","+T+",d){this.data=a","this.shape=["+N+"]","this.stride=["+T+"]","this.offset=d|0}","var proto="+g+".prototype","proto.dtype='"+h+"'","proto.dimension="+f),p.push("Object.defineProperty(proto,'size',{get:function "+g+"_size(){return "+m.map(function(q){return"this.shape["+q+"]"}).join("*"),"}})"),f===1?p.push("proto.order=[0]"):(p.push("Object.defineProperty(proto,'order',{get:"),f<4?(p.push("function "+g+"_order(){"),f===2?p.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):f===3&&p.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):p.push("ORDER})")),p.push("proto.set=function "+g+"_set("+y.join(",")+",v){"),d?p.push("return this.data.set("+v+",v)}"):p.push("return this.data["+v+"]=v}"),p.push("proto.get=function "+g+"_get("+y.join(",")+"){"),d?p.push("return this.data.get("+v+")}"):p.push("return this.data["+v+"]}"),p.push("proto.index=function "+g+"_index(",y.join(),"){return "+v+"}"),p.push("proto.hi=function "+g+"_hi("+y.join(",")+"){return new "+g+"(this.data,"+m.map(function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")}).join(",")+","+m.map(function(q){return"this.stride["+q+"]"}).join(",")+",this.offset)}");var O=m.map(function(q){return"a"+q+"=this.shape["+q+"]"}),S=m.map(function(q){return"c"+q+"=this.stride["+q+"]"});p.push("proto.lo=function "+g+"_lo("+y.join(",")+"){var b=this.offset,d=0,"+O.join(",")+","+S.join(","));for(var F=0;F<f;++F)p.push("if(typeof i"+F+"==='number'&&i"+F+">=0){d=i"+F+"|0;b+=c"+F+"*d;a"+F+"-=d}");for(p.push("return new "+g+"(this.data,"+m.map(function(q){return"a"+q}).join(",")+","+m.map(function(q){return"c"+q}).join(",")+",b)}"),p.push("proto.step=function "+g+"_step("+y.join(",")+"){var "+m.map(function(q){return"a"+q+"=this.shape["+q+"]"}).join(",")+","+m.map(function(q){return"b"+q+"=this.stride["+q+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),F=0;F<f;++F)p.push("if(typeof i"+F+"==='number'){d=i"+F+"|0;if(d<0){c+=b"+F+"*(a"+F+"-1);a"+F+"=ceil(-a"+F+"/d)}else{a"+F+"=ceil(a"+F+"/d)}b"+F+"*=d}");p.push("return new "+g+"(this.data,"+m.map(function(q){return"a"+q}).join(",")+","+m.map(function(q){return"b"+q}).join(",")+",c)}");var R=new Array(f),L=new Array(f);for(F=0;F<f;++F)R[F]="a[i"+F+"]",L[F]="b[i"+F+"]";for(p.push("proto.transpose=function "+g+"_transpose("+y+"){"+y.map(function(q,U){return q+"=("+q+"===undefined?"+U+":"+q+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+g+"(this.data,"+R.join(",")+","+L.join(",")+",this.offset)}"),p.push("proto.pick=function "+g+"_pick("+y+"){var a=[],b=[],c=this.offset"),F=0;F<f;++F)p.push("if(typeof i"+F+"==='number'&&i"+F+">=0){c=(c+this.stride["+F+"]*i"+F+")|0}else{a.push(this.shape["+F+"]);b.push(this.stride["+F+"])}");return p.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),p.push("return function construct_"+g+"(data,shape,stride,offset){return new "+g+"(data,"+m.map(function(q){return"shape["+q+"]"}).join(",")+","+m.map(function(q){return"stride["+q+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",p.join(`
`))(c[h],a)}var c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};n.exports=function(h,f,g,d){if(h===void 0)return(0,c.array[0])([]);typeof h=="number"&&(h=[h]),f===void 0&&(f=[h.length]);var p=f.length;if(g===void 0){g=new Array(p);for(var m=p-1,y=1;m>=0;--m)g[m]=y,y*=f[m]}if(d===void 0)for(d=0,m=0;m<p;++m)g[m]<0&&(d-=(f[m]-1)*g[m]);for(var v=function(T){if(o(T))return"buffer";if(s)switch(Object.prototype.toString.call(T)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(T)?"array":"generic"}(h),N=c[v];N.length<=p+1;)N.push(u(v,N.length-1));return(0,N[p+1])(h,f,g,d)}},function(n,t){n.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(n,t){(function(e){n.exports=e}).call(this,{})},function(n,t,e){"use strict";n.exports=f;var r,o=e(18),s=o.LongBits,i=o.base64,a=o.utf8;function u(N,T,O){this.fn=N,this.len=T,this.next=void 0,this.val=O}function c(){}function h(N){this.head=N.head,this.tail=N.tail,this.len=N.len,this.next=N.states}function f(){this.len=0,this.head=new u(c,0,0),this.tail=this.head,this.states=null}var g=function(){return o.Buffer?function(){return(f.create=function(){return new r})()}:function(){return new f}};function d(N,T,O){T[O]=255&N}function p(N,T){this.len=N,this.next=void 0,this.val=T}function m(N,T,O){for(;N.hi;)T[O++]=127&N.lo|128,N.lo=(N.lo>>>7|N.hi<<25)>>>0,N.hi>>>=7;for(;N.lo>127;)T[O++]=127&N.lo|128,N.lo=N.lo>>>7;T[O++]=N.lo}function y(N,T,O){T[O]=255&N,T[O+1]=N>>>8&255,T[O+2]=N>>>16&255,T[O+3]=N>>>24}f.create=g(),f.alloc=function(N){return new o.Array(N)},o.Array!==Array&&(f.alloc=o.pool(f.alloc,o.Array.prototype.subarray)),f.prototype._push=function(N,T,O){return this.tail=this.tail.next=new u(N,T,O),this.len+=T,this},p.prototype=Object.create(u.prototype),p.prototype.fn=function(N,T,O){for(;N>127;)T[O++]=127&N|128,N>>>=7;T[O]=N},f.prototype.uint32=function(N){return this.len+=(this.tail=this.tail.next=new p((N>>>=0)<128?1:N<16384?2:N<2097152?3:N<268435456?4:5,N)).len,this},f.prototype.int32=function(N){return N<0?this._push(m,10,s.fromNumber(N)):this.uint32(N)},f.prototype.sint32=function(N){return this.uint32((N<<1^N>>31)>>>0)},f.prototype.uint64=function(N){var T=s.from(N);return this._push(m,T.length(),T)},f.prototype.int64=f.prototype.uint64,f.prototype.sint64=function(N){var T=s.from(N).zzEncode();return this._push(m,T.length(),T)},f.prototype.bool=function(N){return this._push(d,1,N?1:0)},f.prototype.fixed32=function(N){return this._push(y,4,N>>>0)},f.prototype.sfixed32=f.prototype.fixed32,f.prototype.fixed64=function(N){var T=s.from(N);return this._push(y,4,T.lo)._push(y,4,T.hi)},f.prototype.sfixed64=f.prototype.fixed64,f.prototype.float=function(N){return this._push(o.float.writeFloatLE,4,N)},f.prototype.double=function(N){return this._push(o.float.writeDoubleLE,8,N)};var v=o.Array.prototype.set?function(N,T,O){T.set(N,O)}:function(N,T,O){for(var S=0;S<N.length;++S)T[O+S]=N[S]};f.prototype.bytes=function(N){var T=N.length>>>0;if(!T)return this._push(d,1,0);if(o.isString(N)){var O=f.alloc(T=i.length(N));i.decode(N,O,0),N=O}return this.uint32(T)._push(v,T,N)},f.prototype.string=function(N){var T=a.length(N);return T?this.uint32(T)._push(a.write,T,N):this._push(d,1,0)},f.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new u(c,0,0),this.len=0,this},f.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(c,0,0),this.len=0),this},f.prototype.ldelim=function(){var N=this.head,T=this.tail,O=this.len;return this.reset().uint32(O),O&&(this.tail.next=N.next,this.tail=T,this.len+=O),this},f.prototype.finish=function(){for(var N=this.head.next,T=this.constructor.alloc(this.len),O=0;N;)N.fn(N.val,T,O),O+=N.len,N=N.next;return T},f._configure=function(N){r=N,f.create=g(),r._configure()}},function(n,t,e){"use strict";n.exports=u;var r,o=e(18),s=o.LongBits,i=o.utf8;function a(m,y){return RangeError("index out of range: "+m.pos+" + "+(y||1)+" > "+m.len)}function u(m){this.buf=m,this.pos=0,this.len=m.length}var c,h=typeof Uint8Array<"u"?function(m){if(m instanceof Uint8Array||Array.isArray(m))return new u(m);throw Error("illegal buffer")}:function(m){if(Array.isArray(m))return new u(m);throw Error("illegal buffer")},f=function(){return o.Buffer?function(m){return(u.create=function(y){return o.Buffer.isBuffer(y)?new r(y):h(y)})(m)}:h};function g(){var m=new s(0,0),y=0;if(!(this.len-this.pos>4)){for(;y<3;++y){if(this.pos>=this.len)throw a(this);if(m.lo=(m.lo|(127&this.buf[this.pos])<<7*y)>>>0,this.buf[this.pos++]<128)return m}return m.lo=(m.lo|(127&this.buf[this.pos++])<<7*y)>>>0,m}for(;y<4;++y)if(m.lo=(m.lo|(127&this.buf[this.pos])<<7*y)>>>0,this.buf[this.pos++]<128)return m;if(m.lo=(m.lo|(127&this.buf[this.pos])<<28)>>>0,m.hi=(m.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return m;if(y=0,this.len-this.pos>4){for(;y<5;++y)if(m.hi=(m.hi|(127&this.buf[this.pos])<<7*y+3)>>>0,this.buf[this.pos++]<128)return m}else for(;y<5;++y){if(this.pos>=this.len)throw a(this);if(m.hi=(m.hi|(127&this.buf[this.pos])<<7*y+3)>>>0,this.buf[this.pos++]<128)return m}throw Error("invalid varint encoding")}function d(m,y){return(m[y-4]|m[y-3]<<8|m[y-2]<<16|m[y-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}u.create=f(),u.prototype._slice=o.Array.prototype.subarray||o.Array.prototype.slice,u.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return c;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return c}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var m=this.uint32();return m>>>1^-(1&m)|0},u.prototype.bool=function(){return this.uint32()!==0},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var m=o.float.readFloatLE(this.buf,this.pos);return this.pos+=4,m},u.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var m=o.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,m},u.prototype.bytes=function(){var m=this.uint32(),y=this.pos,v=this.pos+m;if(v>this.len)throw a(this,m);return this.pos+=m,Array.isArray(this.buf)?this.buf.slice(y,v):y===v?new this.buf.constructor(0):this._slice.call(this.buf,y,v)},u.prototype.string=function(){var m=this.bytes();return i.read(m,0,m.length)},u.prototype.skip=function(m){if(typeof m=="number"){if(this.pos+m>this.len)throw a(this,m);this.pos+=m}else do if(this.pos>=this.len)throw a(this);while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(m){switch(m){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(m=7&this.uint32())!=4;)this.skipType(m);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+m+" at offset "+this.pos)}return this},u._configure=function(m){r=m,u.create=f(),r._configure();var y=o.Long?"toLong":"toNumber";o.merge(u.prototype,{int64:function(){return g.call(this)[y](!1)},uint64:function(){return g.call(this)[y](!0)},sint64:function(){return g.call(this).zzDecode()[y](!1)},fixed64:function(){return p.call(this)[y](!0)},sfixed64:function(){return p.call(this)[y](!1)}})}},function(n,t,e){"use strict";var r,o,s=e(49),i=s.Reader,a=s.Writer,u=s.util,c=s.roots.default||(s.roots.default={});c.tensorflow=((o={}).magenta=((r={}).NoteSequence=function(){function h(d){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],d)for(var p=Object.keys(d),m=0;m<p.length;++m)d[p[m]]!=null&&(this[p[m]]=d[p[m]])}var f,g;return h.prototype.id="",h.prototype.filename="",h.prototype.referenceNumber=u.Long?u.Long.fromBits(0,0,!1):0,h.prototype.collectionName="",h.prototype.ticksPerQuarter=0,h.prototype.timeSignatures=u.emptyArray,h.prototype.keySignatures=u.emptyArray,h.prototype.tempos=u.emptyArray,h.prototype.notes=u.emptyArray,h.prototype.totalTime=0,h.prototype.totalQuantizedSteps=u.Long?u.Long.fromBits(0,0,!1):0,h.prototype.pitchBends=u.emptyArray,h.prototype.controlChanges=u.emptyArray,h.prototype.partInfos=u.emptyArray,h.prototype.sourceInfo=null,h.prototype.textAnnotations=u.emptyArray,h.prototype.sectionAnnotations=u.emptyArray,h.prototype.sectionGroups=u.emptyArray,h.prototype.quantizationInfo=null,h.prototype.subsequenceInfo=null,h.prototype.sequenceMetadata=null,h.create=function(d){return new h(d)},h.encode=function(d,p){if(p||(p=a.create()),d.id!=null&&d.hasOwnProperty("id")&&p.uint32(10).string(d.id),d.filename!=null&&d.hasOwnProperty("filename")&&p.uint32(18).string(d.filename),d.collectionName!=null&&d.hasOwnProperty("collectionName")&&p.uint32(26).string(d.collectionName),d.ticksPerQuarter!=null&&d.hasOwnProperty("ticksPerQuarter")&&p.uint32(32).int32(d.ticksPerQuarter),d.timeSignatures!=null&&d.timeSignatures.length)for(var m=0;m<d.timeSignatures.length;++m)c.tensorflow.magenta.NoteSequence.TimeSignature.encode(d.timeSignatures[m],p.uint32(42).fork()).ldelim();if(d.keySignatures!=null&&d.keySignatures.length)for(m=0;m<d.keySignatures.length;++m)c.tensorflow.magenta.NoteSequence.KeySignature.encode(d.keySignatures[m],p.uint32(50).fork()).ldelim();if(d.tempos!=null&&d.tempos.length)for(m=0;m<d.tempos.length;++m)c.tensorflow.magenta.NoteSequence.Tempo.encode(d.tempos[m],p.uint32(58).fork()).ldelim();if(d.notes!=null&&d.notes.length)for(m=0;m<d.notes.length;++m)c.tensorflow.magenta.NoteSequence.Note.encode(d.notes[m],p.uint32(66).fork()).ldelim();if(d.totalTime!=null&&d.hasOwnProperty("totalTime")&&p.uint32(73).double(d.totalTime),d.pitchBends!=null&&d.pitchBends.length)for(m=0;m<d.pitchBends.length;++m)c.tensorflow.magenta.NoteSequence.PitchBend.encode(d.pitchBends[m],p.uint32(82).fork()).ldelim();if(d.controlChanges!=null&&d.controlChanges.length)for(m=0;m<d.controlChanges.length;++m)c.tensorflow.magenta.NoteSequence.ControlChange.encode(d.controlChanges[m],p.uint32(90).fork()).ldelim();if(d.partInfos!=null&&d.partInfos.length)for(m=0;m<d.partInfos.length;++m)c.tensorflow.magenta.NoteSequence.PartInfo.encode(d.partInfos[m],p.uint32(98).fork()).ldelim();if(d.sourceInfo!=null&&d.hasOwnProperty("sourceInfo")&&c.tensorflow.magenta.NoteSequence.SourceInfo.encode(d.sourceInfo,p.uint32(106).fork()).ldelim(),d.textAnnotations!=null&&d.textAnnotations.length)for(m=0;m<d.textAnnotations.length;++m)c.tensorflow.magenta.NoteSequence.TextAnnotation.encode(d.textAnnotations[m],p.uint32(114).fork()).ldelim();if(d.quantizationInfo!=null&&d.hasOwnProperty("quantizationInfo")&&c.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(d.quantizationInfo,p.uint32(122).fork()).ldelim(),d.totalQuantizedSteps!=null&&d.hasOwnProperty("totalQuantizedSteps")&&p.uint32(128).int64(d.totalQuantizedSteps),d.subsequenceInfo!=null&&d.hasOwnProperty("subsequenceInfo")&&c.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(d.subsequenceInfo,p.uint32(138).fork()).ldelim(),d.referenceNumber!=null&&d.hasOwnProperty("referenceNumber")&&p.uint32(144).int64(d.referenceNumber),d.sequenceMetadata!=null&&d.hasOwnProperty("sequenceMetadata")&&c.tensorflow.magenta.SequenceMetadata.encode(d.sequenceMetadata,p.uint32(154).fork()).ldelim(),d.sectionAnnotations!=null&&d.sectionAnnotations.length)for(m=0;m<d.sectionAnnotations.length;++m)c.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(d.sectionAnnotations[m],p.uint32(162).fork()).ldelim();if(d.sectionGroups!=null&&d.sectionGroups.length)for(m=0;m<d.sectionGroups.length;++m)c.tensorflow.magenta.NoteSequence.SectionGroup.encode(d.sectionGroups[m],p.uint32(170).fork()).ldelim();return p},h.encodeDelimited=function(d,p){return this.encode(d,p).ldelim()},h.decode=function(d,p){d instanceof i||(d=i.create(d));for(var m=p===void 0?d.len:d.pos+p,y=new c.tensorflow.magenta.NoteSequence;d.pos<m;){var v=d.uint32();switch(v>>>3){case 1:y.id=d.string();break;case 2:y.filename=d.string();break;case 18:y.referenceNumber=u.Long?d.int64().toNumber():d.int64();break;case 3:y.collectionName=d.string();break;case 4:y.ticksPerQuarter=d.int32();break;case 5:y.timeSignatures&&y.timeSignatures.length||(y.timeSignatures=[]),y.timeSignatures.push(c.tensorflow.magenta.NoteSequence.TimeSignature.decode(d,d.uint32()));break;case 6:y.keySignatures&&y.keySignatures.length||(y.keySignatures=[]),y.keySignatures.push(c.tensorflow.magenta.NoteSequence.KeySignature.decode(d,d.uint32()));break;case 7:y.tempos&&y.tempos.length||(y.tempos=[]),y.tempos.push(c.tensorflow.magenta.NoteSequence.Tempo.decode(d,d.uint32()));break;case 8:y.notes&&y.notes.length||(y.notes=[]),y.notes.push(c.tensorflow.magenta.NoteSequence.Note.decode(d,d.uint32()));break;case 9:y.totalTime=d.double();break;case 16:y.totalQuantizedSteps=u.Long?d.int64().toNumber():d.int64();break;case 10:y.pitchBends&&y.pitchBends.length||(y.pitchBends=[]),y.pitchBends.push(c.tensorflow.magenta.NoteSequence.PitchBend.decode(d,d.uint32()));break;case 11:y.controlChanges&&y.controlChanges.length||(y.controlChanges=[]),y.controlChanges.push(c.tensorflow.magenta.NoteSequence.ControlChange.decode(d,d.uint32()));break;case 12:y.partInfos&&y.partInfos.length||(y.partInfos=[]),y.partInfos.push(c.tensorflow.magenta.NoteSequence.PartInfo.decode(d,d.uint32()));break;case 13:y.sourceInfo=c.tensorflow.magenta.NoteSequence.SourceInfo.decode(d,d.uint32());break;case 14:y.textAnnotations&&y.textAnnotations.length||(y.textAnnotations=[]),y.textAnnotations.push(c.tensorflow.magenta.NoteSequence.TextAnnotation.decode(d,d.uint32()));break;case 20:y.sectionAnnotations&&y.sectionAnnotations.length||(y.sectionAnnotations=[]),y.sectionAnnotations.push(c.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(d,d.uint32()));break;case 21:y.sectionGroups&&y.sectionGroups.length||(y.sectionGroups=[]),y.sectionGroups.push(c.tensorflow.magenta.NoteSequence.SectionGroup.decode(d,d.uint32()));break;case 15:y.quantizationInfo=c.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(d,d.uint32());break;case 17:y.subsequenceInfo=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(d,d.uint32());break;case 19:y.sequenceMetadata=c.tensorflow.magenta.SequenceMetadata.decode(d,d.uint32());break;default:d.skipType(7&v)}}return y},h.decodeDelimited=function(d){return d instanceof i||(d=new i(d)),this.decode(d,d.uint32())},h.verify=function(d){if(typeof d!="object"||d===null)return"object expected";if(d.id!=null&&d.hasOwnProperty("id")&&!u.isString(d.id))return"id: string expected";if(d.filename!=null&&d.hasOwnProperty("filename")&&!u.isString(d.filename))return"filename: string expected";if(d.referenceNumber!=null&&d.hasOwnProperty("referenceNumber")&&!(u.isInteger(d.referenceNumber)||d.referenceNumber&&u.isInteger(d.referenceNumber.low)&&u.isInteger(d.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(d.collectionName!=null&&d.hasOwnProperty("collectionName")&&!u.isString(d.collectionName))return"collectionName: string expected";if(d.ticksPerQuarter!=null&&d.hasOwnProperty("ticksPerQuarter")&&!u.isInteger(d.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(d.timeSignatures!=null&&d.hasOwnProperty("timeSignatures")){if(!Array.isArray(d.timeSignatures))return"timeSignatures: array expected";for(var p=0;p<d.timeSignatures.length;++p)if(m=c.tensorflow.magenta.NoteSequence.TimeSignature.verify(d.timeSignatures[p]))return"timeSignatures."+m}if(d.keySignatures!=null&&d.hasOwnProperty("keySignatures")){if(!Array.isArray(d.keySignatures))return"keySignatures: array expected";for(p=0;p<d.keySignatures.length;++p)if(m=c.tensorflow.magenta.NoteSequence.KeySignature.verify(d.keySignatures[p]))return"keySignatures."+m}if(d.tempos!=null&&d.hasOwnProperty("tempos")){if(!Array.isArray(d.tempos))return"tempos: array expected";for(p=0;p<d.tempos.length;++p)if(m=c.tensorflow.magenta.NoteSequence.Tempo.verify(d.tempos[p]))return"tempos."+m}if(d.notes!=null&&d.hasOwnProperty("notes")){if(!Array.isArray(d.notes))return"notes: array expected";for(p=0;p<d.notes.length;++p)if(m=c.tensorflow.magenta.NoteSequence.Note.verify(d.notes[p]))return"notes."+m}if(d.totalTime!=null&&d.hasOwnProperty("totalTime")&&typeof d.totalTime!="number")return"totalTime: number expected";if(d.totalQuantizedSteps!=null&&d.hasOwnProperty("totalQuantizedSteps")&&!(u.isInteger(d.totalQuantizedSteps)||d.totalQuantizedSteps&&u.isInteger(d.totalQuantizedSteps.low)&&u.isInteger(d.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(d.pitchBends!=null&&d.hasOwnProperty("pitchBends")){if(!Array.isArray(d.pitchBends))return"pitchBends: array expected";for(p=0;p<d.pitchBends.length;++p)if(m=c.tensorflow.magenta.NoteSequence.PitchBend.verify(d.pitchBends[p]))return"pitchBends."+m}if(d.controlChanges!=null&&d.hasOwnProperty("controlChanges")){if(!Array.isArray(d.controlChanges))return"controlChanges: array expected";for(p=0;p<d.controlChanges.length;++p)if(m=c.tensorflow.magenta.NoteSequence.ControlChange.verify(d.controlChanges[p]))return"controlChanges."+m}if(d.partInfos!=null&&d.hasOwnProperty("partInfos")){if(!Array.isArray(d.partInfos))return"partInfos: array expected";for(p=0;p<d.partInfos.length;++p)if(m=c.tensorflow.magenta.NoteSequence.PartInfo.verify(d.partInfos[p]))return"partInfos."+m}if(d.sourceInfo!=null&&d.hasOwnProperty("sourceInfo")&&(m=c.tensorflow.magenta.NoteSequence.SourceInfo.verify(d.sourceInfo)))return"sourceInfo."+m;if(d.textAnnotations!=null&&d.hasOwnProperty("textAnnotations")){if(!Array.isArray(d.textAnnotations))return"textAnnotations: array expected";for(p=0;p<d.textAnnotations.length;++p)if(m=c.tensorflow.magenta.NoteSequence.TextAnnotation.verify(d.textAnnotations[p]))return"textAnnotations."+m}if(d.sectionAnnotations!=null&&d.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(d.sectionAnnotations))return"sectionAnnotations: array expected";for(p=0;p<d.sectionAnnotations.length;++p)if(m=c.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(d.sectionAnnotations[p]))return"sectionAnnotations."+m}if(d.sectionGroups!=null&&d.hasOwnProperty("sectionGroups")){if(!Array.isArray(d.sectionGroups))return"sectionGroups: array expected";for(p=0;p<d.sectionGroups.length;++p){var m;if(m=c.tensorflow.magenta.NoteSequence.SectionGroup.verify(d.sectionGroups[p]))return"sectionGroups."+m}}return d.quantizationInfo!=null&&d.hasOwnProperty("quantizationInfo")&&(m=c.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(d.quantizationInfo))?"quantizationInfo."+m:d.subsequenceInfo!=null&&d.hasOwnProperty("subsequenceInfo")&&(m=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(d.subsequenceInfo))?"subsequenceInfo."+m:d.sequenceMetadata!=null&&d.hasOwnProperty("sequenceMetadata")&&(m=c.tensorflow.magenta.SequenceMetadata.verify(d.sequenceMetadata))?"sequenceMetadata."+m:null},h.fromObject=function(d){if(d instanceof c.tensorflow.magenta.NoteSequence)return d;var p=new c.tensorflow.magenta.NoteSequence;if(d.id!=null&&(p.id=String(d.id)),d.filename!=null&&(p.filename=String(d.filename)),d.referenceNumber!=null&&(u.Long?(p.referenceNumber=u.Long.fromValue(d.referenceNumber)).unsigned=!1:typeof d.referenceNumber=="string"?p.referenceNumber=parseInt(d.referenceNumber,10):typeof d.referenceNumber=="number"?p.referenceNumber=d.referenceNumber:typeof d.referenceNumber=="object"&&(p.referenceNumber=new u.LongBits(d.referenceNumber.low>>>0,d.referenceNumber.high>>>0).toNumber())),d.collectionName!=null&&(p.collectionName=String(d.collectionName)),d.ticksPerQuarter!=null&&(p.ticksPerQuarter=0|d.ticksPerQuarter),d.timeSignatures){if(!Array.isArray(d.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");p.timeSignatures=[];for(var m=0;m<d.timeSignatures.length;++m){if(typeof d.timeSignatures[m]!="object")throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");p.timeSignatures[m]=c.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(d.timeSignatures[m])}}if(d.keySignatures){if(!Array.isArray(d.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");for(p.keySignatures=[],m=0;m<d.keySignatures.length;++m){if(typeof d.keySignatures[m]!="object")throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");p.keySignatures[m]=c.tensorflow.magenta.NoteSequence.KeySignature.fromObject(d.keySignatures[m])}}if(d.tempos){if(!Array.isArray(d.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");for(p.tempos=[],m=0;m<d.tempos.length;++m){if(typeof d.tempos[m]!="object")throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");p.tempos[m]=c.tensorflow.magenta.NoteSequence.Tempo.fromObject(d.tempos[m])}}if(d.notes){if(!Array.isArray(d.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");for(p.notes=[],m=0;m<d.notes.length;++m){if(typeof d.notes[m]!="object")throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");p.notes[m]=c.tensorflow.magenta.NoteSequence.Note.fromObject(d.notes[m])}}if(d.totalTime!=null&&(p.totalTime=Number(d.totalTime)),d.totalQuantizedSteps!=null&&(u.Long?(p.totalQuantizedSteps=u.Long.fromValue(d.totalQuantizedSteps)).unsigned=!1:typeof d.totalQuantizedSteps=="string"?p.totalQuantizedSteps=parseInt(d.totalQuantizedSteps,10):typeof d.totalQuantizedSteps=="number"?p.totalQuantizedSteps=d.totalQuantizedSteps:typeof d.totalQuantizedSteps=="object"&&(p.totalQuantizedSteps=new u.LongBits(d.totalQuantizedSteps.low>>>0,d.totalQuantizedSteps.high>>>0).toNumber())),d.pitchBends){if(!Array.isArray(d.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");for(p.pitchBends=[],m=0;m<d.pitchBends.length;++m){if(typeof d.pitchBends[m]!="object")throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");p.pitchBends[m]=c.tensorflow.magenta.NoteSequence.PitchBend.fromObject(d.pitchBends[m])}}if(d.controlChanges){if(!Array.isArray(d.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");for(p.controlChanges=[],m=0;m<d.controlChanges.length;++m){if(typeof d.controlChanges[m]!="object")throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");p.controlChanges[m]=c.tensorflow.magenta.NoteSequence.ControlChange.fromObject(d.controlChanges[m])}}if(d.partInfos){if(!Array.isArray(d.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");for(p.partInfos=[],m=0;m<d.partInfos.length;++m){if(typeof d.partInfos[m]!="object")throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");p.partInfos[m]=c.tensorflow.magenta.NoteSequence.PartInfo.fromObject(d.partInfos[m])}}if(d.sourceInfo!=null){if(typeof d.sourceInfo!="object")throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");p.sourceInfo=c.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(d.sourceInfo)}if(d.textAnnotations){if(!Array.isArray(d.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");for(p.textAnnotations=[],m=0;m<d.textAnnotations.length;++m){if(typeof d.textAnnotations[m]!="object")throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");p.textAnnotations[m]=c.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(d.textAnnotations[m])}}if(d.sectionAnnotations){if(!Array.isArray(d.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");for(p.sectionAnnotations=[],m=0;m<d.sectionAnnotations.length;++m){if(typeof d.sectionAnnotations[m]!="object")throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");p.sectionAnnotations[m]=c.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(d.sectionAnnotations[m])}}if(d.sectionGroups){if(!Array.isArray(d.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");for(p.sectionGroups=[],m=0;m<d.sectionGroups.length;++m){if(typeof d.sectionGroups[m]!="object")throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");p.sectionGroups[m]=c.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(d.sectionGroups[m])}}if(d.quantizationInfo!=null){if(typeof d.quantizationInfo!="object")throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");p.quantizationInfo=c.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(d.quantizationInfo)}if(d.subsequenceInfo!=null){if(typeof d.subsequenceInfo!="object")throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");p.subsequenceInfo=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(d.subsequenceInfo)}if(d.sequenceMetadata!=null){if(typeof d.sequenceMetadata!="object")throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");p.sequenceMetadata=c.tensorflow.magenta.SequenceMetadata.fromObject(d.sequenceMetadata)}return p},h.toObject=function(d,p){p||(p={});var m={};if((p.arrays||p.defaults)&&(m.timeSignatures=[],m.keySignatures=[],m.tempos=[],m.notes=[],m.pitchBends=[],m.controlChanges=[],m.partInfos=[],m.textAnnotations=[],m.sectionAnnotations=[],m.sectionGroups=[]),p.defaults){if(m.id="",m.filename="",m.collectionName="",m.ticksPerQuarter=0,m.totalTime=0,m.sourceInfo=null,m.quantizationInfo=null,u.Long){var y=new u.Long(0,0,!1);m.totalQuantizedSteps=p.longs===String?y.toString():p.longs===Number?y.toNumber():y}else m.totalQuantizedSteps=p.longs===String?"0":0;m.subsequenceInfo=null,u.Long?(y=new u.Long(0,0,!1),m.referenceNumber=p.longs===String?y.toString():p.longs===Number?y.toNumber():y):m.referenceNumber=p.longs===String?"0":0,m.sequenceMetadata=null}if(d.id!=null&&d.hasOwnProperty("id")&&(m.id=d.id),d.filename!=null&&d.hasOwnProperty("filename")&&(m.filename=d.filename),d.collectionName!=null&&d.hasOwnProperty("collectionName")&&(m.collectionName=d.collectionName),d.ticksPerQuarter!=null&&d.hasOwnProperty("ticksPerQuarter")&&(m.ticksPerQuarter=d.ticksPerQuarter),d.timeSignatures&&d.timeSignatures.length){m.timeSignatures=[];for(var v=0;v<d.timeSignatures.length;++v)m.timeSignatures[v]=c.tensorflow.magenta.NoteSequence.TimeSignature.toObject(d.timeSignatures[v],p)}if(d.keySignatures&&d.keySignatures.length)for(m.keySignatures=[],v=0;v<d.keySignatures.length;++v)m.keySignatures[v]=c.tensorflow.magenta.NoteSequence.KeySignature.toObject(d.keySignatures[v],p);if(d.tempos&&d.tempos.length)for(m.tempos=[],v=0;v<d.tempos.length;++v)m.tempos[v]=c.tensorflow.magenta.NoteSequence.Tempo.toObject(d.tempos[v],p);if(d.notes&&d.notes.length)for(m.notes=[],v=0;v<d.notes.length;++v)m.notes[v]=c.tensorflow.magenta.NoteSequence.Note.toObject(d.notes[v],p);if(d.totalTime!=null&&d.hasOwnProperty("totalTime")&&(m.totalTime=p.json&&!isFinite(d.totalTime)?String(d.totalTime):d.totalTime),d.pitchBends&&d.pitchBends.length)for(m.pitchBends=[],v=0;v<d.pitchBends.length;++v)m.pitchBends[v]=c.tensorflow.magenta.NoteSequence.PitchBend.toObject(d.pitchBends[v],p);if(d.controlChanges&&d.controlChanges.length)for(m.controlChanges=[],v=0;v<d.controlChanges.length;++v)m.controlChanges[v]=c.tensorflow.magenta.NoteSequence.ControlChange.toObject(d.controlChanges[v],p);if(d.partInfos&&d.partInfos.length)for(m.partInfos=[],v=0;v<d.partInfos.length;++v)m.partInfos[v]=c.tensorflow.magenta.NoteSequence.PartInfo.toObject(d.partInfos[v],p);if(d.sourceInfo!=null&&d.hasOwnProperty("sourceInfo")&&(m.sourceInfo=c.tensorflow.magenta.NoteSequence.SourceInfo.toObject(d.sourceInfo,p)),d.textAnnotations&&d.textAnnotations.length)for(m.textAnnotations=[],v=0;v<d.textAnnotations.length;++v)m.textAnnotations[v]=c.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(d.textAnnotations[v],p);if(d.quantizationInfo!=null&&d.hasOwnProperty("quantizationInfo")&&(m.quantizationInfo=c.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(d.quantizationInfo,p)),d.totalQuantizedSteps!=null&&d.hasOwnProperty("totalQuantizedSteps")&&(typeof d.totalQuantizedSteps=="number"?m.totalQuantizedSteps=p.longs===String?String(d.totalQuantizedSteps):d.totalQuantizedSteps:m.totalQuantizedSteps=p.longs===String?u.Long.prototype.toString.call(d.totalQuantizedSteps):p.longs===Number?new u.LongBits(d.totalQuantizedSteps.low>>>0,d.totalQuantizedSteps.high>>>0).toNumber():d.totalQuantizedSteps),d.subsequenceInfo!=null&&d.hasOwnProperty("subsequenceInfo")&&(m.subsequenceInfo=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(d.subsequenceInfo,p)),d.referenceNumber!=null&&d.hasOwnProperty("referenceNumber")&&(typeof d.referenceNumber=="number"?m.referenceNumber=p.longs===String?String(d.referenceNumber):d.referenceNumber:m.referenceNumber=p.longs===String?u.Long.prototype.toString.call(d.referenceNumber):p.longs===Number?new u.LongBits(d.referenceNumber.low>>>0,d.referenceNumber.high>>>0).toNumber():d.referenceNumber),d.sequenceMetadata!=null&&d.hasOwnProperty("sequenceMetadata")&&(m.sequenceMetadata=c.tensorflow.magenta.SequenceMetadata.toObject(d.sequenceMetadata,p)),d.sectionAnnotations&&d.sectionAnnotations.length)for(m.sectionAnnotations=[],v=0;v<d.sectionAnnotations.length;++v)m.sectionAnnotations[v]=c.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(d.sectionAnnotations[v],p);if(d.sectionGroups&&d.sectionGroups.length)for(m.sectionGroups=[],v=0;v<d.sectionGroups.length;++v)m.sectionGroups[v]=c.tensorflow.magenta.NoteSequence.SectionGroup.toObject(d.sectionGroups[v],p);return m},h.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},h.Note=function(){function d(p){if(p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.pitch=0,d.prototype.pitchName=0,d.prototype.velocity=0,d.prototype.startTime=0,d.prototype.quantizedStartStep=u.Long?u.Long.fromBits(0,0,!1):0,d.prototype.endTime=0,d.prototype.quantizedEndStep=u.Long?u.Long.fromBits(0,0,!1):0,d.prototype.numerator=0,d.prototype.denominator=0,d.prototype.instrument=0,d.prototype.program=0,d.prototype.isDrum=!1,d.prototype.part=0,d.prototype.voice=0,d.create=function(p){return new d(p)},d.encode=function(p,m){return m||(m=a.create()),p.pitch!=null&&p.hasOwnProperty("pitch")&&m.uint32(8).int32(p.pitch),p.velocity!=null&&p.hasOwnProperty("velocity")&&m.uint32(16).int32(p.velocity),p.startTime!=null&&p.hasOwnProperty("startTime")&&m.uint32(25).double(p.startTime),p.endTime!=null&&p.hasOwnProperty("endTime")&&m.uint32(33).double(p.endTime),p.numerator!=null&&p.hasOwnProperty("numerator")&&m.uint32(40).int32(p.numerator),p.denominator!=null&&p.hasOwnProperty("denominator")&&m.uint32(48).int32(p.denominator),p.instrument!=null&&p.hasOwnProperty("instrument")&&m.uint32(56).int32(p.instrument),p.program!=null&&p.hasOwnProperty("program")&&m.uint32(64).int32(p.program),p.isDrum!=null&&p.hasOwnProperty("isDrum")&&m.uint32(72).bool(p.isDrum),p.part!=null&&p.hasOwnProperty("part")&&m.uint32(80).int32(p.part),p.pitchName!=null&&p.hasOwnProperty("pitchName")&&m.uint32(88).int32(p.pitchName),p.voice!=null&&p.hasOwnProperty("voice")&&m.uint32(96).int32(p.voice),p.quantizedStartStep!=null&&p.hasOwnProperty("quantizedStartStep")&&m.uint32(104).int64(p.quantizedStartStep),p.quantizedEndStep!=null&&p.hasOwnProperty("quantizedEndStep")&&m.uint32(112).int64(p.quantizedEndStep),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.Note;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.pitch=p.int32();break;case 11:v.pitchName=p.int32();break;case 2:v.velocity=p.int32();break;case 3:v.startTime=p.double();break;case 13:v.quantizedStartStep=u.Long?p.int64().toNumber():p.int64();break;case 4:v.endTime=p.double();break;case 14:v.quantizedEndStep=u.Long?p.int64().toNumber():p.int64();break;case 5:v.numerator=p.int32();break;case 6:v.denominator=p.int32();break;case 7:v.instrument=p.int32();break;case 8:v.program=p.int32();break;case 9:v.isDrum=p.bool();break;case 10:v.part=p.int32();break;case 12:v.voice=p.int32();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){if(typeof p!="object"||p===null)return"object expected";if(p.pitch!=null&&p.hasOwnProperty("pitch")&&!u.isInteger(p.pitch))return"pitch: integer expected";if(p.pitchName!=null&&p.hasOwnProperty("pitchName"))switch(p.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:}return p.velocity!=null&&p.hasOwnProperty("velocity")&&!u.isInteger(p.velocity)?"velocity: integer expected":p.startTime!=null&&p.hasOwnProperty("startTime")&&typeof p.startTime!="number"?"startTime: number expected":p.quantizedStartStep!=null&&p.hasOwnProperty("quantizedStartStep")&&!(u.isInteger(p.quantizedStartStep)||p.quantizedStartStep&&u.isInteger(p.quantizedStartStep.low)&&u.isInteger(p.quantizedStartStep.high))?"quantizedStartStep: integer|Long expected":p.endTime!=null&&p.hasOwnProperty("endTime")&&typeof p.endTime!="number"?"endTime: number expected":p.quantizedEndStep!=null&&p.hasOwnProperty("quantizedEndStep")&&!(u.isInteger(p.quantizedEndStep)||p.quantizedEndStep&&u.isInteger(p.quantizedEndStep.low)&&u.isInteger(p.quantizedEndStep.high))?"quantizedEndStep: integer|Long expected":p.numerator!=null&&p.hasOwnProperty("numerator")&&!u.isInteger(p.numerator)?"numerator: integer expected":p.denominator!=null&&p.hasOwnProperty("denominator")&&!u.isInteger(p.denominator)?"denominator: integer expected":p.instrument!=null&&p.hasOwnProperty("instrument")&&!u.isInteger(p.instrument)?"instrument: integer expected":p.program!=null&&p.hasOwnProperty("program")&&!u.isInteger(p.program)?"program: integer expected":p.isDrum!=null&&p.hasOwnProperty("isDrum")&&typeof p.isDrum!="boolean"?"isDrum: boolean expected":p.part!=null&&p.hasOwnProperty("part")&&!u.isInteger(p.part)?"part: integer expected":p.voice!=null&&p.hasOwnProperty("voice")&&!u.isInteger(p.voice)?"voice: integer expected":null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.Note)return p;var m=new c.tensorflow.magenta.NoteSequence.Note;switch(p.pitch!=null&&(m.pitch=0|p.pitch),p.pitchName){case"UNKNOWN_PITCH_NAME":case 0:m.pitchName=0;break;case"F_FLAT_FLAT":case 1:m.pitchName=1;break;case"C_FLAT_FLAT":case 2:m.pitchName=2;break;case"G_FLAT_FLAT":case 3:m.pitchName=3;break;case"D_FLAT_FLAT":case 4:m.pitchName=4;break;case"A_FLAT_FLAT":case 5:m.pitchName=5;break;case"E_FLAT_FLAT":case 6:m.pitchName=6;break;case"B_FLAT_FLAT":case 7:m.pitchName=7;break;case"F_FLAT":case 8:m.pitchName=8;break;case"C_FLAT":case 9:m.pitchName=9;break;case"G_FLAT":case 10:m.pitchName=10;break;case"D_FLAT":case 11:m.pitchName=11;break;case"A_FLAT":case 12:m.pitchName=12;break;case"E_FLAT":case 13:m.pitchName=13;break;case"B_FLAT":case 14:m.pitchName=14;break;case"F":case 15:m.pitchName=15;break;case"C":case 16:m.pitchName=16;break;case"G":case 17:m.pitchName=17;break;case"D":case 18:m.pitchName=18;break;case"A":case 19:m.pitchName=19;break;case"E":case 20:m.pitchName=20;break;case"B":case 21:m.pitchName=21;break;case"F_SHARP":case 22:m.pitchName=22;break;case"C_SHARP":case 23:m.pitchName=23;break;case"G_SHARP":case 24:m.pitchName=24;break;case"D_SHARP":case 25:m.pitchName=25;break;case"A_SHARP":case 26:m.pitchName=26;break;case"E_SHARP":case 27:m.pitchName=27;break;case"B_SHARP":case 28:m.pitchName=28;break;case"F_SHARP_SHARP":case 29:m.pitchName=29;break;case"C_SHARP_SHARP":case 30:m.pitchName=30;break;case"G_SHARP_SHARP":case 31:m.pitchName=31;break;case"D_SHARP_SHARP":case 32:m.pitchName=32;break;case"A_SHARP_SHARP":case 33:m.pitchName=33;break;case"E_SHARP_SHARP":case 34:m.pitchName=34;break;case"B_SHARP_SHARP":case 35:m.pitchName=35}return p.velocity!=null&&(m.velocity=0|p.velocity),p.startTime!=null&&(m.startTime=Number(p.startTime)),p.quantizedStartStep!=null&&(u.Long?(m.quantizedStartStep=u.Long.fromValue(p.quantizedStartStep)).unsigned=!1:typeof p.quantizedStartStep=="string"?m.quantizedStartStep=parseInt(p.quantizedStartStep,10):typeof p.quantizedStartStep=="number"?m.quantizedStartStep=p.quantizedStartStep:typeof p.quantizedStartStep=="object"&&(m.quantizedStartStep=new u.LongBits(p.quantizedStartStep.low>>>0,p.quantizedStartStep.high>>>0).toNumber())),p.endTime!=null&&(m.endTime=Number(p.endTime)),p.quantizedEndStep!=null&&(u.Long?(m.quantizedEndStep=u.Long.fromValue(p.quantizedEndStep)).unsigned=!1:typeof p.quantizedEndStep=="string"?m.quantizedEndStep=parseInt(p.quantizedEndStep,10):typeof p.quantizedEndStep=="number"?m.quantizedEndStep=p.quantizedEndStep:typeof p.quantizedEndStep=="object"&&(m.quantizedEndStep=new u.LongBits(p.quantizedEndStep.low>>>0,p.quantizedEndStep.high>>>0).toNumber())),p.numerator!=null&&(m.numerator=0|p.numerator),p.denominator!=null&&(m.denominator=0|p.denominator),p.instrument!=null&&(m.instrument=0|p.instrument),p.program!=null&&(m.program=0|p.program),p.isDrum!=null&&(m.isDrum=!!p.isDrum),p.part!=null&&(m.part=0|p.part),p.voice!=null&&(m.voice=0|p.voice),m},d.toObject=function(p,m){m||(m={});var y={};if(m.defaults){if(y.pitch=0,y.velocity=0,y.startTime=0,y.endTime=0,y.numerator=0,y.denominator=0,y.instrument=0,y.program=0,y.isDrum=!1,y.part=0,y.pitchName=m.enums===String?"UNKNOWN_PITCH_NAME":0,y.voice=0,u.Long){var v=new u.Long(0,0,!1);y.quantizedStartStep=m.longs===String?v.toString():m.longs===Number?v.toNumber():v}else y.quantizedStartStep=m.longs===String?"0":0;u.Long?(v=new u.Long(0,0,!1),y.quantizedEndStep=m.longs===String?v.toString():m.longs===Number?v.toNumber():v):y.quantizedEndStep=m.longs===String?"0":0}return p.pitch!=null&&p.hasOwnProperty("pitch")&&(y.pitch=p.pitch),p.velocity!=null&&p.hasOwnProperty("velocity")&&(y.velocity=p.velocity),p.startTime!=null&&p.hasOwnProperty("startTime")&&(y.startTime=m.json&&!isFinite(p.startTime)?String(p.startTime):p.startTime),p.endTime!=null&&p.hasOwnProperty("endTime")&&(y.endTime=m.json&&!isFinite(p.endTime)?String(p.endTime):p.endTime),p.numerator!=null&&p.hasOwnProperty("numerator")&&(y.numerator=p.numerator),p.denominator!=null&&p.hasOwnProperty("denominator")&&(y.denominator=p.denominator),p.instrument!=null&&p.hasOwnProperty("instrument")&&(y.instrument=p.instrument),p.program!=null&&p.hasOwnProperty("program")&&(y.program=p.program),p.isDrum!=null&&p.hasOwnProperty("isDrum")&&(y.isDrum=p.isDrum),p.part!=null&&p.hasOwnProperty("part")&&(y.part=p.part),p.pitchName!=null&&p.hasOwnProperty("pitchName")&&(y.pitchName=m.enums===String?c.tensorflow.magenta.NoteSequence.PitchName[p.pitchName]:p.pitchName),p.voice!=null&&p.hasOwnProperty("voice")&&(y.voice=p.voice),p.quantizedStartStep!=null&&p.hasOwnProperty("quantizedStartStep")&&(typeof p.quantizedStartStep=="number"?y.quantizedStartStep=m.longs===String?String(p.quantizedStartStep):p.quantizedStartStep:y.quantizedStartStep=m.longs===String?u.Long.prototype.toString.call(p.quantizedStartStep):m.longs===Number?new u.LongBits(p.quantizedStartStep.low>>>0,p.quantizedStartStep.high>>>0).toNumber():p.quantizedStartStep),p.quantizedEndStep!=null&&p.hasOwnProperty("quantizedEndStep")&&(typeof p.quantizedEndStep=="number"?y.quantizedEndStep=m.longs===String?String(p.quantizedEndStep):p.quantizedEndStep:y.quantizedEndStep=m.longs===String?u.Long.prototype.toString.call(p.quantizedEndStep):m.longs===Number?new u.LongBits(p.quantizedEndStep.low>>>0,p.quantizedEndStep.high>>>0).toNumber():p.quantizedEndStep),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d}(),h.PitchName=(f={},(g=Object.create(f))[f[0]="UNKNOWN_PITCH_NAME"]=0,g[f[1]="F_FLAT_FLAT"]=1,g[f[2]="C_FLAT_FLAT"]=2,g[f[3]="G_FLAT_FLAT"]=3,g[f[4]="D_FLAT_FLAT"]=4,g[f[5]="A_FLAT_FLAT"]=5,g[f[6]="E_FLAT_FLAT"]=6,g[f[7]="B_FLAT_FLAT"]=7,g[f[8]="F_FLAT"]=8,g[f[9]="C_FLAT"]=9,g[f[10]="G_FLAT"]=10,g[f[11]="D_FLAT"]=11,g[f[12]="A_FLAT"]=12,g[f[13]="E_FLAT"]=13,g[f[14]="B_FLAT"]=14,g[f[15]="F"]=15,g[f[16]="C"]=16,g[f[17]="G"]=17,g[f[18]="D"]=18,g[f[19]="A"]=19,g[f[20]="E"]=20,g[f[21]="B"]=21,g[f[22]="F_SHARP"]=22,g[f[23]="C_SHARP"]=23,g[f[24]="G_SHARP"]=24,g[f[25]="D_SHARP"]=25,g[f[26]="A_SHARP"]=26,g[f[27]="E_SHARP"]=27,g[f[28]="B_SHARP"]=28,g[f[29]="F_SHARP_SHARP"]=29,g[f[30]="C_SHARP_SHARP"]=30,g[f[31]="G_SHARP_SHARP"]=31,g[f[32]="D_SHARP_SHARP"]=32,g[f[33]="A_SHARP_SHARP"]=33,g[f[34]="E_SHARP_SHARP"]=34,g[f[35]="B_SHARP_SHARP"]=35,g),h.TimeSignature=function(){function d(p){if(p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.time=0,d.prototype.numerator=0,d.prototype.denominator=0,d.create=function(p){return new d(p)},d.encode=function(p,m){return m||(m=a.create()),p.time!=null&&p.hasOwnProperty("time")&&m.uint32(9).double(p.time),p.numerator!=null&&p.hasOwnProperty("numerator")&&m.uint32(16).int32(p.numerator),p.denominator!=null&&p.hasOwnProperty("denominator")&&m.uint32(24).int32(p.denominator),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.TimeSignature;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.time=p.double();break;case 2:v.numerator=p.int32();break;case 3:v.denominator=p.int32();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){return typeof p!="object"||p===null?"object expected":p.time!=null&&p.hasOwnProperty("time")&&typeof p.time!="number"?"time: number expected":p.numerator!=null&&p.hasOwnProperty("numerator")&&!u.isInteger(p.numerator)?"numerator: integer expected":p.denominator!=null&&p.hasOwnProperty("denominator")&&!u.isInteger(p.denominator)?"denominator: integer expected":null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.TimeSignature)return p;var m=new c.tensorflow.magenta.NoteSequence.TimeSignature;return p.time!=null&&(m.time=Number(p.time)),p.numerator!=null&&(m.numerator=0|p.numerator),p.denominator!=null&&(m.denominator=0|p.denominator),m},d.toObject=function(p,m){m||(m={});var y={};return m.defaults&&(y.time=0,y.numerator=0,y.denominator=0),p.time!=null&&p.hasOwnProperty("time")&&(y.time=m.json&&!isFinite(p.time)?String(p.time):p.time),p.numerator!=null&&p.hasOwnProperty("numerator")&&(y.numerator=p.numerator),p.denominator!=null&&p.hasOwnProperty("denominator")&&(y.denominator=p.denominator),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d}(),h.KeySignature=function(){function d(p){if(p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.time=0,d.prototype.key=0,d.prototype.mode=0,d.create=function(p){return new d(p)},d.encode=function(p,m){return m||(m=a.create()),p.time!=null&&p.hasOwnProperty("time")&&m.uint32(9).double(p.time),p.key!=null&&p.hasOwnProperty("key")&&m.uint32(16).int32(p.key),p.mode!=null&&p.hasOwnProperty("mode")&&m.uint32(24).int32(p.mode),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.KeySignature;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.time=p.double();break;case 2:v.key=p.int32();break;case 3:v.mode=p.int32();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){if(typeof p!="object"||p===null)return"object expected";if(p.time!=null&&p.hasOwnProperty("time")&&typeof p.time!="number")return"time: number expected";if(p.key!=null&&p.hasOwnProperty("key"))switch(p.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:}if(p.mode!=null&&p.hasOwnProperty("mode"))switch(p.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.KeySignature)return p;var m=new c.tensorflow.magenta.NoteSequence.KeySignature;switch(p.time!=null&&(m.time=Number(p.time)),p.key){case"C":case 0:m.key=0;break;case"C_SHARP":case 1:m.key=1;break;case"D_FLAT":case 1:m.key=1;break;case"D":case 2:m.key=2;break;case"D_SHARP":case 3:m.key=3;break;case"E_FLAT":case 3:m.key=3;break;case"E":case 4:m.key=4;break;case"F":case 5:m.key=5;break;case"F_SHARP":case 6:m.key=6;break;case"G_FLAT":case 6:m.key=6;break;case"G":case 7:m.key=7;break;case"G_SHARP":case 8:m.key=8;break;case"A_FLAT":case 8:m.key=8;break;case"A":case 9:m.key=9;break;case"A_SHARP":case 10:m.key=10;break;case"B_FLAT":case 10:m.key=10;break;case"B":case 11:m.key=11}switch(p.mode){case"MAJOR":case 0:m.mode=0;break;case"MINOR":case 1:m.mode=1;break;case"NOT_SPECIFIED":case 2:m.mode=2;break;case"MIXOLYDIAN":case 3:m.mode=3;break;case"DORIAN":case 4:m.mode=4;break;case"PHRYGIAN":case 5:m.mode=5;break;case"LYDIAN":case 6:m.mode=6;break;case"LOCRIAN":case 7:m.mode=7}return m},d.toObject=function(p,m){m||(m={});var y={};return m.defaults&&(y.time=0,y.key=m.enums===String?"C":0,y.mode=m.enums===String?"MAJOR":0),p.time!=null&&p.hasOwnProperty("time")&&(y.time=m.json&&!isFinite(p.time)?String(p.time):p.time),p.key!=null&&p.hasOwnProperty("key")&&(y.key=m.enums===String?c.tensorflow.magenta.NoteSequence.KeySignature.Key[p.key]:p.key),p.mode!=null&&p.hasOwnProperty("mode")&&(y.mode=m.enums===String?c.tensorflow.magenta.NoteSequence.KeySignature.Mode[p.mode]:p.mode),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d.Key=function(){var p={},m=Object.create(p);return m[p[0]="C"]=0,m[p[1]="C_SHARP"]=1,m.D_FLAT=1,m[p[2]="D"]=2,m[p[3]="D_SHARP"]=3,m.E_FLAT=3,m[p[4]="E"]=4,m[p[5]="F"]=5,m[p[6]="F_SHARP"]=6,m.G_FLAT=6,m[p[7]="G"]=7,m[p[8]="G_SHARP"]=8,m.A_FLAT=8,m[p[9]="A"]=9,m[p[10]="A_SHARP"]=10,m.B_FLAT=10,m[p[11]="B"]=11,m}(),d.Mode=function(){var p={},m=Object.create(p);return m[p[0]="MAJOR"]=0,m[p[1]="MINOR"]=1,m[p[2]="NOT_SPECIFIED"]=2,m[p[3]="MIXOLYDIAN"]=3,m[p[4]="DORIAN"]=4,m[p[5]="PHRYGIAN"]=5,m[p[6]="LYDIAN"]=6,m[p[7]="LOCRIAN"]=7,m}(),d}(),h.Tempo=function(){function d(p){if(p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.time=0,d.prototype.qpm=0,d.create=function(p){return new d(p)},d.encode=function(p,m){return m||(m=a.create()),p.time!=null&&p.hasOwnProperty("time")&&m.uint32(9).double(p.time),p.qpm!=null&&p.hasOwnProperty("qpm")&&m.uint32(17).double(p.qpm),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.Tempo;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.time=p.double();break;case 2:v.qpm=p.double();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){return typeof p!="object"||p===null?"object expected":p.time!=null&&p.hasOwnProperty("time")&&typeof p.time!="number"?"time: number expected":p.qpm!=null&&p.hasOwnProperty("qpm")&&typeof p.qpm!="number"?"qpm: number expected":null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.Tempo)return p;var m=new c.tensorflow.magenta.NoteSequence.Tempo;return p.time!=null&&(m.time=Number(p.time)),p.qpm!=null&&(m.qpm=Number(p.qpm)),m},d.toObject=function(p,m){m||(m={});var y={};return m.defaults&&(y.time=0,y.qpm=0),p.time!=null&&p.hasOwnProperty("time")&&(y.time=m.json&&!isFinite(p.time)?String(p.time):p.time),p.qpm!=null&&p.hasOwnProperty("qpm")&&(y.qpm=m.json&&!isFinite(p.qpm)?String(p.qpm):p.qpm),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d}(),h.PitchBend=function(){function d(p){if(p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.time=0,d.prototype.bend=0,d.prototype.instrument=0,d.prototype.program=0,d.prototype.isDrum=!1,d.create=function(p){return new d(p)},d.encode=function(p,m){return m||(m=a.create()),p.time!=null&&p.hasOwnProperty("time")&&m.uint32(9).double(p.time),p.bend!=null&&p.hasOwnProperty("bend")&&m.uint32(16).int32(p.bend),p.instrument!=null&&p.hasOwnProperty("instrument")&&m.uint32(24).int32(p.instrument),p.program!=null&&p.hasOwnProperty("program")&&m.uint32(32).int32(p.program),p.isDrum!=null&&p.hasOwnProperty("isDrum")&&m.uint32(40).bool(p.isDrum),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.PitchBend;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.time=p.double();break;case 2:v.bend=p.int32();break;case 3:v.instrument=p.int32();break;case 4:v.program=p.int32();break;case 5:v.isDrum=p.bool();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){return typeof p!="object"||p===null?"object expected":p.time!=null&&p.hasOwnProperty("time")&&typeof p.time!="number"?"time: number expected":p.bend!=null&&p.hasOwnProperty("bend")&&!u.isInteger(p.bend)?"bend: integer expected":p.instrument!=null&&p.hasOwnProperty("instrument")&&!u.isInteger(p.instrument)?"instrument: integer expected":p.program!=null&&p.hasOwnProperty("program")&&!u.isInteger(p.program)?"program: integer expected":p.isDrum!=null&&p.hasOwnProperty("isDrum")&&typeof p.isDrum!="boolean"?"isDrum: boolean expected":null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.PitchBend)return p;var m=new c.tensorflow.magenta.NoteSequence.PitchBend;return p.time!=null&&(m.time=Number(p.time)),p.bend!=null&&(m.bend=0|p.bend),p.instrument!=null&&(m.instrument=0|p.instrument),p.program!=null&&(m.program=0|p.program),p.isDrum!=null&&(m.isDrum=!!p.isDrum),m},d.toObject=function(p,m){m||(m={});var y={};return m.defaults&&(y.time=0,y.bend=0,y.instrument=0,y.program=0,y.isDrum=!1),p.time!=null&&p.hasOwnProperty("time")&&(y.time=m.json&&!isFinite(p.time)?String(p.time):p.time),p.bend!=null&&p.hasOwnProperty("bend")&&(y.bend=p.bend),p.instrument!=null&&p.hasOwnProperty("instrument")&&(y.instrument=p.instrument),p.program!=null&&p.hasOwnProperty("program")&&(y.program=p.program),p.isDrum!=null&&p.hasOwnProperty("isDrum")&&(y.isDrum=p.isDrum),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d}(),h.ControlChange=function(){function d(p){if(p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.time=0,d.prototype.quantizedStep=u.Long?u.Long.fromBits(0,0,!1):0,d.prototype.controlNumber=0,d.prototype.controlValue=0,d.prototype.instrument=0,d.prototype.program=0,d.prototype.isDrum=!1,d.create=function(p){return new d(p)},d.encode=function(p,m){return m||(m=a.create()),p.time!=null&&p.hasOwnProperty("time")&&m.uint32(9).double(p.time),p.controlNumber!=null&&p.hasOwnProperty("controlNumber")&&m.uint32(16).int32(p.controlNumber),p.controlValue!=null&&p.hasOwnProperty("controlValue")&&m.uint32(24).int32(p.controlValue),p.instrument!=null&&p.hasOwnProperty("instrument")&&m.uint32(32).int32(p.instrument),p.program!=null&&p.hasOwnProperty("program")&&m.uint32(40).int32(p.program),p.isDrum!=null&&p.hasOwnProperty("isDrum")&&m.uint32(48).bool(p.isDrum),p.quantizedStep!=null&&p.hasOwnProperty("quantizedStep")&&m.uint32(56).int64(p.quantizedStep),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.ControlChange;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.time=p.double();break;case 7:v.quantizedStep=u.Long?p.int64().toNumber():p.int64();break;case 2:v.controlNumber=p.int32();break;case 3:v.controlValue=p.int32();break;case 4:v.instrument=p.int32();break;case 5:v.program=p.int32();break;case 6:v.isDrum=p.bool();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){return typeof p!="object"||p===null?"object expected":p.time!=null&&p.hasOwnProperty("time")&&typeof p.time!="number"?"time: number expected":p.quantizedStep!=null&&p.hasOwnProperty("quantizedStep")&&!(u.isInteger(p.quantizedStep)||p.quantizedStep&&u.isInteger(p.quantizedStep.low)&&u.isInteger(p.quantizedStep.high))?"quantizedStep: integer|Long expected":p.controlNumber!=null&&p.hasOwnProperty("controlNumber")&&!u.isInteger(p.controlNumber)?"controlNumber: integer expected":p.controlValue!=null&&p.hasOwnProperty("controlValue")&&!u.isInteger(p.controlValue)?"controlValue: integer expected":p.instrument!=null&&p.hasOwnProperty("instrument")&&!u.isInteger(p.instrument)?"instrument: integer expected":p.program!=null&&p.hasOwnProperty("program")&&!u.isInteger(p.program)?"program: integer expected":p.isDrum!=null&&p.hasOwnProperty("isDrum")&&typeof p.isDrum!="boolean"?"isDrum: boolean expected":null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.ControlChange)return p;var m=new c.tensorflow.magenta.NoteSequence.ControlChange;return p.time!=null&&(m.time=Number(p.time)),p.quantizedStep!=null&&(u.Long?(m.quantizedStep=u.Long.fromValue(p.quantizedStep)).unsigned=!1:typeof p.quantizedStep=="string"?m.quantizedStep=parseInt(p.quantizedStep,10):typeof p.quantizedStep=="number"?m.quantizedStep=p.quantizedStep:typeof p.quantizedStep=="object"&&(m.quantizedStep=new u.LongBits(p.quantizedStep.low>>>0,p.quantizedStep.high>>>0).toNumber())),p.controlNumber!=null&&(m.controlNumber=0|p.controlNumber),p.controlValue!=null&&(m.controlValue=0|p.controlValue),p.instrument!=null&&(m.instrument=0|p.instrument),p.program!=null&&(m.program=0|p.program),p.isDrum!=null&&(m.isDrum=!!p.isDrum),m},d.toObject=function(p,m){m||(m={});var y={};if(m.defaults)if(y.time=0,y.controlNumber=0,y.controlValue=0,y.instrument=0,y.program=0,y.isDrum=!1,u.Long){var v=new u.Long(0,0,!1);y.quantizedStep=m.longs===String?v.toString():m.longs===Number?v.toNumber():v}else y.quantizedStep=m.longs===String?"0":0;return p.time!=null&&p.hasOwnProperty("time")&&(y.time=m.json&&!isFinite(p.time)?String(p.time):p.time),p.controlNumber!=null&&p.hasOwnProperty("controlNumber")&&(y.controlNumber=p.controlNumber),p.controlValue!=null&&p.hasOwnProperty("controlValue")&&(y.controlValue=p.controlValue),p.instrument!=null&&p.hasOwnProperty("instrument")&&(y.instrument=p.instrument),p.program!=null&&p.hasOwnProperty("program")&&(y.program=p.program),p.isDrum!=null&&p.hasOwnProperty("isDrum")&&(y.isDrum=p.isDrum),p.quantizedStep!=null&&p.hasOwnProperty("quantizedStep")&&(typeof p.quantizedStep=="number"?y.quantizedStep=m.longs===String?String(p.quantizedStep):p.quantizedStep:y.quantizedStep=m.longs===String?u.Long.prototype.toString.call(p.quantizedStep):m.longs===Number?new u.LongBits(p.quantizedStep.low>>>0,p.quantizedStep.high>>>0).toNumber():p.quantizedStep),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d}(),h.PartInfo=function(){function d(p){if(p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.part=0,d.prototype.name="",d.create=function(p){return new d(p)},d.encode=function(p,m){return m||(m=a.create()),p.part!=null&&p.hasOwnProperty("part")&&m.uint32(8).int32(p.part),p.name!=null&&p.hasOwnProperty("name")&&m.uint32(18).string(p.name),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.PartInfo;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.part=p.int32();break;case 2:v.name=p.string();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){return typeof p!="object"||p===null?"object expected":p.part!=null&&p.hasOwnProperty("part")&&!u.isInteger(p.part)?"part: integer expected":p.name!=null&&p.hasOwnProperty("name")&&!u.isString(p.name)?"name: string expected":null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.PartInfo)return p;var m=new c.tensorflow.magenta.NoteSequence.PartInfo;return p.part!=null&&(m.part=0|p.part),p.name!=null&&(m.name=String(p.name)),m},d.toObject=function(p,m){m||(m={});var y={};return m.defaults&&(y.part=0,y.name=""),p.part!=null&&p.hasOwnProperty("part")&&(y.part=p.part),p.name!=null&&p.hasOwnProperty("name")&&(y.name=p.name),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d}(),h.SourceInfo=function(){function d(p){if(p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.sourceType=0,d.prototype.encodingType=0,d.prototype.parser=0,d.create=function(p){return new d(p)},d.encode=function(p,m){return m||(m=a.create()),p.sourceType!=null&&p.hasOwnProperty("sourceType")&&m.uint32(8).int32(p.sourceType),p.encodingType!=null&&p.hasOwnProperty("encodingType")&&m.uint32(16).int32(p.encodingType),p.parser!=null&&p.hasOwnProperty("parser")&&m.uint32(24).int32(p.parser),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.SourceInfo;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.sourceType=p.int32();break;case 2:v.encodingType=p.int32();break;case 3:v.parser=p.int32();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){if(typeof p!="object"||p===null)return"object expected";if(p.sourceType!=null&&p.hasOwnProperty("sourceType"))switch(p.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:}if(p.encodingType!=null&&p.hasOwnProperty("encodingType"))switch(p.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(p.parser!=null&&p.hasOwnProperty("parser"))switch(p.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:}return null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.SourceInfo)return p;var m=new c.tensorflow.magenta.NoteSequence.SourceInfo;switch(p.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:m.sourceType=0;break;case"SCORE_BASED":case 1:m.sourceType=1;break;case"PERFORMANCE_BASED":case 2:m.sourceType=2}switch(p.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:m.encodingType=0;break;case"MUSIC_XML":case 1:m.encodingType=1;break;case"ABC":case 2:m.encodingType=2;break;case"MIDI":case 3:m.encodingType=3;break;case"MUSICNET":case 4:m.encodingType=4}switch(p.parser){case"UNKNOWN_PARSER":case 0:m.parser=0;break;case"MUSIC21":case 1:m.parser=1;break;case"PRETTY_MIDI":case 2:m.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:m.parser=3;break;case"MAGENTA_MUSICNET":case 4:m.parser=4;break;case"MAGENTA_ABC":case 5:m.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:m.parser=6}return m},d.toObject=function(p,m){m||(m={});var y={};return m.defaults&&(y.sourceType=m.enums===String?"UNKNOWN_SOURCE_TYPE":0,y.encodingType=m.enums===String?"UNKNOWN_ENCODING_TYPE":0,y.parser=m.enums===String?"UNKNOWN_PARSER":0),p.sourceType!=null&&p.hasOwnProperty("sourceType")&&(y.sourceType=m.enums===String?c.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[p.sourceType]:p.sourceType),p.encodingType!=null&&p.hasOwnProperty("encodingType")&&(y.encodingType=m.enums===String?c.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[p.encodingType]:p.encodingType),p.parser!=null&&p.hasOwnProperty("parser")&&(y.parser=m.enums===String?c.tensorflow.magenta.NoteSequence.SourceInfo.Parser[p.parser]:p.parser),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d.SourceType=function(){var p={},m=Object.create(p);return m[p[0]="UNKNOWN_SOURCE_TYPE"]=0,m[p[1]="SCORE_BASED"]=1,m[p[2]="PERFORMANCE_BASED"]=2,m}(),d.EncodingType=function(){var p={},m=Object.create(p);return m[p[0]="UNKNOWN_ENCODING_TYPE"]=0,m[p[1]="MUSIC_XML"]=1,m[p[2]="ABC"]=2,m[p[3]="MIDI"]=3,m[p[4]="MUSICNET"]=4,m}(),d.Parser=function(){var p={},m=Object.create(p);return m[p[0]="UNKNOWN_PARSER"]=0,m[p[1]="MUSIC21"]=1,m[p[2]="PRETTY_MIDI"]=2,m[p[3]="MAGENTA_MUSIC_XML"]=3,m[p[4]="MAGENTA_MUSICNET"]=4,m[p[5]="MAGENTA_ABC"]=5,m[p[6]="TONEJS_MIDI_CONVERT"]=6,m}(),d}(),h.TextAnnotation=function(){function d(p){if(p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.time=0,d.prototype.quantizedStep=u.Long?u.Long.fromBits(0,0,!1):0,d.prototype.text="",d.prototype.annotationType=0,d.create=function(p){return new d(p)},d.encode=function(p,m){return m||(m=a.create()),p.time!=null&&p.hasOwnProperty("time")&&m.uint32(9).double(p.time),p.text!=null&&p.hasOwnProperty("text")&&m.uint32(18).string(p.text),p.annotationType!=null&&p.hasOwnProperty("annotationType")&&m.uint32(24).int32(p.annotationType),p.quantizedStep!=null&&p.hasOwnProperty("quantizedStep")&&m.uint32(32).int64(p.quantizedStep),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.TextAnnotation;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.time=p.double();break;case 4:v.quantizedStep=u.Long?p.int64().toNumber():p.int64();break;case 2:v.text=p.string();break;case 3:v.annotationType=p.int32();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){if(typeof p!="object"||p===null)return"object expected";if(p.time!=null&&p.hasOwnProperty("time")&&typeof p.time!="number")return"time: number expected";if(p.quantizedStep!=null&&p.hasOwnProperty("quantizedStep")&&!(u.isInteger(p.quantizedStep)||p.quantizedStep&&u.isInteger(p.quantizedStep.low)&&u.isInteger(p.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(p.text!=null&&p.hasOwnProperty("text")&&!u.isString(p.text))return"text: string expected";if(p.annotationType!=null&&p.hasOwnProperty("annotationType"))switch(p.annotationType){default:return"annotationType: enum value expected";case 0:case 1:case 2:}return null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.TextAnnotation)return p;var m=new c.tensorflow.magenta.NoteSequence.TextAnnotation;switch(p.time!=null&&(m.time=Number(p.time)),p.quantizedStep!=null&&(u.Long?(m.quantizedStep=u.Long.fromValue(p.quantizedStep)).unsigned=!1:typeof p.quantizedStep=="string"?m.quantizedStep=parseInt(p.quantizedStep,10):typeof p.quantizedStep=="number"?m.quantizedStep=p.quantizedStep:typeof p.quantizedStep=="object"&&(m.quantizedStep=new u.LongBits(p.quantizedStep.low>>>0,p.quantizedStep.high>>>0).toNumber())),p.text!=null&&(m.text=String(p.text)),p.annotationType){case"UNKNOWN":case 0:m.annotationType=0;break;case"CHORD_SYMBOL":case 1:m.annotationType=1;break;case"BEAT":case 2:m.annotationType=2}return m},d.toObject=function(p,m){m||(m={});var y={};if(m.defaults)if(y.time=0,y.text="",y.annotationType=m.enums===String?"UNKNOWN":0,u.Long){var v=new u.Long(0,0,!1);y.quantizedStep=m.longs===String?v.toString():m.longs===Number?v.toNumber():v}else y.quantizedStep=m.longs===String?"0":0;return p.time!=null&&p.hasOwnProperty("time")&&(y.time=m.json&&!isFinite(p.time)?String(p.time):p.time),p.text!=null&&p.hasOwnProperty("text")&&(y.text=p.text),p.annotationType!=null&&p.hasOwnProperty("annotationType")&&(y.annotationType=m.enums===String?c.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[p.annotationType]:p.annotationType),p.quantizedStep!=null&&p.hasOwnProperty("quantizedStep")&&(typeof p.quantizedStep=="number"?y.quantizedStep=m.longs===String?String(p.quantizedStep):p.quantizedStep:y.quantizedStep=m.longs===String?u.Long.prototype.toString.call(p.quantizedStep):m.longs===Number?new u.LongBits(p.quantizedStep.low>>>0,p.quantizedStep.high>>>0).toNumber():p.quantizedStep),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d.TextAnnotationType=function(){var p={},m=Object.create(p);return m[p[0]="UNKNOWN"]=0,m[p[1]="CHORD_SYMBOL"]=1,m[p[2]="BEAT"]=2,m}(),d}(),h.QuantizationInfo=function(){function d(m){if(m)for(var y=Object.keys(m),v=0;v<y.length;++v)m[y[v]]!=null&&(this[y[v]]=m[y[v]])}var p;return d.prototype.stepsPerQuarter=0,d.prototype.stepsPerSecond=0,Object.defineProperty(d.prototype,"resolution",{get:u.oneOfGetter(p=["stepsPerQuarter","stepsPerSecond"]),set:u.oneOfSetter(p)}),d.create=function(m){return new d(m)},d.encode=function(m,y){return y||(y=a.create()),m.stepsPerQuarter!=null&&m.hasOwnProperty("stepsPerQuarter")&&y.uint32(8).int32(m.stepsPerQuarter),m.stepsPerSecond!=null&&m.hasOwnProperty("stepsPerSecond")&&y.uint32(16).int32(m.stepsPerSecond),y},d.encodeDelimited=function(m,y){return this.encode(m,y).ldelim()},d.decode=function(m,y){m instanceof i||(m=i.create(m));for(var v=y===void 0?m.len:m.pos+y,N=new c.tensorflow.magenta.NoteSequence.QuantizationInfo;m.pos<v;){var T=m.uint32();switch(T>>>3){case 1:N.stepsPerQuarter=m.int32();break;case 2:N.stepsPerSecond=m.int32();break;default:m.skipType(7&T)}}return N},d.decodeDelimited=function(m){return m instanceof i||(m=new i(m)),this.decode(m,m.uint32())},d.verify=function(m){if(typeof m!="object"||m===null)return"object expected";var y={};if(m.stepsPerQuarter!=null&&m.hasOwnProperty("stepsPerQuarter")&&(y.resolution=1,!u.isInteger(m.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(m.stepsPerSecond!=null&&m.hasOwnProperty("stepsPerSecond")){if(y.resolution===1)return"resolution: multiple values";if(y.resolution=1,!u.isInteger(m.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},d.fromObject=function(m){if(m instanceof c.tensorflow.magenta.NoteSequence.QuantizationInfo)return m;var y=new c.tensorflow.magenta.NoteSequence.QuantizationInfo;return m.stepsPerQuarter!=null&&(y.stepsPerQuarter=0|m.stepsPerQuarter),m.stepsPerSecond!=null&&(y.stepsPerSecond=0|m.stepsPerSecond),y},d.toObject=function(m,y){y||(y={});var v={};return m.stepsPerQuarter!=null&&m.hasOwnProperty("stepsPerQuarter")&&(v.stepsPerQuarter=m.stepsPerQuarter,y.oneofs&&(v.resolution="stepsPerQuarter")),m.stepsPerSecond!=null&&m.hasOwnProperty("stepsPerSecond")&&(v.stepsPerSecond=m.stepsPerSecond,y.oneofs&&(v.resolution="stepsPerSecond")),v},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d}(),h.SubsequenceInfo=function(){function d(p){if(p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.startTimeOffset=0,d.prototype.endTimeOffset=0,d.create=function(p){return new d(p)},d.encode=function(p,m){return m||(m=a.create()),p.startTimeOffset!=null&&p.hasOwnProperty("startTimeOffset")&&m.uint32(9).double(p.startTimeOffset),p.endTimeOffset!=null&&p.hasOwnProperty("endTimeOffset")&&m.uint32(17).double(p.endTimeOffset),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.SubsequenceInfo;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.startTimeOffset=p.double();break;case 2:v.endTimeOffset=p.double();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){return typeof p!="object"||p===null?"object expected":p.startTimeOffset!=null&&p.hasOwnProperty("startTimeOffset")&&typeof p.startTimeOffset!="number"?"startTimeOffset: number expected":p.endTimeOffset!=null&&p.hasOwnProperty("endTimeOffset")&&typeof p.endTimeOffset!="number"?"endTimeOffset: number expected":null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.SubsequenceInfo)return p;var m=new c.tensorflow.magenta.NoteSequence.SubsequenceInfo;return p.startTimeOffset!=null&&(m.startTimeOffset=Number(p.startTimeOffset)),p.endTimeOffset!=null&&(m.endTimeOffset=Number(p.endTimeOffset)),m},d.toObject=function(p,m){m||(m={});var y={};return m.defaults&&(y.startTimeOffset=0,y.endTimeOffset=0),p.startTimeOffset!=null&&p.hasOwnProperty("startTimeOffset")&&(y.startTimeOffset=m.json&&!isFinite(p.startTimeOffset)?String(p.startTimeOffset):p.startTimeOffset),p.endTimeOffset!=null&&p.hasOwnProperty("endTimeOffset")&&(y.endTimeOffset=m.json&&!isFinite(p.endTimeOffset)?String(p.endTimeOffset):p.endTimeOffset),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d}(),h.SectionAnnotation=function(){function d(p){if(p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.time=0,d.prototype.sectionId=u.Long?u.Long.fromBits(0,0,!1):0,d.create=function(p){return new d(p)},d.encode=function(p,m){return m||(m=a.create()),p.time!=null&&p.hasOwnProperty("time")&&m.uint32(9).double(p.time),p.sectionId!=null&&p.hasOwnProperty("sectionId")&&m.uint32(32).int64(p.sectionId),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.SectionAnnotation;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.time=p.double();break;case 4:v.sectionId=u.Long?p.int64().toNumber():p.int64();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){return typeof p!="object"||p===null?"object expected":p.time!=null&&p.hasOwnProperty("time")&&typeof p.time!="number"?"time: number expected":p.sectionId!=null&&p.hasOwnProperty("sectionId")&&!(u.isInteger(p.sectionId)||p.sectionId&&u.isInteger(p.sectionId.low)&&u.isInteger(p.sectionId.high))?"sectionId: integer|Long expected":null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.SectionAnnotation)return p;var m=new c.tensorflow.magenta.NoteSequence.SectionAnnotation;return p.time!=null&&(m.time=Number(p.time)),p.sectionId!=null&&(u.Long?(m.sectionId=u.Long.fromValue(p.sectionId)).unsigned=!1:typeof p.sectionId=="string"?m.sectionId=parseInt(p.sectionId,10):typeof p.sectionId=="number"?m.sectionId=p.sectionId:typeof p.sectionId=="object"&&(m.sectionId=new u.LongBits(p.sectionId.low>>>0,p.sectionId.high>>>0).toNumber())),m},d.toObject=function(p,m){m||(m={});var y={};if(m.defaults)if(y.time=0,u.Long){var v=new u.Long(0,0,!1);y.sectionId=m.longs===String?v.toString():m.longs===Number?v.toNumber():v}else y.sectionId=m.longs===String?"0":0;return p.time!=null&&p.hasOwnProperty("time")&&(y.time=m.json&&!isFinite(p.time)?String(p.time):p.time),p.sectionId!=null&&p.hasOwnProperty("sectionId")&&(typeof p.sectionId=="number"?y.sectionId=m.longs===String?String(p.sectionId):p.sectionId:y.sectionId=m.longs===String?u.Long.prototype.toString.call(p.sectionId):m.longs===Number?new u.LongBits(p.sectionId.low>>>0,p.sectionId.high>>>0).toNumber():p.sectionId),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d}(),h.Section=function(){function d(m){if(m)for(var y=Object.keys(m),v=0;v<y.length;++v)m[y[v]]!=null&&(this[y[v]]=m[y[v]])}var p;return d.prototype.sectionId=u.Long?u.Long.fromBits(0,0,!1):0,d.prototype.sectionGroup=null,Object.defineProperty(d.prototype,"sectionType",{get:u.oneOfGetter(p=["sectionId","sectionGroup"]),set:u.oneOfSetter(p)}),d.create=function(m){return new d(m)},d.encode=function(m,y){return y||(y=a.create()),m.sectionId!=null&&m.hasOwnProperty("sectionId")&&y.uint32(8).int64(m.sectionId),m.sectionGroup!=null&&m.hasOwnProperty("sectionGroup")&&c.tensorflow.magenta.NoteSequence.SectionGroup.encode(m.sectionGroup,y.uint32(18).fork()).ldelim(),y},d.encodeDelimited=function(m,y){return this.encode(m,y).ldelim()},d.decode=function(m,y){m instanceof i||(m=i.create(m));for(var v=y===void 0?m.len:m.pos+y,N=new c.tensorflow.magenta.NoteSequence.Section;m.pos<v;){var T=m.uint32();switch(T>>>3){case 1:N.sectionId=u.Long?m.int64().toNumber():m.int64();break;case 2:N.sectionGroup=c.tensorflow.magenta.NoteSequence.SectionGroup.decode(m,m.uint32());break;default:m.skipType(7&T)}}return N},d.decodeDelimited=function(m){return m instanceof i||(m=new i(m)),this.decode(m,m.uint32())},d.verify=function(m){if(typeof m!="object"||m===null)return"object expected";var y={};if(m.sectionId!=null&&m.hasOwnProperty("sectionId")&&(y.sectionType=1,!(u.isInteger(m.sectionId)||m.sectionId&&u.isInteger(m.sectionId.low)&&u.isInteger(m.sectionId.high))))return"sectionId: integer|Long expected";if(m.sectionGroup!=null&&m.hasOwnProperty("sectionGroup")){if(y.sectionType===1)return"sectionType: multiple values";y.sectionType=1;var v=c.tensorflow.magenta.NoteSequence.SectionGroup.verify(m.sectionGroup);if(v)return"sectionGroup."+v}return null},d.fromObject=function(m){if(m instanceof c.tensorflow.magenta.NoteSequence.Section)return m;var y=new c.tensorflow.magenta.NoteSequence.Section;if(m.sectionId!=null&&(u.Long?(y.sectionId=u.Long.fromValue(m.sectionId)).unsigned=!1:typeof m.sectionId=="string"?y.sectionId=parseInt(m.sectionId,10):typeof m.sectionId=="number"?y.sectionId=m.sectionId:typeof m.sectionId=="object"&&(y.sectionId=new u.LongBits(m.sectionId.low>>>0,m.sectionId.high>>>0).toNumber())),m.sectionGroup!=null){if(typeof m.sectionGroup!="object")throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");y.sectionGroup=c.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(m.sectionGroup)}return y},d.toObject=function(m,y){y||(y={});var v={};return m.sectionId!=null&&m.hasOwnProperty("sectionId")&&(typeof m.sectionId=="number"?v.sectionId=y.longs===String?String(m.sectionId):m.sectionId:v.sectionId=y.longs===String?u.Long.prototype.toString.call(m.sectionId):y.longs===Number?new u.LongBits(m.sectionId.low>>>0,m.sectionId.high>>>0).toNumber():m.sectionId,y.oneofs&&(v.sectionType="sectionId")),m.sectionGroup!=null&&m.hasOwnProperty("sectionGroup")&&(v.sectionGroup=c.tensorflow.magenta.NoteSequence.SectionGroup.toObject(m.sectionGroup,y),y.oneofs&&(v.sectionType="sectionGroup")),v},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d}(),h.SectionGroup=function(){function d(p){if(this.sections=[],p)for(var m=Object.keys(p),y=0;y<m.length;++y)p[m[y]]!=null&&(this[m[y]]=p[m[y]])}return d.prototype.sections=u.emptyArray,d.prototype.numTimes=0,d.create=function(p){return new d(p)},d.encode=function(p,m){if(m||(m=a.create()),p.sections!=null&&p.sections.length)for(var y=0;y<p.sections.length;++y)c.tensorflow.magenta.NoteSequence.Section.encode(p.sections[y],m.uint32(10).fork()).ldelim();return p.numTimes!=null&&p.hasOwnProperty("numTimes")&&m.uint32(16).int32(p.numTimes),m},d.encodeDelimited=function(p,m){return this.encode(p,m).ldelim()},d.decode=function(p,m){p instanceof i||(p=i.create(p));for(var y=m===void 0?p.len:p.pos+m,v=new c.tensorflow.magenta.NoteSequence.SectionGroup;p.pos<y;){var N=p.uint32();switch(N>>>3){case 1:v.sections&&v.sections.length||(v.sections=[]),v.sections.push(c.tensorflow.magenta.NoteSequence.Section.decode(p,p.uint32()));break;case 2:v.numTimes=p.int32();break;default:p.skipType(7&N)}}return v},d.decodeDelimited=function(p){return p instanceof i||(p=new i(p)),this.decode(p,p.uint32())},d.verify=function(p){if(typeof p!="object"||p===null)return"object expected";if(p.sections!=null&&p.hasOwnProperty("sections")){if(!Array.isArray(p.sections))return"sections: array expected";for(var m=0;m<p.sections.length;++m){var y=c.tensorflow.magenta.NoteSequence.Section.verify(p.sections[m]);if(y)return"sections."+y}}return p.numTimes!=null&&p.hasOwnProperty("numTimes")&&!u.isInteger(p.numTimes)?"numTimes: integer expected":null},d.fromObject=function(p){if(p instanceof c.tensorflow.magenta.NoteSequence.SectionGroup)return p;var m=new c.tensorflow.magenta.NoteSequence.SectionGroup;if(p.sections){if(!Array.isArray(p.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");m.sections=[];for(var y=0;y<p.sections.length;++y){if(typeof p.sections[y]!="object")throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");m.sections[y]=c.tensorflow.magenta.NoteSequence.Section.fromObject(p.sections[y])}}return p.numTimes!=null&&(m.numTimes=0|p.numTimes),m},d.toObject=function(p,m){m||(m={});var y={};if((m.arrays||m.defaults)&&(y.sections=[]),m.defaults&&(y.numTimes=0),p.sections&&p.sections.length){y.sections=[];for(var v=0;v<p.sections.length;++v)y.sections[v]=c.tensorflow.magenta.NoteSequence.Section.toObject(p.sections[v],m)}return p.numTimes!=null&&p.hasOwnProperty("numTimes")&&(y.numTimes=p.numTimes),y},d.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},d}(),h}(),r.SequenceMetadata=function(){function h(f){if(this.genre=[],this.composers=[],f)for(var g=Object.keys(f),d=0;d<g.length;++d)f[g[d]]!=null&&(this[g[d]]=f[g[d]])}return h.prototype.title="",h.prototype.artist="",h.prototype.genre=u.emptyArray,h.prototype.composers=u.emptyArray,h.create=function(f){return new h(f)},h.encode=function(f,g){if(g||(g=a.create()),f.title!=null&&f.hasOwnProperty("title")&&g.uint32(10).string(f.title),f.artist!=null&&f.hasOwnProperty("artist")&&g.uint32(18).string(f.artist),f.genre!=null&&f.genre.length)for(var d=0;d<f.genre.length;++d)g.uint32(26).string(f.genre[d]);if(f.composers!=null&&f.composers.length)for(d=0;d<f.composers.length;++d)g.uint32(34).string(f.composers[d]);return g},h.encodeDelimited=function(f,g){return this.encode(f,g).ldelim()},h.decode=function(f,g){f instanceof i||(f=i.create(f));for(var d=g===void 0?f.len:f.pos+g,p=new c.tensorflow.magenta.SequenceMetadata;f.pos<d;){var m=f.uint32();switch(m>>>3){case 1:p.title=f.string();break;case 2:p.artist=f.string();break;case 3:p.genre&&p.genre.length||(p.genre=[]),p.genre.push(f.string());break;case 4:p.composers&&p.composers.length||(p.composers=[]),p.composers.push(f.string());break;default:f.skipType(7&m)}}return p},h.decodeDelimited=function(f){return f instanceof i||(f=new i(f)),this.decode(f,f.uint32())},h.verify=function(f){if(typeof f!="object"||f===null)return"object expected";if(f.title!=null&&f.hasOwnProperty("title")&&!u.isString(f.title))return"title: string expected";if(f.artist!=null&&f.hasOwnProperty("artist")&&!u.isString(f.artist))return"artist: string expected";if(f.genre!=null&&f.hasOwnProperty("genre")){if(!Array.isArray(f.genre))return"genre: array expected";for(var g=0;g<f.genre.length;++g)if(!u.isString(f.genre[g]))return"genre: string[] expected"}if(f.composers!=null&&f.hasOwnProperty("composers")){if(!Array.isArray(f.composers))return"composers: array expected";for(g=0;g<f.composers.length;++g)if(!u.isString(f.composers[g]))return"composers: string[] expected"}return null},h.fromObject=function(f){if(f instanceof c.tensorflow.magenta.SequenceMetadata)return f;var g=new c.tensorflow.magenta.SequenceMetadata;if(f.title!=null&&(g.title=String(f.title)),f.artist!=null&&(g.artist=String(f.artist)),f.genre){if(!Array.isArray(f.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");g.genre=[];for(var d=0;d<f.genre.length;++d)g.genre[d]=String(f.genre[d])}if(f.composers){if(!Array.isArray(f.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");for(g.composers=[],d=0;d<f.composers.length;++d)g.composers[d]=String(f.composers[d])}return g},h.toObject=function(f,g){g||(g={});var d={};if((g.arrays||g.defaults)&&(d.genre=[],d.composers=[]),g.defaults&&(d.title="",d.artist=""),f.title!=null&&f.hasOwnProperty("title")&&(d.title=f.title),f.artist!=null&&f.hasOwnProperty("artist")&&(d.artist=f.artist),f.genre&&f.genre.length){d.genre=[];for(var p=0;p<f.genre.length;++p)d.genre[p]=f.genre[p]}if(f.composers&&f.composers.length)for(d.composers=[],p=0;p<f.composers.length;++p)d.composers[p]=f.composers[p];return d},h.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},h}(),r.VelocityRange=function(){function h(f){if(f)for(var g=Object.keys(f),d=0;d<g.length;++d)f[g[d]]!=null&&(this[g[d]]=f[g[d]])}return h.prototype.min=0,h.prototype.max=0,h.create=function(f){return new h(f)},h.encode=function(f,g){return g||(g=a.create()),f.min!=null&&f.hasOwnProperty("min")&&g.uint32(8).int32(f.min),f.max!=null&&f.hasOwnProperty("max")&&g.uint32(16).int32(f.max),g},h.encodeDelimited=function(f,g){return this.encode(f,g).ldelim()},h.decode=function(f,g){f instanceof i||(f=i.create(f));for(var d=g===void 0?f.len:f.pos+g,p=new c.tensorflow.magenta.VelocityRange;f.pos<d;){var m=f.uint32();switch(m>>>3){case 1:p.min=f.int32();break;case 2:p.max=f.int32();break;default:f.skipType(7&m)}}return p},h.decodeDelimited=function(f){return f instanceof i||(f=new i(f)),this.decode(f,f.uint32())},h.verify=function(f){return typeof f!="object"||f===null?"object expected":f.min!=null&&f.hasOwnProperty("min")&&!u.isInteger(f.min)?"min: integer expected":f.max!=null&&f.hasOwnProperty("max")&&!u.isInteger(f.max)?"max: integer expected":null},h.fromObject=function(f){if(f instanceof c.tensorflow.magenta.VelocityRange)return f;var g=new c.tensorflow.magenta.VelocityRange;return f.min!=null&&(g.min=0|f.min),f.max!=null&&(g.max=0|f.max),g},h.toObject=function(f,g){g||(g={});var d={};return g.defaults&&(d.min=0,d.max=0),f.min!=null&&f.hasOwnProperty("min")&&(d.min=f.min),f.max!=null&&f.hasOwnProperty("max")&&(d.max=f.max),d},h.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},h}(),r),o),n.exports=c},function(n,t,e){"use strict";e.r(t),e.d(t,"converterFromSpec",function(){return h}),e.d(t,"DataConverter",function(){return f}),e.d(t,"DrumsConverter",function(){return g}),e.d(t,"DrumRollConverter",function(){return d}),e.d(t,"DrumsOneHotConverter",function(){return p}),e.d(t,"MelodyConverter",function(){return m}),e.d(t,"MelodyRhythmConverter",function(){return v}),e.d(t,"MelodyShapeConverter",function(){return N}),e.d(t,"TrioConverter",function(){return T}),e.d(t,"TrioRhythmConverter",function(){return O}),e.d(t,"MultitrackConverter",function(){return S}),e.d(t,"GrooveConverter",function(){return F});var r=e(2),o=e(10),s=e(8);e.d(t,"DEFAULT_DRUM_PITCH_CLASSES",function(){return s.DEFAULT_DRUM_PITCH_CLASSES});var i=e(12),a=e(23),u=e(29),c=e(13);function h(R){switch(R.type){case"MelodyConverter":return new m(R.args);case"MelodyRhythmConverter":return new v(R.args);case"MelodyShapeConverter":return new N(R.args);case"DrumsConverter":return new g(R.args);case"DrumRollConverter":return new d(R.args);case"TrioConverter":return new T(R.args);case"TrioRhythmConverter":return new O(R.args);case"DrumsOneHotConverter":return new p(R.args);case"MultitrackConverter":return new S(R.args);case"GrooveConverter":return new F(R.args);default:throw new Error("Unknown DataConverter type: "+R)}}class f{constructor(L){this.NUM_SPLITS=0,this.SEGMENTED_BY_TRACK=!1,this.numSteps=L.numSteps,this.numSegments=L.numSegments}tensorSteps(L){return r.scalar(L.shape[0],"int32")}}class g extends f{constructor(L){super(L),this.pitchClasses=L.pitchClasses||s.DEFAULT_DRUM_PITCH_CLASSES,this.pitchToClass=new Map;for(let q=0;q<this.pitchClasses.length;++q)this.pitchClasses[q].forEach(U=>{this.pitchToClass.set(U,q)});this.depth=this.pitchClasses.length+1}toTensor(L){c.assertIsQuantizedSequence(L);let q=this.numSteps||L.totalQuantizedSteps,U=r.buffer([q,this.pitchClasses.length+1],"int32");for(let Z=0;Z<q;++Z)U.set(1,Z,-1);return L.notes.forEach(Z=>{U.set(1,Z.quantizedStartStep,this.pitchToClass.get(Z.pitch)),U.set(0,Z.quantizedStartStep,-1)}),U.toTensor()}toNoteSequence(L,q,U){return Te(this,null,function*(){let Z=c.createQuantizedNoteSequence(q,U),ee=L.argMax(1),Q=yield ee.data();ee.dispose();for(let oe=0;oe<Q.length;++oe)for(let se=0;se<this.pitchClasses.length;se++)Q[oe]>>se&1&&Z.notes.push(o.a.Note.create({pitch:this.pitchClasses[se][0],quantizedStartStep:oe,quantizedEndStep:oe+1,isDrum:!0}));return Z.totalQuantizedSteps=Q.length,Z})}}class d extends g{toNoteSequence(L,q,U){return Te(this,null,function*(){let Z=c.createQuantizedNoteSequence(q,U),ee=yield L.data();for(let Q=0;Q<L.shape[0];++Q){let oe=ee.slice(Q*this.pitchClasses.length,(Q+1)*this.pitchClasses.length);for(let se=0;se<oe.length;++se)oe[se]&&Z.notes.push(o.a.Note.create({pitch:this.pitchClasses[se][0],quantizedStartStep:Q,quantizedEndStep:Q+1,isDrum:!0}))}return Z.totalQuantizedSteps=L.shape[0],Z})}}class p extends g{constructor(L){super(L),this.depth=Math.pow(2,this.pitchClasses.length)}toTensor(L){c.assertIsRelativeQuantizedSequence(L);let q=this.numSteps||L.totalQuantizedSteps,U=Array(q).fill(0);for(let{pitch:Z,quantizedStartStep:ee}of L.notes)U[ee]+=Math.pow(2,this.pitchToClass.get(Z));return r.tidy(()=>r.oneHot(r.tensor1d(U,"int32"),this.depth))}}class m extends f{constructor(L){super(L),this.NOTE_OFF=1,this.FIRST_PITCH=2,this.minPitch=L.minPitch,this.maxPitch=L.maxPitch,this.ignorePolyphony=L.ignorePolyphony,this.depth=L.maxPitch-L.minPitch+1+this.FIRST_PITCH}toTensor(L){let q=a.Melody.fromNoteSequence(L,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return r.tidy(()=>r.oneHot(r.tensor(q.events,[q.events.length],"int32"),this.depth))}toNoteSequence(L,q,U){return Te(this,null,function*(){let Z=L.argMax(1),ee=yield Z.data();return Z.dispose(),new a.Melody(ee,this.minPitch,this.maxPitch).toNoteSequence(q,U)})}}class y extends f{constructor(L,q){super(L),this.minPitch=L.minPitch,this.maxPitch=L.maxPitch,this.ignorePolyphony=L.ignorePolyphony,this.melodyControl=q,this.depth=q.depth}toTensor(L){let q=a.Melody.fromNoteSequence(L,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return this.melodyControl.extract(q)}}class v extends y{constructor(L){super(L,new a.MelodyRhythm)}toNoteSequence(L,q,U){return Te(this,null,function*(){let Z=c.createQuantizedNoteSequence(q,U),ee=yield L.data();for(let Q=0;Q<ee.length;++Q)ee[Q]&&Z.notes.push(o.a.Note.create({pitch:s.DEFAULT_DRUM_PITCH_CLASSES[1][0],quantizedStartStep:Q,quantizedEndStep:Q+1,isDrum:!0}));return Z.totalQuantizedSteps=ee.length,Z})}}class N extends y{constructor(L){super(L,new a.MelodyShape)}toNoteSequence(L,q,U){return Te(this,null,function*(){let Z=c.createQuantizedNoteSequence(q,U),ee=L.argMax(1),Q=yield ee.data();ee.dispose();let oe=Math.round((this.maxPitch+this.minPitch)/2);for(let se=0;se<Q.length;++se){switch(Q[se]){case 0:oe-=1,oe<this.minPitch&&(oe=this.minPitch,i.log("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter"));break;case 2:oe+=1,oe>this.maxPitch&&(oe=this.maxPitch,i.log("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter"))}Z.notes.push(o.a.Note.create({pitch:oe,quantizedStartStep:se,quantizedEndStep:se+1}))}return Z.totalQuantizedSteps=Q.length,Z})}}class T extends f{constructor(L){super(L),this.NUM_SPLITS=3,this.MEL_PROG_RANGE=[0,31],this.BASS_PROG_RANGE=[32,39],L.melArgs.numSteps=L.numSteps,L.bassArgs.numSteps=L.numSteps,L.drumsArgs.numSteps=L.numSteps,this.melConverter=new m(L.melArgs),this.bassConverter=new m(L.bassArgs),this.drumsConverter=new p(L.drumsArgs),this.depth=this.melConverter.depth+this.bassConverter.depth+this.drumsConverter.depth}toTensor(L){c.assertIsQuantizedSequence(L);let q=c.clone(L),U=c.clone(L),Z=c.clone(L);return q.notes=L.notes.filter(ee=>!ee.isDrum&&ee.program>=this.MEL_PROG_RANGE[0]&&ee.program<=this.MEL_PROG_RANGE[1]),U.notes=L.notes.filter(ee=>!ee.isDrum&&ee.program>=this.BASS_PROG_RANGE[0]&&ee.program<=this.BASS_PROG_RANGE[1]),Z.notes=L.notes.filter(ee=>ee.isDrum),r.tidy(()=>r.concat([this.melConverter.toTensor(q),this.bassConverter.toTensor(U),this.drumsConverter.toTensor(Z)],-1))}toNoteSequence(L,q,U){return Te(this,null,function*(){let Z=r.split(L,[this.melConverter.depth,this.bassConverter.depth,this.drumsConverter.depth],-1),ee=yield this.melConverter.toNoteSequence(Z[0],q,U);ee.notes.forEach(se=>{se.instrument=0,se.program=0});let Q=yield this.bassConverter.toNoteSequence(Z[1],q,U);ee.notes.push(...Q.notes.map(se=>(se.instrument=1,se.program=this.BASS_PROG_RANGE[0],se)));let oe=yield this.drumsConverter.toNoteSequence(Z[2],q,U);return ee.notes.push(...oe.notes.map(se=>(se.instrument=2,se))),Z.forEach(se=>se.dispose()),ee})}}class O extends f{constructor(L){super(L),this.NUM_SPLITS=3,this.trioConverter=new T(L),this.depth=3}toTensor(L){return r.tidy(()=>{let q=this.trioConverter.toTensor(L),U=r.split(q,[this.trioConverter.melConverter.depth,this.trioConverter.bassConverter.depth,this.trioConverter.drumsConverter.depth],1),Z=r.argMax(U[0],1),ee=r.argMax(U[1],1),Q=r.argMax(U[2],1),oe=r.greater(Z,1),se=r.greater(ee,1),pe=r.greater(Q,0);return r.stack([oe,se,pe],1)})}toNoteSequence(L,q,U){return Te(this,null,function*(){let Z=r.split(L,3,1),ee=yield Promise.all(Z.map(oe=>oe.data())),Q=c.createQuantizedNoteSequence(q,U);for(let oe=0;oe<this.numSteps;++oe)ee[0][oe]&&Q.notes.push(o.a.Note.create({pitch:72,quantizedStartStep:oe,quantizedEndStep:oe+1,instrument:0,program:0})),ee[1][oe]&&Q.notes.push(o.a.Note.create({pitch:36,quantizedStartStep:oe,quantizedEndStep:oe+1,instrument:1,program:32})),ee[2][oe]&&Q.notes.push(o.a.Note.create({pitch:s.DEFAULT_DRUM_PITCH_CLASSES[1][0],quantizedStartStep:oe,quantizedEndStep:oe+1,instrument:2,isDrum:!0}));return Q.totalQuantizedSteps=this.numSteps,Q})}}class S extends f{constructor(L){super(L),this.SEGMENTED_BY_TRACK=!0,this.stepsPerQuarter=L.stepsPerQuarter,this.totalSteps=L.totalSteps,this.numVelocityBins=L.numVelocityBins,this.minPitch=L.minPitch?L.minPitch:s.MIN_MIDI_PITCH,this.maxPitch=L.maxPitch?L.maxPitch:s.MAX_MIDI_PITCH,this.numPitches=this.maxPitch-this.minPitch+1,this.performanceEventDepth=2*this.numPitches+this.totalSteps+this.numVelocityBins,this.numPrograms=s.MAX_MIDI_PROGRAM-s.MIN_MIDI_PROGRAM+2,this.endToken=this.performanceEventDepth+this.numPrograms,this.depth=this.endToken+1,this.endTensor=r.tidy(()=>r.oneHot(r.tensor1d([this.endToken],"int32"),this.depth).as1D())}trackToTensor(L){let q=this.numSteps/this.numSegments,U;if(L){for(;L.events.length>q-2;)L.events.pop();U=r.buffer([L.events.length+2],"int32"),U.set(this.performanceEventDepth+(L.isDrum?this.numPrograms-1:L.program),0),L.events.forEach((Z,ee)=>{switch(Z.type){case"note-on":U.set(Z.pitch-this.minPitch,ee+1);break;case"note-off":U.set(this.numPitches+Z.pitch-this.minPitch,ee+1);break;case"time-shift":U.set(2*this.numPitches+Z.steps-1,ee+1);break;case"velocity-change":U.set(2*this.numPitches+this.totalSteps+Z.velocityBin-1,ee+1);break;default:throw new Error("Unrecognized performance event: "+Z)}}),U.set(this.endToken,L.events.length+1)}else U=r.buffer([1],"int32",new Int32Array([this.endToken]));return r.tidy(()=>{let Z=r.oneHot(U.toTensor(),this.depth);return Z.pad([[0,q-Z.shape[0]],[0,0]])})}toTensor(L){if(c.assertIsRelativeQuantizedSequence(L),L.quantizationInfo.stepsPerQuarter!==this.stepsPerQuarter)throw new Error(`Steps per quarter note mismatch: ${L.quantizationInfo.stepsPerQuarter} != ${this.stepsPerQuarter}`);let q=c.clone(L);q.notes=L.notes.filter(ee=>ee.pitch>=this.minPitch&&ee.pitch<=this.maxPitch);let U=new Set(q.notes.map(ee=>ee.instrument)),Z=Array.from(U).map(ee=>u.Performance.fromNoteSequence(q,this.totalSteps,this.numVelocityBins,ee)).sort((ee,Q)=>Q.isDrum?-1:ee.isDrum?1:ee.program-Q.program);for(;Z.length>this.numSegments;)Z.pop();for(Z.forEach(ee=>ee.setNumSteps(this.totalSteps));Z.length<this.numSegments;)Z.push(void 0);return r.tidy(()=>r.concat(Z.map(ee=>this.trackToTensor(ee)),0))}tokensToTrack(L){let q=L.indexOf(this.endToken),U=q>=0?q:L.length,Z=L.slice(0,U),ee=Z.filter(ae=>ae<this.performanceEventDepth),Q=Z.filter(ae=>ae>=this.performanceEventDepth),[oe,se]=Q.length?Q[0]-this.performanceEventDepth<this.numPrograms-1?[Q[0]-this.performanceEventDepth,!1]:[0,!0]:[0,!1],pe=Array.from(ee).map(ae=>{if(ae<this.numPitches)return{type:"note-on",pitch:this.minPitch+ae};if(ae<2*this.numPitches)return{type:"note-off",pitch:this.minPitch+ae-this.numPitches};if(ae<2*this.numPitches+this.totalSteps)return{type:"time-shift",steps:ae-2*this.numPitches+1};if(ae<2*this.numPitches+this.totalSteps+this.numVelocityBins)return{type:"velocity-change",velocityBin:ae-2*this.numPitches-this.totalSteps+1};throw new Error("Invalid performance event token: "+ae)});return new u.Performance(pe,this.totalSteps,this.numVelocityBins,oe,se)}toNoteSequence(Z){return Te(this,arguments,function*(L,q=this.stepsPerQuarter,U){let ee=c.createQuantizedNoteSequence(q,U);ee.totalQuantizedSteps=this.totalSteps;let Q=r.tidy(()=>r.split(L.argMax(1),this.numSegments));return(yield Promise.all(Q.map(oe=>Te(this,null,function*(){let se=yield oe.data(),pe=this.tokensToTrack(se);return oe.dispose(),pe})))).forEach((oe,se)=>{oe.setNumSteps(this.totalSteps),ee.notes.push(...oe.toNoteSequence(se).notes)}),ee})}}class F extends f{constructor(L){super(L),this.TAPIFY_CHANNEL=3,this.stepsPerQuarter=L.stepsPerQuarter||s.DEFAULT_STEPS_PER_QUARTER,this.pitchClasses=L.pitchClasses||s.DEFAULT_DRUM_PITCH_CLASSES,this.pitchToClass=new Map;for(let q=0;q<this.pitchClasses.length;++q)this.pitchClasses[q].forEach(U=>{this.pitchToClass.set(U,q)});this.humanize=L.humanize||!1,this.tapify=L.tapify||!1,this.splitInstruments=L.splitInstruments||!1,this.depth=3}toTensor(L){let q=c.isRelativeQuantizedSequence(L)?L:c.quantizeNoteSequence(L,this.stepsPerQuarter),U=this.numSteps,Z=q.tempos&&q.tempos.length?q.tempos[0].qpm:s.DEFAULT_QUARTERS_PER_MINUTE,ee=60/Z/this.stepsPerQuarter,Q=[];for(let he=0;he<U;++he)Q.push(new Map);q.notes.forEach(he=>{if(!this.tapify&&!this.pitchToClass.has(he.pitch))return;let Ee=he.quantizedStartStep;if(Ee>=Q.length)throw Error(`Model does not support sequences with more than ${U} steps (${U*ee} seconds at qpm ${Z}).`);let Le=this.tapify?this.TAPIFY_CHANNEL:this.pitchToClass.get(he.pitch);(!Q[Ee].has(Le)||Q[Ee].get(Le).velocity<he.velocity)&&Q[Ee].set(Le,he)});let oe=this.pitchClasses.length,se=r.buffer([U,oe]),pe=r.buffer([U,oe]),ae=r.buffer([U,oe]);function fe(he){if(he.startTime===void 0)return 0;let Ee=he.startTime;return 2*(he.quantizedStartStep*ee-Ee)/ee}for(let he=0;he<U;++he)for(let Ee=0;Ee<oe;++Ee){let Le=Q[he].get(Ee);se.set(Le?1:0,he,Ee),this.humanize||this.tapify||pe.set(Le?Le.velocity/s.MAX_MIDI_VELOCITY:0,he,Ee),this.humanize||ae.set(Le?fe(Le):0,he,Ee)}return r.tidy(()=>{let he=se.toTensor(),Ee=pe.toTensor(),Le=ae.toTensor(),Ve=this.splitInstruments?U*oe:U;return r.concat([he.as2D(Ve,-1),Ee.as2D(Ve,-1),Le.as2D(Ve,-1)],1)})}toNoteSequence(Z,ee){return Te(this,arguments,function*(L,q,U=s.DEFAULT_QUARTERS_PER_MINUTE){if(q&&q!==this.stepsPerQuarter)throw Error("`stepsPerQuarter` is set by the model.");q=this.stepsPerQuarter;let Q=this.splitInstruments?L.shape[0]/this.pitchClasses.length:L.shape[0],oe=60/U/this.stepsPerQuarter,se=o.a.create({totalTime:Q*oe,tempos:[{qpm:U}]}),pe=yield L.data();function ae(he,Ee,Le){return Math.min(Math.max(he,Ee),Le)}let fe=this.pitchClasses.length;for(let he=0;he<Q;++he){let Ee=pe.slice(he*fe*this.depth,(he+1)*fe*this.depth);for(let Le=0;Le<fe;++Le){let Ve=Ee[this.splitInstruments?Le*this.depth:Le],qe=Ee[this.splitInstruments?Le*this.depth+1:fe+Le],je=Ee[this.splitInstruments?Le*this.depth+2:2*fe+Le];if(Ve>.5){let Ce=ae(Math.round(qe*s.MAX_MIDI_VELOCITY),s.MIN_MIDI_VELOCITY,s.MAX_MIDI_VELOCITY),tt=ae(je/2,-.5,.5);se.notes.push(o.a.Note.create({pitch:this.pitchClasses[Le][0],startTime:(he-tt)*oe,endTime:(he-tt+1)*oe,velocity:Ce,isDrum:!0}))}}}return se})}}},function(n,t,e){"use strict";e.r(t),e.d(t,"ChordQuality",function(){return ku}),e.d(t,"ChordSymbolException",function(){return fs}),e.d(t,"ChordEncodingException",function(){return Ao}),e.d(t,"ChordSymbols",function(){return Hs}),e.d(t,"ChordEncoder",function(){return bi}),e.d(t,"chordEncoderFromType",function(){return Sc}),e.d(t,"MajorMinorChordEncoder",function(){return po}),e.d(t,"TriadChordEncoder",function(){return Da}),e.d(t,"PitchChordEncoder",function(){return Oo});var r={};e.r(r),e.d(r,"names",function(){return a}),e.d(r,"tokenize",function(){return f}),e.d(r,"props",function(){return p}),e.d(r,"name",function(){return m}),e.d(r,"pc",function(){return y}),e.d(r,"midi",function(){return v}),e.d(r,"midiToFreq",function(){return N}),e.d(r,"freq",function(){return T}),e.d(r,"freqToMidi",function(){return F}),e.d(r,"chroma",function(){return R}),e.d(r,"oct",function(){return L}),e.d(r,"stepToLetter",function(){return q}),e.d(r,"altToAcc",function(){return Z}),e.d(r,"from",function(){return ee}),e.d(r,"build",function(){return Q}),e.d(r,"fromMidi",function(){return oe}),e.d(r,"simplify",function(){return se}),e.d(r,"enharmonic",function(){return pe});var o={};e.r(o),e.d(o,"names",function(){return Qo}),e.d(o,"props",function(){return ki}),e.d(o,"intervals",function(){return Di}),e.d(o,"notes",function(){return Ai}),e.d(o,"exists",function(){return ia}),e.d(o,"supersets",function(){return aa}),e.d(o,"subsets",function(){return Nu}),e.d(o,"tokenize",function(){return eu});var s=e(2),i="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),a=function(xt){return typeof xt!="string"?i.slice():i.filter(function(ze){var Xt=ze[1]||" ";return xt.indexOf(Xt)!==-1})},u=a(" #"),c=a(" b"),h=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function f(xt){typeof xt!="string"&&(xt="");var ze=h.exec(xt);return[ze[1].toUpperCase(),ze[2].replace(/x/g,"##"),ze[3],ze[4]]}var g=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),d=[0,2,4,5,7,9,11],p=function(xt,ze){return ze===void 0&&(ze={}),function(Xt){return ze[Xt]||(ze[Xt]=xt(Xt))}}(function(xt){var ze=f(xt);if(ze[0]===""||ze[3]!=="")return g;var Xt=ze[0],Yt=ze[1],Qt=ze[2],Gn={letter:Xt,acc:Yt,octStr:Qt,pc:Xt+Yt,name:Xt+Yt+Qt,step:(Xt.charCodeAt(0)+3)%7,alt:Yt[0]==="b"?-Yt.length:Yt.length,oct:Qt.length?+Qt:null,chroma:0,midi:null,freq:null};return Gn.chroma=(d[Gn.step]+Gn.alt+120)%12,Gn.midi=Gn.oct!==null?d[Gn.step]+Gn.alt+12*(Gn.oct+1):null,Gn.freq=N(Gn.midi),Object.freeze(Gn)}),m=function(xt){return p(xt).name},y=function(xt){return p(xt).pc},v=function(xt){if(typeof xt!="number"&&typeof xt!="string")return null;var ze,Xt=p(xt).midi,Yt=Xt||Xt===0?Xt:+xt;return(ze=Yt)>=0&&ze<=127?Yt:null},N=function(xt,ze){return ze===void 0&&(ze=440),typeof xt=="number"?Math.pow(2,(xt-69)/12)*ze:null},T=function(xt){return p(xt).freq||N(xt)},O=Math.log(2),S=Math.log(440),F=function(xt){var ze=12*(Math.log(xt)-S)/O+69;return Math.round(100*ze)/100},R=function(xt){return p(xt).chroma},L=function(xt){return p(xt).oct},q=function(xt){return"CDEFGAB"[xt]},U=function(xt,ze){return Array(ze+1).join(xt)},Z=function(xt){return function(ze,Xt){return typeof ze!="number"?"":Xt(ze)}(xt,function(ze){return ze<0?U("b",-ze):U("#",ze)})},ee=function(xt,ze){xt===void 0&&(xt={}),ze===void 0&&(ze=null);var Xt=ze?Object.assign({},p(ze),xt):xt,Yt=Xt.step,Qt=Xt.alt,Gn=Xt.oct;if(typeof Yt!="number")return null;var Un=q(Yt);if(!Un)return null;var ar=Un+Z(Qt);return Gn||Gn===0?ar+Gn:ar},Q=ee;function oe(xt,ze){return ze===void 0&&(ze=!1),xt=Math.round(xt),(ze===!0?u:c)[xt%12]+(Math.floor(xt/12)-1)}var se=function(xt,ze){ze===void 0&&(ze=!0);var Xt=p(xt),Yt=Xt.alt,Qt=Xt.chroma,Gn=Xt.midi;if(Qt===null)return null;var Un=ze===!1?Yt<0:Yt>0;return Gn===null?y(oe(Qt,Un)):oe(Gn,Un)},pe=function(xt){return se(xt,!1)},ae=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$"),fe=[0,2,4,5,7,9,11],he=("1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P".split(" "),Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null,oct:null})),Ee=function(xt){return(Math.abs(xt)-1)%7},Le=function(xt){var ze=function(Gn){var Un=ae.exec(""+Gn);return Un===null?null:Un[1]?[Un[1],Un[2]]:[Un[4],Un[3]]}(xt);if(ze===null)return he;var Xt,Yt,Qt={num:0,q:"d",name:"",type:"M",step:0,dir:-1,simple:1,alt:0,oct:0,semitones:0,chroma:0,ic:0};return Qt.num=+ze[0],Qt.q=ze[1],Qt.step=Ee(Qt.num),Qt.type="PMMPPMM"[Qt.step],Qt.type==="M"&&Qt.q==="P"?he:(Qt.name=""+Qt.num+Qt.q,Qt.dir=Qt.num<0?-1:1,Qt.simple=Qt.num===8||Qt.num===-8?Qt.num:Qt.dir*(Qt.step+1),Qt.alt=(Xt=Qt.type,(Yt=Qt.q)==="M"&&Xt==="M"||Yt==="P"&&Xt==="P"?0:Yt==="m"&&Xt==="M"?-1:/^A+$/.test(Yt)?Yt.length:/^d+$/.test(Yt)?Xt==="P"?-Yt.length:-Yt.length-1:null),Qt.oct=Math.floor((Math.abs(Qt.num)-1)/7),Qt.semitones=Qt.dir*(fe[Qt.step]+Qt.alt+12*Qt.oct),Qt.chroma=(Qt.dir*(fe[Qt.step]+Qt.alt)%12+12)%12,Object.freeze(Qt))},Ve={};function qe(xt){return typeof xt!="string"?he:Ve[xt]||(Ve[xt]=Le(xt))}"P m M m M P d P m M m M".split(" ");var je=[0,2,4,-1,1,3,5],Ce=je.map(function(xt){return Math.floor(7*xt/12)}),tt=[3,0,4,1,5,2,6],ye=function(xt,ze,Xt){var Yt=tt[function(Gn){var Un=(Gn+1)%7;return Un<0?7+Un:Un}(xt)],Qt=Math.floor((xt+1)/7);return ze===void 0?{step:Yt,alt:Qt,dir:Xt}:{step:Yt,alt:Qt,oct:ze+4*Qt+Ce[Yt],dir:Xt}},z=function(xt){return function(ze,Xt){return Xt===void 0&&(Xt={}),function(Yt){return Xt[Yt]||(Xt[Yt]=ze(Yt))}}(function(ze){var Xt=xt(ze);return Xt.name===null?null:function(Yt){var Qt=Yt.step,Gn=Yt.alt,Un=Yt.oct,ar=Yt.dir;ar===void 0&&(ar=1);var xe=je[Qt]+7*Gn;return Un===null?[ar*xe]:[ar*xe,ar*(Un-Ce[Qt]-4*Gn)]}(Xt)})},M=z(p),W=z(qe);function ce(xt,ze){if(arguments.length===1)return function(Gn){return ce(xt,Gn)};var Xt=M(xt),Yt=W(ze);if(Xt===null||Yt===null)return null;var Qt=Xt.length===1?[Xt[0]+Yt[0]]:[Xt[0]+Yt[0],Xt[1]+Yt[1]];return Q(ye(Qt[0],Qt[1]))}var J=e(64),Ie=e(65),Fe=function(xt){return R(xt)||function(ze){return qe(ze).chroma}(xt)||0},lt=function(xt){return parseInt(Dt(xt),2)};function Dt(xt){if(an(xt))return xt;if(!Array.isArray(xt))return"";var ze=[0,0,0,0,0,0,0,0,0,0,0,0];return xt.map(Fe).forEach(function(Xt){ze[Xt]=1}),ze.join("")}var Ht=/^[01]{12}$/;function an(xt){return Ht.test(xt)}"1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");function cn(xt,ze){return arguments.length>1?cn(xt)(ze):(xt=lt(xt),function(Xt){return(Xt=lt(Xt))!==xt&&(Xt&xt)===Xt})}function nn(xt,ze){return arguments.length>1?nn(xt)(ze):(xt=lt(xt),function(Xt){return(Xt=lt(Xt))!==xt&&(Xt|xt)===Xt})}var Yn,ln,Qn,wn=function(xt){var ze=Object.keys(xt).sort(),Xt=[],Yt=[],Qt=function(ar,xe,Pe){Xt[ar]=xe,Yt[Pe]=Yt[Pe]||[],Yt[Pe].push(ar)};ze.forEach(function(ar){var xe=xt[ar][0].split(" "),Pe=xt[ar][1],Ge=Dt(xe);Qt(ar,xe,Ge),Pe&&Pe.forEach(function(pt){return Qt(pt,xe,Ge)})});var Gn=Object.keys(Xt).sort(),Un=function(ar){return Xt[ar]};return Un.names=function(ar){return typeof ar=="string"?(Yt[ar]||[]).slice():(ar===!0?Gn:ze).slice()},Un},_r=wn(J),Ar=wn(Ie),ss=(Yn=_r,ln=Ar,(Qn=function(xt){return Yn(xt)||ln(xt)}).names=function(xt){return Yn.names(xt).concat(ln.names(xt))},Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null}));_r.names;var Qo=Ar.names,Ws=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),ki=function(xt,ze){return ze===void 0&&(ze={}),function(Xt){return ze[Xt]||(ze[Xt]=xt(Xt))}}(function(xt){var ze=Ar(xt);if(!ze)return Ws;var Xt={intervals:ze,name:xt};return Xt.chroma=Dt(ze),Xt.setnum=parseInt(Xt.chroma,2),Xt.names=Ar.names(Xt.chroma),Xt}),Di=function(xt){return ki(eu(xt)[1]).intervals};function Ai(xt,ze){if(ze)return ki(ze).intervals.map(ce(xt));var Xt=eu(xt),Yt=Xt[0],Qt=Xt[1];return ki(Qt).intervals.map(ce(Yt))}var ia=function(xt){return Ar(eu(xt)[1])!==void 0},aa=function(xt){if(!Di(xt).length)return[];var ze=nn(Di(xt));return Ar.names().filter(function(Xt){return ze(Ar(Xt))})},Nu=function(xt){var ze=cn(Di(xt));return Ar.names().filter(function(Xt){return ze(Ar(Xt))})},vc=/^(6|64|7|9|11|13)$/;function eu(xt){var ze=f(xt);return ze[0]===""?["",xt]:ze[0]==="A"&&ze[3]==="ug"?["","aug"]:vc.test(ze[2])?[ze[0]+ze[1],ze[2]+ze[3]]:[ze[0]+ze[1]+ze[2],ze[3]]}var ds=e(8);let wc=[["1P","3M","5P"],["1P","3m","5P"],["1P","3M","5A"],["1P","3m","5d"]];var ku;(function(xt){xt[xt.Major=0]="Major",xt[xt.Minor=1]="Minor",xt[xt.Augmented=2]="Augmented",xt[xt.Diminished=3]="Diminished",xt[xt.Other=4]="Other"})(ku||(ku={}));class fs extends Error{constructor(ze){super(ze),Object.setPrototypeOf(this,new.target.prototype)}}class Ao extends Error{constructor(ze){super(ze),Object.setPrototypeOf(this,new.target.prototype)}}class Hs{static pitches(ze){if(!o.tokenize(ze)[0]||!o.exists(ze))throw new fs("Unrecognized chord symbol: "+ze);return o.notes(ze).map(r.chroma)}static root(ze){let Xt=o.tokenize(ze)[0];if(!Xt)throw new fs("Chord symbol has unknown root: "+ze);return r.chroma(Xt)}static quality(ze){if(!o.exists(ze))throw new fs("Unrecognized chord symbol: "+ze);let Xt=o.intervals(ze),Yt=wc.map(Un=>Un.every(ar=>Xt.includes(ar))),Qt=Yt.indexOf(!0),Gn=Yt.lastIndexOf(!0);return Qt>=0&&Qt===Gn?Qt:ku.Other}}class bi{encodeProgression(ze,Xt){let Yt=ze.map(Gn=>this.encode(Gn)),Qt=Array.from(Array(Xt).keys()).map(Gn=>Math.floor(Gn*Yt.length/Xt));return s.stack(Qt.map(Gn=>Yt[Gn]))}}function Sc(xt){switch(xt){case"MajorMinorChordEncoder":return new po;case"TriadChordEncoder":return new Da;case"PitchChordEncoder":return new Oo;default:throw new Error("Unknown chord encoder type: "+xt)}}class po extends bi{constructor(){super(...arguments),this.depth=1+2*ds.NUM_PITCH_CLASSES}index(ze){if(ze===ds.NO_CHORD)return 0;let Xt=Hs.root(ze),Yt=1+Hs.quality(ze)*ds.NUM_PITCH_CLASSES+Xt;if(Yt>=this.depth)throw new Ao("Chord is neither major nor minor: "+ze);return Yt}encode(ze){return s.tidy(()=>s.oneHot(s.tensor1d([this.index(ze)],"int32"),this.depth).as1D())}}class Da extends bi{constructor(){super(...arguments),this.depth=1+4*ds.NUM_PITCH_CLASSES}index(ze){if(ze===ds.NO_CHORD)return 0;let Xt=Hs.root(ze),Yt=1+Hs.quality(ze)*ds.NUM_PITCH_CLASSES+Xt;if(Yt>=this.depth)throw new Ao("Chord is not a standard triad: "+ze);return Yt}encode(ze){return s.tidy(()=>s.oneHot(s.tensor1d([this.index(ze)],"int32"),this.depth).as1D())}}class Oo extends bi{constructor(){super(...arguments),this.depth=1+3*ds.NUM_PITCH_CLASSES}encode(ze){return s.tidy(()=>{if(ze===ds.NO_CHORD)return s.oneHot(s.tensor1d([0],"int32"),this.depth).as1D();let Xt=Hs.root(ze),Yt=s.oneHot(s.tensor1d([Xt],"int32"),ds.NUM_PITCH_CLASSES).as1D(),Qt=s.buffer([ds.NUM_PITCH_CLASSES]);Hs.pitches(ze).forEach(ar=>Qt.set(1,ar));let Gn=Qt.toTensor().as1D(),Un=Yt;return s.concat1d([s.tensor1d([0]),Yt,Gn,Un])})}}},function(n,t,e){"use strict";(function(r){var o=e(46),s=e(11);let i=Object(s.b)();i.registerFlag("DEBUG",()=>!1,a=>{a&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),i.registerFlag("IS_BROWSER",()=>o.isBrowser()),i.registerFlag("IS_NODE",()=>r!==void 0&&r.versions!==void 0&&r.versions.node!==void 0),i.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),i.registerFlag("PROD",()=>!1),i.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>i.getBool("DEBUG")),i.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),i.registerFlag("IS_TEST",()=>!1)}).call(this,e(44))},function(n,t,e){"use strict";e.d(t,"a",function(){return r}),e.d(t,"b",function(){return o});class r{constructor(a,u){this.backend=a,this.dataMover=u,this.data=new WeakMap,this.dataIdsCount=0}get(a){return this.data.has(a)||this.dataMover.moveData(this.backend,a),this.data.get(a)}set(a,u){this.dataIdsCount++,this.data.set(a,u)}has(a){return this.data.has(a)}delete(a){return this.dataIdsCount--,this.data.delete(a)}numDataIds(){return this.dataIdsCount}}class o{time(a){return s("time")}read(a){return s("read")}readSync(a){return s("readSync")}numDataIds(){return s("numDataIds")}disposeData(a){return s("disposeData")}write(a,u,c){return s("write")}move(a,u,c,h){return s("move")}memory(){return s("memory")}floatPrecision(){return s("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}batchMatMul(a,u,c,h){return s("batchMatMul")}fusedBatchMatMul({a,b:u,transposeA:c,transposeB:h,bias:f,activation:g,preluActivationWeights:d}){return s("fusedBatchMatMul")}slice(a,u,c){return s("slice")}stridedSlice(a,u,c,h){return s("stridedSlice")}unstack(a,u){return s("unstack")}reverse(a,u){return s("reverse")}concat(a,u){return s("concat")}neg(a){return s("neg")}add(a,u){return s("add")}addN(a){return s("addN")}subtract(a,u){return s("subtract")}multiply(a,u){return s("multiply")}realDivide(a,u){return s("realDivide")}floorDiv(a,u){return s("floorDiv")}sum(a,u){return s("sum")}prod(a,u){return s("prod")}unsortedSegmentSum(a,u,c){return s("unsortedSegmentSum")}argMin(a,u){return s("argMin")}argMax(a,u){return s("argMax")}equal(a,u){return s("equal")}notEqual(a,u){return s("notEqual")}less(a,u){return s("less")}lessEqual(a,u){return s("lessEqual")}greater(a,u){return s("greater")}greaterEqual(a,u){return s("greaterEqual")}logicalNot(a){return s("logicalNot")}logicalAnd(a,u){return s("logicalAnd")}logicalOr(a,u){return s("logicalOr")}where(a){return s("where")}select(a,u,c){return s("select")}topk(a,u,c){return s("topk")}min(a,u){return s("min")}minimum(a,u){return s("minimum")}mod(a,u){return s("mod")}max(a,u){return s("max")}maximum(a,u){return s("maximum")}all(a,u){return s("all")}any(a,u){return s("any")}squaredDifference(a,u){return s("squaredDifference")}ceil(a){return s("ceil")}floor(a){return s("floor")}round(a){return s("round")}sign(a){return s("sign")}isNaN(a){return s("isNaN")}isInf(a){return s("isInf")}isFinite(a){return s("isFinite")}pow(a,u){return s("pow")}exp(a){return s("exp")}expm1(a){return s("expm1")}softmax(a,u){return s("softmax")}log(a){return s("log")}log1p(a){return s("log1p")}sqrt(a){return s("sqrt")}rsqrt(a){return s("rsqrt")}square(a){return s("square")}reciprocal(a){return s("reciprocal")}relu(a){return s("relu")}relu6(a){return s("relu6")}prelu(a,u){return s("prelu")}elu(a){return s("elu")}eluDer(a,u){return s("eluDer")}selu(a){return s("selu")}int(a){return s("int")}clip(a,u,c){return s("clip")}abs(a){return s("abs")}complexAbs(a){return s("complexAbs")}sigmoid(a){return s("sigmoid")}softplus(a){return s("softplus")}sin(a){return s("sin")}cos(a){return s("cos")}tan(a){return s("tan")}asin(a){return s("asin")}acos(a){return s("acos")}atan(a){return s("atan")}atan2(a,u){return s("atan2")}sinh(a){return s("sinh")}cosh(a){return s("cosh")}tanh(a){return s("tanh")}asinh(a){return s("asinh")}acosh(a){return s("acosh")}atanh(a){return s("atanh")}erf(a){return s("erf")}step(a,u){return s("step")}fusedConv2d({input:a,filter:u,convInfo:c,bias:h,activation:f,preluActivationWeights:g}){return s("fusedConv2d")}conv2d(a,u,c){return s("conv2d")}conv2dDerInput(a,u,c){return s("conv2dDerInput")}conv2dDerFilter(a,u,c){return s("conv2dDerFilter")}fusedDepthwiseConv2D({input:a,filter:u,convInfo:c,bias:h,activation:f,preluActivationWeights:g}){return s("fusedDepthwiseConv2D")}depthwiseConv2D(a,u,c){return s("depthwiseConv2D")}depthwiseConv2DDerInput(a,u,c){return s("depthwiseConv2DDerInput")}depthwiseConv2DDerFilter(a,u,c){return s("depthwiseConv2DDerFilter")}conv3d(a,u,c){return s("conv3d")}conv3dDerInput(a,u,c){return s("conv3dDerInput")}conv3dDerFilter(a,u,c){return s("conv3dDerFilter")}maxPool(a,u){return s("maxPool")}maxPoolBackprop(a,u,c,h){return s("maxPoolBackprop")}avgPool(a,u){return s("avgPool")}avgPoolBackprop(a,u,c){return s("avgPoolBackprop")}avgPool3d(a,u){return s("avgPool3d")}avgPool3dBackprop(a,u,c){return s("avgPool3dBackprop")}maxPool3d(a,u){return s("maxPool3d")}maxPool3dBackprop(a,u,c,h){return s("maxPool3dBackprop")}reshape(a,u){return s("reshape")}cast(a,u){return s("cast")}tile(a,u){return s("tile")}pad(a,u,c){return s("pad")}transpose(a,u){return s("transpose")}gather(a,u,c){return s("gather")}gatherND(a,u){return s("gatherND")}scatterND(a,u,c){return s("scatterND")}batchToSpaceND(a,u,c){return s("batchToSpaceND")}spaceToBatchND(a,u,c){return s("spaceToBatchND")}resizeBilinear(a,u,c,h){return s("resizeBilinear")}resizeBilinearBackprop(a,u,c){return s("resizeBilinearBackprop")}resizeNearestNeighbor(a,u,c,h){return s("resizeNearestNeighbor")}resizeNearestNeighborBackprop(a,u,c){return s("resizeNearestNeighborBackprop")}batchNorm(a,u,c,h,f,g){return s("batchNorm")}localResponseNormalization4D(a,u,c,h,f){return s("localResponseNormalization4D")}LRNGrad(a,u,c,h,f,g,d){return s("LRNGrad")}multinomial(a,u,c,h){return s("multinomial")}oneHot(a,u,c,h){return s("oneHot")}cumsum(a,u,c,h){return s("cumsum")}nonMaxSuppression(a,u,c,h,f){return s("nonMaxSuppression")}fft(a){return s("fft")}ifft(a){return s("ifft")}complex(a,u){return s("complex")}real(a){return s("real")}imag(a){return s("imag")}cropAndResize(a,u,c,h,f,g){return s("cropAndResize")}depthToSpace(a,u,c){return s("depthToSpace")}split(a,u,c){return s("split")}sparseToDense(a,u,c,h){return s("sparseToDense")}diag(a){return s("diag")}fill(a,u,c){return s("fill")}onesLike(a){return s("onesLike")}zerosLike(a){return s("zerosLike")}linspace(a,u,c){return s("linspace")}dispose(){return s("dispose")}}function s(i){throw new Error(`'${i}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}},function(n,t,e){"use strict";(function(r,o){let s;function i(){if(s==null){let u;if(typeof window<"u")u=window;else if(r!==void 0)u=r;else if(o!==void 0)u=o;else{if(typeof self>"u")throw new Error("Could not find a global object");u=self}s=u}return s}function a(u,c){let h=function(){let f=i();return f._tfGlobals==null&&(f._tfGlobals=new Map),f._tfGlobals}();if(h.has(u))return h.get(u);{let f=c();return h.set(u,f),h.get(u)}}e.d(t,"b",function(){return i}),e.d(t,"a",function(){return a})}).call(this,e(21),e(44))},function(n,t,e){"use strict";e.d(t,"a",function(){return r});let r={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8}},function(n,t,e){"use strict";e.d(t,"a",function(){return c}),e.d(t,"b",function(){return i}),e.d(t,"c",function(){return a});var r=e(2),o=e(20),s=e(25);function i(h,f=0){return r.tidy(()=>{let g=r.mul(h,r.pow(2,f));return g=g.clipByValue(0,Object(o.g)(110).dataSync()[0]),g})}function a(h,f,g){return h.splice(g),function(d,p){let m=[],y=Math.floor(p/d.length),v=p%d.length;for(let T=0;T<d.length;T++){m.push(d[T]);for(let O=1;O<y;O++)m.push(-1);T<v&&m.push(-1)}let N=-1;for(let T=0;T<m.length;T++)if(m[T]!==-1){let O=m[T],S=N>=0?m[N]:0;N!==-1&&(O-=m[N]);for(let F=N+1;F<T;F++)m[F]=S+O*(F-N)/(T-N);N=T}for(let T=N+1;T<m.length;T++)m[T]=N>=0?m[T-1]:0;return m}(h,f)}function u(h){let f=h*s.f+s.e;return 10*Math.pow(2,1*f/12)}function c(d,p){return Te(this,arguments,function*(h,f,g=s.a){let m=[],y=[],v=f.length,N=r.tensor(f),T=512*Math.ceil(v/512),O=N.pad([[0,T-v]]),S=O.size/16e3,F=yield h.execute({input_audio_samples:O}),R=yield F[0].data(),L=yield F[1].data();if(32*(L.length-1)/1e3===S){let q=20;for(let U=0;U<L.length;++U){let Z=1-R[U];if(y.push(Z),Z>=s.a)q=u(L[U]),m.push(q);else{let ee=r.truncatedNormal([1],0,s.d),Q=1-(yield ee.array());m.push(q*Q),ee.dispose()}}}else{let q=T/512+1,U=new Float32Array(q);R=new Float32Array(q);for(let ee=0;ee<T;ee+=T/4){let Q=O.slice([ee],[T/4]),oe=yield h.execute({input_audio_samples:Q}),se=yield oe[0].data(),pe=yield oe[1].data(),ae=Math.floor(ee/512);R.set(se,ae),U.set(pe,ae),Q.dispose(),oe[0].dispose(),oe[1].dispose()}let Z=20;for(let ee=0;ee<U.length;++ee){let Q=1-R[ee];if(y.push(Q),Q>=g)Z=u(U[ee]),m.push(Z);else{let oe=r.truncatedNormal([1],0,s.d),se=1-(yield oe.array());m.push(Z*se),oe.dispose()}}}return F[0].dispose(),F[1].dispose(),N.dispose(),O.dispose(),{pitches:m,confidences:y}})}},function(n,t,e){"use strict";function r(o){if(this.size=0|o,this.size<=1||(this.size&this.size-1)!=0)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=o<<1;for(var s=new Array(2*this.size),i=0;i<s.length;i+=2){let g=Math.PI*i/this.size;s[i]=Math.cos(g),s[i+1]=-Math.sin(g)}this.table=s;for(var a=0,u=1;this.size>u;u<<=1)a++;this._width=a%2==0?a-1:a,this._bitrev=new Array(1<<this._width);for(var c=0;c<this._bitrev.length;c++){this._bitrev[c]=0;for(var h=0;h<this._width;h+=2){var f=this._width-h-2;this._bitrev[c]|=(c>>>h&3)<<f}}this._out=null,this._data=null,this._inv=0}n.exports=r,r.prototype.fromComplexArray=function(o,s){for(var i=s||new Array(o.length>>>1),a=0;a<o.length;a+=2)i[a>>>1]=o[a];return i},r.prototype.createComplexArray=function(){let o=new Array(this._csize);for(var s=0;s<o.length;s++)o[s]=0;return o},r.prototype.toComplexArray=function(o,s){for(var i=s||this.createComplexArray(),a=0;a<i.length;a+=2)i[a]=o[a>>>1],i[a+1]=0;return i},r.prototype.completeSpectrum=function(o){for(var s=this._csize,i=s>>>1,a=2;a<i;a+=2)o[s-a]=o[a],o[s-a+1]=-o[a+1]},r.prototype.transform=function(o,s){if(o===s)throw new Error("Input and output buffers must be different");this._out=o,this._data=s,this._inv=0,this._transform4(),this._out=null,this._data=null},r.prototype.realTransform=function(o,s){if(o===s)throw new Error("Input and output buffers must be different");this._out=o,this._data=s,this._inv=0,this._realTransform4(),this._out=null,this._data=null},r.prototype.inverseTransform=function(o,s){if(o===s)throw new Error("Input and output buffers must be different");this._out=o,this._data=s,this._inv=1,this._transform4();for(var i=0;i<o.length;i++)o[i]/=this.size;this._out=null,this._data=null},r.prototype._transform4=function(){var o,s,i=this._out,a=this._csize,u=1<<this._width,c=a/u<<1,h=this._bitrev;if(c===4)for(o=0,s=0;o<a;o+=c,s++){let v=h[s];this._singleTransform2(o,v,u)}else for(o=0,s=0;o<a;o+=c,s++){let v=h[s];this._singleTransform4(o,v,u)}var f=this._inv?-1:1,g=this.table;for(u>>=2;u>=2;u>>=2){var d=(c=a/u<<1)>>>2;for(o=0;o<a;o+=c)for(var p=o+d,m=o,y=0;m<p;m+=2,y+=u){let v=m,N=v+d,T=N+d,O=T+d,S=i[v],F=i[v+1],R=i[N],L=i[N+1],q=i[T],U=i[T+1],Z=i[O],ee=i[O+1],Q=S,oe=F,se=g[y],pe=f*g[y+1],ae=R*se-L*pe,fe=R*pe+L*se,he=g[2*y],Ee=f*g[2*y+1],Le=q*he-U*Ee,Ve=q*Ee+U*he,qe=g[3*y],je=f*g[3*y+1],Ce=Z*qe-ee*je,tt=Z*je+ee*qe,ye=Q+Le,z=oe+Ve,M=Q-Le,W=oe-Ve,ce=ae+Ce,J=fe+tt,Ie=f*(ae-Ce),Fe=f*(fe-tt),lt=ye+ce,Dt=z+J,Ht=ye-ce,an=z-J,cn=M+Fe,nn=W-Ie,Yn=M-Fe,ln=W+Ie;i[v]=lt,i[v+1]=Dt,i[N]=cn,i[N+1]=nn,i[T]=Ht,i[T+1]=an,i[O]=Yn,i[O+1]=ln}}},r.prototype._singleTransform2=function(o,s,i){let a=this._out,u=this._data,c=u[s],h=u[s+1],f=u[s+i],g=u[s+i+1],d=c+f,p=h+g,m=c-f,y=h-g;a[o]=d,a[o+1]=p,a[o+2]=m,a[o+3]=y},r.prototype._singleTransform4=function(o,s,i){let a=this._out,u=this._data,c=this._inv?-1:1,h=2*i,f=3*i,g=u[s],d=u[s+1],p=u[s+i],m=u[s+i+1],y=u[s+h],v=u[s+h+1],N=u[s+f],T=u[s+f+1],O=g+y,S=d+v,F=g-y,R=d-v,L=p+N,q=m+T,U=c*(p-N),Z=c*(m-T),ee=O+L,Q=S+q,oe=F+Z,se=R-U,pe=O-L,ae=S-q,fe=F-Z,he=R+U;a[o]=ee,a[o+1]=Q,a[o+2]=oe,a[o+3]=se,a[o+4]=pe,a[o+5]=ae,a[o+6]=fe,a[o+7]=he},r.prototype._realTransform4=function(){var o,s,i=this._out,a=this._csize,u=1<<this._width,c=a/u<<1,h=this._bitrev;if(c===4)for(o=0,s=0;o<a;o+=c,s++){let Qo=h[s];this._singleRealTransform2(o,Qo>>>1,u>>>1)}else for(o=0,s=0;o<a;o+=c,s++){let Qo=h[s];this._singleRealTransform4(o,Qo>>>1,u>>>1)}var f=this._inv?-1:1,g=this.table;for(u>>=2;u>=2;u>>=2){var d=(c=a/u<<1)>>>1,p=d>>>1,m=p>>>1;for(o=0;o<a;o+=c)for(var y=0,v=0;y<=m;y+=2,v+=u){var N=o+y,T=N+p,O=T+p,S=O+p,F=i[N],R=i[N+1],L=i[T],q=i[T+1],U=i[O],Z=i[O+1],ee=i[S],Q=i[S+1],oe=F,se=R,pe=g[v],ae=f*g[v+1],fe=L*pe-q*ae,he=L*ae+q*pe,Ee=g[2*v],Le=f*g[2*v+1],Ve=U*Ee-Z*Le,qe=U*Le+Z*Ee,je=g[3*v],Ce=f*g[3*v+1],tt=ee*je-Q*Ce,ye=ee*Ce+Q*je,z=oe+Ve,M=se+qe,W=oe-Ve,ce=se-qe,J=fe+tt,Ie=he+ye,Fe=f*(fe-tt),lt=f*(he-ye),Dt=z+J,Ht=M+Ie,an=W+lt,cn=ce-Fe;if(i[N]=Dt,i[N+1]=Ht,i[T]=an,i[T+1]=cn,y!==0){if(y!==m){var nn=W+-f*lt,Yn=-ce+-f*Fe,ln=z+-f*J,Qn=-M- -f*Ie,wn=o+p-y,_r=o+d-y;i[wn]=nn,i[wn+1]=Yn,i[_r]=ln,i[_r+1]=Qn}}else{var Ar=z-J,ss=M-Ie;i[O]=Ar,i[O+1]=ss}}}},r.prototype._singleRealTransform2=function(o,s,i){let a=this._out,u=this._data,c=u[s],h=u[s+i],f=c+h,g=c-h;a[o]=f,a[o+1]=0,a[o+2]=g,a[o+3]=0},r.prototype._singleRealTransform4=function(o,s,i){let a=this._out,u=this._data,c=this._inv?-1:1,h=2*i,f=3*i,g=u[s],d=u[s+i],p=u[s+h],m=u[s+f],y=g+p,v=g-p,N=d+m,T=c*(d-m),O=y+N,S=v,F=-T,R=y-N,L=v,q=T;a[o]=O,a[o+1]=0,a[o+2]=S,a[o+3]=F,a[o+4]=R,a[o+5]=0,a[o+6]=L,a[o+7]=q}},function(n,t){var e,r,o=n.exports={};function s(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(y){if(e===setTimeout)return setTimeout(y,0);if((e===s||!e)&&setTimeout)return e=setTimeout,setTimeout(y,0);try{return e(y,0)}catch{try{return e.call(null,y,0)}catch{return e.call(this,y,0)}}}(function(){try{e=typeof setTimeout=="function"?setTimeout:s}catch{e=s}try{r=typeof clearTimeout=="function"?clearTimeout:i}catch{r=i}})();var u,c=[],h=!1,f=-1;function g(){h&&u&&(h=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!h){var y=a(g);h=!0;for(var v=c.length;v;){for(u=c,c=[];++f<v;)u&&u[f].run();f=-1,v=c.length}u=null,h=!1,function(N){if(r===clearTimeout)return clearTimeout(N);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(N);try{r(N)}catch{try{return r.call(null,N)}catch{return r.call(this,N)}}}(y)}}function p(y,v){this.fun=y,this.array=v}function m(){}o.nextTick=function(y){var v=new Array(arguments.length-1);if(arguments.length>1)for(var N=1;N<arguments.length;N++)v[N-1]=arguments[N];c.push(new p(y,v)),c.length!==1||h||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(y){return[]},o.binding=function(y){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(y){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(n,t,e){"use strict";var r=e(69),o={body:"",args:[],thisVars:[],localVars:[]};function s(d){if(!d)return o;for(var p=0;p<d.args.length;++p){var m=d.args[p];d.args[p]=p===0?{name:m,lvalue:!0,rvalue:!!d.rvalue,count:d.count||1}:{name:m,lvalue:!1,rvalue:!0,count:1}}return d.thisVars||(d.thisVars=[]),d.localVars||(d.localVars=[]),d}function i(d){for(var p=[],m=0;m<d.args.length;++m)p.push("a"+m);return new Function("P",["return function ",d.funcName,"_ndarrayops(",p.join(","),") {P(",p.join(","),");return a0}"].join(""))(function(y){return r({args:y.args,pre:s(y.pre),body:s(y.body),post:s(y.proc),funcName:y.funcName})}(d))}var a={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var d in a){var p=a[d];t[d]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+p+"c"},funcName:d}),t[d+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a"+p+"=b"},rvalue:!0,funcName:d+"eq"}),t[d+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+p+"s"},funcName:d+"s"}),t[d+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a"+p+"=s"},rvalue:!0,funcName:d+"seq"})}})();var u={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var d in u){var p=u[d];t[d]=i({args:["array","array"],body:{args:["a","b"],body:"a="+p+"b"},funcName:d}),t[d+"eq"]=i({args:["array"],body:{args:["a"],body:"a="+p+"a"},rvalue:!0,count:2,funcName:d+"eq"})}})();var c={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var d in c){var p=c[d];t[d]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+p+"c"},funcName:d}),t[d+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+p+"s"},funcName:d+"s"}),t[d+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a=a"+p+"b"},rvalue:!0,count:2,funcName:d+"eq"}),t[d+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+p+"s"},rvalue:!0,count:2,funcName:d+"seq"})}})();var h=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var d=0;d<h.length;++d){var p=h[d];t[p]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:p}),t[p+"eq"]=i({args:["array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"eq"})}})();var f=["max","min","atan2","pow"];(function(){for(var d=0;d<f.length;++d){var p=f[d];t[p]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:p}),t[p+"s"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:p+"s"}),t[p+"eq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"eq"}),t[p+"seq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"seq"})}})();var g=["atan2","pow"];(function(){for(var d=0;d<g.length;++d){var p=g[d];t[p+"op"]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:p+"op"}),t[p+"ops"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:p+"ops"}),t[p+"opeq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"opeq"}),t[p+"opseq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"opseq"})}})(),t.any=r({args:["array"],pre:o,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=r({args:["array"],pre:o,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=r({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=r({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=r({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=r({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=i({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=i({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=i({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=r({args:["array","array"],pre:o,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},function(n,t,e){"use strict";function r(){if(typeof navigator<"u"&&navigator!=null){let s=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(s)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(s.substr(0,4))}return!1}function o(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}e.r(t),e.d(t,"isMobile",function(){return r}),e.d(t,"isBrowser",function(){return o})},function(n,t,e){var r=e(162),o=e(163),s=e(164),i=e(165),a=e(166),u=e(167),c=e(168);c.alea=r,c.xor128=o,c.xorwow=s,c.xorshift7=i,c.xor4096=a,c.tychei=u,n.exports=c},function(n,t,e){"use strict";e.r(t),e.d(t,"auxiliaryInputFromSpec",function(){return o}),e.d(t,"AuxiliaryInput",function(){return s}),e.d(t,"BinaryCounter",function(){return i});var r=e(2);function o(a){switch(a.type){case"BinaryCounter":return new i(a.args);default:throw new Error("Unknown auxiliary input: "+a)}}class s{constructor(u){this.depth=u}}class i extends s{constructor(u){super(u.numBits)}getTensors(u){let c=r.buffer([u,this.depth]);for(let h=0;h<u;++h)for(let f=0;f<this.depth;++f)c.set(Math.floor((h+1)/Math.pow(2,f))%2?1:-1,h,f);return c.toTensor().as2D(u,this.depth)}}},function(n,t,e){"use strict";n.exports=e(50)},function(n,t,e){"use strict";var r=t;function o(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=e(33),r.BufferWriter=e(59),r.Reader=e(34),r.BufferReader=e(60),r.util=e(18),r.rpc=e(61),r.roots=e(63),r.configure=o,o()},function(n,t,e){"use strict";n.exports=function(r,o){for(var s=new Array(arguments.length-1),i=0,a=2,u=!0;a<arguments.length;)s[i++]=arguments[a++];return new Promise(function(c,h){s[i]=function(f){if(u)if(u=!1,f)h(f);else{for(var g=new Array(arguments.length-1),d=0;d<g.length;)g[d++]=arguments[d];c.apply(null,g)}};try{r.apply(o||null,s)}catch(f){u&&(u=!1,h(f))}})}},function(n,t,e){"use strict";var r=t;r.length=function(a){var u=a.length;if(!u)return 0;for(var c=0;--u%4>1&&a.charAt(u)==="=";)++c;return Math.ceil(3*a.length)/4-c};for(var o=new Array(64),s=new Array(123),i=0;i<64;)s[o[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;r.encode=function(a,u,c){for(var h,f=null,g=[],d=0,p=0;u<c;){var m=a[u++];switch(p){case 0:g[d++]=o[m>>2],h=(3&m)<<4,p=1;break;case 1:g[d++]=o[h|m>>4],h=(15&m)<<2,p=2;break;case 2:g[d++]=o[h|m>>6],g[d++]=o[63&m],p=0}d>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,g)),d=0)}return p&&(g[d++]=o[h],g[d++]=61,p===1&&(g[d++]=61)),f?(d&&f.push(String.fromCharCode.apply(String,g.slice(0,d))),f.join("")):String.fromCharCode.apply(String,g.slice(0,d))},r.decode=function(a,u,c){for(var h,f=c,g=0,d=0;d<a.length;){var p=a.charCodeAt(d++);if(p===61&&g>1)break;if((p=s[p])===void 0)throw Error("invalid encoding");switch(g){case 0:h=p,g=1;break;case 1:u[c++]=h<<2|(48&p)>>4,h=p,g=2;break;case 2:u[c++]=(15&h)<<4|(60&p)>>2,h=p,g=3;break;case 3:u[c++]=(3&h)<<6|p,g=0}}if(g===1)throw Error("invalid encoding");return c-f},r.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}},function(n,t,e){"use strict";function r(){this._listeners={}}n.exports=r,r.prototype.on=function(o,s,i){return(this._listeners[o]||(this._listeners[o]=[])).push({fn:s,ctx:i||this}),this},r.prototype.off=function(o,s){if(o===void 0)this._listeners={};else if(s===void 0)this._listeners[o]=[];else for(var i=this._listeners[o],a=0;a<i.length;)i[a].fn===s?i.splice(a,1):++a;return this},r.prototype.emit=function(o){var s=this._listeners[o];if(s){for(var i=[],a=1;a<arguments.length;)i.push(arguments[a++]);for(a=0;a<s.length;)s[a].fn.apply(s[a++].ctx,i)}return this}},function(n,t,e){"use strict";function r(u){return typeof Float32Array<"u"?function(){var c=new Float32Array([-0]),h=new Uint8Array(c.buffer),f=h[3]===128;function g(y,v,N){c[0]=y,v[N]=h[0],v[N+1]=h[1],v[N+2]=h[2],v[N+3]=h[3]}function d(y,v,N){c[0]=y,v[N]=h[3],v[N+1]=h[2],v[N+2]=h[1],v[N+3]=h[0]}function p(y,v){return h[0]=y[v],h[1]=y[v+1],h[2]=y[v+2],h[3]=y[v+3],c[0]}function m(y,v){return h[3]=y[v],h[2]=y[v+1],h[1]=y[v+2],h[0]=y[v+3],c[0]}u.writeFloatLE=f?g:d,u.writeFloatBE=f?d:g,u.readFloatLE=f?p:m,u.readFloatBE=f?m:p}():function(){function c(f,g,d,p){var m=g<0?1:0;if(m&&(g=-g),g===0)f(1/g>0?0:2147483648,d,p);else if(isNaN(g))f(2143289344,d,p);else if(g>34028234663852886e22)f((m<<31|2139095040)>>>0,d,p);else if(g<11754943508222875e-54)f((m<<31|Math.round(g/1401298464324817e-60))>>>0,d,p);else{var y=Math.floor(Math.log(g)/Math.LN2);f((m<<31|y+127<<23|8388607&Math.round(g*Math.pow(2,-y)*8388608))>>>0,d,p)}}function h(f,g,d){var p=f(g,d),m=2*(p>>31)+1,y=p>>>23&255,v=8388607&p;return y===255?v?NaN:m*(1/0):y===0?1401298464324817e-60*m*v:m*Math.pow(2,y-150)*(v+8388608)}u.writeFloatLE=c.bind(null,o),u.writeFloatBE=c.bind(null,s),u.readFloatLE=h.bind(null,i),u.readFloatBE=h.bind(null,a)}(),typeof Float64Array<"u"?function(){var c=new Float64Array([-0]),h=new Uint8Array(c.buffer),f=h[7]===128;function g(y,v,N){c[0]=y,v[N]=h[0],v[N+1]=h[1],v[N+2]=h[2],v[N+3]=h[3],v[N+4]=h[4],v[N+5]=h[5],v[N+6]=h[6],v[N+7]=h[7]}function d(y,v,N){c[0]=y,v[N]=h[7],v[N+1]=h[6],v[N+2]=h[5],v[N+3]=h[4],v[N+4]=h[3],v[N+5]=h[2],v[N+6]=h[1],v[N+7]=h[0]}function p(y,v){return h[0]=y[v],h[1]=y[v+1],h[2]=y[v+2],h[3]=y[v+3],h[4]=y[v+4],h[5]=y[v+5],h[6]=y[v+6],h[7]=y[v+7],c[0]}function m(y,v){return h[7]=y[v],h[6]=y[v+1],h[5]=y[v+2],h[4]=y[v+3],h[3]=y[v+4],h[2]=y[v+5],h[1]=y[v+6],h[0]=y[v+7],c[0]}u.writeDoubleLE=f?g:d,u.writeDoubleBE=f?d:g,u.readDoubleLE=f?p:m,u.readDoubleBE=f?m:p}():function(){function c(f,g,d,p,m,y){var v=p<0?1:0;if(v&&(p=-p),p===0)f(0,m,y+g),f(1/p>0?0:2147483648,m,y+d);else if(isNaN(p))f(0,m,y+g),f(2146959360,m,y+d);else if(p>17976931348623157e292)f(0,m,y+g),f((v<<31|2146435072)>>>0,m,y+d);else{var N;if(p<22250738585072014e-324)f((N=p/5e-324)>>>0,m,y+g),f((v<<31|N/4294967296)>>>0,m,y+d);else{var T=Math.floor(Math.log(p)/Math.LN2);T===1024&&(T=1023),f(4503599627370496*(N=p*Math.pow(2,-T))>>>0,m,y+g),f((v<<31|T+1023<<20|1048576*N&1048575)>>>0,m,y+d)}}}function h(f,g,d,p,m){var y=f(p,m+g),v=f(p,m+d),N=2*(v>>31)+1,T=v>>>20&2047,O=4294967296*(1048575&v)+y;return T===2047?O?NaN:N*(1/0):T===0?5e-324*N*O:N*Math.pow(2,T-1075)*(O+4503599627370496)}u.writeDoubleLE=c.bind(null,o,0,4),u.writeDoubleBE=c.bind(null,s,4,0),u.readDoubleLE=h.bind(null,i,0,4),u.readDoubleBE=h.bind(null,a,4,0)}(),u}function o(u,c,h){c[h]=255&u,c[h+1]=u>>>8&255,c[h+2]=u>>>16&255,c[h+3]=u>>>24}function s(u,c,h){c[h]=u>>>24,c[h+1]=u>>>16&255,c[h+2]=u>>>8&255,c[h+3]=255&u}function i(u,c){return(u[c]|u[c+1]<<8|u[c+2]<<16|u[c+3]<<24)>>>0}function a(u,c){return(u[c]<<24|u[c+1]<<16|u[c+2]<<8|u[c+3])>>>0}n.exports=r(r)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}module.exports=inquire},function(n,t,e){"use strict";var r=t;r.length=function(o){for(var s=0,i=0,a=0;a<o.length;++a)(i=o.charCodeAt(a))<128?s+=1:i<2048?s+=2:(64512&i)==55296&&(64512&o.charCodeAt(a+1))==56320?(++a,s+=4):s+=3;return s},r.read=function(o,s,i){if(i-s<1)return"";for(var a,u=null,c=[],h=0;s<i;)(a=o[s++])<128?c[h++]=a:a>191&&a<224?c[h++]=(31&a)<<6|63&o[s++]:a>239&&a<365?(a=((7&a)<<18|(63&o[s++])<<12|(63&o[s++])<<6|63&o[s++])-65536,c[h++]=55296+(a>>10),c[h++]=56320+(1023&a)):c[h++]=(15&a)<<12|(63&o[s++])<<6|63&o[s++],h>8191&&((u||(u=[])).push(String.fromCharCode.apply(String,c)),h=0);return u?(h&&u.push(String.fromCharCode.apply(String,c.slice(0,h))),u.join("")):String.fromCharCode.apply(String,c.slice(0,h))},r.write=function(o,s,i){for(var a,u,c=i,h=0;h<o.length;++h)(a=o.charCodeAt(h))<128?s[i++]=a:a<2048?(s[i++]=a>>6|192,s[i++]=63&a|128):(64512&a)==55296&&(64512&(u=o.charCodeAt(h+1)))==56320?(a=65536+((1023&a)<<10)+(1023&u),++h,s[i++]=a>>18|240,s[i++]=a>>12&63|128,s[i++]=a>>6&63|128,s[i++]=63&a|128):(s[i++]=a>>12|224,s[i++]=a>>6&63|128,s[i++]=63&a|128);return i-c}},function(n,t,e){"use strict";n.exports=function(r,o,s){var i=s||8192,a=i>>>1,u=null,c=i;return function(h){if(h<1||h>a)return r(h);c+h>i&&(u=r(i),c=0);var f=o.call(u,c,c+=h);return 7&c&&(c=1+(7|c)),f}}},function(n,t,e){"use strict";n.exports=o;var r=e(18);function o(u,c){this.lo=u>>>0,this.hi=c>>>0}var s=o.zero=new o(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var i=o.zeroHash="\0\0\0\0\0\0\0\0";o.fromNumber=function(u){if(u===0)return s;var c=u<0;c&&(u=-u);var h=u>>>0,f=(u-h)/4294967296>>>0;return c&&(f=~f>>>0,h=~h>>>0,++h>4294967295&&(h=0,++f>4294967295&&(f=0))),new o(h,f)},o.from=function(u){if(typeof u=="number")return o.fromNumber(u);if(r.isString(u)){if(!r.Long)return o.fromNumber(parseInt(u,10));u=r.Long.fromString(u)}return u.low||u.high?new o(u.low>>>0,u.high>>>0):s},o.prototype.toNumber=function(u){if(!u&&this.hi>>>31){var c=1+~this.lo>>>0,h=~this.hi>>>0;return c||(h=h+1>>>0),-(c+4294967296*h)}return this.lo+4294967296*this.hi},o.prototype.toLong=function(u){return r.Long?new r.Long(0|this.lo,0|this.hi,!!u):{low:0|this.lo,high:0|this.hi,unsigned:!!u}};var a=String.prototype.charCodeAt;o.fromHash=function(u){return u===i?s:new o((a.call(u,0)|a.call(u,1)<<8|a.call(u,2)<<16|a.call(u,3)<<24)>>>0,(a.call(u,4)|a.call(u,5)<<8|a.call(u,6)<<16|a.call(u,7)<<24)>>>0)},o.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},o.prototype.zzEncode=function(){var u=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^u)>>>0,this.lo=(this.lo<<1^u)>>>0,this},o.prototype.zzDecode=function(){var u=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^u)>>>0,this.hi=(this.hi>>>1^u)>>>0,this},o.prototype.length=function(){var u=this.lo,c=(this.lo>>>28|this.hi<<4)>>>0,h=this.hi>>>24;return h===0?c===0?u<16384?u<128?1:2:u<2097152?3:4:c<16384?c<128?5:6:c<2097152?7:8:h<128?9:10}},function(n,t,e){"use strict";n.exports=s;var r=e(33);(s.prototype=Object.create(r.prototype)).constructor=s;var o=e(18);function s(){r.call(this)}function i(a,u,c){a.length<40?o.utf8.write(a,u,c):u.utf8Write?u.utf8Write(a,c):u.write(a,c)}s._configure=function(){s.alloc=o._Buffer_allocUnsafe,s.writeBytesBuffer=o.Buffer&&o.Buffer.prototype instanceof Uint8Array&&o.Buffer.prototype.set.name==="set"?function(a,u,c){u.set(a,c)}:function(a,u,c){if(a.copy)a.copy(u,c,0,a.length);else for(var h=0;h<a.length;)u[c++]=a[h++]}},s.prototype.bytes=function(a){o.isString(a)&&(a=o._Buffer_from(a,"base64"));var u=a.length>>>0;return this.uint32(u),u&&this._push(s.writeBytesBuffer,u,a),this},s.prototype.string=function(a){var u=o.Buffer.byteLength(a);return this.uint32(u),u&&this._push(i,u,a),this},s._configure()},function(n,t,e){"use strict";n.exports=s;var r=e(34);(s.prototype=Object.create(r.prototype)).constructor=s;var o=e(18);function s(i){r.call(this,i)}s._configure=function(){o.Buffer&&(s.prototype._slice=o.Buffer.prototype.slice)},s.prototype.string=function(){var i=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+i,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+i,this.len))},s._configure()},function(n,t,e){"use strict";t.Service=e(62)},function(n,t,e){"use strict";n.exports=o;var r=e(18);function o(s,i,a){if(typeof s!="function")throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=s,this.requestDelimited=!!i,this.responseDelimited=!!a}(o.prototype=Object.create(r.EventEmitter.prototype)).constructor=o,o.prototype.rpcCall=function s(i,a,u,c,h){if(!c)throw TypeError("request must be specified");var f=this;if(!h)return r.asPromise(s,f,i,a,u,c);if(f.rpcImpl)try{return f.rpcImpl(i,a[f.requestDelimited?"encodeDelimited":"encode"](c).finish(),function(g,d){if(g)return f.emit("error",g,i),h(g);if(d!==null){if(!(d instanceof u))try{d=u[f.responseDelimited?"decodeDelimited":"decode"](d)}catch(p){return f.emit("error",p,i),h(p)}return f.emit("data",d,i),h(null,d)}f.end(!0)})}catch(g){return f.emit("error",g,i),void setTimeout(function(){h(g)},0)}else setTimeout(function(){h(Error("already ended"))},0)},o.prototype.end=function(s){return this.rpcImpl&&(s||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(n,t,e){"use strict";n.exports={}},function(n){n.exports=JSON.parse('{"chromatic":["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],"lydian":["1P 2M 3M 4A 5P 6M 7M"],"major":["1P 2M 3M 4P 5P 6M 7M",["ionian"]],"mixolydian":["1P 2M 3M 4P 5P 6M 7m",["dominant"]],"dorian":["1P 2M 3m 4P 5P 6M 7m"],"aeolian":["1P 2M 3m 4P 5P 6m 7m",["minor"]],"phrygian":["1P 2m 3m 4P 5P 6m 7m"],"locrian":["1P 2m 3m 4P 5d 6m 7m"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m",["half-diminished"]],"altered":["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"phrygian dominant":["1P 2m 3M 4P 5P 6m 7m",["spanish","phrygian major"]],"half-whole diminished":["1P 2m 3m 3M 4A 5P 6M 7m",["dominant diminished"]],"diminished":["1P 2M 3m 4P 5d 6m 6M 7M",["whole-half diminished"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],"iwato":["1P 2m 4P 5d 7m"],"hirajoshi":["1P 2M 3m 5P 6m"],"kumoijoshi":["1P 2m 4P 5P 6m"],"pelog":["1P 2m 3m 5P 6m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],"prometheus":["1P 2M 3M 4A 6M 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],"ritusen":["1P 2M 4P 5P 6M"],"scriabin":["1P 2m 3M 5P 6M"],"piongio":["1P 2M 4P 5P 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],"augmented":["1P 2A 3M 5P 5A 7M"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],"neopolitan":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],"egyptian":["1P 2M 4P 5P 7m"],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],"oriental":["1P 2m 3M 4P 5d 6M 7m"],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],"flamenco":["1P 2m 3m 3M 4A 5P 7m"],"balinese":["1P 2m 3m 4P 5P 6m 7M"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],"persian":["1P 2m 3M 4P 5d 6m 7M"],"bebop":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],"enigmatic":["1P 2m 3M 5d 6m 7m 7M"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],"ichikosucho":["1P 2M 3M 4P 5d 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}')},function(n){n.exports=JSON.parse('{"4":["1P 4P 7m 10m",["quartal"]],"5":["1P 5P"],"7":["1P 3M 5P 7m",["Dominant","Dom"]],"9":["1P 3M 5P 7m 9M",["79"]],"11":["1P 5P 7m 9M 11P"],"13":["1P 3M 5P 7m 9M 13M",["13_"]],"64":["5P 8P 10M"],"M":["1P 3M 5P",["Major",""]],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],"M13":["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],"M6":["1P 3M 5P 13M",["6"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],"M69":["1P 3M 5P 6M 9M",["69"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],"M7add13":["1P 3M 5P 6M 7M 9M"],"M7b5":["1P 3M 5d 7M"],"M7b6":["1P 3M 6m 7M"],"M7b9":["1P 3M 5P 7M 9m"],"M7sus4":["1P 4P 5P 7M"],"M9":["1P 3M 5P 7M 9M",["maj9","Maj9"]],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],"M9b5":["1P 3M 5d 7M 9M"],"M9sus4":["1P 4P 5P 7M 9M"],"Madd9":["1P 3M 5P 9M",["2","add9","add2"]],"Maj7":["1P 3M 5P 7M",["maj7","M7"]],"Mb5":["1P 3M 5d"],"Mb6":["1P 3M 13m"],"Msus2":["1P 2M 5P",["add9no3","sus2"]],"Msus4":["1P 4P 5P",["sus","sus4"]],"Maddb9":["1P 3M 5P 9m"],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],"m":["1P 3m 5P"],"m#5":["1P 3m 5A",["m+","mb6"]],"m11":["1P 3m 5P 7m 9M 11P",["_11"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],"m11b5":["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],"m13":["1P 3m 5P 7m 9M 11P 13M",["_13"]],"m6":["1P 3m 4P 5P 13M",["_6"]],"m69":["1P 3m 5P 6M 9M",["_69"]],"m7":["1P 3m 5P 7m",["minor7","_","_7"]],"m7#5":["1P 3m 6m 7m"],"m7add11":["1P 3m 5P 7m 11P",["m7add4"]],"m7b5":["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],"m9":["1P 3m 5P 7m 9M",["_9"]],"m9#5":["1P 3m 6m 7m 9M"],"m9b5":["1P 3m 7m 12d 2M",["h9","-9b5"]],"mMaj7":["1P 3m 5P 7M",["mM7","_M7"]],"mMaj7b6":["1P 3m 5P 6m 7M",["mM7b6"]],"mM9":["1P 3m 5P 7M 9M",["mMaj9","-M9"]],"mM9b6":["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],"mb6M7":["1P 3m 6m 7M"],"mb6b9":["1P 3m 6m 9m"],"o":["1P 3m 5d",["mb5","dim"]],"o7":["1P 3m 5d 13M",["diminished","m6b5","dim7"]],"o7M7":["1P 3m 5d 6M 7M"],"oM7":["1P 3m 5d 7M"],"sus24":["1P 2M 4P 5P",["sus4add9"]],"+add#9":["1P 3M 5A 9A"],"madd4":["1P 3m 4P 5P"],"madd9":["1P 3m 5P 9M"]}')},function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(80),o=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var s=function(){function i(a){var u=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",o.set(this,480),a&&(o.set(this,a.header.ticksPerBeat),a.tracks.forEach(function(c){return c.forEach(function(h){h.meta&&(h.type==="timeSignature"?u.timeSignatures.push({ticks:h.absoluteTime,timeSignature:[h.numerator,h.denominator]}):h.type==="setTempo"?u.tempos.push({bpm:6e7/h.microsecondsPerBeat,ticks:h.absoluteTime}):h.type==="keySignature"&&u.keySignatures.push({key:t.keySignatureKeys[h.key+7],scale:h.scale===0?"major":"minor",ticks:h.absoluteTime}))})}),a.tracks[0].forEach(function(c){c.meta&&(c.type==="trackName"?u.name=c.text:c.type!=="text"&&c.type!=="cuePoint"&&c.type!=="marker"&&c.type!=="lyrics"||u.meta.push({text:c.text,ticks:c.absoluteTime,type:c.type}))}),this.update())}return i.prototype.update=function(){var a=this,u=0,c=0;this.tempos.sort(function(h,f){return h.ticks-f.ticks}),this.tempos.forEach(function(h,f){var g=f>0?a.tempos[f-1].bpm:a.tempos[0].bpm,d=h.ticks/a.ppq-c,p=60/g*d;h.time=p+u,u=h.time,c+=d}),this.timeSignatures.sort(function(h,f){return h.ticks-f.ticks}),this.timeSignatures.forEach(function(h,f){var g=f>0?a.timeSignatures[f-1]:a.timeSignatures[0],d=(h.ticks-g.ticks)/a.ppq/g.timeSignature[0]/(g.timeSignature[1]/4);g.measures=g.measures||0,h.measures=d+g.measures})},i.prototype.ticksToSeconds=function(a){var u=r.search(this.tempos,a);if(u!==-1){var c=this.tempos[u],h=c.time,f=(a-c.ticks)/this.ppq;return h+60/c.bpm*f}return .5*(a/this.ppq)},i.prototype.ticksToMeasures=function(a){var u=r.search(this.timeSignatures,a);if(u!==-1){var c=this.timeSignatures[u],h=(a-c.ticks)/this.ppq;return c.measures+h/(c.timeSignature[0]/c.timeSignature[1])/4}return a/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return o.get(this)},enumerable:!0,configurable:!0}),i.prototype.secondsToTicks=function(a){var u=r.search(this.tempos,a,"time");if(u!==-1){var c=this.tempos[u],h=(a-c.time)/(60/c.bpm);return Math.round(c.ticks+h*this.ppq)}var f=a/.5;return Math.round(f*this.ppq)},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(a){return{bpm:a.bpm,ticks:a.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(a){this.name=a.name,this.tempos=a.tempos.map(function(u){return Object.assign({},u)}),this.timeSignatures=a.timeSignatures.map(function(u){return Object.assign({},u)}),this.keySignatures=a.keySignatures.map(function(u){return Object.assign({},u)}),this.meta=a.meta.map(function(u){return Object.assign({},u)}),o.set(this,a.ppq),this.update()},i.prototype.setTempo=function(a){this.tempos=[{bpm:a,ticks:0}],this.update()},i}();t.Header=s},function(n,t,e){"use strict";var r=this&&this.__awaiter||function(g,d,p,m){return new(p||(p=Promise))(function(y,v){function N(S){try{O(m.next(S))}catch(F){v(F)}}function T(S){try{O(m.throw(S))}catch(F){v(F)}}function O(S){var F;S.done?y(S.value):(F=S.value,F instanceof p?F:new p(function(R){R(F)})).then(N,T)}O((m=m.apply(g,d||[])).next())})},o=this&&this.__generator||function(g,d){var p,m,y,v,N={label:0,sent:function(){if(1&y[0])throw y[1];return y[1]},trys:[],ops:[]};return v={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function T(O){return function(S){return function(F){if(p)throw new TypeError("Generator is already executing.");for(;N;)try{if(p=1,m&&(y=2&F[0]?m.return:F[0]?m.throw||((y=m.return)&&y.call(m),0):m.next)&&!(y=y.call(m,F[1])).done)return y;switch(m=0,y&&(F=[2&F[0],y.value]),F[0]){case 0:case 1:y=F;break;case 4:return N.label++,{value:F[1],done:!1};case 5:N.label++,m=F[1],F=[0];continue;case 7:F=N.ops.pop(),N.trys.pop();continue;default:if(y=N.trys,!((y=y.length>0&&y[y.length-1])||F[0]!==6&&F[0]!==2)){N=0;continue}if(F[0]===3&&(!y||F[1]>y[0]&&F[1]<y[3])){N.label=F[1];break}if(F[0]===6&&N.label<y[1]){N.label=y[1],y=F;break}if(y&&N.label<y[2]){N.label=y[2],N.ops.push(F);break}y[2]&&N.ops.pop(),N.trys.pop();continue}F=d.call(g,N)}catch(R){F=[6,R],m=0}finally{p=y=0}if(5&F[0])throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}([O,S])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=e(79),i=e(174),a=e(66),u=e(81),c=function(){function g(d){var p=this,m=null;d&&(d instanceof ArrayBuffer&&(d=new Uint8Array(d)),(m=s.parseMidi(d)).tracks.forEach(function(y){var v=0;y.forEach(function(N){v+=N.deltaTime,N.absoluteTime=v})}),m.tracks=function(y){for(var v=[],N=0;N<y.length;N++)for(var T=v.length,O=new Map,S=Array(16).fill(0),F=0,R=y[N];F<R.length;F++){var L=R[F],q=T,U=L.channel;if(U!==void 0){L.type==="programChange"&&(S[U]=L.programNumber);var Z=S[U]+" "+U;O.has(Z)?q=O.get(Z):(q=T+O.size,O.set(Z,q))}v[q]||v.push([]),v[q].push(L)}return v}(m.tracks)),this.header=new a.Header(m),this.tracks=[],d&&(this.tracks=m.tracks.map(function(y){return new u.Track(y,p.header)}),m.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return g.fromUrl=function(d){return r(this,void 0,void 0,function(){var p;return o(this,function(m){switch(m.label){case 0:return[4,fetch(d)];case 1:return(p=m.sent()).ok?[4,p.arrayBuffer()]:[3,3];case 2:return[2,new g(m.sent())];case 3:throw new Error("could not load "+d)}})})},Object.defineProperty(g.prototype,"name",{get:function(){return this.header.name},set:function(d){this.header.name=d},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"duration",{get:function(){var d=this.tracks.map(function(p){return p.duration});return Math.max.apply(Math,d)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"durationTicks",{get:function(){var d=this.tracks.map(function(p){return p.durationTicks});return Math.max.apply(Math,d)},enumerable:!0,configurable:!0}),g.prototype.addTrack=function(){var d=new u.Track(void 0,this.header);return this.tracks.push(d),d},g.prototype.toArray=function(){return i.encode(this)},g.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(d){return d.toJSON()})}},g.prototype.fromJSON=function(d){var p=this;this.header=new a.Header,this.header.fromJSON(d.header),this.tracks=d.tracks.map(function(m){var y=new u.Track(void 0,p.header);return y.fromJSON(m),y})},g.prototype.clone=function(){var d=new g;return d.fromJSON(this.toJSON()),d},g}();t.Midi=c;var h=e(81);t.Track=h.Track;var f=e(66);t.Header=f.Header},function(n,t,e){"use strict";(function(r){var o=e(75),s=e(76),i=e(77);function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(z,M){if(a()<M)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(z=new Uint8Array(M)).__proto__=c.prototype:(z===null&&(z=new c(M)),z.length=M),z}function c(z,M,W){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(z,M,W);if(typeof z=="number"){if(typeof M=="string")throw new Error("If encoding is specified then the first argument must be a string");return g(this,z)}return h(this,z,M,W)}function h(z,M,W,ce){if(typeof M=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&M instanceof ArrayBuffer?function(J,Ie,Fe,lt){if(Ie.byteLength,Fe<0||Ie.byteLength<Fe)throw new RangeError("'offset' is out of bounds");if(Ie.byteLength<Fe+(lt||0))throw new RangeError("'length' is out of bounds");return Ie=Fe===void 0&&lt===void 0?new Uint8Array(Ie):lt===void 0?new Uint8Array(Ie,Fe):new Uint8Array(Ie,Fe,lt),c.TYPED_ARRAY_SUPPORT?(J=Ie).__proto__=c.prototype:J=d(J,Ie),J}(z,M,W,ce):typeof M=="string"?function(J,Ie,Fe){if(typeof Fe=="string"&&Fe!==""||(Fe="utf8"),!c.isEncoding(Fe))throw new TypeError('"encoding" must be a valid string encoding');var lt=0|m(Ie,Fe),Dt=(J=u(J,lt)).write(Ie,Fe);return Dt!==lt&&(J=J.slice(0,Dt)),J}(z,M,W):function(J,Ie){if(c.isBuffer(Ie)){var Fe=0|p(Ie.length);return(J=u(J,Fe)).length===0||Ie.copy(J,0,0,Fe),J}if(Ie){if(typeof ArrayBuffer<"u"&&Ie.buffer instanceof ArrayBuffer||"length"in Ie)return typeof Ie.length!="number"||(lt=Ie.length)!=lt?u(J,0):d(J,Ie);if(Ie.type==="Buffer"&&i(Ie.data))return d(J,Ie.data)}var lt;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(z,M)}function f(z){if(typeof z!="number")throw new TypeError('"size" argument must be a number');if(z<0)throw new RangeError('"size" argument must not be negative')}function g(z,M){if(f(M),z=u(z,M<0?0:0|p(M)),!c.TYPED_ARRAY_SUPPORT)for(var W=0;W<M;++W)z[W]=0;return z}function d(z,M){var W=M.length<0?0:0|p(M.length);z=u(z,W);for(var ce=0;ce<W;ce+=1)z[ce]=255&M[ce];return z}function p(z){if(z>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|z}function m(z,M){if(c.isBuffer(z))return z.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(z)||z instanceof ArrayBuffer))return z.byteLength;typeof z!="string"&&(z=""+z);var W=z.length;if(W===0)return 0;for(var ce=!1;;)switch(M){case"ascii":case"latin1":case"binary":return W;case"utf8":case"utf-8":case void 0:return Ce(z).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*W;case"hex":return W>>>1;case"base64":return tt(z).length;default:if(ce)return Ce(z).length;M=(""+M).toLowerCase(),ce=!0}}function y(z,M,W){var ce=!1;if((M===void 0||M<0)&&(M=0),M>this.length||((W===void 0||W>this.length)&&(W=this.length),W<=0)||(W>>>=0)<=(M>>>=0))return"";for(z||(z="utf8");;)switch(z){case"hex":return oe(this,M,W);case"utf8":case"utf-8":return Z(this,M,W);case"ascii":return ee(this,M,W);case"latin1":case"binary":return Q(this,M,W);case"base64":return U(this,M,W);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return se(this,M,W);default:if(ce)throw new TypeError("Unknown encoding: "+z);z=(z+"").toLowerCase(),ce=!0}}function v(z,M,W){var ce=z[M];z[M]=z[W],z[W]=ce}function N(z,M,W,ce,J){if(z.length===0)return-1;if(typeof W=="string"?(ce=W,W=0):W>2147483647?W=2147483647:W<-2147483648&&(W=-2147483648),W=+W,isNaN(W)&&(W=J?0:z.length-1),W<0&&(W=z.length+W),W>=z.length){if(J)return-1;W=z.length-1}else if(W<0){if(!J)return-1;W=0}if(typeof M=="string"&&(M=c.from(M,ce)),c.isBuffer(M))return M.length===0?-1:T(z,M,W,ce,J);if(typeof M=="number")return M&=255,c.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?J?Uint8Array.prototype.indexOf.call(z,M,W):Uint8Array.prototype.lastIndexOf.call(z,M,W):T(z,[M],W,ce,J);throw new TypeError("val must be string, number or Buffer")}function T(z,M,W,ce,J){var Ie,Fe=1,lt=z.length,Dt=M.length;if(ce!==void 0&&((ce=String(ce).toLowerCase())==="ucs2"||ce==="ucs-2"||ce==="utf16le"||ce==="utf-16le")){if(z.length<2||M.length<2)return-1;Fe=2,lt/=2,Dt/=2,W/=2}function Ht(Yn,ln){return Fe===1?Yn[ln]:Yn.readUInt16BE(ln*Fe)}if(J){var an=-1;for(Ie=W;Ie<lt;Ie++)if(Ht(z,Ie)===Ht(M,an===-1?0:Ie-an)){if(an===-1&&(an=Ie),Ie-an+1===Dt)return an*Fe}else an!==-1&&(Ie-=Ie-an),an=-1}else for(W+Dt>lt&&(W=lt-Dt),Ie=W;Ie>=0;Ie--){for(var cn=!0,nn=0;nn<Dt;nn++)if(Ht(z,Ie+nn)!==Ht(M,nn)){cn=!1;break}if(cn)return Ie}return-1}function O(z,M,W,ce){W=Number(W)||0;var J=z.length-W;ce?(ce=Number(ce))>J&&(ce=J):ce=J;var Ie=M.length;if(Ie%2!=0)throw new TypeError("Invalid hex string");ce>Ie/2&&(ce=Ie/2);for(var Fe=0;Fe<ce;++Fe){var lt=parseInt(M.substr(2*Fe,2),16);if(isNaN(lt))return Fe;z[W+Fe]=lt}return Fe}function S(z,M,W,ce){return ye(Ce(M,z.length-W),z,W,ce)}function F(z,M,W,ce){return ye(function(J){for(var Ie=[],Fe=0;Fe<J.length;++Fe)Ie.push(255&J.charCodeAt(Fe));return Ie}(M),z,W,ce)}function R(z,M,W,ce){return F(z,M,W,ce)}function L(z,M,W,ce){return ye(tt(M),z,W,ce)}function q(z,M,W,ce){return ye(function(J,Ie){for(var Fe,lt,Dt,Ht=[],an=0;an<J.length&&!((Ie-=2)<0);++an)Fe=J.charCodeAt(an),lt=Fe>>8,Dt=Fe%256,Ht.push(Dt),Ht.push(lt);return Ht}(M,z.length-W),z,W,ce)}function U(z,M,W){return M===0&&W===z.length?o.fromByteArray(z):o.fromByteArray(z.slice(M,W))}function Z(z,M,W){W=Math.min(z.length,W);for(var ce=[],J=M;J<W;){var Ie,Fe,lt,Dt,Ht=z[J],an=null,cn=Ht>239?4:Ht>223?3:Ht>191?2:1;if(J+cn<=W)switch(cn){case 1:Ht<128&&(an=Ht);break;case 2:(192&(Ie=z[J+1]))==128&&(Dt=(31&Ht)<<6|63&Ie)>127&&(an=Dt);break;case 3:Ie=z[J+1],Fe=z[J+2],(192&Ie)==128&&(192&Fe)==128&&(Dt=(15&Ht)<<12|(63&Ie)<<6|63&Fe)>2047&&(Dt<55296||Dt>57343)&&(an=Dt);break;case 4:Ie=z[J+1],Fe=z[J+2],lt=z[J+3],(192&Ie)==128&&(192&Fe)==128&&(192&lt)==128&&(Dt=(15&Ht)<<18|(63&Ie)<<12|(63&Fe)<<6|63&lt)>65535&&Dt<1114112&&(an=Dt)}an===null?(an=65533,cn=1):an>65535&&(an-=65536,ce.push(an>>>10&1023|55296),an=56320|1023&an),ce.push(an),J+=cn}return function(nn){var Yn=nn.length;if(Yn<=4096)return String.fromCharCode.apply(String,nn);for(var ln="",Qn=0;Qn<Yn;)ln+=String.fromCharCode.apply(String,nn.slice(Qn,Qn+=4096));return ln}(ce)}t.Buffer=c,t.SlowBuffer=function(z){return+z!=z&&(z=0),c.alloc(+z)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=r.TYPED_ARRAY_SUPPORT!==void 0?r.TYPED_ARRAY_SUPPORT:function(){try{var z=new Uint8Array(1);return z.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},z.foo()===42&&typeof z.subarray=="function"&&z.subarray(1,1).byteLength===0}catch{return!1}}(),t.kMaxLength=a(),c.poolSize=8192,c._augment=function(z){return z.__proto__=c.prototype,z},c.from=function(z,M,W){return h(null,z,M,W)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(z,M,W){return function(ce,J,Ie,Fe){return f(J),J<=0?u(ce,J):Ie!==void 0?typeof Fe=="string"?u(ce,J).fill(Ie,Fe):u(ce,J).fill(Ie):u(ce,J)}(null,z,M,W)},c.allocUnsafe=function(z){return g(null,z)},c.allocUnsafeSlow=function(z){return g(null,z)},c.isBuffer=function(z){return!(z==null||!z._isBuffer)},c.compare=function(z,M){if(!c.isBuffer(z)||!c.isBuffer(M))throw new TypeError("Arguments must be Buffers");if(z===M)return 0;for(var W=z.length,ce=M.length,J=0,Ie=Math.min(W,ce);J<Ie;++J)if(z[J]!==M[J]){W=z[J],ce=M[J];break}return W<ce?-1:ce<W?1:0},c.isEncoding=function(z){switch(String(z).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(z,M){if(!i(z))throw new TypeError('"list" argument must be an Array of Buffers');if(z.length===0)return c.alloc(0);var W;if(M===void 0)for(M=0,W=0;W<z.length;++W)M+=z[W].length;var ce=c.allocUnsafe(M),J=0;for(W=0;W<z.length;++W){var Ie=z[W];if(!c.isBuffer(Ie))throw new TypeError('"list" argument must be an Array of Buffers');Ie.copy(ce,J),J+=Ie.length}return ce},c.byteLength=m,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var z=this.length;if(z%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var M=0;M<z;M+=2)v(this,M,M+1);return this},c.prototype.swap32=function(){var z=this.length;if(z%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var M=0;M<z;M+=4)v(this,M,M+3),v(this,M+1,M+2);return this},c.prototype.swap64=function(){var z=this.length;if(z%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var M=0;M<z;M+=8)v(this,M,M+7),v(this,M+1,M+6),v(this,M+2,M+5),v(this,M+3,M+4);return this},c.prototype.toString=function(){var z=0|this.length;return z===0?"":arguments.length===0?Z(this,0,z):y.apply(this,arguments)},c.prototype.equals=function(z){if(!c.isBuffer(z))throw new TypeError("Argument must be a Buffer");return this===z||c.compare(this,z)===0},c.prototype.inspect=function(){var z="",M=t.INSPECT_MAX_BYTES;return this.length>0&&(z=this.toString("hex",0,M).match(/.{2}/g).join(" "),this.length>M&&(z+=" ... ")),"<Buffer "+z+">"},c.prototype.compare=function(z,M,W,ce,J){if(!c.isBuffer(z))throw new TypeError("Argument must be a Buffer");if(M===void 0&&(M=0),W===void 0&&(W=z?z.length:0),ce===void 0&&(ce=0),J===void 0&&(J=this.length),M<0||W>z.length||ce<0||J>this.length)throw new RangeError("out of range index");if(ce>=J&&M>=W)return 0;if(ce>=J)return-1;if(M>=W)return 1;if(this===z)return 0;for(var Ie=(J>>>=0)-(ce>>>=0),Fe=(W>>>=0)-(M>>>=0),lt=Math.min(Ie,Fe),Dt=this.slice(ce,J),Ht=z.slice(M,W),an=0;an<lt;++an)if(Dt[an]!==Ht[an]){Ie=Dt[an],Fe=Ht[an];break}return Ie<Fe?-1:Fe<Ie?1:0},c.prototype.includes=function(z,M,W){return this.indexOf(z,M,W)!==-1},c.prototype.indexOf=function(z,M,W){return N(this,z,M,W,!0)},c.prototype.lastIndexOf=function(z,M,W){return N(this,z,M,W,!1)},c.prototype.write=function(z,M,W,ce){if(M===void 0)ce="utf8",W=this.length,M=0;else if(W===void 0&&typeof M=="string")ce=M,W=this.length,M=0;else{if(!isFinite(M))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");M|=0,isFinite(W)?(W|=0,ce===void 0&&(ce="utf8")):(ce=W,W=void 0)}var J=this.length-M;if((W===void 0||W>J)&&(W=J),z.length>0&&(W<0||M<0)||M>this.length)throw new RangeError("Attempt to write outside buffer bounds");ce||(ce="utf8");for(var Ie=!1;;)switch(ce){case"hex":return O(this,z,M,W);case"utf8":case"utf-8":return S(this,z,M,W);case"ascii":return F(this,z,M,W);case"latin1":case"binary":return R(this,z,M,W);case"base64":return L(this,z,M,W);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return q(this,z,M,W);default:if(Ie)throw new TypeError("Unknown encoding: "+ce);ce=(""+ce).toLowerCase(),Ie=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ee(z,M,W){var ce="";W=Math.min(z.length,W);for(var J=M;J<W;++J)ce+=String.fromCharCode(127&z[J]);return ce}function Q(z,M,W){var ce="";W=Math.min(z.length,W);for(var J=M;J<W;++J)ce+=String.fromCharCode(z[J]);return ce}function oe(z,M,W){var ce=z.length;(!M||M<0)&&(M=0),(!W||W<0||W>ce)&&(W=ce);for(var J="",Ie=M;Ie<W;++Ie)J+=je(z[Ie]);return J}function se(z,M,W){for(var ce=z.slice(M,W),J="",Ie=0;Ie<ce.length;Ie+=2)J+=String.fromCharCode(ce[Ie]+256*ce[Ie+1]);return J}function pe(z,M,W){if(z%1!=0||z<0)throw new RangeError("offset is not uint");if(z+M>W)throw new RangeError("Trying to access beyond buffer length")}function ae(z,M,W,ce,J,Ie){if(!c.isBuffer(z))throw new TypeError('"buffer" argument must be a Buffer instance');if(M>J||M<Ie)throw new RangeError('"value" argument is out of bounds');if(W+ce>z.length)throw new RangeError("Index out of range")}function fe(z,M,W,ce){M<0&&(M=65535+M+1);for(var J=0,Ie=Math.min(z.length-W,2);J<Ie;++J)z[W+J]=(M&255<<8*(ce?J:1-J))>>>8*(ce?J:1-J)}function he(z,M,W,ce){M<0&&(M=4294967295+M+1);for(var J=0,Ie=Math.min(z.length-W,4);J<Ie;++J)z[W+J]=M>>>8*(ce?J:3-J)&255}function Ee(z,M,W,ce,J,Ie){if(W+ce>z.length)throw new RangeError("Index out of range");if(W<0)throw new RangeError("Index out of range")}function Le(z,M,W,ce,J){return J||Ee(z,0,W,4),s.write(z,M,W,ce,23,4),W+4}function Ve(z,M,W,ce,J){return J||Ee(z,0,W,8),s.write(z,M,W,ce,52,8),W+8}c.prototype.slice=function(z,M){var W,ce=this.length;if((z=~~z)<0?(z+=ce)<0&&(z=0):z>ce&&(z=ce),(M=M===void 0?ce:~~M)<0?(M+=ce)<0&&(M=0):M>ce&&(M=ce),M<z&&(M=z),c.TYPED_ARRAY_SUPPORT)(W=this.subarray(z,M)).__proto__=c.prototype;else{var J=M-z;W=new c(J,void 0);for(var Ie=0;Ie<J;++Ie)W[Ie]=this[Ie+z]}return W},c.prototype.readUIntLE=function(z,M,W){z|=0,M|=0,W||pe(z,M,this.length);for(var ce=this[z],J=1,Ie=0;++Ie<M&&(J*=256);)ce+=this[z+Ie]*J;return ce},c.prototype.readUIntBE=function(z,M,W){z|=0,M|=0,W||pe(z,M,this.length);for(var ce=this[z+--M],J=1;M>0&&(J*=256);)ce+=this[z+--M]*J;return ce},c.prototype.readUInt8=function(z,M){return M||pe(z,1,this.length),this[z]},c.prototype.readUInt16LE=function(z,M){return M||pe(z,2,this.length),this[z]|this[z+1]<<8},c.prototype.readUInt16BE=function(z,M){return M||pe(z,2,this.length),this[z]<<8|this[z+1]},c.prototype.readUInt32LE=function(z,M){return M||pe(z,4,this.length),(this[z]|this[z+1]<<8|this[z+2]<<16)+16777216*this[z+3]},c.prototype.readUInt32BE=function(z,M){return M||pe(z,4,this.length),16777216*this[z]+(this[z+1]<<16|this[z+2]<<8|this[z+3])},c.prototype.readIntLE=function(z,M,W){z|=0,M|=0,W||pe(z,M,this.length);for(var ce=this[z],J=1,Ie=0;++Ie<M&&(J*=256);)ce+=this[z+Ie]*J;return ce>=(J*=128)&&(ce-=Math.pow(2,8*M)),ce},c.prototype.readIntBE=function(z,M,W){z|=0,M|=0,W||pe(z,M,this.length);for(var ce=M,J=1,Ie=this[z+--ce];ce>0&&(J*=256);)Ie+=this[z+--ce]*J;return Ie>=(J*=128)&&(Ie-=Math.pow(2,8*M)),Ie},c.prototype.readInt8=function(z,M){return M||pe(z,1,this.length),128&this[z]?-1*(255-this[z]+1):this[z]},c.prototype.readInt16LE=function(z,M){M||pe(z,2,this.length);var W=this[z]|this[z+1]<<8;return 32768&W?4294901760|W:W},c.prototype.readInt16BE=function(z,M){M||pe(z,2,this.length);var W=this[z+1]|this[z]<<8;return 32768&W?4294901760|W:W},c.prototype.readInt32LE=function(z,M){return M||pe(z,4,this.length),this[z]|this[z+1]<<8|this[z+2]<<16|this[z+3]<<24},c.prototype.readInt32BE=function(z,M){return M||pe(z,4,this.length),this[z]<<24|this[z+1]<<16|this[z+2]<<8|this[z+3]},c.prototype.readFloatLE=function(z,M){return M||pe(z,4,this.length),s.read(this,z,!0,23,4)},c.prototype.readFloatBE=function(z,M){return M||pe(z,4,this.length),s.read(this,z,!1,23,4)},c.prototype.readDoubleLE=function(z,M){return M||pe(z,8,this.length),s.read(this,z,!0,52,8)},c.prototype.readDoubleBE=function(z,M){return M||pe(z,8,this.length),s.read(this,z,!1,52,8)},c.prototype.writeUIntLE=function(z,M,W,ce){z=+z,M|=0,W|=0,ce||ae(this,z,M,W,Math.pow(2,8*W)-1,0);var J=1,Ie=0;for(this[M]=255&z;++Ie<W&&(J*=256);)this[M+Ie]=z/J&255;return M+W},c.prototype.writeUIntBE=function(z,M,W,ce){z=+z,M|=0,W|=0,ce||ae(this,z,M,W,Math.pow(2,8*W)-1,0);var J=W-1,Ie=1;for(this[M+J]=255&z;--J>=0&&(Ie*=256);)this[M+J]=z/Ie&255;return M+W},c.prototype.writeUInt8=function(z,M,W){return z=+z,M|=0,W||ae(this,z,M,1,255,0),c.TYPED_ARRAY_SUPPORT||(z=Math.floor(z)),this[M]=255&z,M+1},c.prototype.writeUInt16LE=function(z,M,W){return z=+z,M|=0,W||ae(this,z,M,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[M]=255&z,this[M+1]=z>>>8):fe(this,z,M,!0),M+2},c.prototype.writeUInt16BE=function(z,M,W){return z=+z,M|=0,W||ae(this,z,M,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[M]=z>>>8,this[M+1]=255&z):fe(this,z,M,!1),M+2},c.prototype.writeUInt32LE=function(z,M,W){return z=+z,M|=0,W||ae(this,z,M,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[M+3]=z>>>24,this[M+2]=z>>>16,this[M+1]=z>>>8,this[M]=255&z):he(this,z,M,!0),M+4},c.prototype.writeUInt32BE=function(z,M,W){return z=+z,M|=0,W||ae(this,z,M,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[M]=z>>>24,this[M+1]=z>>>16,this[M+2]=z>>>8,this[M+3]=255&z):he(this,z,M,!1),M+4},c.prototype.writeIntLE=function(z,M,W,ce){if(z=+z,M|=0,!ce){var J=Math.pow(2,8*W-1);ae(this,z,M,W,J-1,-J)}var Ie=0,Fe=1,lt=0;for(this[M]=255&z;++Ie<W&&(Fe*=256);)z<0&&lt===0&&this[M+Ie-1]!==0&&(lt=1),this[M+Ie]=(z/Fe>>0)-lt&255;return M+W},c.prototype.writeIntBE=function(z,M,W,ce){if(z=+z,M|=0,!ce){var J=Math.pow(2,8*W-1);ae(this,z,M,W,J-1,-J)}var Ie=W-1,Fe=1,lt=0;for(this[M+Ie]=255&z;--Ie>=0&&(Fe*=256);)z<0&&lt===0&&this[M+Ie+1]!==0&&(lt=1),this[M+Ie]=(z/Fe>>0)-lt&255;return M+W},c.prototype.writeInt8=function(z,M,W){return z=+z,M|=0,W||ae(this,z,M,1,127,-128),c.TYPED_ARRAY_SUPPORT||(z=Math.floor(z)),z<0&&(z=255+z+1),this[M]=255&z,M+1},c.prototype.writeInt16LE=function(z,M,W){return z=+z,M|=0,W||ae(this,z,M,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[M]=255&z,this[M+1]=z>>>8):fe(this,z,M,!0),M+2},c.prototype.writeInt16BE=function(z,M,W){return z=+z,M|=0,W||ae(this,z,M,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[M]=z>>>8,this[M+1]=255&z):fe(this,z,M,!1),M+2},c.prototype.writeInt32LE=function(z,M,W){return z=+z,M|=0,W||ae(this,z,M,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[M]=255&z,this[M+1]=z>>>8,this[M+2]=z>>>16,this[M+3]=z>>>24):he(this,z,M,!0),M+4},c.prototype.writeInt32BE=function(z,M,W){return z=+z,M|=0,W||ae(this,z,M,4,2147483647,-2147483648),z<0&&(z=4294967295+z+1),c.TYPED_ARRAY_SUPPORT?(this[M]=z>>>24,this[M+1]=z>>>16,this[M+2]=z>>>8,this[M+3]=255&z):he(this,z,M,!1),M+4},c.prototype.writeFloatLE=function(z,M,W){return Le(this,z,M,!0,W)},c.prototype.writeFloatBE=function(z,M,W){return Le(this,z,M,!1,W)},c.prototype.writeDoubleLE=function(z,M,W){return Ve(this,z,M,!0,W)},c.prototype.writeDoubleBE=function(z,M,W){return Ve(this,z,M,!1,W)},c.prototype.copy=function(z,M,W,ce){if(W||(W=0),ce||ce===0||(ce=this.length),M>=z.length&&(M=z.length),M||(M=0),ce>0&&ce<W&&(ce=W),ce===W||z.length===0||this.length===0)return 0;if(M<0)throw new RangeError("targetStart out of bounds");if(W<0||W>=this.length)throw new RangeError("sourceStart out of bounds");if(ce<0)throw new RangeError("sourceEnd out of bounds");ce>this.length&&(ce=this.length),z.length-M<ce-W&&(ce=z.length-M+W);var J,Ie=ce-W;if(this===z&&W<M&&M<ce)for(J=Ie-1;J>=0;--J)z[J+M]=this[J+W];else if(Ie<1e3||!c.TYPED_ARRAY_SUPPORT)for(J=0;J<Ie;++J)z[J+M]=this[J+W];else Uint8Array.prototype.set.call(z,this.subarray(W,W+Ie),M);return Ie},c.prototype.fill=function(z,M,W,ce){if(typeof z=="string"){if(typeof M=="string"?(ce=M,M=0,W=this.length):typeof W=="string"&&(ce=W,W=this.length),z.length===1){var J=z.charCodeAt(0);J<256&&(z=J)}if(ce!==void 0&&typeof ce!="string")throw new TypeError("encoding must be a string");if(typeof ce=="string"&&!c.isEncoding(ce))throw new TypeError("Unknown encoding: "+ce)}else typeof z=="number"&&(z&=255);if(M<0||this.length<M||this.length<W)throw new RangeError("Out of range index");if(W<=M)return this;var Ie;if(M>>>=0,W=W===void 0?this.length:W>>>0,z||(z=0),typeof z=="number")for(Ie=M;Ie<W;++Ie)this[Ie]=z;else{var Fe=c.isBuffer(z)?z:Ce(new c(z,ce).toString()),lt=Fe.length;for(Ie=0;Ie<W-M;++Ie)this[Ie+M]=Fe[Ie%lt]}return this};var qe=/[^+\/0-9A-Za-z-_]/g;function je(z){return z<16?"0"+z.toString(16):z.toString(16)}function Ce(z,M){var W;M=M||1/0;for(var ce=z.length,J=null,Ie=[],Fe=0;Fe<ce;++Fe){if((W=z.charCodeAt(Fe))>55295&&W<57344){if(!J){if(W>56319){(M-=3)>-1&&Ie.push(239,191,189);continue}if(Fe+1===ce){(M-=3)>-1&&Ie.push(239,191,189);continue}J=W;continue}if(W<56320){(M-=3)>-1&&Ie.push(239,191,189),J=W;continue}W=65536+(J-55296<<10|W-56320)}else J&&(M-=3)>-1&&Ie.push(239,191,189);if(J=null,W<128){if((M-=1)<0)break;Ie.push(W)}else if(W<2048){if((M-=2)<0)break;Ie.push(W>>6|192,63&W|128)}else if(W<65536){if((M-=3)<0)break;Ie.push(W>>12|224,W>>6&63|128,63&W|128)}else{if(!(W<1114112))throw new Error("Invalid code point");if((M-=4)<0)break;Ie.push(W>>18|240,W>>12&63|128,W>>6&63|128,63&W|128)}}return Ie}function tt(z){return o.toByteArray(function(M){if((M=function(W){return W.trim?W.trim():W.replace(/^\s+|\s+$/g,"")}(M).replace(qe,"")).length<2)return"";for(;M.length%4!=0;)M+="=";return M}(z))}function ye(z,M,W,ce){for(var J=0;J<ce&&!(J+W>=M.length||J>=z.length);++J)M[J+W]=z[J];return J}}).call(this,e(21))},function(n,t,e){"use strict";var r=e(87);function o(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}n.exports=function(s){var i=new o;i.pre=s.pre,i.body=s.body,i.post=s.post;var a=s.args.slice(0);i.argTypes=a;for(var u=0;u<a.length;++u){var c=a[u];if(c==="array"||typeof c=="object"&&c.blockIndices){if(i.argTypes[u]="array",i.arrayArgs.push(u),i.arrayBlockIndices.push(c.blockIndices?c.blockIndices:0),i.shimArgs.push("array"+u),u<i.pre.args.length&&i.pre.args[u].count>0)throw new Error("cwise: pre() block may not reference array args");if(u<i.post.args.length&&i.post.args[u].count>0)throw new Error("cwise: post() block may not reference array args")}else if(c==="scalar")i.scalarArgs.push(u),i.shimArgs.push("scalar"+u);else if(c==="index"){if(i.indexArgs.push(u),u<i.pre.args.length&&i.pre.args[u].count>0)throw new Error("cwise: pre() block may not reference array index");if(u<i.body.args.length&&i.body.args[u].lvalue)throw new Error("cwise: body() block may not write to array index");if(u<i.post.args.length&&i.post.args[u].count>0)throw new Error("cwise: post() block may not reference array index")}else if(c==="shape"){if(i.shapeArgs.push(u),u<i.pre.args.length&&i.pre.args[u].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(u<i.body.args.length&&i.body.args[u].lvalue)throw new Error("cwise: body() block may not write to array shape");if(u<i.post.args.length&&i.post.args[u].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if(typeof c!="object"||!c.offset)throw new Error("cwise: Unknown argument type "+a[u]);i.argTypes[u]="offset",i.offsetArgs.push({array:c.array,offset:c.offset}),i.offsetArgIndex.push(u)}}if(i.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(i.pre.args.length>a.length)throw new Error("cwise: Too many arguments in pre() block");if(i.body.args.length>a.length)throw new Error("cwise: Too many arguments in body() block");if(i.post.args.length>a.length)throw new Error("cwise: Too many arguments in post() block");return i.debug=!!s.printCode||!!s.debug,i.funcName=s.funcName||"cwise",i.blockSize=s.blockSize||64,r(i)}},function(n,t,e){"use strict";n.exports=function(r,o,s){return r.length===0?r:o?(s||r.sort(o),function(i,a){for(var u=1,c=i.length,h=i[0],f=i[0],g=1;g<c;++g)if(f=h,a(h=i[g],f)){if(g===u){u++;continue}i[u++]=h}return i.length=u,i}(r,o)):(s||r.sort(),function(i){for(var a=1,u=i.length,c=i[0],h=i[0],f=1;f<u;++f,h=c)if(h=c,(c=i[f])!==h){if(f===a){a++;continue}i[a++]=c}return i.length=a,i}(r))}},function(n,t,e){"use strict";(function(r){var o=e(72),s=e(89),i=e(68).Buffer;r.__TYPEDARRAY_POOL||(r.__TYPEDARRAY_POOL={UINT8:s([32,0]),UINT16:s([32,0]),UINT32:s([32,0]),BIGUINT64:s([32,0]),INT8:s([32,0]),INT16:s([32,0]),INT32:s([32,0]),BIGINT64:s([32,0]),FLOAT:s([32,0]),DOUBLE:s([32,0]),DATA:s([32,0]),UINT8C:s([32,0]),BUFFER:s([32,0])});var a=typeof Uint8ClampedArray<"u",u=typeof BigUint64Array<"u",c=typeof BigInt64Array<"u",h=r.__TYPEDARRAY_POOL;h.UINT8C||(h.UINT8C=s([32,0])),h.BIGUINT64||(h.BIGUINT64=s([32,0])),h.BIGINT64||(h.BIGINT64=s([32,0])),h.BUFFER||(h.BUFFER=s([32,0]));var f=h.DATA,g=h.BUFFER;function d(ee){if(ee){var Q=ee.length||ee.byteLength,oe=o.log2(Q);f[oe].push(ee)}}function p(ee){ee=o.nextPow2(ee);var Q=o.log2(ee),oe=f[Q];return oe.length>0?oe.pop():new ArrayBuffer(ee)}function m(ee){return new Uint8Array(p(ee),0,ee)}function y(ee){return new Uint16Array(p(2*ee),0,ee)}function v(ee){return new Uint32Array(p(4*ee),0,ee)}function N(ee){return new Int8Array(p(ee),0,ee)}function T(ee){return new Int16Array(p(2*ee),0,ee)}function O(ee){return new Int32Array(p(4*ee),0,ee)}function S(ee){return new Float32Array(p(4*ee),0,ee)}function F(ee){return new Float64Array(p(8*ee),0,ee)}function R(ee){return a?new Uint8ClampedArray(p(ee),0,ee):m(ee)}function L(ee){return u?new BigUint64Array(p(8*ee),0,ee):null}function q(ee){return c?new BigInt64Array(p(8*ee),0,ee):null}function U(ee){return new DataView(p(ee),0,ee)}function Z(ee){ee=o.nextPow2(ee);var Q=o.log2(ee),oe=g[Q];return oe.length>0?oe.pop():new i(ee)}t.free=function(ee){if(i.isBuffer(ee))g[o.log2(ee.length)].push(ee);else{if(Object.prototype.toString.call(ee)!=="[object ArrayBuffer]"&&(ee=ee.buffer),!ee)return;var Q=ee.length||ee.byteLength,oe=0|o.log2(Q);f[oe].push(ee)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeBigUint64=t.freeInt8=t.freeInt16=t.freeInt32=t.freeBigInt64=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(ee){d(ee.buffer)},t.freeArrayBuffer=d,t.freeBuffer=function(ee){g[o.log2(ee.length)].push(ee)},t.malloc=function(ee,Q){if(Q===void 0||Q==="arraybuffer")return p(ee);switch(Q){case"uint8":return m(ee);case"uint16":return y(ee);case"uint32":return v(ee);case"int8":return N(ee);case"int16":return T(ee);case"int32":return O(ee);case"float":case"float32":return S(ee);case"double":case"float64":return F(ee);case"uint8_clamped":return R(ee);case"bigint64":return q(ee);case"biguint64":return L(ee);case"buffer":return Z(ee);case"data":case"dataview":return U(ee);default:return null}return null},t.mallocArrayBuffer=p,t.mallocUint8=m,t.mallocUint16=y,t.mallocUint32=v,t.mallocInt8=N,t.mallocInt16=T,t.mallocInt32=O,t.mallocFloat32=t.mallocFloat=S,t.mallocFloat64=t.mallocDouble=F,t.mallocUint8Clamped=R,t.mallocBigUint64=L,t.mallocBigInt64=q,t.mallocDataView=U,t.mallocBuffer=Z,t.clearCache=function(){for(var ee=0;ee<32;++ee)h.UINT8[ee].length=0,h.UINT16[ee].length=0,h.UINT32[ee].length=0,h.INT8[ee].length=0,h.INT16[ee].length=0,h.INT32[ee].length=0,h.FLOAT[ee].length=0,h.DOUBLE[ee].length=0,h.BIGUINT64[ee].length=0,h.BIGINT64[ee].length=0,h.UINT8C[ee].length=0,f[ee].length=0,g[ee].length=0}}).call(this,e(21))},function(n,t,e){"use strict";function r(s){var i=32;return(s&=-s)&&i--,65535&s&&(i-=16),16711935&s&&(i-=8),252645135&s&&(i-=4),858993459&s&&(i-=2),1431655765&s&&(i-=1),i}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(s){return(s>0)-(s<0)},t.abs=function(s){var i=s>>31;return(s^i)-i},t.min=function(s,i){return i^(s^i)&-(s<i)},t.max=function(s,i){return s^(s^i)&-(s<i)},t.isPow2=function(s){return!(s&s-1||!s)},t.log2=function(s){var i,a;return i=(s>65535)<<4,i|=a=((s>>>=i)>255)<<3,i|=a=((s>>>=a)>15)<<2,(i|=a=((s>>>=a)>3)<<1)|(s>>>=a)>>1},t.log10=function(s){return s>=1e9?9:s>=1e8?8:s>=1e7?7:s>=1e6?6:s>=1e5?5:s>=1e4?4:s>=1e3?3:s>=100?2:s>=10?1:0},t.popCount=function(s){return 16843009*((s=(858993459&(s-=s>>>1&1431655765))+(s>>>2&858993459))+(s>>>4)&252645135)>>>24},t.countTrailingZeros=r,t.nextPow2=function(s){return s+=s===0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,(s|=s>>>16)+1},t.prevPow2=function(s){return s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,(s|=s>>>16)-(s>>>1)},t.parity=function(s){return s^=s>>>16,s^=s>>>8,s^=s>>>4,27030>>>(s&=15)&1};var o=new Array(256);(function(s){for(var i=0;i<256;++i){var a=i,u=i,c=7;for(a>>>=1;a;a>>>=1)u<<=1,u|=1&a,--c;s[i]=u<<c&255}})(o),t.reverse=function(s){return o[255&s]<<24|o[s>>>8&255]<<16|o[s>>>16&255]<<8|o[s>>>24&255]},t.interleave2=function(s,i){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s&=65535)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i&=65535)|i<<8))|i<<4))|i<<2))|i<<1))<<1},t.deinterleave2=function(s,i){return(s=65535&((s=16711935&((s=252645135&((s=858993459&((s=s>>>i&1431655765)|s>>>1))|s>>>2))|s>>>4))|s>>>16))<<16>>16},t.interleave3=function(s,i,a){return s=1227133513&((s=3272356035&((s=251719695&((s=4278190335&((s&=1023)|s<<16))|s<<8))|s<<4))|s<<2),(s|=(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<1)|(a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2))<<2},t.deinterleave3=function(s,i){return(s=1023&((s=4278190335&((s=251719695&((s=3272356035&((s=s>>>i&1227133513)|s>>>2))|s>>>4))|s>>>8))|s>>>16))<<22>>22},t.nextCombination=function(s){var i=s|s-1;return i+1|(~i&-~i)-1>>>r(s)+1}},function(n,t,e){"use strict";e.r(t),e.d(t,"aux_inputs",function(){return r}),e.d(t,"chords",function(){return o}),e.d(t,"constants",function(){return s}),e.d(t,"data",function(){return i}),e.d(t,"logging",function(){return a}),e.d(t,"melodies",function(){return u}),e.d(t,"performance",function(){return c}),e.d(t,"sequences",function(){return h}),e.d(t,"MetronomeCallbackObject",function(){return g}),e.d(t,"Metronome",function(){return d}),e.d(t,"MidiConversionError",function(){return v}),e.d(t,"midiToSequenceProto",function(){return N}),e.d(t,"sequenceProtoToMidi",function(){return T}),e.d(t,"urlToBlob",function(){return O}),e.d(t,"blobToNoteSequence",function(){return S}),e.d(t,"urlToNoteSequence",function(){return F}),e.d(t,"BasePlayerCallback",function(){return U}),e.d(t,"BasePlayer",function(){return Z}),e.d(t,"Player",function(){return Q}),e.d(t,"SoundFontPlayer",function(){return oe}),e.d(t,"PlayerWithClick",function(){return se}),e.d(t,"MIDIPlayer",function(){return pe}),e.d(t,"BaseRecorderCallback",function(){return ae}),e.d(t,"Recorder",function(){return fe}),e.d(t,"BaseVisualizer",function(){return Ee}),e.d(t,"PianoRollCanvasVisualizer",function(){return Le}),e.d(t,"Visualizer",function(){return Ve}),e.d(t,"BaseSVGVisualizer",function(){return qe}),e.d(t,"PianoRollSVGVisualizer",function(){return je}),e.d(t,"WaterfallSVGVisualizer",function(){return Ce}),e.d(t,"ScrollType",function(){return tt}),e.d(t,"StaffSVGVisualizer",function(){return ye});var r=e(48),o=e(37),s=e(8),i=e(36),a=e(12),u=e(23),c=e(29),h=e(13),f=e(9);class g{}class d{constructor(M,W=1){this.clicksPerQuarter=1,this.muted=!1,this.loClick=new f.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new f.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.loClickNote="c5",this.hiClickNote="g5",this.ticking=!1,this.startedAt=null,this.step=-1,this.reset(),this.callbackObject=M,this.clicksPerQuarter=W}isTicking(){return this.ticking}getStartedAt(){return this.startedAt}getOffsetTime(){return f.immediate()-this.startedAt}start(M=120){this.reset(),this.ticking=!0,this.callbackObject.click||(this.callbackObject.click=()=>{}),this.callbackObject.quarter||(this.callbackObject.quarter=()=>{}),this.callbackObject.bar||(this.callbackObject.bar=()=>{});let W=0,ce=4*this.clicksPerQuarter;f.Transport.scheduleRepeat(J=>{this.startedAt||(this.startedAt=J);let Ie=J-this.startedAt;this.step++;let Fe=this.step%ce,lt=Math.floor(Fe/this.clicksPerQuarter),Dt=Fe%this.clicksPerQuarter;this.callbackObject.click(Ie,Fe),Dt===0&&this.callbackObject.quarter(Ie,lt),this.muted||(Fe===0?this.hiClick.triggerAttack(this.hiClickNote,J,.1):this.loClick.triggerAttack(this.loClickNote,J,.1)),Fe===0&&(this.callbackObject.bar(Ie,W),W++)},ce+"n"),f.Transport.bpm.value=M,f.Transport.start()}stop(){this.ticking=!1,f.Transport.cancel(),f.Transport.stop()}reset(){this.muted=!1,this.ticking=!1,this.step=-1,this.startedAt=null}}var p=e(67),m=e(15),y=e(10);class v extends Error{constructor(M){super(M),Object.setPrototypeOf(this,new.target.prototype)}}function N(z){let M=new p.Midi(z),W=y.a.create();W.ticksPerQuarter=M.header.ppq,W.sourceInfo=y.a.SourceInfo.create({parser:y.a.SourceInfo.Parser.TONEJS_MIDI_CONVERT,encodingType:y.a.SourceInfo.EncodingType.MIDI});for(let J of M.header.timeSignatures)W.timeSignatures.push(y.a.TimeSignature.create({time:M.header.ticksToSeconds(J.ticks),numerator:J.timeSignature[0],denominator:J.timeSignature[1]}));W.timeSignatures.length||W.timeSignatures.push(y.a.TimeSignature.create({time:0,numerator:4,denominator:4}));for(let J of M.header.tempos)W.tempos.push(y.a.Tempo.create({time:J.time,qpm:J.bpm}));let ce=-1;for(let J of M.tracks){J.notes.length>0&&(ce+=1);for(let lt of J.notes){let Dt=lt.time,Ht=Dt+lt.duration;W.notes.push(y.a.Note.create({instrument:ce,program:J.instrument.number,startTime:Dt,endTime:Ht,pitch:lt.midi,velocity:Math.floor(lt.velocity*s.MIDI_VELOCITIES),isDrum:J.instrument.percussion})),Ht>W.totalTime&&(W.totalTime=Ht)}let Ie=Object.values(J.controlChanges),Fe=[].concat.apply([],Ie);for(let lt of Fe)W.controlChanges.push(y.a.ControlChange.create({time:lt.time,controlNumber:lt.number,controlValue:Math.floor(lt.value*(s.MIDI_VELOCITIES-1)),instrument:ce,program:J.instrument.number,isDrum:J.instrument.percussion}))}return W}function T(z){h.isQuantizedSequence(z)&&(z=h.unquantizeSequence(z));let M=new p.Midi;M.fromJSON({header:{name:"",ppq:z.ticksPerQuarter||s.DEFAULT_TICKS_PER_QUARTER,tempos:[],timeSignatures:[],keySignatures:[],meta:[]},tracks:[]});let W=Array.from(z.tempos||[]);W.length===0&&W.push({time:0,qpm:s.DEFAULT_QUARTERS_PER_MINUTE}),W.sort((J,Ie)=>J.time-Ie.time);for(let J of W)M.header.tempos.push({ticks:M.header.secondsToTicks(J.time),bpm:J.qpm}),M.header.update();if(z.timeSignatures&&z.timeSignatures.length!==0)for(let J of z.timeSignatures)M.header.timeSignatures.push({ticks:M.header.secondsToTicks(J.time),timeSignature:[J.numerator,J.denominator]});else M.header.timeSignatures.push({ticks:0,timeSignature:[4,4]});M.header.update();let ce=new Map;for(let J of z.notes){let Ie=J.instrument?J.instrument:0,Fe=J.program===void 0?s.DEFAULT_PROGRAM:J.program,lt=!!J.isDrum,Dt=JSON.stringify([Ie,Fe,lt]);ce.has(Dt)||ce.set(Dt,{notes:[],controlChanges:[]}),ce.get(Dt).notes.push(J)}for(let J of z.controlChanges){let Ie=J.instrument?J.instrument:0,Fe=J.program===void 0?s.DEFAULT_PROGRAM:J.program,lt=!!J.isDrum,Dt=JSON.stringify([Ie,Fe,lt]);ce.has(Dt)||ce.set(Dt,{notes:[],controlChanges:[]}),ce.get(Dt).controlChanges.push(J)}return ce.forEach((J,Ie)=>{let[Fe,lt]=JSON.parse(Ie).slice(1),Dt=M.addTrack();Dt.channel=lt?s.DRUM_CHANNEL:s.NON_DRUM_CHANNELS[(M.tracks.length-1)%s.NON_DRUM_CHANNELS.length],Dt.instrument.number=Fe;for(let Ht of J.notes){let an=Ht.velocity===void 0?s.DEFAULT_VELOCITY:Ht.velocity;Dt.addNote({midi:Ht.pitch,time:Ht.startTime,duration:Ht.endTime-Ht.startTime,velocity:(an+1)/s.MIDI_VELOCITIES})}for(let Ht of J.controlChanges)Dt.addCC({number:Ht.controlNumber,value:Ht.controlValue,time:Ht.time})}),M.toArray()}function O(z){return new Promise((M,W)=>{Object(m.a)(z).then(ce=>ce.blob()).then(ce=>{M(ce)}).catch(ce=>W(ce))})}function S(z){return new Promise((M,W)=>{let ce=new FileReader;ce.onload=J=>{try{let Ie=N(ce.result);M(Ie)}catch(Ie){W(Ie)}},ce.onerror=J=>W(J),ce.readAsArrayBuffer(z)})}function F(z){return O(z).then(S)}class R{constructor(M){this.FADE_SECONDS=.1,this.baseURL=M,this.buffers=new f.ToneAudioBuffers,this.sourceMap=new Map,this.initialized=!1}initialize(){return Te(this,null,function*(){yield Object(m.a)(this.baseURL+"/instrument.json").then(M=>M.json()).then(M=>{this.name=M.name,this.minPitch=M.minPitch,this.maxPitch=M.maxPitch,this.durationSeconds=M.durationSeconds,this.releaseSeconds=M.releaseSeconds,this.percussive=M.percussive,this.velocities=M.velocities,this.initialized=!0})})}sampleInfoToName(M){return this.velocities?`p${M.pitch}_v${M.velocity}`:"p"+M.pitch}sampleNameToURL(M){return`${this.baseURL}/${M}.mp3`}nearestVelocity(M){if(!this.velocities)return M;M||(M=s.DEFAULT_VELOCITY);let W,ce=s.MIDI_VELOCITIES;return this.velocities.forEach(J=>{let Ie=Math.abs(J-M);Ie<ce&&(W=J,ce=Ie)}),W}loadSamples(M){return Te(this,null,function*(){this.initialized||(yield this.initialize());let W=M.filter(J=>!(J.pitch<this.minPitch||J.pitch>this.maxPitch)||(a.log(`Pitch ${J.pitch} is outside the valid range for ${this.name}, ignoring.`,"SoundFont"),!1)).map(J=>this.sampleInfoToName({pitch:J.pitch,velocity:this.nearestVelocity(J.velocity)})),ce=Array.from(new Set(W)).filter(J=>!this.buffers.has(J)).map(J=>({name:J,url:this.sampleNameToURL(J)}));ce.length>0&&(ce.forEach(J=>this.buffers.add(J.name,J.url)),yield f.loaded(),a.log(`Loaded samples for ${this.name}.`,"SoundFont"))})}playNote(M,W,ce,J,Ie){let Fe=this.getBuffer(M,W);if(!Fe)return;J>this.durationSeconds&&a.log(`Requested note duration longer than sample duration: ${J} > ${this.durationSeconds}`,"SoundFont");let lt=new f.ToneBufferSource({url:Fe,fadeOut:this.FADE_SECONDS}).connect(Ie);if(lt.start(ce,0,void 0,1),!this.percussive&&J<this.durationSeconds){let Dt=new f.ToneBufferSource({url:Fe,fadeOut:this.FADE_SECONDS}).connect(Ie);lt.stop(ce+J+this.FADE_SECONDS),Dt.start(ce+J,this.durationSeconds,void 0,1)}}playNoteDown(M,W,ce){let J=this.getBuffer(M,W);if(!J)return;let Ie=new f.ToneBufferSource(J).connect(ce);Ie.start(0,0,void 0,1),this.sourceMap.has(M)&&this.sourceMap.get(M).stop(f.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.set(M,Ie)}playNoteUp(M,W,ce){if(!this.sourceMap.has(M))return;let J=this.getBuffer(M,W);J&&(new f.ToneBufferSource({url:J,fadeOut:this.FADE_SECONDS}).connect(ce).start(0,this.durationSeconds,void 0,1),this.sourceMap.get(M).stop(f.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.delete(M))}getBuffer(M,W){if(!this.initialized)throw new Error("Instrument is not initialized.");if(M<this.minPitch||M>this.maxPitch)return void a.log(`Pitch ${M} is outside the valid range for ${this.name} (${this.minPitch}-${this.maxPitch})`,"SoundFont");let ce=this.sampleInfoToName({pitch:M,velocity:this.nearestVelocity(W)});if(!this.buffers.has(ce))throw new Error(`Buffer not found for ${this.name}: ${ce}`);let J=this.buffers.get(ce);if(!J.loaded)throw new Error(`Buffer not loaded for ${this.name}: ${ce}`);return J}}class L{constructor(M){this.baseURL=M,this.instruments=new Map,this.initialized=!1}initialize(){return Te(this,null,function*(){yield Object(m.a)(this.baseURL+"/soundfont.json").then(M=>M.json()).then(M=>{this.name=M.name;for(let W in M.instruments){let ce=`${this.baseURL}/${M.instruments[W]}`;this.instruments.set(W==="drums"?"drums":+W,new R(ce))}this.initialized=!0})})}loadSamples(M){return Te(this,null,function*(){this.initialized||(yield this.initialize());let W=new Map;M.forEach(ce=>{ce.isDrum=ce.isDrum||!1,ce.program=ce.program||0;let J=ce.isDrum?"drums":ce.program,Ie={pitch:ce.pitch,velocity:ce.velocity};W.has(J)?W.get(J).push(Ie):this.instruments.has(J)?W.set(J,[Ie]):a.log(`No instrument in ${this.name} for: program=${ce.program}, isDrum=${ce.isDrum}`,"SoundFont")}),yield Promise.all(Array.from(W.keys()).map(ce=>this.instruments.get(ce).loadSamples(W.get(ce))))})}playNote(M,W,ce,J,Ie=0,Fe=!1,lt){let Dt=Fe?"drums":Ie;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(Dt)?this.instruments.get(Dt).playNote(M,W,ce,J,lt):a.log(`No instrument in ${this.name} for: program=${Ie}, isDrum=${Fe}`,"SoundFont")}playNoteDown(M,W,ce=0,J=!1,Ie){let Fe=J?"drums":ce;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(Fe)?this.instruments.get(Fe).playNoteDown(M,W,Ie):a.log(`No instrument in ${this.name} for: program=${ce}, isDrum=${J}`,"SoundFont")}playNoteUp(M,W,ce=0,J=!1,Ie){let Fe=J?"drums":ce;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(Fe)?this.instruments.get(Fe).playNoteUp(M,W,Ie):a.log(`No instrument in ${this.name} for: program=${ce}, isDrum=${J}`,"SoundFont")}}function q(z,M){return z.quantizedStartStep<M.quantizedStartStep?-1:z.quantizedStartStep>M.quantizedStartStep?1:z.pitch<M.pitch?-1:1}class U{}class Z{constructor(M=!1,W){this.playClick=M,this.callbackObject=W,this.desiredQPM=void 0}setTempo(M){this.desiredQPM=M,f.Transport.state==="started"&&(f.Transport.bpm.value=M)}makeClickSequence(M){let W=h.clone(M),ce=W.notes.map(Ie=>Ie.quantizedEndStep),J=Math.max(...ce);for(let Ie=0;Ie<J;Ie+=4){let Fe={pitch:Ie%16==0?s.LO_CLICK_PITCH:s.HI_CLICK_PITCH,quantizedStartStep:Ie,isDrum:!0,quantizedEndStep:Ie+1};W.notes.push(Fe)}return W.notes.sort(q),W}resumeContext(){f.context.resume()}start(M,W,ce=0){if(this.getPlayState()==="started")throw new Error("Cannot start playback; player is already playing.");if(this.getPlayState()==="paused")throw new Error("Cannot `start()` a paused player; use `resume()`.");if(f.Transport.state!=="stopped")throw new Error("Cannot start playback while `Tone.Transport` is in use.");this.resumeContext();let J=h.isQuantizedSequence(M);if(this.playClick&&J&&(M=this.makeClickSequence(M)),W?f.Transport.bpm.value=W:M.tempos&&M.tempos.length>0&&M.tempos[0].qpm>0?f.Transport.bpm.value=M.tempos[0].qpm:f.Transport.bpm.value=s.DEFAULT_QUARTERS_PER_MINUTE,J)M=h.unquantizeSequence(M,W);else if(W)throw new Error("Cannot specify a `qpm` for a non-quantized sequence.");let Ie=new f.Part((Fe,lt)=>{this.currentPart===Ie&&(this.playNote(Fe,lt),this.callbackObject&&f.Draw.schedule(()=>{this.callbackObject.run(lt,Fe)},Fe))},M.notes.map(Fe=>[Fe.startTime,Fe]));return this.currentPart=Ie,this.desiredQPM&&(f.Transport.bpm.value=this.desiredQPM),this.currentPart.start(void 0,ce),f.Transport.state!=="started"&&f.Transport.start(),new Promise(Fe=>{this.scheduledStop=f.Transport.schedule(()=>{this.stop(),Fe(),this.callbackObject&&this.callbackObject.stop()},"+"+M.totalTime)})}stop(){this.isPlaying()&&(this.currentPart.stop(),f.Transport.stop(),this.currentPart=null),f.Transport.clear(this.scheduledStop),this.scheduledStop=void 0,this.desiredQPM=void 0}pause(){if(!this.isPlaying())throw new Error("Cannot pause playback while the player is stopped.");f.Transport.pause()}resume(){if(this.getPlayState()!=="paused")throw new Error(`Cannot resume playback while "${this.getPlayState()}".`);f.Transport.start()}seekTo(M){if(!this.isPlaying())throw new Error("Cannot seek while the player is stopped.");f.Transport.seconds=M}isPlaying(){return!!this.currentPart}getPlayState(){return this.isPlaying()?f.Transport.state:"stopped"}}class ee{constructor(){this.DRUM_PITCH_TO_CLASS=new Map,this.kick=new f.MembraneSynth().toDestination(),this.tomLow=new f.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomMid=new f.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomHigh=new f.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.closedHihat=new f.MetalSynth({frequency:400,envelope:{attack:.001,decay:.1,release:.8},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.openHihat=new f.MetalSynth({frequency:400,envelope:{attack:.001,decay:.5,release:.8,sustain:1},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.ride=new f.MetalSynth().toDestination(),this.crash=new f.MetalSynth({frequency:300,envelope:{attack:.001,decay:1,release:3},harmonicity:5.1,modulationIndex:64,resonance:4e3,octaves:1.5}).toDestination(),this.snare=new f.NoiseSynth({noise:{type:"white"},envelope:{attack:.005,decay:.05,sustain:.1,release:.4}}).toDestination(),this.loClick=new f.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new f.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.pitchPlayers=[(M,W=1)=>this.kick.triggerAttackRelease("C2","8n",M,W),(M,W=1)=>this.snare.triggerAttackRelease("16n",M,W),(M,W=1)=>this.closedHihat.triggerAttack(M,.3,W),(M,W=1)=>this.openHihat.triggerAttack(M,.3,W),(M,W=.5)=>this.tomLow.triggerAttack("G3",M,W),(M,W=.5)=>this.tomMid.triggerAttack("C4",M,W),(M,W=.5)=>this.tomHigh.triggerAttack("F4",M,W),(M,W=1)=>this.crash.triggerAttack(M,1,W),(M,W=1)=>this.ride.triggerAttack(M,.5,W),(M,W=.5)=>this.loClick.triggerAttack("G5",M,W),(M,W=.5)=>this.hiClick.triggerAttack("C6",M,W)];for(let M=0;M<s.DEFAULT_DRUM_PITCH_CLASSES.length;++M)s.DEFAULT_DRUM_PITCH_CLASSES[M].forEach(W=>{this.DRUM_PITCH_TO_CLASS.set(W,M)});this.DRUM_PITCH_TO_CLASS.set(s.LO_CLICK_PITCH,s.LO_CLICK_CLASS),this.DRUM_PITCH_TO_CLASS.set(s.HI_CLICK_PITCH,s.HI_CLICK_CLASS)}static getInstance(){return ee.instance||(ee.instance=new ee),ee.instance}playNote(M,W,ce){this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(M)](W,ce)}}let Q=(()=>{class z extends Z{constructor(){super(...arguments),this.drumKit=ee.getInstance(),this.bassSynth=new f.Synth({volume:5,oscillator:{type:"triangle"}}).toDestination(),this.polySynth=new f.PolySynth().toDestination()}playNote(W,ce){let J=ce.hasOwnProperty("velocity")?ce.velocity/s.MAX_MIDI_VELOCITY:void 0;if(ce.isDrum)this.drumKit.playNote(ce.pitch,W,J);else{let Ie=f.Frequency(ce.pitch,"midi").toFrequency(),Fe=ce.endTime-ce.startTime;this.getSynth(ce.instrument,ce.program).triggerAttackRelease(Ie,Fe,W,J)}}getSynth(W,ce){return ce!==void 0&&ce>=32&&ce<=39?this.bassSynth:this.polySynth}}return z.tone=f,z})();class oe extends Z{constructor(M,W=f.Master,ce,J,Ie){super(!1,Ie),this.soundFont=new L(M),this.output=W,this.programOutputs=ce,this.drumOutputs=J}loadSamples(M){return Te(this,null,function*(){yield this.soundFont.loadSamples(M.notes.map(W=>({pitch:W.pitch,velocity:W.velocity,program:W.program||0,isDrum:W.isDrum||!1})))})}loadAllSamples(M=0,W=!1){return Te(this,null,function*(){let ce=y.a.create(),J=W?s.MIN_DRUM_PITCH:s.MIN_PIANO_PITCH,Ie=W?s.MAX_DRUM_PITCH:s.MAX_PIANO_PITCH;for(let Fe=J;Fe<=Ie;Fe++)for(let lt=s.MIN_MIDI_VELOCITY;lt<s.MAX_MIDI_VELOCITY;lt++)ce.notes.push({pitch:Fe,velocity:lt,program:M,isDrum:W});return this.loadSamples(ce)})}resumeContext(){f.context.resume()}start(M,W,ce=0){return this.resumeContext(),this.loadSamples(M).then(()=>super.start(M,W,ce))}playNote(M,W){this.soundFont.playNote(W.pitch,W.velocity,M,W.endTime-W.startTime,W.program,W.isDrum,this.getAudioNodeOutput(W))}playNoteDown(M){this.soundFont.playNoteDown(M.pitch,M.velocity,M.program,M.isDrum,this.getAudioNodeOutput(M))}playNoteUp(M){this.soundFont.playNoteUp(M.pitch,M.velocity,M.program,M.isDrum,this.getAudioNodeOutput(M))}getAudioNodeOutput(M){let W=this.output;return this.programOutputs&&!M.isDrum?this.programOutputs.has(M.program)&&(W=this.programOutputs.get(M.program)):this.drumOutputs&&M.isDrum&&this.drumOutputs.has(M.pitch)&&(W=this.drumOutputs.get(M.pitch)),W}}class se extends Q{constructor(M){super(!0,M)}}class pe extends Z{constructor(M){super(!1,M),this.outputs=[],this.outputChannel=0,this.availableOutputs=[],this.NOTE_ON=144,this.NOTE_OFF=128}requestMIDIAccess(){return Te(this,null,function*(){return navigator.requestMIDIAccess?new Promise((M,W)=>{navigator.requestMIDIAccess().then(ce=>{ce.addEventListener("statechange",J=>this.initOutputs(ce)),M(this.initOutputs(ce))},ce=>console.log("Something went wrong",W(ce)))}):null})}initOutputs(M){let W=M.outputs.values();for(let ce=W.next();ce&&!ce.done;ce=W.next())this.availableOutputs.push(ce.value);return this.availableOutputs}playNote(M,W){let ce=W.velocity||100,J=1e3*(W.endTime-W.startTime),Ie=[this.NOTE_ON+this.outputChannel,W.pitch,ce],Fe=[this.NOTE_OFF+this.outputChannel,W.pitch,ce],lt=this.outputs?this.outputs:this.availableOutputs;for(let Dt=0;Dt<lt.length;Dt++)this.sendMessageToOutput(lt[Dt],Ie),this.sendMessageToOutput(lt[Dt],Fe,m.d.now()+J)}sendMessageToOutput(M,W,ce){M&&M.send(W,ce)}playNoteDown(M){let W=[this.NOTE_ON,M.pitch,M.velocity],ce=this.outputs?this.outputs:this.availableOutputs;for(let J=0;J<ce.length;J++)this.sendMessageToOutput(ce[J],W)}playNoteUp(M){let W=[this.NOTE_OFF,M.pitch,M.velocity],ce=this.outputs?this.outputs:this.availableOutputs;for(let J=0;J<ce.length;J++)this.sendMessageToOutput(ce[J],W,M.endTime-M.startTime)}}class ae{}class fe{constructor(M={},W){this.notes=[],this.midiInputs=[],this.loClick=new f.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new f.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.config={playClick:M.playClick,qpm:M.qpm||s.DEFAULT_QUARTERS_PER_MINUTE,playCountIn:M.playCountIn,startRecordingAtFirstNote:M.startRecordingAtFirstNote||!1},this.callbackObject=W,this.recording=!1,this.onNotes=new Map}initialize(){return Te(this,null,function*(){yield navigator.requestMIDIAccess().then(M=>this.midiReady(M),M=>console.log("Something went wrong",M))})}midiReady(M){a.log("Initialized Recorder","Recorder");let W=M.inputs.values();for(let ce=W.next();ce&&!ce.done;ce=W.next())this.midiInputs.push(ce.value)}isRecording(){return this.recording}setTempo(M){this.config.qpm=M,f.Transport.state==="started"&&(f.Transport.bpm.value=M)}enablePlayClick(M){this.config.playClick=M}enablePlayCountIn(M){this.config.playCountIn=M}initClickLoop(){let M=0;this.clickLoop=new f.Loop(W=>{M%4==0?this.loClick.triggerAttack("G5",W):this.hiClick.triggerAttack("C6",W),M++,this.config.playCountIn&&M===4&&(f.Transport.stop(),this.clickLoop.stop())},"4n")}getMIDIInputs(){return this.midiInputs}start(M){let W=M||this.midiInputs;for(let ce of W)ce.onmidimessage=J=>{this.midiMessageReceived(J)};if(this.config.playClick||this.config.playCountIn?(this.initClickLoop(),f.Transport.bpm.value=this.config.qpm,f.Transport.start(),this.clickLoop.start()):this.clickLoop=null,this.recording=!0,this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,!this.startRecordingAtFirstNote){let ce=Date.now();this.firstNoteTimestamp=ce}}stop(){this.recording=!1;let M=Date.now();this.onNotes.forEach((W,ce)=>{this.noteOff(ce,M)});for(let W of this.midiInputs)W.onmidimessage=null;return this.clickLoop&&(f.Transport.stop(),this.clickLoop.stop()),this.notes.length===0?null:this.getNoteSequence()}getNoteSequence(){return this.notes.length===0?null:y.a.create({notes:this.notes,totalTime:this.notes[this.notes.length-1].endTime})}reset(){let M=this.stop();return this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,M}midiMessageReceived(M){if(!this.recording)return;let W;W=M.timeStamp!==void 0&&M.timeStamp!==0?M.timeStamp:m.d.now();let ce=W+m.d.timing.navigationStart;this.firstNoteTimestamp===void 0&&(this.firstNoteTimestamp=ce);let J=M.data[0]>>4,Ie=M.data[1],Fe=M.data.length>2?M.data[2]:1,lt=M.srcElement;J===8||J===9&&Fe===0?(this.callbackObject&&this.callbackObject.noteOff&&this.callbackObject.noteOff(Ie,Fe,lt),this.noteOff(Ie,ce),this.callbackObject&&this.callbackObject.run&&this.callbackObject.run(this.getNoteSequence())):J===9&&(this.callbackObject&&this.callbackObject.noteOn&&this.callbackObject.noteOn(Ie,Fe,lt),this.noteOn(Ie,Fe,ce))}noteOn(M,W,ce){let J=new y.a.Note;J.pitch=M,J.startTime=(ce-this.firstNoteTimestamp)/1e3,J.velocity=W,this.onNotes.set(M,J)}noteOff(M,W){let ce=this.onNotes.get(M);ce&&(ce.endTime=(W-this.firstNoteTimestamp)/1e3,this.notes.push(ce)),this.onNotes.delete(M)}}var he=e(83);class Ee{constructor(M,W={}){let ce=h.isQuantizedSequence(M),J=M.tempos&&M.tempos.length>0?M.tempos[0].qpm:void 0;this.noteSequence=ce?h.unquantizeSequence(M,J):M,this.config={noteHeight:W.noteHeight||6,noteSpacing:W.noteSpacing||1,pixelsPerTimeStep:W.pixelsPerTimeStep||30,noteRGB:W.noteRGB||"8, 41, 64",activeNoteRGB:W.activeNoteRGB||"240, 84, 119",minPitch:W.minPitch,maxPitch:W.maxPitch};let Ie=this.getSize();this.width=Ie.width,this.height=Ie.height}updateMinMaxPitches(M=!1){if(!this.config.minPitch||!this.config.maxPitch){this.config.minPitch===void 0&&(this.config.minPitch=s.MAX_MIDI_PITCH),this.config.maxPitch===void 0&&(this.config.maxPitch=s.MIN_MIDI_PITCH);for(let W of this.noteSequence.notes)this.config.minPitch=Math.min(W.pitch,this.config.minPitch),this.config.maxPitch=Math.max(W.pitch,this.config.maxPitch);M||(this.config.minPitch-=2,this.config.maxPitch+=2)}}getSize(){this.updateMinMaxPitches();let M=(this.config.maxPitch-this.config.minPitch)*this.config.noteHeight,W=this.noteSequence.totalTime;if(!W)throw new Error("The sequence you are using with the visualizer does not have a totalQuantizedSteps or totalTime field set, so the visualizer can't be horizontally sized correctly.");return{width:W*this.config.pixelsPerTimeStep,height:M}}getNotePosition(M,W){let ce=this.getNoteEndTime(M)-this.getNoteStartTime(M),J=this.getNoteStartTime(M)*this.config.pixelsPerTimeStep,Ie=Math.max(this.config.pixelsPerTimeStep*ce-this.config.noteSpacing,1);return{x:J,y:this.height-(M.pitch-this.config.minPitch)*this.config.noteHeight,w:Ie,h:this.config.noteHeight}}scrollIntoViewIfNeeded(M,W){if(M&&this.parentElement){let ce=this.parentElement.getBoundingClientRect().width;W>this.parentElement.scrollLeft+ce&&(this.parentElement.scrollLeft=W-20)}}getNoteStartTime(M){return Math.round(1e8*M.startTime)/1e8}getNoteEndTime(M){return Math.round(1e8*M.endTime)/1e8}isPaintingActiveNote(M,W){let ce=this.getNoteStartTime(M)===this.getNoteStartTime(W),J=this.getNoteStartTime(M)<=this.getNoteStartTime(W)&&this.getNoteEndTime(M)>=this.getNoteEndTime(W);return ce||J}}class Le extends Ee{constructor(M,W,ce={}){super(M,ce),this.ctx=W.getContext("2d"),this.parentElement=W.parentElement;let J=window.devicePixelRatio||1;this.ctx&&(this.ctx.canvas.width=J*this.width,this.ctx.canvas.height=J*this.height,W.style.width=this.width+"px",W.style.height=this.height+"px",this.ctx.scale(J,J)),this.redraw()}redraw(M,W){let ce;this.clear();for(let J=0;J<this.noteSequence.notes.length;J++){let Ie=this.noteSequence.notes[J],Fe=this.getNotePosition(Ie,J),lt=.2,Dt=Ie.velocity?Ie.velocity/100+lt:1,Ht=M&&this.isPaintingActiveNote(Ie,M),an=`rgba(${Ht?this.config.activeNoteRGB:this.config.noteRGB},
  ${Dt})`;this.redrawNote(Fe.x,Fe.y,Fe.w,Fe.h,an),Ht&&Ie===M&&(ce=Fe.x)}return this.scrollIntoViewIfNeeded(W,ce),ce}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}clearActiveNotes(){this.redraw()}redrawNote(M,W,ce,J,Ie){this.ctx.fillStyle=Ie,this.ctx.fillRect(Math.round(M),Math.round(W),Math.round(ce),Math.round(J))}}class Ve extends Le{constructor(M,W,ce={}){super(M,W,ce),a.log("mm.Visualizer is deprecated, and will be removed in a future          version. Please use mm.PianoRollCanvasVisualizer instead","mm.Visualizer",5)}}class qe extends Ee{constructor(M,W={}){super(M,W),this.drawn=!1}redraw(M,W){if(this.drawn||this.draw(),!M)return null;let ce;this.unfillActiveRect(this.svg);for(let J=0;J<this.noteSequence.notes.length;J++){let Ie=this.noteSequence.notes[J];if(!(M&&this.isPaintingActiveNote(Ie,M)))continue;let Fe=this.svg.querySelector(`rect[data-index="${J}"]`);this.fillActiveRect(Fe,Ie),Ie===M&&(ce=parseFloat(Fe.getAttribute("x")))}return this.scrollIntoViewIfNeeded(W,ce),ce}fillActiveRect(M,W){M.setAttribute("fill",this.getNoteFillColor(W,!0)),M.classList.add("active")}unfillActiveRect(M){let W=M.querySelectorAll("rect.active");for(let ce=0;ce<W.length;++ce){let J=W[ce],Ie=this.getNoteFillColor(this.noteSequence.notes[parseInt(J.getAttribute("data-index"),10)],!1);J.setAttribute("fill",Ie),J.classList.remove("active")}}draw(){for(let M=0;M<this.noteSequence.notes.length;M++){let W=this.noteSequence.notes[M],ce=this.getNotePosition(W,M),J=this.getNoteFillColor(W,!1),Ie=[["index",M],["instrument",W.instrument],["program",W.program],["isDrum",W.isDrum===!0],["pitch",W.pitch]],Fe=[["--midi-velocity",String(W.velocity!==void 0?W.velocity:127)]];this.drawNote(ce.x,ce.y,ce.w,ce.h,J,Ie,Fe)}this.drawn=!0}getNoteFillColor(M,W){let ce=M.velocity?M.velocity/100+.2:1;return`rgba(${W?this.config.activeNoteRGB:this.config.noteRGB},
  ${ce})`}drawNote(M,W,ce,J,Ie,Fe,lt){if(!this.svg)return;let Dt=document.createElementNS("http://www.w3.org/2000/svg","rect");Dt.classList.add("note"),Dt.setAttribute("fill",Ie),Dt.setAttribute("x",""+Math.round(M)),Dt.setAttribute("y",""+Math.round(W)),Dt.setAttribute("width",""+Math.round(ce)),Dt.setAttribute("height",""+Math.round(J)),Fe.forEach(([Ht,an])=>{an!==void 0&&(Dt.dataset[Ht]=""+an)}),lt.forEach(([Ht,an])=>{Dt.style.setProperty(Ht,an)}),this.svg.appendChild(Dt)}clear(){this.svg.innerHTML="",this.drawn=!1}clearActiveNotes(){this.unfillActiveRect(this.svg)}}class je extends qe{constructor(M,W,ce={}){if(super(M,ce),!(W instanceof SVGSVGElement))throw new Error("This visualizer requires an <svg> element to display the visualization");this.svg=W,this.parentElement=W.parentElement;let J=this.getSize();this.width=J.width,this.height=J.height,this.svg.style.width=this.width+"px",this.svg.style.height=this.height+"px",this.clear(),this.draw()}}class Ce extends qe{constructor(M,W,ce={}){if(super(M,ce),this.NOTES_PER_OCTAVE=12,this.WHITE_NOTES_PER_OCTAVE=7,this.LOW_C=24,this.firstDrawnOctave=0,this.lastDrawnOctave=6,!(W instanceof HTMLDivElement))throw new Error("This visualizer requires a <div> element to display the visualization");this.config.whiteNoteWidth=ce.whiteNoteWidth||20,this.config.blackNoteWidth=ce.blackNoteWidth||2*this.config.whiteNoteWidth/3,this.config.whiteNoteHeight=ce.whiteNoteHeight||70,this.config.blackNoteHeight=ce.blackNoteHeight||140/3,this.config.showOnlyOctavesUsed=ce.showOnlyOctavesUsed,this.setupDOM(W);let J=this.getSize();this.width=J.width,this.height=J.height,this.svg.style.width=this.width+"px",this.svg.style.height=this.height+"px",this.svgPiano.style.width=this.width+"px",this.svgPiano.style.height=this.config.whiteNoteHeight+"px",this.parentElement.style.width=this.width+this.config.whiteNoteWidth+"px",this.parentElement.scrollTop=this.parentElement.scrollHeight,this.clear(),this.drawPiano(),this.draw()}setupDOM(M){this.parentElement=document.createElement("div"),this.parentElement.classList.add("waterfall-notes-container");let W=Math.max(M.getBoundingClientRect().height,200);this.parentElement.style.paddingTop=W-this.config.whiteNoteHeight+"px",this.parentElement.style.height=W-this.config.whiteNoteHeight+"px",this.parentElement.style.boxSizing="border-box",this.parentElement.style.overflowX="hidden",this.parentElement.style.overflowY="auto",this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgPiano=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.classList.add("waterfall-notes"),this.svgPiano.classList.add("waterfall-piano"),this.parentElement.appendChild(this.svg),M.innerHTML="",M.appendChild(this.parentElement),M.appendChild(this.svgPiano)}redraw(M,W){if(this.drawn||this.draw(),!M)return null;this.clearActiveNotes(),this.parentElement.style.paddingTop=this.parentElement.style.height;for(let ce=0;ce<this.noteSequence.notes.length;ce++){let J=this.noteSequence.notes[ce];if(!(M&&this.isPaintingActiveNote(J,M)))continue;let Ie=this.svg.querySelector(`rect[data-index="${ce}"]`);this.fillActiveRect(Ie,J);let Fe=this.svgPiano.querySelector(`rect[data-pitch="${J.pitch}"]`);if(this.fillActiveRect(Fe,J),J===M){let lt=parseFloat(Ie.getAttribute("y")),Dt=parseFloat(Ie.getAttribute("height"));return lt<this.parentElement.scrollTop-Dt&&(this.parentElement.scrollTop=lt+Dt),lt}}return null}getSize(){this.updateMinMaxPitches(!0);let M=52;if(this.config.showOnlyOctavesUsed){let J=!1,Ie=!1;for(let Fe=1;Fe<7;Fe++){let lt=this.LOW_C+this.NOTES_PER_OCTAVE*Fe;!J&&lt>this.config.minPitch&&(this.firstDrawnOctave=Fe-1,J=!0),!Ie&&lt>this.config.maxPitch&&(this.lastDrawnOctave=Fe-1,Ie=!0)}M=(this.lastDrawnOctave-this.firstDrawnOctave+1)*this.WHITE_NOTES_PER_OCTAVE}let W=M*this.config.whiteNoteWidth,ce=this.noteSequence.totalTime;if(!ce)throw new Error("The sequence you are using with the visualizer does not have a totalQuantizedSteps or totalTime field set, so the visualizer can't be horizontally sized correctly.");return{width:W,height:Math.max(ce*this.config.pixelsPerTimeStep,1)}}getNotePosition(M,W){let ce=this.svgPiano.querySelector(`rect[data-pitch="${M.pitch}"]`);if(!ce)return null;let J=this.getNoteEndTime(M)-this.getNoteStartTime(M),Ie=Number(ce.getAttribute("x")),Fe=Number(ce.getAttribute("width")),lt=Math.max(this.config.pixelsPerTimeStep*J-this.config.noteSpacing,1);return{x:Ie,y:this.height-this.getNoteStartTime(M)*this.config.pixelsPerTimeStep-lt,w:Fe,h:lt}}drawPiano(){this.svgPiano.innerHTML="";let M=this.config.whiteNoteWidth-this.config.blackNoteWidth/2,W=[1,3,6,8,10],ce=0,J=0;this.config.showOnlyOctavesUsed?J=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C:(J=this.LOW_C-3,this.drawWhiteKey(J,ce),this.drawWhiteKey(J+2,this.config.whiteNoteWidth),J+=3,ce=2*this.config.whiteNoteWidth);for(let Ie=this.firstDrawnOctave;Ie<=this.lastDrawnOctave;Ie++)for(let Fe=0;Fe<this.NOTES_PER_OCTAVE;Fe++)W.indexOf(Fe)===-1&&(this.drawWhiteKey(J,ce),ce+=this.config.whiteNoteWidth),J++;this.config.showOnlyOctavesUsed?(J=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C,ce=-this.config.whiteNoteWidth):(this.drawWhiteKey(J,ce),J=this.LOW_C-3,this.drawBlackKey(J+1,M),J+=3,ce=this.config.whiteNoteWidth);for(let Ie=this.firstDrawnOctave;Ie<=this.lastDrawnOctave;Ie++)for(let Fe=0;Fe<this.NOTES_PER_OCTAVE;Fe++)W.indexOf(Fe)!==-1?this.drawBlackKey(J,ce+M):ce+=this.config.whiteNoteWidth,J++}drawWhiteKey(M,W){let ce=document.createElementNS("http://www.w3.org/2000/svg","rect");return ce.dataset.pitch=String(M),ce.setAttribute("x",String(W)),ce.setAttribute("y","0"),ce.setAttribute("width",String(this.config.whiteNoteWidth)),ce.setAttribute("height",String(this.config.whiteNoteHeight)),ce.setAttribute("fill","white"),ce.setAttribute("original-fill","white"),ce.setAttribute("stroke","black"),ce.setAttribute("stroke-width","3px"),ce.classList.add("white"),this.svgPiano.appendChild(ce),ce}drawBlackKey(M,W){let ce=document.createElementNS("http://www.w3.org/2000/svg","rect");return ce.dataset.pitch=String(M),ce.setAttribute("x",String(W)),ce.setAttribute("y","0"),ce.setAttribute("width",String(this.config.blackNoteWidth)),ce.setAttribute("height",String(this.config.blackNoteHeight)),ce.setAttribute("fill","black"),ce.setAttribute("original-fill","black"),ce.setAttribute("stroke","black"),ce.setAttribute("stroke-width","3px"),ce.classList.add("black"),this.svgPiano.appendChild(ce),ce}clearActiveNotes(){super.unfillActiveRect(this.svg);let M=this.svgPiano.querySelectorAll("rect.active");for(let W=0;W<M.length;++W){let ce=M[W];ce.setAttribute("fill",ce.getAttribute("original-fill")),ce.classList.remove("active")}}}var tt;(function(z){z[z.PAGE=0]="PAGE",z[z.NOTE=1]="NOTE",z[z.BAR=2]="BAR"})(tt||(tt={}));class ye extends Ee{constructor(M,W,ce={}){super(M,ce),(ce.pixelsPerTimeStep===void 0||ce.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0),this.instruments=ce.instruments||[],this.render=new he.StaffSVGRender(this.getScoreInfo(M),{noteHeight:this.config.noteHeight,noteSpacing:this.config.noteSpacing,pixelsPerTimeStep:this.config.pixelsPerTimeStep,noteRGB:this.config.noteRGB,activeNoteRGB:this.config.activeNoteRGB,defaultKey:ce.defaultKey||0,scrollType:ce.scrollType||tt.PAGE},W),this.drawnNotes=M.notes.length,this.clear(),this.redraw()}clear(){this.render.clear()}redraw(M,W){this.drawnNotes!==this.noteSequence.notes.length&&(this.render.scoreInfo=this.getScoreInfo(this.noteSequence));let ce=M?this.getNoteInfo(M):void 0;return this.render.redraw(ce,W)}isNoteInInstruments(M){return M.instrument===void 0||this.instruments.length===0||this.instruments.indexOf(M.instrument)>=0}timeToQuarters(M){let W=M*this.noteSequence.tempos[0].qpm/60;return Math.round(16*W)/16}getNoteInfo(M){let W=this.timeToQuarters(M.startTime);return{start:W,length:this.timeToQuarters(M.endTime)-W,pitch:M.pitch,intensity:M.velocity}}getScoreInfo(M){let W=[];return M.notes.forEach(ce=>{this.isNoteInInstruments(ce)&&W.push(this.getNoteInfo(ce))}),{notes:W,tempos:M.tempos?M.tempos.map(ce=>({start:this.timeToQuarters(ce.time),qpm:ce.qpm})):[],keySignatures:M.keySignatures?M.keySignatures.map(ce=>({start:this.timeToQuarters(ce.time),key:ce.key})):[],timeSignatures:M.timeSignatures?M.timeSignatures.map(ce=>({start:this.timeToQuarters(ce.time),numerator:ce.numerator,denominator:ce.denominator})):[]}}clearActiveNotes(){this.redraw()}}},function(n,t,e){"use strict";var r=e(86),o=e(91),s=e(45),i=e(92)({args:["array","array","scalar","scalar","scalar"],body:function(a,u,c,h,f){var g=u*c;g<h&&(g=h),g>f&&(g=f)}});n.exports=function(a,u,c,h){c===void 0&&(c=-1/0),h===void 0&&(h=1/0);var f=u.shape,g=a.shape;if(u.shape.length!==a.shape.length)throw new Error("ndarray-resample: input and output arrays should have the same dimensions");var d,p=f.map(function(){return 0});if(a.size===1)return(d=s.sum(u)/u.size)<c&&(d=c),d>h&&(d=h),void a.set.apply(a,p.concat(d));if(u.size===1)return(d=u.get.apply(u,p))<c&&(d=c),d>h&&(d=h),void s.assigns(a,d);for(var m=f.length,y=new Array(m),v=!1,N=0;N<m;N++)y[N]=Math.min(g[N],f[N]),g[N]>f[N]&&(v=!0);var T=o.malloc(f),O=o.malloc(f);s.assign(T,u),s.assigns(O,0),r(1,T,O);var S=T.lo,F=T.hi,R=o.malloc(g),L=o.malloc(g);v&&(s.assigns(R,0),s.assigns(L,0));var q=new Array(m),U=new Array(m),Z=new Array(m),ee=new Array(m);for(N=0;N<1<<m;++N){for(var Q=0;Q<m;++Q)if(N&1<<Q){if(q[Q]=y[Q]-(y[Q]+1>>>1),q[Q]===0)continue;U[Q]=g[Q]-q[Q],Z[Q]=f[Q]-q[Q],ee[Q]=1&y[Q]?0:1}else q[Q]=y[Q]+1>>>1,U[Q]=0,Z[Q]=0,ee[Q]=0;s.assign(F.apply(S.apply(R,U),q),F.apply(S.apply(T,Z),q)),s.assign(S.apply(F.apply(S.apply(L,U),q),ee),S.apply(F.apply(S.apply(O,Z),q),ee)),s.assigns(F.apply(F.apply(S.apply(L,U),q),ee),0)}r(-1,R,L),i(a,R,a.size/u.size,c,h),o.free(T),o.free(O),o.free(R),o.free(L)}},function(n,t,e){"use strict";t.byteLength=function(f){var g=c(f),d=g[0],p=g[1];return 3*(d+p)/4-p},t.toByteArray=function(f){var g,d,p=c(f),m=p[0],y=p[1],v=new s(function(O,S,F){return 3*(S+F)/4-F}(0,m,y)),N=0,T=y>0?m-4:m;for(d=0;d<T;d+=4)g=o[f.charCodeAt(d)]<<18|o[f.charCodeAt(d+1)]<<12|o[f.charCodeAt(d+2)]<<6|o[f.charCodeAt(d+3)],v[N++]=g>>16&255,v[N++]=g>>8&255,v[N++]=255&g;return y===2&&(g=o[f.charCodeAt(d)]<<2|o[f.charCodeAt(d+1)]>>4,v[N++]=255&g),y===1&&(g=o[f.charCodeAt(d)]<<10|o[f.charCodeAt(d+1)]<<4|o[f.charCodeAt(d+2)]>>2,v[N++]=g>>8&255,v[N++]=255&g),v},t.fromByteArray=function(f){for(var g,d=f.length,p=d%3,m=[],y=0,v=d-p;y<v;y+=16383)m.push(h(f,y,y+16383>v?v:y+16383));return p===1?(g=f[d-1],m.push(r[g>>2]+r[g<<4&63]+"==")):p===2&&(g=(f[d-2]<<8)+f[d-1],m.push(r[g>>10]+r[g>>4&63]+r[g<<2&63]+"=")),m.join("")};for(var r=[],o=[],s=typeof Uint8Array<"u"?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=i.length;a<u;++a)r[a]=i[a],o[i.charCodeAt(a)]=a;function c(f){var g=f.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var d=f.indexOf("=");return d===-1&&(d=g),[d,d===g?0:4-d%4]}function h(f,g,d){for(var p,m,y=[],v=g;v<d;v+=3)p=(f[v]<<16&16711680)+(f[v+1]<<8&65280)+(255&f[v+2]),y.push(r[(m=p)>>18&63]+r[m>>12&63]+r[m>>6&63]+r[63&m]);return y.join("")}o[45]=62,o[95]=63},function(n,t){t.read=function(e,r,o,s,i){var a,u,c=8*i-s-1,h=(1<<c)-1,f=h>>1,g=-7,d=o?i-1:0,p=o?-1:1,m=e[r+d];for(d+=p,a=m&(1<<-g)-1,m>>=-g,g+=c;g>0;a=256*a+e[r+d],d+=p,g-=8);for(u=a&(1<<-g)-1,a>>=-g,g+=s;g>0;u=256*u+e[r+d],d+=p,g-=8);if(a===0)a=1-f;else{if(a===h)return u?NaN:1/0*(m?-1:1);u+=Math.pow(2,s),a-=f}return(m?-1:1)*u*Math.pow(2,a-s)},t.write=function(e,r,o,s,i,a){var u,c,h,f=8*a-i-1,g=(1<<f)-1,d=g>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=s?0:a-1,y=s?1:-1,v=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(c=isNaN(r)?1:0,u=g):(u=Math.floor(Math.log(r)/Math.LN2),r*(h=Math.pow(2,-u))<1&&(u--,h*=2),(r+=u+d>=1?p/h:p*Math.pow(2,1-d))*h>=2&&(u++,h/=2),u+d>=g?(c=0,u=g):u+d>=1?(c=(r*h-1)*Math.pow(2,i),u+=d):(c=r*Math.pow(2,d-1)*Math.pow(2,i),u=0));i>=8;e[o+m]=255&c,m+=y,c/=256,i-=8);for(u=u<<i|c,f+=i;f>0;e[o+m]=255&u,m+=y,u/=256,f-=8);e[o+m-y]|=128*v}},function(n,t){var e={}.toString;n.exports=Array.isArray||function(r){return e.call(r)=="[object Array]"}},function(n,t,e){"use strict";(function(r){e.d(t,"a",function(){return s});let o=typeof requestAnimationFrame<"u"?requestAnimationFrame:r!==void 0?r:i=>i();function s(){return new Promise(i=>o(()=>i()))}}).call(this,e(170).setImmediate)},function(n,t,e){t.parseMidi=e(172),t.writeMidi=e(173)},function(n,t,e){"use strict";function r(o,s,i){i===void 0&&(i="ticks");var a=0,u=o.length,c=u;if(u>0&&o[u-1][i]<=s)return u-1;for(;a<c;){var h=Math.floor(a+(c-a)/2),f=o[h],g=o[h+1];if(f[i]===s){for(var d=h;d<o.length;d++)o[d][i]===s&&(h=d);return h}if(f[i]<s&&g[i]>s)return h;f[i]>s?c=h:f[i]<s&&(a=h+1)}return-1}Object.defineProperty(t,"__esModule",{value:!0}),t.search=r,t.insert=function(o,s,i){if(i===void 0&&(i="ticks"),o.length){var a=r(o,s[i],i);o.splice(a+1,0,s)}else o.push(s)}},function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(80),o=e(82),s=e(176),i=e(177),a=e(178),u=e(180),c=new WeakMap,h=function(){function f(g,d){var p=this;if(this.name="",this.notes=[],this.controlChanges=s.createControlChanges(),this.pitchBends=[],c.set(this,d),g){var m=g.find(function(O){return O.type==="trackName"});this.name=m?m.text:""}if(this.instrument=new a.Instrument(g,this),this.channel=0,g){for(var y=g.filter(function(O){return O.type==="noteOn"}),v=g.filter(function(O){return O.type==="noteOff"}),N=function(){var O=y.shift();T.channel=O.channel;var S=v.findIndex(function(R){return R.noteNumber===O.noteNumber&&R.absoluteTime>=O.absoluteTime});if(S!==-1){var F=v.splice(S,1)[0];T.addNote({durationTicks:F.absoluteTime-O.absoluteTime,midi:O.noteNumber,noteOffVelocity:F.velocity/127,ticks:O.absoluteTime,velocity:O.velocity/127})}},T=this;y.length;)N();g.filter(function(O){return O.type==="controller"}).forEach(function(O){p.addCC({number:O.controllerType,ticks:O.absoluteTime,value:O.value/127})}),g.filter(function(O){return O.type==="pitchBend"}).forEach(function(O){p.addPitchBend({ticks:O.absoluteTime,value:O.value/Math.pow(2,13)})})}}return f.prototype.addNote=function(g){var d=c.get(this),p=new u.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},d);return Object.assign(p,g),r.insert(this.notes,p,"ticks"),this},f.prototype.addCC=function(g){var d=c.get(this),p=new o.ControlChange({controllerType:g.number},d);return delete g.number,Object.assign(p,g),Array.isArray(this.controlChanges[p.number])||(this.controlChanges[p.number]=[]),r.insert(this.controlChanges[p.number],p,"ticks"),this},f.prototype.addPitchBend=function(g){var d=c.get(this),p=new i.PitchBend({},d);return Object.assign(p,g),r.insert(this.pitchBends,p,"ticks"),this},Object.defineProperty(f.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var g=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,d=0;d<this.notes.length-1;d++){var p=this.notes[d].time+this.notes[d].duration;g<p&&(g=p)}return g},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var g=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,d=0;d<this.notes.length-1;d++){var p=this.notes[d].ticks+this.notes[d].durationTicks;g<p&&(g=p)}return g},enumerable:!0,configurable:!0}),f.prototype.fromJSON=function(g){var d=this;for(var p in this.name=g.name,this.channel=g.channel,this.instrument=new a.Instrument(void 0,this),this.instrument.fromJSON(g.instrument),g.controlChanges)g.controlChanges[p]&&g.controlChanges[p].forEach(function(m){d.addCC({number:m.number,ticks:m.ticks,value:m.value})});g.notes.forEach(function(m){d.addNote({durationTicks:m.durationTicks,midi:m.midi,ticks:m.ticks,velocity:m.velocity})})},f.prototype.toJSON=function(){for(var g={},d=0;d<127;d++)this.controlChanges.hasOwnProperty(d)&&(g[d]=this.controlChanges[d].map(function(p){return p.toJSON()}));return{channel:this.channel,controlChanges:g,pitchBends:this.pitchBends.map(function(p){return p.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(p){return p.toJSON()})}},f}();t.Track=h},function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(i,a){return i[t.controlChangeNames[a]]=a,i},{});var r=new WeakMap,o=new WeakMap,s=function(){function i(a,u){r.set(this,u),o.set(this,a.controllerType),this.ticks=a.absoluteTime,this.value=a.value}return Object.defineProperty(i.prototype,"number",{get:function(){return o.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){return r.get(this).ticksToSeconds(this.ticks)},set:function(a){var u=r.get(this);this.ticks=u.secondsToTicks(a)},enumerable:!0,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();t.ControlChange=s},function(n,t,e){n.exports=function(r){var o={};function s(i){if(o[i])return o[i].exports;var a=o[i]={i,l:!1,exports:{}};return r[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=r,s.c=o,s.d=function(i,a,u){s.o(i,a)||Object.defineProperty(i,a,{enumerable:!0,get:u})},s.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},s.t=function(i,a){if(1&a&&(i=s(i)),8&a||4&a&&typeof i=="object"&&i&&i.__esModule)return i;var u=Object.create(null);if(s.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:i}),2&a&&typeof i!="string")for(var c in i)s.d(u,c,function(h){return i[h]}.bind(null,c));return u},s.n=function(i){var a=i&&i.__esModule?function(){return i.default}:function(){return i};return s.d(a,"a",a),a},s.o=function(i,a){return Object.prototype.hasOwnProperty.call(i,a)},s.p="",s(s.s=4)}([function(r,o,s){"use strict";s.r(o),s.d(o,"SVGNS",function(){return i}),s.d(o,"drawSVGPath",function(){return a}),s.d(o,"drawSVGText",function(){return u}),s.d(o,"createSVGGroupChild",function(){return c}),s.d(o,"setFade",function(){return h});let i="http://www.w3.org/2000/svg";function a(f,g,d,p,m,y,v=1){let N=document.createElementNS(i,"path");return N.setAttributeNS(null,"d",g),N.setAttributeNS(null,"transform",`translate(${d}, ${p}) scale(${m}, ${y})`),N.setAttributeNS(null,"opacity",""+v),f.appendChild(N),N}function u(f,g,d,p,m,y=!1,v=1,N=1){let T=document.createElementNS(i,"text");T.setAttributeNS(null,"font-family","Times"),T.setAttributeNS(null,"font-size",m),y&&T.setAttributeNS(null,"font-weight","bold"),T.setAttributeNS(null,"transform",`translate(${d}, ${p}) scale(${v}, ${N})`);let O=document.createTextNode(g);return T.appendChild(O),f.appendChild(T),T}function c(f,g){let d=document.createElementNS(i,"g");return d.setAttribute("data-id",g),f.appendChild(d),d}function h(f,g=!1,d=1,p=0){let m=f.querySelector("animate");if(!m){(m=document.createElementNS(i,"animate")).setAttributeNS(null,"attributeName","opacity"),m.setAttributeNS(null,"dur","4s"),m.setAttributeNS(null,"fill","freeze"),m.setAttributeNS(null,"keyTimes","0; 0.25; 0.5; 0.75; 1");let y=(d+3*p)/4;m.setAttributeNS(null,"values",`${d}; ${y}; ${p}; ${y}; ${d}`)}return g?m.setAttributeNS(null,"repeatCount","indefinite"):m.setAttributeNS(null,"repeatCount","1"),f.appendChild(m),f}},function(r,o,s){"use strict";s.r(o),s.d(o,"PATH_SCALE",function(){return i}),s.d(o,"staffLinePath",function(){return u}),s.d(o,"extraLinePath",function(){return c}),s.d(o,"barPath",function(){return h}),s.d(o,"stemPath",function(){return f}),s.d(o,"singleFlagPath",function(){return g}),s.d(o,"multiFlagPath",function(){return d}),s.d(o,"tiePath",function(){return p}),s.d(o,"dotPath",function(){return m}),s.d(o,"NOTE_PATHS",function(){return y}),s.d(o,"REST_PATHS",function(){return v}),s.d(o,"CLEF_PATHS",function(){return N}),s.d(o,"ACCIDENTAL_PATHS",function(){return T});let i=100,a=`M 0,10 C 0,-15 35,-50 80,-50 110,-50 125,-35 125,-10 
125,15 90,50 45,50 15,50 0,35 0,10 Z`,u="m 0,0 h 100",c="m -25,0 h 175",h="m 0,-200 v 400",f="m 0,0 v 100 h 15 v -100 z",g=`M0,0 h 12 c 7,100 175,156 62,314 79,-177 -49,
-193 -61,-200 l -13,-5 z`,d=`m 0,0 h 10 c 6,72 173,64 84,227 44,-120 -44,
-123 -94,-167 z`,p=`M 0,25 C 10,46 30,67 50,67 69,67 90,47 100,25 94,
65 73,89 50,89 26,89 5,63 0,25 Z`,m="M 5 -20 a 20 20 0 1 0 0.00001 0 z",y={4:{path:`m 0,0 c 0,-37 49,-51 79,-51 31,0 83,13 83,51 0,39 
-55,51 -84,51 C 49,51 0,37 0,0 Z m 111,31 c 13,-19 0,-58 -22,-68 -33,-15 
-53,10 -39,49 9,27 48,39 61,19 z`,width:150,stemVSteps:0,stemAnchor:0,flags:0},2:{path:`m 0,10 c 0,-25 35,-60 80,-60 15,0 45,4 45,40 C 125,16 
89,50 45,50 17,50 0,36 0,10 Z m 71,7 c 17,-11 45,-34 38,-45 -7,-10 -39,1 
-57,12 -19,11 -42,31 -36,42 6,10 37,2 55,-9 z`,width:125,stemVSteps:7,stemAnchor:-10,flags:0},1:{path:a,width:125,stemVSteps:7,stemAnchor:-10,flags:0},.5:{path:a,width:125,stemVSteps:7,stemAnchor:-10,flags:1},.25:{path:a,width:125,stemVSteps:9,stemAnchor:-10,flags:2},.125:{path:a,width:125,stemVSteps:11,stemAnchor:-10,flags:3},.0625:{path:a,width:125,stemVSteps:13,stemAnchor:-10,flags:4}},v={4:"m 0,-50 h 125 v -50 H 0 Z",2:"M 0,0 H 125 V -50 H 0 Z",1:`m 0,-25 c 39,-39 37,-75 8,-120 l 6,-5 61,103 C 
40,-13 31,4 73,71 l -5,5 C 14,52 16,125 67,144 l -4,6 C -37,102 -1,22 59,60 Z`,.5:`m 52,-47 c 26,-2 42,-21 48,-42 l 12,4 L 64,83 52,79 
88,-49 c 0,0 -17,22 -57,22 -16,0 -31,-13 -31,-27 0,-18 10,-31 27,-31 17,0 
33,15 25,38 z`,.25:`m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 
-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 
c -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 
31,27 40,0 57,-22 57,-22 l -36,128 12,4 77,-270 z`,.125:`m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 
-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 
c -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 
31,27 40,0 57,-22 57,-22 L 68,20 C 61,37 46,51 24,52 32,29 16,14 -1,14 c 
-17,0 -27,13 -27,31 0,14 15,27 31,27 38,0 55,-20 57,-22 l -36,128 12,4 
105,-369 z`,.0625:`m 158,-292 c -6,21 -22,40 -48,42 8,-23 -8,-38 
-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -17,61 
v 0 c -6,21 -22,40 -48,42 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 
15,27 31,27 40,0 57,-22 57,-22 l -20,69 c -7,18 -22,33 -45,35 8,-23 -8,-38 
-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 L 68,20 C 
61,37 46,51 24,52 32,29 16,14 -1,14 c -17,0 -27,13 -27,31 0,14 15,27 31,27 
38,0 55,-20 57,-22 l -36,128 12,4 134,-469 z`},N={50:{path:`m 101,-199 c -49,0 -100,28 -100,83 0,39 58,57 82,26 15,-20 
-4,-47 -32,-47 -23,1 -25,0 -25,-8 0,-22 40,-46 71,-41 91,16 67,208 -105,302 
75,-27 198,-94 211,-201 6,-66 -42,-114 -102,-114 z m 143,33 c -13,0 -23,11 
-23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 z m 2,83 c 
-13,0 -23,11 -23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 
z`,upper:-4,lower:3},71:{path:`M 139,48 C 102,57 76,120 131,151 41,128 64,24 129,2 L 
117,-57 C -32,47 26,217 166,182 Z m 12,-1 27,131 C 242,153 216,46 151,47 
Z m -35,-177 c 34,-23 82,-117 50,-140 -23,-17 -71,33 -50,140 z m -10,10 c 
-23,-77 -20,-200 48,-213 19,-4 89,171 -26,266 l 13,66 c 120,-6 137,155 
39,191 l 12,58 c 30,131 -137,145 -138,47 0,-29 37,-59 63,-37 21,18 25,71 
-25,70 32,42 103,0 91,-65 L 167,193 C 56,232 -112,63 106,-120 Z`,upper:-7,lower:8}},T=[null,`m -49,-121 v 52 l -29,9 v -48 h -8 v 51 l -20,6 v 29 l 
20,-6 v 70 l -20,6 v 30 l 20,-6 v 51 h 8 V 69 l 30,-8 v 50 h 8 V 58 l 20,-6 
V 23 l -20,6 v -71 l 20,-6 v -29 l -20,6 v -50 z m 1,82 v 71 l -29,9 v -71 z`,`M -106,-166 V 67 c 52,-42 85,-56 85,-94 0,-47 -46,-51 
-73,-22 v -117 z m 31,120 c 20,0 42,46 -20,91 V -7 c 0,-28 10,-39 20,-39 z`,`m -81,-58 v -48 H -92 V 73 l 60,-13 v 50 h 11 V -72 Z m 
50,24 v 58 l -50,11 v -58 z`]},function(r,o,s){"use strict";s.r(o),s.d(o,"MIN_RESOLUTION",function(){return i}),s.d(o,"STEM_WIDTH",function(){return a}),s.d(o,"LINE_STROKE",function(){return u}),s.d(o,"COMPACT_SPACING",function(){return c});let i=.0625,a=15,u=1,c=150},function(r,o,s){"use strict";s.r(o),s.d(o,"MAX_QUARTER_DIVISION",function(){return f}),s.d(o,"ScrollType",function(){return g}),s.d(o,"StaffSVGRender",function(){return d});var i=s(2),a=s(0),u=s(1);let c=[{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,0,1,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,0,3,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,2,0,0,2,0,2,0,0,3]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-7],accidental:[3,0,3,0,3,0,0,3,0,3,0,0]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,2,0,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,3,0,0]}],h=[{accidental:1,pitches:[]},{accidental:2,pitches:[70,75,68,73,66]},{accidental:1,pitches:[78,73]},{accidental:2,pitches:[70,75,68]},{accidental:1,pitches:[78,73,80,75]},{accidental:2,pitches:[70]},{accidental:2,pitches:[70,75,68,73,66,71]},{accidental:1,pitches:[78]},{accidental:2,pitches:[70,75,68,73]},{accidental:1,pitches:[78,73,80]},{accidental:2,pitches:[70,75]},{accidental:1,pitches:[78,73,80,75,70]}],f=16;var g;(function(p){p[p.PAGE=0]="PAGE",p[p.NOTE=1]="NOTE",p[p.BAR=2]="BAR"})(g||(g={}));class d{constructor(m,y,v){this.handleScrollEvent=N=>{this.lastKnownScrollLeft=this.parentElement.scrollLeft,this.ticking||window.requestAnimationFrame(()=>{this.changeAndDrawSignaturesIfNeeded(this.lastKnownScrollLeft),this.ticking=!1}),this.ticking=!0},this.scoreInfo=m,this.config={noteHeight:y.noteHeight||6,noteSpacing:y.noteSpacing||1,pixelsPerTimeStep:y.pixelsPerTimeStep||30,noteRGB:y.noteRGB||"8, 41, 64",activeNoteRGB:y.activeNoteRGB||"240, 84, 119"},this.div=v,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.key=y.defaultKey||0,this.scrollType=y.scrollType||g.PAGE,this.scale=this.config.noteHeight/u.PATH_SCALE,(y.pixelsPerTimeStep===void 0||y.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0,this.config.noteSpacing=i.COMPACT_SPACING*this.scale),this.clear(),this.redraw()}clear(){for(;this.div.lastChild;)this.div.removeChild(this.div.lastChild);this.div.style.overflow="visible",this.div.style.position="relative",this.overlaySVG=document.createElementNS(a.SVGNS,"svg"),this.overlaySVG.style.position="absolute",this.div.appendChild(this.overlaySVG),this.overlayG=Object(a.createSVGGroupChild)(this.overlaySVG,"overlay"),this.signaturesBlinking=!1,this.signaturesQuarters=0,this.parentElement=document.createElement("div"),this.parentElement.style.overflow="auto",this.div.appendChild(this.parentElement),this.ticking=!1,this.lastKnownScrollLeft=0,this.parentElement.addEventListener("scroll",this.handleScrollEvent),this.staffSVG=document.createElementNS(a.SVGNS,"svg"),this.parentElement.appendChild(this.staffSVG),this.staffG=Object(a.createSVGGroupChild)(this.staffSVG,"staff"),this.linesG=Object(a.createSVGGroupChild)(this.staffSVG,"lines"),this.setStroke(this.linesG),this.staffG.appendChild(this.linesG),this.musicG=Object(a.createSVGGroupChild)(this.staffSVG,"music"),this.setFill(this.musicG),this.setStroke(this.musicG,0),this.staffG.appendChild(this.musicG),this.signaturesG=Object(a.createSVGGroupChild)(this.staffSVG,"signatures"),this.staffG.appendChild(this.signaturesG);let m=0,y=0;this.scoreInfo.notes.forEach(N=>{m+=N.pitch,++y});let v=m/y;this.clef=v<60?50:71,this.signaturesList=[{x:0,q:0}],this.signatureCurrent=0,this.signatureNext=0,this.changeKeySignatureIfNeeded(0),this.changeTimeSignatureIfNeeded(0),this.vStepSize=this.config.noteHeight/2,this.hStepSize=this.config.pixelsPerTimeStep,this.staffOffset=0,this.height=0,this.width=0,this.musicBlockMap=new Map,this.playingNotes=[],this.lastBar=0,this.barAccidentals={},this.lastQ=-1}isPaintingActiveNote(m,y){let v=m.start===y.start,N=m.start<=y.start&&m.start+m.length>=y.start+y.length;return v||N}redraw(m,y){let v=-1,N=this.config.pixelsPerTimeStep===0;if(m){let T=[];this.playingNotes.forEach(S=>{this.isPaintingActiveNote(S,m)?T.push(S):this.highlightElement(this.getGroup(S),!1)}),this.playingNotes=T;let O=this.getGroup(m);if(O){this.playingNotes.push(m),this.highlightElement(O,!0),v=O.getBoundingClientRect().left-this.staffSVG.getBoundingClientRect().left;let S=m.start,F=O.getAttribute("data-is-bar-beginning");(this.scrollType!==g.BAR||F)&&this.scrollIntoViewIfNeeded(y,v),!N&&this.signaturesBlinking&&S>=this.signaturesQuarters&&(this.signaturesBlinking=!1,Object(a.setFade)(this.overlayG,this.signaturesBlinking))}}else{this.setDetails();let T=this.lastQ===-1,O=0,S=0;T?(S=this.drawSignatures(this.overlayG,O,!0,!0,!0),N&&(this.width=0,S+=this.config.noteSpacing),S+=this.drawRests(this.initialRest,O+S)):O=this.width,this.musicBlockMap.forEach((L,q)=>{N||(O=this.quartersToTime(q)*this.hStepSize),q>this.lastQ?(S+=this.drawMusicBlock(L,O+S),this.lastQ=q):q===this.lastQ&&(S+=this.drawRests(L,O+S))});let F=this.staffSVG.getBoundingClientRect(),R=this.musicG.getBoundingClientRect();if(this.updateVerticalBoundaries(R.top-F.top,R.bottom-F.top),N)this.width+=S;else{let L=this.musicBlockMap.get(this.lastQ),q=this.quartersToTime(this.lastQ+L.notes[0].length);this.width=q*this.config.pixelsPerTimeStep}this.staffSVG.setAttributeNS(null,"width",""+this.width),this.redrawStaff(this.linesG,0,this.width)}return v}drawMusicBlock(m,y){let v=m.notes[0].start,N=this.drawBarIfNeeded(v,y);N+=this.drawSignaturesIfNeeded(v,y+N);let T=0;for(let F=4;F>=i.MIN_RESOLUTION&&!T;F/=2)F<=m.notes[0].length&&(T=F);if(T===0){let F=m.notes[0].length===0?"[infinite]":""+4/m.notes[0].length;console.warn(" StaffRender ","background:orange; color:white",`StaffRender does not handle notes shorther than 1/${4/i.MIN_RESOLUTION}th, and this score tries to draw a 1/${F}th. Shortest possible note will be drawn instead.`),T=i.MIN_RESOLUTION}let O=u.NOTE_PATHS[T],S;if(O.stemAnchor&&(S=Object(a.createSVGGroupChild)(this.musicG,"stem")),m.notes.forEach(F=>{let R=F.vSteps*this.vStepSize,L=2*(F.vSteps>0?Math.floor(F.vSteps/2):Math.ceil(F.vSteps/2)),q=F.vSteps>0?-2:2;for(let U=L;Math.abs(U)>4;U+=q)Object(a.drawSVGPath)(this.linesG,u.extraLinePath,y+N,U*this.vStepSize,this.scale,1);if(F.g=F.tiedFrom?F.tiedFrom.g:Object(a.createSVGGroupChild)(this.musicG,`${F.start}-${F.pitch}`),m.isBarBeginning&&F.g.setAttribute("data-is-bar-beginning","true"),F.tiedFrom){let U=y+N-F.tiedFrom.xHeadRight;Object(a.drawSVGPath)(F.g,u.tiePath,F.tiedFrom.xHeadRight,R,U/u.PATH_SCALE,this.scale*(F.vSteps<0?-1:1),F.opacity)}Object(a.drawSVGPath)(F.g,O.path,y+N,R,this.scale,this.scale,F.opacity),F.xHeadRight=y+N+O.width*this.scale,1.5*T<=F.length&&Object(a.drawSVGPath)(F.g,u.dotPath,y+N+O.width*this.scale+this.vStepSize/2,R-this.vStepSize/2,this.scale,this.scale,F.opacity),F.accidental!==0&&Object(a.drawSVGPath)(F.g,u.ACCIDENTAL_PATHS[F.accidental],y+N,R,this.scale,this.scale,F.opacity)}),O.stemAnchor){let F,R,L=y+N,q=O.stemAnchor*this.scale,U=m.minVStep+m.maxVStep<0,Z=O.flags>2?2*(O.flags-2):0;if(U?(F=m.maxVStep*this.vStepSize-q,R=(m.minVStep+7+Z)*this.vStepSize):(L+=(O.width-i.STEM_WIDTH)*this.scale,F=m.minVStep*this.vStepSize+q,R=(m.maxVStep-7-Z)*this.vStepSize),Object(a.drawSVGPath)(S,u.stemPath,L,F,this.scale,(R-F)/u.PATH_SCALE),O.flags===1)Object(a.drawSVGPath)(S,u.singleFlagPath,L,R,this.scale,this.scale*(U?-1:1),1);else if(O.flags>1)for(let ee=0;ee<O.flags;++ee)Object(a.drawSVGPath)(S,u.multiFlagPath,L,R,this.scale,this.scale*(U?-1:1),1),R+=(U?-2:2)*this.vStepSize}return this.config.pixelsPerTimeStep===0&&(N+=O.width*this.scale,S&&(N+=S.getBoundingClientRect().width),N+=this.config.noteSpacing),N+=this.drawRests(m,y+N)}drawBarIfNeeded(m,y){let v=0,N=this.lastBar+this.getBarLength();return m!==0&&m>=N&&(this.config.pixelsPerTimeStep>0?y-=this.config.noteSpacing:v=this.config.noteSpacing,Object(a.drawSVGPath)(this.linesG,u.barPath,y,0,1,this.scale),this.lastBar=N),v}drawRests(m,y){let v=0,N=m.restToNextLength;if(N){this.config.pixelsPerTimeStep>0&&(y+=this.quartersToTime(m.notes[0].length)*this.hStepSize);let T=m.notes[0].start+m.notes[0].length,O=0,S=this.lastBar+this.getBarLength()-T,F;for(N>S&&(O=N-S,N=S),F=4;F>this.getBarLength()&&F>=i.MIN_RESOLUTION;F/=2);let R=F;for(;(N||O)&&R>=i.MIN_RESOLUTION;){if(R<=N){v+=this.drawBarIfNeeded(T,y+v),v+=this.drawSignaturesIfNeeded(T,y+v);let L=Object(a.drawSVGPath)(this.musicG,u.REST_PATHS[R],y+v,0,this.scale,this.scale);this.config.pixelsPerTimeStep>0?y+=this.quartersToTime(R)*this.hStepSize:(v+=L.getBoundingClientRect().width,v+=this.config.noteSpacing),T+=R,N-=R}if(O&&N<=0){let L=this.getBarLength();for(O>L?(N=L,O-=L):(N=O,O=0),F=4;F>this.getBarLength()&&F>=i.MIN_RESOLUTION;F/=2);R=F}N<R&&(R/=2)}}return v}redrawStaff(m,y,v){let N=m.querySelector('g[data-id="staff-five-lines"]');if(N)N.setAttributeNS(null,"transform",`scale(${v/u.PATH_SCALE}, 1)`);else{N=Object(a.createSVGGroupChild)(m,"staff-five-lines");let T=0;for(let O=-4;O<=4;O+=2)Object(a.drawSVGPath)(N,u.staffLinePath,y,T+O*this.vStepSize,v/u.PATH_SCALE,1)}return N}clearSignatureOverlay(){for(;this.overlayG.lastChild;)this.overlayG.removeChild(this.overlayG.lastChild)}drawSignaturesIfNeeded(m,y){let v=0,N=this.changeKeySignatureIfNeeded(m),T=this.changeTimeSignatureIfNeeded(m);if(N||T){let O=i.COMPACT_SPACING*this.scale*(this.config.pixelsPerTimeStep>0?3:2);this.signaturesList.push({x:y-O,q:m}),this.signatureNext===null&&(this.signatureNext=y);let S=m>0?Object(a.createSVGGroupChild)(this.signaturesG,"signatures"):this.overlayG;v+=this.drawSignatures(S,y+v,!1,N,T)}return this.config.pixelsPerTimeStep===0?v:0}drawSignatures(m,y,v,N,T){let O=i.COMPACT_SPACING*this.scale,S,F=O,R=m===this.overlayG||this.config.pixelsPerTimeStep>0;if(R){(S=document.createElementNS(a.SVGNS,"rect")).setAttributeNS(null,"x",""+y),S.setAttributeNS(null,"y","0"),S.setAttributeNS(null,"width","1"),S.setAttributeNS(null,"height","1"),S.setAttribute("data-id","background"),m.appendChild(S);let Z=document.defaultView.getComputedStyle(this.div.parentElement);S.setAttributeNS(null,"fill",Z.getPropertyValue("background-color"))}if(v){let Z=Object(a.drawSVGPath)(m,u.CLEF_PATHS[this.clef].path,y+F,0,this.scale,this.scale);this.setFill(Z),F+=3*O}if(N){let Z=h[this.key].accidental,ee=this.clef===71?0:14;h[this.key].pitches.forEach(Q=>{let oe=this.getPitchDetails(Q).vSteps,se=Object(a.drawSVGPath)(m,u.ACCIDENTAL_PATHS[Z],y+F,(ee+oe)*this.vStepSize,this.scale,this.scale);this.setFill(se),F+=se.getBoundingClientRect().width})}if(T){let Z=Object(a.createSVGGroupChild)(m,"time-key"),ee=2.85*this.config.noteHeight+"px";Object(a.drawSVGText)(Z,""+this.timeSignatureNumerator,y+F,-.5,ee,!0),Object(a.drawSVGText)(Z,""+this.timeSignatureDenominator,y+F,4*this.vStepSize-.5,ee,!0),this.setFill(Z),F+=Z.getBoundingClientRect().width+O}let L=this.redrawStaff(m,y,F);this.setStroke(L);let q=this.div.getBoundingClientRect(),U=m.getBoundingClientRect();if(this.updateVerticalBoundaries(U.top-q.top,U.bottom-q.top),R&&(S.setAttributeNS(null,"y",""+-this.staffOffset),S.setAttributeNS(null,"height",""+this.height),S.setAttributeNS(null,"width",""+F)),m===this.overlayG){this.overlaySVG.setAttributeNS(null,"width",""+(F+5));for(let Z=0;Z<5;++Z){let ee=Object(a.drawSVGPath)(m,u.stemPath,F+Z,Z*Z-this.staffOffset,1/i.STEM_WIDTH,(this.height-2*Z*Z)/u.PATH_SCALE,(Z-5)*(Z-5)*2/u.PATH_SCALE);this.setFill(ee)}}if(this.config.pixelsPerTimeStep>0){let Z=this.signaturesQuarters===0;return Z&&(this.signaturesQuarters=this.timeToQuarters(F/this.hStepSize)),(Z||y>0)&&(this.signaturesBlinking=!0,Object(a.setFade)(m,this.signaturesBlinking)),0}return F}changeKeySignatureIfNeeded(m){if(this.scoreInfo.keySignatures){let y=this.key;for(let v=0;v<this.scoreInfo.keySignatures.length&&this.scoreInfo.keySignatures[v].start<=m;++v)y=this.scoreInfo.keySignatures[v].key;if(y!==this.key)return this.key=y,!0}return!1}changeTimeSignatureIfNeeded(m){if(this.scoreInfo.timeSignatures){let y=this.timeSignatureNumerator,v=this.timeSignatureDenominator;for(let N=0;N<this.scoreInfo.timeSignatures.length&&this.scoreInfo.timeSignatures[N].start<=m;++N)y=this.scoreInfo.timeSignatures[N].numerator,v=this.scoreInfo.timeSignatures[N].denominator;if(y!==this.timeSignatureNumerator||v!==this.timeSignatureDenominator)return this.timeSignatureNumerator=y,this.timeSignatureDenominator=v,!0}return!1}changeAndDrawSignaturesIfNeeded(m){let y;if(m<this.signatureCurrent||this.signatureNext!==null&&this.signatureNext<=m){y=this.signaturesList[0].q,this.signatureNext=null;for(let v=0;v<this.signaturesList.length;++v){if(m<this.signaturesList[v].x){this.signatureNext=this.signaturesList[v].x;break}this.signatureCurrent=this.signaturesList[v].x,y=this.signaturesList[v].q}}if(y!==void 0){let v=this.key,N=this.timeSignatureNumerator,T=this.timeSignatureDenominator;this.changeKeySignatureIfNeeded(y),this.changeTimeSignatureIfNeeded(y),this.clearSignatureOverlay(),this.drawSignatures(this.overlayG,0,!0,!0,!0),this.key=v,this.timeSignatureNumerator=N,this.timeSignatureDenominator=T}this.config.pixelsPerTimeStep>0&&m===0&&(this.signatureNext=0,this.signaturesBlinking=!0,Object(a.setFade)(this.overlayG,this.signaturesBlinking))}getBarLength(){return 4*this.timeSignatureNumerator/this.timeSignatureDenominator}scrollIntoViewIfNeeded(m,y){if(m)if(this.scrollType===g.PAGE){let v=this.parentElement.getBoundingClientRect().width;y>this.parentElement.scrollLeft+v&&(this.parentElement.scrollLeft=y-20)}else{let v=this.parentElement.getBoundingClientRect().width;this.parentElement.scrollLeft=y-.5*v}}updateVerticalBoundaries(m,y){let v=0;if(m<0){this.staffOffset-=m;let N=`translate(0, ${this.staffOffset})`;this.overlayG.setAttributeNS(null,"transform",N),this.staffG.setAttributeNS(null,"transform",N),v=this.height-m}if((v=Math.max(v,y-m))>this.height){this.height=v,this.overlaySVG.setAttributeNS(null,"height",""+this.height),this.staffSVG.setAttributeNS(null,"height",""+this.height);let N=this.div.querySelectorAll('rect[data-id="background"]');for(let T=0;T<N.length;++T){let O=N[T];O.setAttributeNS(null,"y",""+-this.staffOffset),O.setAttributeNS(null,"height",""+this.height)}}}setFill(m,y=!1){m.setAttributeNS(null,"fill",this.getColor(y))}setStroke(m,y=i.LINE_STROKE,v=!1){m.setAttributeNS(null,"stroke",this.getColor(v)),m.setAttributeNS(null,"stroke-width",""+y)}getColor(m){return`rgb(${m?this.config.activeNoteRGB:this.config.noteRGB})`}getOpacity(m){return m?m/127*.8+.2:1}getGroup(m){let y=m.start,v=m.pitch;return this.staffSVG.querySelector(`g[data-id="${y}-${v}"]`)}highlightElement(m,y){m.setAttribute("fill",this.getColor(y)),m.setAttribute("stroke",this.getColor(y))}getBarBeginnings(){let m=new Set,y=0;this.scoreInfo.notes.forEach(T=>{T.start+T.length>y&&(y=T.start+T.length)});let v=this.scoreInfo.timeSignatures?this.scoreInfo.timeSignatures.slice(0):[{start:0,numerator:4,denominator:4}];v.sort((T,O)=>T.start-O.start);let N=0;for(let T=0;T<v.length;++T){let O=T===v.length-1?y:v[T].start,S=4*v[T].numerator/v[T].denominator;for(;N<O;N+=S)m.add(N)}return m}quartersToTime(m){return m/this.scoreInfo.tempos[0].qpm*60}timeToQuarters(m){return m*this.scoreInfo.tempos[0].qpm/60}setDetails(){let m=new Map,y=this.getBarBeginnings(),v=new Set(y);this.scoreInfo.notes.slice().sort((R,L)=>R.start-L.start).forEach(R=>{let L=this.getQNote(R);v.add(L.start),v.add(L.start+L.length),m.has(L.start)?m.get(L.start).push(L):m.set(L.start,[L])}),Array.from(v).sort((R,L)=>R-L).forEach(R=>{let L=[];m.forEach(q=>{q.forEach(U=>{let Z=this.splitQNote(U,R);Z&&L.push(Z)})}),L.forEach(q=>{m.has(q.start)?m.get(q.start).push(q):m.set(q.start,[q])})}),m=new Map(Array.from(m).sort((R,L)=>R[0]-L[0]));let N=this.key,T=null,O=0,S=y[Symbol.iterator](),F=S.next();m.forEach((R,L)=>{let q={maxVStep:Number.MAX_SAFE_INTEGER,minVStep:Number.MIN_SAFE_INTEGER,restToNextLength:0,isBarBeginning:!1,notes:[]};this.changeKeySignatureIfNeeded(L);let U=F.value+this.getBarLength();!F.done&&L>=U&&(F=S.next(),this.barAccidentals={},q.isBarBeginning=!0),R.forEach(Z=>{this.analyzePitch(Z,L),q.minVStep=Math.max(Z.vSteps,q.minVStep),q.maxVStep=Math.min(Z.vSteps,q.maxVStep),q.notes.push(Z)}),T&&(T.restToNextLength=L-O),this.musicBlockMap.set(L,q),T=q,O=L+q.notes[0].length}),this.initialRest={maxVStep:0,minVStep:0,restToNextLength:this.musicBlockMap.values().next().value.notes[0].start,isBarBeginning:!0,notes:[{start:0,length:0,vSteps:0,accidental:0,opacity:0,pitch:0,xHeadRight:0}]},this.key=N}getQNote(m){return{start:m.start,length:m.length,vSteps:0,accidental:0,opacity:this.getOpacity(m.intensity),pitch:m.pitch,xHeadRight:0}}splitQNote(m,y){let v=m.start+m.length-y;return y>m.start&&v>0?(m.length-=v,{start:y,length:v,vSteps:m.vSteps,accidental:m.accidental,opacity:m.opacity,pitch:m.pitch,xHeadRight:0,tiedFrom:m}):null}analyzePitch(m,y){let v=this.getPitchDetails(m.pitch);v.vSteps in this.barAccidentals?v.accidental===this.barAccidentals[v.vSteps]?v.accidental=0:(this.barAccidentals[v.vSteps]===3?v.accidental=v.keyAccidental:v.accidental===0&&(v.accidental=3),this.barAccidentals[v.vSteps]=v.accidental):(m.tiedFrom&&(v.accidental=0),this.barAccidentals[v.vSteps]=v.accidental),m.vSteps=v.vSteps,m.accidental=v.accidental}getPitchDetails(m){let y=m-60,v=Math.floor(y/12),N=y-12*v,T=c[this.key].steps[N],O=this.clef===71?6:-6,S=h[this.key].accidental===1?69+(N+3)%12:64+(N+8)%12;return{vSteps:O-7*v+T,accidental:c[this.key].accidental[N],keyAccidental:h[this.key].pitches.indexOf(S)>-1?h[this.key].accidental:0}}}},function(r,o,s){"use strict";s.r(o);var i=s(3);s.d(o,"MAX_QUARTER_DIVISION",function(){return i.MAX_QUARTER_DIVISION}),s.d(o,"ScrollType",function(){return i.ScrollType}),s.d(o,"StaffSVGRender",function(){return i.StaffSVGRender})}])},function(n,t,e){"use strict";n.exports=function(r){for(var o=new Array(r),s=0;s<r;++s)o[s]=s;return o}},function(n,t){function e(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}n.exports=function(r){return r!=null&&(e(r)||function(o){return typeof o.readFloatLE=="function"&&typeof o.slice=="function"&&e(o.slice(0,0))}(r)||!!r._isBuffer)}},function(n,t,e){"use strict";var r=e(45),o=e(30),s=e(71),i=e(90);n.exports=function(a,u,c){var h,f,g=u.shape,d=g.length,p=1,m=new Array(d),y=0;for(h=d-1;h>=0;--h)if(m[h]=p,p*=g[h],y=Math.max(y,i.scratchMemory(g[h])),u.shape[h]!==c.shape[h])throw new Error("Shape mismatch, real and imaginary arrays must have same size");var v,N=4*p+y;v=u.dtype==="array"||u.dtype==="float64"||u.dtype==="custom"?s.mallocDouble(N):s.mallocFloat(N);var T,O,S,F,R=o(v,g.slice(0),m,0),L=o(v,g.slice(0),m.slice(0),p),q=o(v,g.slice(0),m.slice(0),2*p),U=o(v,g.slice(0),m.slice(0),3*p),Z=4*p;for(r.assign(R,u),r.assign(L,c),h=d-1;h>=0&&(i(a,p/g[h],g[h],v,R.offset,L.offset,Z),h!==0);--h){for(O=1,S=q.stride,F=U.stride,f=h-1;f<d;++f)F[f]=S[f]=O,O*=g[f];for(f=h-2;f>=0;--f)F[f]=S[f]=O,O*=g[f];r.assign(q,R),r.assign(U,L),T=R,R=q,q=T,T=L,L=U,U=T}r.assign(u,R),r.assign(c,L),s.free(v)}},function(n,t,e){"use strict";var r=e(88);n.exports=function(o){var s=["'use strict'","var CACHED={}"],i=[],a=o.funcName+"_cwise_thunk";s.push(["return function ",a,"(",o.shimArgs.join(","),"){"].join(""));for(var u=[],c=[],h=[["array",o.arrayArgs[0],".shape.slice(",Math.max(0,o.arrayBlockIndices[0]),o.arrayBlockIndices[0]<0?","+o.arrayBlockIndices[0]+")":")"].join("")],f=[],g=[],d=0;d<o.arrayArgs.length;++d){var p=o.arrayArgs[d];i.push(["t",p,"=array",p,".dtype,","r",p,"=array",p,".order"].join("")),u.push("t"+p),u.push("r"+p),c.push("t"+p),c.push("r"+p+".join()"),h.push("array"+p+".data"),h.push("array"+p+".stride"),h.push("array"+p+".offset|0"),d>0&&(f.push("array"+o.arrayArgs[0]+".shape.length===array"+p+".shape.length+"+(Math.abs(o.arrayBlockIndices[0])-Math.abs(o.arrayBlockIndices[d]))),g.push("array"+o.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,o.arrayBlockIndices[0])+"]===array"+p+".shape[shapeIndex+"+Math.max(0,o.arrayBlockIndices[d])+"]"))}for(o.arrayArgs.length>1&&(s.push("if (!("+f.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),s.push("for(var shapeIndex=array"+o.arrayArgs[0]+".shape.length-"+Math.abs(o.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),s.push("if (!("+g.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),s.push("}")),d=0;d<o.scalarArgs.length;++d)h.push("scalar"+o.scalarArgs[d]);return i.push(["type=[",c.join(","),"].join()"].join("")),i.push("proc=CACHED[type]"),s.push("var "+i.join(",")),s.push(["if(!proc){","CACHED[type]=proc=compile([",u.join(","),"])}","return proc(",h.join(","),")}"].join("")),o.debug&&console.log(`-----Generated thunk:
`+s.join(`
`)+`
----------`),new Function("compile",s.join(`
`))(r.bind(void 0,o))}},function(n,t,e){"use strict";var r=e(70);function o(a,u,c){var h,f,g=a.length,d=u.arrayArgs.length,p=u.indexArgs.length>0,m=[],y=[],v=0,N=0;for(h=0;h<g;++h)y.push(["i",h,"=0"].join(""));for(f=0;f<d;++f)for(h=0;h<g;++h)N=v,v=a[h],h===0?y.push(["d",f,"s",h,"=t",f,"p",v].join("")):y.push(["d",f,"s",h,"=(t",f,"p",v,"-s",N,"*t",f,"p",N,")"].join(""));for(y.length>0&&m.push("var "+y.join(",")),h=g-1;h>=0;--h)v=a[h],m.push(["for(i",h,"=0;i",h,"<s",v,";++i",h,"){"].join(""));for(m.push(c),h=0;h<g;++h){for(N=v,v=a[h],f=0;f<d;++f)m.push(["p",f,"+=d",f,"s",h].join(""));p&&(h>0&&m.push(["index[",N,"]-=s",N].join("")),m.push(["++index[",v,"]"].join(""))),m.push("}")}return m.join(`
`)}function s(a,u,c){for(var h=a.body,f=[],g=[],d=0;d<a.args.length;++d){var p=a.args[d];if(!(p.count<=0)){var m=new RegExp(p.name,"g"),y="",v=u.arrayArgs.indexOf(d);switch(u.argTypes[d]){case"offset":var N=u.offsetArgIndex.indexOf(d);v=u.offsetArgs[N].array,y="+q"+N;case"array":y="p"+v+y;var T="l"+d,O="a"+v;if(u.arrayBlockIndices[v]===0)p.count===1?c[v]==="generic"?p.lvalue?(f.push(["var ",T,"=",O,".get(",y,")"].join("")),h=h.replace(m,T),g.push([O,".set(",y,",",T,")"].join(""))):h=h.replace(m,[O,".get(",y,")"].join("")):h=h.replace(m,[O,"[",y,"]"].join("")):c[v]==="generic"?(f.push(["var ",T,"=",O,".get(",y,")"].join("")),h=h.replace(m,T),p.lvalue&&g.push([O,".set(",y,",",T,")"].join(""))):(f.push(["var ",T,"=",O,"[",y,"]"].join("")),h=h.replace(m,T),p.lvalue&&g.push([O,"[",y,"]=",T].join("")));else{for(var S=[p.name],F=[y],R=0;R<Math.abs(u.arrayBlockIndices[v]);R++)S.push("\\s*\\[([^\\]]+)\\]"),F.push("$"+(R+1)+"*t"+v+"b"+R);if(m=new RegExp(S.join(""),"g"),y=F.join("+"),c[v]==="generic")throw new Error("cwise: Generic arrays not supported in combination with blocks!");h=h.replace(m,[O,"[",y,"]"].join(""))}break;case"scalar":h=h.replace(m,"Y"+u.scalarArgs.indexOf(d));break;case"index":h=h.replace(m,"index");break;case"shape":h=h.replace(m,"shape")}}}return[f.join(`
`),h,g.join(`
`)].join(`
`).trim()}function i(a){for(var u=new Array(a.length),c=!0,h=0;h<a.length;++h){var f=a[h],g=f.match(/\d+/);g=g?g[0]:"",f.charAt(0)===0?u[h]="u"+f.charAt(1)+g:u[h]=f.charAt(0)+g,h>0&&(c=c&&u[h]===u[h-1])}return c?u[0]:u.join("")}n.exports=function(a,u){for(var c=u[1].length-Math.abs(a.arrayBlockIndices[0])|0,h=new Array(a.arrayArgs.length),f=new Array(a.arrayArgs.length),g=0;g<a.arrayArgs.length;++g)f[g]=u[2*g],h[g]=u[2*g+1];var d=[],p=[],m=[],y=[],v=[];for(g=0;g<a.arrayArgs.length;++g){a.arrayBlockIndices[g]<0?(m.push(0),y.push(c),d.push(c),p.push(c+a.arrayBlockIndices[g])):(m.push(a.arrayBlockIndices[g]),y.push(a.arrayBlockIndices[g]+c),d.push(0),p.push(a.arrayBlockIndices[g]));for(var N=[],T=0;T<h[g].length;T++)m[g]<=h[g][T]&&h[g][T]<y[g]&&N.push(h[g][T]-m[g]);v.push(N)}var O=["SS"],S=["'use strict'"],F=[];for(T=0;T<c;++T)F.push(["s",T,"=SS[",T,"]"].join(""));for(g=0;g<a.arrayArgs.length;++g){for(O.push("a"+g),O.push("t"+g),O.push("p"+g),T=0;T<c;++T)F.push(["t",g,"p",T,"=t",g,"[",m[g]+T,"]"].join(""));for(T=0;T<Math.abs(a.arrayBlockIndices[g]);++T)F.push(["t",g,"b",T,"=t",g,"[",d[g]+T,"]"].join(""))}for(g=0;g<a.scalarArgs.length;++g)O.push("Y"+g);if(a.shapeArgs.length>0&&F.push("shape=SS.slice(0)"),a.indexArgs.length>0){var R=new Array(c);for(g=0;g<c;++g)R[g]="0";F.push(["index=[",R.join(","),"]"].join(""))}for(g=0;g<a.offsetArgs.length;++g){var L=a.offsetArgs[g],q=[];for(T=0;T<L.offset.length;++T)L.offset[T]!==0&&(L.offset[T]===1?q.push(["t",L.array,"p",T].join("")):q.push([L.offset[T],"*t",L.array,"p",T].join("")));q.length===0?F.push("q"+g+"=0"):F.push(["q",g,"=",q.join("+")].join(""))}var U=r([].concat(a.pre.thisVars).concat(a.body.thisVars).concat(a.post.thisVars));for((F=F.concat(U)).length>0&&S.push("var "+F.join(",")),g=0;g<a.arrayArgs.length;++g)S.push("p"+g+"|=0");a.pre.body.length>3&&S.push(s(a.pre,a,f));var Z=s(a.body,a,f),ee=function(oe){for(var se=0,pe=oe[0].length;se<pe;){for(var ae=1;ae<oe.length;++ae)if(oe[ae][se]!==oe[0][se])return se;++se}return se}(v);ee<c?S.push(function(oe,se,pe,ae){for(var fe=se.length,he=pe.arrayArgs.length,Ee=pe.blockSize,Le=pe.indexArgs.length>0,Ve=[],qe=0;qe<he;++qe)Ve.push(["var offset",qe,"=p",qe].join(""));for(qe=oe;qe<fe;++qe)Ve.push(["for(var j"+qe+"=SS[",se[qe],"]|0;j",qe,">0;){"].join("")),Ve.push(["if(j",qe,"<",Ee,"){"].join("")),Ve.push(["s",se[qe],"=j",qe].join("")),Ve.push(["j",qe,"=0"].join("")),Ve.push(["}else{s",se[qe],"=",Ee].join("")),Ve.push(["j",qe,"-=",Ee,"}"].join("")),Le&&Ve.push(["index[",se[qe],"]=j",qe].join(""));for(qe=0;qe<he;++qe){for(var je=["offset"+qe],Ce=oe;Ce<fe;++Ce)je.push(["j",Ce,"*t",qe,"p",se[Ce]].join(""));Ve.push(["p",qe,"=(",je.join("+"),")"].join(""))}for(Ve.push(o(se,pe,ae)),qe=oe;qe<fe;++qe)Ve.push("}");return Ve.join(`
`)}(ee,v[0],a,Z)):S.push(o(v[0],a,Z)),a.post.body.length>3&&S.push(s(a.post,a,f)),a.debug&&console.log("-----Generated cwise routine for ",u,`:
`+S.join(`
`)+`
----------`);var Q=[a.funcName||"unnamed","_cwise_loop_",h[0].join("s"),"m",ee,i(f)].join("");return new Function(["function ",Q,"(",O.join(","),"){",S.join(`
`),"} return ",Q].join(""))()}},function(n,t,e){"use strict";n.exports=function(r,o){switch(o===void 0&&(o=0),typeof r){case"number":if(r>0)return function(s,i){var a,u;for(a=new Array(s),u=0;u<s;++u)a[u]=i;return a}(0|r,o);break;case"object":if(typeof r.length=="number")return function s(i,a,u){var c=0|i[u];if(c<=0)return[];var h,f=new Array(c);if(u===i.length-1)for(h=0;h<c;++h)f[h]=a;else for(h=0;h<c;++h)f[h]=s(i,a,u+1);return f}(r,o,0)}return[]}},function(n,t,e){var r=e(72);function o(s,i,a,u,c,h){var f,g,d,p,m,y,v,N,T,O,S,F,R,L,q,U,Z,ee,Q,oe,se,pe,ae,fe;for(s|=0,i|=0,c|=0,h|=0,f=a|=0,g=r.log2(f),ee=0;ee<i;++ee){for(v=f>>1,m=0,d=0;d<f-1;d++){for(d<m&&(R=u[c+d],u[c+d]=u[c+m],u[c+m]=R,R=u[h+d],u[h+d]=u[h+m],u[h+m]=R),y=v;y<=m;)m-=y,y>>=1;m+=y}for(S=-1,F=0,O=1,N=0;N<g;N++){for(T=O,O<<=1,U=1,Z=0,m=0;m<T;m++){for(d=m;d<f;d+=O)Q=u[c+(p=d+T)],oe=u[h+p],se=u[c+d],pe=u[h+d],L=(ae=U*(Q+oe))-oe*(U+Z),q=ae+(fe=Q*(Z-U)),u[c+p]=se-L,u[h+p]=pe-q,u[c+d]+=L,u[h+d]+=q;fe=U*(F-S),U=(ae=S*(U+Z))-Z*(S+F),Z=ae+fe}F=Math.sqrt((1-S)/2),s<0&&(F=-F),S=Math.sqrt((1+S)/2)}if(s<0){var he=1/f;for(d=0;d<f;d++)u[c+d]*=he,u[h+d]*=he}c+=a,h+=a}}n.exports=function(s,i,a,u,c,h,f){s|=0,i|=0,a|=0,c|=0,h|=0,r.isPow2(a)?o(s,i,a,u,c,h):function(g,d,p,m,y,v,N){g|=0,d|=0,p|=0,y|=0,v|=0,N|=0;var T,O,S,F,R,L,q,U,Z,ee=r.nextPow2(2*p+1),Q=N,oe=Q+p,se=oe+p,pe=se+ee,ae=pe+ee,fe=ae+ee,he=-g*Math.PI/p;for(Z=0;Z<p;++Z)O=he*(Z*Z%(2*p)),F=Math.cos(O),R=Math.sin(O),m[ae+(ee-Z)]=m[ae+Z]=m[Q+Z]=F,m[fe+(ee-Z)]=m[fe+Z]=m[oe+Z]=R;for(Z=p;Z<=ee-p;++Z)m[ae+Z]=0;for(Z=p;Z<=ee-p;++Z)m[fe+Z]=0;for(o(1,1,ee,m,ae,fe),he=g<0?1/p:1,T=0;T<d;++T){for(Z=0;Z<p;++Z)O=m[y+Z],S=m[v+Z],F=m[Q+Z],R=-m[oe+Z],L=F*(O+S),q=O*(R-F),U=S*(F+R),m[se+Z]=L-U,m[pe+Z]=L+q;for(Z=p;Z<ee;++Z)m[se+Z]=0;for(Z=p;Z<ee;++Z)m[pe+Z]=0;for(o(1,1,ee,m,se,pe),Z=0;Z<ee;++Z)O=m[se+Z],S=m[pe+Z],F=m[ae+Z],R=m[fe+Z],L=F*(O+S),q=O*(R-F),U=S*(F+R),m[se+Z]=L-U,m[pe+Z]=L+q;for(o(-1,1,ee,m,se,pe),Z=0;Z<p;++Z)O=m[se+Z],S=m[pe+Z],F=m[Q+Z],R=-m[oe+Z],L=F*(O+S),q=O*(R-F),U=S*(F+R),m[y+Z]=he*(L-U),m[v+Z]=he*(L+q);y+=p,v+=p}}(s,i,a,u,c,h,f)},n.exports.scratchMemory=function(s){return r.isPow2(s)?0:2*s+4*r.nextPow2(2*s+1)}},function(n,t,e){"use strict";var r=e(30),o=e(45),s=e(71);t.clone=function(i){var a=i.dtype;a!=="generic"&&a!=="array"||(a="double");var u=s.malloc(i.size,a),c=r(u,i.shape);return o.assign(c,i),c},t.malloc=function(i,a){a||(a="double");for(var u=1,c=new Array(i.length),h=i.length-1;h>=0;--h)c[h]=u,u*=i[h];return r(s.malloc(u,a),i,c,0)},t.free=function(i){i.dtype!=="generic"&&i.dtype!=="array"&&s.free(i.data)},t.zeros=function(i,a){a||(a="double");for(var u=1,c=new Array(i.length),h=i.length-1;h>=0;--h)c[h]=u,u*=i[h];var f=s.malloc(u,a);for(h=0;h<u;++h)f[h]=0;return r(f,i,c,0)},t.ones=function(i,a){a||(a="double");for(var u=1,c=new Array(i.length),h=i.length-1;h>=0;--h)c[h]=u,u*=i[h];var f=s.malloc(u,a);for(h=0;h<u;++h)f[h]=1;return r(f,i,c,0)},t.eye=function(i,a){var u,c;a||(a="double");var h=1,f=new Array(i.length);for(u=i.length-1;u>=0;--u)f[u]=h,h*=i[u];var g=s.malloc(h,a);for(u=0;u<h;++u)g[u]=0;var d=1/0,p=0;for(u=i.length-1;u>=0;u--)p+=f[u],d=Math.min(d,i[u]);for(u=0,c=0;u<d;u++,c+=p)g[c]=1;return r(g,i,f,0)}},function(n,t,e){"use strict";var r=e(93),o=e(69),s=["args","body"],i=["pre","post","printCode","funcName","blockSize"];n.exports=function(a){for(var u in a)s.indexOf(u)<0&&i.indexOf(u)<0&&console.warn("cwise: Unknown argument '"+u+"' passed to expression compiler");for(var c=0;c<s.length;++c)if(!a[s[c]])throw new Error("cwise: Missing argument: "+s[c]);return o({args:a.args,pre:r(a.pre||function(){}),body:r(a.body),post:r(a.post||function(){}),debug:!!a.printCode,funcName:a.funcName||a.body.name||"cwise",blockSize:a.blockSize||64})}},function(n,t,e){"use strict";(function(r){var o=e(94),s=e(70),i=0;function a(c,h,f){this.name=c,this.lvalue=h,this.rvalue=f,this.count=0}function u(c,h,f,g){this.body=c,this.args=h,this.thisVars=f,this.localVars=g}n.exports=function(c){for(var h=["(",c,")()"].join(""),f=o.parse(h,{range:!0}),g="_inline_"+i+++"_",d=function(F){for(var R=F.body[0].expression.callee.params,L=new Array(R.length),q=0;q<R.length;++q)L[q]=R[q].name;return L}(f),p=new Array(d.length),m=0;m<d.length;++m)p[m]=new a([g,"arg",m,"_"].join(""),!1,!1);for(var y=new Array(h.length),v=(m=0,h.length);m<v;++m)y[m]=h.charAt(m);var N,T=[],O=[];function S(F,R){for(var L=F.range[0],q=F.range[1],U=L+1;U<q;++U)y[U]="";y[L]=R}return function F(R,L){if(R.parent=L,R.type==="MemberExpression")R.computed?(F(R.object,R),F(R.property,R)):R.object.type==="ThisExpression"?S(R,(fe=R.property.name,he="this_"+fe.replace(/\_/g,"__"),O.push(he),he)):F(R.object,R);else{if(R.type==="ThisExpression")throw new Error("cwise-parser: Computed this is not allowed");if(R.type==="Identifier"){var q=R.name,U=d.indexOf(q);if(U>=0){var Z=p[U],ee=function(Ee){return Ee.parent.type==="AssignmentExpression"&&Ee.parent.left===Ee?Ee.parent.operator==="="?1:3:Ee.parent.type==="UpdateExpression"?3:2}(R);1&ee&&(Z.lvalue=!0),2&ee&&(Z.rvalue=!0),++Z.count,S(R,Z.name)}else(function(Ee){if(Ee==="eval")throw new Error("cwise-parser: eval() not allowed");return typeof window<"u"?Ee in window:r!==void 0?Ee in r:typeof self<"u"&&Ee in self})(q)||S(R,function(Ee){var Le=g+Ee.replace(/\_/g,"__");return T.push(Le),Le}(q))}else if(R.type==="Literal")typeof R.value=="string"&&S(R,"'"+R.value.replace(/\_/g,"\\_").replace(/\'/g,"'")+"'");else{if(R.type==="WithStatement")throw new Error("cwise-parser: with() statements not allowed");for(var Q=Object.keys(R),oe=0,se=Q.length;oe<se;++oe)if(Q[oe]!=="parent"){var pe=R[Q[oe]];if(pe)if(pe instanceof Array)for(var ae=0;ae<pe.length;++ae)pe[ae]&&typeof pe[ae].type=="string"&&F(pe[ae],R);else typeof pe.type=="string"&&F(pe,R)}}}var fe,he}(f.body[0].expression.callee.body,void 0),s(T),s(O),new u((N=f.body[0].expression.callee.body,y.slice(N.range[0],N.range[1]).join("")),p,O,T)}}).call(this,e(21))},function(n,t,e){var r,o,s;(function(i,a){"use strict";o=[t],(s=typeof(r=function(u){var c,h,f,g,d,p,m,y,v,N,T,O,S,F,R,L,q,U;function Z(xe,Pe){if(!xe)throw new Error("ASSERT: "+Pe)}function ee(xe){return xe>=48&&xe<=57}function Q(xe){return"0123456789abcdefABCDEF".indexOf(xe)>=0}function oe(xe){return"01234567".indexOf(xe)>=0}function se(xe){return xe===32||xe===9||xe===11||xe===12||xe===160||xe>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(xe)>=0}function pe(xe){return xe===10||xe===13||xe===8232||xe===8233}function ae(xe){return xe===36||xe===95||xe>=65&&xe<=90||xe>=97&&xe<=122||xe===92||xe>=128&&m.NonAsciiIdentifierStart.test(String.fromCharCode(xe))}function fe(xe){return xe===36||xe===95||xe>=65&&xe<=90||xe>=97&&xe<=122||xe>=48&&xe<=57||xe===92||xe>=128&&m.NonAsciiIdentifierPart.test(String.fromCharCode(xe))}function he(xe){switch(xe){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function Ee(xe){return xe==="eval"||xe==="arguments"}function Le(xe,Pe,Ge,pt,At){var qt;Z(typeof Ge=="number","Comment must have valid position"),q.lastCommentStart>=Ge||(q.lastCommentStart=Ge,qt={type:xe,value:Pe},U.range&&(qt.range=[Ge,pt]),U.loc&&(qt.loc=At),U.comments.push(qt),U.attachComment&&(U.leadingComments.push(qt),U.trailingComments.push(qt)))}function Ve(xe){var Pe,Ge,pt,At;for(Pe=T-xe,Ge={start:{line:O,column:T-S-xe}};T<F;)if(pt=v.charCodeAt(T),++T,pe(pt))return U.comments&&(At=v.slice(Pe+xe,T-1),Ge.end={line:O,column:T-S-1},Le("Line",At,Pe,T-1,Ge)),pt===13&&v.charCodeAt(T)===10&&++T,++O,void(S=T);U.comments&&(At=v.slice(Pe+xe,T),Ge.end={line:O,column:T-S},Le("Line",At,Pe,T,Ge))}function qe(){var xe,Pe,Ge,pt;for(U.comments&&(xe=T-2,Pe={start:{line:O,column:T-S-2}});T<F;)if(pe(Ge=v.charCodeAt(T)))Ge===13&&v.charCodeAt(T+1)===10&&++T,++O,++T,S=T,T>=F&&cn({},p.UnexpectedToken,"ILLEGAL");else if(Ge===42){if(v.charCodeAt(T+1)===47)return++T,++T,void(U.comments&&(pt=v.slice(xe+2,T-2),Pe.end={line:O,column:T-S},Le("Block",pt,xe,T,Pe)));++T}else++T;cn({},p.UnexpectedToken,"ILLEGAL")}function je(){var xe,Pe;for(Pe=T===0;T<F;)if(se(xe=v.charCodeAt(T)))++T;else if(pe(xe))++T,xe===13&&v.charCodeAt(T)===10&&++T,++O,S=T,Pe=!0;else if(xe===47)if((xe=v.charCodeAt(T+1))===47)++T,++T,Ve(2),Pe=!0;else{if(xe!==42)break;++T,++T,qe()}else if(Pe&&xe===45){if(v.charCodeAt(T+1)!==45||v.charCodeAt(T+2)!==62)break;T+=3,Ve(3)}else{if(xe!==60||v.slice(T+1,T+4)!=="!--")break;++T,++T,++T,++T,Ve(4)}}function Ce(xe){var Pe,Ge,pt,At=0;for(Ge=xe==="u"?4:2,Pe=0;Pe<Ge;++Pe){if(!(T<F&&Q(v[T])))return"";pt=v[T++],At=16*At+"0123456789abcdef".indexOf(pt.toLowerCase())}return String.fromCharCode(At)}function tt(){var xe,Pe;for(xe=v.charCodeAt(T++),Pe=String.fromCharCode(xe),xe===92&&(v.charCodeAt(T)!==117&&cn({},p.UnexpectedToken,"ILLEGAL"),++T,(xe=Ce("u"))&&xe!=="\\"&&ae(xe.charCodeAt(0))||cn({},p.UnexpectedToken,"ILLEGAL"),Pe=xe);T<F&&fe(xe=v.charCodeAt(T));)++T,Pe+=String.fromCharCode(xe),xe===92&&(Pe=Pe.substr(0,Pe.length-1),v.charCodeAt(T)!==117&&cn({},p.UnexpectedToken,"ILLEGAL"),++T,(xe=Ce("u"))&&xe!=="\\"&&fe(xe.charCodeAt(0))||cn({},p.UnexpectedToken,"ILLEGAL"),Pe+=xe);return Pe}function ye(){var xe,Pe;return xe=T,{type:(Pe=v.charCodeAt(T)===92?tt():function(){var Ge,pt;for(Ge=T++;T<F;){if((pt=v.charCodeAt(T))===92)return T=Ge,tt();if(!fe(pt))break;++T}return v.slice(Ge,T)}()).length===1?c.Identifier:function(Ge){if(N&&he(Ge))return!0;switch(Ge.length){case 2:return Ge==="if"||Ge==="in"||Ge==="do";case 3:return Ge==="var"||Ge==="for"||Ge==="new"||Ge==="try"||Ge==="let";case 4:return Ge==="this"||Ge==="else"||Ge==="case"||Ge==="void"||Ge==="with"||Ge==="enum";case 5:return Ge==="while"||Ge==="break"||Ge==="catch"||Ge==="throw"||Ge==="const"||Ge==="yield"||Ge==="class"||Ge==="super";case 6:return Ge==="return"||Ge==="typeof"||Ge==="delete"||Ge==="switch"||Ge==="export"||Ge==="import";case 7:return Ge==="default"||Ge==="finally"||Ge==="extends";case 8:return Ge==="function"||Ge==="continue"||Ge==="debugger";case 10:return Ge==="instanceof";default:return!1}}(Pe)?c.Keyword:Pe==="null"?c.NullLiteral:Pe==="true"||Pe==="false"?c.BooleanLiteral:c.Identifier,value:Pe,lineNumber:O,lineStart:S,start:xe,end:T}}function z(){var xe,Pe,Ge,pt,At=T,qt=v.charCodeAt(T),pn=v[T];switch(qt){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++T,U.tokenize&&(qt===40?U.openParenToken=U.tokens.length:qt===123&&(U.openCurlyToken=U.tokens.length)),{type:c.Punctuator,value:String.fromCharCode(qt),lineNumber:O,lineStart:S,start:At,end:T};default:if((xe=v.charCodeAt(T+1))===61)switch(qt){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return T+=2,{type:c.Punctuator,value:String.fromCharCode(qt)+String.fromCharCode(xe),lineNumber:O,lineStart:S,start:At,end:T};case 33:case 61:return T+=2,v.charCodeAt(T)===61&&++T,{type:c.Punctuator,value:v.slice(At,T),lineNumber:O,lineStart:S,start:At,end:T}}}return(pt=v.substr(T,4))===">>>="?{type:c.Punctuator,value:pt,lineNumber:O,lineStart:S,start:At,end:T+=4}:(Ge=pt.substr(0,3))===">>>"||Ge==="<<="||Ge===">>="?{type:c.Punctuator,value:Ge,lineNumber:O,lineStart:S,start:At,end:T+=3}:pn===(Pe=Ge.substr(0,2))[1]&&"+-<>&|".indexOf(pn)>=0||Pe==="=>"?{type:c.Punctuator,value:Pe,lineNumber:O,lineStart:S,start:At,end:T+=2}:"<>=!+-*%&|^/".indexOf(pn)>=0?(++T,{type:c.Punctuator,value:pn,lineNumber:O,lineStart:S,start:At,end:T}):void cn({},p.UnexpectedToken,"ILLEGAL")}function M(){var xe,Pe,Ge;if(Z(ee((Ge=v[T]).charCodeAt(0))||Ge===".","Numeric literal must start with a decimal digit or a decimal point"),Pe=T,xe="",Ge!=="."){if(xe=v[T++],Ge=v[T],xe==="0"){if(Ge==="x"||Ge==="X")return++T,function(pt){for(var At="";T<F&&Q(v[T]);)At+=v[T++];return At.length===0&&cn({},p.UnexpectedToken,"ILLEGAL"),ae(v.charCodeAt(T))&&cn({},p.UnexpectedToken,"ILLEGAL"),{type:c.NumericLiteral,value:parseInt("0x"+At,16),lineNumber:O,lineStart:S,start:pt,end:T}}(Pe);if(oe(Ge)&&function(){var pt,At;for(pt=T+1;pt<F;++pt){if((At=v[pt])==="8"||At==="9")return!1;if(!oe(At))return!0}return!0}())return function(pt){for(var At="0"+v[T++];T<F&&oe(v[T]);)At+=v[T++];return(ae(v.charCodeAt(T))||ee(v.charCodeAt(T)))&&cn({},p.UnexpectedToken,"ILLEGAL"),{type:c.NumericLiteral,value:parseInt(At,8),octal:!0,lineNumber:O,lineStart:S,start:pt,end:T}}(Pe)}for(;ee(v.charCodeAt(T));)xe+=v[T++];Ge=v[T]}if(Ge==="."){for(xe+=v[T++];ee(v.charCodeAt(T));)xe+=v[T++];Ge=v[T]}if(Ge==="e"||Ge==="E")if(xe+=v[T++],(Ge=v[T])!=="+"&&Ge!=="-"||(xe+=v[T++]),ee(v.charCodeAt(T)))for(;ee(v.charCodeAt(T));)xe+=v[T++];else cn({},p.UnexpectedToken,"ILLEGAL");return ae(v.charCodeAt(T))&&cn({},p.UnexpectedToken,"ILLEGAL"),{type:c.NumericLiteral,value:parseFloat(xe),lineNumber:O,lineStart:S,start:Pe,end:T}}function W(){var xe,Pe,Ge,pt;return L=null,je(),xe=T,Pe=function(){var At,qt,pn,Fn;for(Z((At=v[T])==="/","Regular expression literal must start with a slash"),qt=v[T++],pn=!1,Fn=!1;T<F;)if(qt+=At=v[T++],At==="\\")pe((At=v[T++]).charCodeAt(0))&&cn({},p.UnterminatedRegExp),qt+=At;else if(pe(At.charCodeAt(0)))cn({},p.UnterminatedRegExp);else if(pn)At==="]"&&(pn=!1);else{if(At==="/"){Fn=!0;break}At==="["&&(pn=!0)}return Fn||cn({},p.UnterminatedRegExp),{value:qt.substr(1,qt.length-2),literal:qt}}(),Ge=function(){var At,qt,pn,Fn;for(qt="",pn="";T<F&&fe((At=v[T]).charCodeAt(0));)if(++T,At==="\\"&&T<F)if((At=v[T])==="u"){if(Fn=++T,At=Ce("u"))for(pn+=At,qt+="\\u";Fn<T;++Fn)qt+=v[Fn];else T=Fn,pn+="u",qt+="\\u";nn({},p.UnexpectedToken,"ILLEGAL")}else qt+="\\",nn({},p.UnexpectedToken,"ILLEGAL");else pn+=At,qt+=At;return{value:pn,literal:qt}}(),pt=function(At,qt){var pn;try{pn=new RegExp(At,qt)}catch{cn({},p.InvalidRegExp)}return pn}(Pe.value,Ge.value),U.tokenize?{type:c.RegularExpression,value:pt,lineNumber:O,lineStart:S,start:xe,end:T}:{literal:Pe.literal+Ge.literal,value:pt,start:xe,end:T}}function ce(){var xe,Pe,Ge,pt;return je(),xe=T,Pe={start:{line:O,column:T-S}},Ge=W(),Pe.end={line:O,column:T-S},U.tokenize||(U.tokens.length>0&&(pt=U.tokens[U.tokens.length-1]).range[0]===xe&&pt.type==="Punctuator"&&(pt.value!=="/"&&pt.value!=="/="||U.tokens.pop()),U.tokens.push({type:"RegularExpression",value:Ge.literal,range:[xe,T],loc:Pe})),Ge}function J(){var xe;return je(),T>=F?{type:c.EOF,lineNumber:O,lineStart:S,start:T,end:T}:ae(xe=v.charCodeAt(T))?ye():xe===40||xe===41||xe===59?z():xe===39||xe===34?function(){var Pe,Ge,pt,At,qt,pn,Fn,wr,Kn="",yn=!1;for(Fn=O,wr=S,Z((Pe=v[T])==="'"||Pe==='"',"String literal must starts with a quote"),Ge=T,++T;T<F;){if((pt=v[T++])===Pe){Pe="";break}if(pt==="\\")if((pt=v[T++])&&pe(pt.charCodeAt(0)))++O,pt==="\r"&&v[T]===`
`&&++T,S=T;else switch(pt){case"u":case"x":pn=T,(qt=Ce(pt))?Kn+=qt:(T=pn,Kn+=pt);break;case"n":Kn+=`
`;break;case"r":Kn+="\r";break;case"t":Kn+="	";break;case"b":Kn+="\b";break;case"f":Kn+="\f";break;case"v":Kn+="\v";break;default:oe(pt)?((At="01234567".indexOf(pt))!==0&&(yn=!0),T<F&&oe(v[T])&&(yn=!0,At=8*At+"01234567".indexOf(v[T++]),"0123".indexOf(pt)>=0&&T<F&&oe(v[T])&&(At=8*At+"01234567".indexOf(v[T++]))),Kn+=String.fromCharCode(At)):Kn+=pt}else{if(pe(pt.charCodeAt(0)))break;Kn+=pt}}return Pe!==""&&cn({},p.UnexpectedToken,"ILLEGAL"),{type:c.StringLiteral,value:Kn,octal:yn,startLineNumber:Fn,startLineStart:wr,lineNumber:O,lineStart:S,start:Ge,end:T}}():xe===46?ee(v.charCodeAt(T+1))?M():z():ee(xe)?M():U.tokenize&&xe===47?function(){var Pe,Ge;if(!(Pe=U.tokens[U.tokens.length-1]))return ce();if(Pe.type==="Punctuator"){if(Pe.value==="]")return z();if(Pe.value===")")return!(Ge=U.tokens[U.openParenToken-1])||Ge.type!=="Keyword"||Ge.value!=="if"&&Ge.value!=="while"&&Ge.value!=="for"&&Ge.value!=="with"?z():ce();if(Pe.value==="}"){if(U.tokens[U.openCurlyToken-3]&&U.tokens[U.openCurlyToken-3].type==="Keyword"){if(!(Ge=U.tokens[U.openCurlyToken-4]))return z()}else{if(!U.tokens[U.openCurlyToken-4]||U.tokens[U.openCurlyToken-4].type!=="Keyword")return z();if(!(Ge=U.tokens[U.openCurlyToken-5]))return ce()}return f.indexOf(Ge.value)>=0?z():ce()}return ce()}return Pe.type==="Keyword"&&Pe.value!=="this"?ce():z()}():z()}function Ie(){var xe,Pe,Ge;return je(),xe={start:{line:O,column:T-S}},Pe=J(),xe.end={line:O,column:T-S},Pe.type!==c.EOF&&(Ge=v.slice(Pe.start,Pe.end),U.tokens.push({type:h[Pe.type],value:Ge,range:[Pe.start,Pe.end],loc:xe})),Pe}function Fe(){var xe;return T=(xe=L).end,O=xe.lineNumber,S=xe.lineStart,L=U.tokens!==void 0?Ie():J(),T=xe.end,O=xe.lineNumber,S=xe.lineStart,xe}function lt(){var xe,Pe,Ge;xe=T,Pe=O,Ge=S,L=U.tokens!==void 0?Ie():J(),T=xe,O=Pe,S=Ge}function Dt(xe,Pe){this.line=xe,this.column=Pe}function Ht(xe,Pe,Ge,pt){this.start=new Dt(xe,Pe),this.end=new Dt(Ge,pt)}function an(){var xe,Pe,Ge,pt;return xe=T,Pe=O,Ge=S,je(),pt=O!==Pe,T=xe,O=Pe,S=Ge,pt}function cn(xe,Pe){var Ge,pt=Array.prototype.slice.call(arguments,2),At=Pe.replace(/%(\d)/g,function(qt,pn){return Z(pn<pt.length,"Message reference must be in range"),pt[pn]});throw typeof xe.lineNumber=="number"?((Ge=new Error("Line "+xe.lineNumber+": "+At)).index=xe.start,Ge.lineNumber=xe.lineNumber,Ge.column=xe.start-S+1):((Ge=new Error("Line "+O+": "+At)).index=T,Ge.lineNumber=O,Ge.column=T-S+1),Ge.description=At,Ge}function nn(){try{cn.apply(null,arguments)}catch(xe){if(!U.errors)throw xe;U.errors.push(xe)}}function Yn(xe){if(xe.type===c.EOF&&cn(xe,p.UnexpectedEOS),xe.type===c.NumericLiteral&&cn(xe,p.UnexpectedNumber),xe.type===c.StringLiteral&&cn(xe,p.UnexpectedString),xe.type===c.Identifier&&cn(xe,p.UnexpectedIdentifier),xe.type===c.Keyword){if(function(Pe){switch(Pe){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}(xe.value))cn(xe,p.UnexpectedReserved);else if(N&&he(xe.value))return void nn(xe,p.StrictReservedWord);cn(xe,p.UnexpectedToken,xe.value)}cn(xe,p.UnexpectedToken,xe.value)}function ln(xe){var Pe=Fe();Pe.type===c.Punctuator&&Pe.value===xe||Yn(Pe)}function Qn(xe){var Pe=Fe();Pe.type===c.Keyword&&Pe.value===xe||Yn(Pe)}function wn(xe){return L.type===c.Punctuator&&L.value===xe}function _r(xe){return L.type===c.Keyword&&L.value===xe}function Ar(){var xe,Pe=T,Ge=O,pt=S,At=L;if(v.charCodeAt(T)===59||wn(";"))Fe();else{if(xe=O,je(),O!==xe)return T=Pe,O=Ge,S=pt,void(L=At);L.type===c.EOF||wn("}")||Yn(L)}}function ss(xe){return xe.type===g.Identifier||xe.type===g.MemberExpression}function Qo(xe,Pe){var Ge,pt,At;return Ge=N,At=L,pt=Xt(),Pe&&N&&Ee(xe[0].name)&&nn(Pe,p.StrictParamName),N=Ge,R.markEnd(R.createFunctionExpression(null,xe,[],pt),At)}function Ws(){var xe,Pe;return Pe=L,(xe=Fe()).type===c.StringLiteral||xe.type===c.NumericLiteral?(N&&xe.octal&&nn(xe,p.StrictOctalLiteral),R.markEnd(R.createLiteral(xe),Pe)):R.markEnd(R.createIdentifier(xe.value),Pe)}function ki(){var xe,Pe,Ge,pt,At,qt;return qt=L,(xe=L).type===c.Identifier?(Ge=Ws(),xe.value!=="get"||wn(":")?xe.value!=="set"||wn(":")?(ln(":"),pt=fs(),R.markEnd(R.createProperty("init",Ge,pt),qt)):(Pe=Ws(),ln("("),(xe=L).type!==c.Identifier?(ln(")"),nn(xe,p.UnexpectedToken,xe.value),pt=Qo([])):(At=[bi()],ln(")"),pt=Qo(At,xe)),R.markEnd(R.createProperty("set",Pe,pt),qt)):(Pe=Ws(),ln("("),ln(")"),pt=Qo([]),R.markEnd(R.createProperty("get",Pe,pt),qt))):xe.type!==c.EOF&&xe.type!==c.Punctuator?(Pe=Ws(),ln(":"),pt=fs(),R.markEnd(R.createProperty("init",Pe,pt),qt)):void Yn(xe)}function Di(){var xe,Pe,Ge,pt;if(wn("("))return function(){var At;return ln("("),At=Ao(),ln(")"),At}();if(wn("["))return function(){var At,qt=[];for(At=L,ln("[");!wn("]");)wn(",")?(Fe(),qt.push(null)):(qt.push(fs()),wn("]")||ln(","));return Fe(),R.markEnd(R.createArrayExpression(qt),At)}();if(wn("{"))return function(){var At,qt,pn,Fn,wr,Kn=[],yn={},Cn=String;for(wr=L,ln("{");!wn("}");)qt=(At=ki()).key.type===g.Identifier?At.key.name:Cn(At.key.value),Fn=At.kind==="init"?d.Data:At.kind==="get"?d.Get:d.Set,pn="$"+qt,Object.prototype.hasOwnProperty.call(yn,pn)?(yn[pn]===d.Data?N&&Fn===d.Data?nn({},p.StrictDuplicateProperty):Fn!==d.Data&&nn({},p.AccessorDataProperty):Fn===d.Data?nn({},p.AccessorDataProperty):yn[pn]&Fn&&nn({},p.AccessorGetSet),yn[pn]|=Fn):yn[pn]=Fn,Kn.push(At),wn("}")||ln(",");return ln("}"),R.markEnd(R.createObjectExpression(Kn),wr)}();if(xe=L.type,pt=L,xe===c.Identifier)Ge=R.createIdentifier(Fe().value);else if(xe===c.StringLiteral||xe===c.NumericLiteral)N&&L.octal&&nn(L,p.StrictOctalLiteral),Ge=R.createLiteral(Fe());else if(xe===c.Keyword){if(_r("function"))return function(){var At,qt,pn,Fn,wr,Kn,yn,Cn,Io,Zo=null;return Io=L,Qn("function"),wn("(")||(At=L,Zo=bi(),N?Ee(At.value)&&nn(At,p.StrictFunctionName):Ee(At.value)?(pn=At,Fn=p.StrictFunctionName):he(At.value)&&(pn=At,Fn=p.StrictReservedWord)),wr=Yt(pn),Kn=wr.params,qt=wr.stricted,pn=wr.firstRestricted,wr.message&&(Fn=wr.message),Cn=N,yn=Xt(),N&&pn&&cn(pn,Fn),N&&qt&&nn(qt,Fn),N=Cn,R.markEnd(R.createFunctionExpression(Zo,Kn,[],yn),Io)}();_r("this")?(Fe(),Ge=R.createThisExpression()):Yn(Fe())}else xe===c.BooleanLiteral?((Pe=Fe()).value=Pe.value==="true",Ge=R.createLiteral(Pe)):xe===c.NullLiteral?((Pe=Fe()).value=null,Ge=R.createLiteral(Pe)):wn("/")||wn("/=")?(Ge=U.tokens!==void 0?R.createLiteral(ce()):R.createLiteral(W()),lt()):Yn(Fe());return R.markEnd(Ge,pt)}function Ai(){var xe=[];if(ln("("),!wn(")"))for(;T<F&&(xe.push(fs()),!wn(")"));)ln(",");return ln(")"),xe}function ia(){var xe,Pe;return Pe=L,function(Ge){return Ge.type===c.Identifier||Ge.type===c.Keyword||Ge.type===c.BooleanLiteral||Ge.type===c.NullLiteral}(xe=Fe())||Yn(xe),R.markEnd(R.createIdentifier(xe.value),Pe)}function aa(){return ln("."),ia()}function Nu(){var xe;return ln("["),xe=Ao(),ln("]"),xe}function vc(){var xe,Pe,Ge;return Ge=L,Qn("new"),xe=function(){var pt,At,qt;for(Z(q.allowIn,"callee of new expression always allow in keyword."),qt=L,pt=_r("new")?vc():Di();wn(".")||wn("[");)wn("[")?(At=Nu(),pt=R.createMemberExpression("[",pt,At)):(At=aa(),pt=R.createMemberExpression(".",pt,At)),R.markEnd(pt,qt);return pt}(),Pe=wn("(")?Ai():[],R.markEnd(R.createNewExpression(xe,Pe),Ge)}function eu(){var xe,Pe,Ge=L;return xe=function(){var pt,At,qt,pn,Fn=q.allowIn;for(pn=L,q.allowIn=!0,pt=_r("new")?vc():Di();;){if(wn("."))qt=aa(),pt=R.createMemberExpression(".",pt,qt);else if(wn("("))At=Ai(),pt=R.createCallExpression(pt,At);else{if(!wn("["))break;qt=Nu(),pt=R.createMemberExpression("[",pt,qt)}R.markEnd(pt,pn)}return q.allowIn=Fn,pt}(),L.type===c.Punctuator&&(!wn("++")&&!wn("--")||an()||(N&&xe.type===g.Identifier&&Ee(xe.name)&&nn({},p.StrictLHSPostfix),ss(xe)||nn({},p.InvalidLHSInAssignment),Pe=Fe(),xe=R.markEnd(R.createPostfixExpression(Pe.value,xe),Ge))),xe}function ds(){var xe,Pe,Ge;return L.type!==c.Punctuator&&L.type!==c.Keyword?Pe=eu():wn("++")||wn("--")?(Ge=L,xe=Fe(),Pe=ds(),N&&Pe.type===g.Identifier&&Ee(Pe.name)&&nn({},p.StrictLHSPrefix),ss(Pe)||nn({},p.InvalidLHSInAssignment),Pe=R.createUnaryExpression(xe.value,Pe),Pe=R.markEnd(Pe,Ge)):wn("+")||wn("-")||wn("~")||wn("!")?(Ge=L,xe=Fe(),Pe=ds(),Pe=R.createUnaryExpression(xe.value,Pe),Pe=R.markEnd(Pe,Ge)):_r("delete")||_r("void")||_r("typeof")?(Ge=L,xe=Fe(),Pe=ds(),Pe=R.createUnaryExpression(xe.value,Pe),Pe=R.markEnd(Pe,Ge),N&&Pe.operator==="delete"&&Pe.argument.type===g.Identifier&&nn({},p.StrictDelete)):Pe=eu(),Pe}function wc(xe,Pe){var Ge=0;if(xe.type!==c.Punctuator&&xe.type!==c.Keyword)return 0;switch(xe.value){case"||":Ge=1;break;case"&&":Ge=2;break;case"|":Ge=3;break;case"^":Ge=4;break;case"&":Ge=5;break;case"==":case"!=":case"===":case"!==":Ge=6;break;case"<":case">":case"<=":case">=":case"instanceof":Ge=7;break;case"in":Ge=Pe?7:0;break;case"<<":case">>":case">>>":Ge=8;break;case"+":case"-":Ge=9;break;case"*":case"/":case"%":Ge=11}return Ge}function ku(){var xe,Pe,Ge,pt,At;return At=L,xe=function(){var qt,pn,Fn,wr,Kn,yn,Cn,Io,Zo,ji;if(qt=L,Zo=ds(),(Kn=wc(wr=L,q.allowIn))===0)return Zo;for(wr.prec=Kn,Fe(),pn=[qt,L],yn=[Zo,wr,Cn=ds()];(Kn=wc(L,q.allowIn))>0;){for(;yn.length>2&&Kn<=yn[yn.length-2].prec;)Cn=yn.pop(),Io=yn.pop().value,Zo=yn.pop(),Fn=R.createBinaryExpression(Io,Zo,Cn),pn.pop(),qt=pn[pn.length-1],R.markEnd(Fn,qt),yn.push(Fn);(wr=Fe()).prec=Kn,yn.push(wr),pn.push(L),Fn=ds(),yn.push(Fn)}for(Fn=yn[ji=yn.length-1],pn.pop();ji>1;)Fn=R.createBinaryExpression(yn[ji-1].value,yn[ji-2],Fn),ji-=2,qt=pn.pop(),R.markEnd(Fn,qt);return Fn}(),wn("?")&&(Fe(),Pe=q.allowIn,q.allowIn=!0,Ge=fs(),q.allowIn=Pe,ln(":"),pt=fs(),xe=R.createConditionalExpression(xe,Ge,pt),R.markEnd(xe,At)),xe}function fs(){var xe,Pe,Ge,pt,At,qt;return xe=L,At=L,pt=Pe=ku(),L.type!==c.Punctuator||(qt=L.value)!=="="&&qt!=="*="&&qt!=="/="&&qt!=="%="&&qt!=="+="&&qt!=="-="&&qt!=="<<="&&qt!==">>="&&qt!==">>>="&&qt!=="&="&&qt!=="^="&&qt!=="|="||(ss(Pe)||nn({},p.InvalidLHSInAssignment),N&&Pe.type===g.Identifier&&Ee(Pe.name)&&nn(xe,p.StrictLHSAssignment),xe=Fe(),Ge=fs(),pt=R.markEnd(R.createAssignmentExpression(xe.value,Pe,Ge),At)),pt}function Ao(){var xe,Pe=L;if(xe=fs(),wn(",")){for(xe=R.createSequenceExpression([xe]);T<F&&wn(",");)Fe(),xe.expressions.push(fs());R.markEnd(xe,Pe)}return xe}function Hs(){var xe,Pe;return Pe=L,ln("{"),xe=function(){for(var Ge,pt=[];T<F&&!wn("}")&&(Ge=Gn())!==void 0;)pt.push(Ge);return pt}(),ln("}"),R.markEnd(R.createBlockStatement(xe),Pe)}function bi(){var xe,Pe;return Pe=L,(xe=Fe()).type!==c.Identifier&&Yn(xe),R.markEnd(R.createIdentifier(xe.value),Pe)}function Sc(xe){var Pe,Ge,pt=null;return Ge=L,Pe=bi(),N&&Ee(Pe.name)&&nn({},p.StrictVarName),xe==="const"?(ln("="),pt=fs()):wn("=")&&(Fe(),pt=fs()),R.markEnd(R.createVariableDeclarator(Pe,pt),Ge)}function po(xe){var Pe=[];do{if(Pe.push(Sc(xe)),!wn(","))break;Fe()}while(T<F);return Pe}function Da(){var xe,Pe,Ge,pt,At,qt,pn,Fn,wr,Kn,yn=q.allowIn;return xe=Pe=Ge=null,Qn("for"),ln("("),wn(";")?Fe():(_r("var")||_r("let")?(q.allowIn=!1,Kn=L,Fn=Fe(),wr=po(),xe=R.markEnd(R.createVariableDeclaration(wr,Fn.value),Kn),q.allowIn=yn,xe.declarations.length===1&&_r("in")&&(Fe(),pt=xe,At=Ao(),xe=null)):(q.allowIn=!1,xe=Ao(),q.allowIn=yn,_r("in")&&(ss(xe)||nn({},p.InvalidLHSInForIn),Fe(),pt=xe,At=Ao(),xe=null)),pt===void 0&&ln(";")),pt===void 0&&(wn(";")||(Pe=Ao()),ln(";"),wn(")")||(Ge=Ao())),ln(")"),pn=q.inIteration,q.inIteration=!0,qt=ze(),q.inIteration=pn,pt===void 0?R.createForStatement(xe,Pe,Ge,qt):R.createForInStatement(pt,At,qt)}function Oo(){var xe,Pe,Ge,pt=[];for(Ge=L,_r("default")?(Fe(),xe=null):(Qn("case"),xe=Ao()),ln(":");T<F&&!(wn("}")||_r("default")||_r("case"));)Pe=ze(),pt.push(Pe);return R.markEnd(R.createSwitchCase(xe,pt),Ge)}function xt(){var xe,Pe,Ge,pt,At=[],qt=null;return Qn("try"),xe=Hs(),_r("catch")&&At.push((pt=L,Qn("catch"),ln("("),wn(")")&&Yn(L),Pe=bi(),N&&Ee(Pe.name)&&nn({},p.StrictCatchVariable),ln(")"),Ge=Hs(),R.markEnd(R.createCatchClause(Pe,Ge),pt))),_r("finally")&&(Fe(),qt=Hs()),At.length!==0||qt||cn({},p.NoCatchOrFinally),R.createTryStatement(xe,[],At,qt)}function ze(){var xe,Pe,Ge,pt,At,qt,pn,Fn,wr,Kn=L.type;if(Kn===c.EOF&&Yn(L),Kn===c.Punctuator&&L.value==="{")return Hs();if(pt=L,Kn===c.Punctuator)switch(L.value){case";":return R.markEnd((ln(";"),R.createEmptyStatement()),pt);case"(":return R.markEnd(function(){var yn=Ao();return Ar(),R.createExpressionStatement(yn)}(),pt)}if(Kn===c.Keyword)switch(L.value){case"break":return R.markEnd(function(){var yn,Cn=null;return Qn("break"),v.charCodeAt(T)===59?(Fe(),q.inIteration||q.inSwitch||cn({},p.IllegalBreak),R.createBreakStatement(null)):an()?(q.inIteration||q.inSwitch||cn({},p.IllegalBreak),R.createBreakStatement(null)):(L.type===c.Identifier&&(yn="$"+(Cn=bi()).name,Object.prototype.hasOwnProperty.call(q.labelSet,yn)||cn({},p.UnknownLabel,Cn.name)),Ar(),Cn!==null||q.inIteration||q.inSwitch||cn({},p.IllegalBreak),R.createBreakStatement(Cn))}(),pt);case"continue":return R.markEnd(function(){var yn,Cn=null;return Qn("continue"),v.charCodeAt(T)===59?(Fe(),q.inIteration||cn({},p.IllegalContinue),R.createContinueStatement(null)):an()?(q.inIteration||cn({},p.IllegalContinue),R.createContinueStatement(null)):(L.type===c.Identifier&&(yn="$"+(Cn=bi()).name,Object.prototype.hasOwnProperty.call(q.labelSet,yn)||cn({},p.UnknownLabel,Cn.name)),Ar(),Cn!==null||q.inIteration||cn({},p.IllegalContinue),R.createContinueStatement(Cn))}(),pt);case"debugger":return R.markEnd((Qn("debugger"),Ar(),R.createDebuggerStatement()),pt);case"do":return R.markEnd((Qn("do"),wr=q.inIteration,q.inIteration=!0,pn=ze(),q.inIteration=wr,Qn("while"),ln("("),Fn=Ao(),ln(")"),wn(";")&&Fe(),R.createDoWhileStatement(pn,Fn)),pt);case"for":return R.markEnd(Da(),pt);case"function":return R.markEnd(Qt(),pt);case"if":return R.markEnd(function(){var yn,Cn,Io;return Qn("if"),ln("("),yn=Ao(),ln(")"),Cn=ze(),_r("else")?(Fe(),Io=ze()):Io=null,R.createIfStatement(yn,Cn,Io)}(),pt);case"return":return R.markEnd((qt=null,Qn("return"),q.inFunctionBody||nn({},p.IllegalReturn),v.charCodeAt(T)===32&&ae(v.charCodeAt(T+1))?(qt=Ao(),Ar(),R.createReturnStatement(qt)):an()?R.createReturnStatement(null):(wn(";")||wn("}")||L.type===c.EOF||(qt=Ao()),Ar(),R.createReturnStatement(qt))),pt);case"switch":return R.markEnd(function(){var yn,Cn,Io,Zo,ji;if(Qn("switch"),ln("("),yn=Ao(),ln(")"),ln("{"),Cn=[],wn("}"))return Fe(),R.createSwitchStatement(yn,Cn);for(Zo=q.inSwitch,q.inSwitch=!0,ji=!1;T<F&&!wn("}");)(Io=Oo()).test===null&&(ji&&cn({},p.MultipleDefaultsInSwitch),ji=!0),Cn.push(Io);return q.inSwitch=Zo,ln("}"),R.createSwitchStatement(yn,Cn)}(),pt);case"throw":return R.markEnd(function(){var yn;return Qn("throw"),an()&&cn({},p.NewlineAfterThrow),yn=Ao(),Ar(),R.createThrowStatement(yn)}(),pt);case"try":return R.markEnd(xt(),pt);case"var":return R.markEnd((Qn("var"),At=po(),Ar(),R.createVariableDeclaration(At,"var")),pt);case"while":return R.markEnd(function(){var yn,Cn,Io;return Qn("while"),ln("("),yn=Ao(),ln(")"),Io=q.inIteration,q.inIteration=!0,Cn=ze(),q.inIteration=Io,R.createWhileStatement(yn,Cn)}(),pt);case"with":return R.markEnd(function(){var yn,Cn;return N&&(je(),nn({},p.StrictModeWith)),Qn("with"),ln("("),yn=Ao(),ln(")"),Cn=ze(),R.createWithStatement(yn,Cn)}(),pt)}return(xe=Ao()).type===g.Identifier&&wn(":")?(Fe(),Ge="$"+xe.name,Object.prototype.hasOwnProperty.call(q.labelSet,Ge)&&cn({},p.Redeclaration,"Label",xe.name),q.labelSet[Ge]=!0,Pe=ze(),delete q.labelSet[Ge],R.markEnd(R.createLabeledStatement(xe,Pe),pt)):(Ar(),R.markEnd(R.createExpressionStatement(xe),pt))}function Xt(){var xe,Pe,Ge,pt,At,qt,pn,Fn,wr=[];for(Fn=L,ln("{");T<F&&L.type===c.StringLiteral&&(Pe=L,xe=Gn(),wr.push(xe),xe.expression.type===g.Literal);)v.slice(Pe.start+1,Pe.end-1)==="use strict"?(N=!0,Ge&&nn(Ge,p.StrictOctalLiteral)):!Ge&&Pe.octal&&(Ge=Pe);for(pt=q.labelSet,At=q.inIteration,qt=q.inSwitch,pn=q.inFunctionBody,q.labelSet={},q.inIteration=!1,q.inSwitch=!1,q.inFunctionBody=!0;T<F&&!wn("}")&&(xe=Gn())!==void 0;)wr.push(xe);return ln("}"),q.labelSet=pt,q.inIteration=At,q.inSwitch=qt,q.inFunctionBody=pn,R.markEnd(R.createBlockStatement(wr),Fn)}function Yt(xe){var Pe,Ge,pt,At,qt,pn,Fn=[];if(ln("("),!wn(")"))for(At={};T<F&&(Ge=L,Pe=bi(),qt="$"+Ge.value,N?(Ee(Ge.value)&&(pt=Ge,pn=p.StrictParamName),Object.prototype.hasOwnProperty.call(At,qt)&&(pt=Ge,pn=p.StrictParamDupe)):xe||(Ee(Ge.value)?(xe=Ge,pn=p.StrictParamName):he(Ge.value)?(xe=Ge,pn=p.StrictReservedWord):Object.prototype.hasOwnProperty.call(At,qt)&&(xe=Ge,pn=p.StrictParamDupe)),Fn.push(Pe),At[qt]=!0,!wn(")"));)ln(",");return ln(")"),{params:Fn,stricted:pt,firstRestricted:xe,message:pn}}function Qt(){var xe,Pe,Ge,pt,At,qt,pn,Fn,wr,Kn;return Kn=L,Qn("function"),pt=L,xe=bi(),N?Ee(pt.value)&&nn(pt,p.StrictFunctionName):Ee(pt.value)?(pn=pt,Fn=p.StrictFunctionName):he(pt.value)&&(pn=pt,Fn=p.StrictReservedWord),Pe=(qt=Yt(pn)).params,At=qt.stricted,pn=qt.firstRestricted,qt.message&&(Fn=qt.message),wr=N,Ge=Xt(),N&&pn&&cn(pn,Fn),N&&At&&nn(At,Fn),N=wr,R.markEnd(R.createFunctionDeclaration(xe,Pe,[],Ge),Kn)}function Gn(){if(L.type===c.Keyword)switch(L.value){case"const":case"let":return xe=L.value,Ge=L,Qn(xe),Pe=po(xe),Ar(),R.markEnd(R.createVariableDeclaration(Pe,xe),Ge);case"function":return Qt();default:return ze()}var xe,Pe,Ge;if(L.type!==c.EOF)return ze()}function Un(){var xe,Pe;return je(),lt(),Pe=L,N=!1,xe=function(){for(var Ge,pt,At,qt=[];T<F&&(pt=L).type===c.StringLiteral&&(Ge=Gn(),qt.push(Ge),Ge.expression.type===g.Literal);)v.slice(pt.start+1,pt.end-1)==="use strict"?(N=!0,At&&nn(At,p.StrictOctalLiteral)):!At&&pt.octal&&(At=pt);for(;T<F&&(Ge=Gn())!==void 0;)qt.push(Ge);return qt}(),R.markEnd(R.createProgram(xe),Pe)}function ar(){var xe,Pe,Ge,pt=[];for(xe=0;xe<U.tokens.length;++xe)Ge={type:(Pe=U.tokens[xe]).type,value:Pe.value},U.range&&(Ge.range=Pe.range),U.loc&&(Ge.loc=Pe.loc),pt.push(Ge);U.tokens=pt}(h={})[(c={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9}).BooleanLiteral]="Boolean",h[c.EOF]="<end>",h[c.Identifier]="Identifier",h[c.Keyword]="Keyword",h[c.NullLiteral]="Null",h[c.NumericLiteral]="Numeric",h[c.Punctuator]="Punctuator",h[c.StringLiteral]="String",h[c.RegularExpression]="RegularExpression",f=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],g={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},d={Data:1,Get:2,Set:4},p={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},m={NonAsciiIdentifierStart:new RegExp("[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F0\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]"),NonAsciiIdentifierPart:new RegExp("[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0\u08A2-\u08AC\u08E4-\u08FE\u0900-\u0963\u0966-\u096F\u0971-\u0977\u0979-\u097F\u0981-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C01-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C82\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D02\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F0\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191C\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1D00-\u1DE6\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA697\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A\uAA7B\uAA80-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE26\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]")},y={name:"SyntaxTree",processComment:function(xe){var Pe,Ge;if(!(xe.type===g.Program&&xe.body.length>0)){for(U.trailingComments.length>0?U.trailingComments[0].range[0]>=xe.range[1]?(Ge=U.trailingComments,U.trailingComments=[]):U.trailingComments.length=0:U.bottomRightStack.length>0&&U.bottomRightStack[U.bottomRightStack.length-1].trailingComments&&U.bottomRightStack[U.bottomRightStack.length-1].trailingComments[0].range[0]>=xe.range[1]&&(Ge=U.bottomRightStack[U.bottomRightStack.length-1].trailingComments,delete U.bottomRightStack[U.bottomRightStack.length-1].trailingComments);U.bottomRightStack.length>0&&U.bottomRightStack[U.bottomRightStack.length-1].range[0]>=xe.range[0];)Pe=U.bottomRightStack.pop();Pe?Pe.leadingComments&&Pe.leadingComments[Pe.leadingComments.length-1].range[1]<=xe.range[0]&&(xe.leadingComments=Pe.leadingComments,delete Pe.leadingComments):U.leadingComments.length>0&&U.leadingComments[U.leadingComments.length-1].range[1]<=xe.range[0]&&(xe.leadingComments=U.leadingComments,U.leadingComments=[]),Ge&&(xe.trailingComments=Ge),U.bottomRightStack.push(xe)}},markEnd:function(xe,Pe){return U.range&&(xe.range=[Pe.start,T]),U.loc&&(xe.loc=new Ht(Pe.startLineNumber===void 0?Pe.lineNumber:Pe.startLineNumber,Pe.start-(Pe.startLineStart===void 0?Pe.lineStart:Pe.startLineStart),O,T-S),this.postProcess(xe)),U.attachComment&&this.processComment(xe),xe},postProcess:function(xe){return U.source&&(xe.loc.source=U.source),xe},createArrayExpression:function(xe){return{type:g.ArrayExpression,elements:xe}},createAssignmentExpression:function(xe,Pe,Ge){return{type:g.AssignmentExpression,operator:xe,left:Pe,right:Ge}},createBinaryExpression:function(xe,Pe,Ge){return{type:xe==="||"||xe==="&&"?g.LogicalExpression:g.BinaryExpression,operator:xe,left:Pe,right:Ge}},createBlockStatement:function(xe){return{type:g.BlockStatement,body:xe}},createBreakStatement:function(xe){return{type:g.BreakStatement,label:xe}},createCallExpression:function(xe,Pe){return{type:g.CallExpression,callee:xe,arguments:Pe}},createCatchClause:function(xe,Pe){return{type:g.CatchClause,param:xe,body:Pe}},createConditionalExpression:function(xe,Pe,Ge){return{type:g.ConditionalExpression,test:xe,consequent:Pe,alternate:Ge}},createContinueStatement:function(xe){return{type:g.ContinueStatement,label:xe}},createDebuggerStatement:function(){return{type:g.DebuggerStatement}},createDoWhileStatement:function(xe,Pe){return{type:g.DoWhileStatement,body:xe,test:Pe}},createEmptyStatement:function(){return{type:g.EmptyStatement}},createExpressionStatement:function(xe){return{type:g.ExpressionStatement,expression:xe}},createForStatement:function(xe,Pe,Ge,pt){return{type:g.ForStatement,init:xe,test:Pe,update:Ge,body:pt}},createForInStatement:function(xe,Pe,Ge){return{type:g.ForInStatement,left:xe,right:Pe,body:Ge,each:!1}},createFunctionDeclaration:function(xe,Pe,Ge,pt){return{type:g.FunctionDeclaration,id:xe,params:Pe,defaults:Ge,body:pt,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(xe,Pe,Ge,pt){return{type:g.FunctionExpression,id:xe,params:Pe,defaults:Ge,body:pt,rest:null,generator:!1,expression:!1}},createIdentifier:function(xe){return{type:g.Identifier,name:xe}},createIfStatement:function(xe,Pe,Ge){return{type:g.IfStatement,test:xe,consequent:Pe,alternate:Ge}},createLabeledStatement:function(xe,Pe){return{type:g.LabeledStatement,label:xe,body:Pe}},createLiteral:function(xe){return{type:g.Literal,value:xe.value,raw:v.slice(xe.start,xe.end)}},createMemberExpression:function(xe,Pe,Ge){return{type:g.MemberExpression,computed:xe==="[",object:Pe,property:Ge}},createNewExpression:function(xe,Pe){return{type:g.NewExpression,callee:xe,arguments:Pe}},createObjectExpression:function(xe){return{type:g.ObjectExpression,properties:xe}},createPostfixExpression:function(xe,Pe){return{type:g.UpdateExpression,operator:xe,argument:Pe,prefix:!1}},createProgram:function(xe){return{type:g.Program,body:xe}},createProperty:function(xe,Pe,Ge){return{type:g.Property,key:Pe,value:Ge,kind:xe}},createReturnStatement:function(xe){return{type:g.ReturnStatement,argument:xe}},createSequenceExpression:function(xe){return{type:g.SequenceExpression,expressions:xe}},createSwitchCase:function(xe,Pe){return{type:g.SwitchCase,test:xe,consequent:Pe}},createSwitchStatement:function(xe,Pe){return{type:g.SwitchStatement,discriminant:xe,cases:Pe}},createThisExpression:function(){return{type:g.ThisExpression}},createThrowStatement:function(xe){return{type:g.ThrowStatement,argument:xe}},createTryStatement:function(xe,Pe,Ge,pt){return{type:g.TryStatement,block:xe,guardedHandlers:Pe,handlers:Ge,finalizer:pt}},createUnaryExpression:function(xe,Pe){return xe==="++"||xe==="--"?{type:g.UpdateExpression,operator:xe,argument:Pe,prefix:!0}:{type:g.UnaryExpression,operator:xe,argument:Pe,prefix:!0}},createVariableDeclaration:function(xe,Pe){return{type:g.VariableDeclaration,declarations:xe,kind:Pe}},createVariableDeclarator:function(xe,Pe){return{type:g.VariableDeclarator,id:xe,init:Pe}},createWhileStatement:function(xe,Pe){return{type:g.WhileStatement,test:xe,body:Pe}},createWithStatement:function(xe,Pe){return{type:g.WithStatement,object:xe,body:Pe}}},u.version="1.2.5",u.tokenize=function(xe,Pe){var Ge;typeof xe=="string"||xe instanceof String||(xe=String(xe)),R=y,T=0,O=(v=xe).length>0?1:0,S=0,F=v.length,L=null,q={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},U={},(Pe=Pe||{}).tokens=!0,U.tokens=[],U.tokenize=!0,U.openParenToken=-1,U.openCurlyToken=-1,U.range=typeof Pe.range=="boolean"&&Pe.range,U.loc=typeof Pe.loc=="boolean"&&Pe.loc,typeof Pe.comment=="boolean"&&Pe.comment&&(U.comments=[]),typeof Pe.tolerant=="boolean"&&Pe.tolerant&&(U.errors=[]);try{if(lt(),L.type===c.EOF)return U.tokens;for(Fe();L.type!==c.EOF;)try{Fe()}catch(pt){if(U.errors){U.errors.push(pt);break}throw pt}ar(),Ge=U.tokens,U.comments!==void 0&&(Ge.comments=U.comments),U.errors!==void 0&&(Ge.errors=U.errors)}catch(pt){throw pt}finally{U={}}return Ge},u.parse=function(xe,Pe){var Ge,pt;pt=String,typeof xe=="string"||xe instanceof String||(xe=pt(xe)),R=y,T=0,O=(v=xe).length>0?1:0,S=0,F=v.length,L=null,q={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},U={},Pe!==void 0&&(U.range=typeof Pe.range=="boolean"&&Pe.range,U.loc=typeof Pe.loc=="boolean"&&Pe.loc,U.attachComment=typeof Pe.attachComment=="boolean"&&Pe.attachComment,U.loc&&Pe.source!==null&&Pe.source!==void 0&&(U.source=pt(Pe.source)),typeof Pe.tokens=="boolean"&&Pe.tokens&&(U.tokens=[]),typeof Pe.comment=="boolean"&&Pe.comment&&(U.comments=[]),typeof Pe.tolerant=="boolean"&&Pe.tolerant&&(U.errors=[]),U.attachComment&&(U.range=!0,U.comments=[],U.bottomRightStack=[],U.trailingComments=[],U.leadingComments=[]));try{Ge=Un(),U.comments!==void 0&&(Ge.comments=U.comments),U.tokens!==void 0&&(ar(),Ge.tokens=U.tokens),U.errors!==void 0&&(Ge.errors=U.errors)}catch(At){throw At}finally{U={}}return Ge},u.Syntax=function(){var xe,Pe={};for(xe in typeof Object.create=="function"&&(Pe=Object.create(null)),g)g.hasOwnProperty(xe)&&(Pe[xe]=g[xe]);return typeof Object.freeze=="function"&&Object.freeze(Pe),Pe}()})=="function"?r.apply(t,o):r)===void 0||(n.exports=s)})()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(n,t,e){"use strict";(function(r){var o=e(11);let s=()=>e(160),i;class a{constructor(){this.util=e(161),this.textEncoder=new this.util.TextEncoder}fetch(c,h){return Object(o.b)().global.fetch!=null?Object(o.b)().global.fetch(c,h):(i==null&&(i=s()),i(c,h))}now(){let c=r.hrtime();return 1e3*c[0]+c[1]/1e6}encode(c,h){if(h!=="utf-8"&&h!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+h);return this.textEncoder.encode(c)}decode(c,h){return c.length===0?"":new this.util.TextDecoder(h).decode(c)}}Object(o.b)().get("IS_NODE")&&Object(o.b)().setPlatform("node",new a)}).call(this,e(44))},function(n,t){},function(n,t){},function(n,t,e){(function(r){var o;(function(s,i,a){function u(f){var g,d=this,p=(g=4022871197,function(m){m=m.toString();for(var y=0;y<m.length;y++){var v=.02519603282416938*(g+=m.charCodeAt(y));v-=g=v>>>0,g=(v*=g)>>>0,g+=4294967296*(v-=g)}return 23283064365386963e-26*(g>>>0)});d.next=function(){var m=2091639*d.s0+23283064365386963e-26*d.c;return d.s0=d.s1,d.s1=d.s2,d.s2=m-(d.c=0|m)},d.c=1,d.s0=p(" "),d.s1=p(" "),d.s2=p(" "),d.s0-=p(f),d.s0<0&&(d.s0+=1),d.s1-=p(f),d.s1<0&&(d.s1+=1),d.s2-=p(f),d.s2<0&&(d.s2+=1),p=null}function c(f,g){return g.c=f.c,g.s0=f.s0,g.s1=f.s1,g.s2=f.s2,g}function h(f,g){var d=new u(f),p=g&&g.state,m=d.next;return m.int32=function(){return 4294967296*d.next()|0},m.double=function(){return m()+11102230246251565e-32*(2097152*m()|0)},m.quick=m,p&&(typeof p=="object"&&c(p,d),m.state=function(){return c(d,{})}),m}i&&i.exports?i.exports=h:e(22)&&e(32)?(o=function(){return h}.call(t,e,t,i))===void 0||(i.exports=o):this.alea=h})(0,r,e(22))}).call(this,e(31)(n))},function(n,t,e){(function(r){var o;(function(s,i,a){function u(f){var g=this,d="";g.x=0,g.y=0,g.z=0,g.w=0,g.next=function(){var m=g.x^g.x<<11;return g.x=g.y,g.y=g.z,g.z=g.w,g.w^=g.w>>>19^m^m>>>8},f===(0|f)?g.x=f:d+=f;for(var p=0;p<d.length+64;p++)g.x^=0|d.charCodeAt(p),g.next()}function c(f,g){return g.x=f.x,g.y=f.y,g.z=f.z,g.w=f.w,g}function h(f,g){var d=new u(f),p=g&&g.state,m=function(){return(d.next()>>>0)/4294967296};return m.double=function(){do var y=((d.next()>>>11)+(d.next()>>>0)/4294967296)/2097152;while(y===0);return y},m.int32=d.next,m.quick=m,p&&(typeof p=="object"&&c(p,d),m.state=function(){return c(d,{})}),m}i&&i.exports?i.exports=h:e(22)&&e(32)?(o=function(){return h}.call(t,e,t,i))===void 0||(i.exports=o):this.xor128=h})(0,r,e(22))}).call(this,e(31)(n))},function(n,t,e){(function(r){var o;(function(s,i,a){function u(f){var g=this,d="";g.next=function(){var m=g.x^g.x>>>2;return g.x=g.y,g.y=g.z,g.z=g.w,g.w=g.v,(g.d=g.d+362437|0)+(g.v=g.v^g.v<<4^m^m<<1)|0},g.x=0,g.y=0,g.z=0,g.w=0,g.v=0,f===(0|f)?g.x=f:d+=f;for(var p=0;p<d.length+64;p++)g.x^=0|d.charCodeAt(p),p==d.length&&(g.d=g.x<<10^g.x>>>4),g.next()}function c(f,g){return g.x=f.x,g.y=f.y,g.z=f.z,g.w=f.w,g.v=f.v,g.d=f.d,g}function h(f,g){var d=new u(f),p=g&&g.state,m=function(){return(d.next()>>>0)/4294967296};return m.double=function(){do var y=((d.next()>>>11)+(d.next()>>>0)/4294967296)/2097152;while(y===0);return y},m.int32=d.next,m.quick=m,p&&(typeof p=="object"&&c(p,d),m.state=function(){return c(d,{})}),m}i&&i.exports?i.exports=h:e(22)&&e(32)?(o=function(){return h}.call(t,e,t,i))===void 0||(i.exports=o):this.xorwow=h})(0,r,e(22))}).call(this,e(31)(n))},function(n,t,e){(function(r){var o;(function(s,i,a){function u(f){var g=this;g.next=function(){var d,p,m=g.x,y=g.i;return d=m[y],p=(d^=d>>>7)^d<<24,p^=(d=m[y+1&7])^d>>>10,p^=(d=m[y+3&7])^d>>>3,p^=(d=m[y+4&7])^d<<7,d=m[y+7&7],p^=(d^=d<<13)^d<<9,m[y]=p,g.i=y+1&7,p},function(d,p){var m,y=[];if(p===(0|p))y[0]=p;else for(p=""+p,m=0;m<p.length;++m)y[7&m]=y[7&m]<<15^p.charCodeAt(m)+y[m+1&7]<<13;for(;y.length<8;)y.push(0);for(m=0;m<8&&y[m]===0;++m);for(m==8?y[7]=-1:y[m],d.x=y,d.i=0,m=256;m>0;--m)d.next()}(g,f)}function c(f,g){return g.x=f.x.slice(),g.i=f.i,g}function h(f,g){f==null&&(f=+new Date);var d=new u(f),p=g&&g.state,m=function(){return(d.next()>>>0)/4294967296};return m.double=function(){do var y=((d.next()>>>11)+(d.next()>>>0)/4294967296)/2097152;while(y===0);return y},m.int32=d.next,m.quick=m,p&&(p.x&&c(p,d),m.state=function(){return c(d,{})}),m}i&&i.exports?i.exports=h:e(22)&&e(32)?(o=function(){return h}.call(t,e,t,i))===void 0||(i.exports=o):this.xorshift7=h})(0,r,e(22))}).call(this,e(31)(n))},function(n,t,e){(function(r){var o;(function(s,i,a){function u(f){var g=this;g.next=function(){var d,p,m=g.w,y=g.X,v=g.i;return g.w=m=m+1640531527|0,p=y[v+34&127],d=y[v=v+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=y[v]=p^d,g.i=v,p+(m^m>>>16)|0},function(d,p){var m,y,v,N,T,O=[],S=128;for(p===(0|p)?(y=p,p=null):(p+="\0",y=0,S=Math.max(S,p.length)),v=0,N=-32;N<S;++N)p&&(y^=p.charCodeAt((N+32)%p.length)),N===0&&(T=y),y^=y<<10,y^=y>>>15,y^=y<<4,y^=y>>>13,N>=0&&(T=T+1640531527|0,v=(m=O[127&N]^=y+T)==0?v+1:0);for(v>=128&&(O[127&(p&&p.length||0)]=-1),v=127,N=512;N>0;--N)y=O[v+34&127],m=O[v=v+1&127],y^=y<<13,m^=m<<17,y^=y>>>15,m^=m>>>12,O[v]=y^m;d.w=T,d.X=O,d.i=v}(g,f)}function c(f,g){return g.i=f.i,g.w=f.w,g.X=f.X.slice(),g}function h(f,g){f==null&&(f=+new Date);var d=new u(f),p=g&&g.state,m=function(){return(d.next()>>>0)/4294967296};return m.double=function(){do var y=((d.next()>>>11)+(d.next()>>>0)/4294967296)/2097152;while(y===0);return y},m.int32=d.next,m.quick=m,p&&(p.X&&c(p,d),m.state=function(){return c(d,{})}),m}i&&i.exports?i.exports=h:e(22)&&e(32)?(o=function(){return h}.call(t,e,t,i))===void 0||(i.exports=o):this.xor4096=h})(0,r,e(22))}).call(this,e(31)(n))},function(n,t,e){(function(r){var o;(function(s,i,a){function u(f){var g=this,d="";g.next=function(){var m=g.b,y=g.c,v=g.d,N=g.a;return m=m<<25^m>>>7^y,y=y-v|0,v=v<<24^v>>>8^N,N=N-m|0,g.b=m=m<<20^m>>>12^y,g.c=y=y-v|0,g.d=v<<16^y>>>16^N,g.a=N-m|0},g.a=0,g.b=0,g.c=-1640531527,g.d=1367130551,f===Math.floor(f)?(g.a=f/4294967296|0,g.b=0|f):d+=f;for(var p=0;p<d.length+20;p++)g.b^=0|d.charCodeAt(p),g.next()}function c(f,g){return g.a=f.a,g.b=f.b,g.c=f.c,g.d=f.d,g}function h(f,g){var d=new u(f),p=g&&g.state,m=function(){return(d.next()>>>0)/4294967296};return m.double=function(){do var y=((d.next()>>>11)+(d.next()>>>0)/4294967296)/2097152;while(y===0);return y},m.int32=d.next,m.quick=m,p&&(typeof p=="object"&&c(p,d),m.state=function(){return c(d,{})}),m}i&&i.exports?i.exports=h:e(22)&&e(32)?(o=function(){return h}.call(t,e,t,i))===void 0||(i.exports=o):this.tychei=h})(0,r,e(22))}).call(this,e(31)(n))},function(n,t,e){var r;(function(o,s){var i,a=this,u=s.pow(256,6),c=s.pow(2,52),h=2*c;function f(y,v,N){var T=[],O=p(function R(L,q){var U,Z=[],ee=typeof L;if(q&&ee=="object")for(U in L)try{Z.push(R(L[U],q-1))}catch{}return Z.length?Z:ee=="string"?L:L+"\0"}((v=v==1?{entropy:!0}:v||{}).entropy?[y,m(o)]:y??function(){try{var R;return i&&(R=i.randomBytes)?R=R(256):(R=new Uint8Array(256),(a.crypto||a.msCrypto).getRandomValues(R)),m(R)}catch{var L=a.navigator,q=L&&L.plugins;return[+new Date,a,q,a.screen,m(o)]}}(),3),T),S=new g(T),F=function(){for(var R=S.g(6),L=u,q=0;R<c;)R=256*(R+q),L*=256,q=S.g(1);for(;R>=h;)R/=2,L/=2,q>>>=1;return(R+q)/L};return F.int32=function(){return 0|S.g(4)},F.quick=function(){return S.g(4)/4294967296},F.double=F,p(m(S.S),o),(v.pass||N||function(R,L,q,U){return U&&(U.S&&d(U,S),R.state=function(){return d(S,{})}),q?(s.random=R,L):R})(F,O,"global"in v?v.global:this==s,v.state)}function g(y){var v,N=y.length,T=this,O=0,S=T.i=T.j=0,F=T.S=[];for(N||(y=[N++]);O<256;)F[O]=O++;for(O=0;O<256;O++)F[O]=F[S=255&S+y[O%N]+(v=F[O])],F[S]=v;(T.g=function(R){for(var L,q=0,U=T.i,Z=T.j,ee=T.S;R--;)L=ee[U=255&U+1],q=256*q+ee[255&(ee[U]=ee[Z=255&Z+L])+(ee[Z]=L)];return T.i=U,T.j=Z,q})(256)}function d(y,v){return v.i=y.i,v.j=y.j,v.S=y.S.slice(),v}function p(y,v){for(var N,T=y+"",O=0;O<T.length;)v[255&O]=255&(N^=19*v[255&O])+T.charCodeAt(O++);return m(v)}function m(y){return String.fromCharCode.apply(0,y)}if(s.seedrandom=f,p(s.random(),o),n.exports){n.exports=f;try{i=e(169)}catch{}}else(r=function(){return f}.call(t,e,t,n))===void 0||(n.exports=r)})([],Math)},function(n,t){},function(n,t,e){(function(r){var o=r!==void 0&&r||typeof self<"u"&&self||window,s=Function.prototype.apply;function i(a,u){this._id=a,this._clearFn=u}t.setTimeout=function(){return new i(s.call(setTimeout,o,arguments),clearTimeout)},t.setInterval=function(){return new i(s.call(setInterval,o,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(a){a&&a.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(o,this._id)},t.enroll=function(a,u){clearTimeout(a._idleTimeoutId),a._idleTimeout=u},t.unenroll=function(a){clearTimeout(a._idleTimeoutId),a._idleTimeout=-1},t._unrefActive=t.active=function(a){clearTimeout(a._idleTimeoutId);var u=a._idleTimeout;u>=0&&(a._idleTimeoutId=setTimeout(function(){a._onTimeout&&a._onTimeout()},u))},e(171),t.setImmediate=typeof self<"u"&&self.setImmediate||r!==void 0&&r.setImmediate||this&&this.setImmediate,t.clearImmediate=typeof self<"u"&&self.clearImmediate||r!==void 0&&r.clearImmediate||this&&this.clearImmediate}).call(this,e(21))},function(n,t,e){(function(r,o){(function(s,i){"use strict";if(!s.setImmediate){var a,u,c,h,f,g=1,d={},p=!1,m=s.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(s);y=y&&y.setTimeout?y:s,{}.toString.call(s.process)==="[object process]"?a=function(T){o.nextTick(function(){N(T)})}:function(){if(s.postMessage&&!s.importScripts){var T=!0,O=s.onmessage;return s.onmessage=function(){T=!1},s.postMessage("","*"),s.onmessage=O,T}}()?(h="setImmediate$"+Math.random()+"$",f=function(T){T.source===s&&typeof T.data=="string"&&T.data.indexOf(h)===0&&N(+T.data.slice(h.length))},s.addEventListener?s.addEventListener("message",f,!1):s.attachEvent("onmessage",f),a=function(T){s.postMessage(h+T,"*")}):s.MessageChannel?((c=new MessageChannel).port1.onmessage=function(T){N(T.data)},a=function(T){c.port2.postMessage(T)}):m&&"onreadystatechange"in m.createElement("script")?(u=m.documentElement,a=function(T){var O=m.createElement("script");O.onreadystatechange=function(){N(T),O.onreadystatechange=null,u.removeChild(O),O=null},u.appendChild(O)}):a=function(T){setTimeout(N,0,T)},y.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var O=new Array(arguments.length-1),S=0;S<O.length;S++)O[S]=arguments[S+1];var F={callback:T,args:O};return d[g]=F,a(g),g++},y.clearImmediate=v}function v(T){delete d[T]}function N(T){if(p)setTimeout(N,0,T);else{var O=d[T];if(O){p=!0;try{(function(S){var F=S.callback,R=S.args;switch(R.length){case 0:F();break;case 1:F(R[0]);break;case 2:F(R[0],R[1]);break;case 3:F(R[0],R[1],R[2]);break;default:F.apply(void 0,R)}})(O)}finally{v(T),p=!1}}}}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,e(21),e(44))},function(n,t){function e(o){for(var s,i=new r(o),a=[];!i.eof();){var u=c();a.push(u)}return a;function c(){var h={};h.deltaTime=i.readVarInt();var f=i.readUInt8();if((240&f)==240){if(f!==255){if(f==240)return h.type="sysEx",d=i.readVarInt(),h.data=i.readBytes(d),h;if(f==247)return h.type="endSysEx",d=i.readVarInt(),h.data=i.readBytes(d),h;throw"Unrecognised MIDI event type byte: "+f}h.meta=!0;var g=i.readUInt8(),d=i.readVarInt();switch(g){case 0:if(h.type="sequenceNumber",d!==2)throw"Expected length for sequenceNumber event is 2, got "+d;return h.number=i.readUInt16(),h;case 1:return h.type="text",h.text=i.readString(d),h;case 2:return h.type="copyrightNotice",h.text=i.readString(d),h;case 3:return h.type="trackName",h.text=i.readString(d),h;case 4:return h.type="instrumentName",h.text=i.readString(d),h;case 5:return h.type="lyrics",h.text=i.readString(d),h;case 6:return h.type="marker",h.text=i.readString(d),h;case 7:return h.type="cuePoint",h.text=i.readString(d),h;case 32:if(h.type="channelPrefix",d!=1)throw"Expected length for channelPrefix event is 1, got "+d;return h.channel=i.readUInt8(),h;case 33:if(h.type="portPrefix",d!=1)throw"Expected length for portPrefix event is 1, got "+d;return h.port=i.readUInt8(),h;case 47:if(h.type="endOfTrack",d!=0)throw"Expected length for endOfTrack event is 0, got "+d;return h;case 81:if(h.type="setTempo",d!=3)throw"Expected length for setTempo event is 3, got "+d;return h.microsecondsPerBeat=i.readUInt24(),h;case 84:if(h.type="smpteOffset",d!=5)throw"Expected length for smpteOffset event is 5, got "+d;var p=i.readUInt8();return h.frameRate={0:24,32:25,64:29,96:30}[96&p],h.hour=31&p,h.min=i.readUInt8(),h.sec=i.readUInt8(),h.frame=i.readUInt8(),h.subFrame=i.readUInt8(),h;case 88:if(h.type="timeSignature",d!=4)throw"Expected length for timeSignature event is 4, got "+d;return h.numerator=i.readUInt8(),h.denominator=1<<i.readUInt8(),h.metronome=i.readUInt8(),h.thirtyseconds=i.readUInt8(),h;case 89:if(h.type="keySignature",d!=2)throw"Expected length for keySignature event is 2, got "+d;return h.key=i.readInt8(),h.scale=i.readUInt8(),h;case 127:return h.type="sequencerSpecific",h.data=i.readBytes(d),h;default:return h.type="unknownMeta",h.data=i.readBytes(d),h.metatypeByte=g,h}}else{var m;if((128&f)==0){if(s===null)throw"Running status byte encountered before status byte";m=f,f=s,h.running=!0}else m=i.readUInt8(),s=f;var y=f>>4;switch(h.channel=15&f,y){case 8:return h.type="noteOff",h.noteNumber=m,h.velocity=i.readUInt8(),h;case 9:var v=i.readUInt8();return h.type=v===0?"noteOff":"noteOn",h.noteNumber=m,h.velocity=v,v===0&&(h.byte9=!0),h;case 10:return h.type="noteAftertouch",h.noteNumber=m,h.amount=i.readUInt8(),h;case 11:return h.type="controller",h.controllerType=m,h.value=i.readUInt8(),h;case 12:return h.type="programChange",h.programNumber=m,h;case 13:return h.type="channelAftertouch",h.amount=m,h;case 14:return h.type="pitchBend",h.value=m+(i.readUInt8()<<7)-8192,h;default:throw"Unrecognised MIDI event type: "+y}}}}function r(o){this.buffer=o,this.bufferLen=this.buffer.length,this.pos=0}r.prototype.eof=function(){return this.pos>=this.bufferLen},r.prototype.readUInt8=function(){var o=this.buffer[this.pos];return this.pos+=1,o},r.prototype.readInt8=function(){var o=this.readUInt8();return 128&o?o-256:o},r.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},r.prototype.readInt16=function(){var o=this.readUInt16();return 32768&o?o-65536:o},r.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},r.prototype.readInt24=function(){var o=this.readUInt24();return 8388608&o?o-16777216:o},r.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},r.prototype.readBytes=function(o){var s=this.buffer.slice(this.pos,this.pos+o);return this.pos+=o,s},r.prototype.readString=function(o){var s=this.readBytes(o);return String.fromCharCode.apply(null,s)},r.prototype.readVarInt=function(){for(var o=0;!this.eof();){var s=this.readUInt8();if(!(128&s))return o+s;o+=127&s,o<<=7}return o},r.prototype.readChunk=function(){var o=this.readString(4),s=this.readUInt32();return{id:o,length:s,data:this.readBytes(s)}},n.exports=function(o){var s=new r(o),i=s.readChunk();if(i.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+i.id+"'";for(var a=function(g){var d=new r(g),p=d.readUInt16(),m=d.readUInt16(),y={format:p,numTracks:m},v=d.readUInt16();return 32768&v?(y.framesPerSecond=256-(v>>8),y.ticksPerFrame=255&v):y.ticksPerBeat=v,y}(i.data),u=[],c=0;!s.eof()&&c<a.numTracks;c++){var h=s.readChunk();if(h.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+h.id+"'";var f=e(h.data);u.push(f)}return{header:a,tracks:u}}},function(n,t){function e(s,i,a){var u,c=new o,h=i.length,f=null;for(u=0;u<h;u++)a.running!==!1&&(a.running||i[u].running)||(f=null),f=r(c,i[u],f,a.useByte9ForNoteOff);s.writeChunk("MTrk",c.buffer)}function r(s,i,a,u){var c=i.type,h=i.deltaTime,f=i.text||"",g=i.data||[],d=null;switch(s.writeVarInt(h),c){case"sequenceNumber":s.writeUInt8(255),s.writeUInt8(0),s.writeVarInt(2),s.writeUInt16(i.number);break;case"text":s.writeUInt8(255),s.writeUInt8(1),s.writeVarInt(f.length),s.writeString(f);break;case"copyrightNotice":s.writeUInt8(255),s.writeUInt8(2),s.writeVarInt(f.length),s.writeString(f);break;case"trackName":s.writeUInt8(255),s.writeUInt8(3),s.writeVarInt(f.length),s.writeString(f);break;case"instrumentName":s.writeUInt8(255),s.writeUInt8(4),s.writeVarInt(f.length),s.writeString(f);break;case"lyrics":s.writeUInt8(255),s.writeUInt8(5),s.writeVarInt(f.length),s.writeString(f);break;case"marker":s.writeUInt8(255),s.writeUInt8(6),s.writeVarInt(f.length),s.writeString(f);break;case"cuePoint":s.writeUInt8(255),s.writeUInt8(7),s.writeVarInt(f.length),s.writeString(f);break;case"channelPrefix":s.writeUInt8(255),s.writeUInt8(32),s.writeVarInt(1),s.writeUInt8(i.channel);break;case"portPrefix":s.writeUInt8(255),s.writeUInt8(33),s.writeVarInt(1),s.writeUInt8(i.port);break;case"endOfTrack":s.writeUInt8(255),s.writeUInt8(47),s.writeVarInt(0);break;case"setTempo":s.writeUInt8(255),s.writeUInt8(81),s.writeVarInt(3),s.writeUInt24(i.microsecondsPerBeat);break;case"smpteOffset":s.writeUInt8(255),s.writeUInt8(84),s.writeVarInt(5);var p=31&i.hour|{24:0,25:32,29:64,30:96}[i.frameRate];s.writeUInt8(p),s.writeUInt8(i.min),s.writeUInt8(i.sec),s.writeUInt8(i.frame),s.writeUInt8(i.subFrame);break;case"timeSignature":s.writeUInt8(255),s.writeUInt8(88),s.writeVarInt(4),s.writeUInt8(i.numerator);var m=255&Math.floor(Math.log(i.denominator)/Math.LN2);s.writeUInt8(m),s.writeUInt8(i.metronome),s.writeUInt8(i.thirtyseconds||8);break;case"keySignature":s.writeUInt8(255),s.writeUInt8(89),s.writeVarInt(2),s.writeInt8(i.key),s.writeUInt8(i.scale);break;case"sequencerSpecific":s.writeUInt8(255),s.writeUInt8(127),s.writeVarInt(g.length),s.writeBytes(g);break;case"unknownMeta":i.metatypeByte!=null&&(s.writeUInt8(255),s.writeUInt8(i.metatypeByte),s.writeVarInt(g.length),s.writeBytes(g));break;case"sysEx":s.writeUInt8(240),s.writeVarInt(g.length),s.writeBytes(g);break;case"endSysEx":s.writeUInt8(247),s.writeVarInt(g.length),s.writeBytes(g);break;case"noteOff":(d=(u!==!1&&i.byte9||u&&i.velocity==0?144:128)|i.channel)!==a&&s.writeUInt8(d),s.writeUInt8(i.noteNumber),s.writeUInt8(i.velocity);break;case"noteOn":(d=144|i.channel)!==a&&s.writeUInt8(d),s.writeUInt8(i.noteNumber),s.writeUInt8(i.velocity);break;case"noteAftertouch":(d=160|i.channel)!==a&&s.writeUInt8(d),s.writeUInt8(i.noteNumber),s.writeUInt8(i.amount);break;case"controller":(d=176|i.channel)!==a&&s.writeUInt8(d),s.writeUInt8(i.controllerType),s.writeUInt8(i.value);break;case"programChange":(d=192|i.channel)!==a&&s.writeUInt8(d),s.writeUInt8(i.programNumber);break;case"channelAftertouch":(d=208|i.channel)!==a&&s.writeUInt8(d),s.writeUInt8(i.amount);break;case"pitchBend":(d=224|i.channel)!==a&&s.writeUInt8(d);var y=8192+i.value,v=127&y,N=y>>7&127;s.writeUInt8(v),s.writeUInt8(N);break;default:throw"Unrecognized event type: "+c}return d}function o(){this.buffer=[]}o.prototype.writeUInt8=function(s){this.buffer.push(255&s)},o.prototype.writeInt8=o.prototype.writeUInt8,o.prototype.writeUInt16=function(s){var i=s>>8&255,a=255&s;this.writeUInt8(i),this.writeUInt8(a)},o.prototype.writeInt16=o.prototype.writeUInt16,o.prototype.writeUInt24=function(s){var i=s>>16&255,a=s>>8&255,u=255&s;this.writeUInt8(i),this.writeUInt8(a),this.writeUInt8(u)},o.prototype.writeInt24=o.prototype.writeUInt24,o.prototype.writeUInt32=function(s){var i=s>>24&255,a=s>>16&255,u=s>>8&255,c=255&s;this.writeUInt8(i),this.writeUInt8(a),this.writeUInt8(u),this.writeUInt8(c)},o.prototype.writeInt32=o.prototype.writeUInt32,o.prototype.writeBytes=function(s){this.buffer=this.buffer.concat(Array.prototype.slice.call(s,0))},o.prototype.writeString=function(s){var i,a=s.length,u=[];for(i=0;i<a;i++)u.push(s.codePointAt(i));this.writeBytes(u)},o.prototype.writeVarInt=function(s){if(s<0)throw"Cannot write negative variable-length integer";if(s<=127)this.writeUInt8(s);else{var i=s,a=[];for(a.push(127&i),i>>=7;i;){var u=127&i|128;a.push(u),i>>=7}this.writeBytes(a.reverse())}},o.prototype.writeChunk=function(s,i){this.writeString(s),this.writeUInt32(i.length),this.writeBytes(i)},n.exports=function(s,i){if(typeof s!="object")throw"Invalid MIDI data";i=i||{};var a,u=s.header||{},c=s.tracks||[],h=c.length,f=new o;for(function(g,d,p){var m=d.format==null?1:d.format,y=128;d.timeDivision?y=d.timeDivision:d.ticksPerFrame&&d.framesPerSecond?y=-(255&d.framesPerSecond)<<8|255&d.ticksPerFrame:d.ticksPerBeat&&(y=32767&d.ticksPerBeat);var v=new o;v.writeUInt16(m),v.writeUInt16(p),v.writeUInt16(y),g.writeChunk("MThd",v.buffer)}(f,u,h),a=0;a<h;a++)e(f,c[a],i);return f.buffer}},function(n,t,e){"use strict";var r=this&&this.__spreadArrays||function(){for(var f=0,g=0,d=arguments.length;g<d;g++)f+=arguments[g].length;var p=Array(f),m=0;for(g=0;g<d;g++)for(var y=arguments[g],v=0,N=y.length;v<N;v++,m++)p[m]=y[v];return p},o=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(t,"__esModule",{value:!0});var s=e(79),i=e(66),a=o(e(175));function u(f){return a.default(f.notes.map(function(g){return function(d,p){return[{absoluteTime:d.ticks,channel:p,deltaTime:0,noteNumber:d.midi,type:"noteOn",velocity:Math.floor(127*d.velocity)},{absoluteTime:d.ticks+d.durationTicks,channel:p,deltaTime:0,noteNumber:d.midi,type:"noteOff",velocity:Math.floor(127*d.noteOffVelocity)}]}(g,f.channel)}))}function c(f,g){return{absoluteTime:f.ticks,channel:g,controllerType:f.number,deltaTime:0,type:"controller",value:f.value}}function h(f){return{absoluteTime:0,channel:f.channel,deltaTime:0,programNumber:f.instrument.number,type:"programChange"}}t.encode=function(f){var g={header:{format:1,numTracks:f.tracks.length+1,ticksPerBeat:f.header.ppq},tracks:r([r([{absoluteTime:0,deltaTime:0,meta:!0,text:f.header.name,type:"trackName"}],f.header.keySignatures.map(function(d){return function(p){var m=i.keySignatureKeys.indexOf(p.key);return{absoluteTime:p.ticks,deltaTime:0,key:m+7,meta:!0,scale:p.scale==="major"?0:1,type:"keySignature"}}(d)}),f.header.meta.map(function(d){return{absoluteTime:(p=d).ticks,deltaTime:0,meta:!0,text:p.text,type:p.type};var p}),f.header.tempos.map(function(d){return function(p){return{absoluteTime:p.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/p.bpm),type:"setTempo"}}(d)}),f.header.timeSignatures.map(function(d){return function(p){return{absoluteTime:p.ticks,deltaTime:0,denominator:p.timeSignature[1],meta:!0,metronome:24,numerator:p.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(d)}))],f.tracks.map(function(d){return r([(p=d.name,{absoluteTime:0,deltaTime:0,meta:!0,text:p,type:"trackName"}),h(d)],u(d),function(m){for(var y=[],v=0;v<127;v++)m.controlChanges.hasOwnProperty(v)&&m.controlChanges[v].forEach(function(N){y.push(c(N,m.channel))});return y}(d),function(m){var y=[];return m.pitchBends.forEach(function(v){y.push(function(N,T){return{absoluteTime:N.ticks,channel:T,deltaTime:0,type:"pitchBend",value:N.value}}(v,m.channel))}),y}(d));var p}))};return g.tracks=g.tracks.map(function(d){d=d.sort(function(m,y){return m.absoluteTime-y.absoluteTime});var p=0;return d.forEach(function(m){m.deltaTime=m.absoluteTime-p,p=m.absoluteTime,delete m.absoluteTime}),d.push({deltaTime:0,meta:!0,type:"endOfTrack"}),d}),new Uint8Array(s.writeMidi(g))}},function(n,t,e){"use strict";function r(s){return function i(a,u){for(var c=0;c<a.length;c++){var h=a[c];Array.isArray(h)?i(h,u):u.push(h)}return u}(s,[])}function o(s,i){if(typeof i!="number")throw new TypeError("Expected the depth to be a number");return function a(u,c,h){h--;for(var f=0;f<u.length;f++){var g=u[f];h>-1&&Array.isArray(g)?a(g,c,h):c.push(g)}return c}(s,[],i)}n.exports=function(s){if(!Array.isArray(s))throw new TypeError("Expected value to be an array");return r(s)},n.exports.from=r,n.exports.depth=function(s,i){if(!Array.isArray(s))throw new TypeError("Expected value to be an array");return o(s,i)},n.exports.fromDepth=o},function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(82);t.createControlChanges=function(){return new Proxy({},{get:function(o,s){return o[s]?o[s]:r.controlChangeIds.hasOwnProperty(s)?o[r.controlChangeIds[s]]:void 0},set:function(o,s,i){return r.controlChangeIds.hasOwnProperty(s)?o[r.controlChangeIds[s]]=i:o[s]=i,!0}})}},function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new WeakMap,o=function(){function s(i,a){r.set(this,a),this.ticks=i.absoluteTime,this.value=i.value}return Object.defineProperty(s.prototype,"time",{get:function(){return r.get(this).ticksToSeconds(this.ticks)},set:function(i){var a=r.get(this);this.ticks=a.secondsToTicks(i)},enumerable:!0,configurable:!0}),s.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},s}();t.PitchBend=o},function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(179),o=new WeakMap,s=function(){function i(a,u){if(this.number=0,o.set(this,u),this.number=0,a){var c=a.find(function(h){return h.type==="programChange"});c&&(this.number=c.programNumber)}}return Object.defineProperty(i.prototype,"name",{get:function(){return this.percussion?r.DrumKitByPatchID[this.number]:r.instrumentByPatchID[this.number]},set:function(a){var u=r.instrumentByPatchID.indexOf(a);u!==-1&&(this.number=u)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"family",{get:function(){return this.percussion?"drums":r.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"percussion",{get:function(){return o.get(this).channel===9},enumerable:!0,configurable:!0}),i.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},i.prototype.fromJSON=function(a){this.number=a.number},i}();t.Instrument=s},function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],t.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],t.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},function(n,t,e){"use strict";function r(c){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][c%12]}Object.defineProperty(t,"__esModule",{value:!0});var o,s,i=(o=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,s={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},function(c){var h=o.exec(c),f=h[1],g=h[2];return s[f.toLowerCase()]+12*(parseInt(g,10)+1)}),a=new WeakMap,u=function(){function c(h,f,g){a.set(this,g),this.midi=h.midi,this.velocity=h.velocity,this.noteOffVelocity=f.velocity,this.ticks=h.ticks,this.durationTicks=f.ticks-h.ticks}return Object.defineProperty(c.prototype,"name",{get:function(){return h=this.midi,f=Math.floor(h/12)-1,r(h)+f.toString();var h,f},set:function(h){this.midi=i(h)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(h){var f=h-this.octave;this.midi+=12*f},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pitch",{get:function(){return r(this.midi)},set:function(h){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(h)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"duration",{get:function(){var h=a.get(this);return h.ticksToSeconds(this.ticks+this.durationTicks)-h.ticksToSeconds(this.ticks)},set:function(h){var f=a.get(this).secondsToTicks(this.time+h);this.durationTicks=f-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"time",{get:function(){return a.get(this).ticksToSeconds(this.ticks)},set:function(h){var f=a.get(this);this.ticks=f.secondsToTicks(h)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"bars",{get:function(){return a.get(this).ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),c.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},c}();t.Note=u},function(n,t,e){"use strict";e.r(t);var r=e(10);e.d(t,"NoteSequence",function(){return r.a})},function(n,t,e){"use strict";e.r(t),e.d(t,"DDSP",function(){return Hr});var r={};e.r(r),e.d(r,"simpleAbsImpl",function(){return Ce}),e.d(r,"addImpl",function(){return Fe}),e.d(r,"ceilImpl",function(){return an}),e.d(r,"expImpl",function(){return cn}),e.d(r,"expm1Impl",function(){return nn}),e.d(r,"floorImpl",function(){return Yn}),e.d(r,"logImpl",function(){return ln}),e.d(r,"maxImpl",function(){return Qn}),e.d(r,"multiplyImpl",function(){return wn}),e.d(r,"notEqualImpl",function(){return Ar}),e.d(r,"rsqrtImpl",function(){return ss}),e.d(r,"sliceImpl",function(){return Qo}),e.d(r,"squaredDifferenceImpl",function(){return Ws}),e.d(r,"subImpl",function(){return ki}),e.d(r,"transposeImpl",function(){return Ai}),e.d(r,"uniqueImpl",function(){return ia});var o=e(0);let s={},i={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function a(te){if(!(te in s)){let k=function(A){if(A!==1&&A!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let j=function(G){if(typeof OffscreenCanvas<"u"&&G===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(A);return j.addEventListener("webglcontextlost",G=>{G.preventDefault(),delete s[A]},!1),A===1?j.getContext("webgl",i)||j.getContext("experimental-webgl",i):j.getContext("webgl2",i)}(te);if(k===null)return console.log("Could not get context for WebGL version",te),null;s[te]=k}let b=s[te];return b.isContextLost()?(delete s[te],a(te)):(b.disable(b.DEPTH_TEST),b.disable(b.STENCIL_TEST),b.disable(b.BLEND),b.disable(b.DITHER),b.disable(b.POLYGON_OFFSET_FILL),b.disable(b.SAMPLE_COVERAGE),b.enable(b.SCISSOR_TEST),b.enable(b.CULL_FACE),b.cullFace(b.BACK),s[te])}var u,c,h;function f(te,b){return[b,te]}function g(te){let b=o.Lb.sizeFromShape(te),k=Math.ceil(b/4);return o.Lb.sizeToSquarishShape(k)}function d(te,b){return[Math.max(1,Math.ceil(b/2)),Math.max(1,Math.ceil(te/2))]}function p(te,b){let k=te,A,j,G,H,re,ie,me,_e,Ue,Be;return Object(o.jb)().getNumber("WEBGL_VERSION")===2?(A=k.R32F,j=k.R16F,G=k.RGBA16F,H=k.RGBA32F,re=k.RED,me=4,_e=1,Ue=k.HALF_FLOAT,Be=k.FLOAT):(A=te.RGBA,j=te.RGBA,G=te.RGBA,H=k.RGBA,re=te.RGBA,me=4,_e=4,Ue=b!=null?b.HALF_FLOAT_OES:null,Be=te.FLOAT),ie=te.RGBA,{internalFormatFloat:A,internalFormatHalfFloat:j,internalFormatPackedHalfFloat:G,internalFormatPackedFloat:H,textureFormatFloat:re,downloadTextureFormat:ie,downloadUnpackNumChannels:me,defaultNumChannels:_e,textureTypeHalfFloat:Ue,textureTypeFloat:Be}}function m(te,b){let k=b();return Object(o.jb)().getBool("DEBUG")&&function(A){let j=A.getError();if(j!==A.NO_ERROR)throw new Error("WebGL Error: "+function(G,H){switch(H){case G.NO_ERROR:return"NO_ERROR";case G.INVALID_ENUM:return"INVALID_ENUM";case G.INVALID_VALUE:return"INVALID_VALUE";case G.INVALID_OPERATION:return"INVALID_OPERATION";case G.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case G.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case G.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+H}}(A,j))}(te),k}(function(te){te[te.DENSE=0]="DENSE",te[te.SHARED_BATCH=1]="SHARED_BATCH"})(u||(u={})),function(te){te[te.RENDER=0]="RENDER",te[te.UPLOAD=1]="UPLOAD",te[te.PIXELS=2]="PIXELS",te[te.DOWNLOAD=3]="DOWNLOAD"}(c||(c={})),function(te){te[te.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",te[te.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",te[te.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",te[te.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",te[te.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(h||(h={}));function y(te){return!!(Object(o.jb)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||te===0||596e-10<Math.abs(te)&&Math.abs(te)<65504)}function v(te,b){return U(te,()=>te.getExtension(b),'Extension "'+b+'" not supported on this browser.')}function N(te,b){let k=U(te,()=>te.createShader(te.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(m(te,()=>te.shaderSource(k,b)),m(te,()=>te.compileShader(k)),te.getShaderParameter(k,te.COMPILE_STATUS)===!1)throw function(A,j){let G=T.exec(j);if(G==null)return console.log("Couldn't parse line number in error: "+j),void console.log(A);let H=+G[1],re=A.split(`
`),ie=re.length.toString().length+2,me=re.map((He,Ke)=>o.Lb.rightPad((Ke+1).toString(),ie)+He),_e=0;for(let He=0;He<me.length;He++)_e=Math.max(me[He].length,_e);let Ue=me.slice(0,H-1),Be=me.slice(H-1,H),Ye=me.slice(H);console.log(Ue.join(`
`)),console.log(j.split(`
`)[0]),console.log("%c "+o.Lb.rightPad(Be[0],_e),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(Ye.join(`
`))}(b,te.getShaderInfoLog(k)),new Error("Failed to compile fragment shader.");return k}let T=/ERROR: [0-9]+:([0-9]+):/g;function O(te,b){if(m(te,()=>te.validateProgram(b)),te.getProgramParameter(b,te.VALIDATE_STATUS)===!1)throw console.log(te.getProgramInfoLog(b)),new Error("Shader program validation failed.")}function S(te,b,k,A,j,G,H){let re=te.getAttribLocation(b,k);return re!==-1&&(m(te,()=>te.bindBuffer(te.ARRAY_BUFFER,A)),m(te,()=>te.vertexAttribPointer(re,j,te.FLOAT,!1,G,H)),m(te,()=>te.enableVertexAttribArray(re)),!0)}function F(te,b,k,A){m(te,()=>function(j,G,H){Z(j,H),m(j,()=>j.activeTexture(j.TEXTURE0+H)),m(j,()=>j.bindTexture(j.TEXTURE_2D,G))}(te,b,A)),m(te,()=>te.uniform1i(k,A))}function R(te,b,k){m(te,()=>te.bindFramebuffer(te.FRAMEBUFFER,k)),m(te,()=>te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,b,0))}function L(te,b){m(te,()=>te.bindFramebuffer(te.FRAMEBUFFER,b)),m(te,()=>te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,null,0))}function q(te){let b=te.checkFramebufferStatus(te.FRAMEBUFFER);if(b!==te.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(k,A){switch(A){case k.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case k.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case k.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case k.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+A}}(te,b))}function U(te,b,k){let A=m(te,()=>b());if(A==null)throw new Error(k);return A}function Z(te,b){let k=te.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,A=b+te.TEXTURE0;if(A<te.TEXTURE0||A>k)throw new Error(`textureUnit must be in ${`[gl.TEXTURE0, gl.TEXTURE${k}]`}.`)}function ee(te,b=2){return o.Lb.sizeFromShape(te.slice(0,te.length-b))}function Q(te){if(te.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[te.length>1?te[te.length-2]:1,te[te.length-1]]}function oe(te){let b=[1,1,1];return te.length===0||te.length===1&&te[0]===1||(b=[ee(te),...Q(te)]),b}function se(te){return te%2==0}function pe(te,b){if(te=te.slice(-2),b=b.slice(-2),o.Lb.arraysEqual(te,b)||!te.length||!b.length||te[0]===0||te[1]===0||b[0]===0||b[1]===0)return!0;if(te.length!==b.length){let k=te.slice(-1)[0],A=b.slice(-1)[0];if(k===A||se(k)&&se(A)&&(te[0]===1||b[0]===1))return!0}return te[1]===b[1]&&se(te[0])&&se(b[0])}let ae,fe;function he(te,b){return te.getExtension(b)!=null}function Ee(te){try{if(a(te)!=null)return!0}catch(b){return console.log("Error when getting WebGL context: ",b),!1}return!1}function Le(te){if(te===0)return!1;let b=a(te);if(te!==1){if(he(b,"EXT_color_buffer_float"))return Ve(b);let k="EXT_color_buffer_half_float";if(he(b,k)){let A=b.getExtension(k);return function(j,G){let H=p(j,G),re=j.createTexture();j.bindTexture(j.TEXTURE_2D,re),j.texImage2D(j.TEXTURE_2D,0,H.internalFormatHalfFloat,1,1,0,H.textureFormatFloat,H.textureTypeHalfFloat,null);let ie=j.createFramebuffer();j.bindFramebuffer(j.FRAMEBUFFER,ie),j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_2D,re,0);let me=j.checkFramebufferStatus(j.FRAMEBUFFER)===j.FRAMEBUFFER_COMPLETE;return j.bindTexture(j.TEXTURE_2D,null),j.bindFramebuffer(j.FRAMEBUFFER,null),j.deleteTexture(re),j.deleteFramebuffer(ie),me}(b,A)}return!1}return!he(b,"OES_texture_float")||!he(b,"WEBGL_color_buffer_float")?!1:Ve(b)}function Ve(te){let b=p(te),k=te.createTexture();te.bindTexture(te.TEXTURE_2D,k),te.texImage2D(te.TEXTURE_2D,0,b.internalFormatFloat,1,1,0,b.textureFormatFloat,b.textureTypeFloat,null);let A=te.createFramebuffer();te.bindFramebuffer(te.FRAMEBUFFER,A),te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,k,0);let j=te.checkFramebufferStatus(te.FRAMEBUFFER)===te.FRAMEBUFFER_COMPLETE;return te.bindTexture(te.TEXTURE_2D,null),te.bindFramebuffer(te.FRAMEBUFFER,null),te.deleteTexture(k),te.deleteFramebuffer(A),j}function qe(te,b){Array.isArray(te)||(te=[te]),te.forEach(k=>{k!=null&&o.Lb.assert(k.dtype!=="complex64",()=>b+" does not support complex64 tensors in the WebGL backend.")})}let je=Object(o.jb)();function Ce(te){let b=new Float32Array(te.length);for(let k=0;k<te.length;++k)b[k]=Math.abs(te[k]);return b}je.registerFlag("HAS_WEBGL",()=>je.getNumber("WEBGL_VERSION")>0),je.registerFlag("WEBGL_VERSION",()=>Ee(2)?2:Ee(1)?1:0),je.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),je.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>je.get("WEBGL_VERSION")===2),je.registerFlag("WEBGL_CPU_FORWARD",()=>!0),je.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),je.registerFlag("WEBGL_PACK",()=>je.getBool("HAS_WEBGL")),je.registerFlag("WEBGL_PACK_NORMALIZATION",()=>je.getBool("WEBGL_PACK")),je.registerFlag("WEBGL_PACK_CLIP",()=>je.getBool("WEBGL_PACK")),je.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>!1),je.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>je.getBool("WEBGL_PACK")),je.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>je.getBool("WEBGL_PACK")),je.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>je.getBool("WEBGL_PACK")),je.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>je.getBool("WEBGL_PACK")),je.registerFlag("WEBGL_PACK_REDUCE",()=>je.getBool("WEBGL_PACK")),je.registerFlag("WEBGL_LAZILY_UNPACK",()=>je.getBool("WEBGL_PACK")),je.registerFlag("WEBGL_CONV_IM2COL",()=>je.getBool("WEBGL_PACK")),je.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>function(te){if(ae==null){let b=a(te);ae=b.getParameter(b.MAX_TEXTURE_SIZE)}return ae}(je.getNumber("WEBGL_VERSION"))),je.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>function(te){if(fe==null){let b=a(te);fe=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,fe)}(je.getNumber("WEBGL_VERSION"))),je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let te=je.getNumber("WEBGL_VERSION");return te===0?0:function(b){if(b===0)return 0;let k,A=a(b);return k=he(A,"EXT_disjoint_timer_query_webgl2")&&b===2?2:he(A,"EXT_disjoint_timer_query")?1:0,k}(te)}),je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>je.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!o.fb.isMobile()),je.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>function(te){if(te===0)return!1;let b=a(te);if(te===1){if(!he(b,"OES_texture_float"))return!1}else if(!he(b,"EXT_color_buffer_float"))return!1;return Ve(b)}(je.getNumber("WEBGL_VERSION"))),je.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>!je.getBool("WEBGL_FORCE_F16_TEXTURES")&&je.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),je.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Le(je.getNumber("WEBGL_VERSION"))),je.registerFlag("WEBGL_FENCE_API_ENABLED",()=>{return(te=je.getNumber("WEBGL_VERSION"))===2&&a(te).fenceSync!=null;var te}),je.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>je.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),je.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,te=>{if(te<0&&te!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${te}.`)}),o.a;function tt(te){return(b,k,A,j,G)=>{let H=o.X.assertAndGetBroadcastShape(b,k),re=H.length,ie=o.Lb.computeStrides(H),me=o.Lb.sizeFromShape(H),_e=o.Lb.getTypedArrayFromDType(G,me),Ue=b.length,Be=k.length,Ye=o.Lb.computeStrides(b),He=o.Lb.computeStrides(k),Ke=o.X.getBroadcastDims(b,H),Je=o.X.getBroadcastDims(k,H);if(Ke.length+Je.length===0)for(let Nt=0;Nt<_e.length;++Nt)_e[Nt]=te(A[Nt%A.length],j[Nt%j.length]);else for(let Nt=0;Nt<_e.length;++Nt){let Jt=o.Lb.indexToLoc(Nt,re,ie),on=Jt.slice(-Ue);Ke.forEach(In=>on[In]=0);let dt=o.Lb.locToIndex(on,Ue,Ye),Bt=Jt.slice(-Be);Je.forEach(In=>Bt[In]=0);let wt=o.Lb.locToIndex(Bt,Be,He);_e[Nt]=te(A[dt],j[wt])}return[_e,H]}}function ye(te,b){Array.isArray(te)||(te=[te]),te.forEach(k=>{k!=null&&o.Lb.assert(k.dtype!=="complex64",()=>b+" does not support complex64 tensors in the CPU backend.")})}function z(te){let{inputs:b,backend:k}=te,{real:A,imag:j}=b,G=k.data.get(A.dataId).values,H=k.data.get(j.dataId).values,re=k.makeTensorInfo(A.shape,"complex64");return k.data.get(re.dataId).complexTensorInfos={real:k.makeTensorInfo(A.shape,"float32",G),imag:k.makeTensorInfo(j.shape,"float32",H)},re}o.h;function M(te){let{inputs:b,backend:k}=te,{x:A}=b;return k.incRef(A.dataId),{dataId:A.dataId,shape:A.shape,dtype:A.dtype}}o.u;function W(te){let{inputs:b,backend:k}=te,{input:A}=b,j=k.data.get(A.dataId).complexTensorInfos.real,G=k.data.get(j.dataId).values;return k.makeTensorInfo(j.shape,j.dtype,G)}o.J;function ce(te){let{inputs:b,backend:k,attrs:A}=te,{x:j}=b,{dtype:G}=A;if(G==="complex64"){if(j.dtype==="complex64")return M({inputs:{x:j},backend:k});let H=o.Nb(j.shape),re=ce({inputs:{x:j},backend:k,attrs:{dtype:"float32"}}),ie=z({inputs:{real:re,imag:H},backend:k});return H.dispose(),k.disposeIntermediateTensorInfo(re),ie}if(j.dtype==="complex64"){let H=W({inputs:{input:j},backend:k}),re=ce({inputs:{x:H},backend:k,attrs:{dtype:G}});return k.disposeIntermediateTensorInfo(H),re}if(!o.Lb.hasEncodingLoss(j.dtype,G)){let H=M({inputs:{x:j},backend:k});return{dataId:H.dataId,shape:H.shape,dtype:G}}if(G==="int32"){let H=k.data.get(j.dataId).values,re=Int32Array.from(H);return k.makeTensorInfo(j.shape,"int32",re)}if(G==="bool"){let H=k.data.get(j.dataId).values,re=o.Lb.toTypedArray([0],j.dtype),[ie,me]=tt((_e,Ue)=>_e!==Ue?1:0)(j.shape,[],H,re,"bool");return k.makeTensorInfo(me,"bool",ie)}throw new Error(`Error in Cast: failed to cast ${j.dtype} to ${G}`)}o.f;function J(te,b,k,A){return k==null?({inputs:j,backend:G})=>{let{a:H,b:re}=j,ie=G;ye([H,re],te);let me=ie.data.get(H.dataId).values,_e=ie.data.get(re.dataId).values,Ue=A||H.dtype,[Be,Ye]=b(H.shape,re.shape,me,_e,Ue);return ie.makeTensorInfo(Ye,Ue,Be)}:({inputs:j,backend:G})=>{let{a:H,b:re}=j,ie=G;if(H.dtype==="complex64"||re.dtype==="complex64"){let me=ce({inputs:{x:H},backend:ie,attrs:{dtype:"complex64"}}),_e=ie.data.get(me.dataId),Ue=_e.complexTensorInfos.real,Be=_e.complexTensorInfos.imag,Ye=ie.data.get(Ue.dataId).values,He=ie.data.get(Be.dataId).values,Ke=ce({inputs:{x:re},backend:ie,attrs:{dtype:"complex64"}}),Je=ie.data.get(Ke.dataId),Nt=Je.complexTensorInfos.real,Jt=Je.complexTensorInfos.imag,on=ie.data.get(Nt.dataId).values,dt=ie.data.get(Jt.dataId).values,[Bt,wt,In]=k(H.shape,re.shape,Ye,He,on,dt),Ut=ie.makeTensorInfo(In,"float32",Bt),kt=ie.makeTensorInfo(In,"float32",wt),cr=z({inputs:{real:Ut,imag:kt},backend:ie});return ie.disposeIntermediateTensorInfo(me),ie.disposeIntermediateTensorInfo(Ke),ie.disposeIntermediateTensorInfo(Ut),ie.disposeIntermediateTensorInfo(kt),cr}{let me=ie.data.get(H.dataId).values,_e=ie.data.get(re.dataId).values,Ue=A||H.dtype,[Be,Ye]=b(H.shape,re.shape,me,_e,Ue);return ie.makeTensorInfo(Ye,Ue,Be)}}}function Ie(te){return(b,k,A,j,G,H)=>{let re=o.X.assertAndGetBroadcastShape(b,k),ie=o.Lb.sizeFromShape(re),me=re.length,_e=o.Lb.computeStrides(re),Ue=o.Lb.getTypedArrayFromDType("float32",ie),Be=o.Lb.getTypedArrayFromDType("float32",ie),Ye=o.X.getBroadcastDims(b,re),He=o.X.getBroadcastDims(k,re),Ke=o.X.mergeRealAndImagArrays(A,j),Je=o.X.mergeRealAndImagArrays(G,H),Nt=b.length,Jt=o.Lb.computeStrides(b),on=k.length,dt=o.Lb.computeStrides(k);if(Ye.length+He.length===0)for(let Bt=0;Bt<Ue.length;Bt++){let wt=Bt%Ke.length,In=Bt%Je.length,Ut=te(Ke[2*wt],Ke[2*wt+1],Je[2*In],Je[2*In+1]);Ue[Bt]=Ut.real,Be[Bt]=Ut.imag}else for(let Bt=0;Bt<Ue.length;Bt++){let wt=o.Lb.indexToLoc(Bt,me,_e),In=wt.slice(-Nt);Ye.forEach(kr=>In[kr]=0);let Ut=o.Lb.locToIndex(In,Nt,Jt),kt=wt.slice(-on);He.forEach(kr=>kt[kr]=0);let cr=o.Lb.locToIndex(kt,on,dt),er=te(Ke[2*Ut],Ke[2*Ut+1],Je[2*cr],Je[2*cr+1]);Ue[Bt]=er.real,Be[Bt]=er.imag}return[Ue,Be,re]}}let Fe=tt((te,b)=>te+b),lt=Ie((te,b,k,A)=>({real:te+k,imag:b+A}));J(o.b,Fe,lt),o.b;function Dt(te){return(b,k,A)=>{let j=o.Lb.getTypedArrayFromDType(k,b.length);for(let G=0;G<b.length;++G)j[G]=te(b[G],A);return j}}function Ht(te,b,k){return({inputs:A,attrs:j,backend:G})=>{let{x:H}=A;if(ye(H,te),H.dtype==="string"||k==="string")throw new Error("unaryKernelFunc does not support string input/output");let re=G,ie=re.data.get(H.dataId).values,me=k||H.dtype,_e=b(ie,me,j);return re.makeTensorInfo(H.shape,me,_e)}}let an=Dt(te=>Math.ceil(te)),cn=(Ht(o.g,an),o.g,Dt(te=>Math.exp(te))),nn=(Ht(o.m,cn),o.m,Dt(te=>Math.expm1(te))),Yn=(Ht(o.n,nn),o.n,Dt(te=>Math.floor(te))),ln=(Ht(o.q,Yn),o.q,Dt(te=>Math.log(te)));Ht(o.x,ln),o.x;function Qn(te,b,k,A){let j=o.Lb.getTypedArrayFromDType(A,o.Lb.sizeFromShape(k));for(let G=0;G<j.length;++G){let H=G*b,re=te[H];for(let ie=0;ie<b;++ie){let me=te[H+ie];me>re&&(re=me)}j[G]=re}return j}let wn=tt((te,b)=>te*b),_r=Ie((te,b,k,A)=>({real:te*k-b*A,imag:te*A+b*k})),Ar=(J(o.E,wn,_r),o.E,tt((te,b)=>te!==b?1:0)),ss=(J(o.I,Ar,null,"bool"),o.I,Dt(te=>1/Math.sqrt(te)));Ht(o.M,ss),o.M;function Qo(te,b,k,A,j){let G=o.Ab.isSliceContinous(A,b,k),H=o.Lb.sizeFromShape(k),re=o.Lb.computeStrides(A);if(G){let me=o.Ab.computeFlatOffset(b,re);return te.subarray(me,me+H)}let ie=o.Lb.getTypedArrayFromDType(j,H);for(let me=0;me<H;++me){let _e=k.length,Ue=o.Lb.computeStrides(k),Be=o.Lb.indexToLoc(me,_e,Ue).map((He,Ke)=>He+b[Ke]),Ye=o.Lb.locToIndex(Be,A.length,re);ie[me]=te[Ye]}return ie}o.O;let Ws=tt((te,b)=>{let k=te-b;return k*k}),ki=(J(o.Q,Ws),o.Q,tt((te,b)=>te-b)),Di=Ie((te,b,k,A)=>({real:te-k,imag:b-A}));J(o.R,ki,Di),o.R;function Ai(te,b,k,A,j){let G=b.length,H=o.Lb.sizeFromShape(b),re=o.Lb.computeStrides(b),ie=o.Lb.computeStrides(j),me=o.Lb.getTypedArrayFromDType(k,o.Lb.sizeFromShape(j));for(let _e=0;_e<H;++_e){let Ue=o.Lb.indexToLoc(_e,G,re),Be=new Array(Ue.length);for(let Ye=0;Ye<Be.length;Ye++)Be[Ye]=Ue[A[Ye]];me[o.Lb.locToIndex(Be,G,ie)]=te[_e]}return me}function ia(te,b,k,A){let j=o.Lb.parseAxisParam(b,k)[0],G=[1,k[0],1];for(let He=0;He<j;He++)G[0]*=k[He];G[1]=k[j];for(let He=j+1;He<k.length;He++)G[2]*=k[He];let H={},re=new Int32Array(k[j]),ie=new o.T(G,A,te),me=[],_e=G[0]===1&&G[2]===1;for(let He=0;He<k[j];He++){let Ke;if(_e)Ke=te[He].toString();else{let Je=[];for(let Nt=0;Nt<G[0];Nt++)for(let Jt=0;Jt<G[2];Jt++)Je.push(ie.get(Nt,He,Jt));Ke=Je.join(",")}if(H[Ke]!==void 0)re[He]=H[Ke];else{let Je=Object.keys(H).length;H[Ke]=Je,re[He]=Je,me.push(He)}}let Ue=G.slice();Ue[1]=Object.keys(H).length;let Be=new o.T(Ue,A);me.forEach((He,Ke)=>{for(let Je=0;Je<G[0];Je++)for(let Nt=0;Nt<G[2];Nt++)Be.set(ie.get(Je,He,Nt),Je,Ke,Nt)});let Ye=k.slice();return Ye[j]=Ue[1],{outputValues:Be.values,outputShape:Ye,indices:re}}let{simpleAbsImpl:aa,addImpl:Nu,ceilImpl:vc,expImpl:eu,expm1Impl:ds,floorImpl:wc,logImpl:ku,maxImpl:fs,multiplyImpl:Ao,rsqrtImpl:Hs,sliceImpl:bi,subImpl:Sc,transposeImpl:po,uniqueImpl:Da}=r;class Oo{constructor(b,k){this.outputShape=[],this.outputShape=b,this.variableNames=k.map((G,H)=>"T"+H);let A=[];this.variableNames.forEach(G=>{A.push(`float v${G} = get${G}AtOutCoords();`)});let j=this.variableNames.map(G=>"v"+G).join(" + ");this.userCode=`
      void main() {
        ${A.join(`
        `)}

        float result = ${j};
        setOutput(result);
      }
    `}}class xt{constructor(b,k){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b,this.variableNames=k.map((G,H)=>"T"+H);let A=[];this.variableNames.forEach(G=>{A.push(`vec4 v${G} = get${G}AtOutCoords();`)});let j=this.variableNames.map(G=>"v"+G).join(" + ");this.userCode=`
      void main() {
        ${A.join(`
        `)}

        vec4 result = ${j};
        setOutput(result);
      }
    `}}class ze{constructor(b,k,A){this.variableNames=["A"];let{windowSize:j,batchSize:G,outSize:H}=b;A||this.variableNames.push("bestIndicesA"),this.outputShape=[G,H];let re=k==="max"?">":"<",ie=A?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${j};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${j}; i++) {
          int inIdx = ${ie};
          float candidate = getA(batch, inIdx);
          if (candidate ${re} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}function Xt(te,b){return["x","y","z","w","u","v"].slice(0,b).map(k=>`${te}.${k}`)}function Yt(te,b){return b===1?[te]:Xt(te,b)}function Qt(){let te,b,k,A,j,G,H,re,ie,me;return Object(o.jb)().getNumber("WEBGL_VERSION")===2?(te="#version 300 es",b="in",k="out",A="in",j="texture",G="outputColor",H="out vec4 outputColor;",re=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,ie="",me=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(te="",b="attribute",k="varying",A="varying",j="texture2D",G="gl_FragColor",H="",re=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,ie=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,me=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:te,attribute:b,varyingVs:k,varyingFs:A,texture2D:j,output:G,defineOutput:H,defineSpecialNaN:re,defineSpecialInf:ie,defineRound:me}}function Gn(te,b,k="index"){let A=o.Lb.computeStrides(b);return A.map((j,G)=>`${`int ${te[G]} = ${k} / ${j}`}; ${G===A.length-1?`int ${te[G+1]} = ${k} - ${te[G]} * ${j}`:`index -= ${te[G]} * ${j}`};`).join("")}function Un(te){let b=o.Lb.computeStrides(te).map(k=>k.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${b[0]} + coords.y * ${b[1]} + coords.z;
  }
`}let ar=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,{getBroadcastDims:xe}=o.X;function Pe(te,b,k,A){let j=[];te.forEach(Ye=>{let He=o.Lb.sizeFromShape(Ye.shapeInfo.logicalShape);Ye.shapeInfo.isUniform?j.push(`uniform float ${Ye.name}${He>1?`[${He}]`:""};`):(j.push(`uniform sampler2D ${Ye.name};`),j.push(`uniform int offset${Ye.name};`))});let G=j.join(`
`),H=te.map(Ye=>function(He,Ke,Je=!1){let Nt="";Nt+=Je?pt(He):Ge(He);let Jt=He.shapeInfo.logicalShape,on=Ke.logicalShape;return Jt.length<=on.length&&(Nt+=Je?function(dt,Bt){let wt=dt.name,In=wt.charAt(0).toUpperCase()+wt.slice(1),Ut="get"+In+"AtOutCoords",kt=dt.shapeInfo.logicalShape.length,cr=Bt.logicalShape.length,er=xe(dt.shapeInfo.logicalShape,Bt.logicalShape),kr=Cn(cr),Kr=cr-kt,mn,Ys=["x","y","z","w","u","v"];mn=kt===0?"":cr<2&&er.length>=1?"coords = 0;":er.map(Bs=>`coords.${Ys[Bs+Kr]} = 0;`).join(`
`);let Qs="";Qs=cr<2&&kt>0?"coords":dt.shapeInfo.logicalShape.map((Bs,ha)=>"coords."+Ys[ha+Kr]).join(", ");let Sn="return outputValue;",Ls=o.Lb.sizeFromShape(dt.shapeInfo.logicalShape)===1,si=o.Lb.sizeFromShape(Bt.logicalShape)===1;if(kt!==1||Ls||si){if(Ls&&!si)Sn=cr===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(er.length){let Bs=kt-2,ha=kt-1;er.indexOf(Bs)>-1&&er.indexOf(ha)>-1?Sn="return vec4(outputValue.x);":er.indexOf(Bs)>-1?Sn="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":er.indexOf(ha)>-1&&(Sn="return vec4(outputValue.xx, outputValue.zz);")}}else Sn=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 ${Ut}() {
      ${kr} coords = getOutputCoords();
      ${mn}
      vec4 outputValue = get${In}(${Qs});
      ${Sn}
    }
  `}(He,Ke):function(dt,Bt){let wt=dt.name,In=wt.charAt(0).toUpperCase()+wt.slice(1),Ut="get"+In+"AtOutCoords",kt=Bt.texShape,cr=dt.shapeInfo.texShape,er=dt.shapeInfo.logicalShape.length,kr=Bt.logicalShape.length;if(!dt.shapeInfo.isUniform&&er===kr&&dt.shapeInfo.flatOffset==null&&o.Lb.arraysEqual(cr,kt))return`
      float ${Ut}() {
        return sampleTexture(${wt}, resultUV);
      }
    `;let Kr=Cn(kr),mn=xe(dt.shapeInfo.logicalShape,Bt.logicalShape),Ys=kr-er,Qs,Sn=["x","y","z","w","u","v"];Qs=er===0?"":kr<2&&mn.length>=1?"coords = 0;":mn.map(si=>`coords.${Sn[si+Ys]} = 0;`).join(`
`);let Ls="";return Ls=kr<2&&er>0?"coords":dt.shapeInfo.logicalShape.map((si,Bs)=>"coords."+Sn[Bs+Ys]).join(", "),`
    float ${Ut}() {
      ${Kr} coords = getOutputCoords();
      ${Qs}
      return get${In}(${Ls});
    }
  `}(He,Ke)),Nt}(Ye,b,A)).join(`
`),re=b.texShape,ie=Qt(),me=function(Ye){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${Ye.texture2D}(textureSampler, uv).r;
    }
  `}(ie),_e,Ue,Be=function(Ye){return`${Ye.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${Ye.varyingFs} vec2 resultUV;
    ${Ye.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${Ye.defineSpecialNaN}
    ${Ye.defineSpecialInf}
    ${Ye.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${At}
    ${qt}
    ${pn}
  `}(ie);return b.isPacked?(_e=function(Ye,He){switch(Ye.length){case 0:return wr();case 1:return function(Ke,Je){let Nt=[Math.ceil(Je[0]/2),Math.ceil(Je[1]/2)];return Nt[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${Nt[1]}.0);
      }
    `:Nt[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${Nt[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${Nt[0]}, ${Nt[1]}));
      return 2 * (resTexRC.x * ${Nt[1]} + resTexRC.y);
    }
  `}(0,He);case 2:return function(Ke,Je){let Nt=[Math.ceil(Je[0]/2),Math.ceil(Je[1]/2)];if(o.Lb.arraysEqual(Ke,Je))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${Nt[0]}, ${Nt[1]}));
      }
    `;let Jt=Math.ceil(Ke[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${Nt[0]}, ${Nt[1]}));

      int index = resTexRC.x * ${Nt[1]} + resTexRC.y;
      int r = 2 * (index / ${Jt});
      int c = imod(index, ${Jt}) * 2;

      return ivec2(r, c);
    }
  `}(Ye,He);case 3:return function(Ke,Je){let Nt=[Math.ceil(Je[0]/2),Math.ceil(Je[1]/2)],Jt=Math.ceil(Ke[2]/2),on=Jt*Math.ceil(Ke[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${Nt[0]}, ${Nt[1]}));
      int index = resTexRC.x * ${Nt[1]} + resTexRC.y;

      int b = index / ${on};
      index -= b * ${on};

      int r = 2 * (index / ${Jt});
      int c = imod(index, ${Jt}) * 2;

      return ivec3(b, r, c);
    }
  `}(Ye,He);default:return function(Ke,Je){let Nt=[Math.ceil(Je[0]/2),Math.ceil(Je[1]/2)],Jt=Math.ceil(Ke[Ke.length-1]/2),on=Jt*Math.ceil(Ke[Ke.length-2]/2),dt=on,Bt="",wt="b, r, c";for(let In=2;In<Ke.length-1;In++)dt*=Ke[Ke.length-In-1],Bt=`
      int b${In} = index / ${dt};
      index -= b${In} * ${dt};
    `+Bt,wt=`b${In}, `+wt;return`
    ivec${Ke.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${Nt[0]}, ${Nt[1]}));
      int index = resTexRC.x * ${Nt[1]} + resTexRC.y;

      ${Bt}

      int b = index / ${on};
      index -= b * ${on};

      int r = 2 * (index / ${Jt});
      int c = imod(index, ${Jt}) * 2;

      return ivec${Ke.length}(${wt});
    }
  `}(Ye,He)}}(b.logicalShape,re),Ue=function(Ye){return`
    void setOutput(vec4 val) {
      ${Ye.output} = val;
    }
  `}(ie)):(_e=function(Ye,He){switch(Ye.length){case 0:return wr();case 1:return function(Ke,Je){return Je[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * ${Je[1]}.0);
      }
    `:Je[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * ${Je[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${Je[0]}, ${Je[1]}));
      return resTexRC.x * ${Je[1]} + resTexRC.y;
    }
  `}(0,He);case 2:return function(Ke,Je){return o.Lb.arraysEqual(Ke,Je)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${Je[0]}, ${Je[1]}));
      }
    `:Ke[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${Je[0]}, ${Je[1]}));
        int index = resTexRC.x * ${Je[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:Ke[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${Je[0]}, ${Je[1]}));
        int index = resTexRC.x * ${Je[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${Je[0]}, ${Je[1]}));
      int index = resTexRC.x * ${Je[1]} + resTexRC.y;
      int r = index / ${Ke[1]};
      int c = index - r * ${Ke[1]};
      return ivec2(r, c);
    }
  `}(Ye,He);case 3:return function(Ke,Je){let Nt=Gn(["r","c","d"],Ke);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${Je[0]}, ${Je[1]}));
      int index = resTexRC.x * ${Je[1]} + resTexRC.y;
      ${Nt}
      return ivec3(r, c, d);
    }
  `}(Ye,He);case 4:return function(Ke,Je){let Nt=Gn(["r","c","d","d2"],Ke);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${Je[0]}, ${Je[1]}));
      int index = resTexRC.x * ${Je[1]} + resTexRC.y;
      ${Nt}
      return ivec4(r, c, d, d2);
    }
  `}(Ye,He);case 5:return function(Ke,Je){let Nt=Gn(["r","c","d","d2","d3"],Ke);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${Je[0]},
                             ${Je[1]}));

      int index = resTexRC.x * ${Je[1]} + resTexRC.y;

      ${Nt}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(Ye,He);case 6:return function(Ke,Je){let Nt=Gn(["r","c","d","d2","d3","d4"],Ke);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${Je[0]}, ${Je[1]}));
      int index = resTexRC.x * ${Je[1]} + resTexRC.y;

      ${Nt}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(Ye,He);default:throw new Error(Ye.length+"-D output sampling is not yet supported")}}(b.logicalShape,re),Ue=function(Ye){return`
    void setOutput(float val) {
      ${Ye.output} = vec4(val, 0, 0, 0);
    }
  `}(ie)),A&&(Be+=Fn),[Be,me,Ue,G,_e,H,k].join(`
`)}function Ge(te){let b=te.shapeInfo.logicalShape;switch(b.length){case 0:return function(k){let A=k.name,j="get"+A.charAt(0).toUpperCase()+A.slice(1);if(k.shapeInfo.isUniform)return`float ${j}() {return ${A};}`;let[G,H]=k.shapeInfo.texShape;if(G===1&&H===1)return`
      float ${j}() {
        return sampleTexture(${A}, halfCR);
      }
    `;let[re,ie]=k.shapeInfo.texShape,me=Kn(A);return`
    float ${j}() {
      vec2 uv = uvFromFlat(${re}, ${ie}, ${me});
      return sampleTexture(${A}, uv);
    }
  `}(te);case 1:return function(k){let A=k.name,j="get"+A.charAt(0).toUpperCase()+A.slice(1);if(k.shapeInfo.isUniform)return`
      float ${j}(int index) {
        ${yn(k)}
      }
    `;let G=k.shapeInfo.texShape,H=G[0],re=G[1];if(re===1&&H===1)return`
      float ${j}(int index) {
        return sampleTexture(${A}, halfCR);
      }
    `;let ie=Kn(A);return re===1?`
      float ${j}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${ie}) + 0.5) / ${H}.0);
        return sampleTexture(${A}, uv);
      }
    `:H===1?`
      float ${j}(int index) {
        vec2 uv = vec2((float(index + ${ie}) + 0.5) / ${re}.0, 0.5);
        return sampleTexture(${A}, uv);
      }
    `:`
    float ${j}(int index) {
      vec2 uv = uvFromFlat(${H}, ${re}, index + ${ie});
      return sampleTexture(${A}, uv);
    }
  `}(te);case 2:return function(k){let A=k.shapeInfo.logicalShape,j=k.name,G="get"+j.charAt(0).toUpperCase()+j.slice(1),H=k.shapeInfo.texShape;if(H!=null&&o.Lb.arraysEqual(A,H)){let Ye=H[0],He=H[1];return`
    float ${G}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${He}.0, ${Ye}.0);
      return sampleTexture(${j}, uv);
    }
  `}let{newShape:re,keptDims:ie}=o.Lb.squeezeShape(A),me=re;if(me.length<A.length){let Ye=Io(k,me),He=["row","col"];return`
      ${Ge(Ye)}
      float ${G}(int row, int col) {
        return ${G}(${Zo(He,ie)});
      }
    `}if(k.shapeInfo.isUniform)return`
      float ${G}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${A[1]}, 1)));
        ${yn(k)}
      }
    `;let _e=H[0],Ue=H[1],Be=Kn(j);return Ue===1?`
    float ${G}(int row, int col) {
      float index = dot(vec3(row, col, ${Be}), vec3(${A[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${_e}.0);
      return sampleTexture(${j}, uv);
    }
  `:_e===1?`
    float ${G}(int row, int col) {
      float index = dot(vec3(row, col, ${Be}), vec3(${A[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${Ue}.0, 0.5);
      return sampleTexture(${j}, uv);
    }
  `:`
  float ${G}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${A[1]} + col + ${Be};
    vec2 uv = uvFromFlat(${_e}, ${Ue}, index);
    return sampleTexture(${j}, uv);
  }
`}(te);case 3:return function(k){let A=k.shapeInfo.logicalShape,j=k.name,G="get"+j.charAt(0).toUpperCase()+j.slice(1),H=A[1]*A[2],re=A[2],{newShape:ie,keptDims:me}=o.Lb.squeezeShape(A),_e=ie;if(_e.length<A.length){let Je=Io(k,_e),Nt=["row","col","depth"];return`
        ${Ge(Je)}
        float ${G}(int row, int col, int depth) {
          return ${G}(${Zo(Nt,me)});
        }
      `}if(k.shapeInfo.isUniform)return`
      float ${G}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${H}, ${re}, 1)));
        ${yn(k)}
      }
    `;let Ue=k.shapeInfo.texShape,Be=Ue[0],Ye=Ue[1],He=k.shapeInfo.flatOffset;if(Ye===H&&He==null)return`
        float ${G}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${re}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${Ye}.0, ${Be}.0);
          return sampleTexture(${j}, uv);
        }
      `;if(Ye===re&&He==null)return`
    float ${G}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${A[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${Ye}.0, ${Be}.0);
      return sampleTexture(${j}, uv);
    }
  `;let Ke=Kn(j);return`
      float ${G}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${H} + col * ${re} + depth + ${Ke};
        vec2 uv = uvFromFlat(${Be}, ${Ye}, index);
        return sampleTexture(${j}, uv);
      }
  `}(te);case 4:return function(k){let A=k.shapeInfo.logicalShape,j=k.name,G="get"+j.charAt(0).toUpperCase()+j.slice(1),H=A[3],re=A[2]*H,ie=A[1]*re,{newShape:me,keptDims:_e}=o.Lb.squeezeShape(A);if(me.length<A.length){let Je=Io(k,me),Nt=["row","col","depth","depth2"];return`
      ${Ge(Je)}
      float ${G}(int row, int col, int depth, int depth2) {
        return ${G}(${Zo(Nt,_e)});
      }
    `}if(k.shapeInfo.isUniform)return`
      float ${G}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${ie}, ${re}, ${H}, 1)));
        ${yn(k)}
      }
    `;let Ue=k.shapeInfo.flatOffset,Be=k.shapeInfo.texShape,Ye=Be[0],He=Be[1];if(He===ie&&Ue==null)return`
      float ${G}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${re}, ${H}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${He}.0, ${Ye}.0);
        return sampleTexture(${j}, uv);
      }
    `;if(He===H&&Ue==null)return`
      float ${G}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${A[1]*A[2]}, ${A[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${He}.0, ${Ye}.0);
        return sampleTexture(${j}, uv);
      }
    `;let Ke=Kn(j);return`
    float ${G}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${ie} + col * ${re} +
          depth * ${H} + depth2;
      vec2 uv = uvFromFlat(${Ye}, ${He}, index + ${Ke});
      return sampleTexture(${j}, uv);
    }
  `}(te);case 5:return function(k){let A=k.shapeInfo.logicalShape,j=k.name,G="get"+j.charAt(0).toUpperCase()+j.slice(1),H=A[4],re=A[3]*H,ie=A[2]*re,me=A[1]*ie,{newShape:_e,keptDims:Ue}=o.Lb.squeezeShape(A);if(_e.length<A.length){let Nt=Io(k,_e),Jt=["row","col","depth","depth2","depth3"];return`
      ${Ge(Nt)}
      float ${G}(int row, int col, int depth, int depth2, int depth3) {
        return ${G}(${Zo(Jt,Ue)});
      }
    `}if(k.shapeInfo.isUniform)return`
      float ${G}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${me}, ${ie}, ${re}, ${H})) +
          depth3;
        ${yn(k)}
      }
    `;let Be=k.shapeInfo.flatOffset,Ye=k.shapeInfo.texShape,He=Ye[0],Ke=Ye[1];if(Ke===me&&Be==null)return`
      float ${G}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${ie}, ${re}, ${H}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${Ke}.0, ${He}.0);
        return sampleTexture(${j}, uv);
      }
    `;if(Ke===H&&Be==null)return`
      float ${G}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${A[1]*A[2]*A[3]},
               ${A[2]*A[3]}, ${A[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${Ke}.0, ${He}.0);
        return sampleTexture(${j}, uv);
      }
    `;let Je=Kn(j);return`
    float ${G}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${me} + col * ${ie} + depth * ${re} +
          depth2 * ${H} + depth3 + ${Je};
      vec2 uv = uvFromFlat(${He}, ${Ke}, index);
      return sampleTexture(${j}, uv);
    }
  `}(te);case 6:return function(k){let A=k.shapeInfo.logicalShape,j=k.name,G="get"+j.charAt(0).toUpperCase()+j.slice(1),{newShape:H,keptDims:re}=o.Lb.squeezeShape(A);if(H.length<A.length){let Jt=Io(k,H),on=["row","col","depth","depth2","depth3","depth4"];return`
      ${Ge(Jt)}
      float ${G}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${G}(${Zo(on,re)});
      }
    `}let ie=A[5],me=A[4]*ie,_e=A[3]*me,Ue=A[2]*_e,Be=A[1]*Ue;if(k.shapeInfo.isUniform)return`
      float ${G}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${Be}, ${Ue}, ${_e}, ${me})) +
          dot(
            vec2(depth3, depth4),
            vec2(${ie}, 1)));
        ${yn(k)}
      }
    `;let Ye=k.shapeInfo.flatOffset,He=k.shapeInfo.texShape,Ke=He[0],Je=He[1];if(Je===Be&&Ye==null)return`
      float ${G}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${Ue}, ${_e}, ${me}, ${ie})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${Je}.0, ${Ke}.0);
        return sampleTexture(${j}, uv);
      }
    `;if(Je===ie&&Ye==null)return`
      float ${G}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${A[1]*A[2]*A[3]*A[4]},
               ${A[2]*A[3]*A[4]},
               ${A[3]*A[4]},
               ${A[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${Je}.0, ${Ke}.0);
        return sampleTexture(${j}, uv);
      }
    `;let Nt=Kn(j);return`
    float ${G}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${Be} + col * ${Ue} + depth * ${_e} +
          depth2 * ${me} + depth3 * ${ie} + depth4 + ${Nt};
      vec2 uv = uvFromFlat(${Ke}, ${Je}, index);
      return sampleTexture(${j}, uv);
    }
  `}(te);default:throw new Error(b.length+"-D input sampling is not yet supported")}}function pt(te){switch(te.shapeInfo.logicalShape.length){case 0:return function(b){let k=b.name,A="get"+k.charAt(0).toUpperCase()+k.slice(1),j=Qt();return`
    vec4 ${A}() {
      return ${j.texture2D}(${k}, halfCR);
    }
  `}(te);case 1:return function(b){let k=b.name,A="get"+k.charAt(0).toUpperCase()+k.slice(1),j=b.shapeInfo.texShape,G=[Math.ceil(j[0]/2),Math.ceil(j[1]/2)],H=Qt();return`
    vec4 ${A}(int index) {
      vec2 uv = packedUVfrom1D(
        ${G[0]}, ${G[1]}, index);
      return ${H.texture2D}(${k}, uv);
    }
  `}(te);case 2:return function(b){let k=b.shapeInfo.logicalShape,A=b.name,j="get"+A.charAt(0).toUpperCase()+A.slice(1),G=b.shapeInfo.texShape,H=G[0],re=G[1],ie=Qt();if(G!=null&&o.Lb.arraysEqual(k,G))return`
      vec4 ${j}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${re}.0, ${H}.0);

        return ${ie.texture2D}(${A}, uv);
      }
    `;let me=[Math.ceil(G[0]/2),Math.ceil(G[1]/2)],_e=Math.ceil(k[1]/2);return`
    vec4 ${j}(int row, int col) {
      vec2 uv = packedUVfrom2D(${_e}, ${me[0]}, ${me[1]}, row, col);
      return ${ie.texture2D}(${A}, uv);
    }
  `}(te);case 3:return function(b){let k=b.shapeInfo.logicalShape,A=b.name,j="get"+A.charAt(0).toUpperCase()+A.slice(1),G=b.shapeInfo.texShape,H=[Math.ceil(G[0]/2),Math.ceil(G[1]/2)];if(k[0]===1){let Be=k.slice(1),Ye=[1,2],He=Io(b,Be),Ke=["b","row","col"];return`
        ${pt(He)}
        vec4 ${j}(int b, int row, int col) {
          return ${j}(${Zo(Ke,Ye)});
        }
      `}let re=H[0],ie=H[1],me=Math.ceil(k[2]/2),_e=me*Math.ceil(k[1]/2),Ue=Qt();return`
    vec4 ${j}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${re}, ${ie}, ${_e}, ${me}, b, row, col);
      return ${Ue.texture2D}(${A}, uv);
    }
  `}(te);default:return function(b){let k=b.shapeInfo.logicalShape,A=k.length,j=b.name,G="get"+j.charAt(0).toUpperCase()+j.slice(1),H=b.shapeInfo.texShape,re=[Math.ceil(H[0]/2),Math.ceil(H[1]/2)],ie=re[0],me=re[1],_e=Math.ceil(k[A-1]/2),Ue=_e*Math.ceil(k[A-2]/2),Be="int b, int row, int col",Ye=`b * ${Ue} + (row / 2) * ${_e} + (col / 2)`;for(let Ke=2;Ke<A-1;Ke++)Be=`int b${Ke}, `+Be,Ue*=k[A-Ke-1],Ye=`b${Ke} * ${Ue} + `+Ye;let He=Qt();return`
    vec4 ${G}(${Be}) {
      int index = ${Ye};
      int texR = index / ${me};
      int texC = index - texR * ${me};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${me}, ${ie});
      return ${He.texture2D}(${j}, uv);
    }
  `}(te)}}let At=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,qt=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,pn=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Fn=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function wr(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Kn(te){return"offset"+te}function yn(te){let b=te.name,k=o.Lb.sizeFromShape(te.shapeInfo.logicalShape);return k<2?`return ${b};`:`
    for (int i = 0; i < ${k}; i++) {
      if (i == index) {
        return ${b}[i];
      }
    }
  `}function Cn(te){if(te<=1)return"int";if(te===2)return"ivec2";if(te===3)return"ivec3";if(te===4)return"ivec4";if(te===5)return"ivec5";if(te===6)return"ivec6";throw Error(`GPU for rank ${te} is not yet supported`)}function Io(te,b){let k=JSON.parse(JSON.stringify(te));return k.shapeInfo.logicalShape=b,k}function Zo(te,b){return b.map(k=>te[k]).join(", ")}class ji{constructor(b,k,A,j){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,o.Lb.assert(b.length>2,()=>`Packed arg${A.charAt(0).toUpperCase()+A.slice(1)} supports only inputs with rank above 2.`);let G=b[b.length-1],H=Math.ceil(G/k);this.outputShape=b.slice(0,-1),H>1&&this.outputShape.push(H),j||this.variableNames.push("bestIndicesA");let re=this.outputShape,ie=re.length,me=Cn(ie),_e=Yt("coords",ie),Ue,Be;if(H===1){Be=ie+1;let Ut=Cn(Be);Ue=`
        ${Ut} sourceLocR = ${Ut}(${_e.join()}, 0);
        ++${_e[ie-1]};
        ${Ut} sourceLocG = ${Ut}(${_e.join()}, 0);
        ++${_e[ie-2]};
        ${Ut} sourceLocA = ${Ut}(${_e.join()}, 0);
        --${_e[ie-1]};
        ${Ut} sourceLocB = ${Ut}(${_e.join()}, 0);
        --${_e[ie-2]};`}else Be=ie,Ue=`
        ${me} sourceLocR = coords;
        ++${_e[ie-1]};
        ${me} sourceLocG = coords;
        ++${_e[ie-2]};
        ${me} sourceLocA = coords;
        --${_e[ie-1]};
        ${me} sourceLocB = coords;
        --${_e[ie-2]};`;let Ye=["x","y","z","w","u","v"].slice(0,Be),He="."+Ye[Be-1],Ke=Ye.map(Ut=>"int "+Ut),Je=Yt("sourceLocR",Be-1).concat("inIdx.r"),Nt=Yt("sourceLocG",Be-1).concat("inIdx.g"),Jt=Yt("sourceLocB",Be-1).concat("inIdx.b"),on=Yt("sourceLocA",Be-1).concat("inIdx.a"),dt=A==="max"?"greaterThan":"lessThan",Bt=j?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${Je.join()}),
                             getBestIndicesAChannel(${Nt.join()}),
                             getBestIndicesAChannel(${Jt.join()}),
                             getBestIndicesAChannel(${on.join()})));`,wt=`vec4(
            getAChannel(${Je.join()}),
            hasNextCol ? getAChannel(${Nt.join()}) : 0.,
            hasNextRow ? getAChannel(${Jt.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${on.join()}) : 0.)`,In=j?"":`
      float getBestIndicesAChannel(${Ke.join()}) {
        return getChannel(getBestIndicesA(${Ye.join()}),
                                          vec2(${Ye.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${Ke.join()}) {
        return getChannel(getA(${Ye.join()}),
                               vec2(${Ye.slice(-2).join()}));
      }
      ${In}
      void main() {
        ${me} coords = getOutputCoords();
        bool hasNextCol = ${_e[ie-1]} < ${re[ie-1]-1};
        bool hasNextRow = ${_e[ie-2]} < ${re[ie-2]-1};
        ${Ue}
        ivec4 srcIdx = ivec4(sourceLocR${He}, sourceLocG${He},
          sourceLocB${He}, sourceLocA${He}) * ${k};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${wt};

        for (int i = 0; i < ${k}; i++) {
          inIdx = srcIdx;
          ${Bt}
          vec4 candidate = ${wt};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${dt}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}class fg{constructor(b){this.variableNames=["dy"],this.outputShape=b.inShape;let k=b.filterHeight,A=b.filterWidth,j=b.strideHeight,G=b.strideWidth,H=b.dilationHeight,re=b.dilationWidth,ie=b.effectiveFilterHeight,me=b.effectiveFilterWidth,_e=ie-1-b.padInfo.top,Ue=me-1-b.padInfo.left,Be=1/(k*A);this.userCode=`
      const ivec2 pads = ivec2(${_e}, ${Ue});
      const float avgMultiplier = float(${Be});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${ie};
            wR += ${H}) {
          float dyR = float(dyRCorner + wR) / ${j}.0;

          if (dyR < 0.0 || dyR >= ${b.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${me};
            wC+= ${re}) {
            float dyC = float(dyCCorner + wC) / ${G}.0;

            if (dyC < 0.0 || dyC >= ${b.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class mg{constructor(b){this.variableNames=["dy"],this.outputShape=b.inShape;let k=b.filterDepth,A=b.filterHeight,j=b.filterWidth,G=b.strideDepth,H=b.strideHeight,re=b.strideWidth,ie=b.dilationDepth,me=b.dilationHeight,_e=b.dilationWidth,Ue=b.effectiveFilterDepth,Be=b.effectiveFilterHeight,Ye=b.effectiveFilterWidth,He=Ue-1-b.padInfo.front,Ke=Be-1-b.padInfo.top,Je=Ye-1-b.padInfo.left,Nt=1/(k*A*j);this.userCode=`
      const ivec3 pads = ivec3(${He}, ${Ke}, ${Je});
      const float avgMultiplier = float(${Nt});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${Ue};
            wD += ${ie}) {
          float dyD = float(dyDCorner + wD) / ${G}.0;

          if (dyD < 0.0 || dyD >= ${b.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${Be};
              wR += ${me}) {
            float dyR = float(dyRCorner + wR) / ${H}.0;

            if (dyR < 0.0 || dyR >= ${b.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${Ye};
                wC += ${_e}) {
              float dyC = float(dyCCorner + wC) / ${re}.0;

              if (dyC < 0.0 || dyC >= ${b.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}let Ui="return (a < 0.) ? b * a : a;";class Ps{constructor(b,k,A){this.variableNames=["A","B"],this.outputShape=o.X.assertAndGetBroadcastShape(k,A),this.userCode=`
      float binaryOperation(float a, float b) {
        ${b}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}let qi=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;class ni{constructor(b,k,A,j=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o.X.assertAndGetBroadcastShape(k,A);let G=this.outputShape.length,H="";if(j)if(G===0||o.Lb.sizeFromShape(this.outputShape)===1)H=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(H=`
          ${Cn(G)} coords = getOutputCoords();
        `,G===1)H+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let re=Yt("coords",G);H+=`
            bool nextRowOutOfBounds =
              (${re[G-2]} + 1) >= ${this.outputShape[G-2]};
            bool nextColOutOfBounds =
              (${re[G-1]} + 1) >= ${this.outputShape[G-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${b}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${H}

        setOutput(result);
      }
    `}}class Aa{constructor(b){this.variableNames=["A"],this.outputShape=b,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}getCustomSetupFunc(b,k){return(A,j)=>{this.minLoc==null&&(this.minLoc=A.getUniformLocationNoThrow(j,"minVal"),this.maxLoc=A.getUniformLocationNoThrow(j,"maxVal")),A.gl.uniform1f(this.minLoc,b),A.gl.uniform1f(this.maxLoc,k)}}}class ms{constructor(b){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}getCustomSetupFunc(b,k){return(A,j)=>{this.minLoc==null&&(this.minLoc=A.getUniformLocationNoThrow(j,"minVal"),this.maxLoc=A.getUniformLocationNoThrow(j,"maxVal")),A.gl.uniform1f(this.minLoc,b),A.gl.uniform1f(this.maxLoc,k)}}}class eh{constructor(b){this.variableNames=["real","imag"],this.outputShape=b,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}class ul{constructor(b){this.variableNames=["x","dy"],this.outputShape=b.filterShape;let k=b.strideHeight,A=b.strideWidth,j=b.padInfo.top,G=b.padInfo.left,H=b.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${b.batchSize}; b++) {
          for (int yR = 0; yR < ${b.outHeight}; yR++) {
            int xR = wR + yR * ${k} - ${j};

            if (xR < 0 || xR >= ${b.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${b.outWidth}; yC++) {
              int xC = wC + yC * ${A} - ${G};

              if (xC < 0 || xC >= ${b.inWidth}) {
                continue;
              }

              if (${H}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class gg{constructor(b){this.variableNames=["dy","W"],this.outputShape=b.inShape;let k=b.filterHeight,A=b.filterWidth,j=b.strideHeight,G=b.strideWidth,H=b.dataFormat==="channelsLast",re=k-1-b.padInfo.top,ie=A-1-b.padInfo.left,me=H?1:2,_e=H?2:3,Ue=H?3:1;this.userCode=`
      const ivec2 pads = ivec2(${re}, ${ie});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${Ue}];

        ivec2 dyCorner = ivec2(coords[${me}], coords[${_e}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${k}; wR++) {
          float dyR = float(dyRCorner + wR) / ${j}.0;

          if (dyR < 0.0 || dyR >= ${b.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${k} - 1 - wR;

          for (int wC = 0; wC < ${A}; wC++) {
            float dyC = float(dyCCorner + wC) / ${G}.0;

            if (dyC < 0.0 || dyC >= ${b.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${A} - 1 - wC;

            for (int d2 = 0; d2 < ${b.outChannels}; d2++) {

              if (${H}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class qr{constructor(b){this.variableNames=["x","dy"],this.outputShape=b.filterShape;let k=b.strideDepth,A=b.strideHeight,j=b.strideWidth,G=b.padInfo.front,H=b.padInfo.top,re=b.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${b.batchSize}; b++) {
          for (int yF = 0; yF < ${b.outDepth}; yF++) {
            int xF = wF + yF * ${k} - ${G};

            if (xF < 0 || xF >= ${b.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${b.outHeight}; yR++) {
              int xR = wR + yR * ${A} - ${H};

              if (xR < 0 || xR >= ${b.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${b.outWidth}; yC++) {
                int xC = wC + yC * ${j} - ${re};

                if (xC < 0 || xC >= ${b.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class jo{constructor(b){this.variableNames=["dy","W"],this.outputShape=b.inShape;let k=b.filterDepth,A=b.filterHeight,j=b.filterWidth,G=b.strideDepth,H=b.strideHeight,re=b.strideWidth,ie=k-1-b.padInfo.front,me=A-1-b.padInfo.top,_e=j-1-b.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${ie}, ${me}, ${_e});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${k}; wF++) {
          float dyF = float(dyFCorner + wF) / ${G}.0;

          if (dyF < 0.0 || dyF >= ${b.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${k} - 1 - wF;

          for (int wR = 0; wR < ${A}; wR++) {
            float dyR = float(dyRCorner + wR) / ${H}.0;

            if (dyR < 0.0 || dyR >= ${b.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${A} - 1 - wR;

            for (int wC = 0; wC < ${j}; wC++) {
              float dyC = float(dyCCorner + wC) / ${re}.0;

              if (dyC < 0.0 || dyC >= ${b.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${j} - 1 - wC;

              for (int d2 = 0; d2 < ${b.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class ua{constructor(b){this.variableNames=["x","dy"],this.outputShape=b.filterShape;let k=b.strideHeight,A=b.strideWidth,j=b.padInfo.top,G=b.padInfo.left,H=b.outChannels/b.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${H} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${b.batchSize}; b++) {
          for (int yR = 0; yR < ${b.outHeight}; yR++) {
            int xR = wR + yR * ${k} - ${j};

            if (xR < 0 || xR >= ${b.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${b.outWidth}; yC++) {
              int xC = wC + yC * ${A} - ${G};

              if (xC < 0 || xC >= ${b.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class lf{constructor(b){this.variableNames=["dy","W"],this.outputShape=b.inShape;let k=b.filterHeight,A=b.filterWidth,j=b.strideHeight,G=b.strideWidth,H=k-1-b.padInfo.top,re=A-1-b.padInfo.left,ie=b.outChannels/b.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${H}, ${re});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${k}; wR++) {
          float dyR = float(dyRCorner + wR) / ${j}.0;

          if (dyR < 0.0 || dyR >= ${b.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${k} - 1 - wR;

          for (int wC = 0; wC < ${A}; wC++) {
            float dyC = float(dyCCorner + wC) / ${G}.0;

            if (dyC < 0.0 || dyC >= ${b.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${A} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${ie}; dm++) {
              int d2 = d1 * ${ie} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class rn{constructor(b,k=!1,A=null,j=!1){this.variableNames=["x","W"],this.outputShape=b.outShape;let G=b.padInfo.top,H=b.padInfo.left,re=b.strideHeight,ie=b.strideWidth,me=b.dilationHeight,_e=b.dilationWidth,Ue=b.filterHeight,Be=b.filterWidth,Ye=4*Math.floor(b.inChannels/4),He=b.inChannels%4,Ke=b.dataFormat==="channelsLast",Je=Ke?1:2,Nt=Ke?2:3,Jt=Ke?3:1,on="",dt="";A&&(on=j?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${A}
        }`:`
          float activation(float x) {
            ${A}
          }
        `,dt="result = activation(result);");let Bt=k?"result += getBiasAtOutCoords();":"";k&&this.variableNames.push("bias"),j&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      ${on}

      const ivec2 strides = ivec2(${re}, ${ie});
      const ivec2 pads = ivec2(${G}, ${H});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${Jt}];

        ivec2 xRCCorner =
            ivec2(coords[${Je}], coords[${Nt}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${Ue}; wR++) {
          int xR = xRCorner + wR * ${me};

          if (xR < 0 || xR >= ${b.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${Be}; wC++) {
            int xC = xCCorner + wC * ${_e};

            if (xC < 0 || xC >= ${b.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${Ye}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${Ke}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${He===1}) {

              if (${Ke}) {
                dotProd +=
                    getX(batch, xR, xC, ${Ye}) *
                    getW(wR, wC, ${Ye}, d2);
              } else {
                dotProd +=
                    getX(batch, ${Ye}, xR, xC) *
                    getW(wR, wC, ${Ye}, d2);
              }

            } else if (${He===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${Ye}, d2),
                getW(wR, wC, ${Ye} + 1, d2)
              );

              if (${Ke}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${Ye}),
                  getX(batch, xR, xC, ${Ye} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${Ye}, xR, xC),
                  getX(batch, ${Ye} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${He===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${Ye}, d2),
                getW(wR, wC, ${Ye} + 1, d2),
                getW(wR, wC, ${Ye} + 2, d2)
              );

              if (${Ke}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${Ye}),
                  getX(batch, xR, xC, ${Ye} + 1),
                  getX(batch, xR, xC, ${Ye} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${Ye}, xR, xC),
                  getX(batch, ${Ye} + 1, xR, xC),
                  getX(batch, ${Ye} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${Bt}
        ${dt}
        setOutput(result);
      }
    `}}class yg{constructor(b){this.variableNames=["x","W"],this.outputShape=b.outShape;let k=b.padInfo.front,A=b.padInfo.top,j=b.padInfo.left,G=b.strideDepth,H=b.strideHeight,re=b.strideWidth,ie=b.dilationDepth,me=b.dilationHeight,_e=b.dilationWidth,Ue=b.filterDepth,Be=b.filterHeight,Ye=b.filterWidth,He=4*Math.floor(b.inChannels/4),Ke=b.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${G}, ${H}, ${re});
      const ivec3 pads = ivec3(${k}, ${A}, ${j});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${Ue}; wF++) {
          int xF = xFCorner + wF * ${ie};

          if (xF < 0 || xF >= ${b.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${Be}; wR++) {
            int xR = xRCorner + wR * ${me};

            if (xR < 0 || xR >= ${b.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${Ye}; wC++) {
              int xC = xCCorner + wC * ${_e};

              if (xC < 0 || xC >= ${b.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${He}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${Ke===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${He}) *
                  getW(wF, wR, wC, ${He}, d2);
              } else if (${Ke===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${He}),
                  getX(batch, xF, xR, xC, ${He} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${He}, d2),
                  getW(wF, wR, wC, ${He} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${Ke===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${He}),
                  getX(batch, xF, xR, xC, ${He} + 1),
                  getX(batch, xF, xR, xC, ${He} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${He}, d2),
                  getW(wF, wR, wC, ${He} + 1, d2),
                  getW(wF, wR, wC, ${He} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Yu{constructor(b,k=!1,A=null,j=!1){this.variableNames=["x","W"],this.outputShape=b.outShape;let G=b.inHeight,H=b.inWidth,re=b.padInfo.top,ie=b.padInfo.left,me=b.strideHeight,_e=b.strideWidth,Ue=b.dilationHeight,Be=b.dilationWidth,Ye=b.filterHeight,He=b.filterWidth,Ke=b.outChannels/b.inChannels,Je="",Nt="";A&&(Je=j?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${A}
        }`:`
          float activation(float x) {
            ${A}
          }
        `,Nt="result = activation(result);");let Jt=k?"result += getBiasAtOutCoords();":"";k&&this.variableNames.push("bias"),j&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      ${Je}

      const ivec2 strides = ivec2(${me}, ${_e});
      const ivec2 pads = ivec2(${re}, ${ie});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${Ke};
        int q = d2 - d1 * ${Ke};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${Ye}; wR++) {
          int xR = xRCorner + wR * ${Ue};

          if (xR < 0 || xR >= ${G}) {
            continue;
          }

          for (int wC = 0; wC < ${He}; wC++) {
            int xC = xCCorner + wC * ${Be};

            if (xC < 0 || xC >= ${H}) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${Jt}
        ${Nt}
        setOutput(result);
      }
    `}}class xg{constructor(b,k=!1,A=null,j=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b.outShape;let G=b.inHeight,H=b.inWidth,re=b.padInfo.top,ie=b.padInfo.left,me=b.strideHeight,_e=b.strideWidth,Ue=b.dilationHeight,Be=b.dilationWidth,Ye=b.filterHeight,He=b.filterWidth,Ke=He,Je="int xR; int xC; int xCOffset;";for(let dt=0;dt<Ye;dt++)for(let Bt=0;Bt<He;Bt++)Je+=`
          vec4 xTexelR${dt}C${2*Bt} = vec4(0.);
          vec4 wR${dt}C${Bt} = vec4(0.);
          vec4 xR${dt}C${Bt} = vec4(0.);`;for(let dt=0;dt<Ye;dt++)for(let Bt=0;Bt<Ke;Bt++){let wt=2*Bt;if(Je+=`
          xR = xRCorner + ${dt*Ue};
          xC = xCCorner + ${wt*Be};
        `,_e===1){if(wt<He&&(Je+=ie%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < ${G} && xCOffset >= 0 && xCOffset < ${H}) {
                  xTexelR${dt}C${wt} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= ${H}) {
                    xTexelR${dt}C${wt}.zw = vec2(0.);
                  }
                } else {
                  xTexelR${dt}C${wt} = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < ${G} && xCOffset >= 0 && xCOffset < ${H}) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= ${H}) {
                    previous.zw = vec2(0.);
                  }

                  xR${dt}C${wt} = vec4(previous.zw, xTexelR${dt}C${wt}.xy);
                } else {
                  xR${dt}C${wt} = vec4(0, 0, xTexelR${dt}C${wt}.xy);
                }
              `:`
                if(xR >= 0 && xR < ${G} && xC >= 0 && xC < ${H}) {
                  xTexelR${dt}C${wt} = getX(batch, xR, xC, d1);
                } else {
                  xTexelR${dt}C${wt} = vec4(0.);
                }

                xR${dt}C${wt} = xTexelR${dt}C${wt};
              `,wt+1<He)){let In=ie%2==0?o.Lb.nearestLargerEven(Be):Be;Be%2==0&&ie%2==1||Be%2!=0&&ie%2!=1?(Je+=`
                  xCOffset = xC + ${ie%2} + ${In};

                  if(xR >= 0 && xR < ${G} &&
                    xCOffset >= 0 && xCOffset < ${H}) {
                    xTexelR${dt}C${wt+2} = getX(batch, xR, xCOffset, d1);
                  }
                `,Be>1&&(Je+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < ${G} &&
                      xCOffset >= 0 && xCOffset < ${H}) {
                      xTexelR${dt}C${wt} = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR${dt}C${wt} = vec4(0.);
                    }
                  `),Je+=`
                  xR${dt}C${wt+1} = vec4(
                    xTexelR${dt}C${wt}.zw, xTexelR${dt}C${wt+2}.xy);
                `):Je+=`
                  xCOffset = xC + ${In};

                  if(xR >= 0 && xR < ${G} &&
                    xCOffset >= 0 && xCOffset < ${H}) {
                    xTexelR${dt}C${wt+2} = getX(batch, xR, xCOffset, d1);
                  }

                  xR${dt}C${wt+1} = xTexelR${dt}C${wt+2};
                `}}else wt<He&&(Je+=`
              if(xR >= 0 && xR < ${G}) {
            `,ie%2==1?(Je+=`
                xCOffset = xC + 1 - ${_e};
                if(xCOffset >= 0 && xCOffset < ${H}) {
                  xTexelR${dt}C${wt} = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR${dt}C${wt} = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < ${H}) {
                  xTexelR${dt}C${wt+2} = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR${dt}C${wt+2} = vec4(0.);
                }

                xR${dt}C${wt} = vec4(
                  xTexelR${dt}C${wt}.zw, xTexelR${dt}C${wt+2}.zw);
              `,wt+1<He&&(Je+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + ${_e};
                  if(xCOffset >= 0 && xCOffset < ${H}) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR${dt}C${wt+1} = vec4(xTexelR${dt}C${wt+2}.xy, final.xy);
                `)):(Je+=`
                if(xC >= 0 && xC < ${H}) {
                  xTexelR${dt}C${wt} = getX(batch, xR, xC, d1);
                } else {
                  xTexelR${dt}C${wt} = vec4(0.);
                }

                xCOffset = xC + ${_e};
                if(xCOffset >= 0 && xCOffset < ${H}) {
                  xTexelR${dt}C${wt+2} = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR${dt}C${wt+2} = vec4(0.);
                }

                xR${dt}C${wt} = vec4(
                  xTexelR${dt}C${wt}.xy, xTexelR${dt}C${wt+2}.xy);
              `,wt+1<He&&(Je+=`
                  xR${dt}C${wt+1} = vec4(
                    xTexelR${dt}C${wt}.zw, xTexelR${dt}C${wt+2}.zw);
                `)),Je+="}");wt<He&&(Je+=`
            vec4 wTexelR${dt}C${wt} = getW(${dt}, ${wt}, d1, q);
            wR${dt}C${wt} = vec4(wTexelR${dt}C${wt}.xz, wTexelR${dt}C${wt}.xz);
          `,wt+1<He&&(Je+=`
              vec4 wTexelR${dt}C${wt+1} = getW(${dt}, ${wt+1}, d1, q);
              wR${dt}C${wt+1} =
                vec4(wTexelR${dt}C${wt+1}.xz, wTexelR${dt}C${wt+1}.xz);`))}for(let dt=0;dt<Ye;dt++)for(let Bt=0;Bt<He;Bt++)Je+=`dotProd += xR${dt}C${Bt} * wR${dt}C${Bt};`;let Nt="",Jt="";A&&(Nt=j?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${A}
        }`:`vec4 activation(vec4 x) {
          ${A}
        }`,Jt="result = activation(result);");let on=k?"result += getBiasAtOutCoords();":"";k&&this.variableNames.push("bias"),j&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      ${Nt}

      const ivec2 strides = ivec2(${me}, ${_e});
      const ivec2 pads = ivec2(${re}, ${ie});

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        ${Je}

        vec4 result = dotProd;
        ${on}
        ${Jt}
        setOutput(result);
      }
    `}}class ca{constructor(b,k,A,j,G){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[H,re,ie,me]=b,[_e]=k,[Ue,Be]=A;this.outputShape=[_e,Ue,Be,me];let Ye=j==="bilinear"?1:0,[He,Ke]=[re-1+".0",ie-1+".0"],[Je,Nt,Jt]=Ue>1?[""+(re-1)/(Ue-1),"(y2-y1) * height_ratio",`y1*${He} + float(y)*(height_scale)`]:["0.0","0.0","0.5 * (y1+y2) * "+He],[on,dt,Bt]=Be>1?[""+(ie-1)/(Be-1),"(x2-x1) * width_ratio",`x1*${Ke} + float(x)*(width_scale)`]:["0.0","0.0","0.5 * (x1+x2) * "+Ke];this.userCode=`
      const float height_ratio = float(${Je});
      const float width_ratio = float(${on});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${H}) {
          return;
        }

        float height_scale = ${Nt};
        float width_scale = ${dt};

        float in_y = ${Jt};
        if( in_y < 0.0 || in_y > ${He} ) {
          setOutput(float(${G}));
          return;
        }
        float in_x = ${Bt};
        if( in_x < 0.0 || in_x > ${Ke} ) {
          setOutput(float(${G}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${Ye} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}class rp{constructor(b,k,A){this.variableNames=["x"],this.outputShape=b;let j=b.length,G=k?"0.0":`getX(${Qu(j,"coords")})`,H=b[b.length-1],re="",ie="";k?(re=A?"end != "+(H-1):"end != 0",ie=A?"end + 1":"end - 1"):(re=A?"end + pow2 < "+H:"end >= pow2",ie=A?"end + pow2":"end - pow2"),this.userCode=`
      uniform float index;
      void main() {
        ${Cn(j)} coords = getOutputCoords();
        int end = ${ri(j,"coords")};
        float val = ${G};
        int pow2 = int(pow(2.0, index));
        if (${re}) {
          int idx = ${ie};
          ${ri(j,"coords")} = idx;
          val += getX(${Qu(j,"coords")});
        }
        setOutput(val);
      }
    `}getCustomSetupFunc(b){return(k,A)=>{this.index==null&&(this.index=k.getUniformLocation(A,"index")),k.gl.uniform1f(this.index,b)}}}function Qu(te,b){if(te===1)return""+b;if(te===2)return`${b}.x, ${b}.y`;if(te===3)return`${b}.x, ${b}.y, ${b}.z`;if(te===4)return`${b}.x, ${b}.y, ${b}.z, ${b}.w`;throw Error(`Cumulative sum for rank ${te} is not yet supported`)}function ri(te,b){if(te===1)return""+b;if(te===2)return b+".y";if(te===3)return b+".z";if(te===4)return b+".w";throw Error(`Cumulative sum for rank ${te} is not yet supported`)}class Cc{constructor(b){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=u.DENSE;let k=g(b),A=Qt();this.outputShape=b,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${Gn(["r","c","d"],b)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${k[0]}, ${k[1]}));
        int index = 4 * (resTexRC.x * ${k[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${A.output} = result;
      }
    `}}class Oa{constructor(b){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=u.DENSE;let k=g(b),A=Qt();this.outputShape=b,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${Gn(["r","c","d"],b)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${k[0]}, ${k[1]}));
        int index = 4 * (resTexRC.x * ${k[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${A.output} = result;
      }
    `}}class Cs{constructor(b,k,A){this.variableNames=["x"],this.outputShape=[],this.outputShape=b,this.blockSize=k,this.dataFormat=A,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${k};
      int offset_h = imod(h, ${k});
      int in_w = w / ${k};
      int offset_w = imod(w, ${k});
      int offset_d = (offset_h * ${k} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}class yr{constructor(b){this.variableNames=["X"],this.outputShape=[b,b],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}class ho{constructor(b){this.variableNames=["A"],this.outTexUsage=c.DOWNLOAD;let k=Qt();this.outputShape=b,this.userCode=`
      ${ar}

      void main() {
        float x = getAAtOutCoords();
        ${k.output} = encode_float(x);
      }
    `}}class pf{constructor(b){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=c.DOWNLOAD;let k=Qt();this.outputShape=b,this.userCode=`
      ${ar}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${k.output} = encode_float(x);
      }
    `}}class Is{constructor(b,k,A=!1){this.variableNames=["A"];let j=Qt(),[G,H]=k;this.outputShape=b;let re="result";A&&(re="floor(result * 255. + 0.5)"),this.userCode=`
      ${Un(b)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / ${H};
        int c = imod(flatIndex, ${H});
        vec2 uv = (vec2(c, r) + halfCR) / vec2(${H}.0, ${G}.0);
        vec4 values = ${j.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${j.output} = vec4(${re}, 0., 0., 0.);
      }
    `}}class Gr{constructor(b,k,A=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let j=Qt(),[G,H]=k;this.outputShape=b;let re="",ie="result";A&&(ie="floor(result * 255. + 0.5)");for(let me=0;me<=1;me++)for(let _e=0;_e<=1;_e++){let Ue=2*me+_e;re+=`
          localCoords = coords;
          if(localCoords[2] + ${_e} < ${b[2]}) {
            localCoords[2] += ${_e};
            if(localCoords[1] + ${me} < ${b[1]}) {
              localCoords[1] += ${me};

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / ${H};
              c = imod(flatIndex, ${H});
              uv = (vec2(c, r) + halfCR) / vec2(${H}.0, ${G}.0);
              values = ${j.texture2D}(A, uv);

              if(offset == 0) {
                result[${Ue}] = values[0];
              } else if(offset == 1) {
                result[${Ue}] = values[1];
              } else if(offset == 2) {
                result[${Ue}] = values[2];
              } else {
                result[${Ue}] = values[3];
              }
            }
          }
        `}this.userCode=`
      ${Un(b)}

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        ${re}

        ${j.output} = ${ie};
      }
    `}}class th{constructor(b,k){this.outputShape=[],this.variableNames=["x"],this.outputShape=b,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}getCustomSetupFunc(b){return(k,A)=>{this.valueLoc==null&&(this.valueLoc=k.getUniformLocationNoThrow(A,"value")),k.gl.uniform1f(this.valueLoc,b)}}}class xr{constructor(b,k,A){this.variableNames=["A","indices"];let j=b.slice();j[A]=k,this.outputShape=j,this.rank=j.length;let G=Cn(this.rank),H=function(re,ie){let me=re.length;if(me>4)throw Error(`Gather for rank ${me} is not yet supported`);if(me===1)return"int(getIndices(resRC))";let _e=["resRC.x","resRC.y","resRC.z","resRC.w"],Ue=[];for(let Be=0;Be<re.length;Be++)Be===ie?Ue.push(`int(getIndices(${_e[Be]}))`):Ue.push(""+_e[Be]);return Ue.join()}(b,A);this.userCode=`
      void main() {
        ${G} resRC = getOutputCoords();
        setOutput(getA(${H}));
      }
    `}}class Gi{constructor(b,k,A){this.sliceDim=b,this.strides=k,this.variableNames=["x","indices"],this.outputShape=A;let j=Cn(k.length),G=Cn(A.length),H=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        ${j} strides = ${j}(${this.strides});
         void main() {
          ${G} coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < ${this.sliceDim}; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * ${H};
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}function op(te){let b=Qt();return function(k,A){let j=U(k,()=>k.createShader(k.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(m(k,()=>k.shaderSource(j,A)),m(k,()=>k.compileShader(j)),k.getShaderParameter(j,k.COMPILE_STATUS)===!1)throw console.log(k.getShaderInfoLog(j)),new Error("Failed to compile vertex shader.");return j}(te,`${b.version}
    precision highp float;
    ${b.attribute} vec3 clipSpacePos;
    ${b.attribute} vec2 uv;
    ${b.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function hf(te){return function(b,k){let A=U(b,()=>b.createBuffer(),"Unable to create WebGLBuffer");return m(b,()=>b.bindBuffer(b.ARRAY_BUFFER,A)),m(b,()=>b.bufferData(b.ARRAY_BUFFER,k,b.STATIC_DRAW)),A}(te,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function _s(te){return function(b,k){let A=U(b,()=>b.createBuffer(),"Unable to create WebGLBuffer");return m(b,()=>b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,A)),m(b,()=>b.bufferData(b.ELEMENT_ARRAY_BUFFER,k,b.STATIC_DRAW)),A}(te,new Uint16Array([0,1,2,2,1,3]))}function oo(te,b,k,A,j,G){(function(ie,me){let _e=Object(o.jb)().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(ie<=0||me<=0)throw new Error(`Requested texture size [${ie}x${me}] is invalid.`);if(ie>_e||me>_e)throw new Error(`Requested texture size [${ie}x${me}] greater than WebGL maximum on this browser / GPU [${_e}x${_e}].`)})(b,k);let H=function(ie){return U(ie,()=>ie.createTexture(),"Unable to create WebGLTexture.")}(te),re=te.TEXTURE_2D;return m(te,()=>te.bindTexture(re,H)),m(te,()=>te.texParameteri(re,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE)),m(te,()=>te.texParameteri(re,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE)),m(te,()=>te.texParameteri(re,te.TEXTURE_MIN_FILTER,te.NEAREST)),m(te,()=>te.texParameteri(re,te.TEXTURE_MAG_FILTER,te.NEAREST)),m(te,()=>te.texImage2D(re,0,A,b,k,0,j,G,null)),m(te,()=>te.bindTexture(te.TEXTURE_2D,null)),H}function Jr(te){return te.internalFormatFloat}function _o(te){return te.internalFormatHalfFloat}function bg(te){return te.downloadTextureFormat}function sp(te){return te.internalFormatPackedFloat}function Uo(te){return te.internalFormatPackedHalfFloat}function gy(te,b,k,A,j,G,H,re){let ie=te,me=new Float32Array(function(_e,Ue){let[Be,Ye]=d(_e,Ue);return Be*Ye*4}(G,H));return ie.bindBuffer(ie.PIXEL_PACK_BUFFER,b),ie.getBufferSubData(ie.PIXEL_PACK_BUFFER,0,me),ie.bindBuffer(ie.PIXEL_PACK_BUFFER,null),me}class vg{constructor(b){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];let k=Object(o.jb)().getNumber("WEBGL_VERSION");b!=null?(this.gl=b,function(j,G){s[j]=G}(k,b)):this.gl=a(k);let A="WEBGL_color_buffer_float";if(Object(o.jb)().getNumber("WEBGL_VERSION")===1){let j="OES_texture_float",G="OES_texture_half_float";if(this.textureFloatExtension=v(this.gl,j),he(this.gl,G))this.textureHalfFloatExtension=v(this.gl,G);else if(Object(o.jb)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(A),he(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=v(this.gl,"EXT_color_buffer_half_float");else if(Object(o.jb)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(A="EXT_color_buffer_float",he(this.gl,A))this.colorBufferFloatExtension=this.gl.getExtension(A);else{if(!he(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=hf(this.gl),this.indexBuffer=_s(this.gl),this.framebuffer=function(j){return U(j,()=>j.createFramebuffer(),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=p(this.gl,this.textureHalfFloatExtension)}get debug(){return Object(o.jb)().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let b=this.gl;m(b,()=>b.finish()),m(b,()=>b.bindFramebuffer(b.FRAMEBUFFER,null)),m(b,()=>b.deleteFramebuffer(this.framebuffer)),m(b,()=>b.bindBuffer(b.ARRAY_BUFFER,null)),m(b,()=>b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)),m(b,()=>b.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(b,k){return this.throwIfDisposed(),function(A,j,G,H){let[re,ie]=f(j,G);return oo(A,re,ie,Jr(H),H.textureFormatFloat,A.FLOAT)}(this.gl,b,k,this.textureConfig)}createFloat16MatrixTexture(b,k){return this.throwIfDisposed(),function(A,j,G,H){let[re,ie]=f(j,G);return oo(A,re,ie,_o(H),H.textureFormatFloat,H.textureTypeHalfFloat)}(this.gl,b,k,this.textureConfig)}createUnsignedBytesMatrixTexture(b,k){return this.throwIfDisposed(),function(A,j,G,H){let[re,ie]=f(j,G);return oo(A,re,ie,bg(H),A.RGBA,A.UNSIGNED_BYTE)}(this.gl,b,k,this.textureConfig)}uploadPixelDataToTexture(b,k){this.throwIfDisposed(),function(A,j,G){m(A,()=>A.bindTexture(A.TEXTURE_2D,j)),G.data instanceof Uint8Array?m(A,()=>A.texImage2D(A.TEXTURE_2D,0,A.RGBA,G.width,G.height,0,A.RGBA,A.UNSIGNED_BYTE,G.data)):m(A,()=>A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,G)),m(A,()=>A.bindTexture(A.TEXTURE_2D,null))}(this.gl,b,k)}uploadDenseMatrixToTexture(b,k,A,j){this.throwIfDisposed(),function(G,H,re,ie,me,_e){let Ue,Be,Ye;m(G,()=>G.bindTexture(G.TEXTURE_2D,H)),me instanceof Uint8Array?(Ue=new Uint8Array(re*ie*4),Be=G.UNSIGNED_BYTE,Ye=G.RGBA):(Ue=new Float32Array(re*ie*4),Be=G.FLOAT,Ye=_e.internalFormatPackedFloat),Ue.set(me),m(G,()=>G.texImage2D(G.TEXTURE_2D,0,Ye,re,ie,0,G.RGBA,Be,Ue)),m(G,()=>G.bindTexture(G.TEXTURE_2D,null))}(this.gl,b,k,A,j,this.textureConfig)}createFloat16PackedMatrixTexture(b,k){return this.throwIfDisposed(),function(A,j,G,H){let[re,ie]=d(j,G);return oo(A,re,ie,Uo(H),A.RGBA,H.textureTypeHalfFloat)}(this.gl,b,k,this.textureConfig)}createPackedMatrixTexture(b,k){return this.throwIfDisposed(),function(A,j,G,H){let[re,ie]=d(j,G);return oo(A,re,ie,sp(H),A.RGBA,A.FLOAT)}(this.gl,b,k,this.textureConfig)}deleteMatrixTexture(b){this.throwIfDisposed(),this.outputTexture===b&&(L(this.gl,this.framebuffer),this.outputTexture=null),m(this.gl,()=>this.gl.deleteTexture(b))}downloadByteEncodedFloatMatrixFromOutputTexture(b,k,A){return this.downloadMatrixDriver(b,()=>function(j,G,H,re){let[ie,me]=f(G,H),_e=new Uint8Array(G*H*4);return m(j,()=>j.readPixels(0,0,ie,me,re.downloadTextureFormat,j.UNSIGNED_BYTE,_e)),new Float32Array(_e.buffer)}(this.gl,k,A,this.textureConfig))}downloadPackedMatrixFromBuffer(b,k,A,j,G,H){return gy(this.gl,b,0,0,0,G,H,this.textureConfig)}downloadFloat32MatrixFromBuffer(b,k){return function(A,j,G){let H=A,re=new Float32Array(G);return H.bindBuffer(H.PIXEL_PACK_BUFFER,j),H.getBufferSubData(H.PIXEL_PACK_BUFFER,0,re),H.bindBuffer(H.PIXEL_PACK_BUFFER,null),re}(this.gl,b,k)}createBufferFromTexture(b,k,A){this.bindTextureToFrameBuffer(b);let j=function(G,H,re,ie){let me=G.createBuffer();m(G,()=>G.bindBuffer(G.PIXEL_PACK_BUFFER,me));let _e=16*H*re;return m(G,()=>G.bufferData(G.PIXEL_PACK_BUFFER,_e,G.STREAM_READ)),m(G,()=>G.readPixels(0,0,re,H,G.RGBA,G.FLOAT,0)),m(G,()=>G.bindBuffer(G.PIXEL_PACK_BUFFER,null)),me}(this.gl,k,A,this.textureConfig);return this.unbindTextureToFrameBuffer(),j}createAndWaitForFence(){let b=this.createFence(this.gl);return this.pollFence(b)}createFence(b){let k,A;if(Object(o.jb)().getBool("WEBGL_FENCE_API_ENABLED")){let j=b,G=j.fenceSync(j.SYNC_GPU_COMMANDS_COMPLETE,0);b.flush(),A=()=>{let H=j.clientWaitSync(G,0,0);return H===j.ALREADY_SIGNALED||H===j.CONDITION_SATISFIED},k=G}else Object(o.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(k=this.beginQuery(),this.endQuery(),A=()=>this.isQueryAvailable(k,Object(o.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):A=()=>!0;return{query:k,isFencePassed:A}}downloadMatrixFromPackedTexture(b,k,A){return this.downloadMatrixDriver(b,()=>function(j,G,H){let re=new Float32Array(G*H*4);return m(j,()=>j.readPixels(0,0,H,G,j.RGBA,j.FLOAT,re)),re}(this.gl,k,A))}createProgram(b){this.throwIfDisposed();let k=this.gl,A=N(k,b),j=op(k),G=function(H){return U(H,()=>H.createProgram(),"Unable to create WebGLProgram.")}(k);return m(k,()=>k.attachShader(G,j)),m(k,()=>k.attachShader(G,A)),function(H,re){if(m(H,()=>H.linkProgram(re)),H.getProgramParameter(re,H.LINK_STATUS)===!1)throw console.log(H.getProgramInfoLog(re)),new Error("Failed to link vertex and fragment shaders.")}(k,G),this.debug&&O(k,G),this.vertexAttrsAreBound||(this.setProgram(G),this.vertexAttrsAreBound=function(H,re,ie){return m(H,()=>H.bindBuffer(H.ARRAY_BUFFER,ie)),S(H,re,"clipSpacePos",ie,3,20,0)&&S(H,re,"uv",ie,2,20,12)}(k,this.program,this.vertexBuffer)),G}deleteProgram(b){this.throwIfDisposed(),b===this.program&&(this.program=null),b!=null&&m(this.gl,()=>this.gl.deleteProgram(b))}setProgram(b){this.throwIfDisposed(),this.program=b,this.program!=null&&this.debug&&O(this.gl,this.program),m(this.gl,()=>this.gl.useProgram(b))}getUniformLocation(b,k,A=!0){return this.throwIfDisposed(),A?function(j,G,H){return U(j,()=>j.getUniformLocation(G,H),'uniform "'+H+'" not present in program.')}(this.gl,b,k):function(j,G,H){return j.getUniformLocation(G,H)}(this.gl,b,k)}getAttributeLocation(b,k){return this.throwIfDisposed(),m(this.gl,()=>this.gl.getAttribLocation(b,k))}getUniformLocationNoThrow(b,k){return this.throwIfDisposed(),this.gl.getUniformLocation(b,k)}setInputMatrixTexture(b,k,A){this.throwIfDisposed(),this.throwIfNoProgram(),F(this.gl,b,k,A)}setOutputMatrixTexture(b,k,A){this.setOutputMatrixTextureDriver(b,A,k)}setOutputPackedMatrixTexture(b,k,A){this.throwIfDisposed();let[j,G]=d(k,A);this.setOutputMatrixTextureDriver(b,j,G)}setOutputMatrixWriteRegion(b,k,A,j){this.setOutputMatrixWriteRegionDriver(A,b,j,k)}setOutputPackedMatrixWriteRegion(b,k,A,j){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&O(this.gl,this.program),q(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let b=this.gl;this.debug&&this.debugValidate(),m(b,()=>b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),m(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=v(this.gl,Object(o.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Object(o.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let A=this.gl,j=this.getQueryTimerExtensionWebGL2(),G=A.createQuery();return A.beginQuery(j.TIME_ELAPSED_EXT,G),G}let b=this.getQueryTimerExtensionWebGL1(),k=b.createQueryEXT();return b.beginQueryEXT(b.TIME_ELAPSED_EXT,k),k}endQuery(){if(Object(o.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let k=this.gl,A=this.getQueryTimerExtensionWebGL2();return void k.endQuery(A.TIME_ELAPSED_EXT)}let b=this.getQueryTimerExtensionWebGL1();b.endQueryEXT(b.TIME_ELAPSED_EXT)}waitForQueryAndGetTime(b){return Te(this,null,function*(){return yield o.Lb.repeatedTry(()=>this.disposed||this.isQueryAvailable(b,Object(o.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(b,Object(o.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})}getQueryTime(b,k){if(k===0)return null;if(k===2){let A=this.gl;return A.getQueryParameter(b,A.QUERY_RESULT)/1e6}{let A=this.getQueryTimerExtensionWebGL1();return A.getQueryObjectEXT(b,A.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(b,k){if(k===0)return!0;if(k===2){let A=this.gl,j=this.getQueryTimerExtensionWebGL2(),G=A.getQueryParameter(b,A.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(j.GPU_DISJOINT_EXT)),G&&!this.disjoint}{let A=this.getQueryTimerExtensionWebGL1(),j=A.getQueryObjectEXT(b,A.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(A.GPU_DISJOINT_EXT)),j&&!this.disjoint}}pollFence(b){return new Promise(k=>{this.addItemToPoll(()=>b.isFencePassed(),()=>k())})}pollItems(){let b=function(k){let A=0;for(;A<k.length&&k[A]();++A);return A-1}(this.itemsToPoll.map(k=>k.isDoneFn));for(let k=0;k<=b;++k){let{resolveFn:A}=this.itemsToPoll[k];A()}this.itemsToPoll=this.itemsToPoll.slice(b+1)}addItemToPoll(b,k){this.itemsToPoll.push({isDoneFn:b,resolveFn:k}),this.itemsToPoll.length>1||o.Lb.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0))}bindTextureToFrameBuffer(b){this.throwIfDisposed(),R(this.gl,b,this.framebuffer),this.debug&&q(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(R(this.gl,this.outputTexture,this.framebuffer),this.debug&&q(this.gl)):L(this.gl,this.framebuffer)}downloadMatrixDriver(b,k){this.bindTextureToFrameBuffer(b);let A=k();return this.unbindTextureToFrameBuffer(),A}setOutputMatrixTextureDriver(b,k,A){this.throwIfDisposed();let j=this.gl;R(j,b,this.framebuffer),this.debug&&q(j),this.outputTexture=b,m(j,()=>j.viewport(0,0,k,A)),m(j,()=>j.scissor(0,0,k,A))}setOutputMatrixWriteRegionDriver(b,k,A,j){this.throwIfDisposed(),m(this.gl,()=>this.gl.scissor(b,k,A,j))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function nh(te,b){if(te.length!==b.length)throw Error(`Binary was compiled with ${te.length} inputs, but was executed with ${b.length} inputs`);te.forEach((k,A)=>{let j=k.logicalShape,G=b[A],H=G.shape;if(!o.Lb.arraysEqual(j,H))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${j} and ${H} must match`);if(k.isUniform&&G.isUniform)return;let re=k.texShape,ie=G.isUniform?null:G.texData.texShape;if(!o.Lb.arraysEqual(re,ie))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${re} and ${ie} must match`)})}class rh{constructor(b,k,A){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b;let{filterWidth:j,inChannels:G,strideWidth:H,strideHeight:re,padInfo:ie,outWidth:me,dilationWidth:_e,dilationHeight:Ue,dataFormat:Be}=A,{left:Ye,top:He}=ie,Ke=G*j,Je=Qt(),Nt=Be==="channelsLast",Jt=Nt?0:1,on=Nt?1:2,dt="";for(let Bt=0;Bt<=1;Bt++)for(let wt=0;wt<=1;wt++)dt+=`
          blockIndex = rc.y + ${wt};
          pos = rc.x + ${Bt};

          if(blockIndex < ${b[1]} && pos < ${b[0]}) {
            offsetY = int(blockIndex / (${me})) * ${re} - ${He};
            d0 = offsetY + ${Ue} * (pos / ${Ke});

            if(d0 < ${k[Jt]} && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), ${me}.) * ${H}. - ${Ye}.);
              d1 = offsetX + ${_e} * (int(mod(float(pos), ${Ke}.) / ${G}.));

              if(d1 < ${k[on]} && d1 >= 0) {

                ch = int(mod(float(pos), ${G}.));

                if (${Nt}) {
                  innerDims = vec2(d1, ch);
                  result[${2*Bt+wt}] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${2*Bt+wt}] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${dt}

        ${Je.output} = result;
      }
    `}}class Wx{constructor(b,k,A,j,G){this.variableNames=["x"],this.outputShape=[];let H=k,re=b[3]-1,ie;this.outputShape=b;let me=`float(${A}) + float(${j}) * sum`;ie=G===.5?`inversesqrt(${me})`:G===1?`1.0/(${me})`:`exp(log(${me}) * float(-${G}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${H}; j <= ${H}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${re}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${ie};
        setOutput(val);
      }
    `}}class df{constructor(b,k,A,j,G){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=b,this.depth=b[3],this.depthRadius=k,this.bias=A,this.alpha=j,this.beta=G,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${k})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${k} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${j}) * norm + float(${A});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${j})
                * float(${G})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${G});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}class Hx{constructor(b,k,A,j,G){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let H=k,re=b[3]-1,ie;this.outputShape=b;let me=`float(${A}) + float(${j}) * sum`;ie=G===.5?`inversesqrt(${me})`:G===1?`1.0/(${me})`:`exp(log(${me}) * float(-${G}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${H};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${H}; j <= ${H}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${re}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${ie};
        setOutput(result);
      }
    `}}class Zu{constructor(b){this.variableNames=["dy","maxPos"],this.outputShape=b.inShape;let k=b.strideHeight,A=b.strideWidth,j=b.dilationHeight,G=b.effectiveFilterHeight,H=b.effectiveFilterWidth,re=G-1-b.padInfo.top,ie=H-1-b.padInfo.left,me=G*H-1;this.userCode=`
      const ivec2 pads = ivec2(${re}, ${ie});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${G};
          wR += ${j}) {
          float dyR = float(dyRCorner + wR) / ${k}.0;

          if (dyR < 0.0 || dyR >= ${b.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${H}; wC++) {
            float dyC = float(dyCCorner + wC) / ${A}.0;

            if (dyC < 0.0 || dyC >= ${b.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${me} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${H} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Ic{constructor(b){this.variableNames=["dy","maxPos"],this.outputShape=b.inShape;let k=b.strideDepth,A=b.strideHeight,j=b.strideWidth,G=b.dilationDepth,H=b.dilationHeight,re=b.dilationWidth,ie=b.effectiveFilterDepth,me=b.effectiveFilterHeight,_e=b.effectiveFilterWidth,Ue=ie-1-b.padInfo.front,Be=me-1-b.padInfo.top,Ye=_e-1-b.padInfo.left,He=ie*me*_e-1;this.userCode=`
      const ivec3 pads = ivec3(${Ue}, ${Be}, ${Ye});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${ie};
           wD += ${G}) {
          float dyD = float(dyDCorner + wD) / ${k}.0;

          if (dyD < 0.0 || dyD >= ${b.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${me};
              wR += ${H}) {
            float dyR = float(dyRCorner + wR) / ${A}.0;

            if (dyR < 0.0 || dyR >= ${b.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${_e};
                wC += ${re}) {
              float dyC = float(dyCCorner + wC) / ${j}.0;

              if (dyC < 0.0 || dyC >= ${b.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${He} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${me} * ${_e} +
                  wR * ${_e} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class tu{constructor(b,k,A,j=!1,G=!1,H=!1,re=null,ie=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=A;let me=j?b[1]:b[2],_e=Math.ceil(me/2),Ue=j?"i * 2, rc.y":"rc.y, i * 2",Be=G?"rc.z, i * 2":"i * 2, rc.z",Ye=j?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],He=G?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],Ke="",Je="";re&&(Ke=ie?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${re}
        }`:`vec4 activation(vec4 x) {
          ${re}
        }`,Je="result = activation(result);");let Nt=H?"result += getBiasAtOutCoords();":"";H&&this.variableNames.push("bias"),ie&&this.variableNames.push("preluActivationWeights");let Jt="rc.x",on="rc.x";b[0]<k[0]?Jt=`int(min(float(rc.x), ${b[0]-1}.))`:k[0]<b[0]&&(on=`int(min(float(rc.x), ${k[0]-1}.))`),this.userCode=`
      ${Ke}

      const float sharedDimension = ${_e}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${_e}; i++) {
          int batchA = ${Jt};
          int batchB = ${on};
          vec4 a = getMatrixA(batchA, ${Ue});
          vec4 b = getMatrixB(batchB, ${Be});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${Ye[0]} * ${He[0]});
          result += (${Ye[1]} * ${He[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${Nt}

        ${Je}

        setOutput(result);
      }
    `}}class yy{constructor(b,k,A){this.variableNames=["probs"],this.outputShape=[b,A],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${k-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${k-1}));
      }
    `}getCustomSetupFunc(b){return(k,A)=>{this.seedLoc==null&&(this.seedLoc=k.getUniformLocation(A,"seed")),k.gl.uniform1f(this.seedLoc,b)}}}class Du{constructor(b,k,A,j){this.variableNames=["indices"],this.outputShape=[b,k],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${j}), float(${A}),
                      float(index == coords.y)));
      }
    `}}class Kx{constructor(b){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=b;let k=b.length;if(k===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let A=Yt("rc",k),j=Cn(k),G=function(ie,me,_e){if(ie===1)return"rc > "+me[0];let Ue="";for(let Be=ie-2;Be<ie;Be++)Ue+=`${_e[Be]} >= ${me[Be]}`,Be<ie-1&&(Ue+="||");return Ue}(k,b,A),H=function(ie,me,_e,Ue){if(ie===1)return"";let Be=Ue.slice(-2);return`
    int r = ${Be[0]};
    int c = ${Be[1]};
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= ${me};
    bool rEdge = rp1 >= ${_e};
  `}(k,b[b.length-1],b[b.length-2],A),re=function(ie,me){let _e=ie.length,Ue=function(Be,Ye){let He=[];for(let Ke=0;Ke<=1;Ke++)for(let Je=0;Je<=1;Je++){let Nt=`${Ke===0?"r":"rp1"}, ${Je===0?"c":"cp1"}`;for(let Jt=2;Jt<Be;Jt++)Nt=Ye[Ye.length-1-Jt]+","+Nt;He.push(Nt)}return He}(_e,me);return _e===1?`getA(rc),
            rc + 1 >= ${ie[0]} ? 0. : getA(rc + 1),
            0, 0`:`getA(${Ue[0]}),
          cEdge ? 0. : getA(${Ue[1]}),
          rEdge ? 0. : getA(${Ue[2]}),
          rEdge || cEdge ? 0. : getA(${Ue[3]})`}(b,A);this.userCode=`
        void main() {
          ${j} rc = getOutputCoords();

          if(${G}) {
            setOutput(vec4(0));
          } else {
            ${H}

            setOutput(vec4(${re}));
          }
        }
      `}}}class W2{constructor(b,k,A){this.variableNames=["x"],this.outputShape=k.map((me,_e)=>me[0]+b[_e]+me[1]);let j=b.length,G=Cn(j),H=k.map(me=>me[0]).join(","),re=k.map((me,_e)=>me[0]+b[_e]).join(","),ie=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,j);this.userCode=j!==1?`
      ${G} start = ${G}(${H});
      ${G} end = ${G}(${re});

      void main() {
        ${G} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(${A}));
        } else {
          ${G} coords = outC - start;
          setOutput(getX(${ie}));
        }
      }
    `:`
        int start = ${H};
        int end = ${re};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(${A}));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}}class H2{constructor(b,k,A){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=k.map((Ke,Je)=>Ke[0]+b[Je]+Ke[1]);let j=b.length,G=Cn(j),H=k.map(Ke=>Ke[0]).join(","),re=k.map((Ke,Je)=>Ke[0]+b[Je]).join(","),ie=Yt("rc",j),me=Yt("source",j),_e=`${ie[j-1]} < ${this.outputShape[j-1]}`,Ue=j===1?"source":`vec2(${me.slice(-2).join()})`,Be=[G+" rc = outputLoc;",`${ie[j-1]} += 1;
       if(${_e}) {
      `,j===1?"":`}
       rc = outputLoc;
       ${ie[j-2]} += 1;
       if(${ie[j-2]} < ${this.outputShape[j-2]}) {`,j===1?"":`  ${ie[j-1]} += 1;
         if(${_e}) {`],Ye=j===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",He="";for(let Ke=0,Je=j===1?2:4;Ke<Je;Ke++)He+=`
        ${Be[Ke]}
        if (${Ye}) {
          result[${Ke}] = float(${A});
        } else {
          ${G} source = rc - start;
          result[${Ke}] = getChannel(getX(${me.join()}), ${Ue});
        }
      `;He+=j===1?"} ":"}}",this.userCode=`
      const ${G} start = ${G}(${H});
      const ${G} end = ${G}(${re});

      void main() {
        ${G} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${He}
        setOutput(result);
      }
    `}}class ff{constructor(b,k,A,j=!1,G=!1){if(this.variableNames=["x"],k==="avg"&&A)throw new Error("Cannot compute positions for average pool.");let H=b.filterWidth,re=b.strideHeight,ie=b.strideWidth,me=b.dilationHeight,_e=b.dilationWidth,Ue=b.effectiveFilterHeight,Be=b.effectiveFilterWidth,Ye=b.padInfo.top,He=b.padInfo.left;this.outputShape=b.outShape;let Ke=k==="avg",Je=`((batch  * ${b.inHeight} + xR) * ${b.inWidth} + xC) * ${b.inChannels} + d`,Nt=`(xR * ${b.inWidth} + xC) * ${b.inChannels} + d`,Jt="0.0";if(Ke||(Jt="-1.0 / 1e-20"),A){let In=">=";return void(this.userCode=`
        const ivec2 strides = ivec2(${re}, ${ie});
        const ivec2 pads = ivec2(${Ye}, ${He});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${Ue};
              wR += ${me}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${b.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${Be};
                wC += ${_e}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${b.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${In} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${j?G?Je:Nt:`wR * ${Be} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `)}let on=`${k}(${k}(${k}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;k==="avg"&&(on="avgValue / count");let dt=4*Math.floor(H/4),Bt=H%4,wt=`
      if (${Ke}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${re}, ${ie});
      const ivec2 pads = ivec2(${Ye}, ${He});
      const float initializationValue = ${Jt};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${b.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${Jt});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${Ue};
            wR += ${me}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${b.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${dt}; wC += 4) {
            int xC = xCCorner + wC * ${_e};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${_e}, d),
              getValue(batch, xR, xC + 2 * ${_e}, d),
              getValue(batch, xR, xC + 3 * ${_e}, d)
            );

            ${wt}
          }

          int xC = xCCorner + ${dt};
          if (${Bt===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${wt}
          } else if (${Bt===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${_e}, d),
              initializationValue,
              initializationValue
            );

            ${wt}
          } else if (${Bt===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${_e}, d),
              getValue(batch, xR, xC + 2 * ${_e}, d),
              initializationValue
            );

            ${wt}
          }
        }
        setOutput(${on});
      }
    `}}class Au{constructor(b,k,A,j=!1,G=!1){if(this.variableNames=["x"],k==="avg"&&A)throw new Error("Cannot compute positions for average pool.");let H=b.filterWidth,re=b.strideDepth,ie=b.strideHeight,me=b.strideWidth,_e=b.dilationDepth,Ue=b.dilationHeight,Be=b.dilationWidth,Ye=b.effectiveFilterDepth,He=b.effectiveFilterHeight,Ke=b.effectiveFilterWidth,Je=b.padInfo.front,Nt=b.padInfo.top,Jt=b.padInfo.left;this.outputShape=b.outShape;let on=k==="avg",dt="0.0";if(on||(dt="-1.0 / 1e-20"),A){let kt=">=";return void(this.userCode=`
        const ivec3 strides =
            ivec3(${re}, ${ie}, ${me});
        const ivec3 pads = ivec3(${Je}, ${Nt}, ${Jt});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${Ye};
              wD += ${_e}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${b.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${He};
                wR += ${Ue}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${b.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${Ke};
                  wC += ${Be}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${b.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${kt} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${j?G?`(((batch * ${b.inDepth} + xD) * ${b.inHeight} + xR) * ${b.inWidth} + xC) * ${b.inChannels} + ch`:`((xD * ${b.inHeight} + xR) * ${b.inWidth} + xC) * ${b.inChannels} + ch`:`wD * ${He} * ${Ke} +
                      wR * ${Ke} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `)}let Bt=`${k}(${k}(${k}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;k==="avg"&&(Bt="avgValue / count");let wt=4*Math.floor(H/4),In=H%4,Ut=`
      if (${on}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${re}, ${ie}, ${me});
      const ivec3 pads = ivec3(${Je}, ${Nt}, ${Jt});
      const float initializationValue = ${dt};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${b.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${dt});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${Ye};
            wD += ${_e}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${b.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${He};
            wR += ${Ue}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${b.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${wt}; wC += 4) {
              int xC = xCCorner + wC * ${Be};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${Be}, ch),
                getValue(batch, xD, xR, xC + 2 * ${Be}, ch),
                getValue(batch, xD, xR, xC + 3 * ${Be}, ch)
              );

              ${Ut}
            }

            int xC = xCCorner + ${wt};
            if (${In===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${Ut}
            } else if (${In===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${Be}, ch),
                initializationValue,
                initializationValue
              );

              ${Ut}
            } else if (${In===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${Be}, ch),
                getValue(batch, xD, xR, xC + 2 * ${Be}, ch),
                initializationValue
              );

              ${Ut}
            }
          }
          setOutput(${Bt});
        }
      }
    `}}class Xx{constructor(b,k){this.variableNames=["x"];let{windowSize:A,batchSize:j,inSize:G,outSize:H}=b;this.outputShape=[j,H];let re="0.0",ie="";k==="prod"?re="1.0":k==="min"?(re="1.0 / 1e-20",ie="min"):k==="max"&&(re="-1.0 / 1e-20",ie="max");let me=`${k}(${k}(${k}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;k==="sum"?me="sumValue":k==="prod"?me="prodValue":k==="all"?me="allValue":k==="any"&&(me="anyValue");let _e=4*Math.floor(A/4),Ue=A%4,Be=`
      if (${k==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${k==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${ie}(values, minMaxValue);
      }
    `,Ye="vec4";k==="all"?(re="1.0",Be=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,Ye="bvec4"):k==="any"&&(re="0.0",Be=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,Ye="bvec4");let He="";G%A>0&&(He=`
        if (inIdx < 0 || inIdx >= ${G}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${re};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${He}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${A};

        vec4 minMaxValue = vec4(${re});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${_e}; i += 4) {
          int inIdx = inOffset + i;
          ${Ye} values = ${Ye}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${Be}
        }

        int inIdx = inOffset + ${_e};
        if (${Ue===1}) {
          ${Ye} values = ${Ye}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${Be}
        } else if (${Ue===2}) {
          ${Ye} values = ${Ye}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${Be}
        } else if (${Ue===3}) {
          ${Ye} values = ${Ye}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${Be}
        }
        setOutput(${me});
      }
    `}}class _c{constructor(b,k){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b;let A="";for(let G=0;G<4;G++){let H="thisRC = rc;";G%2==1&&(H+="thisRC.z += 1;"),G>1&&(H+="thisRC.y += 1;"),A+=`
        ${H}
        ${G>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${G}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${G>0?"}":""}
      `}var j;this.userCode=`
      ${j=k,`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${Gn(["r","c","d"],j)}
      return ivec3(r, c, d);
    }
  `}
      ${Un(b)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${b[1]};
        int cols = ${b[2]};

        ${A}

        setOutput(result);
      }
    `}}class Yx{constructor(b,k,A){this.variableNames=["dy"],this.outputShape=[],this.outputShape=k.shape;let[,j,G]=k.shape,[,H,re]=b.shape,ie=[A&&H>1?j-1:j,A&&re>1?G-1:G],me=[A&&H>1?H-1:H,A&&re>1?re-1:re],_e=ie[0]/me[0],Ue=ie[1]/me[1],Be=1/_e,Ye=1/Ue,He=2*Math.ceil(Be)+2,Ke=2*Math.ceil(Ye)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${_e});
        const float widthScale = float(${Ue});

        const float invHeightScale = float(${Be});
        const float invWidthScale = float(${Ye});

        const int winHeight = int(${He});
        const int winWidth = int(${Ke});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${H}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${re}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${j-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${G-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}class cl{constructor(b,k,A,j){this.variableNames=["A"],this.outputShape=[];let[G,H,re,ie]=b;this.outputShape=[G,k,A,ie];let me=[j&&k>1?H-1:H,j&&A>1?re-1:re],_e=[j&&k>1?k-1:k,j&&A>1?A-1:A];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${me[0]/_e[0]},
          ${me[1]/_e[1]});
      const vec2 inputShapeRC = vec2(${H}.0, ${re}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}class K2{constructor(b,k,A,j){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[G,H,re,ie]=b;this.outputShape=[G,k,A,ie];let me=[j&&k>1?H-1:H,j&&A>1?re-1:re],_e=[j&&k>1?k-1:k,j&&A>1?A-1:A];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${me[0]/_e[0]},
          ${me[1]/_e[1]},
          ${me[1]/_e[1]});
      const vec3 inputShapeRC = vec3(${H}.0, ${re}.0,
                                     ${re}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${ie-1};
        bool hasNextRow = coords.z < ${A-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}class oh{constructor(b,k,A){this.variableNames=["dy"],this.outputShape=[],this.outputShape=k.shape;let[,j,G]=k.shape,[,H,re]=b.shape,ie=[A&&H>1?j-1:j,A&&re>1?G-1:G],me=[A&&H>1?H-1:H,A&&re>1?re-1:re],_e=ie[0]/me[0],Ue=ie[1]/me[1],Be=1/_e,Ye=1/Ue,He=2*Math.ceil(Be)+2,Ke=2*Math.ceil(Ye)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${_e});
        const float widthScale = float(${Ue});

        const float invHeightScale = float(${Be});
        const float invWidthScale = float(${Ye});

        const int winHeight = int(${He});
        const int winWidth = int(${Ke});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${H}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${re}) {
              continue;
            }

            float sourceFracRow =
              float(${ie[0]}) *
                (float(dyR) / float(${me[0]}));

            float sourceFracCol =
                float(${ie[1]}) *
                  (float(dyC) / float(${me[1]}));

            int sourceNearestRow = int(min(
                float(int(${j}) - 1),
                ${A} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${G}) - 1),
                ${A} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}class sh{constructor(b,k,A,j){this.variableNames=["A"],this.outputShape=[];let[G,H,re,ie]=b;this.outputShape=[G,k,A,ie];let me=[j&&k>1?H-1:H,j&&A>1?re-1:re],_e=[j&&k>1?k-1:k,j&&A>1?A-1:A],Ue=j?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${me[0]/_e[0]},
          ${me[1]/_e[1]});
      const vec2 inputShapeRC = vec2(${H}.0, ${re}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${Ue})));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}class ih{constructor(b,k){this.variableNames=["x"];let A=b.length;if(A>4)throw new Error(`WebGL backend: Reverse of rank-${A} tensor is not yet supported`);if(this.outputShape=b,A===1)return void(this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${b[0]} - coord - 1));
        }
      `);let j=b.map((H,re)=>(ie=>k.indexOf(ie)!==-1&&b[ie]!==1?`${b[ie]} - coords[${ie}] - 1`:`coords[${ie}]`)(re)).join(","),G=Cn(A);this.userCode=`
      void main() {
        ${G} coords = getOutputCoords();
        setOutput(getX(${j}));
      }
    `}}class Ju{constructor(b,k){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let A=b.length;if(A>4)throw new Error(`WebGL backend: Reverse of rank-${A} tensor is not yet supported`);this.outputShape=b;let j=Yt("rc",A),G=`${j[A-1]} + 1 < ${this.outputShape[A-1]}`,H=`${j[A-2]} + 1 < ${this.outputShape[A-2]}`,re=Cn(A);function ie(me){let _e=b.map((Ue,Be)=>function(Ye,He){return k.indexOf(Ye)!==-1&&b[Ye]!==1?`${b[Ye]} - ${He[Ye]} - 1`:""+He[Ye]}(Be,me));return`getChannel(getX(${_e.join(",")}), vec2(${_e.slice(-2).join(",")}))`}this.userCode=A===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${b[0]} - rc - 1),
            ${b[0]} - rc - 1);
          if(${G}){
              result.g = getChannel(getX(${b[0]} - (rc  + 1) - 1),
                ${b[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          ${re} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${function(me){return ie(me)}(j.slice())};
          if(${G}){
            result.g = ${function(me){return me[A-1]="("+me[A-1]+" + 1)",ie(me)}(j.slice())};
          }
          if(${H}) {
            result.b = ${function(me){return me[A-2]="("+me[A-2]+" + 1)",ie(me)}(j.slice())};
            if(${G}) {
              result.a = ${function(me){return me[A-1]="("+me[A-1]+" + 1)",me[A-2]="("+me[A-2]+" + 1)",ie(me)}(j.slice())};
            }
          }
          setOutput(result);
        }
    `}}class nu{constructor(b,k,A,j,G,H,re=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=H;let ie=Cn(G.length),me=Cn(H.length),_e="";A===1?_e="i":A===2&&(_e="i, j");let Ue=`getIndices(${_e})`,Be="";j===1?Be="i":j===2&&(Be="i, coords[1]");let Ye=`getUpdates(${Be})`,He=k>1?"strides[j]":"strides";this.userCode=`
        ${ie} strides = ${ie}(${G});

        void main() {
          ${me} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${b}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${k}; j++) {
              int index = round(${Ue});
              flattenedIndex += index * ${He};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${Ye};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}class xy{constructor(b,k){this.variableNames=["x","segmentIds"];let A=b.windowSize,j=b.batchSize,G=b.inSize,H=b.numSegments,re=H*Math.ceil(G/A);this.outputShape=[j,re];let ie=4*Math.floor(A/4),me=A%4,_e=`
        sumValue += dot(values, segFilter);
    `,Ue="";G%A>0&&(Ue=`
        if (inIdx < 0 || inIdx >= ${G}) {
          return initializationValue;
        }
      `);let Be="";G%A>0&&(Be=`
        if (inIdx < 0 || inIdx >= ${G}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        ${Ue}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${Be}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${H})) * float(${A}));
        int currentSeg = int(mod(float(outIdx), float(${H})));

        float sumValue = 0.0;

        for (int i = 0; i < ${ie}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${_e}
        }

        int inIdx = inOffset + ${ie};
        if (${me===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${_e}
        } else if (${me===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${_e}
        } else if (${me===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${_e}
        }
        setOutput(sumValue);
      }
    `}}class ru{constructor(b,k,A){let j,G;if(this.variableNames=["c","a","b"],this.outputShape=k,A>4)throw Error(`Where for rank ${A} is not yet supported`);if(A===1)G="resRC",j="resRC";else{let re=["resRC.x","resRC.y","resRC.z","resRC.w"],ie=[],me=[];for(let _e=0;_e<k.length;_e++)me.push(""+re[_e]),_e<b&&ie.push(""+re[_e]);j=ie.join(),G=me.join()}let H=Cn(A);this.userCode=`
      void main() {
        ${H} resRC = getOutputCoords();
        float cVal = getC(${j});
        if (cVal >= 1.0) {
          setOutput(getA(${G}));
        } else {
          setOutput(getB(${G}));
        }
      }
    `}}class wg{constructor(b){this.variableNames=["source"],this.outputShape=b,this.rank=b.length;let k=Cn(this.rank),A=`uniform int start[${this.rank}];`,j=function(H){if(H===1)return"sourceLoc";if(H<=6)return ec.slice(0,H).map(re=>"sourceLoc."+re).join(",");throw Error(`Slicing for rank ${H} is not yet supported`)}(this.rank),G;G=`
        ${k} sourceLoc;
        ${k} coords = getOutputCoords();
        ${b.map((H,re)=>`sourceLoc.${ec[re]} = start[${re}] + coords.${ec[re]};`).join(`
`)}
      `,this.userCode=`
      ${A}
      void main() {
        ${G}
        setOutput(getSource(${j}));
      }
    `}getCustomSetupFunc(b){if(b.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${b.length})`);return(k,A)=>{this.startLoc==null&&(this.startLoc=k.getUniformLocationNoThrow(A,"start"),this.startLoc==null)||k.gl.uniform1iv(this.startLoc,b)}}}let ec=["x","y","z","w","u","v"];class Ks{constructor(b){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b,this.rank=b.length;let k=Cn(this.rank),A=Yt("coords",this.rank),j=Yt("sourceLoc",this.rank),G=this.rank===1?"sourceLoc":`vec2(${j.slice(-2).join()})`,H=`getChannel(getSource(${j.join()}), ${G})`,re=`
      result.x = ${H};
      if (++${A[this.rank-1]} < ${b[this.rank-1]}) {
        ++${j[this.rank-1]};
        result.y = ${H};
        --${j[this.rank-1]};
      }
    `,ie=this.rank===1?"":`
      --${A[this.rank-1]};
      if (++${A[this.rank-2]} < ${b[this.rank-2]}) {
        ++${j[this.rank-2]};
        result.z = ${H};
        if (++${A[this.rank-1]} < ${b[this.rank-1]}) {
          ++${j[this.rank-1]};
          result.w = ${H};
        }
      }
    `,me=this.rank<=4?`sourceLoc = coords +
            ${k}(${b.map((_e,Ue)=>`start[${Ue}]`).join()});`:b.map((_e,Ue)=>`${j[Ue]} = ${A[Ue]} + start[${Ue}];`).join(`
`);this.userCode=`
      uniform int start[${this.rank}];
      void main() {
        ${k} coords = getOutputCoords();
        ${k} sourceLoc;
        ${me}
        vec4 result = vec4(0.);
        ${re}
        ${ie}
        setOutput(result);
      }
    `}getCustomSetupFunc(b){if(b.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${b.length})`);return(k,A)=>{this.startLoc==null&&(this.startLoc=k.getUniformLocationNoThrow(A,"start"),this.startLoc==null)||k.gl.uniform1iv(this.startLoc,b)}}}class fr{constructor(b,k,A){this.variableNames=["x"],this.outputShape=A;let j=A.length,G=Cn(A.length),H=Cn(A.length),re="";if(j===1)re="coords * strides + begin";else{let ie=0;re=A.map((me,_e)=>(ie++,A.length===1?`coords * strides[${_e}] + begin[${_e}]`:`coords[${ie-1}] * strides[${_e}] + begin[${_e}]`)).join(",")}this.userCode=`
      ${G} begin = ${G}(${b});
      ${G} strides = ${G}(${k});

      void main() {
        ${H} coords = getOutputCoords();
        setOutput(getX(${re}));
      }
    `}}class by{constructor(b){this.gpgpu=b,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(b,k,A){let j=Qx(k,A),G=Zx(b,j,A);G in this.freeTextures||(this.freeTextures[G]=[]),G in this.usedTextures||(this.usedTextures[G]=[]);let H=Xs(b,j,this.gpgpu.gl,this.gpgpu.textureConfig,A);if(this.freeTextures[G].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=H,this.log();let ie=this.freeTextures[G].shift();return this.usedTextures[G].push(ie),ie}let re;return j===h.PACKED_2X2_FLOAT32?re=this.gpgpu.createPackedMatrixTexture(b[0],b[1]):j===h.PACKED_2X2_FLOAT16?re=this.gpgpu.createFloat16PackedMatrixTexture(b[0],b[1]):j===h.UNPACKED_FLOAT32?re=this.gpgpu.createFloat32MatrixTexture(b[0],b[1]):j===h.UNPACKED_FLOAT16?re=this.gpgpu.createFloat16MatrixTexture(b[0],b[1]):j===h.PACKED_4X1_UNSIGNED_BYTE&&(re=this.gpgpu.createUnsignedBytesMatrixTexture(b[0],b[1])),this.usedTextures[G].push(re),this.numUsedTextures++,this._numBytesAllocated+=H,this.log(),re}releaseTexture(b,k,A,j){if(this.freeTextures==null)return;let G=Qx(A,j),H=Zx(k,G,j);H in this.freeTextures||(this.freeTextures[H]=[]);let re=Xs(k,G,this.gpgpu.gl,this.gpgpu.textureConfig,j),ie=Object(o.jb)().get("WEBGL_DELETE_TEXTURE_THRESHOLD");ie!==-1&&this._numBytesAllocated>ie?(this.gpgpu.deleteMatrixTexture(b),this._numBytesAllocated-=re):(this.freeTextures[H].push(b),this.numFreeTextures++,this._numBytesFree+=re),this.numUsedTextures--;let me=this.usedTextures[H],_e=me.indexOf(b);if(_e<0)throw new Error("Cannot release a texture that was never provided by this texture manager");me.splice(_e,1),this.log()}log(){if(!this.logEnabled)return;let b=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${b})`);let k=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: "+this._numBytesAllocated),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*k)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let b in this.freeTextures)this.freeTextures[b].forEach(k=>{this.gpgpu.deleteMatrixTexture(k)});for(let b in this.usedTextures)this.usedTextures[b].forEach(k=>{this.gpgpu.deleteMatrixTexture(k)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Xs(te,b,k,A,j){let G=function(re,ie){switch(re){case h.PACKED_2X2_FLOAT32:return sp(ie);case h.PACKED_2X2_FLOAT16:return Uo(ie);case h.UNPACKED_FLOAT32:return Jr(ie);case h.UNPACKED_FLOAT16:return _o(ie);case h.PACKED_4X1_UNSIGNED_BYTE:return bg(ie);default:throw new Error("Unknown physical texture type "+re)}}(b,A),H;if(j){let[re,ie]=d(te[0],te[1]);H=re*ie}else{let[re,ie]=f(te[0],te[1]);H=re*ie}return H*function(re,ie){let me=re;if(ie===me.R32F)return 4;if(ie===me.R16F)return 2;if(ie===me.RGBA32F||ie===re.RGBA)return 16;if(ie===me.RGBA16F)return 8;throw new Error("Unknown internal format "+ie)}(k,G)}function Qx(te,b){if(te===c.UPLOAD)return h.PACKED_2X2_FLOAT32;if(te===c.RENDER||te==null)return function(k){return Object(o.jb)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?k?h.PACKED_2X2_FLOAT32:h.UNPACKED_FLOAT32:k?h.PACKED_2X2_FLOAT16:h.UNPACKED_FLOAT16}(b);if(te===c.DOWNLOAD||te===c.PIXELS)return h.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+te)}function Zx(te,b,k){return`${te[0]}_${te[1]}_${b}_${k}`}class Jx{constructor(b,k){this.variableNames=["A"];let A=new Array(b.length);for(let H=0;H<A.length;H++)A[H]=b[H]*k[H];this.outputShape=A,this.rank=A.length;let j=Cn(this.rank),G=function(H){let re=H.length;if(re>5)throw Error(`Tile for rank ${re} is not yet supported`);if(re===1)return`imod(resRC, ${H[0]})`;let ie=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],me=[];for(let _e=0;_e<H.length;_e++)me.push(`imod(${ie[_e]}, ${H[_e]})`);return me.join()}(b);this.userCode=`
      void main() {
        ${j} resRC = getOutputCoords();
        setOutput(getA(${G}));
      }
    `}}class Fr{constructor(b,k){this.variableNames=["A"],this.outputShape=b,this.userCode=`
      float unaryOperation(float x) {
        ${k}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}let eb="return abs(x);",Ou=`if (isnan(x)) return x;
  return (x < 0.0) ? 0.0 : x;
`,$s=`if (isnan(x)) return x;
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,vy="return (x >= 0.0) ? x : (exp(x) - 1.0);",Wi=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${o.X.SELU_SCALEALPHA};
  float scale = ${o.X.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Sg="return -x;",ip="return ceil(x);",wy="return floor(x);",mf="return exp(x);",Tc="return exp(x) - 1.0;",Cg=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${o.X.ERF_P};
  float a1 = ${o.X.ERF_A1};
  float a2 = ${o.X.ERF_A2};
  float a3 = ${o.X.ERF_A3};
  float a4 = ${o.X.ERF_A4};
  float a5 = ${o.X.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,ap="return x;",up=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cp=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Ru=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`;class lp{constructor(b,k){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${k}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}class tb{constructor(b){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=b;let k=b.length,A=Yt("rc",k),j=Cn(k),G=function(ie,me){if(ie===1)return"rc";let _e="";for(let Ue=0;Ue<ie;Ue++)_e+=me[Ue],Ue<ie-1&&(_e+=",");return _e}(k,A),H=A.slice(-2),re=k<=1?"rc":`vec2(${H.join(",")})`;this.userCode=`
      void main() {
        ${j} rc = getOutputCoords();
        vec4 packedInput = getA(${G});

        setOutput(getChannel(packedInput, ${re}));
      }
    `}}let{segment_util:Sy}=o.X,X2=o.lb.split,nb=o.lb.tile,rb=o.lb.topkImpl,Cy=o.lb.whereImpl,pp={};function Ig(te,b=!1){if(te==="linear")return"return x;";if(te==="relu")return b?up:Ou;if(te==="elu")return b?Ru:vy;if(te==="relu6")return b?cp:$s;if(te==="prelu")return b?qi:Ui;throw new Error(`Activation ${te} has not been implemented for the WebGL backend.`)}class Y2 extends o.w{constructor(b){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.warnedAboutCPUBackend=!1,this.pendingDeletes=0,this.disposed=!1,!Object(o.jb)().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(b==null){let A=a(Object(o.jb)().getNumber("WEBGL_VERSION"));this.binaryCache=((k=Object(o.jb)().getNumber("WEBGL_VERSION"))in pp||(pp[k]={}),pp[k]),this.gpgpu=new vg(A),this.canvas=A.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=b,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=b.gl.canvas;var k;this.textureManager=new by(this.gpgpu),this.numMBBeforeWarning=Object(o.jb)().global.screen==null?1024:Object(o.jb)().global.screen.height*Object(o.jb)().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new o.k(this,Object(o.ib)())}numDataIds(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}write(b,k,A){if((Object(o.jb)().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Object(o.jb)().getBool("DEBUG"))&&this.checkNumericalProblems(b),A==="complex64"&&b!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let j={};return this.texData.set(j,{shape:k,dtype:A,values:b,usage:c.UPLOAD,refCount:1,complexParentRefCount:0}),j}incRef(b){this.texData.get(b).refCount++}decRef(b){this.texData.has(b)&&this.texData.get(b).refCount--}move(b,k,A,j){if(Object(o.jb)().getBool("DEBUG")&&this.checkNumericalProblems(k),j==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(b,{shape:A,dtype:j,values:k,usage:c.UPLOAD,refCount:1,complexParentRefCount:0})}disposeIntermediateTensorInfo(b){let k=b.dataId;if(this.texData.has(k)){let A=this.texData.get(k);A.refCount--,A.refCount<1&&this.disposeData(k)}}readSync(b){let k=this.texData.get(b),{values:A,dtype:j,complexTensorInfos:G,slice:H,shape:re,isPacked:ie}=k;if(H!=null){let Be;Be=ie?new lp(re,ap):new Fr(re,ap);let Ye=this.runWebGLProgram(Be,[{dataId:b,shape:re,dtype:j}],j),He=this.readSync(Ye.dataId);return this.disposeIntermediateTensorInfo(Ye),He}if(A!=null)return this.convertAndCacheOnCPU(b);if(j==="string")return A;let me=this.activeTimers!=null,_e,Ue;if(me&&(_e=o.Lb.now()),j==="complex64"){let Be=this.readSync(G.real.dataId),Ye=this.readSync(G.imag.dataId);Ue=o.X.mergeRealAndImagArrays(Be,Ye)}else Ue=this.getValuesFromTexture(b);return me&&(this.downloadWaitMs+=o.Lb.now()-_e),this.convertAndCacheOnCPU(b,Ue)}read(b){return Te(this,null,function*(){if(this.pendingRead.has(b)){let He=this.pendingRead.get(b);return new Promise(Ke=>He.push(Ke))}let k=this.texData.get(b),{values:A,shape:j,slice:G,dtype:H,complexTensorInfos:re,isPacked:ie}=k;if(G!=null){let He;He=ie?new lp(j,ap):new Fr(j,ap);let Ke=this.runWebGLProgram(He,[{dataId:b,shape:j,dtype:H}],H),Je=this.read(Ke.dataId);return this.disposeIntermediateTensorInfo(Ke),Je}if(A!=null)return this.convertAndCacheOnCPU(b);if(!Object(o.jb)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Object(o.jb)().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let me,_e,Ue=null;if(H!=="complex64"&&Object(o.jb)().get("WEBGL_BUFFER_SUPPORTED")){me=this.decode(b);let He=this.texData.get(me.dataId);Ue=this.gpgpu.createBufferFromTexture(He.texture,...g(j))}if(this.pendingRead.set(b,[]),H!=="complex64"&&(yield this.gpgpu.createAndWaitForFence()),H==="complex64"){let He=yield Promise.all([this.read(re.real.dataId),this.read(re.imag.dataId)]),Ke=He[0],Je=He[1];_e=o.X.mergeRealAndImagArrays(Ke,Je)}else if(Ue==null)_e=this.getValuesFromTexture(b);else{let He=o.Lb.sizeFromShape(j);_e=this.gpgpu.downloadFloat32MatrixFromBuffer(Ue,He)}me!=null&&this.disposeIntermediateTensorInfo(me);let Be=this.convertAndCacheOnCPU(b,_e),Ye=this.pendingRead.get(b);return this.pendingRead.delete(b),Ye.forEach(He=>He(Be)),this.pendingDisposal.has(b)&&(this.pendingDisposal.delete(b),this.disposeData(b),this.pendingDeletes--),Be})}checkNumericalProblems(b){if(b!=null)for(let k=0;k<b.length;k++){let A=b[k];if(!y(A))throw Object(o.jb)().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${A} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${A} cannot be represented on this device.`)}}getValuesFromTexture(b){let{shape:k,dtype:A,isPacked:j}=this.texData.get(b),G=o.Lb.sizeFromShape(k);if(Object(o.jb)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let Be=this.decode(b),Ye=this.texData.get(Be.dataId),He=this.gpgpu.downloadMatrixFromPackedTexture(Ye.texture,...g(k)).subarray(0,G);return this.disposeIntermediateTensorInfo(Be),He}let H=Object(o.jb)().getBool("WEBGL_PACK")&&j===!0,re=H?oe(k):k,ie=H?new pf(re):new ho(re),me=this.runWebGLProgram(ie,[{shape:re,dtype:A,dataId:b}],"float32"),_e=this.texData.get(me.dataId),Ue=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(_e.texture,_e.texShape[0],_e.texShape[1]).subarray(0,G);return this.disposeIntermediateTensorInfo(me),Ue}time(b){return Te(this,null,function*(){let k=this.activeTimers,A=[],j=!1;this.programTimersStack==null?(this.programTimersStack=A,j=!0):this.activeTimers.push(A),this.activeTimers=A,b();let G=o.Lb.flatten(this.activeTimers.map(ie=>ie.query)).filter(ie=>ie!=null),H=o.Lb.flatten(this.activeTimers.map(ie=>ie.name)).filter(ie=>ie!=null);this.activeTimers=k,j&&(this.programTimersStack=null);let re={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(Object(o.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let ie=yield Promise.all(G);re.kernelMs=o.Lb.sum(ie),re.getExtraProfileInfo=()=>ie.map((me,_e)=>({name:H[_e],ms:me})).map(me=>`${me.name}: ${me.ms}`).join(", ")}else re.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,re})}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Object(o.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:o.Lb.now(),endMs:null}}endTimer(b){return Object(o.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),b):(b.endMs=o.Lb.now(),b)}getQueryTime(b){return Te(this,null,function*(){if(Object(o.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(b);let k=b;return k.endMs-k.startMs})}disposeData(b){if(this.pendingDisposal.has(b))return;if(this.pendingRead.has(b))return this.pendingDisposal.add(b),void this.pendingDeletes++;if(!this.texData.has(b))return;if(this.texData.get(b).complexParentRefCount>0)return void this.texData.get(b).refCount--;this.releaseGPUData(b);let{complexTensorInfos:k}=this.texData.get(b);k!=null&&(this.texData.get(k.real.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(k.real),this.texData.get(k.imag.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(k.imag)),this.texData.delete(b)}releaseGPUData(b){let{texture:k,dtype:A,texShape:j,usage:G,isPacked:H,slice:re}=this.texData.get(b),ie=re&&re.origDataId||b,me=this.dataRefCount.get(ie);me>1?this.dataRefCount.set(ie,me-1):(this.dataRefCount.delete(ie),k!=null&&(this.numBytesInGPU-=this.computeBytes(j,A),this.textureManager.releaseTexture(k,j,G,H)));let _e=this.texData.get(b);_e.texture=null,_e.texShape=null,_e.isPacked=!1,_e.slice=null}getTexture(b){return this.uploadToGPU(b),this.texData.get(b).texture}getDataInfo(b){return this.texData.get(b)}getCPUBackend(){return Object(o.jb)().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Object(o.ib)().findBackend("cpu")),this.cpuBackend):null}shouldExecuteOnCPU(b,k=128){let A=this.getCPUBackend();return this.warnedAboutCPUBackend||A!=null||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),A!=null&&b.every(j=>this.texData.get(j.dataId).texture==null&&o.Lb.sizeFromShape(j.shape)<k)}getGPGPUContext(){return this.gpgpu}slice(b,k,A){if(this.shouldExecuteOnCPU([b])){let H=bi(this.texData.get(b.dataId).values,k,A,b.shape,b.dtype);return this.makeOutput(A,b.dtype,H)}if(o.Lb.sizeFromShape(A)===0)return Object(o.Gb)([],A,b.dtype);let{isPacked:j}=this.texData.get(b.dataId),G=o.Ab.isSliceContinous(b.shape,k,A);if(j||!G){let H=Object(o.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ks(A):new wg(A),re=H.getCustomSetupFunc(k);return this.compileAndRun(H,[b],null,re)}return this.uploadToGPU(b.dataId),this.shallowSlice(b,k,A)}shallowSlice(b,k,A){let j=this.texData.get(b.dataId),G=this.makeOutput(A,b.dtype),H=this.texData.get(G.dataId);Object.assign(H,j),H.shape=A,H.dtype=b.dtype;let re=o.Ab.computeFlatOffset(k,b.strides);j.slice&&(re+=j.slice.flatOffset),H.slice={flatOffset:re,origDataId:j.slice&&j.slice.origDataId||b.dataId};let ie=this.dataRefCount.get(H.slice.origDataId)||1;return this.dataRefCount.set(H.slice.origDataId,ie+1),G}stridedSlice(b,k,A,j){let G=this.tryRunOnCpuOrThrow([b],()=>this.cpuBackend.stridedSlice(b,k,A,j));if(G)return G;let H=o.Ab.computeOutShape(k,A,j);if(H.some(ie=>ie===0))return Object(o.Gb)([],H);let re=new fr(k,j,H);return this.compileAndRun(re,[b])}reverse(b,k){let A=Object(o.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ju(b.shape,k):new ih(b.shape,k);return this.compileAndRun(A,[b])}neg(b){let k=this.tryRunOnCpuOrThrow([b],()=>this.cpuBackend.neg(b));if(k)return k;if(Object(o.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(b,Sg,b.dtype);let A=new Fr(b.shape,Sg);return this.compileAndRun(A,[b])}batchMatMul(b,k,A,j){let G=A?b.shape[2]:b.shape[1],H=j?k.shape[1]:k.shape[2],re=A?b.shape[1]:b.shape[2],ie=Math.max(b.shape[0],k.shape[0]);if((G===1||H===1)&&re>1e3){A&&(b=Object(o.Jb)(b,[0,2,1])),j&&(k=Object(o.Jb)(k,[0,2,1]));let Ue=H===1?b:b.as3D(ie,re,1),Be=H===1?2:1,Ye=H===1?k.as3D(ie,1,re):k;return o.pb(Ue,Ye).sum(Be,!0)}let me=Object(o.Kb)(b.dtype,k.dtype),_e=new tu(b.shape,k.shape,[ie,G,H],A,j);return this.compileAndRun(_e,[b,k],me)}fusedBatchMatMul({a:b,b:k,transposeA:A,transposeB:j,bias:G,activation:H,preluActivationWeights:re}){let ie=A?b.shape[2]:b.shape[1],me=j?k.shape[1]:k.shape[2],_e=Math.max(b.shape[0],k.shape[0]),Ue=Object(o.Kb)(b.dtype,k.dtype),Be=G!=null,Ye=re!=null,He=H?Ig(H,!0):null,Ke=new tu(b.shape,k.shape,[_e,ie,me],A,j,Be,He,Ye),Je=[b,k];return G&&Je.push(G),re&&Je.push(re),this.compileAndRun(Ke,Je,Ue)}localResponseNormalization4D(b,k,A,j,G){let H=Object(o.jb)().getBool("WEBGL_PACK_NORMALIZATION")?new Hx(b.shape,k,A,j,G):new Wx(b.shape,k,A,j,G);return this.compileAndRun(H,[b])}LRNGrad(b,k,A,j,G,H,re){let ie=new df(k.shape,j,G,H,re);return this.compileAndRun(ie,[k,A,b])}tile(b,k){if(b.dtype==="string"){let j=this.readSync(b.dataId).map(H=>o.Lb.decodeString(H)),G=Object(o.Z)(b.shape,b.dtype,j);return nb(G,k)}let A=new Jx(b.shape,k);return this.compileAndRun(A,[b])}pad(b,k,A){let j=Object(o.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new H2(b.shape,k,A):new W2(b.shape,k,A);return this.compileAndRun(j,[b])}gather(b,k,A){let j=this.tryRunOnCpuOrThrow([b,k],()=>this.cpuBackend.gather(b,k,A));if(j)return j;let G=new xr(b.shape,k.size,A);return this.compileAndRun(G,[b,k])}batchToSpaceND(b,k,A){o.Lb.assert(b.rank<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let j=k.reduce((_e,Ue)=>_e*Ue),G=o.X.getReshaped(b.shape,k,j),H=o.X.getPermuted(G.length,k.length),re=o.X.getReshapedPermuted(b.shape,k,j),ie=o.X.getSliceBeginCoords(A,k.length),me=o.X.getSliceSize(re,A,k.length);return Object(o.Jb)(b.reshape(G),H).reshape(re).slice(ie,me)}spaceToBatchND(b,k,A){o.Lb.assert(b.rank<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let j=k.reduce((Ue,Be)=>Ue*Be),G=[[0,0]];G.push(...A);for(let Ue=1+k.length;Ue<b.shape.length;++Ue)G.push([0,0]);let H=b.pad(G),re=o.X.getReshaped(H.shape,k,j,!1),ie=o.X.getPermuted(re.length,k.length,!1),me=o.X.getReshapedPermuted(H.shape,k,j,!1),_e=Object(o.Jb)(H.reshape(re),ie);return Object(o.xb)(_e,me)}reduce(b,k,A){let j=b.shape[0],G=b.shape[1],H=o.X.computeOptimalWindowSize(G),re=Math.ceil(G/H),ie=new Xx({windowSize:H,inSize:G,batchSize:j,outSize:re},k),me=this.compileAndRun(ie,[b],A);return me.shape[1]===1?me:this.reduce(me,k,A)}argReduce(b,k,A=null){let j=b.shape[0],G=b.shape[1];A!=null&&(j=A.shape[0],G=A.shape[1]);let H=o.X.computeOptimalWindowSize(G),re={windowSize:H,inSize:G,batchSize:j,outSize:Math.ceil(G/H)},ie=new ze(re,k,A==null),me=[b];A!=null&&me.push(A);let _e=this.compileAndRun(ie,me,"int32");return _e.shape[1]===1?_e:this.argReduce(b,k,_e)}argReducePacked(b,k,A=null){let j=A!=null?A.shape:b.shape,G=j[j.length-1],H=o.X.computeOptimalWindowSize(G),re=new ji(j,H,k,A==null),ie=A==null?[b]:[b,A],me=this.compileAndRun(re,ie,"int32");return me.rank===b.rank?this.argReducePacked(b,k,me):me}sum(b,k){o.X.assertAxesAreInnerMostDims("sum",k,b.rank);let[A,j]=o.X.computeOutAndReduceShapes(b.shape,k),G=o.Lb.sizeFromShape(j),H=b.as2D(-1,G),re=o.Fb(b.dtype);return this.reduce(H,"sum",re).reshape(A)}prod(b,k){let A=this.tryRunOnCpuOrThrow([b],()=>this.cpuBackend.prod(b,k));if(A)return A;let[j,G]=o.X.computeOutAndReduceShapes(b.shape,k),H=o.Lb.sizeFromShape(G),re=b.as2D(-1,H),ie=o.Fb(b.dtype);return this.reduce(re,"prod",ie).reshape(j)}unsortedSegmentSum(b,k,A){let j=0,G=o.X.getAxesPermutation([j],b.rank),H=b;G!=null&&(H=Object(o.Jb)(b,G),j=o.X.getInnerMostAxes(1,b.rank)[0]);let re=Sy.computeOutShape(H.shape,j,A),ie=o.Lb.sizeFromShape([H.shape[j]]),me=H.as2D(-1,ie),_e=o.Fb(b.dtype),Ue=this.segOpCompute(me,"unsortedSegmentSum",k,_e,A).reshape(re);return G!=null&&(Ue=Object(o.Jb)(Ue,o.X.getUndoAxesPermutation(G))),Ue}segOpCompute(b,k,A,j,G){let H=b.shape[0],re=b.shape[1],ie=Sy.segOpComputeOptimalWindowSize(re,G),me=new xy({windowSize:ie,inSize:re,batchSize:H,numSegments:G},k),_e=this.compileAndRun(me,[b,A],j);return _e.shape[1]===G?_e:(A=Object(o.ub)(0,G).tile([re/ie]),this.segOpCompute(_e,k,A,j,G))}argMinMaxReduce(b,k,A){let j=[k];if(o.X.assertAxesAreInnerMostDims("arg"+A.charAt(0).toUpperCase()+A.slice(1),j,b.rank),!Object(o.jb)().getBool("WEBGL_PACK_REDUCE")||b.rank<=2){let[G,H]=o.X.computeOutAndReduceShapes(b.shape,j),re=o.Lb.sizeFromShape(H),ie=b.as2D(-1,re);return this.argReduce(ie,A).reshape(G)}return this.argReducePacked(b,A)}argMin(b,k){return this.argMinMaxReduce(b,k,"min")}argMax(b,k){return this.argMinMaxReduce(b,k,"max")}cumsum(b,k,A,j){if(k!==b.rank-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${b.rank-1} but got axis=`+k);let G=b.shape[k],H=b;for(let re=0;re<=Math.ceil(Math.log2(G))-1;re++){let ie=new rp(b.shape,!1,j),me=ie.getCustomSetupFunc(re),_e=H;H=this.compileAndRun(ie,[H],H.dtype,me),_e.dispose()}if(A){let re=new rp(b.shape,A,j),ie=H;H=this.compileAndRun(re,[H]),ie.dispose()}return H}equal(b,k){if(Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(b,k,`
  return vec4(equal(a, b));
`,"bool");let A=new Ps("return float(a == b);",b.shape,k.shape);return this.compileAndRun(A,[b,k],"bool")}less(b,k){let A=this.tryRunOnCpuOrThrow([b,k],()=>this.cpuBackend.less(b,k));if(A)return A;if(Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(b,k,`
  return vec4(lessThan(a, b));
`,"bool");let j=new Ps("return float(a < b);",b.shape,k.shape);return this.compileAndRun(j,[b,k],"bool")}lessEqual(b,k){if(Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(b,k,`
  return vec4(lessThanEqual(a, b));
`,"bool");let A=new Ps("return float(a <= b);",b.shape,k.shape);return this.compileAndRun(A,[b,k],"bool")}greater(b,k){let A=this.tryRunOnCpuOrThrow([b,k],()=>this.cpuBackend.greater(b,k));if(A)return A;if(Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(b,k,`
  return vec4(greaterThan(a, b));
`,"bool");let j=new Ps("return float(a > b);",b.shape,k.shape);return this.compileAndRun(j,[b,k],"bool")}greaterEqual(b,k){if(Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(b,k,`
  return vec4(greaterThanEqual(a, b));
`,"bool");let A=new Ps("return float(a >= b);",b.shape,k.shape);return this.compileAndRun(A,[b,k],"bool")}logicalNot(b){let k=new Fr(b.shape,"return float(!(x >= 1.0));");return this.compileAndRun(k,[b])}logicalAnd(b,k){if(Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(b,k,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");let A=new Ps("return float(a >= 1.0 && b >= 1.0);",b.shape,k.shape);return this.compileAndRun(A,[b,k],"bool")}logicalOr(b,k){if(Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(b,k,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");let A=new Ps("return float(a >= 1.0 || b >= 1.0);",b.shape,k.shape);return this.compileAndRun(A,[b,k],"bool")}select(b,k,A){let j=new ru(b.rank,k.shape,k.rank);return this.compileAndRun(j,[b,k,A],Object(o.Kb)(k.dtype,A.dtype))}where(b){o.X.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let k=b.dataSync();return Cy(b.shape,k)}topk(b,k,A){let j=b.dataSync();return rb(j,b.shape,b.dtype,k,A)}min(b,k){o.X.assertAxesAreInnerMostDims("min",k,b.rank);let[A,j]=o.X.computeOutAndReduceShapes(b.shape,k),G=o.Lb.sizeFromShape(j),H=b.as2D(-1,G);return this.reduce(H,"min",H.dtype).reshape(A)}minimum(b,k){let A=this.tryRunOnCpuOrThrow([b,k],()=>this.cpuBackend.minimum(b,k));if(A)return A;let j=Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ni(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,b.shape,k.shape):new Ps(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,b.shape,k.shape);return this.compileAndRun(j,[b,k])}mod(b,k){let A=Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ni(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,b.shape,k.shape):new Ps(`if (b == 0.0) return NAN;
  return mod(a, b);`,b.shape,k.shape);return this.compileAndRun(A,[b,k])}maximum(b,k){let A=this.tryRunOnCpuOrThrow([b,k],()=>this.cpuBackend.maximum(b,k));if(A)return A;let j=Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ni(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,b.shape,k.shape):new Ps(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,b.shape,k.shape);return this.compileAndRun(j,[b,k])}all(b,k){o.X.assertAxesAreInnerMostDims("all",k,b.rank);let[A,j]=o.X.computeOutAndReduceShapes(b.shape,k),G=o.Lb.sizeFromShape(j),H=b.as2D(-1,G);return this.reduce(H,"all",H.dtype).reshape(A)}any(b,k){o.X.assertAxesAreInnerMostDims("any",k,b.rank);let[A,j]=o.X.computeOutAndReduceShapes(b.shape,k),G=o.Lb.sizeFromShape(j),H=b.as2D(-1,G);return this.reduce(H,"any",H.dtype).reshape(A)}floorDiv(b,k){if(Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(b,k,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");let A=new Ps(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,b.shape,k.shape);return this.compileAndRun(A,[b,k],"int32")}packedUnaryOp(b,k,A){let j=new lp(b.shape,k);return this.compileAndRun(j,[b],A)}packedBinaryOp(b,k,A,j,G=!1){let H=new ni(A,b.shape,k.shape,G);return this.compileAndRun(H,[b,k],j)}makeComplexComponentTensorInfo(b,k){return{dataId:k.dataId,dtype:k.dtype,shape:b.shape}}addN(b){if(b.length===1)return b[0];if(b.length>Object(o.jb)().get("WEBGL_MAX_TEXTURES_IN_SHADER")){let G=Math.floor(b.length/2),H=this.addN(b.slice(0,G)),re=this.addN(b.slice(G));return this.addN([H,re])}let k=b.map(G=>G.dtype).reduce((G,H)=>Object(o.Kb)(G,H)),A=b.map(G=>G.shape),j=Object(o.jb)().getBool("WEBGL_PACK")?new xt(b[0].shape,A):new Oo(b[0].shape,A);return this.compileAndRun(j,b,k)}pow(b,k){let A=Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ni(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,b.shape,k.shape):new Ps(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,b.shape,k.shape),j=Object(o.Kb)(b.dtype,k.dtype);return this.compileAndRun(A,[b,k],j)}ceil(b){if(this.shouldExecuteOnCPU([b])){let A=vc(this.texData.get(b.dataId).values,b.dtype);return this.makeOutput(b.shape,b.dtype,A)}if(Object(o.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(b,ip,b.dtype);let k=new Fr(b.shape,ip);return this.compileAndRun(k,[b])}floor(b){if(this.shouldExecuteOnCPU([b])){let A=wc(this.texData.get(b.dataId).values,b.dtype);return this.makeOutput(b.shape,b.dtype,A)}if(Object(o.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(b,wy,b.dtype);let k=new Fr(b.shape,wy);return this.compileAndRun(k,[b])}sign(b){let k=new Fr(b.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(k,[b])}isNaN(b){let k=new Fr(b.shape,"return float(isnan(x));");return this.compileAndRun(k,[b],"bool")}isInf(b){let k=new Fr(b.shape,"return float(isinf(x));");return this.compileAndRun(k,[b],"bool")}isFinite(b){let k=new Fr(b.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(k,[b],"bool")}round(b){let k=new Fr(b.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(k,[b])}exp(b){if(this.shouldExecuteOnCPU([b])){let A=eu(this.texData.get(b.dataId).values,b.dtype);return this.makeOutput(b.shape,b.dtype,A)}if(Object(o.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(b,mf,b.dtype);let k=new Fr(b.shape,mf);return this.compileAndRun(k,[b])}expm1(b){if(this.shouldExecuteOnCPU([b])){let A=ds(this.texData.get(b.dataId).values,b.dtype);return this.makeOutput(b.shape,b.dtype,A)}if(Object(o.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(b,Tc,b.dtype);let k=new Fr(b.shape,Tc);return this.compileAndRun(k,[b])}softmax(b,k){let A=o.Lb.parseAxisParam([k],b.shape),j=Object(o.nb)(b,A),G=o.X.expandShapeToKeepDim(j.shape,A),H=o.Eb(b,j.reshape(G)),re=this.exp(H),ie=this.sum(re,A).reshape(G);return Object(o.hb)(re,ie)}log(b){if(this.shouldExecuteOnCPU([b])){let A=ku(this.texData.get(b.dataId).values,b.dtype);return this.makeOutput(b.shape,b.dtype,A)}if(Object(o.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(b,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,b.dtype);let k=new Fr(b.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(k,[b])}log1p(b){let k=new Fr(b.shape,"return log(1.0 + x);");return this.compileAndRun(k,[b])}sqrt(b){let k=new Fr(b.shape,"return sqrt(x);");return this.compileAndRun(k,[b])}rsqrt(b){if(this.shouldExecuteOnCPU([b])){let A=Hs(this.texData.get(b.dataId).values,b.dtype);return this.makeOutput(b.shape,b.dtype,A)}let k=new Fr(b.shape,"return inversesqrt(x);");return this.compileAndRun(k,[b])}reciprocal(b){let k=new Fr(b.shape,"return 1.0 / x;");return this.compileAndRun(k,[b])}relu(b){let k;return k=Object(o.jb)().getBool("WEBGL_PACK")?new lp(b.shape,up):new Fr(b.shape,Ou),this.compileAndRun(k,[b])}relu6(b){let k;return k=Object(o.jb)().getBool("WEBGL_PACK")?new lp(b.shape,cp):new Fr(b.shape,$s),this.compileAndRun(k,[b])}prelu(b,k){let A=Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ni(qi,b.shape,k.shape):new Ps(Ui,b.shape,k.shape);return this.compileAndRun(A,[b,k])}elu(b){if(Object(o.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(b,Ru,b.dtype);let k=new Fr(b.shape,vy);return this.compileAndRun(k,[b])}eluDer(b,k){let A=Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ni(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,b.shape,k.shape):new Ps("return (b >= 1.0) ? a : a * (b + 1.0);",b.shape,k.shape);return this.compileAndRun(A,[b,k])}selu(b){let k=new Fr(b.shape,Wi);return this.compileAndRun(k,[b])}clip(b,k,A){let j;j=Object(o.jb)().getBool("WEBGL_PACK_CLIP")?new ms(b.shape):new Aa(b.shape);let G=j.getCustomSetupFunc(k,A);return this.compileAndRun(j,[b],null,G)}abs(b){if(this.shouldExecuteOnCPU([b])&&b.dtype!=="complex64"){let A=aa(this.texData.get(b.dataId).values);return this.makeOutput(b.shape,b.dtype,A)}if(Object(o.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(b,eb,b.dtype);let k=new Fr(b.shape,eb);return this.compileAndRun(k,[b])}complexAbs(b){let k=this.texData.get(b.dataId),A=new eh(b.shape),j=[this.makeComplexComponentTensorInfo(b,k.complexTensorInfos.real),this.makeComplexComponentTensorInfo(b,k.complexTensorInfos.imag)];return this.compileAndRun(A,j)}sigmoid(b){let k=new Fr(b.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(k,[b])}softplus(b){let k=new Fr(b.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(k,[b])}asin(b){let k=new Fr(b.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`);return this.compileAndRun(k,[b])}acos(b){let k=new Fr(b.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`);return this.compileAndRun(k,[b])}atan(b){let k=new Fr(b.shape,`if (isnan(x)) return x;
  return atan(x);
`);return this.compileAndRun(k,[b])}sinh(b){let k=new Fr(b.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(k,[b])}cosh(b){let k=new Fr(b.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(k,[b])}tanh(b){let k=new Fr(b.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(k,[b])}asinh(b){let k=new Fr(b.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(k,[b])}acosh(b){let k=new Fr(b.shape,`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`);return this.compileAndRun(k,[b])}atanh(b){let k=new Fr(b.shape,`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`);return this.compileAndRun(k,[b])}erf(b){let k=new Fr(b.shape,Cg);return this.compileAndRun(k,[b])}step(b,k){let A=new Fr(b.shape,function(j=0){return`if (isnan(x)) return x;
    return x > 0.0 ? 1.0 : float(${j});
  `}(k));return this.compileAndRun(A,[b])}conv2dByMatMul(b,k,A,j,G,H){let re=b.shape,ie=this.texData.get(b.dataId),me=A.inChannels,_e=re[0]*re[1]*re[2],Ue=A.outChannels,Be=A.dataFormat==="channelsLast",Ye=(_e===1||Ue===1)&&me>1e3,He=re[2]%2!=0&&!!ie.isPacked;if(Ye||!Object(o.jb)().getBool("WEBGL_LAZILY_UNPACK")||!Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!He){let Bt=Be?re[0]*re[1]*re[2]:re[0]*re[2]*re[3],wt=Object(o.xb)(b,[1,Bt,A.inChannels]),In=Object(o.xb)(k,[1,A.inChannels,A.outChannels]),Ut=this.fusedBatchMatMul({a:wt,b:In,transposeA:!1,transposeB:!1,bias:j,activation:G,preluActivationWeights:H});return Object(o.xb)(Ut,A.outShape)}let Ke=Be?re[0]*re[1]*(re[2]+1):re[0]*re[2]*(re[3]+1),Je={dataId:b.dataId,shape:[1,Ke,A.inChannels],dtype:b.dtype},Nt=ie.shape;ie.shape=ie.shape.slice(),ie.shape[ie.shape.length-2]++,o.Lb.assert(pe(ie.shape,Je.shape),()=>`packed reshape ${ie.shape} to ${Je.shape} isn't free`);let Jt=Object(o.xb)(k,[1,A.inChannels,A.outChannels]),on=this.fusedBatchMatMul({a:Je,b:Jt,transposeA:!1,transposeB:!1,bias:j,activation:G,preluActivationWeights:H}),dt=this.texData.get(on.dataId);return o.Lb.assert(dt.isPacked,()=>"batchMatMul result is expected to be packed"),ie.shape=Nt,dt.shape=A.outShape,Object(o.ib)().makeTensorFromDataId(on.dataId,A.outShape,on.dtype)}conv2dWithIm2Row(b,k,A,j,G,H){let{filterWidth:re,filterHeight:ie,inChannels:me,outWidth:_e,outHeight:Ue,dataFormat:Be}=A,Ye=Be==="channelsLast",He=re*ie*me,Ke=Ue*_e,Je=[He,Ke],Nt=b.squeeze([0]),Jt=k.reshape([1,He,-1]),on=new rh(Je,Nt.shape,A),dt=this.compileAndRun(on,[Nt]).reshape([1,Je[0],Je[1]]),Bt=j!=null,wt=H!=null,In=G?Ig(G,!0):null,Ut=new tu(dt.shape,Jt.shape,[1,Ke,A.outChannels],!0,!1,Bt,In,wt),kt=[dt,Jt];j&&kt.push(j),wt&&kt.push(H);let cr=this.compileAndRun(Ut,kt);return Ye?cr.reshape([1,Ue,_e,A.outChannels]):cr.reshape([1,A.outChannels,Ue,_e])}fusedConv2d({input:b,filter:k,convInfo:A,bias:j,activation:G,preluActivationWeights:H}){if(A.filterHeight===1&&A.filterWidth===1&&A.dilationHeight===1&&A.dilationWidth===1&&A.strideHeight===1&&A.strideWidth===1&&(A.padInfo.type==="SAME"||A.padInfo.type==="VALID"))return this.conv2dByMatMul(b,k,A,j,G,H);if(Object(o.jb)().getBool("WEBGL_CONV_IM2COL")&&b.shape[0]===1)return this.conv2dWithIm2Row(b,k,A,j,G,H);let re=j!=null,ie=H!=null,me=G?Ig(G,!1):null,_e=new rn(A,re,me,ie),Ue=[b,k];return j&&Ue.push(j),H&&Ue.push(H),this.compileAndRun(_e,Ue)}conv2d(b,k,A){if(A.filterHeight===1&&A.filterWidth===1&&A.dilationHeight===1&&A.dilationWidth===1&&A.strideHeight===1&&A.strideWidth===1&&(A.padInfo.type==="SAME"||A.padInfo.type==="VALID"))return this.conv2dByMatMul(b,k,A);if(Object(o.jb)().getBool("WEBGL_CONV_IM2COL")&&b.shape[0]===1)return this.conv2dWithIm2Row(b,k,A);let j=new rn(A);return this.compileAndRun(j,[b,k])}conv2dDerInput(b,k,A){let j=new gg(A);return this.compileAndRun(j,[b,k])}conv2dDerFilter(b,k,A){let j=new ul(A);return this.compileAndRun(j,[b,k])}fusedDepthwiseConv2D({input:b,filter:k,convInfo:A,bias:j,activation:G,preluActivationWeights:H}){let re=Object(o.jb)().getBool("WEBGL_PACK_DEPTHWISECONV")&&A.strideWidth<=2&&A.outChannels/A.inChannels==1,ie=G?Ig(G,re):null,me=[b,k],_e=j!=null,Ue=H!=null,Be;return _e&&me.push(j),Ue&&me.push(H),re?(Be=new xg(A,_e,ie,Ue),this.compileAndRun(Be,me)):(Be=new Yu(A,_e,ie,Ue),this.compileAndRun(Be,me))}depthwiseConv2D(b,k,A){let j;return Object(o.jb)().getBool("WEBGL_PACK_DEPTHWISECONV")&&A.strideWidth<=2&&A.outChannels/A.inChannels==1?(j=new xg(A),this.compileAndRun(j,[b,k])):(j=new Yu(A),this.compileAndRun(j,[b,k]))}depthwiseConv2DDerInput(b,k,A){let j=new lf(A);return this.compileAndRun(j,[b,k])}depthwiseConv2DDerFilter(b,k,A){let j=new ua(A);return this.compileAndRun(j,[b,k])}conv3d(b,k,A){let j=new yg(A);return this.compileAndRun(j,[b,k])}conv3dDerInput(b,k,A){let j=new jo(A);return this.compileAndRun(j,[b,k])}conv3dDerFilter(b,k,A){let j=new qr(A);return this.compileAndRun(j,[b,k])}unstack(b,k){let A=b.shape[k],j=new Array(b.rank-1),G=0;for(let me=0;me<b.rank;me++)me!==k&&(j[G++]=b.shape[me]);let H=new Array(b.rank).fill(0),re=b.shape.slice();re[k]=1;let ie=new Array(A);for(let me=0;me<ie.length;me++)H[k]=me,ie[me]=this.slice(b,H,re).reshape(j);return ie}avgPool3d(b,k){let A=new Au(k,"avg",!1);return this.compileAndRun(A,[b],"float32")}avgPool3dBackprop(b,k,A){let j=new mg(A);return this.compileAndRun(j,[b],k.dtype)}maxPool3d(b,k){let A=new Au(k,"max",!1);return this.compileAndRun(A,[b],"float32")}maxPool3dBackprop(b,k,A,j){let G=new Au(j,"max",!0),H=this.compileAndRun(G,[k]),re=new Ic(j),ie=this.compileAndRun(re,[b,H],k.dtype);return H.dispose(),ie}resizeBilinear(b,k,A,j){let G=Object(o.jb)().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new K2(b.shape,k,A,j):new cl(b.shape,k,A,j);return this.compileAndRun(G,[b],"float32")}resizeBilinearBackprop(b,k,A){let j=new Yx(b,k,A);return this.compileAndRun(j,[b])}resizeNearestNeighbor(b,k,A,j){let G=new sh(b.shape,k,A,j);return this.compileAndRun(G,[b])}resizeNearestNeighborBackprop(b,k,A){let j=new oh(b,k,A);return this.compileAndRun(j,[b])}multinomial(b,k,A,j){let G=k?b:Object(o.Bb)(b),H=G.shape[0],re=G.shape[1],ie=new yy(H,re,A),me=ie.getCustomSetupFunc(j);return this.compileAndRun(ie,[G],"int32",me)}oneHot(b,k,A,j){let G=new Du(b.size,k,A,j);return this.compileAndRun(G,[b])}diag(b){let k=new yr(b.size);return this.compileAndRun(k,[b])}cropAndResize(b,k,A,j,G,H){let re=new ca(b.shape,k.shape,j,G,H);return this.compileAndRun(re,[b,k,A],"float32")}depthToSpace(b,k,A){o.Lb.assert(k>1,()=>"blockSize should be > 1 for depthToSpace, but was: "+k);let j=b.shape[0],G=A==="NHWC"?b.shape[1]:b.shape[2],H=A==="NHWC"?b.shape[2]:b.shape[3],re=A==="NHWC"?b.shape[3]:b.shape[1],ie=G*k,me=H*k,_e=re/(k*k),Ue=new Cs(A==="NHWC"?[j,ie,me,_e]:[j,_e,ie,me],k,A);return this.compileAndRun(Ue,[b])}split(b,k,A){return X2(b,k,A)}scatterND(b,k,A){let{sliceRank:j,numUpdates:G,sliceSize:H,strides:re,outputSize:ie}=o.X.calculateShapes(k,b,A),me=[ie/H,H],_e=b.reshape([G,j]),Ue=k.reshape([G,H]);if(ie===0)return o.X.reshapeTensor(Object(o.Gb)([]),A);let Be=Object(o.yb)(0),Ye=new nu(G,j,_e.rank,Ue.rank,re,me);return this.compileAndRun(Ye,[Ue,_e,Be]).reshape(A)}sparseToDense(b,k,A,j){let{sliceRank:G,numUpdates:H,strides:re,outputSize:ie}=o.X.calculateShapes(k,b,A),me=new nu(H,G,b.rank,k.rank,re,[ie,1],!1);return this.compileAndRun(me,[k,b,j]).reshape(A)}gatherND(b,k){let A=k.shape,j=A[A.length-1],[G,H,re,ie]=o.X.prepareAndValidate(b,k),me=k.reshape([H,j]),_e=b.reshape([b.size/re,re]),Ue=new Gi(j,ie,[H,re]);return this.compileAndRun(Ue,[_e,me]).reshape(G)}fill(b,k,A){if((A=A||o.Lb.inferDtype(k))==="string"){let j=o.Lb.getArrayFromDType(A,o.Lb.sizeFromShape(b));return j.fill(k),Object(o.ib)().makeTensor(j,b,A,this)}{let j=new th(b,k),G=j.getCustomSetupFunc(k);return this.compileAndRun(j,[],A,G)}}onesLike(b){if(b.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(b.shape,1,b.dtype)}zerosLike(b){return this.fill(b.shape,b.dtype==="string"?"":0,b.dtype)}linspace(b,k,A){return o.X.linspaceImpl(b,k,A)}makeTensorInfo(b,k,A){let j=this.write(A,b,k);return this.texData.get(j).usage=null,{dataId:j,shape:b,dtype:k}}makeOutput(b,k,A){let{dataId:j}=this.makeTensorInfo(b,k,A);return Object(o.ib)().makeTensorFromDataId(j,b,k,this)}unpackTensor(b){let k=new tb(b.shape);return this.runWebGLProgram(k,[b],b.dtype)}packTensor(b){let k=new Kx(b.shape);return this.runWebGLProgram(k,[b],b.dtype,null,!0)}packedReshape(b,k){let A=[ee(b.shape),...Q(b.shape)],j={dtype:b.dtype,shape:A,dataId:b.dataId},G=[ee(k),...Q(k)],H=new _c(G,A),re=this.runWebGLProgram(H,[j],b.dtype,null,!0);return{dataId:re.dataId,shape:k,dtype:re.dtype}}decode(b){let k=this.texData.get(b),{isPacked:A,shape:j,dtype:G}=k,H=oe(j),re;return re=A?new Oa(H):new Cc(H),{dtype:G,shape:j,dataId:this.runWebGLProgram(re,[{shape:H,dtype:G,dataId:b}],G,null,!0).dataId}}runWebGLProgram(b,k,A,j,G=!1){let H=this.makeTensorInfo(b.outputShape,A),re=this.texData.get(H.dataId);if(b.packedOutput&&(re.isPacked=!0),b.outPackingScheme===u.DENSE){let Ke=g(b.outputShape);re.texShape=Ke.map(Je=>2*Je)}if(b.outTexUsage!=null&&(re.usage=b.outTexUsage),o.Lb.sizeFromShape(H.shape)===0)return re.values=o.Lb.getTypedArrayFromDType(H.dtype,0),H;let ie=[],me=k.map(Ke=>{if(Ke.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let Je=this.texData.get(Ke.dataId);if(Je.texture==null){if(!b.packedInputs&&o.Lb.sizeFromShape(Ke.shape)<=Object(o.jb)().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:Ke.shape,texData:null,isUniform:!0,uniformValues:Je.values};b.packedInputs&&(Je.isPacked=!0,Je.shape=Ke.shape)}else if(!!Je.isPacked!=!!b.packedInputs)Ke=Je.isPacked?this.unpackTensor(Ke):this.packTensor(Ke),ie.push(Ke),Je=this.texData.get(Ke.dataId);else if(Je.isPacked&&!pe(Je.shape,Ke.shape)){let Nt=Ke,Jt=Ke.shape;Ke.shape=Je.shape,Ke=this.packedReshape(Ke,Jt),ie.push(Ke),Je=this.texData.get(Ke.dataId),Nt.shape=Jt}return this.uploadToGPU(Ke.dataId),{shape:Ke.shape,texData:Je,isUniform:!1}});this.uploadToGPU(H.dataId);let _e={shape:H.shape,texData:re,isUniform:!1},Ue=function(Ke,Je,Nt){let Jt="";Je.concat(Nt).forEach(Bt=>{let wt=Bt.texData!=null&&Bt.texData.slice!=null&&Bt.texData.slice.flatOffset>0,In=Bt.isUniform?"uniform":Bt.texData.texShape;Jt+=`${Bt.shape}_${In}_${wt}`});let on=Ke.userCode,dt=Ke.constructor.name;return dt+="_"+Jt+"_"+on,dt}(b,me,_e),Be=this.getAndSaveBinary(Ue,()=>function(Ke,Je,Nt,Jt){let on=Je.userCode,dt=Nt.map((kr,Kr)=>{let mn={logicalShape:kr.shape,texShape:kr.isUniform?null:kr.texData.texShape,isUniform:kr.isUniform,isPacked:!kr.isUniform&&kr.texData.isPacked,flatOffset:null};return kr.texData!=null&&kr.texData.slice!=null&&kr.texData.slice.flatOffset>0&&(mn.flatOffset=kr.texData.slice.flatOffset),{name:Je.variableNames[Kr],shapeInfo:mn}}),Bt=dt.map(kr=>kr.shapeInfo),wt={logicalShape:Jt.shape,texShape:Jt.texData.texShape,isUniform:!1,isPacked:Jt.texData.isPacked,flatOffset:null},In=Pe(dt,wt,on,Je.packedInputs),Ut=Ke.createProgram(In),kt=null,cr=Ke.getUniformLocation(Ut,"NAN",!1);Object(o.jb)().getNumber("WEBGL_VERSION")===1&&(kt=Ke.getUniformLocation(Ut,"INFINITY",!1));let er={};for(let kr=0;kr<Je.variableNames.length;kr++){let Kr=Je.variableNames[kr],mn=!1;er[Kr]=Ke.getUniformLocation(Ut,Kr,mn),er["offset"+Kr]=Ke.getUniformLocation(Ut,"offset"+Kr,mn)}return{program:Je,source:In,webGLProgram:Ut,uniformLocations:er,inShapeInfos:Bt,outShapeInfo:wt,infLoc:kt,nanLoc:cr}}(this.gpgpu,b,me,_e)),Ye=this.activeTimers!=null,He;if(Ye&&(He=this.startTimer()),function(Ke,Je,Nt,Jt,on){nh(Je.inShapeInfos,Nt),nh([Je.outShapeInfo],[Jt]);let dt=Jt.texData.texture,Bt=Jt.texData.texShape;Jt.texData.isPacked?Ke.setOutputPackedMatrixTexture(dt,Bt[0],Bt[1]):Ke.setOutputMatrixTexture(dt,Bt[0],Bt[1]),Ke.setProgram(Je.webGLProgram),Object(o.jb)().getNumber("WEBGL_VERSION")===1&&Je.infLoc!==null&&Ke.gl.uniform1f(Je.infLoc,1/0),Je.nanLoc!==null&&Ke.gl.uniform1f(Je.nanLoc,NaN),Nt.forEach((wt,In)=>{let Ut=Je.program.variableNames[In],kt=Je.uniformLocations[Ut],cr=Je.uniformLocations["offset"+Ut];if(kt!=null)if(wt.isUniform)if(o.Lb.sizeFromShape(wt.shape)<2)Ke.gl.uniform1f(kt,wt.uniformValues[0]);else{let er=wt.uniformValues;er instanceof Float32Array||(er=new Float32Array(er)),Ke.gl.uniform1fv(kt,er)}else wt.texData.slice!=null&&cr!=null&&Ke.gl.uniform1i(cr,wt.texData.slice.flatOffset),Ke.setInputMatrixTexture(wt.texData.texture,kt,In)}),on?.(Ke,Je.webGLProgram),Ke.executeProgram()}(this.gpgpu,Be,me,_e,j),ie.forEach(Ke=>this.disposeIntermediateTensorInfo(Ke)),Ye&&(He=this.endTimer(He),this.activeTimers.push({name:b.constructor.name,query:this.getQueryTime(He)})),!Object(o.jb)().getBool("WEBGL_LAZILY_UNPACK")&&re.isPacked&&G===!1){let Ke=this.unpackTensor(H);return this.disposeIntermediateTensorInfo(H),Ke}return H}compileAndRun(b,k,A,j,G=!1){A=A||k[0].dtype;let H=this.runWebGLProgram(b,k,A,j,G);return Object(o.ib)().makeTensorFromDataId(H.dataId,H.shape,H.dtype)}getAndSaveBinary(b,k){return b in this.binaryCache||(this.binaryCache[b]=k()),this.binaryCache[b]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Object(o.jb)().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(b=>{this.gpgpu.deleteProgram(this.binaryCache[b].webGLProgram),delete this.binaryCache[b]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Object(o.Hb)(()=>{if(!Object(o.jb)().get("WEBGL_RENDER_FLOAT32_ENABLED")){let b=Object(o.jb)().getBool("DEBUG");Object(o.jb)().set("DEBUG",!1);let k=this.abs(Object(o.yb)(1e-8)).dataSync()[0];if(Object(o.jb)().set("DEBUG",b),k>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}uploadToGPU(b){let k=this.texData.get(b),{shape:A,dtype:j,values:G,texture:H,usage:re,isPacked:ie}=k;if(H!=null)return;let me=this.activeTimers!=null,_e;me&&(_e=o.Lb.now());let Ue=k.texShape;if(Ue==null&&(Ue=function(Be,Ye=!1){let He=Object(o.jb)().getNumber("WEBGL_MAX_TEXTURE_SIZE");Ye&&(He*=2,(Be=Be.map((Je,Nt)=>Nt>=Be.length-2?o.Lb.nearestLargerEven(Be[Nt]):Be[Nt])).length===1&&(Be=[2,Be[0]])),Be.length!==2&&(Be=o.Lb.squeezeShape(Be).newShape);let Ke=o.Lb.sizeFromShape(Be);if(Be.length<=1&&Ke<=He)return[1,Ke];if(Be.length===2&&Be[0]<=He&&Be[1]<=He)return Be;if(Be.length===3&&Be[0]*Be[1]<=He&&Be[2]<=He)return[Be[0]*Be[1],Be[2]];if(Be.length===3&&Be[0]<=He&&Be[1]*Be[2]<=He)return[Be[0],Be[1]*Be[2]];if(Be.length===4&&Be[0]*Be[1]*Be[2]<=He&&Be[3]<=He)return[Be[0]*Be[1]*Be[2],Be[3]];if(Be.length===4&&Be[0]<=He&&Be[1]*Be[2]*Be[3]<=He)return[Be[0],Be[1]*Be[2]*Be[3]];if(Ye){let Je=ee(Be),Nt=2,Jt=2;return Be.length&&([Nt,Jt]=Q(Be)),Ke=Je*(Nt/2)*(Jt/2),o.Lb.sizeToSquarishShape(Ke).map(on=>2*on)}return o.Lb.sizeToSquarishShape(Ke)}(A,ie),k.texShape=Ue),G!=null){let Be=oe(A),Ye,He=Ue[1],Ke=Ue[0],Je=G instanceof Uint8Array;ie?([He,Ke]=d(Ue[0],Ue[1]),Ye=new Gr(Be,[Ke,He],Je)):Ye=new Is(Be,[Ke,He],Je);let Nt=this.makeTensorInfo([Ke,He],j);this.texData.get(Nt.dataId).usage=Je?c.PIXELS:c.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(Nt.dataId),He,Ke,G);let Jt=!0,on=this.runWebGLProgram(Ye,[Nt],j,null,Jt),dt=this.texData.get(on.dataId);k.texture=dt.texture,k.texShape=dt.texShape,k.isPacked=dt.isPacked,k.usage=dt.usage,this.disposeIntermediateTensorInfo(Nt),this.texData.delete(on.dataId),k.values=null,me&&(this.uploadWaitMs+=o.Lb.now()-_e)}else{let Be=this.acquireTexture(Ue,re,j,ie);k.texture=Be}}convertAndCacheOnCPU(b,k){let A=this.texData.get(b),{dtype:j}=A;return this.releaseGPUData(b),k!=null&&(A.values=function(G,H){if(H==="float32"||H==="complex64")return G;if(H==="int32"||H==="bool"){let re=H==="int32"?new Int32Array(G.length):new Uint8Array(G.length);for(let ie=0;ie<re.length;++ie)re[ie]=Math.round(G[ie]);return re}throw new Error("Unknown dtype "+H)}(k,j)),A.values}acquireTexture(b,k,A,j){if(this.numBytesInGPU+=this.computeBytes(b,A),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){let G=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${G} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(b,k,j)}computeBytes(b,k){return b[0]*b[1]*o.Lb.bytesPerElement(k)}tryRunOnCpuOrThrow(b,k){if(this.shouldExecuteOnCPU(b))try{return k()}catch{if(Object(o.jb)().getBool("IS_TEST"))throw new Error("CPU forwarding failed")}return null}}o.fb.isBrowser()&&Object(o.vb)("webgl",()=>new Y2,2);function Ec(te){let{inputs:b,backend:k}=te,{x:A}=b;return k.incRef(A.dataId),{dataId:A.dataId,shape:A.shape,dtype:A.dtype}}let ob={kernelName:o.u,backendName:"webgl",kernelFunc:Ec};function tc(te){let{inputs:b,backend:k}=te,{real:A,imag:j}=b,G=k.makeTensorInfo(A.shape,"complex64"),H=k.texData.get(G.dataId),re=Ec({inputs:{x:A},backend:k});k.texData.get(re.dataId).complexParentRefCount++;let ie=Ec({inputs:{x:j},backend:k});return k.texData.get(ie.dataId).complexParentRefCount++,H.complexTensorInfos={real:re,imag:ie},G}let sb={kernelName:o.h,backendName:"webgl",kernelFunc:tc};function _g(te){return({inputs:b,backend:k})=>{let{x:A}=b,j=k,G=new Fr(A.shape,te);return j.runWebGLProgram(G,[A],A.dtype)}}function ah({opSnippet:te,packedOpSnippet:b,checkOutOfBounds:k=!1,supportsComplex:A=!1,cpuKernelImpl:j,dtype:G}){return({inputs:H,backend:re})=>{let{a:ie,b:me}=H,_e=re;if(A&&ie.dtype==="complex64"){let Ye=_e.texData.get(ie.dataId),He=_e.texData.get(me.dataId),[Ke,Je]=[[Ye.complexTensorInfos.real,He.complexTensorInfos.real],[Ye.complexTensorInfos.imag,He.complexTensorInfos.imag]].map(Jt=>{let[on,dt]=Jt,Bt={dataId:on.dataId,dtype:on.dtype,shape:ie.shape},wt={dataId:dt.dataId,dtype:dt.dtype,shape:me.shape},In=new Ps(te,ie.shape,me.shape);return _e.runWebGLProgram(In,[Bt,wt],Object(o.Kb)(on.dtype,dt.dtype))}),Nt=tc({inputs:{real:Ke,imag:Je},backend:_e});return _e.disposeIntermediateTensorInfo(Ke),_e.disposeIntermediateTensorInfo(Je),Nt}let Ue=G||Object(o.Kb)(ie.dtype,me.dtype);if(_e.shouldExecuteOnCPU([ie,me])&&j!=null){let Ye=_e.texData.get(ie.dataId),He=_e.texData.get(me.dataId),[Ke,Je]=j(ie.shape,me.shape,Ye.values,He.values,Ue),Nt=_e.makeTensorInfo(Je,Ue);return _e.texData.get(Nt.dataId).values=Ke,Nt}let Be;return Be=Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&b!=null?new ni(b,ie.shape,me.shape,k):new Ps(te,ie.shape,me.shape),_e.runWebGLProgram(Be,[ie,me],Ue)}}let ib="return a + b;",Q2=ah({opSnippet:ib,packedOpSnippet:ib,supportsComplex:!0,cpuKernelImpl:Nu}),ab={kernelName:o.b,backendName:"webgl",kernelFunc:Q2},Z2=ah({opSnippet:`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,packedOpSnippet:`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`}),J2={kernelName:o.c,backendName:"webgl",kernelFunc:Z2},ub={kernelName:o.d,backendName:"webgl",kernelFunc:function(te){let{inputs:b,backend:k,attrs:A}=te,{x:j}=b;qe(j,"avgPool");let{filterSize:G,strides:H,pad:re,dimRoundingMode:ie}=A;o.Lb.assert(o.X.eitherStridesOrDilationsAreOne(H,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${H} and dilations '1'`);let me=o.X.computePool2DInfo(j.shape,G,H,1,re,ie);if(me.filterWidth===1&&me.filterHeight===1&&o.Lb.arraysEqual(me.inShape,me.outShape))return Ec({inputs:{x:j},backend:k});let _e=new ff(me,"avg",!1);return k.runWebGLProgram(_e,[j],"float32")}};let eS={kernelName:o.e,backendName:"webgl",kernelFunc:function(te){let{inputs:b,backend:k,attrs:A}=te,{dy:j,input:G}=b,H=G;qe([j,G],"avgPoolBackprop");let{filterSize:re,strides:ie,pad:me}=A,_e=o.X.computePool2DInfo(H.shape,re,ie,1,me),Ue=new fg(_e);return k.runWebGLProgram(Ue,[j],H.dtype)}};class tS{constructor(b,k,A,j,G,H){this.outputShape=[],this.variableNames=["x","mean","variance"],o.X.assertAndGetBroadcastShape(b,k),o.X.assertAndGetBroadcastShape(b,A);let re="0.0";j!=null&&(o.X.assertAndGetBroadcastShape(b,j),this.variableNames.push("offset"),re="getOffsetAtOutCoords()");let ie="1.0";G!=null&&(o.X.assertAndGetBroadcastShape(b,G),this.variableNames.push("scale"),ie="getScaleAtOutCoords()"),this.outputShape=b,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${re};
        float scale = ${ie};
        float inv = scale * inversesqrt(variance + float(${H}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}class cb{constructor(b,k,A,j,G,H){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],o.X.assertAndGetBroadcastShape(b,k),o.X.assertAndGetBroadcastShape(b,A);let re="vec4(0.0)";j!=null&&(o.X.assertAndGetBroadcastShape(b,j),this.variableNames.push("offset"),re="getOffsetAtOutCoords()");let ie="vec4(1.0)";G!=null&&(o.X.assertAndGetBroadcastShape(b,G),this.variableNames.push("scale"),ie="getScaleAtOutCoords()"),this.outputShape=b,this.userCode=`
      void main() {
        vec4 offset = ${re};
        vec4 scale = ${ie};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${H}));

        setOutput((x - mean) * inv + offset);
      }
    `}}let Tg={kernelName:o.s,backendName:"webgl",kernelFunc:({inputs:te,backend:b,attrs:k})=>{let{x:A,mean:j,variance:G,offset:H,scale:re}=te;o.Lb.assert(j.shape.length===G.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),o.Lb.assert(H==null||j.shape.length===H.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),o.Lb.assert(re==null||j.shape.length===re.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:ie}=k;ie==null&&(ie=.001);let me=[A,j,G],_e=null;H!=null&&(_e=H.shape,me.push(H));let Ue=null;re!=null&&(Ue=re.shape,me.push(re));let Be=Object(o.jb)().getBool("WEBGL_PACK_NORMALIZATION")?new cb(A.shape,j.shape,G.shape,_e,Ue,ie):new tS(A.shape,j.shape,G.shape,_e,Ue,ie);return b.runWebGLProgram(Be,me,me[0].dtype)}},lb=ah({opSnippet:"return float(a != b);",dtype:"bool"}),pb={kernelName:o.I,backendName:"webgl",kernelFunc:lb};function Iy(te){let{inputs:b,backend:k}=te,{input:A}=b;return Ec({inputs:{x:k.texData.get(A.dataId).complexTensorInfos.real},backend:k})}let hb={kernelName:o.J,backendName:"webgl",kernelFunc:Iy};let db={kernelName:o.f,backendName:"webgl",kernelFunc:function te(b){let{inputs:k,backend:A,attrs:j}=b,{x:G}=k,{dtype:H}=j;if(H==="complex64"){if(G.dtype==="complex64")return Ec({inputs:{x:G},backend:A});let re=o.Nb(G.shape),ie=te({inputs:{x:G},backend:A,attrs:{dtype:"float32"}}),me=tc({inputs:{real:ie,imag:re},backend:A});return re.dispose(),A.disposeIntermediateTensorInfo(ie),me}if(G.dtype==="complex64"){let re=Iy({inputs:{input:G},backend:A}),ie=te({inputs:{x:re},backend:A,attrs:{dtype:H}});return A.disposeIntermediateTensorInfo(re),ie}if(!o.Lb.hasEncodingLoss(G.dtype,H)){let re=Ec({inputs:{x:G},backend:A});return{dataId:re.dataId,shape:re.shape,dtype:H}}if(H==="int32")return function(re,ie){let me=new Fr(re.shape,"return float(int(x));"),_e=ie.runWebGLProgram(me,[re],"int32");return{dataId:_e.dataId,shape:_e.shape,dtype:_e.dtype}}(G,A);if(H==="bool"){let re=A.makeTensorInfo([],"bool",o.Lb.getTypedArrayFromDType("bool",1)),ie=lb({inputs:{a:G,b:re},backend:A});return A.disposeIntermediateTensorInfo(re),ie}throw new Error(`Error in Cast: failed to cast ${G.dtype} to ${H}`)}};class nS{constructor(b){this.outputShape=[],this.outputShape=o.X.computeOutShape(b,1),this.variableNames=b.map((H,re)=>"T"+re);let k=new Array(b.length-1);k[0]=b[0][1];for(let H=1;H<k.length;H++)k[H]=k[H-1]+b[H][1];let A=[`if (yC < ${k[0]}) setOutput(getT0(yR, yC));`];for(let H=1;H<k.length;H++){let re=k[H-1];A.push(`else if (yC < ${k[H]}) setOutput(getT${H}(yR, yC-${re}));`)}let j=k.length,G=k[k.length-1];A.push(`else setOutput(getT${j}(yR, yC-${G}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${A.join(`
        `)}
      }
    `}}class rS{constructor(b,k){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=o.X.computeOutShape(b,k);let A=this.outputShape,j=A.length,G=Cn(j),H=Yt("coords",j),re=["x","y","z","w","u","v"].slice(0,j);this.variableNames=b.map((Ke,Je)=>"T"+Je);let ie=new Array(b.length-1);ie[0]=b[0][k];for(let Ke=1;Ke<ie.length;Ke++)ie[Ke]=ie[Ke-1]+b[Ke][k];let me=re[k],_e=re.slice(-2),Ue=re.join(),Be=`if (${me} < ${ie[0]}) {
        return getChannel(
            getT0(${Ue}), vec2(${_e.join()}));
        }`;for(let Ke=1;Ke<ie.length;Ke++){let Je=ie[Ke-1];Be+=`
        if (${me} < ${ie[Ke]}  && ${me} >= ${ie[Ke-1]}) {
          return getChannel(
            getT${Ke}(${Eg(re,me,Je)}),
            vec2(${Eg(_e,me,Je)}));
        }`}let Ye=ie.length,He=ie[ie.length-1];Be+=`
        return getChannel(
          getT${Ye}(${Eg(re,me,He)}),
          vec2(${Eg(_e,me,He)}));`,this.userCode=`
      float getValue(${re.map(Ke=>"int "+Ke)}) {
        ${Be}
      }

      void main() {
        ${G} coords = getOutputCoords();
        vec4 result = vec4(getValue(${H}), 0., 0., 0.);

        ${H[j-1]} = ${H[j-1]} + 1;
        if (${H[j-1]} < ${A[j-1]}) {
          result.g = getValue(${H});
        }

        ${H[j-2]} = ${H[j-2]} + 1;
        if (${H[j-2]} < ${A[j-2]}) {
          result.a = getValue(${H});
        }

        ${H[j-1]} = ${H[j-1]} - 1;
        if (${H[j-2]} < ${A[j-2]} &&
            ${H[j-1]} < ${A[j-1]}) {
          result.b = getValue(${H});
        }
        setOutput(result);
      }
    `}}function Eg(te,b,k){let A=te.indexOf(b);return te.map((j,G)=>G===A?`${j} - ${k}`:j).join()}function fb(te){let{inputs:b,backend:k}=te,{input:A}=b;return Ec({inputs:{x:k.texData.get(A.dataId).complexTensorInfos.imag},backend:k})}let oS={kernelName:o.v,backendName:"webgl",kernelFunc:fb};function Nc(te){let{inputs:b,backend:k,attrs:A}=te,{x:j}=b,{shape:G}=A,H=k,re=o.Lb.sizeFromShape(j.shape),ie=o.Lb.inferFromImplicitShape(G,re),me=o.Lb.sizeFromShape(ie);o.Lb.assert(re===me,()=>`The new shape (${ie}) has ${me} elements and the old shape (${j.shape}) has ${re} elements. The new shape and old shape must have the same number of elements.`);let _e=H.texData.get(j.dataId);return!_e.isPacked||pe(j.shape,ie)||_e.texture!==null&&pe(_e.shape,ie)?(H.incRef(j.dataId),{dataId:j.dataId,shape:ie,dtype:j.dtype}):function(Ue,Be,Ye){let He=[ee(Ue.shape),...Q(Ue.shape)],Ke={dtype:Ue.dtype,shape:He,dataId:Ue.dataId},Je=[ee(Be),...Q(Be)],Nt=new _c(Je,He),Jt=Ye.runWebGLProgram(Nt,[Ke],Ue.dtype,null,!0);return{dataId:Jt.dataId,shape:Be,dtype:Jt.dtype}}(j,ie,H)}let mb={kernelName:o.K,backendName:"webgl",kernelFunc:Nc};let sS={kernelName:o.i,backendName:"webgl",kernelFunc:function(te){let{inputs:b,backend:k,attrs:A}=te,{axis:j}=A,G=o.Lb.parseAxisParam(j,b[0].shape)[0],H=o.X.computeOutShape(b.map(me=>me.shape),G);if(o.Lb.sizeFromShape(H)===0)return k.makeTensorInfo(H,b[0].dtype,[]);let re=b.filter(me=>o.Lb.sizeFromShape(me.shape)>0);if(re.length===1)return re[0];let ie=re.map(me=>me.shape);return o.X.assertParamsConsistent(ie,G),function me(_e,Ue,Be){let Ye=_e[0].dtype;if(Ye==="complex64"){let on=_e.map(Ut=>Iy({inputs:{input:Ut},backend:Be})),dt=_e.map(Ut=>fb({inputs:{input:Ut},backend:Be})),Bt=me(on,Ue,Be),wt=me(dt,Ue,Be),In=tc({inputs:{real:Bt,imag:wt},backend:Be});return on.forEach(Ut=>Be.disposeIntermediateTensorInfo(Ut)),dt.forEach(Ut=>Be.disposeIntermediateTensorInfo(Ut)),Be.disposeIntermediateTensorInfo(Bt),Be.disposeIntermediateTensorInfo(wt),In}if(_e.length>Object(o.jb)().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let on=Math.floor(_e.length/2),dt=me(_e.slice(0,on),Ue,Be),Bt=me(_e.slice(on),Ue,Be),wt=me([dt,Bt],Ue,Be);return Be.disposeIntermediateTensorInfo(dt),Be.disposeIntermediateTensorInfo(Bt),wt}if(Object(o.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&_e[0].shape.length>1){let on=new rS(_e.map(dt=>dt.shape),Ue);return Be.runWebGLProgram(on,_e,Ye)}let He=o.X.computeOutShape(_e.map(on=>on.shape),Ue),Ke=_e.map(on=>Nc({inputs:{x:on},attrs:{shape:[-1,o.Lb.sizeFromShape(on.shape.slice(Ue))]},backend:Be})),Je=new nS(Ke.map(on=>on.shape)),Nt=Be.runWebGLProgram(Je,Ke,Ye);Ke.forEach(on=>Be.disposeIntermediateTensorInfo(on));let Jt=Nc({inputs:{x:Nt},attrs:{shape:He},backend:Be});return Be.disposeIntermediateTensorInfo(Nt),Jt}(re,G,k)}},iS=_g(`if (isnan(x)) return x;
  return cos(x);
`),aS={kernelName:o.j,backendName:"webgl",kernelFunc:iS},uS=ah({opSnippet:`
if (a == b) {
  return 1.0;
};
return a / b;`,packedOpSnippet:`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,checkOutOfBounds:!0}),cS={kernelName:o.l,backendName:"webgl",kernelFunc:uS};class gb{constructor(b,k,A){this.variableNames=["real","imag"];let j=k[1];this.outputShape=k;let G=A?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,H=A?j+".0":"1.0",re;if(b==="real")re="return real * expR - imag * expI;";else{if(b!=="imag")throw new Error(`FFT component must be either "real" or "imag", got ${b}.`);re="return real * expI + imag * expR;"}this.userCode=`
      const float exponentMultiplier = ${G};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${re}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${j});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${j}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${H};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}function _y(te,b,k){let A=k.texData.get(te.dataId),j=o.Lb.sizeFromShape(te.shape),G=te.shape[te.shape.length-1],H=Nc({inputs:{x:te},backend:k,attrs:{shape:[j/G,G]}}).shape,re=new gb("real",H,b),ie=new gb("imag",H,b),me=[{dataId:A.complexTensorInfos.real.dataId,dtype:A.complexTensorInfos.real.dtype,shape:H},{dataId:A.complexTensorInfos.imag.dataId,dtype:A.complexTensorInfos.imag.dtype,shape:H}],_e=k.runWebGLProgram(re,me,"float32"),Ue=k.runWebGLProgram(ie,me,"float32"),Be=tc({inputs:{real:_e,imag:Ue},backend:k});k.disposeIntermediateTensorInfo(_e),k.disposeIntermediateTensorInfo(Ue);let Ye=Nc({inputs:{x:Be},backend:k,attrs:{shape:te.shape}});return k.disposeIntermediateTensorInfo(Ye),Ye}let lS={kernelName:o.o,backendName:"webgl",kernelFunc:function(te){let{inputs:b,backend:k}=te,{input:A}=b;return _y(A,!1,k)}};class la{constructor(b){this.variableNames=["Image"],this.outputShape=[];let k=b[2];this.outputShape=b,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${k} - x;
          float outputValue;
          if(coordX >= 0 && coordX < ${k}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}let mr={kernelName:o.p,backendName:"webgl",kernelFunc:({inputs:te,backend:b})=>{let{image:k}=te,A=b,j=new la(k.shape);return A.runWebGLProgram(j,[k],k.dtype)}};class yb{constructor(b){this.variableNames=["A"];let k=Qt(),[A,j]=b;this.outputShape=b,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${j}.0, ${A}.0);

        vec4 values = ${k.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}class Ra{constructor(b){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let k=Qt(),[A,j]=b;this.outputShape=b,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${j}.0, ${A}.0);
            vec4 values = ${k.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${k.output} = result;
      }
    `}}let kc={kernelName:o.r,backendName:"webgl",kernelFunc:function(te){let{inputs:b,backend:k,attrs:A}=te,{pixels:j}=b,{numChannels:G}=A,H=typeof HTMLVideoElement<"u"&&j instanceof HTMLVideoElement,re=typeof HTMLImageElement<"u"&&j instanceof HTMLImageElement,[ie,me]=H?[j.videoWidth,j.videoHeight]:[j.width,j.height],_e=[me,ie],Ue=[me,ie,G];(re||H)&&(ll==null&&(ll=document.createElement("canvas").getContext("2d")),ll.canvas.width=ie,ll.canvas.height=me,ll.drawImage(j,0,0,ie,me),j=ll.canvas);let Be=k.makeTensorInfo(_e,"int32");k.texData.get(Be.dataId).usage=c.PIXELS,k.gpgpu.uploadPixelDataToTexture(k.getTexture(Be.dataId),j);let Ye=Object(o.jb)().getBool("WEBGL_PACK")?new Ra(Ue):new yb(Ue),He=k.runWebGLProgram(Ye,[Be],"int32");return k.disposeData(Be.dataId),He}},ll,vi={kernelName:o.t,backendName:"webgl",kernelFunc:function(te){let{inputs:b,backend:k}=te,{input:A}=b;return _y(A,!0,k)}};class Ma{constructor(b,k){this.variableNames=["x"];let{windowSize:A,batchSize:j,inSize:G,outSize:H}=b;this.outputShape=[j,H];let re=4*Math.floor(A/4),ie=A%4,me="sumValue += dot(values, ones);";if(k!=null){let Ue=1/k;me=`sumValue += dot(values * ${o.Lb.isInt(Ue)?Ue.toPrecision(2):Ue}, ones);`}let _e="";G%A>0&&(_e=`
        if (inIdx < 0 || inIdx >= ${G}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${_e}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${A};

        float sumValue = 0.0;

        for (int i = 0; i < ${re}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${me}
        }

        int inIdx = inOffset + ${re};
        if (${ie===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${me}
        } else if (${ie===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${me}
        } else if (${ie===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${me}
        }
        setOutput(sumValue);
      }
    `}}function uh(te,b,k,A){let j=function(H){let re=[];for(;re.length===0||re[re.length-1].outSize!==1;){let ie=re.length?re[re.length-1].outSize:H[1],me=o.X.computeOptimalWindowSize(ie);re.push({inSize:ie,windowSize:me,outSize:Math.ceil(ie/me)})}return re}(te.shape),G=te;for(let H=0;H<j.length;H++){let{inSize:re,windowSize:ie,outSize:me}=j[H],_e,Ue;_e=k==="mean"?H===0?new Ma({windowSize:ie,inSize:re,batchSize:te.shape[0],outSize:me},re):new Ma({windowSize:ie,inSize:re,batchSize:te.shape[0],outSize:me}):new Xx({windowSize:ie,inSize:re,batchSize:te.shape[0],outSize:me},k),Ue=G,G=A.runWebGLProgram(_e,[G],b),Ue.dataId!==te.dataId&&A.disposeIntermediateTensorInfo(Ue)}return G}class Pn{constructor(b,k){this.variableNames=["A"];let A=new Array(b.length);for(let H=0;H<A.length;H++)A[H]=b[k[H]];this.outputShape=A,this.rank=A.length;let j=Cn(this.rank),G=function(H){let re=H.length;if(re>6)throw Error(`Transpose for rank ${re} is not yet supported`);let ie=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],me=new Array(re);for(let _e=0;_e<H.length;_e++)me[H[_e]]=ie[_e];return me.join()}(k);this.userCode=`
    void main() {
      ${j} resRC = getOutputCoords();
      setOutput(getA(${G}));
    }
    `}}class wi{constructor(b,k){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let A=new Array(b.length);for(let _e=0;_e<A.length;_e++)A[_e]=b[k[_e]];if(this.outputShape=A,this.rank=A.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let j=Cn(this.rank),G=Xt("rc",this.rank),H=new Array(this.rank);for(let _e=0;_e<k.length;_e++)H[k[_e]]=G[_e];let re=`vec2(${H.slice(-2).join()})`,ie=`++${G[this.rank-1]} < ${A[this.rank-1]}`,me=`getChannel(getA(${H.join()}), ${re})`;this.userCode=`
    void main() {
      ${j} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${me};
      if(${ie}) {
        result[1] = ${me};
      }
      --${G[this.rank-1]};
      if(++${G[this.rank-2]} < ${A[this.rank-2]}) {
        result[2] = ${me};
        if(${ie}) {
          result[3] = ${me};
        }
      }
      setOutput(result);
    }
    `}}function gf(te,b,k){let A=Object(o.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wi(te.shape,b):new Pn(te.shape,b);return k.runWebGLProgram(A,[te],te.dtype)}let xb={kernelName:o.y,backendName:"webgl",kernelFunc:({inputs:te,attrs:b,backend:k})=>{let{x:A}=te,{reductionIndices:j,keepDims:G}=b,H=k,re=A.shape.length,ie=o.Lb.parseAxisParam(j,A.shape),me=ie,_e=o.X.getAxesPermutation(me,re),Ue=_e!=null,Be=H.shouldExecuteOnCPU([A]),Ye=A;if(Ue){if(Be){let Jt=H.texData.get(Ye.dataId).values,on=new Array(re);for(let Bt=0;Bt<on.length;Bt++)on[Bt]=A.shape[_e[Bt]];let dt=po(Jt,A.shape,A.dtype,_e,on);Ye=H.makeTensorInfo(on,A.dtype),H.texData.get(Ye.dataId).values=dt}else Ye=gf(A,_e,H);me=o.X.getInnerMostAxes(me.length,re)}o.X.assertAxesAreInnerMostDims("max",me,re);let[He,Ke]=o.X.computeOutAndReduceShapes(Ye.shape,me),Je,Nt=He;if(G&&(Nt=o.X.expandShapeToKeepDim(He,ie)),Be){let Jt=H.texData.get(Ye.dataId).values,on=fs(Jt,o.Lb.sizeFromShape(Ke),Nt,A.dtype);Je=H.makeTensorInfo(Nt,A.dtype),H.texData.get(Je.dataId).values=on}else Je=function(Jt,on,dt,Bt){let wt=o.Lb.sizeFromShape(on),In=Nc({inputs:{x:Jt},attrs:{shape:[o.Lb.sizeFromShape(Jt.shape)/wt,wt]},backend:Bt}),Ut=uh(In,Jt.dtype,"max",Bt),kt=Nc({inputs:{x:Ut},attrs:{shape:dt},backend:Bt});return Bt.disposeIntermediateTensorInfo(In),Bt.disposeIntermediateTensorInfo(Ut),kt}(Ye,Ke,Nt,H);return Ue&&H.disposeIntermediateTensorInfo(Ye),Je}};let bb={kernelName:o.z,backendName:"webgl",kernelFunc:function(te){let{inputs:b,backend:k,attrs:A}=te,{x:j}=b;qe(j,"maxPool");let{filterSize:G,strides:H,pad:re,dimRoundingMode:ie}=A;o.Lb.assert(o.X.eitherStridesOrDilationsAreOne(H,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${H} and dilations '1'`);let me=o.X.computePool2DInfo(j.shape,G,H,1,re,ie);if(me.filterWidth===1&&me.filterHeight===1&&o.Lb.arraysEqual(me.inShape,me.outShape))return Ec({inputs:{x:j},backend:k});let _e=new ff(me,"max",!1);return k.runWebGLProgram(_e,[j],j.dtype)}};let Ty={kernelName:o.A,backendName:"webgl",kernelFunc:function(te){let{inputs:b,backend:k,attrs:A}=te,{dy:j,input:G,output:H}=b,re=G;qe([G,H],"maxPoolBackprop");let{filterSize:ie,strides:me,pad:_e,dimRoundingMode:Ue}=A,Be=o.X.computePool2DInfo(re.shape,ie,me,1,_e,Ue),Ye=new ff(Be,"max",!0),He=k.runWebGLProgram(Ye,[re],re.dtype),Ke=new Zu(Be),Je=k.runWebGLProgram(Ke,[j,He],re.dtype);return k.disposeIntermediateTensorInfo(He),Je}};let vb={kernelName:o.B,backendName:"webgl",kernelFunc:({inputs:te,attrs:b,backend:k})=>{let{x:A}=te,{filterSize:j,strides:G,pad:H,includeBatchInIndex:re}=b,ie=k;o.Lb.assert(A.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${A.shape.length}.`);let me=[1,1];o.Lb.assert(o.X.eitherStridesOrDilationsAreOne(G,me),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${G} and dilations '${me}'`);let _e=o.X.computePool2DInfo(A.shape,j,G,me,H),[Ue,Be]=function(Ye,He,Ke,Je){let Nt=new ff(Ke,"max",!1),Jt=Je.runWebGLProgram(Nt,[Ye],"float32");return Nt=new ff(Ke,"max",!0,!0,He),[Jt,Je.runWebGLProgram(Nt,[Ye],"float32")]}(A,re,_e,ie);return[Ue,Be]}};let Ey={kernelName:o.C,backendName:"webgl",kernelFunc:({inputs:te,attrs:b,backend:k})=>{let{x:A}=te,{keepDims:j,axis:G}=b,H=k,re=A.shape.length,ie=o.Lb.parseAxisParam(G,A.shape),me=ie,_e=o.X.getAxesPermutation(me,re),Ue=_e!=null,Be=H.shouldExecuteOnCPU([A]),Ye=[],He=A;if(Ue){if(Be){let on=H.texData.get(He.dataId).values,dt=new Array(re);for(let wt=0;wt<dt.length;wt++)dt[wt]=A.shape[_e[wt]];let Bt=po(on,A.shape,A.dtype,_e,dt);He=H.makeTensorInfo(dt,A.dtype),H.texData.get(He.dataId).values=Bt}else He=gf(A,_e,H);Ye.push(He),me=o.X.getInnerMostAxes(me.length,re)}o.X.assertAxesAreInnerMostDims("sum",me,re);let[Ke,Je]=o.X.computeOutAndReduceShapes(He.shape,me),Nt=Ke;j&&(Nt=o.X.expandShapeToKeepDim(Ke,ie));let Jt=function(on,dt,Bt,wt){let In=o.Lb.sizeFromShape(dt),Ut=Nc({inputs:{x:on},attrs:{shape:[o.Lb.sizeFromShape(on.shape)/In,In]},backend:wt}),kt=uh(Ut,"float32","mean",wt),cr=Nc({inputs:{x:kt},attrs:{shape:Bt},backend:wt});return wt.disposeIntermediateTensorInfo(Ut),wt.disposeIntermediateTensorInfo(kt),cr}(He,Je,Nt,H);for(let on of Ye)H.disposeIntermediateTensorInfo(on);return Jt}};class pS{constructor(b,k,A){this.variableNames=["x"],this.outputShape=k.map((_e,Ue)=>_e[0]+b[Ue]+_e[1]);let j=b.length,G=Cn(j),H=k.map(_e=>_e[0]).join(","),re=k.map((_e,Ue)=>_e[0]+b[Ue]).join(","),ie=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,j),me=A==="reflect"?0:1;this.userCode=j!==1?`
      ${G} start = ${G}(${H});
      ${G} end = ${G}(${re});

      void main() {
        ${G} outC = getOutputCoords();
        for (int i = 0; i < ${j}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${me};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${me};
          }
        }
        ${G} coords = outC - start;
        setOutput(getX(${ie}));
      }
    `:`
        int start = ${H};
        int end = ${re};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${me};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${me};
          }
          setOutput(getX(outC - start));
        }
      `}}class wb{constructor(b,k,A){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=k.map((He,Ke)=>He[0]+b[Ke]+He[1]);let j=b.length,G=Cn(j),H=k.map(He=>He[0]).join(","),re=k.map((He,Ke)=>He[0]+b[Ke]).join(","),ie=Yt("rc",j),me=Yt("source",j),_e=`${ie[j-1]} < ${this.outputShape[j-1]}`,Ue=j===1?"source":`vec2(${me.slice(-2).join()})`,Be=A==="reflect"?0:1,Ye="";if(j===1){let He=`
        ${G} source = rc;
        if (source < start) {
          source = start * 2 - source - ${Be};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${Be};
        }
        source -= start;
      `;Ye=`
        ${G} rc = outputLoc;
        ${He}
        result[0] = getChannel(getX(${me.join()}), ${Ue});
        ${ie[j-1]} += 1;
        if(${_e}) {
          ${He}
          result[1] = getChannel(getX(${me.join()}), ${Ue});
        }
      `}else{let He=`
        ${G} source = rc;
        ${G} lt = ${G}(lessThan(source, start));
        ${G} gte = ${G}(greaterThanEqual(source, end));
        ${G} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${Be}) +
                gte * ((end - 1) * 2 - source + ${Be});
        source -= start;
      `;Ye=`
        ${G} rc = outputLoc;
        ${He}
        result[0] = getChannel(getX(${me.join()}), ${Ue});
        ${ie[j-1]} += 1;
        if(${_e}) {
          ${He}
          result[1] = getChannel(getX(${me.join()}), ${Ue});
        }
        rc = outputLoc;
        ${ie[j-2]} += 1;
        if(${ie[j-2]} < ${this.outputShape[j-2]}) {
          ${He}
          result[2] = getChannel(getX(${me.join()}), ${Ue});
          ${ie[j-1]} += 1;
          if(${_e}) {
            ${He}
            result[3] = getChannel(getX(${me.join()}), ${Ue});
          }
        }
      `}this.userCode=`
      const ${G} start = ${G}(${H});
      const ${G} end = ${G}(${re});

      void main() {
        ${G} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${Ye}
        setOutput(result);
      }
    `}}let ch={kernelName:o.D,backendName:"webgl",kernelFunc:({inputs:te,backend:b,attrs:k})=>{let{x:A}=te,{paddings:j,mode:G}=k,H=Object(o.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wb(A.shape,j,G):new pS(A.shape,j,G);return b.runWebGLProgram(H,[A],A.dtype)}},Dc="return areal * breal - aimag * bimag;",hS="return areal * bimag + aimag * breal;";class ou{constructor(b,k,A){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=o.X.assertAndGetBroadcastShape(k,A),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${b}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}let To="return a * b;",dS={kernelName:o.E,backendName:"webgl",kernelFunc:function(te){let{inputs:b,backend:k}=te,{a:A,b:j}=b,G=o.X.upcastType(A.dtype,j.dtype);if(A.dtype==="complex64"){let re=k.texData.get(A.dataId),ie=k.texData.get(j.dataId),me=new ou(Dc,A.shape,j.shape),_e=new ou(hS,A.shape,j.shape),Ue=[{dataId:re.complexTensorInfos.real.dataId,dtype:re.complexTensorInfos.real.dtype,shape:A.shape},{dataId:re.complexTensorInfos.imag.dataId,dtype:re.complexTensorInfos.imag.dtype,shape:A.shape},{dataId:ie.complexTensorInfos.real.dataId,dtype:ie.complexTensorInfos.real.dtype,shape:j.shape},{dataId:ie.complexTensorInfos.imag.dataId,dtype:ie.complexTensorInfos.imag.dtype,shape:j.shape}],Be=k.runWebGLProgram(me,Ue,"float32"),Ye=k.runWebGLProgram(_e,Ue,"float32"),He=tc({inputs:{real:Be,imag:Ye},backend:k});return k.disposeIntermediateTensorInfo(Be),k.disposeIntermediateTensorInfo(Ye),He}if(k.shouldExecuteOnCPU([A,j])){let re=k.texData.get(A.dataId),ie=k.texData.get(j.dataId),[me,_e]=Ao(A.shape,j.shape,re.values,ie.values,G),Ue=k.makeTensorInfo(_e,G);return k.texData.get(Ue.dataId).values=me,Ue}let H;return H=Object(o.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ni(To,A.shape,j.shape):new Ps(To,A.shape,j.shape),k.runWebGLProgram(H,[A,j],G)}},Ac={kernelName:o.F,backendName:"webgl",kernelFunc:({inputs:te,backend:b,attrs:k})=>{o.X.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{boxes:A,scores:j}=te,{maxOutputSize:G,iouThreshold:H,scoreThreshold:re}=k,ie=b,me=ie.readSync(A.dataId),_e=ie.readSync(j.dataId),Ue=G,Be=H,Ye=re;return o.lb.nonMaxSuppressionV3Impl(me,_e,Ue,Be,Ye)}},pl=o.lb.nonMaxSuppressionV4Impl,Ng={kernelName:o.G,backendName:"webgl",kernelFunc:({inputs:te,backend:b,attrs:k})=>{o.X.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{boxes:A,scores:j}=te,{maxOutputSize:G,iouThreshold:H,scoreThreshold:re,padToMaxOutputSize:ie}=k,me=b,_e=me.readSync(A.dataId),Ue=me.readSync(j.dataId),{selectedIndices:Be,validOutputs:Ye}=pl(_e,Ue,G,H,re,ie);return[Be,Ye]}},lh=o.lb.nonMaxSuppressionV5Impl,fS={kernelName:o.H,backendName:"webgl",kernelFunc:({inputs:te,backend:b,attrs:k})=>{o.X.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{boxes:A,scores:j}=te,{maxOutputSize:G,iouThreshold:H,scoreThreshold:re,softNmsSigma:ie}=k,me=b,_e=me.readSync(A.dataId),Ue=me.readSync(j.dataId),Be=G,Ye=H,He=re,Ke=ie,{selectedIndices:Je,selectedScores:Nt}=lh(_e,Ue,Be,Ye,He,Ke);return[Je,Nt]}};class su{constructor(b,k,A,j){this.variableNames=["Image"],this.outputShape=[];let G=b[1],H=b[2],re=Math.sin(k).toFixed(3),ie=Math.cos(k).toFixed(3);this.outputShape=b;let[me,_e]=o.X.getImageCenter(j,G,H),Ue=me.toFixed(3),Be=_e.toFixed(3),Ye="";Ye=typeof A=="number"?`float outputValue = ${A.toFixed(2)};`:`
        vec3 fill = vec3(${A.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - ${Ue}) * ${ie} - (float(y) - ${Be}) * ${re};
          float coordYFloat = (float(x) - ${Ue}) * ${re} + (float(y) - ${Be}) * ${ie};
          int coordX = int(round(coordXFloat + ${Ue}));
          int coordY = int(round(coordYFloat + ${Be}));
          ${Ye}
          if(coordX >= 0 && coordX < ${H} && coordY >= 0 && coordY < ${G}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}let ot={kernelName:o.L,backendName:"webgl",kernelFunc:({inputs:te,attrs:b,backend:k})=>{let{image:A}=te,{radians:j,fillValue:G,center:H}=b,re=k,ie=new su(A.shape,j,G,H);return re.runWebGLProgram(ie,[A],A.dtype)}},Fa=_g(`if (isnan(x)) return x;
  return sin(x);
`),oi={kernelName:o.N,backendName:"webgl",kernelFunc:Fa},hl=_g("return x * x;"),Ny={kernelName:o.P,backendName:"webgl",kernelFunc:hl},ph=ah({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"}),ky={kernelName:o.Q,backendName:"webgl",kernelFunc:ph},yf="return a - b;",iu=ah({opSnippet:yf,packedOpSnippet:yf,supportsComplex:!0,cpuKernelImpl:Sc}),hp={kernelName:o.R,backendName:"webgl",kernelFunc:iu},pa=_g("return tan(x);");let Sb=[ab,J2,ub,eS,Tg,db,sb,sS,aS,cS,lS,mr,kc,ob,vi,oS,xb,bb,Ty,vb,Ey,ch,dS,Ac,Ng,fS,pb,hb,mb,ot,oi,Ny,hp,ky,{kernelName:o.S,backendName:"webgl",kernelFunc:pa},{kernelName:o.U,backendName:"webgl",kernelFunc:({inputs:te,attrs:b,backend:k})=>{let{x:A}=te,{perm:j}=b,G=k,H=A.shape.length,re=new Array(H);for(let me=0;me<re.length;me++)re[me]=A.shape[j[me]];let ie;if(G.shouldExecuteOnCPU([A])){let me=G.texData.get(A.dataId).values,_e=po(me,A.shape,A.dtype,j,re);ie=G.makeTensorInfo(re,A.dtype),G.texData.get(ie.dataId).values=_e}else ie=gf(A,j,G);return ie}},{kernelName:o.V,backendName:"webgl",kernelFunc:function(te){let{inputs:b,attrs:k,backend:A}=te,{axis:j}=k,{x:G}=b;qe(G,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let H=A.readSync(G.dataId),{outputValues:re,outputShape:ie,indices:me}=Da(H,j,G.shape,G.dtype);return[A.makeTensorInfo(ie,G.dtype,re),A.makeTensorInfo([me.length],"int32",me)]}}];for(let te of Sb)Object(o.wb)(te);var eo=e(2),dl=e(9),xf=e(20),fl=e(42),hh=e(25);let dp=(te,b,k)=>{let A=te.createBuffer(1,b.length,k);return A.copyToChannel(b,0),A};function Wn(te,b,k,A,j){return new Promise(G=>{let H={loudness_db:[0],f0_hz:[0]},re=0;for(let ie=b;ie<k;ie++)A&&ie>=j?(H.loudness_db[re]=-120,H.f0_hz[re]=-1):(H.loudness_db[re]=te.loudness_db[ie],H.f0_hz[re]=te.f0_hz[ie]),re+=1;G(H)})}function dh(te){return te*hh.b}function Nr(te){return te/hh.b}class Hr{constructor(b,k){this.checkpointUrl=b,k&&(this.settings=k)}initialize(){return Te(this,null,function*(){let b;eo.registerOp("Roll",k=>{let A=eo.split(k.inputs[0],2,2),j=eo.concat([A[1],A[0]],2);return A.forEach(G=>G.dispose()),j}),eo.env().set("WEBGL_PACK",!1),eo.env().set("WEBGL_CONV_IM2COL",!1),eo.env().set("WEBGL_DELETE_TEXTURE_THRESHOLD",104857600),this.model=yield function(k){return Te(this,null,function*(){return yield eo.loadGraphModel(k)})}(this.checkpointUrl+"/model.json");try{b=yield fetch(this.checkpointUrl+"/settings.json").then(k=>k.json())}finally{if(this.settings===null)throw new Error("Passing settings is required if you do not have a settings.json file.")}this.settings=Tt(Tt({},b),this.settings),this.initialized=!0})}dispose(){this.initialized&&(this.model.dispose(),this.checkpointUrl=null,this.initialized=!1)}isInitialized(){return this.initialized}memCheck(){return Te(this,null,function*(){return yield function(){return Te(this,null,function*(){let b=window.screen.availWidth*window.screen.availHeight,k=window.devicePixelRatio,A=Math.round(b*k*600/1048576);if(!isNaN(A)&&A<50)throw new Error(`Insufficient memory! Your device has ${A} and recommended memory is 50`);try{if(yield eo.ready(),eo.getBackend()!=="webgl")throw new Error("It looks like your browser does not support webgl.")}catch(j){throw new Error("insufficient memory - "+j)}return!0})}()})}synthesize(b,k){return Te(this,null,function*(){k!==null&&(this.settings=Tt(Tt({},this.settings),k));let{f0_hz:A,loudness_db:j,confidences:G}=b,H=Object(fl.c)(A,j.length,this.settings.modelMaxFrameLength),re=Object(fl.c)(G,j.length,this.settings.modelMaxFrameLength),ie=yield function(dt,Bt){return Te(this,null,function*(){let wt=Bt.averageMaxLoudness,In=Bt.meanLoudness,Ut=Bt.loudnessThreshold,kt=Bt.meanPitch,cr,er=[];if(dt.loudness_db.length>0){let Kr=eo.tidy(()=>{let ii=eo.tensor1d(dt.loudness_db,"float32"),fo=ii.max(),Oc=eo.sub(wt,fo),Rc=eo.add(ii,Oc);return ii.dispose(),fo.dispose(),Oc.dispose(),Rc}),mn=Kr.greater(Ut),Ys=yield eo.booleanMaskAsync(Kr,mn),Qs=yield Ys.array(),Sn=eo.tidy(()=>{let ii=Qs>0?Ys.mean():Kr.mean(),fo=eo.sub(In,ii),Oc=Kr.add(fo).add(0).clipByValue(-120,wt),Rc=Oc.min(),fh=ii.sub(Rc);return Oc.sub(Rc).div(fh).mul(In- -120).add(-120)}),Ls=eo.reshape(dt.confidences,[-1,1,1]),si=eo.pool(Ls,[100,1],"avg","same"),Bs=si.reshape([-1]),ha=eo.lessEqual(Bs,.7);cr=eo.tidy(()=>{let ii=ha.mul(-25),fo=Sn.add(ii),Oc=eo.maximum(fo,-120);return ii.dispose(),fo.dispose(),Oc}),er=yield cr.array(),mn.dispose(),Kr.dispose(),Sn.dispose(),Ys.dispose(),si.dispose(),Bs.dispose(),Ls.dispose(),ha.dispose()}let kr=[];if(dt.f0_hz.length>0){let Kr=yield Object(xf.c)(dt.f0_hz),mn=eo.tidy(()=>{for(let fo=0,Oc=Kr.length;fo<Oc;++fo)Kr[fo]===-1/0&&(Kr[fo]=0);return Kr}),Ys=eo.lessEqual(dt.confidences,.7),Qs=cr.greater(Ut),Sn=eo.logicalOr(Ys,Qs),Ls=yield eo.booleanMaskAsync(mn,Sn),si=Ls.mean(),Bs=yield eo.sub(kt,si),ha=yield Bs.array(),ii=eo.tidy(()=>{let fo=ha/12;return fo=Math.round(fo),Object(fl.b)(dt.f0_hz,fo)});kr=yield ii.array(),cr.dispose(),si.dispose(),Ls.dispose(),Bs.dispose(),ii.dispose(),Qs.dispose(),Sn.dispose(),Ys.dispose()}return{f0_hz:kr,loudness_db:er}})}({f0_hz:H,loudness_db:j,confidences:re},this.settings),me=[],_e=ie.loudness_db.length,Ue=Nr(_e),Be=!1,Ye=Nr(this.settings.modelMaxFrameLength),He,Ke=1*hh.c;for(let dt=0;dt<Ue;dt+=Ye-1){let Bt=Math.floor(dh(dt)),wt=dh(dt+Ye);wt>_e&&(Be=!0);let{f0_hz:In,loudness_db:Ut}=yield Wn(ie,Bt,wt,Be,_e),kt=eo.tensor1d(In,"float32"),cr=eo.tensor1d(Ut,"float32"),er=yield this.model.predict({f0_hz:kt,loudness_db:cr}),kr=yield er.data();me.push(kr),er.dispose(),kt.dispose(),cr.dispose()}if(Ue<=Ye)He=me[0];else{let dt=[];for(let Bt=0;Bt<me.length;Bt++){let wt=me[Bt];dt.push(wt)}He=function(Bt,wt){let In=Bt.reduce((Kr,mn)=>Kr+mn.length,0),Ut=new Float32Array(In),kt=0;for(let Kr=0;Kr<Bt.length;Kr++){let mn=Bt[Kr],Ys=Kr<Bt.length-1;if(Kr===0&&(Ut.set(mn,kt),kt+=mn.length),Ys){let Qs=Bt[Kr+1],Sn=kt-wt;for(let Ls=Sn,si=0,Bs=mn.length-wt;Ls<kt&&si<Qs.length;Ls++,si++,Bs++){let ha=(Ls-Sn)/(kt-Sn);Ut[Ls]=(cr=mn[Bs],er=Qs[si],cr*(1-(kr=ha))+er*kr)}Ut.set(Qs.slice(wt),kt),kt+=Qs.slice(wt).length}}var cr,er,kr;return Ut}(dt,Ke)}let Je=He.slice(0,b.originalRecordedBufferLength).map(dt=>dt*(this.settings.postGain||1)),Nt=new dl.Context,Jt=dp(Nt,Je,hh.c),on=yield Object(xf.j)(Jt,48e3);return yield function(In){return Te(this,arguments,function*({audioCtx:dt,arrayBuffer:Bt,sampleRate:wt}){let Ut;dl.setContext(dt);let kt=dp(dt,Bt,wt);Ut=yield dl.Offline(()=>{let kr=new dl.Compressor({attack:.001,release:.001,threshold:-6}).toDestination(),Kr=new dl.Reverb({wet:.3,decay:3}).connect(kr),mn=new dl.Filter(8e3,"lowpass",-24).connect(Kr);return new dl.Player({url:kt}).connect(mn).start(),Kr.ready},Bt.length/wt);let er=Ut.getChannelData(0);return kt=null,Ut.dispose(),Ut=null,er})}({audioCtx:Nt,arrayBuffer:on,sampleRate:48e3})})}}},function(n,t,e){"use strict";e.r(t),e.d(t,"GANSynth",function(){return O});var r=e(2),o=e(12),s=e(15),i=e(43),a=e(20);let u=[[1,1,1.0087615084725814],[2,1,.029087889211125567],[2,2,.958243896036208],[3,2,.5326346877272624],[3,3,.45988057223186607],[4,3,1.0072850129664943],[5,4,1.0050894259864507],[6,4,.016233689242197466],[6,5,.9763230964529687],[7,5,.5149287456976357],[7,6,.48299891928441196],[8,6,1.0020339883784544],[9,7,1.0013940582804204],[10,7,.004285414445239434],[10,8,.9936677765505681],[11,8,.4979349533263788],[11,9,.5020647178266697],[12,9,.9896782321684733],[12,10,.006967080931645349],[13,10,1.0022486641537054],[14,11,1.0033233953996759],[15,11,.4782757843614299],[15,12,.5183887055972138],[16,12,.9736767011426267],[16,13,.01804416217807709],[17,13,1.0056329663266226],[18,14,1.00808642668908],[19,14,.4576416347984229],[19,15,.5340800956534676],[20,15,.9582897445862256],[20,16,.028988367857957848],[21,16,1.008754652772106],[22,17,1.0122552436937966],[23,17,.4380796830853842],[23,18,.5491738237632201],[24,18,.9434838949694413],[24,19,.039794474296176746],[25,19,1.0116287566447584],[26,20,1.0158945544322868],[27,20,.41952402212367873],[27,21,.5637020154076856],[28,21,.9292283399303117],[28,22,.05045785324282485],[29,22,1.0142694870195312],[30,23,1.0190617246342517],[31,23,.40191289323704393],[31,24,.5776942788784806],[32,24,.915494649120402],[32,25,.060974426459003916],[33,25,1.016690283888679],[34,26,1.0218076651124588],[35,26,.3851885348435194],[35,27,.5911779611807773],[36,27,.9022565352474414],[36,28,.07134062388959171],[37,28,1.0189038677945517],[38,29,1.0241776077147466],[39,29,.369297000124277],[39,30,.6041783722578726],[40,30,.8894896443111251],[40,31,.08155334505527755],[41,31,1.0209222848386956],[42,32,1.0262117836546005],[43,32,.35418795675261777],[43,33,.6167189821271176],[44,33,.87717137085618],[44,34,.09160992335204851],[45,34,1.0227569476841007],[46,35,1.0279460165329002],[47,35,.3398144781420294],[47,36,.628821594757742],[48,36,.8652806947525041],[48,37,.10150809298528844],[49,37,1.0244186730654867],[50,38,1.029412240942602],[51,38,.32613283297317347],[51,39,.6405065019041107],[52,39,.8537980365619783],[52,40,.11124595830527892],[53,40,1.0259177162406141],[54,41,1.030638956235277],[55,41,.3131022777355948],[55,42,.6517926196031543],[56,42,.8427051290118196],[56,43,.12082196533877268],[57,43,1.0272638027474759],[58,44,1.031651623831845],[59,44,.3006848555240512],[59,45,.6626976096262132],[60,45,.8319849024715039],[60,46,.13023487533380312],[61,46,1.0284661577762764],[62,47,1.0324730153919173],[63,47,.28884520321029805],[63,48,.6732379878311283],[64,48,.821621382643116],[64,49,.1394837401591093],[65,49,1.0295335334192939],[66,50,1.0331235182054521],[67,50,.27755036829985363],[67,51,.68342922107227],[68,51,.8115995989355603],[68,52,.148567879414825],[69,52,1.0304742340231496],[70,53,1.0336214033370148],[71,53,.2667696361817086],[71,54,.6932858140884962],[72,54,.8019055022130549],[72,55,.1574868591255191],[73,55,1.031296139836255],[74,56,1.0339830613212895],[75,56,.2564743680536822],[75,57,.7028213875855097],[76,57,.7925258907912134],[76,58,.16624047189958738],[77,58,1.032006729117501],[78,59,1.0342232095724524],[79,59,.24663784949713183],[79,60,.7120487485622758],[80,60,.7834483437084975],[80,61,.17482871845079165],[81,61,1.032613098850059],[82,62,1.0343550751159198],[83,62,.2372351494674972],[83,63,.7209799537859948],[84,63,.7746611604312031],[84,64,.18325179038711914],[85,64,1.0331219841851924],[86,65,1.0343905557724016],[87,65,.22824298931879333],[87,66,.7296263672031092],[88,66,.7661533062642226],[88,67,.19151005417692718],[89,67,1.0335397767254908],[90,68,1.0343403625078313],[91,68,.21963962139622123],[91,69,.7379987119645334],[92,69,.7579143628308538],[92,70,.19960403621540457],[93,70,1.0338725417430177],[94,71,1.0342141453043734],[95,71,.21140471667072153],[95,72,.746107117663542],[96,72,.7499344830670268],[96,73,.20753440891552338],[97,73,1.0341260344172454],[98,74,1.034020604597683],[99,74,.20351926086574523],[99,75,.7539611633021215],[100,75,.7422043502477234],[100,76,.2153019777561019],[101,76,1.0343057151671131],[102,77,1.0337675900563705],[103,77,.19596545852169872],[103,78,.7615699164421695],[104,78,.734715140616724],[104,79,.22290766922455862],[105,79,1.034416764143981],[106,80,1.03346218824938],[107,80,.1887266444456389],[107,81,.7689419689404797],[108,81,.7274584892496355],[108,82,.23035251959385997],[109,82,1.0344640949448594],[110,83,1.0331108005456808],[111,83,.18178720201436843],[111,84,.7760854696185804],[112,84,.7204264588178948],[112,85,.23763766448199494],[113,85,1.0344523675990727],[114,86,1.032719212418228],[115,86,.1751324878193402],[115,87,.7830081541774375],[116,87,.7136115109646374],[116,88,.2447643291417676],[117,88,1.0343860008764458],[118,89,1.0322926551739824],[119,89,.16874876216974247],[119,90,.789717372631832],[120,90,.7070064800338803],[120,91,.2517338194331562],[121,91,1.0342691839607763],[122,92,1.0318358610025598],[123,92,.16262312499771858],[123,93,.7962201145052664],[124,93,.7006045489251309],[124,94,.25854751343650967],[125,94,1.0341058875275075],[126,95,1.0313531121234998],[127,95,.15674345673841866],[127,96,.8025230320033012],[128,96,.6943992268713032],[128,97,.2652068536620191],[129,97,1.033899874262366],[130,98,1.030848284714744],[131,98,.1510983637896712],[131,99,.8086324613545763],[132,99,.6883843289574696],[132,100,.2717133398209474],[133,100,1.033654708853177],[134,101,1.0303248882205327],[135,101,.14567712818173575],[135,102,.8145544424922615],[136,102,.6825539572209546],[136,103,.2780685221191216],[137,103,1.033373767485838],[138,104,1.0297861005632643],[139,104,.14046966111762169],[139,105,.8202947372282664],[140,105,.6769024831869065],[140,106,.28427399504058354],[141,106,1.0330602468722847],[142,107,1.029234799720434],[143,107,.13546646006984392],[143,108,.8258588460540109],[144,108,.671424531713726],[144,109,.290331391589362],[145,109,1.0327171728357682],[146,110,1.0286735920712562],[147,110,.13065856914309196],[147,111,.8312520236957351],[148,111,.6661149660273628],[148,112,.2962423779602388],[149,112,1.03234740847843],[150,113,1.0281048378703825],[151,113,.12603754244145],[151,114,.8364792935255917],[152,114,.6609688738465388],[152,115,.30200864860954885],[153,115,1.0319536619522978],[154,116,1.0275306741623285],[155,116,.12159541018943322],[155,117,.8415454609370665],[156,117,.655981554500098],[156,118,.3076319217011811],[157,118,1.031538493855763],[158,119,1.0269530354146845],[159,119,.11732464738966399],[159,120,.846455125764718],[160,120,.6511485069565366],[160,121,.3131139349019227],[161,121,1.0311043242739946],[162,122,1.0263736721146446],[163,122,.11321814480714538],[163,123,.851212693834753],[164,123,.6464654186857061],[164,124,.3184564415055735],[165,124,1.0306534394819706],[166,125,1.0257941675461106],[167,125,.10926918209624069],[167,126,.8558223877141483],[168,126,.6419281552876014],[168,127,.32366120686047056],[169,127,1.0301879983273805],[170,128,1.0252159529388847],[171,128,.10547140289367021],[171,129,.8602882567276612],[172,129,.6375327508240597],[172,130,.32873000508360367],[173,130,1.0297100383091813],[174,131,1.0246403211604227],[175,131,.10181879172477112],[175,132,.8646141862987496],[176,132,.6332753987956673],[176,133,.33366461604209907],[177,133,1.0292214813668379],[178,134,1.0240684391009978],[179,134,.09830565257411007],[179,135,.8688039066707689],[180,135,.6291524437169539],[180,136,.3384668225808326],[181,136,1.0287241393952773],[182,137,1.0235013588866442],[183,137,.0949265889928822],[183,138,.8728610010546515],[184,138,.6251603732380943],[184,139,.3431384079843332],[185,139,1.0282197194980238],[186,140,1.0229400280388043],[187,140,.09167648561647405],[187,141,.8767889132518744],[188,141,.6212958107744541],[188,142,.3476811536535296],[189,142,1.0277098289923983],[190,143,1.0223852986877378],[191,143,.08855049098843445],[191,144,.8805909547856343],[192,144,.6175555086043407],[192,145,.35209683698566024],[193,145,1.0271959801772084],[194,146,1.021837935933431],[195,146,.08554400158179727],[195,147,.8842703115872171],[196,147,.6139363413989273],[196,148,.35638722943949186],[197,148,1.026679594876984],[198,149,1.0212986254395027],[199,149,.082652646931321],[199,150,.8878300502607867],[200,150,.6104353001536761],[200,151,.3605540947783916],[201,151,1.0261620087703698],[202,152,1.020767980334856],[203,152,.07987227578640096],[203,153,.8912731239662092],[204,153,.6070494864912312],[204,154,.364599187472458],[205,154,1.025644475516362],[206,155,1.0202465474911722],[207,155,.07719894321045902],[207,156,.8946023779404728],[208,156,.6037761073076129],[208,157,.36852425125748506],[209,157,1.0251281706842847],[210,158,1.0197348132361097],[211,158,.07462889855138014],[211,159,.8978205546916732],[212,159,.6006124697383151],[212,160,.3723310178292769],[213,160,1.0246141955013988],[214,161,1.0192332085569418],[215,161,.07215857422040488],[215,162,.9009302988805],[216,162,.5975559764226185],[216,163,.37602120567284064],[217,163,1.024103580422386],[218,164,1.018742113842709],[219,164,.06978457521665815],[219,165,.9039341619174114],[220,165,.5946041210439893],[220,166,.3795965190111676],[221,166,1.0235972885322195],[222,167,1.0182618632088625],[223,167,.0675036693443592],[223,168,.9068346062921914],[224,168,.5917544841265701],[224,169,.3830586468674795],[225,169,1.0230962187892327],[226,170,1.0177927484431766],[227,170,.06531277806896706],[227,171,.9096340096561174],[228,171,.5890047290713193],[228,172,.38640926223293437],[229,172,1.0226012091159231],[230,173,1.017335022608167],[231,173,.0632089679653424],[231,174,.9123346686734497],[232,174,.586352598418078],[232,175,.3896500213288084],[233,175,1.0221130393455482],[234,176,1.0168889033326205],[235,176,.06118944272087777],[235,177,.914938802652698],[236,177,.5837959103122896],[236,178,.39278256296329067],[237,178,1.0216324340290364],[238,179,1.0164545758191],[239,179,.05925153564332089],[239,180,.9174485569826359],[240,180,.5813325551691159],[240,181,.3958085079669357],[241,181,1.0211600651125134],[242,182,1.01603219559476],[243,182,.05739270264601734],[243,183,.919866006375456],[244,183,.578960492519135],[244,184,.39872945870775167],[245,184,1.020696554488055],[246,185,1.0156218910279706],[247,185,.055610515672866775],[247,186,.9221931579354511],[248,186,.5766777480237313],[248,187,.4015469986761612],[249,187,1.0202424764259312],[250,188,1.0152237656316911],[251,188,.05390265653168126],[251,189,.9244319540637365],[252,189,.5744824106486663],[252,190,.4042626921377848],[253,190,1.0197983598926021],[254,191,1.0148379001729047],[255,191,.052266911108559244],[255,192,.9265842752073952],[256,192,.5723726299899468],[256,193,.40687808384383367],[257,193,1.0193646907609162],[258,194,1.0144643546050645],[259,194,.05070116393653833],[259,195,.9286519424651887],[260,195,.5703466137364466],[260,196,.4093946987997115],[261,196,1.0189419139168765],[262,197,1.014103169839173],[263,197,.04920339309393266],[263,198,.9306367200572258],[264,198,.5684026252644323],[264,199,.41181404208517797],[265,199,1.0185304352678317],[266,200,1.0137543693675302],[267,200,.04777166540942449],[267,201,.9325403176671191],[268,201,.5665389813575877],[268,202,.4141375987198434],[269,202,1.0181306236573189],[270,203,1.0134179607527265],[271,203,.04640413195303674],[271,204,.934364392667829],[272,204,.5647540500383554],[272,205,.4163668335733731],[273,205,1.017742812691386],[274,206,1.0130939369942324],[275,206,.04509902379599986],[275,207,.9361105522297561],[276,207,.5630462485124229],[276,208,.4185031913161667],[277,208,1.0173673024779883],[278,209,1.0127822777820206],[279,209,.043854648017688035],[279,210,.9377803553285139],[280,210,.5614140412123577],[280,211,.42054809640522234],[281,211,1.0170043612872055],[282,212,1.0124829506474082],[283,212,.042669383945431606],[283,213,.9393753146522579],[284,213,.5598559379382144],[284,214,.42250295310432634],[285,214,1.016654227133528],[286,215,1.0121959120202477],[287,215,.04154167961383383],[287,216,.9408968984130733],[288,216,.5583704920894111],[288,217,.42436914553372207],[289,217,1.0163171092845467],[290,218,1.0119211081990869],[291,218,.04047004842376173],[291,219,.9423465320743504],[292,219,.5569562989809166],[292,220,.4261480377490578],[293,220,1.0159931896995795],[294,221,1.0116584762427925],[295,221,.03945306599345366],[295,222,.9437255999933521],[296,222,.5556119942410062],[296,223,.4278409738424421],[297,223,1.0156826244024533],[298,224,1.0114079447897668],[299,224,.038489367187566605],[299,225,.9450354469842541],[300,225,.5543362522836106],[300,226,.42944927807097044],[301,226,1.015385544788648],[302,227,1.0111694348102989],[303,227,.03757764331096192],[303,228,.9462773798108762],[304,228,.5531277848528364],[304,229,.4309742550012965],[305,229,1.0151020588742643],[306,230,1.010942860298229],[307,230,.036716639459590646],[307,231,.9474526686068676],[308,231,.5519853396352962],[308,232,.4324171896758833],[309,232,1.0148322524854105],[310,233,1.0107281289063446],[311,233,.03590515201636021],[311,234,.9485625482321702],[312,234,.5509076989367998],[312,235,.43377934779319954],[313,235,1.0145761903940136],[314,236,1.0105251425307091],[315,236,.03514202628559325],[315,237,.9496082195647421],[316,237,.5498936784177629],[316,238,.4350619759070698],[317,238,1.014333917399279],[318,239,1.0103337978471305],[319,239,.03442615425358563],[319,240,.9505908507379167],[320,240,.5489421258861396],[320,241,.43626630163460317],[321,241,1.0141054593619083],[322,242,1.01015398680447],[323,242,.03375647247069698],[323,243,.9515115783174108],[324,243,.5480519201477565],[324,244,.43739353387882146],[325,244,1.0138908241879996],[326,245,1.0099855970782285],[327,245,.033131960048180864],[327,246,.9523715084281075],[328,246,.5472219699015581],[328,247,.438444863061944],[329,247,1.013690002769195],[330,248,1.009828512486449],[331,248,.0325516367573507],[331,249,.9531717178331495],[332,249,.5464512126887197],[332,250,.43942146136466664],[333,250,1.0135029698801676],[334,251,1.0096826133725936],[335,251,.03201456123217285],[335,252,.9539132549610332],[336,252,.5457386138858732],[336,253,.4403244829779182],[337,253,1.0133296850325435],[338,254,1.009547776957031],[339,254,.03151982926510845],[339,255,.9545971408911784],[340,255,.5450831657405287],[340,256,.44115506435778573],[341,256,1.0131700932920482],[342,257,1.0094238776594737],[343,257,.031066572189892106],[343,258,.9552243702967873],[344,258,.5444838864501296],[344,259,.44191432448690826],[345,259,1.013024126057376],[346,260,1.0093107873949636],[347,260,.030653955347715485],[347,261,.9557959123477745],[348,261,.5439398192781751],[348,262,.44260336514265247],[349,262,1.01289170180302],[350,263,1.0092083758457435],[351,263,.03028117663272106],[351,264,.956312711573757],[352,264,.5434500317097861],[352,265,.44322327116676213],[353,265,1.012772726788603],[354,266,1.0091165107105933],[355,266,.029947465111254432],[355,267,.9567756886915669],[356,267,.5430136146404813],[356,268,.443775110739594],[357,268,1.0126670957357586],[358,269,1.0090350579329337],[359,269,.02965207970869547],[359,270,.9571857414000476],[360,270,.5426296815994802],[360,271,.44425993565630856],[361,271,1.012574692474406],[362,272,1.0089638819102829],[363,272,.029394307963707546],[363,273,.9575437451393404],[364,273,.5422973680058967],[364,274,.4446787816043237],[365,274,1.0124953905592755],[366,275,1.0089028456858484],[367,275,.029173464843693937],[367,276,.9578505538209541],[368,276,.5420158304528419],[368,277,.44503266844280676],[369,277,1.0124290538587923],[370,278,1.0088518111235036],[371,278,.028988891617224174],[371,279,.9581070005279474],[372,279,.5417842460227992],[372,280,.4453226004830567],[373,280,1.012375537116488],[374,281,1.0088106390682976],[375,281,.028839954783933083],[375,282,.9583138981860433],[376,282,.5416018116287169],[376,283,.4455495667668758],[377,283,1.0123346864882432],[378,284,1.008779189492711],[379,284,.02872604505481853],[379,285,.9584720402070429],[380,285,.5414677433849261],[380,286,.44571454134485444],[381,286,1.0123063400541175],[382,287,1.008757321629678],[383,287,.028646576380597488],[383,288,.9585822011116006],[384,288,.5413812759956369],[384,289,.4458184835568685],[385,289,1.0122903283078832],[386,290,1.0087448940943453],[387,290,.028600985028178233],[387,291,.9586451371206854],[388,291,.541341662177547],[388,292,.44586233830592226],[389,292,1.0122864746237836],[390,293,1.0087417649949195],[391,293,.028588728701898054],[391,294,.9586615867284015],[392,294,.5413481720936798],[392,295,.44584703633543826],[393,295,1.0122945957030358],[394,296,1.0087477920325896],[395,296,.028609285702619672],[395,297,.958632271251788],[396,297,.5414000928186515],[396,298,.44577349450072723],[397,298,1.0123145019997328],[398,299,1.0087628325926643],[399,299,.028662154128659946],[399,300,.9585578953591529],[400,300,.5414967278190544],[400,301,.4456426160405528],[401,301,1.0123459981276965],[402,302,1.0087867438270437],[403,302,.028746851113718195],[403,303,.9584391475775814],[404,303,.5416373964555454],[404,304,.4454552908447334],[405,304,1.0123888832492127],[406,305,1.0088193827286074],[407,305,.02886291209986826],[407,306,.9582767007831089],[408,306,.541821433501071],[408,307,.44521239571891796],[409,307,1.0124429514472502],[410,308,1.0088606061980132],[411,308,.029009890142771087],[411,309,.9580712126699451],[412,309,.5420481886827784],[412,310,.4449147946460895],[413,310,1.01250799207953],[414,311,1.0089102711038211],[415,311,.029187355249536997],[415,312,.9578233262044412],[416,312,.5423170262339921],[416,313,.44456333904778883],[417,313,1.0125837901172945],[418,314,1.0089682343360202],[419,314,.02939489374516595],[419,315,.9575336700623188],[420,315,.5426273244683578],[420,316,.4441588680360723],[421,316,1.0126701264704934],[422,317,1.0090343528545804],[423,317,.029632107670909735],[423,318,.9572028590461733],[424,318,.5429784753662162],[424,319,.44370220866623333],[425,319,1.0127667782967882],[426,320,1.0091084837312583],[427,320,.02989861420426184],[427,321,.9568314944924141],[428,321,.5433698841780775],[428,322,.44319417618582607],[429,322,1.0128735192969558],[430,323,1.0091904841873789],[431,323,.03019404510848359],[431,324,.9564201646615609],[432,324,.5438009690392793],[432,325,.442635574278337],[433,325,1.0129901199984148],[434,326,1.0092802116265451],[435,326,.030518046204357472],[435,327,.9559694451142186],[436,327,.5442711606026257],[436,328,.4420271953022404],[437,328,1.013116348025554],[438,329,1.0093775236632159],[439,329,.030870276865616747],[439,330,.9554798990737882],[440,330,.5447799016825403],[440,331,.4413698205263152],[441,331,1.0132519683584005],[442,332,1.009482278147551],[443,332,.03125040953717358],[443,333,.9549520777754482],[444,333,.5453266469100869],[444,334,.4406642203630321],[445,334,1.0133967435791398],[446,335,1.009594333186143],[447,335,.031658129272365214],[447,336,.9543865208053518],[448,336,.5459108623998897],[448,337,.43991115459682073],[449,337,1.0135504341086077],[450,338,1.0097135471594447],[451,338,.03209313328990995],[451,339,.9537837564264052],[452,339,.5465320254328632],[452,340,.4391113726049666],[453,340,1.013712798432744],[454,341,1.009839778736762],[455,341,.03255513055252836],[455,342,.9531443018899375],[456,342,.5471896241467579],[456,343,.43826561357805704],[457,343,1.0138835933177033],[458,344,1.0099728868869051],[459,344,.033043841357819334],[459,345,.9524686637453139],[460,345,.5478831572348231],[460,346,.437374606734874],[461,346,1.0140625740178375],[462,347,1.0101127308880269],[463,347,.03355899695286791],[463,348,.9517573381261256],[464,348,.5486121336621822],[464,349,.436439071532636],[465,349,1.0142494944714182],[466,350,1.0102591703335964],[467,350,.03410033916008615],[467,351,.9510108110386514],[468,351,.5493760723833191],[468,352,.4354597178717026],[469,352,1.0144441074918717],[470,353,1.0104120651366326],[471,353,.03466762001996195],[471,354,.9502295586328896],[472,354,.5501745020753853],[472,355,.43443724629963687],[473,355,1.0146461649465606],[474,356,1.0105712755316636],[475,356,.035260601448092795],[475,357,.9494140474694148],[476,357,.5510069608761691],[476,358,.43337234820709825],[477,358,1.0148554179311553],[478,359,1.0107366620751033],[479,359,.035879054907258415],[479,360,.9485647347731454],[480,360,.5518729961339426],[480,361,.4322657060211073],[481,361,1.0150716169344107],[482,362,1.0109080856433987],[483,362,.036522761091017805],[483,363,.9476820686815849],[484,363,.5527721641646695],[484,364,.4311179933933358],[485,364,1.0152945119966836],[486,365,1.011085407429963],[487,365,.037191509621709105],[487,366,.9467664884832998],[488,366,.5537040300164661],[488,367,.42992987538427074],[489,367,1.0155238528614574],[490,368,1.0112684889404733],[491,368,.03788509876006132],[491,369,.945818424848663],[492,369,.5546681672409077],[492,370,.42870200864543534],[493,370,1.015759389119438],[494,371,1.0114571919861517],[495,371,.038603335123549486],[495,372,.9448383000574974],[496,372,.5556641576735553],[496,373,.42743504159139284],[497,373,1.016000870349307],[498,374,1.0116513786769457],[499,374,.03934603342038135],[499,375,.9438265282100843],[500,375,.556691591222498],[500,376,.42612961457530607],[501,376,1.0162480462474877],[502,377,1.011850911412824],[503,377,.0401130161915153],[503,378,.9427835154401112],[504,378,.5577500656591832],[504,379,.42478636005357434],[505,379,1.0165006667574357],[506,380,1.012055652873517],[507,380,.04090411356002747],[507,381,.9417096601187289],[508,381,.5588391864205529],[508,382,.4234059027505881],[509,382,1.016758482190165],[510,383,1.0122654660085202],[511,383,.04171916299559172],[511,384,.940605353048487],[512,384,.5599585664146272],[512,385,.4219888598177451],[513,385,1.0170212433404524],[514,386,1.0124802140252198],[515,386,.04255800908365318],[515,387,.9394709776545362],[516,387,.5611078258344457],[516,388,.42053584098827806],[517,388,1.0172887015980372],[518,389,1.0126997603766286],[519,389,.04342050330548295],[519,390,.9383069101697904],[520,390,.5622865919744513],[520,391,.4190474487280153],[521,391,1.0175606090547666],[522,392,1.0129239687479124],[523,392,.044306503823998804],[523,393,.9371135198133816],[524,393,.5634944990567509],[524,394,.41752427838399275],[525,394,1.017836718605313],[526,395,1.0131527030429122],[527,395,.04521587528078427],[527,396,.9358911689630978],[528,396,.5647311880602439],[528,397,.4159669183258934],[529,397,1.0181167840454461],[530,398,1.013385827369556],[531,398,.04614848859869256],[531,399,.9346402133241121],[532,399,.5659963065530312],[532,400,.41437595008823225],[533,400,1.0184005601646522],[534,401,1.0136232060250132],[535,401,.04710422079259773],[535,402,.9333610020906034],[536,402,.5672895085344858],[536,403,.41275194850334485],[537,403,1.0186878028359048],[538,404,1.0138647034793364],[539,404,.048082954782625906],[539,405,.9320538781067357],[540,405,.5686104542795039],[540,406,.4110954818363832],[541,406,1.0189782691001303],[542,407,1.0141101843606544],[543,407,.04908457922335384],[543,408,.9307191780153855],[544,408,.5699588101870642],[544,409,.40940711191046436],[545,409,1.0192717172488233],[546,410,1.0143595134378742],[547,410,.05010898832967291],[547,411,.9293572324099554],[548,411,.571334248633412],[548,412,.4076873942350095],[549,412,1.0195679069010588],[550,413,1.014612555604275],[551,413,.05115608171422347],[551,414,.9279683659767549],[552,414,.5727364478324755],[552,415,.4059368781231612],[553,415,1.0198665990790994],[554,416,1.0148691758602966],[555,416,.05222576422885553],[555,417,.9265528976348417],[556,417,.5741650916958022],[556,418,.40415610681371494],[557,418,1.0201675562784311],[558,419,1.0151292392959954],[559,419,.05331794581129548],[559,420,.9251111406735011],[560,420,.575619869698764],[560,421,.40234561758289383],[561,421,1.020470542537326],[562,422,1.0153926110734461],[563,422,.05443254133751677],[563,423,.9236434028815992],[564,423,.577100476753225],[564,424,.40050594185671334],[565,424,1.0207753235006762],[566,425,1.0156591564087798],[567,425,.05556947047932675],[567,426,.9221499866777003],[568,426,.5786066130792553],[568,427,.3986376053171075],[569,427,1.021081666483685],[570,428,1.0159287405542117],[571,428,.056728657567230105],[571,429,.9206311892316345],[572,429,.5801379840824749],[572,430,.3967411280111777],[573,430,1.0213893405291132],[574,431,1.016201228779567],[575,431,.057910031456259455],[575,432,.9190873025878152],[576,432,.5816943002369833],[576,433,.39481702444623007],[577,433,1.021698116466727],[578,434,1.0164764863538518],[579,434,.05911352539724152],[579,435,.9175186137811212],[580,435,.5832752769689779],[580,436,.3928658036922941],[581,436,1.0220077669657777],[582,437,1.0167543785266802],[583,437,.06033907691219022],[583,438,.9159254049505173],[584,438,.5848806345442068],[584,439,.3908879694785636],[585,439,1.022318066586335],[586,440,1.017034770509633],[587,440,.061586627674206584],[587,441,.914307953451257],[588,441,.58651009795775],[588,442,.3888840202832941],[589,442,1.0226287918300547],[590,443,1.017317527457434],[591,443,.06285612338957339],[591,444,.9126665319603182],[592,444,.5881633968320044],[592,445,.3868544494242516],[593,445,1.0229397211858324],[594,446,1.0176025144493452],[595,446,.06414751368695158],[595,447,.9110014085827639],[596,447,.5898402653081352],[596,448,.3847997451452973],[597,448,1.0232506351759092],[598,449,1.0178895964699735],[599,449,.06546075200505637],[599,450,.9093128469516464],[600,450,.5915404419502857],[600,451,.38272039070347513],[601,451,1.0235613163962847],[602,452,1.018178638390636],[603,452,.06679579548876291],[603,453,.9076011063291527],[604,453,.5932636696450677],[604,454,.3806168644453139],[605,454,1.0238715495601471],[606,455,1.0184695049504477],[607,455,.06815260488510425],[607,456,.9058664416991429],[608,456,.5950096955107654],[608,457,.37848963988927037],[609,457,1.024181121533852],[610,458,1.0187620607370533],[611,458,.06953114444294146],[611,459,.9041091038666588],[612,459,.5967782707982764],[612,460,.3763391858013562],[613,460,1.0244898213757605],[614,461,1.0190561701684775],[615,461,.07093138181829654],[615,462,.9023293395404434],[616,462,.5985691508103589],[616,463,.37416596626748977],[617,463,1.0247974403689852],[618,464,1.0193516974735164],[619,464,.07235328797779521],[619,465,.9005273914292568],[620,465,.6003820948062436],[620,466,.37197044076689306],[621,466,1.0251037720559506],[622,467,1.0196485066733956],[623,467,.07379683710904351],[623,468,.8987034983230944],[624,468,.6022168659211814],[624,469,.3697530642404009],[625,469,1.025408612268551],[626,470,1.01994646156273],[627,470,.07526200653052777],[627,471,.8968578951803935],[628,471,.6040732310832857],[628,472,.36751428715382667],[629,472,1.0257117591594511],[630,473,1.0202454256910738],[631,473,.07674877660715493],[631,474,.8949908132065928],[632,474,.6059509609308075],[632,475,.3652545555682938],[633,475,1.0260130132278693],[634,476,1.0205452623441595],[635,476,.07825713066499564],[635,477,.8931024799348216],[636,477,.6078498297369068],[636,478,.36297431119783957],[637,478,1.026312177347325],[638,479,1.0208458345252258],[639,479,.07978705490923481],[639,480,.8911931193041005],[640,480,.6097696153313106],[640,481,.360673991471839],[641,481,1.0266090567901067],[642,482,1.021147004936792],[643,482,.08133853834681559],[643,483,.8892629517341233],[644,483,.6117100990244927],[644,484,.3583540295921792],[645,484,1.0269034592511874],[646,485,1.0214486359623245],[647,485,.08291157270803175],[647,486,.8873121941972261],[648,486,.6136710655396947],[648,487,.35601485458732646],[649,487,1.0271951948700204],[650,488,1.0217505896477503],[651,488,.08450615237016054],[651,489,.885341060291742],[652,489,.6156523029400911],[652,490,.3536568913681695],[653,490,1.0274840762511013],[654,491,1.022052727683594],[655,491,.08612227428601159],[655,492,.8833497603088218],[656,492,.6176536025590085],[656,493,.3512805607832744],[657,493,1.02776991848203],[658,494,1.0223549113867765],[659,494,.08775993791161714],[659,495,.8813385013049766],[660,495,.6196747589336273],[660,496,.34888627966024516],[661,496,1.028052539155018],[662,497,1.0226570016825074],[663,497,.08941914513388247],[663,498,.8793074871648813],[664,498,.621715569739104],[664,499,.346474460866357],[665,499,1.0283317583791294],[666,500,1.0229588590871557],[667,500,.09109990020637701],[667,501,.8772569186645972],[668,501,.6237758357289777],[668,502,.34404551334349676],[669,502,1.0286073987990987],[670,503,1.023260343690056],[671,503,.09280220968027517],[671,504,.8751869935378795],[672,504,.6258553606671395],[672,505,.3415998421603758],[673,505,1.0288792856085094],[674,506,1.0235613151361742],[675,506,.09452608233896752],[675,507,.8730979065358732],[676,507,.6279539512706841],[676,508,.33913784855416224],[677,508,1.0291472465628844],[678,509,1.0238616326091752],[679,509,.09627152913686766],[679,510,.8709898494841083],[680,510,.6300714171530707],[680,511,.3366599299694516],[681,511,1.0294111119920568],[682,512,1.0241611548135297],[683,512,.09803856313307117],[683,513,.8688630113461538],[684,513,.6322075707612916],[684,514,.3341664801038121],[685,514,1.0296707148107829],[686,515,1.0244597399582411],[687,515,.09982719943517422],[687,516,.8667175782751595],[688,516,.6343622273238361],[688,517,.33165788894132453],[689,517,1.029925890529174],[690,518,1.024757245739534],[691,518,.10163745513498708],[691,519,.864553733672022],[692,519,.6365352047963319],[692,520,.32913454279236454],[693,520,1.0301764772610114],[694,521,1.0250535293244536],[695,521,.10346934925456013],[695,522,.8623716582378126],[696,522,.6387263238040831],[696,523,.32659682433041565],[697,523,1.0304223157317631],[698,524,1.0253484473338592],[699,524,.10532290268142636],[699,525,.8601715300305955],[700,525,.6409354075949926],[700,526,.32404511262442137],[701,526,1.0306632492858765],[702,527,1.0256418558269649],[703,527,.10719813812199533],[703,528,.8579535245094766],[704,528,.6431622819855923],[704,529,.3214797831731655],[705,529,1.0308991238920382],[706,530,1.0259336102845216],[707,530,.10909508003982304],[707,531,.855717814591042],[708,531,.6454067753119441],[708,532,.3189012079363341],[709,532,1.03112978814904],[710,533,1.0262235655929648],[711,533,.11101375459950885],[711,534,.8534645706974212],[712,534,.6476687183847731],[712,535,.31630975536452444],[713,535,1.0313550932895121],[714,536,1.0265115760290215],[715,536,.11295418962138112],[715,537,.8511939607995829],[716,537,.6499479444348513],[716,538,.3137057904341974],[717,538,1.0315748931821125],[718,539,1.0267974952437684],[719,539,.11491641452111552],[719,540,.8489061504692988],[720,540,.6522442890739327],[720,541,.3110896746693046],[721,541,1.0317890443354898],[722,542,1.027081176247435],[723,542,.11690046026072583],[723,543,.8466013029223681],[724,543,.6545575902471419],[724,544,.3084617661720711],[725,544,1.0319974058989068],[726,545,1.0273624713942857],[727,545,.11890635929917114],[727,546,.8442795790631381],[728,546,.6568876881880987],[728,547,.3058224196480645],[729,547,1.0321998396634169],[730,548,1.0276412323675237],[731,548,.12093414553884717],[731,549,.8419411375296247],[732,549,.6592344253774453],[732,550,.3031719864317822],[733,550,1.0323962100616533],[734,551,1.027917310164898],[735,551,.12298385427920393],[735,552,.8395861347312832],[736,552,.661597646501151],[736,553,.30051081451364153],[737,553,1.0325863841657408],[738,554,1.028190555083932],[739,554,.12505552216817234],[739,555,.8372147248951822],[740,555,.6639771984076539],[740,556,.2978392485576317],[741,556,1.0327702316879357],[742,557,1.0284608167076257],[743,557,.12714918714905468],[743,558,.8348270601054527],[744,558,.6663729300704698],[744,559,.2951576299293991],[745,559,1.0329476249762861],[746,560,1.0287279438905246],[747,560,.12926488841857217],[747,561,.8324232903405301],[748,561,.6687846925454237],[748,562,.2924662967182933],[749,562,1.0331184390116956],[750,563,1.0289917847447467],[751,563,.13140266637549056],[751,564,.8300035635173267],[752,564,.6712123389365675],[752,565,.28976558374944045],[753,565,1.033282551406384],[754,566,1.0292521866268258],[755,566,.13356256257828694],[755,567,.8275680255195722],[756,567,.6736557243576808],[756,568,.28705582261488644],[757,568,1.0334398423957492],[758,569,1.0295089961237516],[759,569,.1357446196959754],[759,570,.8251168202441111],[760,570,.6761147058925864],[760,571,.2843373416864493],[761,571,1.0335901948361186],[762,572,1.0297620590403478],[763,572,.13794888146102224],[763,573,.822650089632257],[764,573,.6785891425651428],[764,574,.2816104661359854],[765,574,1.0337334941973482],[766,575,1.0300112203862977],[767,575,.1401753926301894],[767,576,.8201679737037143],[768,576,.6810788952992894],[768,577,.278875517953921],[769,577,1.0338696285566522],[770,578,1.0302563243634062],[771,578,.14242419893016717],[771,579,.8176706105975015],[772,579,.6835838268889712],[772,580,.2761328159639002],[773,580,1.0339984885922306],[774,581,1.0304972143534852],[775,581,.14469534702456693],[775,582,.8151581365963325],[776,582,.6861038019600981],[776,583,.2733826758448351],[777,583,1.0341199675739228],[778,584,1.0307337329063364],[779,584,.14698888445850505],[779,585,.8126306861670012],[780,585,.6886386869453004],[780,586,.2706254101402667],[781,586,1.0342339613562985],[782,587,1.0309657217274584],[783,587,.14930485962229872],[783,588,.810088391991206],[784,588,.6911883500416512],[784,589,.267861328280309],[785,589,1.0343403683692496],[786,590,1.0311930216672842],[787,590,.1516433217043255],[787,591,.80753138499415],[788,591,.6937526611907388],[788,592,.2650907365900638],[789,592,1.0344390896084676],[790,593,1.0314154727094134],[791,593,.1540043206504027],[791,594,.8049597943767033],[792,594,.6963314920402311],[792,595,.2623139383094437],[793,595,1.034530028625162],[794,596,1.0316329139598897],[795,596,.1563879071152346],[795,597,.8023737476471726],[796,597,.6989247159176777],[796,598,.25953123360660696],[797,598,1.0346130915153564],[798,599,1.0318451836365417],[799,599,.15879413242528773],[799,600,.799773370648628],[800,600,.7015322078013413],[800,601,.256742919587031],[801,601,1.0346881869094755],[802,602,1.0320521190584917],[803,602,.16122304853347555],[803,603,.7971587875884961],[804,603,.7041538442893039],[804,604,.2539492903120581],[805,604,1.0347552259598483],[806,605,1.032253556636297],[807,605,.16367470797552194],[807,606,.7945301210672343],[808,606,.7067895035746306],[808,607,.2511506368077842],[809,607,1.0348141223290412],[810,608,1.0324493318619021],[811,608,.16614916382632547],[811,609,.7918874921076472],[812,609,.709439065413448],[812,610,.24834724708249672],[813,610,1.0348647921767888],[814,611,1.032639279299876],[815,611,.1686464696616927],[815,612,.7892310201754584],[816,612,.7121024111062217],[816,613,.24553940613187852],[817,613,1.0349071541468273],[818,614,1.0328232325774014],[819,614,.17116667951302045],[819,615,.7865608232133336],[820,615,.7147794234616441],[820,616,.24272739595679857],[821,616,1.0349411293537],[822,617,1.0330010243763053],[823,617,.17370984782335191],[823,618,.7838770176637189],[824,618,.7174699867799718],[824,619,.23991149556876706],[825,619,1.0349666413686411],[826,620,1.033172486424039],[827,620,.17627602940857415],[827,621,.7811797184924586],[828,621,.720173986819918],[828,622,.23709198101021747],[829,622,1.0349836162040225],[830,623,1.0333374494861536],[831,623,.1788652794118951],[831,624,.7784690392157592],[832,624,.7228913107823544],[832,625,.234269125354749],[833,625,1.0349919822996723],[834,626,1.0334957433581187],[835,626,.18147765326305537],[835,627,.7757450919251534],[836,627,.7256218472813651],[836,628,.23144319872166874],[837,628,1.0349916705072433],[838,629,1.033647196858036],[839,629,.1841132066386375],[839,630,.773007987305413],[840,630,.7283654863202004],[840,631,.22861446829229304],[841,631,1.0349826140730403],[842,632,1.033791637819688],[843,632,.1867719954109858],[843,633,.7702578346682248],[844,633,.7311221192693971],[844,634,.2257831983137577],[845,634,1.0349647486235953],[846,635,1.0339288930859631],[847,635,.18945407561392777],[847,636,.7674947419659374],[848,636,.7338916388459672],[848,637,.22294965011006523],[849,637,1.0349380121480094],[850,638,1.0342420464149167],[851,638,.1924281237940313],[851,639,.5378425839134362],[852,639,.5202524171708031],[852,640,.4568109772775498],[852,641,.05199677850209752],[853,640,.24351254102567055],[853,641,.5225687624093359],[853,642,.2921493228893563],[854,642,.25538328243481595],[854,643,.5241438210153896],[854,644,.23257172527298814],[855,643,.011987787701546808],[855,644,.3172219958151092],[855,645,.4868674616302827],[855,646,.176468024136203],[856,645,.07357769424953754],[856,646,.38294232266815553],[856,647,.4259205416014665],[856,648,.11753224171517974],[857,647,.13246196705929972],[857,648,.4398303708699065],[857,649,.36708371923835004],[857,650,.06067586883292038],[858,649,.18926719214302565],[858,650,.4946697651421086],[858,651,.3040061179704405],[858,652,.005602736230038195],[859,651,.23906249586178907],[859,652,.5231149368578739],[859,653,.2495840468006932],[860,653,.2897970473112013],[860,654,.5026442283960142],[860,655,.20274559579570214],[861,654,.04664315619110009],[861,655,.3473240465998149],[861,656,.4526192727121032],[861,657,.1523595035438806],[862,656,.09766699822939251],[862,657,.3969699779916487],[862,658,.40188113292822186],[862,659,.1034820659161816],[863,658,.14649823031506354],[863,659,.44395391725661004],[863,660,.3530826952522148],[863,661,.056517279244449437],[864,660,.193417537810633],[864,661,.48905272813711814],[864,662,.30196784607077015],[864,663,.011088189502860925],[865,662,.235165441654809],[865,663,.5161755064939912],[865,664,.25593745749264785],[866,664,.27598857145168865],[866,665,.5055165820237347],[866,666,.21733399798014585],[867,665,.03142691535889764],[867,666,.321995701601107],[867,667,.4677769922252197],[867,668,.17692400337387545],[868,667,.07312870986769164],[868,668,.3630952451007391],[868,669,.4264378437134144],[868,670,.13731285791147696],[869,669,.11270032695167025],[869,670,.4009509624326517],[869,671,.38688927555227676],[869,672,.09946833663506985],[870,671,.15050630725355646],[870,672,.43706477714430675],[870,673,.34910378546507886],[870,674,.06336347754327785],[871,673,.1865736616624162],[871,674,.4714631653468664],[871,675,.3125696686315781],[871,676,.028869775846049314],[872,675,.22058655357283705],[872,676,.502393455771382],[872,677,.27458473006488804],[873,677,.24983886475629993],[873,678,.5137748593109537],[873,679,.24315322539257223],[874,678,.0036240101488931717],[874,679,.2812413419420975],[874,680,.49584386088869215],[874,681,.2153614227018543],[875,680,.034735500335029305],[875,681,.3144060917430617],[875,682,.46485314373790926],[875,683,.18595981453922283],[876,682,.0641063484572785],[876,683,.34219859962945964],[876,684,.43549740951782173],[876,685,.15817234633893226],[877,684,.091864261548934],[877,685,.3683988258245694],[877,686,.407752916631107],[877,687,.13197572785525458],[878,686,.11803256264694018],[878,687,.3930296465168421],[878,688,.3815964769154389],[878,689,.10734720976073055],[879,688,.1426340315995158],[879,689,.4161134070872291],[879,690,.35700543857338174],[879,691,.08426456699687354],[880,690,.16569092182506315],[880,691,.43767193845249674],[880,692,.33395766972405766],[880,693,.06270608273067858],[881,692,.1872249764612122],[881,693,.457726572814142],[881,694,.3124315425508366],[881,695,.04265053289025597],[882,694,.20725744392861123],[882,695,.47629815883858434],[882,696,.29240591801936916],[882,697,.024077171256560802],[883,696,.22580909293436022],[883,697,.49340707629100294],[883,698,.272739666255128],[883,699,.006906252371233933],[884,698,.24190643067177103],[884,699,.5047275543873398],[884,700,.2549459812508028],[885,700,.2567100539467806],[885,701,.5031577036963546],[885,702,.24065881914660317],[886,701,.008634717813202674],[886,702,.27224949572145724],[886,703,.49094674236787206],[886,704,.22719544196570912],[887,703,.02292373131969297],[887,704,.28597629401801355],[887,705,.47672398599653515],[887,706,.2143533208320832],[888,705,.035751602096786475],[888,706,.29743237559552355],[888,707,.46390276826706217],[888,708,.20289630196958544],[889,707,.04719579903029385],[889,708,.3075210742305127],[889,709,.45246460115847775],[889,710,.19280622955805915],[890,709,.057274491299496445],[890,710,.3162602301176305],[890,711,.4423913913890736],[890,712,.18406533389761395],[891,711,.0660054606502899],[891,712,.3236673045470217],[891,713,.43366542899845073],[891,714,.17665622026124392],[892,713,.07340611260620647],[892,714,.3297593908476435],[892,715,.4262693763198494],[892,716,.17056185812791913],[893,715,.07949348729590157],[893,716,.33455322495703466],[893,717,.42018625732795906],[893,718,.16576557078065143],[894,717,.0842842699121286],[894,718,.3380651956328206],[894,719,.41539944734620887],[894,720,.16225102525634236],[895,719,.0877948008176482],[895,720,.3403113543186734],[895,721,.41189266310148215],[895,722,.1600022226324315],[896,721,.09004108530992379],[896,722,.3413074246800344],[896,723,.4096499531105413],[896,724,.15900348863810745],[897,723,.0910388030604564],[897,724,.341068811820455],[897,725,.4086556883871424],[897,726,.15923946457791555],[898,725,.09080331723824445],[898,726,.33961061119156805],[898,727,.40889455345709996],[898,728,.16069509855546693],[899,727,.08934968333179105],[899,728,.33694761720865024],[899,729,.41035153766953336],[899,730,.1633556369851302],[900,729,.08669265767999552],[900,730,.33309433158306806],[900,731,.41301192679237225],[900,732,.16720661638248935],[901,731,.08284670572359325],[901,732,.32806497138102175],[901,733,.41686129488304347],[901,734,.17223385542154263],[902,733,.0778260099865808],[902,734,.3218734768206457],[902,735,.421885496422382],[902,736,.17842344724960524],[903,735,.07164447779930824],[903,736,.31453351881588426],[903,737,.42807065870301164],[903,738,.185761752049803],[904,737,.06431574877136567],[904,738,.3060585062772846],[904,739,.435403174462235],[904,740,.19423538984244326],[905,739,.05585320202451507],[905,740,.29646159317816856],[905,741,.4438696947508069],[905,742,.20383123351642937],[906,741,.04626996319383157],[906,742,.2857556853951481],[906,743,.4534571220289279],[906,744,.21453640208174513],[907,743,.03557891120608933],[907,744,.27395344733160587],[907,745,.4640838862781736],[907,746,.2259711147745072],[908,745,.02378916236694485],[908,746,.26064383557298154],[908,747,.4744097020055178],[908,748,.23741469023048611],[908,749,.0029874664482454345],[909,747,.010888485342882084],[909,748,.24524012825579347],[909,749,.47705262348683797],[909,750,.25146343127990345],[909,751,.018030374036361534],[910,750,.23051594568994063],[910,751,.4659638155007443],[910,752,.26789265476733026],[910,753,.034103962104678205],[911,752,.2157780537828917],[911,753,.4490488012027463],[911,754,.28394240197843773],[911,755,.051207169174446954],[912,754,.19869680451466967],[912,755,.4309201309554197],[912,756,.3010279740476113],[912,757,.06933596927309439],[913,756,.18059146729117878],[913,757,.4117775174928008],[913,758,.3191380672559441],[913,759,.08847923890660256],[914,758,.16147315955443303],[914,759,.3916318997027402],[914,760,.33826157637971177],[914,761,.10862604895508292],[915,760,.14135280401108383],[915,761,.37049402581791996],[915,762,.35838758963377015],[915,763,.12976565972904766],[916,762,.12024113359574008],[916,763,.34837445826725],[916,764,.3795053837685538],[916,765,.15188751617588445],[917,764,.0981486962833266],[917,765,.32528357838026745],[917,766,.40160441931520835],[917,767,.17498124323033803],[918,766,.07508585975635881],[918,767,.30123159095005636],[918,768,.42467433597326765],[918,769,.19903664130457108],[919,768,.05106281593203439],[919,769,.2762285286588279],[919,770,.4480441892579001],[919,771,.22091817857346802],[920,770,.02605116606412028],[920,771,.24679268601046497],[920,772,.4613333588465915],[920,773,.24636316696152993],[920,774,.026661594315488448],[921,772,.00017143112777602207],[921,773,.22016507993495968],[921,774,.4450006731455823],[921,775,.27654268563105877],[921,776,.05450703342817279],[922,775,.19537707282293476],[922,776,.4169980825615683],[922,777,.3043455873211709],[922,778,.08322496813649063],[923,777,.16671893224886847],[923,778,.3873911007134449],[923,779,.333032487802997],[923,780,.11284587069811512],[924,779,.1371380798307044],[924,780,.3568813039463011],[924,781,.36262258254682433],[924,782,.14336176762117853],[925,781,.10666365535341012],[925,782,.32548606626333626],[925,783,.39310680323983005],[925,784,.17476372572452537],[926,783,.07530458232966944],[926,784,.2932141772790525],[926,785,.4235343782302751],[926,786,.20429957725699868],[927,785,.04297407877416276],[927,786,.2566282342451322],[927,787,.44609730979381396],[927,788,.23600300007995265],[927,789,.023774697332874434],[928,787,.00973561058609779],[928,788,.22213324067090034],[928,789,.4366882593279592],[928,790,.27231575108916795],[928,791,.058813271383982776],[929,790,.1899112794795718],[929,791,.4051174305988943],[929,792,.3087329260703045],[929,793,.09459113946159277],[930,792,.15536737862587172],[930,793,.36909687837539557],[930,794,.3443998634306182],[930,795,.13113054742980831],[931,794,.11887833690004168],[931,795,.3317399346424034],[931,796,.3809015150071346],[931,797,.1684974582828263],[932,796,.08156315084174257],[932,797,.29356399783457987],[932,798,.4168389957384664],[932,799,.2027189344423823],[933,798,.043285265762028874],[933,799,.2496929999720567],[933,800,.44089395742648096],[933,801,.24052352812737388],[933,802,.03507425254057242],[934,800,.0043335535351657515],[934,801,.21027601904641954],[934,802,.42143856683278325],[934,803,.2844016743443022],[934,804,.07585590645285804],[935,803,.17353832434253885],[935,804,.38262846297038483],[935,805,.3257498632562316],[935,806,.11730189433403454],[936,805,.13268775789077444],[936,806,.3407519309130924],[936,807,.3670972990020704],[936,808,.15947396875496164],[937,807,.09057464650490143],[937,808,.2978183751219168],[937,809,.40749895190525254],[937,810,.19795010289674397],[938,809,.0474866463063797],[938,810,.24850494279526708],[938,811,.4346436181876547],[938,812,.2403211224239381],[938,813,.04014881320170647],[939,811,.003878639500178961],[939,812,.2047038150773143],[939,813,.41157455841171137],[939,814,.28957529821809164],[939,815,.08560320920592149],[940,814,.16385621221760913],[940,815,.36828320787286745],[940,816,.33550406688664397],[940,817,.13164677712134118],[941,816,.11836297424309958],[941,817,.32185871977911545],[941,818,.3799973298161782],[941,819,.17581896778117206],[942,818,.07143918326167292],[942,819,.2705029465809176],[942,820,.4180894904987747],[942,821,.22040151023922497],[942,822,.023261093492508676],[943,820,.023754358875460287],[943,821,.22082957274806367],[943,822,.41735892037093947],[943,823,.26975946681527463],[943,824,.07244459405934162],[944,823,.17462856886910824],[944,824,.376380003235797],[944,825,.32258384746152186],[944,826,.12234695850241085],[945,825,.12764964491952732],[945,826,.32754202842781277],[945,827,.3705351976091778],[945,828,.17002290467196218],[946,827,.07705703864783364],[946,828,.27228373423426855],[946,829,.4119493110954956],[946,830,.21796235075295245],[946,831,.024608216085607083],[947,829,.025780053026113373],[947,830,.2190518649272109],[947,831,.41169318411556594],[947,832,.27077590916361477],[947,833,.07732052594065236],[948,832,.1695115580680664],[948,833,.36773423672329814],[948,834,.3275311475162098],[948,835,.13077893984001213],[949,834,.11922966876699366],[949,835,.31565346594837984],[949,836,.37813100062036553],[949,837,.17991281790206778],[950,836,.06510103041600655],[950,837,.25463712967072577],[950,838,.4162975451493948],[950,839,.23222690463246418],[950,840,.043347365043106205],[951,838,.010682336294089382],[951,839,.20025854636251755],[951,840,.3947874901107556],[951,841,.2917173663646273],[951,842,.09950708368621437],[952,841,.14911244770443477],[952,842,.3431424199239878],[952,843,.3480530442639449],[952,844,.15411315971947762],[953,843,.0934299055238343],[953,844,.2830893937829872],[953,845,.3971235804951196],[953,846,.20716078374370134],[953,847,.020137203526012115],[954,845,.036025540013401365],[954,846,.22261124110739972],[954,847,.40630997808531094],[954,848,.2648205963423913],[954,849,.07872881878459281],[955,848,.16692727676480973],[955,849,.35954874836594064],[955,850,.328443108696204],[955,851,.13751082396144756],[956,850,.11152248261980105],[956,851,.3006327942159715],[956,852,.3829521945790107],[956,853,.1916328343080391],[956,854,.0076262937092498664],[957,852,.0514953905500914],[957,853,.2343500090068106],[957,854,.41021535649217705],[957,855,.25030428726128284],[957,856,.06835964516566889],[958,855,.17563114080501685],[958,856,.3667504924135684],[958,857,.31835263030310357],[958,858,.1299663000321827],[959,857,.11940718803292909],[959,858,.3065438045294419],[959,859,.37569491987401304],[959,860,.18605528589059708],[959,861,.004834820768368334],[960,859,.05684866493974193],[960,860,.2366688077210537],[960,861,.4085057240274029],[960,862,.24678375999468344],[960,863,.06783571840441664],[961,862,.17558642045742334],[961,863,.36451985113857055],[961,864,.3173137388508224],[961,865,.13129392160626782],[962,864,.11725721455632943],[962,865,.3008194332920608],[962,866,.37580301677160466],[962,867,.19024874552861262],[962,868,.011245575393110812],[963,866,.05231298976932004],[963,867,.23017401181136463],[963,868,.40175554736854613],[963,869,.2536595659979476],[963,870,.07679940668774121],[964,869,.16706057585212106],[964,870,.35303258747063304],[964,871,.3251768586309606],[964,872,.14116418004635392],[965,871,.10550294433561781],[965,872,.28424844668945237],[965,873,.38249269088982873],[965,874,.2036626805762719],[965,875,.02684871916582402],[966,873,.03836058116912999],[966,874,.21480488879977247],[966,875,.389260042863657],[966,876,.27095452974310497],[966,877,.09504101254228686],[967,876,.1502807743955375],[967,877,.3328577086192332],[967,878,.3421239629983485],[967,879,.15918522100542254],[968,878,.08474515454977341],[968,879,.25820758590913884],[968,880,.3938397310124852],[968,881,.22523159171338067],[968,882,.05190695217080459],[969,880,.015820211753405387],[969,881,.19007905592596833],[969,882,.36921246833932636],[969,883,.2980889913883655],[969,884,.12132017371569158],[970,883,.1247775639085626],[970,884,.3015570552958629],[970,885,.36552163552482225],[970,886,.18684713857492927],[970,887,.014284415706242481],[971,885,.055013622481818666],[971,886,.2263705108609403],[971,887,.39186593267986564],[971,888,.2561333080985603],[971,889,.08592049273991473],[972,888,.1575841200944441],[972,889,.3370827060887002],[972,890,.33284859953655166],[972,891,.15390042438231766],[973,890,.08972988049108406],[973,891,.2590326783958039],[973,892,.38812639016604245],[973,893,.22348813860080616],[973,894,.054161074977768404],[974,892,.017081968749935856],[974,893,.18740927170107446],[974,894,.3625874079443392],[974,895,.2990263270079478],[974,896,.12613079428882987],[975,895,.11819045745461297],[975,896,.28905735771716573],[975,897,.36789499357104777],[975,898,.19628130377264577],[975,899,.02735424128922767],[976,897,.04494375361325131],[976,898,.21330043570426716],[976,899,.37902147922066165],[976,900,.2697531768133337],[976,901,.10241904377888808],[977,900,.14130067843136315],[977,901,.3150246804904708],[977,902,.3480110183643501],[977,903,.1725701388645175],[977,904,.005966983373903607],[978,902,.06884101502859519],[978,903,.23351128359258333],[978,904,.3898863909020141],[978,905,.24593198700119934],[978,906,.08224765045066],[979,905,.1597942440306211],[979,906,.3346851109670727],[979,907,.3285973743088808],[979,908,.15444027476874822],[980,907,.08792661347585409],[980,908,.2508895640647832],[980,909,.38533070676895603],[980,910,.22893712756876922],[980,911,.06583953763953361],[981,909,.01060737785460527],[981,910,.17530908392596897],[981,911,.34707093920704996],[981,912,.3101853041457825],[981,913,.1404924603408273],[982,912,.1016482122325276],[982,913,.2640331008343238],[982,914,.3757885914855772],[982,915,.21658719088481612],[982,916,.05379076081392352],[983,914,.023321537452804155],[983,915,.1869789080592518],[983,916,.35433193126746176],[983,917,.2960976478285003],[983,918,.13047091456929613],[984,917,.11086010315035294],[984,918,.272590889791831],[984,919,.3683410258652817],[984,920,.20801518542415245],[984,921,.04616290894518408],[985,919,.03202626907959427],[985,920,.1942489952348069],[985,921,.35801621736570555],[985,922,.2871844809716754],[985,923,.12448425960359358],[986,922,.11614980664040801],[986,923,.2769245860037902],[986,924,.3634503371272694],[986,925,.20337777894188264],[986,926,.04278533591281287],[987,924,.036633170664026604],[987,925,.19735437260885233],[987,926,.3585975660673821],[987,927,.28298312203941667],[987,928,.12237172260813765],[988,927,.11761764880185657],[988,928,.2769347836061358],[988,929,.3613222869658947],[988,930,.20269252495682932],[988,931,.04352084243134597],[989,929,.03715658569409518],[989,930,.19646584076452728],[989,931,.3563193376763676],[989,932,.28325914825402143],[989,933,.12401877287718965],[990,932,.11535841088563661],[990,933,.2726772185957825],[990,934,.36193002492598775],[990,935,.2058724789923987],[990,936,.04828585408934835],[991,934,.03368059076582972],[991,935,.19166681871807822],[991,936,.35120102320155516],[991,937,.2879669101334489],[991,938,.12934311950798513],[992,937,.10947528483272252],[992,938,.2643619456949593],[992,939,.36503164238003943],[992,940,.21273290367631378],[992,941,.05704255868679827],[993,939,.026351338857843194],[993,940,.18296002570453515],[993,941,.3430562989307297],[993,942,.29724916938947604],[993,943,.13830626997954892],[994,942,.10006782116457263],[994,943,.2523219642979947],[994,944,.3701807952606593],[994,945,.22297333198451888],[994,946,.06976592160365215],[995,944,.015392306252147629],[995,945,.17030051412165803],[995,946,.33152253946088156],[995,947,.31147369956054877],[995,948,.1509473916728322],[996,947,.087196881644584],[996,948,.2369586950063475],[996,949,.376718339613223],[996,950,.2345765114615184],[996,951,.08521591343298078],[997,949,.0011357385555340561],[997,950,.15263475001807864],[997,951,.311827742306229],[997,952,.32860504822914505],[997,953,.16942021655341175],[997,954,.016626147439510436],[998,952,.07024774813594223],[998,953,.2212622403680772],[998,954,.36621398307130515],[998,955,.2523140266095425],[998,956,.10329850546808812],[999,955,.13345393361930616],[999,956,.2868146645965228],[999,957,.3438149621043634],[999,958,.19052159754051476],[999,959,.038598535306774456],[1e3,957,.04874340776161587],[1e3,958,.20027433884645776],[1e3,959,.35045072214288214],[1e3,960,.2752172040116266],[1e3,961,.1246081801436533],[1001,960,.11153410463061227],[1001,961,.25968030157128735],[1001,962,.3589611456155988],[1001,963,.21376355164890676],[1001,964,.06462574300561937],[1002,962,.024112239164856285],[1002,963,.1744379670887302],[1002,964,.32884307142135794],[1002,965,.3038963549633426],[1002,966,.14989396525089382],[1002,967,.002787631885767016],[1003,965,.08652179776851913],[1003,966,.23158274748299973],[1003,967,.37014802862444746],[1003,968,.23660182809114255],[1003,969,.09233857620429504],[1004,968,.14320871996140178],[1004,969,.2949268298641504],[1004,970,.33370967770704096],[1004,971,.1821563205430922],[1004,972,.03341416685633306],[1005,970,.05691996613850173],[1005,971,.2048164607341282],[1005,972,.34996958396767003],[1005,973,.26846185022737096],[1005,974,.12203613352843197],[1006,973,.11270360292617912],[1006,974,.2573174820670815],[1006,975,.35551075517876596],[1006,976,.21342439841857963],[1006,977,.06808655521031844],[1007,975,.02300584415020569],[1007,976,.1693741701851818],[1007,977,.31909197071849676],[1007,978,.3064750144925845],[1007,979,.1569666027177789],[1007,980,.01237576860780718],[1008,978,.07918600624195261],[1008,979,.22224585329482],[1008,980,.36060022658704466],[1008,981,.24542280629144228],[1008,982,.10372340547250797],[1009,981,.13025049048804305],[1009,982,.2755544084078468],[1009,983,.34173289952302016],[1009,984,.19757209548510224],[1009,985,.052414383405106256],[1010,983,.04055057399599624],[1010,984,.18602861646793578],[1010,985,.3325126760154172],[1010,986,.28836807114447566],[1010,987,.1417402962688462],[1010,988,.0007268068329768394],[1011,986,.0921230324039655],[1011,987,.23132424535108578],[1011,988,.3651955312519228],[1011,989,.23251096307120944],[1011,990,.09383068210249161],[1012,989,.1395300348660987],[1012,990,.2846106560560243],[1012,991,.33325384799782276],[1012,992,.18901293891606955],[1012,993,.045352651706964286],[1013,991,.0492531143811913],[1013,992,.19272260635298227],[1013,993,.33561458168523745],[1013,994,.27986377343343843],[1013,995,.13637852619084528],[1014,994,.09650852938196901],[1014,995,.2338020594070448],[1014,996,.36193613166585775],[1014,997,.22898317334607854],[1014,998,.09193468643195023],[1015,996,.002457496874436509],[1015,997,.14093777570167637],[1015,998,.28368384860268375],[1015,999,.33027760738271117],[1015,1e3,.1884400273628213],[1015,1001,.046968846655108074],[1016,999,.04899295849310335],[1016,1e3,.19034003312195327],[1016,1001,.3313219755276299],[1016,1002,.28105052006571385],[1016,1003,.13948843868730657],[1016,1004,.0023949943264103815],[1017,1002,.09296476581718328],[1017,1003,.22852898102309294],[1017,1004,.35981389159869226],[1017,1005,.23289594529521537],[1017,1006,.09793041579114306],[1018,1005,.13381394889325862],[1018,1006,.27358691892030107],[1018,1007,.33460745416509985],[1018,1008,.1955825556102765],[1018,1009,.05665143264068217],[1019,1007,.040361378819567154],[1019,1008,.17925977203170015],[1019,1009,.31806447498945245],[1019,1010,.2909077306146313],[1019,1011,.1516962543781077],[1019,1012,.01525050343287846],[1020,1010,.08150854362929537],[1020,1011,.21698349128246774],[1020,1012,.3497669475500838],[1020,1013,.24583808157633427],[1020,1014,.11136370502634059],[1021,1013,.1194990282921764],[1021,1014,.25479878825131264],[1021,1015,.34346022054644576],[1021,1016,.20933239464254857],[1021,1017,.07400664151417581],[1022,1015,.023670383811016393],[1022,1016,.1594303860158249],[1022,1017,.29640289279632487],[1022,1018,.3088876485347881],[1022,1019,.17249814489158258],[1022,1020,.03643709112995095],[1023,1018,.062217701784737935],[1023,1019,.19815982330648652],[1023,1020,.3337745723213922],[1023,1021,.3700921432339217],[1023,1022,.3700921432339217]];function c(){let S=r.buffer([1024,1024]);for(let F=0;F<u.length;F++){let R=u[F];S.set(R[2],R[0],R[1])}return S.toTensor()}function h(S,F,R){return r.div(r.sub(S,R),F)}function f(S){return Te(this,null,function*(){return function(F,R){let L=F.length,q=F[0].length/2,U=R.winLength||q,Z=R.hopLength||Math.floor(U/4),ee=R.center||!1,Q=Object(a.b)(U);for(let fe=0;fe<Q.length;fe++)Q[fe]=Q[fe]/1.5;Q=Object(a.h)(Q,q);let oe=q+Z*(L-1),se=new Float32Array(oe);for(let fe=0;fe<L;fe++){let he=fe*Z,Ee=d(F[fe]);Ee=Object(a.a)(Ee,Q),Ee=p(Ee,se.slice(he,he+q)),se.set(Ee,he)}let pe=0,ae=oe;return ee?(pe=q/2,ae=se.length-q/2):(pe=oe-64e3,ae=se.length-pe),se.slice(pe,ae)}(S,{nFFt:2048,winLength:2048,hopLength:512,sampleRate:16e3,center:!1})})}function g(S){return Te(this,null,function*(){let F=r.tidy(()=>{let q=r.slice(S,[0,0,0,0],[1,-1,-1,1]).reshape([1,128,1024]),U=(Z=q,r.tidy(()=>{let ae=c().expandDims(0),fe=h(Z,.0661371661726,.113718730221),he=r.exp(fe),Ee=r.matMul(he,ae);return r.sqrt(Ee)}));var Z;let ee=function(ae){return r.tidy(()=>{let fe=c().expandDims(0),he=h(ae,.8,0),Ee=r.cumsum(r.mul(he,Math.PI),1);return r.matMul(Ee,fe)})}(r.slice(S,[0,0,0,1],[1,-1,-1,1]).reshape([1,128,1024])),Q=U.mul(r.cos(ee)),oe=r.reverse(Q.slice([0,0,0],[1,128,1023]),2);Q=r.concat([Q,oe],2);let se=U.mul(r.sin(ee)),pe=r.reverse(se.slice([0,0,0],[1,128,1023]),2);return se=r.concat([se,r.mul(pe,-1)],2),[Q,se]}),R=yield function(q,U){let Z=r.tidy(()=>{let oe=r.concat([q,U],0).expandDims(3);return oe=r.pad(oe,[[0,0],[0,0],[1,0],[0,0]]),r.batchToSpaceND(oe,[1,2],[[0,0],[0,0]]).reshape([128,4096])}),ee=Z.dataSync(),Q=[];for(let oe=0;oe<128;oe++)Q[oe]=ee.slice(4096*oe,4096*(oe+1));return Z.dispose(),Q}(F[0],F[1]),L=yield f(R);return F.forEach(q=>q.dispose()),L})}function d(S){let F=S.length/2,R=new i(F),L=R.createComplexArray();return R.inverseTransform(L,S),R.fromComplexArray(L)}function p(S,F){if(S.length!==F.length)return console.error(`Array lengths must be equal to add: ${S.length}, ${S.length}`),null;let R=new Float32Array(S.length);for(let L=0;L<S.length;L++)R[L]=S[L]+F[L];return R}class m extends r.layers.Layer{constructor(F=1e-8,R={}){super(R),this.epsilon=F,this.layerConfig=R,this.supportsMasking=!0}computeOutputShape(F){return[F[0],F[1],F[2],F[3]]}call(F){return r.tidy(()=>{let R=F;Array.isArray(R)&&(R=R[0]);let L=r.mean(r.square(R),[3],!0);return r.mul(R,r.rsqrt(r.add(L,this.epsilon)))})}getClassName(){return"PixelNorm"}}function y(S=1e-8,F={}){return new m(S,F)}class v extends r.layers.Layer{constructor(F=2,R=16,L={}){super(L),this.kernelH=F,this.kernelW=R,this.layerConfig=L,this.supportsMasking=!0}computeOutputShape(F){return[F[0],2*(this.kernelH-1)+F[1],2*(this.kernelW-1)+F[2],F[3]]}call(F){let R=F;Array.isArray(R)&&(R=R[0]);let L=this.kernelH-1,q=this.kernelW-1;return r.pad(R,[[0,0],[L,L],[q,q],[0,0]])}getClassName(){return"InitialPad"}}class N extends r.layers.Layer{constructor(F=2){super({}),this.scale=F,this.supportsMasking=!0}computeOutputShape(F){return[F[0],this.scale*F[1],this.scale*F[2],F[3]]}call(F){return r.tidy(()=>{let R=F;Array.isArray(R)&&(R=R[0]);let L=r.tile(R,[this.scale**2,1,1,1]);return r.batchToSpaceND(L,[this.scale,this.scale],[[0,0],[0,0]])})}getClassName(){return"BoxUpscale"}}function T(S=2){return new N(S)}class O{constructor(F){this.nn=r.sequential(),this.nLatents=256,this.nPitches=61,this.minMidiPitch=24,this.maxMidiPitch=84,this.midiPitches=this.maxMidiPitch-this.minMidiPitch+1,this.checkpointURL=F}initialize(){return Te(this,null,function*(){let F=s.d.now(),R=yield Object(s.a)(this.checkpointURL+"/weights_manifest.json").then(L=>L.json()).then(L=>r.io.loadWeights(L,this.checkpointURL));r.tidy(()=>{for(let L in R)if(L.includes("kernel")){let q=R[L].shape[0]*R[L].shape[1]*R[L].shape[2],U=R[L];R[L]=r.mul(U,r.sqrt(2/q)),U.dispose()}this.build(R),this.initialized=!0,o.logWithDuration("Initialized model",F,"GANSynth")}),Object.keys(R).map(L=>R[L].dispose())})}dispose(){this.initialized&&(this.nn.dispose(),this.initialized=!1)}isInitialized(){return this.initialized}build(F){r.tidy(()=>{let R={filters:256,kernelSize:[2,16],strides:[1,1],activation:"linear",useBias:!0,padding:"valid",dilationRate:[1,1],trainable:!1},L={inputShape:[1,1,this.nLatents+this.nPitches]};this.nn.add(y(1e-8,L)),this.nn.add(function(U=2,Z=16,ee={}){return new v(U,Z,ee)}(2,16)),this.nn.add(r.layers.conv2d(R)),this.nn.add(r.layers.leakyReLU({alpha:.2})),this.nn.add(y()),R.padding="same",R.kernelSize=[3,3],this.nn.add(r.layers.conv2d(R)),this.nn.add(r.layers.leakyReLU({alpha:.2})),this.nn.add(y());let q=[256,256,256,128,64,32];for(let U=0;U<q.length;U++)this.nn.add(T(2)),R.filters=q[U],this.nn.add(r.layers.conv2d(R)),this.nn.add(r.layers.leakyReLU({alpha:.2})),this.nn.add(y()),this.nn.add(r.layers.conv2d(R)),this.nn.add(r.layers.leakyReLU({alpha:.2})),this.nn.add(y());R.filters=2,R.kernelSize=[1,1],R.activation="tanh",this.nn.add(r.layers.conv2d(R)),this.setWeights(F)})}setWeights(F){function R(U){let Z=F[U];if(Z===void 0)throw Error("Variable not found: "+U);return Z}let L="Generator/progressive_gan_generator/progressive_gan_block_",q=[R(L+"1/conv0/conv2d/kernel/ExponentialMovingAverage"),R(L+"1/conv0/bias/ExponentialMovingAverage"),R(L+"1/conv1/conv2d/kernel/ExponentialMovingAverage"),R(L+"1/conv1/bias/ExponentialMovingAverage"),R(L+"2/conv0/conv2d/kernel/ExponentialMovingAverage"),R(L+"2/conv0/bias/ExponentialMovingAverage"),R(L+"2/conv1/conv2d/kernel/ExponentialMovingAverage"),R(L+"2/conv1/bias/ExponentialMovingAverage"),R(L+"3/conv0/conv2d/kernel/ExponentialMovingAverage"),R(L+"3/conv0/bias/ExponentialMovingAverage"),R(L+"3/conv1/conv2d/kernel/ExponentialMovingAverage"),R(L+"3/conv1/bias/ExponentialMovingAverage"),R(L+"4/conv0/conv2d/kernel/ExponentialMovingAverage"),R(L+"4/conv0/bias/ExponentialMovingAverage"),R(L+"4/conv1/conv2d/kernel/ExponentialMovingAverage"),R(L+"4/conv1/bias/ExponentialMovingAverage"),R(L+"5/conv0/conv2d/kernel/ExponentialMovingAverage"),R(L+"5/conv0/bias/ExponentialMovingAverage"),R(L+"5/conv1/conv2d/kernel/ExponentialMovingAverage"),R(L+"5/conv1/bias/ExponentialMovingAverage"),R(L+"6/conv0/conv2d/kernel/ExponentialMovingAverage"),R(L+"6/conv0/bias/ExponentialMovingAverage"),R(L+"6/conv1/conv2d/kernel/ExponentialMovingAverage"),R(L+"6/conv1/bias/ExponentialMovingAverage"),R(L+"7/conv0/conv2d/kernel/ExponentialMovingAverage"),R(L+"7/conv0/bias/ExponentialMovingAverage"),R(L+"7/conv1/conv2d/kernel/ExponentialMovingAverage"),R(L+"7/conv1/bias/ExponentialMovingAverage"),R(L+"7/to_rgb/conv2d/kernel/ExponentialMovingAverage"),R(L+"7/to_rgb/bias/ExponentialMovingAverage")];this.nn.setWeights(q)}predict(F,R){return this.nn.predict(F,{batchSize:R})}randomSample(F){return r.tidy(()=>{let R=r.randomNormal([1,this.nLatents],0,1,"float32"),L=r.tensor1d([F-this.minMidiPitch],"int32"),q=r.oneHot(L,this.midiPitches),U=r.concat([R,q],1).expandDims(1).expandDims(1);return this.predict(U,1)})}specgramsToAudio(F){return g(F)}}},function(n,t,e){"use strict";e.r(t),e.d(t,"OnsetsAndFrames",function(){return c});var r=e(2),o=e(20),s=e(12),i=e(15),a=e(10);function u(g,d,p){return g.shape[0]===1?g:r.tidy(()=>{let m=g.slice([0,0],[1,d]),y=p%d;y<=3&&(y+=d);let v=g.slice([g.shape[0]-1,g.shape[1]-y],[-1,-1]),N=[m,v];if(g.shape[0]>2){let T=g.shape[0]-2;N=[m,g.slice([1,3],[T,d]).as3D(1,T*d,-1),v]}return r.concat(N,1)})}class c{constructor(d,p=250){this.checkpointURL=d,this.chunkLength=p}initialize(){return Te(this,null,function*(){this.dispose();let d=i.d.now(),p=yield Object(i.a)(this.checkpointURL+"/weights_manifest.json").then(m=>m.json()).then(m=>r.io.loadWeights(m,this.checkpointURL));this.build(p),Object.keys(p).map(m=>p[m].dispose()),this.initialized=!0,s.logWithDuration("Initialized model",d,"O&F")})}dispose(){this.initialized&&(this.onsetsCnn.dispose(),this.onsetsRnn.dispose(),this.activationCnn.dispose(),this.frameRnn.dispose(),this.velocityCnn.dispose(),this.initialized=!1)}isInitialized(){return this.initialized}transcribeFromMelSpec(d,p=4){return Te(this,null,function*(){this.isInitialized()||this.initialize();let m=i.d.now();s.log("Computing onsets, frames, and velocities...","O&F",20);let[y,v,N]=r.tidy(()=>{let O=function(S,F){let R=Math.ceil(S.length/F),L=S.length%F,q=0;if(R>1&&L>0&&L<=3&&(R-=1,q=L,L=0),R===1)return r.tensor2d(S).expandDims(0);let U=F+6,Z=r.tensor2d(S.slice(0,U)).expandDims(0),ee=r.tensor2d(S.slice(S.length-U)).expandDims(0);if(R===2)return r.concat([Z,ee],0);let Q;Q=L?r.tensor2d(S).pad([[0,F-L],[0,0]]).as3D(R,F,-1):r.tensor2d(S.slice(0,S.length-q)).as3D(R,F,-1);let oe=r.slice(Q,[0,F-3],[R-2,-1]),se=r.slice(Q,[2,0],[-1,3]),pe=r.concat([oe,Q.slice(1,R-2),se],1);return r.concat([Z,pe,ee],0)}(d,this.chunkLength);return this.processBatches(O,this.chunkLength,d.length,p)});s.log("Converting to NoteSequence...","O&F",20);let T=function(O,S,F,R=.5,L=.5){return Te(this,null,function*(){let q=a.a.create(),U=new Uint32Array(88),Z=new Uint8Array(88),ee=new Uint8Array(88);function Q(Ee,Le){q.notes.push(a.a.Note.create({pitch:Ee+21,startTime:.032*(U[Ee]-1),endTime:.032*Le,velocity:Z[Ee]})),U[Ee]=0}function oe(Ee,Le,Ve){U[Ee]?ee[Ee]||(Q(Ee,Le),U[Ee]=Le+1,Z[Ee]=Ve):(U[Ee]=Le+1,Z[Ee]=Ve)}let se=r.tidy(()=>{let Ee=r.greater(S,R),Le=r.greater(O,L);return Ee=Ee.pad([[0,1],[0,0]]),Le=Le.pad([[0,1],[0,0]]),F=F.pad([[0,1],[0,0]]),Le=r.logicalOr(Le,Ee),[Le,Ee,F]}),[pe,ae,fe]=yield Promise.all(se.map(Ee=>Ee.data()));se.forEach(Ee=>Ee.dispose());let he=O.shape[0];for(let Ee=0;Ee<he+1;++Ee){for(let Le=0;Le<88;++Le){let Ve=88*Ee+Le;ae[Ve]?oe(Le,Ee,fe[Ve]):!pe[Ve]&&U[Le]&&Q(Le,Ee)}ee=ae.slice(88*Ee,88*(Ee+1))}return q.totalTime=.032*he,q})}(y,v,N);return T.then(()=>{y.dispose(),v.dispose(),N.dispose(),s.logWithDuration("Transcribed from mel spec",m,"O&F")}),T})}transcribeFromAudioBuffer(d,p=4){return Te(this,null,function*(){let m=i.d.now(),y=function(v){return Te(this,null,function*(){let N=yield Object(o.j)(v);return Object(o.i)(Object(o.f)(N,{sampleRate:16e3,hopLength:512,nMels:229,nFft:2048,fMin:30}))})}(d);return y.then(()=>s.logWithDuration("Converted audio to mel spec",m,"O&F",20)),y.then(v=>this.transcribeFromMelSpec(v.map(N=>Array.from(N),p)))})}transcribeFromAudioFile(d){return Te(this,null,function*(){let p=yield Object(o.d)(d);return this.transcribeFromAudioBuffer(p)})}transcribeFromAudioURL(d){return Te(this,null,function*(){let p=yield Object(o.e)(d);return this.transcribeFromAudioBuffer(p)})}processBatches(d,p,m,y){let v=q=>[this.onsetsCnn.predict(q,y),this.activationCnn.predict(q,y),this.velocityCnn.predict(q,y)],N,T,O;if(d.shape[0]===1)[N,T,O]=v(d.expandDims(-1));else{let q=v(d.expandDims(-1)),U=[];for(let Z=0;Z<3;++Z)U.push(u(q[Z],p,m));[N,T,O]=U}let S=this.onsetsRnn.predict(N,this.chunkLength);N.dispose();let F=r.concat3d([S,T],-1);T.dispose();let R=this.frameRnn.predict(F,this.chunkLength),L=r.clipByValue(O,0,1).mul(r.scalar(80)).add(r.scalar(10)).toInt();return O.dispose(),[R.squeeze(),S.squeeze(),L.squeeze()]}build(d){r.tidy(()=>{this.onsetsCnn=new h,this.onsetsCnn.setWeights(d,"onsets"),this.onsetsRnn=new f([null,this.onsetsCnn.outputShape[2]]),this.onsetsRnn.setWeights(d,"onsets","onset_probs"),this.activationCnn=new h("sigmoid"),this.activationCnn.setWeights(d,"frame","activation_probs"),this.frameRnn=new f([null,176]),this.frameRnn.setWeights(d,"frame","frame_probs"),this.velocityCnn=new h("linear"),this.velocityCnn.setWeights(d,"velocity","onset_velocities")})}}class h{constructor(d){this.nn=r.sequential();let p={filters:48,kernelSize:[3,3],activation:"linear",useBias:!1,padding:"same",dilationRate:[1,1],inputShape:[null,229,1],trainable:!1},m={scale:!1,trainable:!1};this.nn.add(r.layers.conv2d(p)),this.nn.add(r.layers.batchNormalization(m)),this.nn.add(r.layers.activation({activation:"relu"})),p.inputShape=null,this.nn.add(r.layers.conv2d(p)),this.nn.add(r.layers.batchNormalization(m)),this.nn.add(r.layers.activation({activation:"relu"})),this.nn.add(r.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]})),p.filters=96,this.nn.add(r.layers.conv2d(p)),this.nn.add(r.layers.batchNormalization(m)),this.nn.add(r.layers.activation({activation:"relu"})),this.nn.add(r.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]}));let y=this.nn.outputShape;this.nn.add(r.layers.reshape({targetShape:[y[1],y[2]*y[3]]})),this.nn.add(r.layers.dense({units:768,activation:"relu",trainable:!1})),d&&this.nn.add(r.layers.dense({units:88,activation:d,trainable:!1})),this.outputShape=this.nn.outputShape}dispose(){this.nn.dispose()}predict(d,p){return this.nn.predict(d,{batchSize:p})}setWeights(d,p,m){function y(N){let T=d[N];if(T===void 0)throw Error("Variable not found: "+N);return T}let v=[y(p+"/conv0/weights"),y(p+"/conv0/BatchNorm/beta"),y(p+"/conv0/BatchNorm/moving_mean"),y(p+"/conv0/BatchNorm/moving_variance"),y(p+"/conv1/weights"),y(p+"/conv1/BatchNorm/beta"),y(p+"/conv1/BatchNorm/moving_mean"),y(p+"/conv1/BatchNorm/moving_variance"),y(p+"/conv2/weights"),y(p+"/conv2/BatchNorm/beta"),y(p+"/conv2/BatchNorm/moving_mean"),y(p+"/conv2/BatchNorm/moving_variance"),y(p+"/fc_end/weights"),y(p+"/fc_end/biases")];m&&(v=v.concat([y(`${p}/${m}/weights`),y(`${p}/${m}/biases`)])),this.nn.setWeights(v)}}class f{constructor(d,p=384){this.dense=r.sequential(),this.units=p,this.lstm=function(){let m=r.layers.lstm({inputShape:d,units:p,returnSequences:!0,recurrentActivation:"sigmoid",returnState:!0,kernelInitializer:"zeros",recurrentInitializer:"zeros",biasInitializer:"zeros",trainable:!1}),y=[r.input({shape:d}),r.input({shape:[p]}),r.input({shape:[p]})],v=m.apply(y);return r.model({inputs:y,outputs:v})}(),this.dense.add(r.layers.dense({inputShape:[null,p],units:88,activation:"sigmoid",trainable:!1}))}dispose(){this.lstm.dispose(),this.dense.dispose()}setWeights(d,p,m){function y(O){let S=d[O];if(S===void 0)throw Error("Variable not found: "+O);return S}let v=(O,S=0)=>{let[F,R,L,q]=r.split(O,4,-1);return r.concat([F,L.add(r.scalar(S)),R,q],-1)},N=O=>r.split(v(O),[O.shape[0]-this.units,this.units]),T="cudnn_lstm/rnn/multi_rnn_cell/cell_0/cudnn_compatible_lstm_cell";this.lstm.setWeights(N(y(`${p}/${T}/kernel`)).concat(v(y(`${p}/${T}/bias`),1))),this.dense.setWeights([y(`${p}/${m}/weights`),y(`${p}/${m}/biases`)])}predict(d,p){return r.tidy(()=>this.predictImpl(d,p))}predictImpl(d,p){let m=d.shape[1],y=Math.ceil(m/p),v=[r.zeros([1,this.units]),r.zeros([1,this.units])],N=[];for(let T=0;T<y;++T){let O=d.slice([0,T*p],[-1,T<y-1?p:-1]),S=this.lstm.predict([O,v[0],v[1]]);N.push(this.dense.predict(S[0])),v=S.slice(1)}return N.length===1?N[0]:r.concat3d(N,1)}}},function(n,t,e){"use strict";e.r(t),e.d(t,"Coconet",function(){return f});var r=e(0),o=e(15),s=e(12),i=e(13),a=e(10);let u=/iPad|iPhone|iPod/.test(navigator.userAgent),c={useSoftmaxLoss:!0,batchNormVarianceEpsilon:1e-7,numInstruments:4,numFilters:128,numLayers:33,numRegularConvLayers:0,dilation:[[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32]],layers:null,interleaveSplitEveryNLayers:16,numPointwiseSplits:4};class h{constructor(d,p){this.residualPeriod=2,this.outputForResidual=null,this.residualCounter=-1,this.rawVars=null,this.spec=d,this.rawVars=p}dispose(){this.rawVars!==null&&r.gb(this.rawVars),this.outputForResidual&&this.outputForResidual.dispose()}predictFromPianoroll(d,p){return r.Hb(()=>{let m=this.getConvnetInput(d,p),y=this.spec.layers.length;for(let v=0;v<y;v++){this.residualCounter+=1,this.residualSave(m);let N=null;this.spec.interleaveSplitEveryNLayers&&v>0&&v<y-2&&v%(this.spec.interleaveSplitEveryNLayers+1)==0&&(N=this.spec.numPointwiseSplits),m=this.applyConvolution(m,this.spec.layers[v],v,v>=this.spec.numRegularConvLayers,N),m=this.applyResidual(m,v===0,v===y-1,v),m=this.applyActivation(m,this.spec.layers[v],v),m=this.applyPooling(m,this.spec.layers[v],v)}return this.computePredictions(m)})}computePredictions(d){return this.spec.useSoftmaxLoss?d.transpose([0,1,3,2]).softmax().transpose([0,1,3,2]):d.sigmoid()}residualReset(){this.outputForResidual=null,this.residualCounter=0}residualSave(d){this.residualCounter%this.residualPeriod==1&&(this.outputForResidual=d)}applyResidual(d,p,m,y){return this.outputForResidual==null?d:this.outputForResidual.shape[this.outputForResidual.shape.length-1]!==d.shape[d.shape.length-1]?(this.residualReset(),d):(this.residualCounter%this.residualPeriod==0&&(p||m||(d=d.add(this.outputForResidual))),d)}getVar(d,p){let m=`model/conv${p}/${d}`;return this.rawVars[m]}getSepConvVar(d,p){let m=`model/conv${p}/SeparableConv2d/${d}`;return this.rawVars[m]}getPointwiseSplitVar(d,p,m){let y=`model/conv${p}/split_${p}_${m}/${d}`;return this.rawVars[y]}applyConvolution(d,p,m,y,v){if(p.filters==null)return d;let N=p.filters,T=p.convStride||1,O=p.convPad?p.convPad.toLowerCase():"same",S=null;if(y){let F=this.getSepConvVar("depthwise_weights",m);if(v){S=r.eb(d,F,[T,T],O,"NHWC",p.dilation);let R=r.Cb(S,v,S.rank-1),L=[];for(let q=0;q<v;q++){let U=N[3]/v,Z=this.getPointwiseSplitVar("kernel",m,q),ee=this.getPointwiseSplitVar("bias",m,q),Q=r.mb(R[q].reshape([-1,U]),Z,!1,!1),oe=r.W(Q,ee);L.push(oe.reshape([R[q].shape[0],R[q].shape[1],R[q].shape[2],U]))}S=r.bb(L,S.rank-1)}else{let R=this.getSepConvVar("pointwise_weights",m),L=this.getSepConvVar("biases",m);S=r.zb(d,F,R,[T,T],O,p.dilation,"NHWC").add(L)}}else{let F=this.getVar("weights",m),R=p.convStride||1,L=p.convPad?p.convPad.toLowerCase():"same";S=r.cb(d,F,[R,R],L,"NHWC",[1,1])}return this.applyBatchnorm(S,m)}applyBatchnorm(d,p){let m=this.getVar("gamma",p),y=this.getVar("beta",p),v=this.getVar("popmean",p),N=this.getVar("popvariance",p);if(u){let T=N.arraySync()[0][0][0],O=r.Gb(T.map(S=>Math.sqrt(S+this.spec.batchNormVarianceEpsilon)));return d.sub(v).mul(m.div(O)).add(y)}return r.Y(d,r.Db(v),r.Db(N),r.Db(y),r.Db(m),this.spec.batchNormVarianceEpsilon)}applyActivation(d,p,m){return p.activation==="identity"?d:d.relu()}applyPooling(d,p,m){if(p.pooling==null)return d;let y=p.pooling,v=p.poolPad?p.poolPad.toLowerCase():"same";return r.ob(d,[y[0],y[1]],[y[0],y[1]],v)}getConvnetInput(d,p){return d=r.yb(1,"float32").sub(p).mul(d),p=r.yb(1,"float32").sub(p),d.concat(p,3)}}class f{constructor(d){this.spec=null,this.initialized=!1,this.checkpointURL=d,this.spec=c}initialize(){return Te(this,null,function*(){this.dispose();let d=o.d.now();this.instantiateFromSpec();let p=yield Object(o.a)(this.checkpointURL+"/weights_manifest.json").then(m=>m.json()).then(m=>r.kb.loadWeights(m,this.checkpointURL));this.convnet=new h(this.spec,p),this.initialized=!0,s.logWithDuration("Initialized model",d,"Coconet")})}dispose(){this.convnet&&this.convnet.dispose(),this.initialized=!1}isInitialized(){return this.initialized}instantiateFromSpec(){this.spec.layers=[],this.spec.layers.push({filters:[3,3,2*this.spec.numInstruments,this.spec.numFilters]});for(let d=0;d<this.spec.numLayers-3;d++)this.spec.layers.push({filters:[3,3,this.spec.numFilters,this.spec.numFilters],dilation:this.spec.dilation?this.spec.dilation[d]:null});this.spec.layers.push({filters:[2,2,this.spec.numFilters,this.spec.numFilters]}),this.spec.layers.push({filters:[2,2,this.spec.numFilters,this.spec.numInstruments],activation:"identity"})}infill(d,p){return Te(this,null,function*(){if(i.assertIsRelativeQuantizedSequence(d),d.notes.length===0)throw new Error(`NoteSequence ${d.id} does not have any notes to infill.`);let m=d.totalQuantizedSteps||d.notes[d.notes.length-1].quantizedEndStep,y=function(F,R){let L=r.Hb(()=>r.Nb([R,46,4]).arraySync());return F.notes.forEach(q=>{let U=q.pitch-36,Z=q.quantizedStartStep,ee=q.quantizedEndStep-q.quantizedStartStep,Q=q.instrument;if(Q<0||Q>=4)s.log(`Found invalid voice ${Q}. Skipping.`,"Coconet",5);else{if(Z+ee>R)throw new Error(`NoteSequence ${F.id} has notes that are longer than the sequence's
          totalQuantizedSteps.`);for(let oe=Z;oe<Z+ee;oe++)L[oe][U][Q]=1}}),r.Gb([L])}(d,m),v,N=.99,T=96;p?(T=p.numIterations||T,N=p.temperature||N,v=this.getCompletionMaskFromInput(p.infillMask,y)):v=this.getCompletionMask(y);let O=yield this.run(y,T,N,v),S=function(F,R){let L=r.Hb(()=>F.reshape([R,46,4]).arraySync()),q=a.a.create(),U=[];for(let Z=0;Z<R;Z++)for(let ee=0;ee<46;ee++)for(let Q=0;Q<4;Q++)if(L[Z][ee][Q]===1){let oe=a.a.Note.create({pitch:ee+36,instrument:Q,quantizedStartStep:Z,quantizedEndStep:Z+1});U.push(oe)}return q.notes=U,q.totalQuantizedSteps=U[U.length-1].quantizedEndStep,q.quantizationInfo={stepsPerQuarter:4},q}(O,m);return y.dispose(),O.dispose(),v.dispose(),S})}run(d,p,m,y){return Te(this,null,function*(){return this.gibbs(d,p,m,y)})}getCompletionMaskFromInput(d,p){if(d){let m=r.Z([p.shape[1],4]);for(let y=0;y<d.length;y++)m.set(1,d[y].step,d[y].voice);return r.Hb(()=>m.toTensor().expandDims(1).tile([1,46,1]).expandDims(0))}return this.getCompletionMask(p)}getCompletionMask(d){return r.Hb(()=>{let p=d.sum(2,!0).equal(r.yb(0,"float32"));return r.ab(p,"float32").add(r.Ob(d))})}gibbs(d,p,m,y){return Te(this,null,function*(){let v=r.yb(p,"float32"),N=d.clone();for(let T=0;T<p;T++){let O=this.yaoSchedule(T,v),S=this.bernoulliMask(N.shape,O,y);yield r.qb();let F=r.Hb(()=>this.convnet.predictFromPianoroll(N,S));yield r.qb(),N=r.Hb(()=>{let R=this.samplePredictions(F,m),L=r.Mb(r.ab(S,"bool"),R,N);return N.dispose(),F.dispose(),S.dispose(),O.dispose(),L}),yield r.qb()}return v.dispose(),N})}yaoSchedule(d,p){return r.Hb(()=>{let m=r.yb(.1,"float32"),y=r.yb(.9,"float32"),v=r.yb(.7,"float32"),N=y.sub(m).mul(r.yb(d,"float32")).div(p),T=y.sub(N).div(v);return m.reshape([1]).concat(T.reshape([1])).max()})}bernoulliMask(d,p,m){return r.Hb(()=>{let[y,v,N,T]=d,O=r.Ib(r.tb([y,v,1,T],0,1,"float32"),[1,1,N,1]).less(p);return r.ab(O,"float32").mul(m)})}samplePredictions(d,p){return r.Hb(()=>{d=r.sb(d,r.yb(1/p,"float32"));let m=r.db(d,2,!1,!1),y=m.slice([0,0,m.shape[2]-1,0],[m.shape[0],m.shape[1],1,m.shape[3]]),v=r.tb(y.shape,0,1,"float32").mul(y).less(m).argMax(2);return r.rb(v.flatten(),d.shape[2],1,0).reshape([d.shape[0],d.shape[1],d.shape[3],d.shape[2]]).transpose([0,1,3,2])})}}},function(n,t,e){"use strict";e.r(t),e.d(t,"MusicRNN",function(){return f});var r=e(2),o=e(48),s=e(37),i=e(36),a=e(15),u=e(12),c=e(13);class h{constructor(d,p,m){this.cells=d,this.attnLength=p,this.attnSize=m}static isWrapped(d){return"rnn/attention_cell_wrapper/kernel"in d}initialize(d){let p="rnn/attention_cell_wrapper/";this.attnInputMatrix=d[p+"kernel"],this.attnInputBias=d[p+"bias"],this.attnW=d[p+"attention/attn_w"],this.attnV=d[p+"attention/attn_v"],this.attnMatrix=d[p+"attention/kernel"],this.attnBias=d[p+"attention/bias"],this.attnOutputMatrix=d[p+"attention_output_projection/kernel"],this.attnOutputBias=d[p+"attention_output_projection/bias"]}initState(){return{attention:r.zeros([this.attnSize]),attentionState:r.zeros([1,this.attnSize*this.attnLength])}}call(d,p,m,y){let v=r.concat([d,y.attention.as2D(1,-1)],1),N=r.add(r.matMul(v,this.attnInputMatrix),this.attnInputBias.as2D(1,-1));[p,m]=r.multiRNNCell(this.cells,N,p,m);let T=r.reshape(y.attentionState,[-1,this.attnLength,1,this.attnSize]),O=r.conv2d(T,this.attnW,[1,1],"same"),S=[];for(let pe=0;pe<p.length;pe++)S.push(p[pe]),S.push(m[pe]);let F=r.concat(S,1),R=r.matMul(F,this.attnMatrix).reshape([-1,1,1,this.attnSize]),L=r.sum(r.mul(this.attnV,r.tanh(r.add(O,R))),[2,3]),q=r.softmax(L),U=r.sum(r.mul(r.reshape(q,[-1,this.attnLength,1,1]),T),[1,2]).reshape([-1,this.attnSize]),Z=y.attentionState.reshape([-1,this.attnLength,this.attnSize]),ee=r.slice(Z,[0,1,0],[Z.shape[0],Z.shape[1]-1,Z.shape[2]]),Q=r.add(r.matMul(r.concat([m[2],U],1),this.attnOutputMatrix),this.attnOutputBias),oe=U.flatten(),se=r.concat([ee,Q.as3D(Q.shape[0],1,Q.shape[1])],1).reshape([-1,this.attnLength*this.attnSize]);return{output:Q,c:p,h:m,attentionState:{attention:oe,attentionState:se}}}}class f{constructor(d,p){this.checkpointURL=d,this.spec=p,this.initialized=!1,this.rawVars={},this.biasShapes=[],this.lstmCells=[]}isInitialized(){return this.initialized}instantiateFromSpec(){this.dataConverter=i.converterFromSpec(this.spec.dataConverter),this.attentionLength=this.spec.attentionLength,this.chordEncoder=this.spec.chordEncoder?s.chordEncoderFromType(this.spec.chordEncoder):void 0,this.auxInputs=this.spec.auxInputs?this.spec.auxInputs.map(d=>o.auxiliaryInputFromSpec(d)):void 0}initialize(){return Te(this,null,function*(){this.dispose();let d=a.d.now();this.spec||(yield Object(a.a)(this.checkpointURL+"/config.json").then(N=>N.json()).then(N=>{if(N.type!=="MusicRNN")throw new Error(`Attempted to instantiate MusicRNN model with incorrect type:
                  `+N.type);this.spec=N})),this.instantiateFromSpec();let p=yield Object(a.a)(this.checkpointURL+"/weights_manifest.json").then(N=>N.json()).then(N=>r.io.loadWeights(N,this.checkpointURL)),m=h.isWrapped(p),y=m?"rnn/attention_cell_wrapper/":"rnn/";this.forgetBias=r.scalar(1),this.lstmCells.length=0,this.biasShapes.length=0;let v=0;for(;;){let N=y+"multi_rnn_cell/cell_%d/basic_lstm_cell/".replace("%d",v.toString());if(!(N+"kernel"in p))break;this.lstmCells.push((T,O,S)=>r.basicLSTMCell(this.forgetBias,p[N+"kernel"],p[N+"bias"],T,O,S)),this.biasShapes.push(p[N+"bias"].shape[0]),++v}this.lstmFcW=p["fully_connected/weights"],this.lstmFcB=p["fully_connected/biases"],m&&(this.attentionWrapper=new h(this.lstmCells,this.attentionLength,this.biasShapes[0]/4),this.attentionWrapper.initialize(p)),this.rawVars=p,this.initialized=!0,u.logWithDuration("Initialized model",d,"MusicRNN")})}dispose(){Object.keys(this.rawVars).forEach(d=>this.rawVars[d].dispose()),this.rawVars={},this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1}continueSequence(d,p,m,y){return Te(this,null,function*(){return(yield this.continueSequenceImpl(d,p,m,y,!1)).sequence})}continueSequenceAndReturnProbabilities(d,p,m,y){return Te(this,null,function*(){return this.continueSequenceImpl(d,p,m,y,!0)})}continueSequenceImpl(d,p,m,y,v){return Te(this,null,function*(){if(c.assertIsRelativeQuantizedSequence(d),this.chordEncoder&&!y)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&y)throw new Error("Unexpected chord progression provided.");this.initialized||(yield this.initialize());let N=a.d.now(),T=r.tidy(()=>{let R=this.dataConverter.toTensor(d),L=R.shape[0],q=R.shape[1],U=this.chordEncoder?this.chordEncoder.encodeProgression(y,L+p):void 0,Z=this.auxInputs?r.concat(this.auxInputs.map(oe=>oe.getTensors(L+p)),1):void 0,ee=this.sampleRnn(R,p,m,U,Z,v),Q=ee.samples;return{samples:r.stack(Q).as2D(Q.length,q),probs:ee.probs}}),O=yield T,S=this.dataConverter.toNoteSequence(O.samples,d.quantizationInfo.stepsPerQuarter),F=[];if(v)for(let R=0;R<O.probs.length;R++)F.push(yield O.probs[R].data()),O.probs[R].dispose();return T.samples.dispose(),S.then(()=>u.logWithDuration("Continuation completed",N,"MusicRNN",20)),{sequence:S,probs:F}})}sampleRnn(d,p,m,y,v,N){let T=d.shape[0],O=d.shape[1],S=[],F=[];for(let oe=0;oe<this.biasShapes.length;oe++)S.push(r.zeros([1,this.biasShapes[oe]/4])),F.push(r.zeros([1,this.biasShapes[oe]/4]));let R,L=this.attentionWrapper?this.attentionWrapper.initState():null;d=d.toFloat();let q=[],U=[],Z=r.split(d.toFloat(),T),ee=y?r.split(y,y.shape[0]):void 0,Q=v?r.split(v,v.shape[0]):void 0;for(let oe=0;oe<T+p;oe++){let se;if(oe<T)se=Z[oe];else{let ae,fe=R.matMul(this.lstmFcW).add(this.lstmFcB).as1D();m?(fe=fe.div(r.scalar(m)),ae=r.multinomial(fe,1).as1D()):ae=fe.argMax().as1D(),N&&U.push(r.softmax(fe)),se=r.oneHot(ae,O).toFloat(),q.push(se.as1D())}if(oe===T+p-1)break;let pe=[];if(ee&&pe.push(ee[oe+1]),pe.push(se),Q&&pe.push(Q[oe]),se=r.concat(pe,1),this.attentionWrapper){let ae=this.attentionWrapper.call(se,S,F,L);S=ae.c,F=ae.h,L=ae.attentionState,R=ae.output}else[S,F]=r.multiRNNCell(this.lstmCells,se,S,F),R=F[F.length-1]}return{samples:q,probs:U}}}},function(n,t,e){"use strict";e.r(t),e.d(t,"MidiMe",function(){return a}),e.d(t,"Decoder",function(){return N}),e.d(t,"Encoder",function(){return d}),e.d(t,"MusicVAE",function(){return Z});var r=e(2),o=e(12),s=e(15);class i extends r.layers.Layer{constructor(){super({})}computeOutputShape(Q){return Q[0]}call(Q){return r.tidy(()=>{let[oe,se]=Q;return r.add(r.mul(r.randomNormal(se.shape),se),oe)})}getClassName(){return"SamplingLayer"}}class a{constructor(Q={}){this.trained=!1,this.initialized=!1,this.config={encoder_layers:Q.encoder_layers||[1024,256,64],decoder_layers:Q.decoder_layers||[64,256,1024],input_size:Q.input_size||256,latent_size:Q.latent_size||4,beta:Q.beta||1,epochs:Q.epochs||10}}dispose(){this.initialized&&(this.encoder.dispose(),this.decoder.dispose(),this.vae.dispose(),this.initialized=!1)}initialize(){this.dispose();let Q=s.d.now(),oe=r.input({shape:[this.config.input_size]});this.encoder=this.getEncoder(oe);let[se,,]=this.encoder.apply(oe);this.decoder=this.getDecoder(se.shape.slice(1));let pe=this.decoder.apply(se);this.vae=r.model({inputs:oe,outputs:pe,name:"vae"}),this.initialized=!0,o.logWithDuration("Initialized model",Q,"MidiMe")}train(Q,oe){return Te(this,null,function*(){let se=s.d.now();this.trained=!1;let pe=.001;r.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")===!1&&r.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")===!1&&r.ENV.get("WEBGL_VERSION")===1&&(pe=5e-5);let ae=r.train.adam(pe);for(let fe=0;fe<this.config.epochs;fe++)yield r.nextFrame(),yield ae.minimize(()=>r.tidy(()=>{let[,he,Ee]=this.encoder.predict(Q),Le=this.vae.predict(Q),Ve=this.loss(he,Ee,Le,Q);return oe&&oe(fe,{y:Le,total:Ve.totalLoss.arraySync(),losses:[Ve.reconLoss.arraySync(),Ve.latentLoss.arraySync()]}),Ve.totalLoss})),yield r.nextFrame();o.logWithDuration("Training finished",se,"MidiMe"),this.trained=!0,ae.dispose()})}sample(Q=1){return Te(this,null,function*(){return this.initialized||(yield this.initialize()),r.tidy(()=>{let oe=r.randomNormal([Q,this.config.latent_size]);return this.decoder.predict(oe)})})}decode(Q){return Te(this,null,function*(){return this.initialized||(yield this.initialize()),this.decoder.predict(Q)})}encode(Q){return Te(this,null,function*(){this.initialized||(yield this.initialize());let[oe,,]=this.encoder.predict(Q);return oe})}predict(Q){return this.vae.predict(Q)}getEncoder(Q){let oe=Q;for(let fe=0;fe<this.config.encoder_layers.length;fe++)oe=r.layers.dense({units:this.config.encoder_layers[fe],activation:"relu"}).apply(oe);let se=this.getAffineLayers(oe,this.config.latent_size,Q,!1),pe=this.getAffineLayers(oe,this.config.latent_size,Q,!0),ae=new i().apply([se,pe]);return r.model({inputs:Q,outputs:[ae,se,pe],name:"encoder"})}getDecoder(Q){let oe=r.input({shape:Q}),se=oe;for(let ae=0;ae<this.config.decoder_layers.length;ae++)se=r.layers.dense({units:this.config.decoder_layers[ae],activation:"relu"}).apply(se);let pe=this.getAffineLayers(se,this.config.input_size,oe,!1);return r.model({inputs:oe,outputs:pe,name:"decoder"})}loss(Q,oe,se,pe){return r.tidy(()=>{let ae=this.klLoss(Q,oe),fe=this.reconstructionLoss(pe,se);return{latentLoss:ae,reconLoss:fe,totalLoss:r.add(fe,r.mul(ae,this.config.beta))}})}reconstructionLoss(Q,oe){return r.tidy(()=>{let se=r.pow(r.sub(Q,oe),2),pe=r.div(se,r.mul(2,r.pow(r.ones([1]),2)));return r.mean(r.sum(pe,-1))})}klLoss(Q,oe){return r.tidy(()=>{let se=r.pow(Q,2),pe=r.pow(oe,2),ae=r.add(1,r.log(pe)),fe=r.add(se,pe),he=r.sub(ae,fe),Ee=r.div(r.mean(r.sum(he,-1)),2);return r.mul(-1,Ee)})}getAffineLayers(Q,oe,se,pe){let ae=r.layers.dense({units:oe}).apply(Q);return pe?r.layers.activation({activation:"softplus"}).apply(ae):ae}}var u=e(37),c=e(8),h=e(36);class f{constructor(Q,oe){if(Q===void 0)throw Error("`kernel` is undefined.");if(oe===void 0)throw Error("`bias` is undefined.");this.kernel=Q,this.bias=oe}}function g(ee,Q){return Q.matMul(ee.kernel).add(ee.bias)}class d{}class p{constructor(Q,oe){this.lstmFwVars=Q,this.lstmBwVars=oe}process(Q){return r.tidy(()=>[this.singleDirection(Q,!0),this.singleDirection(Q,!1)])}singleDirection(Q,oe){let se=Q.shape[0],pe=Q.shape[1],ae=oe?this.lstmFwVars:this.lstmBwVars,fe=[r.zeros([se,ae.bias.shape[0]/4]),r.zeros([se,ae.bias.shape[0]/4])],he=r.scalar(1),Ee=(qe,je)=>r.basicLSTMCell(he,ae.kernel,ae.bias,qe,je[0],je[1]),Le=r.split(Q.toFloat(),pe,1),Ve=[];for(let qe of oe?Le:Le.reverse())fe=Ee(qe.squeeze([1]),fe),Ve.push(fe[1]);return oe?Ve:Ve.reverse()}}class m extends d{constructor(Q,oe,se){super(),this.bidirectionalLstm=new p(Q,oe),this.muVars=se,this.zDims=se?this.muVars.bias.shape[0]:null}encode(Q,oe){if(oe)throw new Error("Variable-length segments not supported in flat encoder");return r.tidy(()=>{let[se,pe]=this.bidirectionalLstm.process(Q),ae=r.concat([se[se.length-1],pe[0]],1);return this.muVars?g(this.muVars,ae):ae})}}class y extends d{constructor(Q,oe,se){super(),this.baseEncoders=Q,this.numSteps=oe,this.muVars=se,this.zDims=this.muVars.bias.shape[0]}encode(Q,oe){if(oe){if(Q.shape[0]!==1)throw new Error("When using variable-length segments, batch size must be 1.");if(oe.length!==this.numSteps[0])throw new Error("Must provide length for all variable-length segments.")}return r.tidy(()=>{let se=Q;for(let pe=0;pe<this.baseEncoders.length;++pe){let ae=this.numSteps[pe],fe=r.split(se,ae,1),he=[];for(let Ee=0;Ee<ae;++Ee)he.push(this.baseEncoders[pe].encode(pe===0&&oe?r.slice3d(fe[Ee],[0,0,0],[1,oe[Ee],-1]):fe[Ee]));se=r.stack(he,1)}return g(this.muVars,se.squeeze([1]))})}}function v(ee,Q,oe){let se=[],pe=[],ae=[],fe=r.split(g(oe,ee).tanh(),2*Q.length,1);for(let he=0;he<Q.length;++he){let Ee=Q[he],Le=r.scalar(1);se.push((Ve,qe,je)=>r.basicLSTMCell(Le,Ee.kernel,Ee.bias,Ve,qe,je)),pe.push(fe[2*he]),ae.push(fe[2*he+1])}return{cell:se,c:pe,h:ae}}class N{}class T extends N{constructor(Q,oe,se,pe,ae,fe){super(),this.lstmCellVars=Q,this.zToInitStateVars=oe,this.outputProjectVars=se,this.zDims=this.zToInitStateVars.kernel.shape[0],this.outputDims=pe||se.bias.shape[0],ae&&fe&&(this.controlBidirectionalLstm=new p(ae,fe))}decode(Q,oe,se,pe,ae){let fe=Q.shape[0];return r.tidy(()=>{let he=v(Q,this.lstmCellVars,this.zToInitStateVars),Ee=ae?r.expandDims(ae,0):void 0,Le=[],Ve=se||r.zeros([fe,this.outputDims]);if(this.controlBidirectionalLstm){let[je,Ce]=this.controlBidirectionalLstm.process(Ee);Ee=r.concat([r.stack(je,1),r.stack(Ce,1)],2)}let qe=Ee?r.split(r.tile(Ee,[fe,1,1]),ae.shape[0],1):void 0;for(let je=0;je<oe;++je){let Ce=qe?[Ve,Q,r.squeeze(qe[je],[1])]:[Ve,Q];[he.c,he.h]=r.multiRNNCell(he.cell,r.concat(Ce,1),he.c,he.h);let tt=g(this.outputProjectVars,he.h[he.h.length-1]);Ve=this.sample(tt,pe),Le.push(Ve)}return r.stack(Le,1)})}}class O extends T{sample(Q,oe){let se=Q;return(oe?r.greaterEqual(r.sigmoid(se.div(r.scalar(oe))),r.randomUniform(se.shape)):r.greaterEqual(se,0)).toFloat()}}class S extends T{sample(Q,oe){let se=Q,pe=oe?r.multinomial(se.div(r.scalar(oe)),1).as1D():se.argMax(1).as1D();return r.oneHot(pe,this.outputDims).toFloat()}}class F extends T{constructor(Q,oe,se,pe,ae,fe){super(Q,oe,se,pe.numDims,ae,fe),this.nade=pe}sample(Q,oe){let[se,pe]=r.split(Q,[this.nade.numHidden,this.nade.numDims],1);return this.nade.sample(se,pe)}}class R extends T{sample(Q,oe){let[se,pe,ae]=r.split(Q,3,1);if(pe=r.sigmoid(pe),ae=r.tanh(ae),oe){se=r.sigmoid(se.div(r.scalar(oe)));let fe=r.randomUniform(se.shape,0,1);se=r.greater(se,fe).toFloat()}else se=r.greater(r.sigmoid(se),.5).toFloat();return r.concat([se,pe,ae],1)}}class L extends N{constructor(Q){super(),this.coreDecoders=Q,this.numDecoders=this.coreDecoders.length,this.zDims=this.coreDecoders[0].zDims,this.outputDims=this.coreDecoders.reduce((oe,se)=>oe+se.outputDims,0)}decodeSeparately(Q,oe,se,pe,ae){let fe=[];for(let he=0;he<this.coreDecoders.length;++he)fe.push(this.coreDecoders[he].decode(Q,oe,se[he],pe,ae));return fe}decode(Q,oe,se,pe,ae){return r.tidy(()=>{let fe=this.decodeSeparately(Q,oe,this.coreDecoders.map(he=>se),pe,ae);return r.concat(fe,-1)})}}class q extends N{constructor(Q,oe,se,pe){super(),this.splitDecoder=new L(Q),this.lstmCellVars=oe,this.zToInitStateVars=se,this.numSteps=pe,this.zDims=this.zToInitStateVars.kernel.shape[0],this.outputDims=this.splitDecoder.outputDims}decode(Q,oe,se,pe,ae){let fe=Q.shape[0];return r.tidy(()=>{let he=v(Q,this.lstmCellVars,this.zToInitStateVars),Ee=[],Le=new Array(this.splitDecoder.numDecoders).fill(void 0),Ve=r.zeros([fe,1]),qe=ae?r.split(ae,this.numSteps):void 0;for(let je=0;je<this.numSteps;++je){[he.c,he.h]=r.multiRNNCell(he.cell,Ve,he.c,he.h);let Ce=this.splitDecoder.decodeSeparately(he.h[he.h.length-1],oe/this.numSteps,Le,pe,qe?qe[je]:void 0);Ee.push(r.concat(Ce,-1)),Le=Ce.map(tt=>tt.slice([0,tt.shape[1]-1,0],[fe,1,tt.shape[tt.rank-1]]).squeeze([1]).toFloat())}return r.concat(Ee,1)})}}class U{constructor(Q,oe){this.numDims=Q.shape[0],this.numHidden=Q.shape[2],this.encWeights=Q.as2D(this.numDims,this.numHidden),this.decWeightsT=oe.as2D(this.numDims,this.numHidden)}sample(Q,oe){let se=Q.shape[0];return r.tidy(()=>{let pe=[],ae=Q.clone();for(let fe=0;fe<this.numDims;fe++){let he=r.sigmoid(ae),Ee=this.encWeights.slice([fe,0],[1,this.numHidden]).as1D(),Le=this.decWeightsT.slice([fe,0],[1,this.numHidden]),Ve=oe.slice([0,fe],[se,1]).add(r.matMul(he,Le,!1,!0)).sigmoid().greaterEqual(r.scalar(.5)).toFloat().as1D();fe<this.numDims-1&&(ae=ae.add(r.outerProduct(Ve.toFloat(),Ee))),pe.push(Ve)}return r.stack(pe,1)})}}class Z{constructor(Q,oe){this.initialized=!1,this.checkpointURL=Q,this.spec=oe}instantiateFromSpec(){this.dataConverter=h.converterFromSpec(this.spec.dataConverter),this.chordEncoder=this.spec.chordEncoder?u.chordEncoderFromType(this.spec.chordEncoder):void 0}dispose(){this.rawVars!==void 0&&Object.keys(this.rawVars).forEach(Q=>this.rawVars[Q].dispose()),this.encoder=void 0,this.decoder=void 0,this.initialized=!1}getLstmLayers(Q,oe){let se=[],pe=0;for(;;){let ae=Q.replace("%d",pe.toString());if(!(ae+"kernel"in oe))break;se.push(new f(oe[ae+"kernel"],oe[ae+"bias"])),++pe}return se}initialize(){return Te(this,null,function*(){this.dispose();let Q=s.d.now();this.spec||(yield Object(s.a)(this.checkpointURL+"/config.json").then(tt=>tt.json()).then(tt=>{if(tt.type!=="MusicVAE")throw new Error(`Attempted to instantiate MusicVAE model with incorrect type:
                  `+tt.type);this.spec=tt})),this.instantiateFromSpec();let oe="cell_%d/bidirectional_rnn/%s/multi_rnn_cell/cell_0/lstm_cell/",se="encoder/"+oe,pe="encoder/hierarchical_level_%d/"+oe.replace("%d","0"),ae="control_preprocessing/"+oe,fe=yield Object(s.a)(this.checkpointURL+"/weights_manifest.json").then(tt=>tt.json()).then(tt=>r.io.loadWeights(tt,this.checkpointURL));this.rawVars=fe;let he=new f(fe["encoder/mu/kernel"],fe["encoder/mu/bias"]);if(this.dataConverter.numSegments){let tt=this.getLstmLayers(pe.replace("%s","fw"),fe),ye=this.getLstmLayers(pe.replace("%s","bw"),fe);if(tt.length!==ye.length||tt.length!==2)throw Error(`Only 2 hierarchical encoder levels are supported. Got ${tt.length} forward and ${ye.length} backward.`);let z=[0,1].map(M=>new m(tt[M],ye[M]));this.encoder=new y(z,[this.dataConverter.numSegments,1],he)}else{let tt=this.getLstmLayers(se.replace("%s","fw"),fe),ye=this.getLstmLayers(se.replace("%s","bw"),fe);if(tt.length!==ye.length||tt.length!==1)throw Error(`Only single-layer bidirectional encoders are supported. Got ${tt.length} forward and ${ye.length} backward.`);this.encoder=new m(tt[0],ye[0],he)}let Ee=ae.replace("%s","fw").replace("%d","0")+"kernel"in fe,Le=this.dataConverter.numSegments?"core_decoder/":"",Ve=[];if(this.dataConverter.NUM_SPLITS)for(let tt=0;tt<this.dataConverter.NUM_SPLITS;++tt)Ve.push(`${Le}core_decoder_${tt}/decoder/`);else Ve.push(Le+"decoder/");let qe=[null],je=[null];if(Ee&&(qe=this.getLstmLayers(ae.replace("%s","fw"),fe),je=this.getLstmLayers(ae.replace("%s","bw"),fe),qe.length!==je.length||qe.length!==1))throw Error(`Only single-layer bidirectional control preprocessing is supported. Got ${qe.length} forward and ${je.length} backward.`);let Ce=Ve.map(tt=>{let ye=this.getLstmLayers(tt+"multi_rnn_cell/cell_%d/lstm_cell/",fe),z=new f(fe[tt+"z_to_initial_state/kernel"],fe[tt+"z_to_initial_state/bias"]),M=new f(fe[tt+"output_projection/kernel"],fe[tt+"output_projection/bias"]);return tt+"nade/w_enc"in fe?new F(ye,z,M,new U(fe[tt+"nade/w_enc"],fe[tt+"nade/w_dec_t"]),qe[0],je[0]):this.spec.dataConverter.type==="GrooveConverter"?new R(ye,z,M,void 0,qe[0],je[0]):this.spec.useBooleanDecoder?new O(ye,z,M,void 0,qe[0],je[0]):new S(ye,z,M,void 0,qe[0],je[0])});if(this.dataConverter.numSegments){let tt=this.getLstmLayers("decoder/hierarchical_level_0/cell_%d/lstm_cell/",fe),ye=new f(fe["decoder/hierarchical_level_0/initial_state/kernel"],fe["decoder/hierarchical_level_0/initial_state/bias"]);this.decoder=new q(Ce,tt,ye,this.dataConverter.numSegments)}else Ce.length===1?this.decoder=Ce[0]:this.decoder=new L(Ce);this.zDims=this.decoder.zDims,this.initialized=!0,o.logWithDuration("Initialized model",Q,"MusicVAE")})}isInitialized(){return this.initialized}checkControlArgs(Q){let oe=(Q=Q||{}).extraControls||{};if(this.chordEncoder&&!Q.chordProgression)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&Q.chordProgression)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&Q.chordProgression.length>1)throw new Error("Multiple chords not supported when using variable-length segments.");if(this.spec.conditionOnKey&&Q.key==null)throw new Error("Key expected but not provided.");if(!this.spec.conditionOnKey&&Q.key!=null)throw new Error("Unexpected key provided.");if(this.spec.extraControls)for(let pe of this.spec.extraControls){if(!(pe.name in oe))throw new Error("Missing control signal: "+pe.name);if(oe[pe.name].shape[1]!==pe.depth)throw new Error(`Control signal ${pe.name} has invalid depth: ${oe[pe.name].shape[1]} != ${pe.depth}`)}let se=this.spec.extraControls?new Set(this.spec.extraControls.map(pe=>pe.name)):new Set;for(let pe in oe)se.has(pe)||o.log("Unspecified control signal provided: "+pe,"MusicVAE",5)}controlArgsToTensor(Q){return Q=Q||{},r.tidy(()=>{let oe=[];if(Q.chordProgression){let se=this.encodeChordProgression(Q.chordProgression);oe.push(se)}if(Q.key!=null){let se=r.oneHot(r.fill([this.dataConverter.numSteps],Q.key,"int32"),12);oe.push(se)}if(Q.extraControls)for(let se of this.spec.extraControls)oe.push(Q.extraControls[se.name]);return oe.length?r.concat2d(oe,1):void 0})}interpolateTensors(Q,oe,se,pe){return Te(this,null,function*(){this.initialized||(yield this.initialize());let ae=yield this.encodeTensors(Q,pe),fe=r.tidy(()=>this.getInterpolatedZs(ae,oe));ae.dispose();let he=yield this.decodeTensors(fe,se,pe);return fe.dispose(),he})}interpolate(Q,oe,se,pe){return Te(this,null,function*(){this.checkControlArgs(pe),this.initialized||(yield this.initialize());let ae=yield this.encode(Q,pe),fe=r.tidy(()=>this.getInterpolatedZs(ae,oe));ae.dispose();let he=this.decode(fe,se,pe);return fe.dispose(),he.then(()=>o.logWithDuration("Interpolation completed",0,"MusicVAE",20)),he})}getSegmentLengths(Q){return Te(this,null,function*(){if(Q.shape[0]>1)throw new Error("Variable-length segments not supported for batch size > 1.");let oe=this.dataConverter.numSteps,se=this.dataConverter.numSegments,pe=r.tidy(()=>r.min(r.equal(Q.squeeze([0]),this.dataConverter.endTensor.expandDims(0)),1)),ae=yield pe.data();pe.dispose();let fe=oe/se,he=[],Ee=0,Le=ae.indexOf(1);for(;Le!==-1;)he.push(Le-Ee+1),Ee+=fe,Le=ae.indexOf(1,Ee);if(he.length!==se)throw new Error(`Incorrect number of segments: ${he.length} != ${se}`);return he})}encodeChordProgression(Q){let oe=this.dataConverter.numSteps,se=this.dataConverter.numSegments,pe=this.dataConverter.SEGMENTED_BY_TRACK?oe/se:oe,ae=this.dataConverter.SEGMENTED_BY_TRACK?r.concat2d([this.chordEncoder.encode(c.NO_CHORD).expandDims(0),this.chordEncoder.encodeProgression(Q,pe-1)],0):this.chordEncoder.encodeProgression(Q,pe);return this.dataConverter.SEGMENTED_BY_TRACK?r.tile(ae,[se,1]):ae}encodeTensors(Q,oe){return Te(this,null,function*(){this.checkControlArgs(oe),this.initialized||(yield this.initialize());let se=this.dataConverter.endTensor?yield this.getSegmentLengths(Q):void 0;return r.tidy(()=>{let pe=this.controlArgsToTensor(oe),ae=[Q];if(pe){let he=r.tile(r.expandDims(pe,0),[Q.shape[0],1,1]);ae.push(he)}let fe=r.concat3d(ae,2);return this.encoder.encode(fe,se)})})}encode(Q,oe){return Te(this,null,function*(){this.initialized||(yield this.initialize());let se=s.d.now(),pe=r.tidy(()=>r.stack(Q.map(fe=>this.dataConverter.toTensor(fe)))),ae=yield this.encodeTensors(pe,oe);return pe.dispose(),o.logWithDuration("Encoding completed",se,"MusicVAE",20),ae})}decodeTensors(Q,oe,se){return Te(this,null,function*(){return this.checkControlArgs(se),this.initialized||(yield this.initialize()),r.tidy(()=>{let pe=this.controlArgsToTensor(se);return this.decoder.decode(Q,this.dataConverter.numSteps,void 0,oe,pe)})})}decode(fe,he,Ee){return Te(this,arguments,function*(Q,oe,se,pe=c.DEFAULT_STEPS_PER_QUARTER,ae=c.DEFAULT_QUARTERS_PER_MINUTE){this.initialized||(yield this.initialize());let Le=s.d.now(),Ve=yield this.decodeTensors(Q,oe,se),qe=r.tidy(()=>r.split(Ve,Ve.shape[0]).map(Ce=>Ce.squeeze([0]))),je=[];for(let Ce of qe)je.push(yield this.dataConverter.toNoteSequence(Ce,pe,ae)),Ce.dispose();return Ve.dispose(),o.logWithDuration("Decoding completed",Le,"MusicVAE",20),je})}getInterpolatedZs(Q,oe){if(typeof oe=="number"&&(oe=[oe]),Q.shape[0]!==2&&Q.shape[0]!==4)throw new Error("Invalid number of input sequences. Requires length 2, or 4");if(oe.length!==1&&oe.length!==2)throw new Error("Invalid number of dimensions. Requires length 1, or 2.");let se=oe[0],pe=oe.length===2?oe[1]:se;return r.tidy(()=>{let ae=r.linspace(0,1,se),fe=Q.slice([0,0],[1,Q.shape[1]]).as1D(),he=Q.slice([1,0],[1,Q.shape[1]]).as1D();if(Q.shape[0]===2){let Ee=he.sub(fe);return r.outerProduct(ae,Ee).add(fe)}if(Q.shape[0]===4){let Ee=r.linspace(0,1,pe),Le=Q.slice([2,0],[1,Q.shape[1]]).as1D(),Ve=Q.slice([3,0],[1,Q.shape[1]]).as1D(),qe=r.scalar(1).sub(ae),je=r.scalar(1).sub(Ee),Ce=fe.mul(r.outerProduct(je,qe).as3D(pe,se,1));return Ce=r.addStrict(Ce,he.mul(r.outerProduct(Ee,qe).as3D(pe,se,1))),Ce=r.addStrict(Ce,Le.mul(r.outerProduct(je,ae).as3D(pe,se,1))),Ce=r.addStrict(Ce,Ve.mul(r.outerProduct(Ee,ae).as3D(pe,se,1))),Ce.as2D(se*pe,Q.shape[1])}throw new Error("Invalid number of note sequences. Requires length 2, or 4")})}sampleTensors(Q,oe=.5,se){return Te(this,null,function*(){this.checkControlArgs(se),this.initialized||(yield this.initialize());let pe=r.tidy(()=>r.randomNormal([Q,this.decoder.zDims])),ae=yield this.decodeTensors(pe,oe,se);return pe.dispose(),ae})}sample(fe){return Te(this,arguments,function*(Q,oe=.5,se,pe=c.DEFAULT_STEPS_PER_QUARTER,ae=c.DEFAULT_QUARTERS_PER_MINUTE){this.checkControlArgs(se),this.initialized||(yield this.initialize());let he=s.d.now(),Ee=r.tidy(()=>r.randomNormal([Q,this.decoder.zDims])),Le=this.decode(Ee,oe,se,pe,ae);return Ee.dispose(),Le.then(()=>o.logWithDuration("Sampling completed",he,"MusicVAE",20)),Le})}similarTensors(Q,oe,se,pe,ae){return Te(this,null,function*(){if(se<0||se>1)throw new Error("Similarity must be between 0 and 1.");this.initialized||(yield this.initialize());let fe=r.expandDims(Q,0),he=yield this.encodeTensors(fe,ae);fe.dispose();let Ee=r.tidy(()=>{let Ve=r.randomNormal([oe,this.decoder.zDims]);return r.add(he.mul(se),Ve.mul(1-se))});he.dispose();let Le=yield this.decodeTensors(Ee,pe,ae);return Ee.dispose(),Le})}similar(Q,oe,se,pe,ae){return Te(this,null,function*(){if(this.checkControlArgs(ae),se<0||se>1)throw new Error("Similarity must be between 0 and 1.");this.initialized||(yield this.initialize());let fe=yield this.encode([Q],ae),he=r.tidy(()=>{let Le=r.randomNormal([oe,this.decoder.zDims]);return r.add(fe.mul(se),Le.mul(1-se))});fe.dispose();let Ee=this.decode(he,pe,ae);return he.dispose(),Ee.then(()=>o.logWithDuration("Similar sequence generation completed",0,"MusicVAE",20)),Ee})}}},function(n,t,e){"use strict";e.r(t),e.d(t,"PianoGenie",function(){return m}),e.d(t,"PianoGenieKeysig",function(){return v}),e.d(t,"PianoGenieChord",function(){return y}),e.d(t,"PianoGenieKeysigChordFamily",function(){return T}),e.d(t,"PianoGenieKeysigChord",function(){return N});var r=e(2),o=e(15),s=e(73);function i(O){for(let S=0;S<2;++S)O.c[S].dispose(),O.h[S].dispose()}function a(O,S,F){if((S=S!==void 0?S:1)<0||S>1)throw new Error("Invalid temperature specified");let R;if(S===0)R=r.argMax(O,0);else{S<1&&(O=r.div(O,r.scalar(S,"float32")));let L=r.reshape(r.softmax(O,0),[1,-1]),q=r.multinomial(L,1,F,!0);R=r.reshape(q,[])}return R}class u extends class{constructor(S){this.checkpointURL=S,this.initialized=!1}isInitialized(){return this.initialized}initialize(S){return Te(this,null,function*(){if(this.initialized&&this.dispose(),this.checkpointURL===void 0&&S===void 0)throw new Error("Need to specify either URI or static variables");if(S===void 0){let F=yield Object(o.a)(this.checkpointURL+"/weights_manifest.json").then(R=>R.json()).then(R=>r.io.loadWeights(R,this.checkpointURL));this.modelVars=F}else this.modelVars=S;this.decLSTMCells=[],this.decForgetBias=r.scalar(1,"float32");for(let F=0;F<2;++F){let R=`phero_model/decoder/rnn/rnn/multi_rnn_cell/cell_${F}/lstm_cell/`;this.decLSTMCells.push((L,q,U)=>r.basicLSTMCell(this.decForgetBias,this.modelVars[R+"kernel"],this.modelVars[R+"bias"],L,q,U))}this.resetState(),this.initialized=!0,this.next(0),this.resetState()})}getRnnInputFeats(){return r.tidy(()=>{let S=r.tensor1d([this.button],"float32");return r.sub(r.mul(2,r.div(S,7)),1).as1D()})}next(S,F,R){return this.nextWithCustomSamplingFunction(S,L=>a(L,F,R))}nextFromKeyList(S,F,R,L){return this.nextWithCustomSamplingFunction(S,q=>{let U=r.tensor1d(F,"int32"),Z=a(q=r.gather(q,U),R,L),ee=r.gather(U,r.reshape(Z,[1]));return Z=r.reshape(ee,[]),Z})}nextFromKeyWhitelist(S,F,R,L){return s.logging.log("nextFromKeyWhitelist() is deprecated, and will be removed in a future          version. Please use nextFromKeyList() instead","PianoGenie",5),this.nextFromKeyList(S,F,R,L)}nextWithCustomSamplingFunction(S,F){let R=this.lastState;this.button=S;let L=this.getRnnInputFeats(),[q,U]=this.evaluateModelAndSample(L,R,F);return L.dispose(),i(this.lastState),this.lastState=q,U}evaluateModelAndSample(S,F,R){if(!this.initialized)throw new Error("Model is not initialized.");let[L,q]=r.tidy(()=>{let U=r.matMul(r.expandDims(S,0),this.modelVars["phero_model/decoder/rnn_input/dense/kernel"]);U=r.add(U,this.modelVars["phero_model/decoder/rnn_input/dense/bias"]);let[Z,ee]=r.multiRNNCell(this.decLSTMCells,U,F.c,F.h),Q={c:Z,h:ee},oe=r.matMul(ee[1],this.modelVars["phero_model/decoder/pitches/dense/kernel"]);oe=r.add(oe,this.modelVars["phero_model/decoder/pitches/dense/bias"]);let se=r.reshape(oe,[88]);return[Q,R(se).dataSync()[0]]});return[L,q]}resetState(){this.lastState!==void 0&&i(this.lastState),this.lastState=function(){let S={c:[],h:[]};for(let F=0;F<2;++F)S.c.push(r.zeros([1,128],"float32")),S.h.push(r.zeros([1,128],"float32"));return S}()}dispose(){this.initialized&&(Object.keys(this.modelVars).forEach(S=>this.modelVars[S].dispose()),this.decForgetBias.dispose(),i(this.lastState),this.initialized=!1)}}{getRnnInputFeats(){return r.tidy(()=>{let S=[super.getRnnInputFeats()],F=this.lastOutput,R=this.lastTime,L=this.time,q;this.deltaTimeOverride===void 0?q=(L.getTime()-R.getTime())/1e3:(q=this.deltaTimeOverride,this.deltaTimeOverride=void 0);let U=r.scalar(F,"int32"),Z=r.addStrict(U,r.scalar(1,"int32")),ee=r.cast(r.oneHot(Z,89),"float32");S.push(ee);let Q=r.scalar(q,"float32"),oe=r.round(r.mul(Q,31.25)),se=r.minimum(oe,32),pe=r.cast(r.add(se,1e-4),"int32"),ae=r.oneHot(pe,33),fe=r.cast(ae,"float32");return S.push(fe),this.lastTime=L,r.concat1d(S)})}nextWithCustomSamplingFunction(S,F){this.time=new Date;let R=super.nextWithCustomSamplingFunction(S,F);return this.lastOutput=R,this.lastTime=this.time,R}overrideLastOutput(S){this.lastOutput=S}overrideDeltaTime(S){this.deltaTimeOverride=S}resetState(){super.resetState(),this.lastOutput=-1,this.lastTime=new Date,this.lastTime.setSeconds(this.lastTime.getSeconds()-1e5),this.time=new Date}}var c,h;(function(O){O[O.None=0]="None",O[O.C=1]="C",O[O.Cs=2]="Cs",O[O.D=3]="D",O[O.Eb=4]="Eb",O[O.E=5]="E",O[O.F=6]="F",O[O.Fs=7]="Fs",O[O.G=8]="G",O[O.Ab=9]="Ab",O[O.A=10]="A",O[O.Bb=11]="Bb",O[O.B=12]="B"})(c||(c={})),function(O){O[O.None=0]="None",O[O.Maj=1]="Maj",O[O.Min=2]="Min",O[O.Aug=3]="Aug",O[O.Dim=4]="Dim",O[O.Seven=5]="Seven",O[O.Maj7=6]="Maj7",O[O.Min7=7]="Min7",O[O.Min7b5=8]="Min7b5"}(h||(h={}));class f extends u{getRnnInputFeats(){return r.tidy(()=>{let S=[super.getRnnInputFeats()],F=r.scalar(this.chordRoot,"int32"),R=r.subStrict(F,r.scalar(1,"int32")),L=r.cast(r.oneHot(R,12),"float32");S.push(L);let q=r.scalar(this.chordFamily,"int32"),U=r.subStrict(q,r.scalar(1,"int32")),Z=r.cast(r.oneHot(U,8),"float32");return S.push(Z),r.concat1d(S)})}setChordRoot(S){this.chordRoot=S}setChordFamily(S){this.chordFamily=S}resetState(){super.resetState(),this.chordRoot=c.None,this.chordFamily=h.None}}class g extends u{getRnnInputFeats(){return r.tidy(()=>{let S=[super.getRnnInputFeats()],F=r.scalar(this.keySignature,"int32"),R=r.subStrict(F,r.scalar(1,"int32")),L=r.cast(r.oneHot(R,12),"float32");return S.push(L),r.concat1d(S)})}setKeySignature(S){this.keySignature=S}resetState(){super.resetState(),this.keySignature=c.None}}class d extends g{getRnnInputFeats(){return r.tidy(()=>{let S=[super.getRnnInputFeats()],F=r.scalar(this.chordRoot,"int32"),R=r.subStrict(F,r.scalar(1,"int32")),L=r.cast(r.oneHot(R,12),"float32");S.push(L);let q=r.scalar(this.chordFamily,"int32"),U=r.subStrict(q,r.scalar(1,"int32")),Z=r.cast(r.oneHot(U,8),"float32");return S.push(Z),r.concat1d(S)})}setChordRoot(S){this.chordRoot=S}setChordFamily(S){this.chordFamily=S}resetState(){super.resetState(),this.chordRoot=c.None,this.chordFamily=h.None}}class p extends g{getRnnInputFeats(){return r.tidy(()=>{let S=[super.getRnnInputFeats()],F=r.scalar(this.chordFamily,"int32"),R=r.subStrict(F,r.scalar(1,"int32")),L=r.cast(r.oneHot(R,8),"float32");return S.push(L),r.concat1d(S)})}setChordFamily(S){this.chordFamily=S}resetState(){super.resetState(),this.chordFamily=h.None}}class m extends u{}class y extends f{}class v extends g{}class N extends d{}class T extends p{}},,function(n,t,e){"use strict";e.r(t),e.d(t,"tf",function(){return r}),e.d(t,"aux_inputs",function(){return o.aux_inputs}),e.d(t,"chords",function(){return o.chords}),e.d(t,"constants",function(){return o.constants}),e.d(t,"data",function(){return o.data}),e.d(t,"logging",function(){return o.logging}),e.d(t,"melodies",function(){return o.melodies}),e.d(t,"performance",function(){return o.performance}),e.d(t,"sequences",function(){return o.sequences}),e.d(t,"MetronomeCallbackObject",function(){return o.MetronomeCallbackObject}),e.d(t,"Metronome",function(){return o.Metronome}),e.d(t,"MidiConversionError",function(){return o.MidiConversionError}),e.d(t,"midiToSequenceProto",function(){return o.midiToSequenceProto}),e.d(t,"sequenceProtoToMidi",function(){return o.sequenceProtoToMidi}),e.d(t,"urlToBlob",function(){return o.urlToBlob}),e.d(t,"blobToNoteSequence",function(){return o.blobToNoteSequence}),e.d(t,"urlToNoteSequence",function(){return o.urlToNoteSequence}),e.d(t,"BasePlayerCallback",function(){return o.BasePlayerCallback}),e.d(t,"BasePlayer",function(){return o.BasePlayer}),e.d(t,"Player",function(){return o.Player}),e.d(t,"SoundFontPlayer",function(){return o.SoundFontPlayer}),e.d(t,"PlayerWithClick",function(){return o.PlayerWithClick}),e.d(t,"MIDIPlayer",function(){return o.MIDIPlayer}),e.d(t,"BaseRecorderCallback",function(){return o.BaseRecorderCallback}),e.d(t,"Recorder",function(){return o.Recorder}),e.d(t,"BaseVisualizer",function(){return o.BaseVisualizer}),e.d(t,"PianoRollCanvasVisualizer",function(){return o.PianoRollCanvasVisualizer}),e.d(t,"Visualizer",function(){return o.Visualizer}),e.d(t,"BaseSVGVisualizer",function(){return o.BaseSVGVisualizer}),e.d(t,"PianoRollSVGVisualizer",function(){return o.PianoRollSVGVisualizer}),e.d(t,"WaterfallSVGVisualizer",function(){return o.WaterfallSVGVisualizer}),e.d(t,"ScrollType",function(){return o.ScrollType}),e.d(t,"StaffSVGVisualizer",function(){return o.StaffSVGVisualizer}),e.d(t,"Coconet",function(){return s.Coconet}),e.d(t,"MusicRNN",function(){return i.MusicRNN}),e.d(t,"MidiMe",function(){return a.MidiMe}),e.d(t,"Decoder",function(){return a.Decoder}),e.d(t,"Encoder",function(){return a.Encoder}),e.d(t,"MusicVAE",function(){return a.MusicVAE}),e.d(t,"PianoGenie",function(){return u.PianoGenie}),e.d(t,"PianoGenieKeysig",function(){return u.PianoGenieKeysig}),e.d(t,"PianoGenieChord",function(){return u.PianoGenieChord}),e.d(t,"PianoGenieKeysigChordFamily",function(){return u.PianoGenieKeysigChordFamily}),e.d(t,"PianoGenieKeysigChord",function(){return u.PianoGenieKeysigChord}),e.d(t,"NoteSequence",function(){return c.NoteSequence}),e.d(t,"OnsetsAndFrames",function(){return h.OnsetsAndFrames}),e.d(t,"GANSynth",function(){return f.GANSynth}),e.d(t,"SPICE",function(){return d}),e.d(t,"DDSP",function(){return p.DDSP});var r=e(2),o=e(73),s=e(185),i=e(186),a=e(187),u=e(188),c=e(181),h=e(184),f=e(183),g=e(25);class d{constructor(y){this.modelUrl=y||"https://tfhub.dev/google/tfjs-model/spice/2/default/1"}initialize(){return Te(this,null,function*(){this.spiceModel=yield Object(g.h)(this.modelUrl),this.initialized=!0})}getAudioFeatures(y,v){return Te(this,null,function*(){return yield Object(g.g)(y,this.spiceModel,v)})}dispose(){this.initialized&&(this.spiceModel.dispose(),this.initialized=!1)}isInitialized(){return this.initialized}}var p=e(182)}])})});function i9(n,t){return Object.is(n,t)}var Yi=null,z_=!1,VO=1,jb=Symbol("SIGNAL");function Fo(n){let t=Yi;return Yi=n,t}function jO(){return Yi}var V_={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function UO(n){if(z_)throw new Error("");if(Yi===null)return;Yi.consumerOnSignalRead(n);let t=Yi.nextProducerIndex++;if(U_(Yi),t<Yi.producerNode.length&&Yi.producerNode[t]!==n&&DS(Yi)){let e=Yi.producerNode[t];j_(e,Yi.producerIndexOfThis[t])}Yi.producerNode[t]!==n&&(Yi.producerNode[t]=n,Yi.producerIndexOfThis[t]=DS(Yi)?p9(n,Yi,t):0),Yi.producerLastReadVersion[t]=n.version}function a9(){VO++}function u9(n){if(!(DS(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===VO)){if(!n.producerMustRecompute(n)&&!WO(n)){zO(n);return}n.producerRecomputeValue(n),zO(n)}}function qO(n){if(n.liveConsumerNode===void 0)return;let t=z_;z_=!0;try{for(let e of n.liveConsumerNode)e.dirty||B1e(e)}finally{z_=t}}function c9(){return Yi?.consumerAllowSignalWrites!==!1}function B1e(n){n.dirty=!0,qO(n),n.consumerMarkedDirty?.(n)}function zO(n){n.dirty=!1,n.lastCleanEpoch=VO}function GO(n){return n&&(n.nextProducerIndex=0),Fo(n)}function l9(n,t){if(Fo(t),!(!n||n.producerNode===void 0||n.producerIndexOfThis===void 0||n.producerLastReadVersion===void 0)){if(DS(n))for(let e=n.nextProducerIndex;e<n.producerNode.length;e++)j_(n.producerNode[e],n.producerIndexOfThis[e]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function WO(n){U_(n);for(let t=0;t<n.producerNode.length;t++){let e=n.producerNode[t],r=n.producerLastReadVersion[t];if(r!==e.version||(u9(e),r!==e.version))return!0}return!1}function HO(n){if(U_(n),DS(n))for(let t=0;t<n.producerNode.length;t++)j_(n.producerNode[t],n.producerIndexOfThis[t]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function p9(n,t,e){if(h9(n),n.liveConsumerNode.length===0&&d9(n))for(let r=0;r<n.producerNode.length;r++)n.producerIndexOfThis[r]=p9(n.producerNode[r],n,r);return n.liveConsumerIndexOfThis.push(e),n.liveConsumerNode.push(t)-1}function j_(n,t){if(h9(n),n.liveConsumerNode.length===1&&d9(n))for(let r=0;r<n.producerNode.length;r++)j_(n.producerNode[r],n.producerIndexOfThis[r]);let e=n.liveConsumerNode.length-1;if(n.liveConsumerNode[t]=n.liveConsumerNode[e],n.liveConsumerIndexOfThis[t]=n.liveConsumerIndexOfThis[e],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,t<n.liveConsumerNode.length){let r=n.liveConsumerIndexOfThis[t],o=n.liveConsumerNode[t];U_(o),o.producerIndexOfThis[r]=t}}function DS(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function U_(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}function h9(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}function d9(n){return n.producerNode!==void 0}function z1e(){throw new Error}var f9=z1e;function V1e(n){f9(n)}function KO(n){f9=n}var j1e=null;function XO(n,t){c9()||V1e(n),n.equal(n.value,t)||(n.value=t,U1e(n))}var YO=Tn(Tt({},V_),{equal:i9,value:void 0,kind:"signal"});function U1e(n){n.version++,a9(),qO(n),j1e?.()}var QO;function AS(){return QO}function Af(n){let t=QO;return QO=n,t}var q_=Symbol("NotFound");function Rr(n){return typeof n=="function"}function Ub(n){let e=n(r=>{Error.call(r),r.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var G_=Ub(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((r,o)=>`${o+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function OS(n,t){if(n){let e=n.indexOf(t);0<=e&&n.splice(e,1)}}var Mi=class n{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let s of e)s.remove(this);else e.remove(this);let{initialTeardown:r}=this;if(Rr(r))try{r()}catch(s){t=s instanceof G_?s.errors:[s]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let s of o)try{m9(s)}catch(i){t=t??[],i instanceof G_?t=[...t,...i.errors]:t.push(i)}}if(t)throw new G_(t)}}add(t){var e;if(t&&t!==this)if(this.closed)m9(t);else{if(t instanceof n){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}}_hasParent(t){let{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){let{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&OS(e,t)}remove(t){let{_finalizers:e}=this;e&&OS(e,t),t instanceof n&&t._removeParent(this)}};Mi.EMPTY=(()=>{let n=new Mi;return n.closed=!0,n})();var ZO=Mi.EMPTY;function W_(n){return n instanceof Mi||n&&"closed"in n&&Rr(n.remove)&&Rr(n.add)&&Rr(n.unsubscribe)}function m9(n){Rr(n)?n():n.unsubscribe()}var vp={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var qb={setTimeout(n,t,...e){let{delegate:r}=qb;return r?.setTimeout?r.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){let{delegate:t}=qb;return(t?.clearTimeout||clearTimeout)(n)},delegate:void 0};function H_(n){qb.setTimeout(()=>{let{onUnhandledError:t}=vp;if(t)t(n);else throw n})}function RS(){}var g9=JO("C",void 0,void 0);function y9(n){return JO("E",void 0,n)}function x9(n){return JO("N",n,void 0)}function JO(n,t,e){return{kind:n,value:t,error:e}}var Fy=null;function Gb(n){if(vp.useDeprecatedSynchronousErrorHandling){let t=!Fy;if(t&&(Fy={errorThrown:!1,error:null}),n(),t){let{errorThrown:e,error:r}=Fy;if(Fy=null,e)throw r}}else n()}function b9(n){vp.useDeprecatedSynchronousErrorHandling&&Fy&&(Fy.errorThrown=!0,Fy.error=n)}var Py=class extends Mi{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,W_(t)&&t.add(this)):this.destination=J1e}static create(t,e,r){return new Wb(t,e,r)}next(t){this.isStopped?tR(x9(t),this):this._next(t)}error(t){this.isStopped?tR(y9(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?tR(g9,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Q1e=Function.prototype.bind;function eR(n,t){return Q1e.call(n,t)}var nR=class{constructor(t){this.partialObserver=t}next(t){let{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(r){K_(r)}}error(t){let{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(r){K_(r)}else K_(t)}complete(){let{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){K_(e)}}},Wb=class extends Py{constructor(t,e,r){super();let o;if(Rr(t)||!t)o={next:t??void 0,error:e??void 0,complete:r??void 0};else{let s;this&&vp.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),o={next:t.next&&eR(t.next,s),error:t.error&&eR(t.error,s),complete:t.complete&&eR(t.complete,s)}):o=t}this.destination=new nR(o)}};function K_(n){vp.useDeprecatedSynchronousErrorHandling?b9(n):H_(n)}function Z1e(n){throw n}function tR(n,t){let{onStoppedNotification:e}=vp;e&&qb.setTimeout(()=>e(n,t))}var J1e={closed:!0,next:RS,error:Z1e,complete:RS};var Hb=typeof Symbol=="function"&&Symbol.observable||"@@observable";function jc(n){return n}function rR(...n){return oR(n)}function oR(n){return n.length===0?jc:n.length===1?n[0]:function(e){return n.reduce((r,o)=>o(r),e)}}var es=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){let r=new n;return r.source=this,r.operator=e,r}subscribe(e,r,o){let s=txe(e)?e:new Wb(e,r,o);return Gb(()=>{let{operator:i,source:a}=this;s.add(i?i.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return r=v9(r),new r((o,s)=>{let i=new Wb({next:a=>{try{e(a)}catch(u){s(u),i.unsubscribe()}},error:s,complete:o});this.subscribe(i)})}_subscribe(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)}[Hb](){return this}pipe(...e){return oR(e)(this)}toPromise(e){return e=v9(e),new e((r,o)=>{let s;this.subscribe(i=>s=i,i=>o(i),()=>r(s))})}}return n.create=t=>new n(t),n})();function v9(n){var t;return(t=n??vp.Promise)!==null&&t!==void 0?t:Promise}function exe(n){return n&&Rr(n.next)&&Rr(n.error)&&Rr(n.complete)}function txe(n){return n&&n instanceof Py||exe(n)&&W_(n)}function sR(n){return Rr(n?.lift)}function co(n){return t=>{if(sR(t))return t.lift(function(e){try{return n(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function lo(n,t,e,r,o){return new iR(n,t,e,r,o)}var iR=class extends Py{constructor(t,e,r,o,s,i){super(t),this.onFinalize=s,this.shouldUnsubscribe=i,this._next=e?function(a){try{e(a)}catch(u){t.error(u)}}:super._next,this._error=o?function(a){try{o(a)}catch(u){t.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((t=this.onFinalize)===null||t===void 0||t.call(this))}}};function Kb(){return co((n,t)=>{let e=null;n._refCount++;let r=lo(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){e=null;return}let o=n._connection,s=e;e=null,o&&(!s||o===s)&&o.unsubscribe(),t.unsubscribe()});n.subscribe(r),r.closed||(e=n.connect())})}var Xb=class extends es{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,sR(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){let t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Mi;let e=this.getSubject();t.add(this.source.subscribe(lo(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Mi.EMPTY)}return t}refCount(){return Kb()(this)}};var w9=Ub(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var za=(()=>{class n extends es{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let r=new X_(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new w9}next(e){Gb(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(e)}})}error(e){Gb(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){Gb(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:r,isStopped:o,observers:s}=this;return r||o?ZO:(this.currentObservers=null,s.push(e),new Mi(()=>{this.currentObservers=null,OS(s,e)}))}_checkFinalizedStatuses(e){let{hasError:r,thrownError:o,isStopped:s}=this;r?e.error(o):s&&e.complete()}asObservable(){let e=new es;return e.source=this,e}}return n.create=(t,e)=>new X_(t,e),n})(),X_=class extends za{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.next)===null||r===void 0||r.call(e,t)}error(t){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.error)===null||r===void 0||r.call(e,t)}complete(){var t,e;(e=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||e===void 0||e.call(t)}_subscribe(t){var e,r;return(r=(e=this.source)===null||e===void 0?void 0:e.subscribe(t))!==null&&r!==void 0?r:ZO}};var Va=class extends za{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){let e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){let{hasError:t,thrownError:e,_value:r}=this;if(t)throw e;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}};var ic=new es(n=>n.complete());function S9(n){return n&&Rr(n.schedule)}function C9(n){return n[n.length-1]}function I9(n){return Rr(C9(n))?n.pop():void 0}function Gg(n){return S9(C9(n))?n.pop():void 0}function T9(n,t,e,r){function o(s){return s instanceof e?s:new e(function(i){i(s)})}return new(e||(e=Promise))(function(s,i){function a(h){try{c(r.next(h))}catch(f){i(f)}}function u(h){try{c(r.throw(h))}catch(f){i(f)}}function c(h){h.done?s(h.value):o(h.value).then(a,u)}c((r=r.apply(n,t||[])).next())})}function _9(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function $y(n){return this instanceof $y?(this.v=n,this):new $y(n)}function E9(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(n,t||[]),o,s=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",i),o[Symbol.asyncIterator]=function(){return this},o;function i(d){return function(p){return Promise.resolve(p).then(d,f)}}function a(d,p){r[d]&&(o[d]=function(m){return new Promise(function(y,v){s.push([d,m,y,v])>1||u(d,m)})},p&&(o[d]=p(o[d])))}function u(d,p){try{c(r[d](p))}catch(m){g(s[0][3],m)}}function c(d){d.value instanceof $y?Promise.resolve(d.value.v).then(h,f):g(s[0][2],d)}function h(d){u("next",d)}function f(d){u("throw",d)}function g(d,p){d(p),s.shift(),s.length&&u(s[0][0],s[0][1])}}function N9(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof _9=="function"?_9(n):n[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(s){e[s]=n[s]&&function(i){return new Promise(function(a,u){i=n[s](i),o(a,u,i.done,i.value)})}}function o(s,i,a,u){Promise.resolve(u).then(function(c){s({value:c,done:a})},i)}}var Y_=n=>n&&typeof n.length=="number"&&typeof n!="function";function Q_(n){return Rr(n?.then)}function Z_(n){return Rr(n[Hb])}function J_(n){return Symbol.asyncIterator&&Rr(n?.[Symbol.asyncIterator])}function eT(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function nxe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var tT=nxe();function nT(n){return Rr(n?.[tT])}function rT(n){return E9(this,arguments,function*(){let e=n.getReader();try{for(;;){let{value:r,done:o}=yield $y(e.read());if(o)return yield $y(void 0);yield yield $y(r)}}finally{e.releaseLock()}})}function oT(n){return Rr(n?.getReader)}function xa(n){if(n instanceof es)return n;if(n!=null){if(Z_(n))return rxe(n);if(Y_(n))return oxe(n);if(Q_(n))return sxe(n);if(J_(n))return k9(n);if(nT(n))return ixe(n);if(oT(n))return axe(n)}throw eT(n)}function rxe(n){return new es(t=>{let e=n[Hb]();if(Rr(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function oxe(n){return new es(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}function sxe(n){return new es(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,H_)})}function ixe(n){return new es(t=>{for(let e of n)if(t.next(e),t.closed)return;t.complete()})}function k9(n){return new es(t=>{uxe(n,t).catch(e=>t.error(e))})}function axe(n){return k9(rT(n))}function uxe(n,t){var e,r,o,s;return T9(this,void 0,void 0,function*(){try{for(e=N9(n);r=yield e.next(),!r.done;){let i=r.value;if(t.next(i),t.closed)return}}catch(i){o={error:i}}finally{try{r&&!r.done&&(s=e.return)&&(yield s.call(e))}finally{if(o)throw o.error}}t.complete()})}function ac(n,t,e,r=0,o=!1){let s=t.schedule(function(){e(),o?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!o)return s}function sT(n,t=0){return co((e,r)=>{e.subscribe(lo(r,o=>ac(r,n,()=>r.next(o),t),()=>ac(r,n,()=>r.complete(),t),o=>ac(r,n,()=>r.error(o),t)))})}function iT(n,t=0){return co((e,r)=>{r.add(n.schedule(()=>e.subscribe(r),t))})}function D9(n,t){return xa(n).pipe(iT(t),sT(t))}function A9(n,t){return xa(n).pipe(iT(t),sT(t))}function O9(n,t){return new es(e=>{let r=0;return t.schedule(function(){r===n.length?e.complete():(e.next(n[r++]),e.closed||this.schedule())})})}function R9(n,t){return new es(e=>{let r;return ac(e,t,()=>{r=n[tT](),ac(e,t,()=>{let o,s;try{({value:o,done:s}=r.next())}catch(i){e.error(i);return}s?e.complete():e.next(o)},0,!0)}),()=>Rr(r?.return)&&r.return()})}function aT(n,t){if(!n)throw new Error("Iterable cannot be null");return new es(e=>{ac(e,t,()=>{let r=n[Symbol.asyncIterator]();ac(e,t,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function M9(n,t){return aT(rT(n),t)}function F9(n,t){if(n!=null){if(Z_(n))return D9(n,t);if(Y_(n))return O9(n,t);if(Q_(n))return A9(n,t);if(J_(n))return aT(n,t);if(nT(n))return R9(n,t);if(oT(n))return M9(n,t)}throw eT(n)}function ai(n,t){return t?F9(n,t):xa(n)}function br(...n){let t=Gg(n);return ai(n,t)}function Yb(n,t){let e=Rr(n)?n:()=>n,r=o=>o.error(e());return new es(t?o=>t.schedule(r,0,o):r)}function aR(n){return!!n&&(n instanceof es||Rr(n.lift)&&Rr(n.subscribe))}var Of=Ub(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function go(n,t){return co((e,r)=>{let o=0;e.subscribe(lo(r,s=>{r.next(n.call(t,s,o++))}))})}var{isArray:cxe}=Array;function lxe(n,t){return cxe(t)?n(...t):n(t)}function P9(n){return go(t=>lxe(n,t))}var{isArray:pxe}=Array,{getPrototypeOf:hxe,prototype:dxe,keys:fxe}=Object;function $9(n){if(n.length===1){let t=n[0];if(pxe(t))return{args:t,keys:null};if(mxe(t)){let e=fxe(t);return{args:e.map(r=>t[r]),keys:e}}}return{args:n,keys:null}}function mxe(n){return n&&typeof n=="object"&&hxe(n)===dxe}function L9(n,t){return n.reduce((e,r,o)=>(e[r]=t[o],e),{})}function MS(...n){let t=Gg(n),e=I9(n),{args:r,keys:o}=$9(n);if(r.length===0)return ai([],t);let s=new es(gxe(r,t,o?i=>L9(o,i):jc));return e?s.pipe(P9(e)):s}function gxe(n,t,e=jc){return r=>{B9(t,()=>{let{length:o}=n,s=new Array(o),i=o,a=o;for(let u=0;u<o;u++)B9(t,()=>{let c=ai(n[u],t),h=!1;c.subscribe(lo(r,f=>{s[u]=f,h||(h=!0,a--),a||r.next(e(s.slice()))},()=>{--i||r.complete()}))},r)},r)}}function B9(n,t,e){n?ac(e,n,t):t()}function z9(n,t,e,r,o,s,i,a){let u=[],c=0,h=0,f=!1,g=()=>{f&&!u.length&&!c&&t.complete()},d=m=>c<r?p(m):u.push(m),p=m=>{s&&t.next(m),c++;let y=!1;xa(e(m,h++)).subscribe(lo(t,v=>{o?.(v),s?d(v):t.next(v)},()=>{y=!0},void 0,()=>{if(y)try{for(c--;u.length&&c<r;){let v=u.shift();i?ac(t,i,()=>p(v)):p(v)}g()}catch(v){t.error(v)}}))};return n.subscribe(lo(t,d,()=>{f=!0,g()})),()=>{a?.()}}function Ci(n,t,e=1/0){return Rr(t)?Ci((r,o)=>go((s,i)=>t(r,s,o,i))(xa(n(r,o))),e):(typeof t=="number"&&(e=t),co((r,o)=>z9(r,o,n,e)))}function Qb(n=1/0){return Ci(jc,n)}function V9(){return Qb(1)}function Zb(...n){return V9()(ai(n,Gg(n)))}function uT(n){return new es(t=>{xa(n()).subscribe(t)})}function Uc(n,t){return co((e,r)=>{let o=0;e.subscribe(lo(r,s=>n.call(t,s,o++)&&r.next(s)))})}function Rf(n){return co((t,e)=>{let r=null,o=!1,s;r=t.subscribe(lo(e,void 0,void 0,i=>{s=xa(n(i,Rf(n)(t))),r?(r.unsubscribe(),r=null,s.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,s.subscribe(e))})}function j9(n,t,e,r,o){return(s,i)=>{let a=e,u=t,c=0;s.subscribe(lo(i,h=>{let f=c++;u=a?n(u,h,f):(a=!0,h),r&&i.next(u)},o&&(()=>{a&&i.next(u),i.complete()})))}}function Wg(n,t){return Rr(t)?Ci(n,t,1):Ci(n,1)}function Hg(n){return co((t,e)=>{let r=!1;t.subscribe(lo(e,o=>{r=!0,e.next(o)},()=>{r||e.next(n),e.complete()}))})}function Mf(n){return n<=0?()=>ic:co((t,e)=>{let r=0;t.subscribe(lo(e,o=>{++r<=n&&(e.next(o),n<=r&&e.complete())}))})}function cT(n=yxe){return co((t,e)=>{let r=!1;t.subscribe(lo(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(n())))})}function yxe(){return new Of}function FS(n){return co((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}function Ff(n,t){let e=arguments.length>=2;return r=>r.pipe(n?Uc((o,s)=>n(o,s,r)):jc,Mf(1),e?Hg(t):cT(()=>new Of))}function Jb(n){return n<=0?()=>ic:co((t,e)=>{let r=[];t.subscribe(lo(e,o=>{r.push(o),n<r.length&&r.shift()},()=>{for(let o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}function uR(n,t){let e=arguments.length>=2;return r=>r.pipe(n?Uc((o,s)=>n(o,s,r)):jc,Jb(1),e?Hg(t):cT(()=>new Of))}function cR(n,t){return co(j9(n,t,arguments.length>=2,!0))}function lR(...n){let t=Gg(n);return co((e,r)=>{(t?Zb(n,e,t):Zb(n,e)).subscribe(r)})}function vl(n,t){return co((e,r)=>{let o=null,s=0,i=!1,a=()=>i&&!o&&r.complete();e.subscribe(lo(r,u=>{o?.unsubscribe();let c=0,h=s++;xa(n(u,h)).subscribe(o=lo(r,f=>r.next(t?t(u,f,h,c++):f),()=>{o=null,a()}))},()=>{i=!0,a()}))})}function pR(n){return co((t,e)=>{xa(n).subscribe(lo(e,()=>e.complete(),RS)),!e.closed&&t.subscribe(e)})}function ja(n,t,e){let r=Rr(n)||t||e?{next:n,error:t,complete:e}:n;return r?co((o,s)=>{var i;(i=r.subscribe)===null||i===void 0||i.call(r);let a=!0;o.subscribe(lo(s,u=>{var c;(c=r.next)===null||c===void 0||c.call(r,u),s.next(u)},()=>{var u;a=!1,(u=r.complete)===null||u===void 0||u.call(r),s.complete()},u=>{var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,u),s.error(u)},()=>{var u,c;a&&((u=r.unsubscribe)===null||u===void 0||u.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):jc}var ur=class extends Error{code;constructor(t,e){super(NB(t,e)),this.code=t}};function xxe(n){return`NG0${Math.abs(n)}`}function NB(n,t){return`${xxe(n)}${t?": "+t:""}`}var kB=Symbol("InputSignalNode#UNSET"),bxe=Tn(Tt({},YO),{transformFn:void 0,applyValueToInputSignal(n,t){XO(n,t)}});function DB(n,t){let e=Object.create(bxe);e.value=n,e.transformFn=t?.transform;function r(){if(UO(e),e.value===kB){let o=null;throw new ur(-950,o)}return e.value}return r[jb]=e,r}function PT(n){return{toString:n}.toString()}function as(n){for(let t in n)if(n[t]===as)return t;throw Error("Could not find renamed property on target object.")}function qc(n){if(typeof n=="string")return n;if(Array.isArray(n))return`[${n.map(qc).join(", ")}]`;if(n==null)return""+n;let t=n.overriddenName||n.name;if(t)return`${t}`;let e=n.toString();if(e==null)return""+e;let r=e.indexOf(`
`);return r>=0?e.slice(0,r):e}function U9(n,t){return n?t?`${n} ${t}`:n:t||""}var vxe=as({__forward_ref__:as});function AB(n){return n.__forward_ref__=AB,n.toString=function(){return qc(this())},n}function Sl(n){return OB(n)?n():n}function OB(n){return typeof n=="function"&&n.hasOwnProperty(vxe)&&n.__forward_ref__===AB}function rr(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function WS(n){return{providers:n.providers||[],imports:n.imports||[]}}function $T(n){return q9(n,MB)||q9(n,FB)}function RB(n){return $T(n)!==null}function q9(n,t){return n.hasOwnProperty(t)?n[t]:null}function wxe(n){let t=n&&(n[MB]||n[FB]);return t||null}function G9(n){return n&&(n.hasOwnProperty(W9)||n.hasOwnProperty(Sxe))?n[W9]:null}var MB=as({\u0275prov:as}),W9=as({\u0275inj:as}),FB=as({ngInjectableDef:as}),Sxe=as({ngInjectorDef:as}),lr=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(t,e){this._desc=t,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=rr({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function PB(n){return n&&!!n.\u0275providers}var Cxe=as({\u0275cmp:as}),Ixe=as({\u0275dir:as}),_xe=as({\u0275pipe:as}),Txe=as({\u0275mod:as}),mT=as({\u0275fac:as}),BS=as({__NG_ELEMENT_ID__:as}),H9=as({__NG_ENV_ID__:as});function $B(n){return typeof n=="string"?n:n==null?"":String(n)}function Exe(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():$B(n)}function LB(n,t){throw new ur(-200,n)}function ZR(n,t){throw new ur(-201,!1)}var zr=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(zr||{}),bR;function BB(){return bR}function wl(n){let t=bR;return bR=n,t}function zB(n,t,e){let r=$T(n);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(e&zr.Optional)return null;if(t!==void 0)return t;ZR(n,"Injector")}var Nxe={},Ly=Nxe,kxe="__NG_DI_FLAG__",gT=class{injector;constructor(t){this.injector=t}retrieve(t,e){let r=e;return this.injector.get(t,r.optional?q_:Ly,r)}},yT="ngTempTokenPath",Dxe="ngTokenPath",Axe=/\n/gm,Oxe="\u0275",K9="__source";function Rxe(n,t=zr.Default){if(AS()===void 0)throw new ur(-203,!1);if(AS()===null)return zB(n,void 0,t);{let e=AS(),r;return e instanceof gT?r=e.injector:r=e,r.get(n,t&zr.Optional?null:void 0,t)}}function Sr(n,t=zr.Default){return(BB()||Rxe)(Sl(n),t)}function xn(n,t=zr.Default){return Sr(n,LT(t))}function LT(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function vR(n){let t=[];for(let e=0;e<n.length;e++){let r=Sl(n[e]);if(Array.isArray(r)){if(r.length===0)throw new ur(900,!1);let o,s=zr.Default;for(let i=0;i<r.length;i++){let a=r[i],u=Mxe(a);typeof u=="number"?u===-1?o=a.token:s|=u:o=a}t.push(Sr(o,s))}else t.push(Sr(r))}return t}function Mxe(n){return n[kxe]}function Fxe(n,t,e,r){let o=n[yT];throw t[K9]&&o.unshift(t[K9]),n.message=Pxe(`
`+n.message,o,e,r),n[Dxe]=o,n[yT]=null,n}function Pxe(n,t,e,r=null){n=n&&n.charAt(0)===`
`&&n.charAt(1)==Oxe?n.slice(2):n;let o=qc(t);if(Array.isArray(t))o=t.map(qc).join(" -> ");else if(typeof t=="object"){let s=[];for(let i in t)if(t.hasOwnProperty(i)){let a=t[i];s.push(i+":"+(typeof a=="string"?JSON.stringify(a):qc(a)))}o=`{${s.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${n.replace(Axe,`
  `)}`}function iv(n,t){let e=n.hasOwnProperty(mT);return e?n[mT]:null}function JR(n,t){n.forEach(e=>Array.isArray(e)?JR(e,t):t(e))}function VB(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function xT(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}var av={},bh=[],zS=new lr(""),jB=new lr("",-1),UB=new lr(""),bT=class{get(t,e=Ly){if(e===Ly){let r=new Error(`NullInjectorError: No provider for ${qc(t)}!`);throw r.name="NullInjectorError",r}return e}};function qB(n,t){let e=n[Txe]||null;if(!e&&t===!0)throw new Error(`Type ${qc(n)} does not have '\u0275mod' property.`);return e}function Vy(n){return n[Cxe]||null}function $xe(n){return n[Ixe]||null}function Lxe(n){return n[_xe]||null}function BT(n){return{\u0275providers:n}}function Bxe(...n){return{\u0275providers:GB(!0,n),\u0275fromNgModule:!0}}function GB(n,...t){let e=[],r=new Set,o,s=i=>{e.push(i)};return JR(t,i=>{let a=i;wR(a,s,[],r)&&(o||=[],o.push(a))}),o!==void 0&&WB(o,s),e}function WB(n,t){for(let e=0;e<n.length;e++){let{ngModule:r,providers:o}=n[e];e4(o,s=>{t(s,r)})}}function wR(n,t,e,r){if(n=Sl(n),!n)return!1;let o=null,s=G9(n),i=!s&&Vy(n);if(!s&&!i){let u=n.ngModule;if(s=G9(u),s)o=u;else return!1}else{if(i&&!i.standalone)return!1;o=n}let a=r.has(o);if(i){if(a)return!1;if(r.add(o),i.dependencies){let u=typeof i.dependencies=="function"?i.dependencies():i.dependencies;for(let c of u)wR(c,t,e,r)}}else if(s){if(s.imports!=null&&!a){r.add(o);let c;try{JR(s.imports,h=>{wR(h,t,e,r)&&(c||=[],c.push(h))})}finally{}c!==void 0&&WB(c,t)}if(!a){let c=iv(o)||(()=>new o);t({provide:o,useFactory:c,deps:bh},o),t({provide:UB,useValue:o,multi:!0},o),t({provide:zS,useValue:()=>Sr(o),multi:!0},o)}let u=s.providers;if(u!=null&&!a){let c=n;e4(u,h=>{t(h,c)})}}else return!1;return o!==n&&n.providers!==void 0}function e4(n,t){for(let e of n)PB(e)&&(e=e.\u0275providers),Array.isArray(e)?e4(e,t):t(e)}var zxe=as({provide:String,useValue:as});function HB(n){return n!==null&&typeof n=="object"&&zxe in n}function Vxe(n){return!!(n&&n.useExisting)}function jxe(n){return!!(n&&n.useFactory)}function SR(n){return typeof n=="function"}var zT=new lr(""),lT={},X9={},hR;function t4(){return hR===void 0&&(hR=new bT),hR}var cc=class{},VS=class extends cc{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(t,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,IR(t,i=>this.processProvider(i)),this.records.set(jB,ev(void 0,this)),o.has("environment")&&this.records.set(cc,ev(void 0,this));let s=this.records.get(zT);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(UB,bh,zr.Self))}retrieve(t,e){let r=e;return this.get(t,r.optional?q_:Ly,r)}destroy(){$S(this),this._destroyed=!0;let t=Fo(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of e)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Fo(t)}}onDestroy(t){return $S(this),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){$S(this);let e=Af(this),r=wl(void 0),o;try{return t()}finally{Af(e),wl(r)}}get(t,e=Ly,r=zr.Default){if($S(this),t.hasOwnProperty(H9))return t[H9](this);r=LT(r);let o,s=Af(this),i=wl(void 0);try{if(!(r&zr.SkipSelf)){let u=this.records.get(t);if(u===void 0){let c=Kxe(t)&&$T(t);c&&this.injectableDefInScope(c)?u=ev(CR(t),lT):u=null,this.records.set(t,u)}if(u!=null)return this.hydrate(t,u,r)}let a=r&zr.Self?t4():this.parent;return e=r&zr.Optional&&e===Ly?null:e,a.get(t,e)}catch(a){if(a.name==="NullInjectorError"){if((a[yT]=a[yT]||[]).unshift(qc(t)),s)throw a;return Fxe(a,t,"R3InjectorError",this.source)}else throw a}finally{wl(i),Af(s)}}resolveInjectorInitializers(){let t=Fo(null),e=Af(this),r=wl(void 0),o;try{let s=this.get(zS,bh,zr.Self);for(let i of s)i()}finally{Af(e),wl(r),Fo(t)}}toString(){let t=[],e=this.records;for(let r of e.keys())t.push(qc(r));return`R3Injector[${t.join(", ")}]`}processProvider(t){t=Sl(t);let e=SR(t)?t:Sl(t&&t.provide),r=qxe(t);if(!SR(t)&&t.multi===!0){let o=this.records.get(e);o||(o=ev(void 0,lT,!0),o.factory=()=>vR(o.multi),this.records.set(e,o)),e=t,o.multi.push(t)}this.records.set(e,r)}hydrate(t,e,r){let o=Fo(null);try{return e.value===X9?LB(qc(t)):e.value===lT&&(e.value=X9,e.value=e.factory(void 0,r)),typeof e.value=="object"&&e.value&&Hxe(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{Fo(o)}}injectableDefInScope(t){if(!t.providedIn)return!1;let e=Sl(t.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(t){let e=this._onDestroyHooks.indexOf(t);e!==-1&&this._onDestroyHooks.splice(e,1)}};function CR(n){let t=$T(n),e=t!==null?t.factory:iv(n);if(e!==null)return e;if(n instanceof lr)throw new ur(204,!1);if(n instanceof Function)return Uxe(n);throw new ur(204,!1)}function Uxe(n){if(n.length>0)throw new ur(204,!1);let e=wxe(n);return e!==null?()=>e.factory(n):()=>new n}function qxe(n){if(HB(n))return ev(void 0,n.useValue);{let t=Gxe(n);return ev(t,lT)}}function Gxe(n,t,e){let r;if(SR(n)){let o=Sl(n);return iv(o)||CR(o)}else if(HB(n))r=()=>Sl(n.useValue);else if(jxe(n))r=()=>n.useFactory(...vR(n.deps||[]));else if(Vxe(n))r=(o,s)=>Sr(Sl(n.useExisting),s!==void 0&&s&zr.Optional?zr.Optional:void 0);else{let o=Sl(n&&(n.useClass||n.provide));if(Wxe(n))r=()=>new o(...vR(n.deps));else return iv(o)||CR(o)}return r}function $S(n){if(n.destroyed)throw new ur(205,!1)}function ev(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function Wxe(n){return!!n.deps}function Hxe(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function Kxe(n){return typeof n=="function"||typeof n=="object"&&n instanceof lr}function IR(n,t){for(let e of n)Array.isArray(e)?IR(e,t):e&&PB(e)?IR(e.\u0275providers,t):t(e)}function El(n,t){let e;n instanceof VS?($S(n),e=n):e=new gT(n);let r,o=Af(e),s=wl(void 0);try{return t()}finally{Af(o),wl(s)}}function KB(){return BB()!==void 0||AS()!=null}function Xxe(n){if(!KB())throw new ur(-203,!1)}function Yxe(n){return typeof n=="function"}var Pf=0,yo=1,jr=2,Lu=3,Sp=4,Ip=5,vT=6,wT=7,_l=8,uv=9,Xg=10,Tl=11,jS=12,Y9=13,HS=14,wh=15,US=16,tv=17,VT=18,jT=19,XB=20,Kg=21,dR=22,ST=23,Cl=24,ov=25,Yg=26,YB=1;var jy=7,CT=8,IT=9,Il=10;function By(n){return Array.isArray(n)&&typeof n[YB]=="object"}function $f(n){return Array.isArray(n)&&n[YB]===!0}function QB(n){return(n.flags&4)!==0}function KS(n){return n.componentOffset>-1}function ZB(n){return(n.flags&1)===1}function Wy(n){return!!n.template}function _T(n){return(n[jr]&512)!==0}function hv(n){return(n[jr]&256)===256}var _R=class{previousValue;currentValue;firstChange;constructor(t,e,r){this.previousValue=t,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}};function JB(n,t,e,r){t!==null?t.applyValueToInputSignal(t,r):n[e]=r}var UT=(()=>{let n=()=>ez;return n.ngInherit=!0,n})();function ez(n){return n.type.prototype.ngOnChanges&&(n.setInput=Zxe),Qxe}function Qxe(){let n=nz(this),t=n?.current;if(t){let e=n.previous;if(e===av)n.previous=t;else for(let r in t)e[r]=t[r];n.current=null,this.ngOnChanges(t)}}function Zxe(n,t,e,r,o){let s=this.declaredInputs[r],i=nz(n)||Jxe(n,{previous:av,current:null}),a=i.current||(i.current={}),u=i.previous,c=u[s];a[s]=new _R(c&&c.currentValue,e,u===av),JB(n,t,o,e)}var tz="__ngSimpleChanges__";function nz(n){return n[tz]||null}function Jxe(n,t){return n[tz]=t}var Q9=null;var ts=function(n,t=null,e){Q9?.(n,t,e)},ebe="svg",tbe="math";function Sh(n){for(;Array.isArray(n);)n=n[Pf];return n}function nbe(n,t){return Sh(t[n])}function Zg(n,t){return Sh(t[n.index])}function rbe(n,t){return n.data[t]}function Qg(n,t){let e=t[n];return By(e)?e:e[Pf]}function n4(n){return(n[jr]&128)===128}function obe(n){return $f(n[Lu])}function Z9(n,t){return t==null?null:n[t]}function rz(n){n[tv]=0}function oz(n){n[jr]&1024||(n[jr]|=1024,n4(n)&&XS(n))}function qT(n){return!!(n[jr]&9216||n[Cl]?.dirty)}function TR(n){n[Xg].changeDetectionScheduler?.notify(8),n[jr]&64&&(n[jr]|=1024),qT(n)&&XS(n)}function XS(n){n[Xg].changeDetectionScheduler?.notify(0);let t=Uy(n);for(;t!==null&&!(t[jr]&8192||(t[jr]|=8192,!n4(t)));)t=Uy(t)}function sz(n,t){if(hv(n))throw new ur(911,!1);n[Kg]===null&&(n[Kg]=[]),n[Kg].push(t)}function sbe(n,t){if(n[Kg]===null)return;let e=n[Kg].indexOf(t);e!==-1&&n[Kg].splice(e,1)}function Uy(n){let t=n[Lu];return $f(t)?t[Lu]:t}function iz(n){return n[wT]??=[]}function az(n){return n.cleanup??=[]}var Ho={lFrame:fz(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var ER=!1;function ibe(){return Ho.lFrame.elementDepthCount}function abe(){Ho.lFrame.elementDepthCount++}function ube(){Ho.lFrame.elementDepthCount--}function cbe(){return Ho.bindingsEnabled}function lbe(){return Ho.skipHydrationRootTNode!==null}function pbe(n){return Ho.skipHydrationRootTNode===n}function hbe(){Ho.skipHydrationRootTNode=null}function lc(){return Ho.lFrame.lView}function YS(){return Ho.lFrame.tView}function Lf(){let n=uz();for(;n!==null&&n.type===64;)n=n.parent;return n}function uz(){return Ho.lFrame.currentTNode}function dbe(){let n=Ho.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}function GT(n,t){let e=Ho.lFrame;e.currentTNode=n,e.isParent=t}function cz(){return Ho.lFrame.isParent}function fbe(){Ho.lFrame.isParent=!1}function lz(){return ER}function J9(n){let t=ER;return ER=n,t}function mbe(n){return Ho.lFrame.bindingIndex=n}function gbe(){return Ho.lFrame.bindingIndex++}function ybe(){return Ho.lFrame.inI18n}function xbe(n,t){let e=Ho.lFrame;e.bindingIndex=e.bindingRootIndex=n,NR(t)}function bbe(){return Ho.lFrame.currentDirectiveIndex}function NR(n){Ho.lFrame.currentDirectiveIndex=n}function pz(n){Ho.lFrame.currentQueryIndex=n}function vbe(n){let t=n[yo];return t.type===2?t.declTNode:t.type===1?n[Ip]:null}function hz(n,t,e){if(e&zr.SkipSelf){let o=t,s=n;for(;o=o.parent,o===null&&!(e&zr.Host);)if(o=vbe(s),o===null||(s=s[HS],o.type&10))break;if(o===null)return!1;t=o,n=s}let r=Ho.lFrame=dz();return r.currentTNode=t,r.lView=n,!0}function r4(n){let t=dz(),e=n[yo];Ho.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function dz(){let n=Ho.lFrame,t=n===null?null:n.child;return t===null?fz(n):t}function fz(n){let t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=t),t}function mz(){let n=Ho.lFrame;return Ho.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var gz=mz;function o4(){let n=mz();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function s4(){return Ho.lFrame.selectedIndex}function qy(n){Ho.lFrame.selectedIndex=n}function wbe(){return Ho.lFrame.currentNamespace}var yz=!0;function xz(){return yz}function bz(n){yz=n}function Sbe(n,t,e){let{ngOnChanges:r,ngOnInit:o,ngDoCheck:s}=t.type.prototype;if(r){let i=ez(t);(e.preOrderHooks??=[]).push(n,i),(e.preOrderCheckHooks??=[]).push(n,i)}o&&(e.preOrderHooks??=[]).push(0-n,o),s&&((e.preOrderHooks??=[]).push(n,s),(e.preOrderCheckHooks??=[]).push(n,s))}function Cbe(n,t){for(let e=t.directiveStart,r=t.directiveEnd;e<r;e++){let s=n.data[e].type.prototype,{ngAfterContentInit:i,ngAfterContentChecked:a,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:h}=s;i&&(n.contentHooks??=[]).push(-e,i),a&&((n.contentHooks??=[]).push(e,a),(n.contentCheckHooks??=[]).push(e,a)),u&&(n.viewHooks??=[]).push(-e,u),c&&((n.viewHooks??=[]).push(e,c),(n.viewCheckHooks??=[]).push(e,c)),h!=null&&(n.destroyHooks??=[]).push(e,h)}}function pT(n,t,e){vz(n,t,3,e)}function hT(n,t,e,r){(n[jr]&3)===e&&vz(n,t,e,r)}function fR(n,t){let e=n[jr];(e&3)===t&&(e&=16383,e+=1,n[jr]=e)}function vz(n,t,e,r){let o=r!==void 0?n[tv]&65535:0,s=r??-1,i=t.length-1,a=0;for(let u=o;u<i;u++)if(typeof t[u+1]=="number"){if(a=t[u],r!=null&&a>=r)break}else t[u]<0&&(n[tv]+=65536),(a<s||s==-1)&&(Ibe(n,e,t,u),n[tv]=(n[tv]&4294901760)+u+2),u++}function eB(n,t){ts(4,n,t);let e=Fo(null);try{t.call(n)}finally{Fo(e),ts(5,n,t)}}function Ibe(n,t,e,r){let o=e[r]<0,s=e[r+1],i=o?-e[r]:e[r],a=n[i];o?n[jr]>>14<n[tv]>>16&&(n[jr]&3)===t&&(n[jr]+=16384,eB(a,s)):eB(a,s)}var sv=-1,qS=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(t,e,r){this.factory=t,this.canSeeViewProviders=e,this.injectImpl=r}};function _be(n){return(n.flags&8)!==0}function Tbe(n){return(n.flags&16)!==0}function Ebe(n,t,e){let r=0;for(;r<e.length;){let o=e[r];if(typeof o=="number"){if(o!==0)break;r++;let s=e[r++],i=e[r++],a=e[r++];n.setAttribute(t,i,a,s)}else{let s=o,i=e[++r];kbe(s)?n.setProperty(t,s,i):n.setAttribute(t,s,i),r++}}return r}function Nbe(n){return n===3||n===4||n===6}function kbe(n){return n.charCodeAt(0)===64}function wz(n,t){if(!(t===null||t.length===0))if(n===null||n.length===0)n=t.slice();else{let e=-1;for(let r=0;r<t.length;r++){let o=t[r];typeof o=="number"?e=o:e===0||(e===-1||e===2?tB(n,e,o,null,t[++r]):tB(n,e,o,null,null))}}return n}function tB(n,t,e,r,o){let s=0,i=n.length;if(t===-1)i=-1;else for(;s<n.length;){let a=n[s++];if(typeof a=="number"){if(a===t){i=-1;break}else if(a>t){i=s-1;break}}}for(;s<n.length;){let a=n[s];if(typeof a=="number")break;if(a===e){o!==null&&(n[s+1]=o);return}s++,o!==null&&s++}i!==-1&&(n.splice(i,0,t),s=i+1),n.splice(s++,0,e),o!==null&&n.splice(s++,0,o)}function Sz(n){return n!==sv}function TT(n){return n&32767}function Dbe(n){return n>>16}function ET(n,t){let e=Dbe(n),r=t;for(;e>0;)r=r[HS],e--;return r}var kR=!0;function nB(n){let t=kR;return kR=n,t}var Abe=256,Cz=Abe-1,Iz=5,Obe=0,vh={};function Rbe(n,t,e){let r;typeof e=="string"?r=e.charCodeAt(0)||0:e.hasOwnProperty(BS)&&(r=e[BS]),r==null&&(r=e[BS]=Obe++);let o=r&Cz,s=1<<o;t.data[n+(o>>Iz)]|=s}function _z(n,t){let e=Tz(n,t);if(e!==-1)return e;let r=t[yo];r.firstCreatePass&&(n.injectorIndex=t.length,mR(r.data,n),mR(t,null),mR(r.blueprint,null));let o=i4(n,t),s=n.injectorIndex;if(Sz(o)){let i=TT(o),a=ET(o,t),u=a[yo].data;for(let c=0;c<8;c++)t[s+c]=a[i+c]|u[i+c]}return t[s+8]=o,s}function mR(n,t){n.push(0,0,0,0,0,0,0,0,t)}function Tz(n,t){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||t[n.injectorIndex+8]===null?-1:n.injectorIndex}function i4(n,t){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let e=0,r=null,o=t;for(;o!==null;){if(r=Az(o),r===null)return sv;if(e++,o=o[HS],r.injectorIndex!==-1)return r.injectorIndex|e<<16}return sv}function Mbe(n,t,e){Rbe(n,t,e)}function Ez(n,t,e){if(e&zr.Optional||n!==void 0)return n;ZR(t,"NodeInjector")}function Nz(n,t,e,r){if(e&zr.Optional&&r===void 0&&(r=null),(e&(zr.Self|zr.Host))===0){let o=n[uv],s=wl(void 0);try{return o?o.get(t,r,e&zr.Optional):zB(t,r,e&zr.Optional)}finally{wl(s)}}return Ez(r,t,e)}function kz(n,t,e,r=zr.Default,o){if(n!==null){if(t[jr]&2048&&!(r&zr.Self)){let i=Bbe(n,t,e,r,vh);if(i!==vh)return i}let s=Dz(n,t,e,r,vh);if(s!==vh)return s}return Nz(t,e,r,o)}function Dz(n,t,e,r,o){let s=$be(e);if(typeof s=="function"){if(!hz(t,n,r))return r&zr.Host?Ez(o,e,r):Nz(t,e,r,o);try{let i;if(i=s(r),i==null&&!(r&zr.Optional))ZR(e);else return i}finally{gz()}}else if(typeof s=="number"){let i=null,a=Tz(n,t),u=sv,c=r&zr.Host?t[wh][Ip]:null;for((a===-1||r&zr.SkipSelf)&&(u=a===-1?i4(n,t):t[a+8],u===sv||!oB(r,!1)?a=-1:(i=t[yo],a=TT(u),t=ET(u,t)));a!==-1;){let h=t[yo];if(rB(s,a,h.data)){let f=Fbe(a,t,e,i,r,c);if(f!==vh)return f}u=t[a+8],u!==sv&&oB(r,t[yo].data[a+8]===c)&&rB(s,a,t)?(i=h,a=TT(u),t=ET(u,t)):a=-1}}return o}function Fbe(n,t,e,r,o,s){let i=t[yo],a=i.data[n+8],u=r==null?KS(a)&&kR:r!=i&&(a.type&3)!==0,c=o&zr.Host&&s===a,h=Pbe(a,i,e,u,c);return h!==null?DR(t,i,h,a,o):vh}function Pbe(n,t,e,r,o){let s=n.providerIndexes,i=t.data,a=s&1048575,u=n.directiveStart,c=n.directiveEnd,h=s>>20,f=r?a:a+h,g=o?a+h:c;for(let d=f;d<g;d++){let p=i[d];if(d<u&&e===p||d>=u&&p.type===e)return d}if(o){let d=i[u];if(d&&Wy(d)&&d.type===e)return u}return null}function DR(n,t,e,r,o){let s=n[e],i=t.data;if(s instanceof qS){let a=s;a.resolving&&LB(Exe(i[e]));let u=nB(a.canSeeViewProviders);a.resolving=!0;let c,h=a.injectImpl?wl(a.injectImpl):null,f=hz(n,r,zr.Default);try{s=n[e]=a.factory(void 0,o,i,n,r),t.firstCreatePass&&e>=r.directiveStart&&Sbe(e,i[e],t)}finally{h!==null&&wl(h),nB(u),a.resolving=!1,gz()}}return s}function $be(n){if(typeof n=="string")return n.charCodeAt(0)||0;let t=n.hasOwnProperty(BS)?n[BS]:void 0;return typeof t=="number"?t>=0?t&Cz:Lbe:t}function rB(n,t,e){let r=1<<n;return!!(e[t+(n>>Iz)]&r)}function oB(n,t){return!(n&zr.Self)&&!(n&zr.Host&&t)}var zy=class{_tNode;_lView;constructor(t,e){this._tNode=t,this._lView=e}get(t,e,r){return kz(this._tNode,this._lView,t,LT(r),e)}};function Lbe(){return new zy(Lf(),lc())}function a4(n){return PT(()=>{let t=n.prototype.constructor,e=t[mT]||AR(t),r=Object.prototype,o=Object.getPrototypeOf(n.prototype).constructor;for(;o&&o!==r;){let s=o[mT]||AR(o);if(s&&s!==e)return s;o=Object.getPrototypeOf(o)}return s=>new s})}function AR(n){return OB(n)?()=>{let t=AR(Sl(n));return t&&t()}:iv(n)}function Bbe(n,t,e,r,o){let s=n,i=t;for(;s!==null&&i!==null&&i[jr]&2048&&!_T(i);){let a=Dz(s,i,e,r|zr.Self,vh);if(a!==vh)return a;let u=s.parent;if(!u){let c=i[XB];if(c){let h=c.get(e,vh,r);if(h!==vh)return h}u=Az(i),i=i[HS]}s=u}return o}function Az(n){let t=n[yo],e=t.type;return e===2?t.declTNode:e===1?n[Ip]:null}function sB(n,t=null,e=null,r){let o=Oz(n,t,e,r);return o.resolveInjectorInitializers(),o}function Oz(n,t=null,e=null,r,o=new Set){let s=[e||bh,Bxe(n)];return r=r||(typeof n=="object"?void 0:qc(n)),new VS(s,t||t4(),r||null,o)}var Cp=class n{static THROW_IF_NOT_FOUND=Ly;static NULL=new bT;static create(t,e){if(Array.isArray(t))return sB({name:""},e,t,"");{let r=t.name??"";return sB({name:r},t.parent,t.providers,r)}}static \u0275prov=rr({token:n,providedIn:"any",factory:()=>Sr(jB)});static __NG_ELEMENT_ID__=-1};var zbe=new lr("");zbe.__NG_ELEMENT_ID__=n=>{let t=Lf();if(t===null)throw new ur(204,!1);if(t.type&2)return t.value;if(n&zr.Optional)return null;throw new ur(204,!1)};var Rz=!1,QS=(()=>{class n{static __NG_ELEMENT_ID__=Vbe;static __NG_ENV_ID__=e=>e}return n})(),OR=class extends QS{_lView;constructor(t){super(),this._lView=t}onDestroy(t){let e=this._lView;return hv(e)?(t(),()=>{}):(sz(e,t),()=>sbe(e,t))}};function Vbe(){return new OR(lc())}var cv=class{},u4=new lr("",{providedIn:"root",factory:()=>!1});var Mz=new lr(""),Fz=new lr(""),dv=(()=>{class n{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new Va(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=rr({token:n,providedIn:"root",factory:()=>new n})}return n})();var RR=class extends za{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(t=!1){super(),this.__isAsync=t,KB()&&(this.destroyRef=xn(QS,{optional:!0})??void 0,this.pendingTasks=xn(dv,{optional:!0})??void 0)}emit(t){let e=Fo(null);try{super.next(t)}finally{Fo(e)}}subscribe(t,e,r){let o=t,s=e||(()=>null),i=r;if(t&&typeof t=="object"){let u=t;o=u.next?.bind(u),s=u.error?.bind(u),i=u.complete?.bind(u)}this.__isAsync&&(s=this.wrapInTimeout(s),o&&(o=this.wrapInTimeout(o)),i&&(i=this.wrapInTimeout(i)));let a=super.subscribe({next:o,error:s,complete:i});return t instanceof Mi&&t.add(a),a}wrapInTimeout(t){return e=>{let r=this.pendingTasks?.add();setTimeout(()=>{try{t(e)}finally{r!==void 0&&this.pendingTasks?.remove(r)}})}}},uc=RR;function NT(...n){}function Pz(n){let t,e;function r(){n=NT;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),t!==void 0&&clearTimeout(t)}catch{}}return t=setTimeout(()=>{n(),r()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{n(),r()})),()=>r()}function iB(n){return queueMicrotask(()=>n()),()=>{n=NT}}var c4="isAngularZone",kT=c4+"_ID",jbe=0,Ii=class n{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new uc(!1);onMicrotaskEmpty=new uc(!1);onStable=new uc(!1);onError=new uc(!1);constructor(t){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:o=!1,scheduleInRootZone:s=Rz}=t;if(typeof Zone>"u")throw new ur(908,!1);Zone.assertZonePatched();let i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!o&&r,i.shouldCoalesceRunChangeDetection=o,i.callbackScheduled=!1,i.scheduleInRootZone=s,Gbe(i)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(c4)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new ur(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new ur(909,!1)}run(t,e,r){return this._inner.run(t,e,r)}runTask(t,e,r,o){let s=this._inner,i=s.scheduleEventTask("NgZoneEvent: "+o,t,Ube,NT,NT);try{return s.runTask(i,e,r)}finally{s.cancelTask(i)}}runGuarded(t,e,r){return this._inner.runGuarded(t,e,r)}runOutsideAngular(t){return this._outer.run(t)}},Ube={};function l4(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function qbe(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function t(){Pz(()=>{n.callbackScheduled=!1,MR(n),n.isCheckStableRunning=!0,l4(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{t()}):n._outer.run(()=>{t()}),MR(n)}function Gbe(n){let t=()=>{qbe(n)},e=jbe++;n._inner=n._inner.fork({name:"angular",properties:{[c4]:!0,[kT]:e,[kT+e]:!0},onInvokeTask:(r,o,s,i,a,u)=>{if(Wbe(u))return r.invokeTask(s,i,a,u);try{return aB(n),r.invokeTask(s,i,a,u)}finally{(n.shouldCoalesceEventChangeDetection&&i.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&t(),uB(n)}},onInvoke:(r,o,s,i,a,u,c)=>{try{return aB(n),r.invoke(s,i,a,u,c)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!Hbe(u)&&t(),uB(n)}},onHasTask:(r,o,s,i)=>{r.hasTask(s,i),o===s&&(i.change=="microTask"?(n._hasPendingMicrotasks=i.microTask,MR(n),l4(n)):i.change=="macroTask"&&(n.hasPendingMacrotasks=i.macroTask))},onHandleError:(r,o,s,i)=>(r.handleError(s,i),n.runOutsideAngular(()=>n.onError.emit(i)),!1)})}function MR(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function aB(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function uB(n){n._nesting--,l4(n)}var FR=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new uc;onMicrotaskEmpty=new uc;onStable=new uc;onError=new uc;run(t,e,r){return t.apply(e,r)}runGuarded(t,e,r){return t.apply(e,r)}runOutsideAngular(t){return t()}runTask(t,e,r,o){return t.apply(e,r)}};function Wbe(n){return $z(n,"__ignore_ng_zone__")}function Hbe(n){return $z(n,"__scheduler_tick__")}function $z(n,t){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[t]===!0}var Ch=class{_console=console;handleError(t){this._console.error("ERROR",t)}},Kbe=new lr("",{providedIn:"root",factory:()=>{let n=xn(Ii),t=xn(Ch);return e=>n.runOutsideAngular(()=>t.handleError(e))}});function cB(n,t){return DB(n,t)}function Xbe(n){return DB(kB,n)}var Lz=(cB.required=Xbe,cB);function Ybe(){return p4(Lf(),lc())}function p4(n,t){return new WT(Zg(n,t))}var WT=(()=>{class n{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=Ybe}return n})();function Bz(n){return(n.flags&128)===128}var zz=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(zz||{}),Vz=new Map,Qbe=0;function Zbe(){return Qbe++}function Jbe(n){Vz.set(n[jT],n)}function PR(n){Vz.delete(n[jT])}var lB="__ngContext__";function HT(n,t){By(t)?(n[lB]=t[jT],Jbe(t)):n[lB]=t}function jz(n){return qz(n[jS])}function Uz(n){return qz(n[Sp])}function qz(n){for(;n!==null&&!$f(n);)n=n[Sp];return n}var $R;function Gz(n){$R=n}function eve(){if($R!==void 0)return $R;if(typeof document<"u")return document;throw new ur(210,!1)}var h4=new lr("",{providedIn:"root",factory:()=>tve}),tve="ng",d4=new lr(""),fv=new lr("",{providedIn:"platform",factory:()=>"unknown"});var f4=new lr("",{providedIn:"root",factory:()=>eve().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var nve="h",rve="b";var Wz=!1,ove=new lr("",{providedIn:"root",factory:()=>Wz});var m4=function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n}(m4||{}),mv=new lr(""),pB=new Set;function gv(n){pB.has(n)||(pB.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}var Hz=(()=>{class n{view;node;constructor(e,r){this.view=e,this.node=r}static __NG_ELEMENT_ID__=sve}return n})();function sve(){return new Hz(lc(),Lf())}var nv=function(n){return n[n.EarlyRead=0]="EarlyRead",n[n.Write=1]="Write",n[n.MixedReadWrite=2]="MixedReadWrite",n[n.Read=3]="Read",n}(nv||{}),Kz=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=rr({token:n,providedIn:"root",factory:()=>new n})}return n})(),ive=[nv.EarlyRead,nv.Write,nv.MixedReadWrite,nv.Read],ave=(()=>{class n{ngZone=xn(Ii);scheduler=xn(cv);errorHandler=xn(Ch,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){xn(mv,{optional:!0})}execute(){let e=this.sequences.size>0;e&&ts(16),this.executing=!0;for(let r of ive)for(let o of this.sequences)if(!(o.erroredOrDestroyed||!o.hooks[r]))try{o.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>{let s=o.hooks[r];return s(o.pipelinedValue)},o.snapshot))}catch(s){o.erroredOrDestroyed=!0,this.errorHandler?.handleError(s)}this.executing=!1;for(let r of this.sequences)r.afterRun(),r.once&&(this.sequences.delete(r),r.destroy());for(let r of this.deferredRegistrations)this.sequences.add(r);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),e&&ts(17)}register(e){let{view:r}=e;r!==void 0?((r[ov]??=[]).push(e),XS(r),r[jr]|=8192):this.executing?this.deferredRegistrations.add(e):this.addSequence(e)}addSequence(e){this.sequences.add(e),this.scheduler.notify(7)}unregister(e){this.executing&&this.sequences.has(e)?(e.erroredOrDestroyed=!0,e.pipelinedValue=void 0,e.once=!0):(this.sequences.delete(e),this.deferredRegistrations.delete(e))}maybeTrace(e,r){return r?r.run(m4.AFTER_NEXT_RENDER,e):e()}static \u0275prov=rr({token:n,providedIn:"root",factory:()=>new n})}return n})(),LR=class{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(t,e,r,o,s,i=null){this.impl=t,this.hooks=e,this.view=r,this.once=o,this.snapshot=i,this.unregisterOnDestroy=s?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();let t=this.view?.[ov];t&&(this.view[ov]=t.filter(e=>e!==this))}};function g4(n,t){!t?.injector&&Xxe(g4);let e=t?.injector??xn(Cp);return gv("NgAfterNextRender"),cve(n,e,t,!0)}function uve(n,t){if(n instanceof Function){let e=[void 0,void 0,void 0,void 0];return e[t]=n,e}else return[n.earlyRead,n.write,n.mixedReadWrite,n.read]}function cve(n,t,e,r){let o=t.get(Kz);o.impl??=t.get(ave);let s=t.get(mv,null,{optional:!0}),i=e?.phase??nv.MixedReadWrite,a=e?.manualCleanup!==!0?t.get(QS):null,u=t.get(Hz,null,{optional:!0}),c=new LR(o.impl,uve(n,i),u?.view,r,a,s?.snapshot(null));return o.impl.register(c),c}var lve=(n,t,e,r)=>{};function pve(n,t,e,r){lve(n,t,e,r)}var hve=()=>null;function Xz(n,t,e=!1){return hve(n,t,e)}function Yz(n,t){let e=n.contentQueries;if(e!==null){let r=Fo(null);try{for(let o=0;o<e.length;o+=2){let s=e[o],i=e[o+1];if(i!==-1){let a=n.data[i];pz(s),a.contentQueries(2,t[i],i)}}}finally{Fo(r)}}}function BR(n,t,e){pz(0);let r=Fo(null);try{t(n,e)}finally{Fo(r)}}function Qz(n,t,e){if(QB(t)){let r=Fo(null);try{let o=t.directiveStart,s=t.directiveEnd;for(let i=o;i<s;i++){let a=n.data[i];if(a.contentQueries){let u=e[i];a.contentQueries(1,u,i)}}}finally{Fo(r)}}}var Ih=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(Ih||{});function Zz(n){return n instanceof Function?n():n}function dve(n,t,e){let r=n.length;for(;;){let o=n.indexOf(t,e);if(o===-1)return o;if(o===0||n.charCodeAt(o-1)<=32){let s=t.length;if(o+s===r||n.charCodeAt(o+s)<=32)return o}e=o+1}}var Jz="ng-template";function fve(n,t,e,r){let o=0;if(r){for(;o<t.length&&typeof t[o]=="string";o+=2)if(t[o]==="class"&&dve(t[o+1].toLowerCase(),e,0)!==-1)return!0}else if(y4(n))return!1;if(o=t.indexOf(1,o),o>-1){let s;for(;++o<t.length&&typeof(s=t[o])=="string";)if(s.toLowerCase()===e)return!0}return!1}function y4(n){return n.type===4&&n.value!==Jz}function mve(n,t,e){let r=n.type===4&&!e?Jz:n.value;return t===r}function gve(n,t,e){let r=4,o=n.attrs,s=o!==null?bve(o):0,i=!1;for(let a=0;a<t.length;a++){let u=t[a];if(typeof u=="number"){if(!i&&!wp(r)&&!wp(u))return!1;if(i&&wp(u))continue;i=!1,r=u|r&1;continue}if(!i)if(r&4){if(r=2|r&1,u!==""&&!mve(n,u,e)||u===""&&t.length===1){if(wp(r))return!1;i=!0}}else if(r&8){if(o===null||!fve(n,o,u,e)){if(wp(r))return!1;i=!0}}else{let c=t[++a],h=yve(u,o,y4(n),e);if(h===-1){if(wp(r))return!1;i=!0;continue}if(c!==""){let f;if(h>s?f="":f=o[h+1].toLowerCase(),r&2&&c!==f){if(wp(r))return!1;i=!0}}}}return wp(r)||i}function wp(n){return(n&1)===0}function yve(n,t,e,r){if(t===null)return-1;let o=0;if(r||!e){let s=!1;for(;o<t.length;){let i=t[o];if(i===n)return o;if(i===3||i===6)s=!0;else if(i===1||i===2){let a=t[++o];for(;typeof a=="string";)a=t[++o];continue}else{if(i===4)break;if(i===0){o+=4;continue}}o+=s?1:2}return-1}else return vve(t,n)}function xve(n,t,e=!1){for(let r=0;r<t.length;r++)if(gve(n,t[r],e))return!0;return!1}function bve(n){for(let t=0;t<n.length;t++){let e=n[t];if(Nbe(e))return t}return n.length}function vve(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){let r=n[e];if(typeof r=="number")return-1;if(r===t)return e;e++}return-1}function hB(n,t){return n?":not("+t.trim()+")":t}function wve(n){let t=n[0],e=1,r=2,o="",s=!1;for(;e<n.length;){let i=n[e];if(typeof i=="string")if(r&2){let a=n[++e];o+="["+i+(a.length>0?'="'+a+'"':"")+"]"}else r&8?o+="."+i:r&4&&(o+=" "+i);else o!==""&&!wp(i)&&(t+=hB(s,o),o=""),r=i,s=s||!wp(r);e++}return o!==""&&(t+=hB(s,o)),t}function Sve(n){return n.map(wve).join(",")}function Cve(n){let t=[],e=[],r=1,o=2;for(;r<n.length;){let s=n[r];if(typeof s=="string")o===2?s!==""&&t.push(s,n[++r]):o===8&&e.push(s);else{if(!wp(o))break;o=s}r++}return e.length&&t.push(1,...e),t}var KT={};function Ive(n,t){return n.createText(t)}function _ve(n,t,e){n.setValue(t,e)}function eV(n,t,e){return n.createElement(t,e)}function DT(n,t,e,r,o){n.insertBefore(t,e,r,o)}function tV(n,t,e){n.appendChild(t,e)}function dB(n,t,e,r,o){r!==null?DT(n,t,e,r,o):tV(n,t,e)}function Tve(n,t,e){n.removeChild(null,t,e)}function Eve(n,t,e){n.setAttribute(t,"style",e)}function Nve(n,t,e){e===""?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function nV(n,t,e){let{mergedAttrs:r,classes:o,styles:s}=e;r!==null&&Ebe(n,t,r),o!==null&&Nve(n,t,o),s!==null&&Eve(n,t,s)}function rV(n,t,e,r,o,s,i,a,u,c,h){let f=Yg+r,g=f+o,d=kve(f,g),p=typeof c=="function"?c():c;return d[yo]={type:n,blueprint:d,template:e,queries:null,viewQuery:a,declTNode:t,data:d.slice().fill(null,f),bindingStartIndex:f,expandoStartIndex:g,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof i=="function"?i():i,firstChild:null,schemas:u,consts:p,incompleteFirstPass:!1,ssrId:h}}function kve(n,t){let e=[];for(let r=0;r<t;r++)e.push(r<n?null:KT);return e}function Dve(n){let t=n.tView;return t===null||t.incompleteFirstPass?n.tView=rV(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):t}function oV(n,t,e,r,o,s,i,a,u,c,h){let f=t.blueprint.slice();return f[Pf]=o,f[jr]=r|4|128|8|64|1024,(c!==null||n&&n[jr]&2048)&&(f[jr]|=2048),rz(f),f[Lu]=f[HS]=n,f[_l]=e,f[Xg]=i||n&&n[Xg],f[Tl]=a||n&&n[Tl],f[uv]=u||n&&n[uv]||null,f[Ip]=s,f[jT]=Zbe(),f[vT]=h,f[XB]=c,f[wh]=t.type==2?n[wh]:f,f}function Ave(n,t,e){let r=Zg(t,n),o=Dve(e),s=n[Xg].rendererFactory,i=aV(n,oV(n,o,null,sV(e),r,t,null,s.createRenderer(r,e),null,null,null));return n[t.index]=i}function sV(n){let t=16;return n.signals?t=4096:n.onPush&&(t=64),t}function iV(n,t,e,r){if(e===0)return-1;let o=t.length;for(let s=0;s<e;s++)t.push(r),n.blueprint.push(r),n.data.push(null);return o}function aV(n,t){return n[jS]?n[Y9][Sp]=t:n[jS]=t,n[Y9]=t,t}function uV(n=1){cV(YS(),lc(),s4()+n,!1)}function cV(n,t,e,r){if(!r)if((t[jr]&3)===3){let s=n.preOrderCheckHooks;s!==null&&pT(t,s,e)}else{let s=n.preOrderHooks;s!==null&&hT(t,s,0,e)}qy(e)}var XT=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(XT||{});function zR(n,t,e,r){let o=Fo(null);try{let[s,i,a]=n.inputs[e],u=null;(i&XT.SignalBased)!==0&&(u=t[s][jb]),u!==null&&u.transformFn!==void 0?r=u.transformFn(r):a!==null&&(r=a.call(t,r)),n.setInput!==null?n.setInput(t,u,r,e,s):JB(t,u,s,r)}finally{Fo(o)}}function lV(n,t,e,r,o){let s=s4(),i=r&2;try{qy(-1),i&&t.length>Yg&&cV(n,t,Yg,!1),ts(i?2:0,o),e(r,o)}finally{qy(s),ts(i?3:1,o)}}function pV(n,t,e){Pve(n,t,e),(e.flags&64)===64&&$ve(n,t,e)}function Ove(n,t,e=Zg){let r=t.localNames;if(r!==null){let o=t.index+1;for(let s=0;s<r.length;s+=2){let i=r[s+1],a=i===-1?e(t,n):n[i];n[o++]=a}}}function Rve(n,t,e,r){let s=r.get(ove,Wz)||e===Ih.ShadowDom,i=n.selectRootElement(t,s);return Mve(i),i}function Mve(n){Fve(n)}var Fve=()=>null;function Pve(n,t,e){let r=e.directiveStart,o=e.directiveEnd;KS(e)&&Ave(t,e,n.data[r+e.componentOffset]),n.firstCreatePass||_z(e,t);let s=e.initialInputs;for(let i=r;i<o;i++){let a=n.data[i],u=DR(t,n,i,e);if(HT(u,t),s!==null&&zve(t,i-r,u,a,e,s),Wy(a)){let c=Qg(e.index,t);c[_l]=DR(t,n,i,e)}}}function $ve(n,t,e){let r=e.directiveStart,o=e.directiveEnd,s=e.index,i=bbe();try{qy(s);for(let a=r;a<o;a++){let u=n.data[a],c=t[a];NR(a),(u.hostBindings!==null||u.hostVars!==0||u.hostAttrs!==null)&&Lve(u,c)}}finally{qy(-1),NR(i)}}function Lve(n,t){n.hostBindings!==null&&n.hostBindings(1,t)}function Bve(n,t){let e=n.directiveRegistry,r=null;if(e)for(let o=0;o<e.length;o++){let s=e[o];xve(t,s.selectors,!1)&&(r??=[],Wy(s)?r.unshift(s):r.push(s))}return r}function zve(n,t,e,r,o,s){let i=s[t];if(i!==null)for(let a=0;a<i.length;a+=2){let u=i[a],c=i[a+1];zR(r,e,u,c)}}function Vve(n,t){let e=n[uv],r=e?e.get(Ch,null):null;r&&r.handleError(t)}function hV(n,t,e,r,o){let s=n.inputs?.[r],i=n.hostDirectiveInputs?.[r],a=!1;if(i)for(let u=0;u<i.length;u+=2){let c=i[u],h=i[u+1],f=t.data[c];zR(f,e[c],h,o),a=!0}if(s)for(let u of s){let c=e[u],h=t.data[u];zR(h,c,r,o),a=!0}return a}function jve(n,t){let e=Qg(t,n),r=e[yo];Uve(r,e);let o=e[Pf];o!==null&&e[vT]===null&&(e[vT]=Xz(o,e[uv])),ts(18),dV(r,e,e[_l]),ts(19,e[_l])}function Uve(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])}function dV(n,t,e){r4(t);try{let r=n.viewQuery;r!==null&&BR(1,r,e);let o=n.template;o!==null&&lV(n,t,o,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),t[VT]?.finishViewCreation(n),n.staticContentQueries&&Yz(n,t),n.staticViewQueries&&BR(2,n.viewQuery,e);let s=n.components;s!==null&&qve(t,s)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{t[jr]&=-5,o4()}}function qve(n,t){for(let e=0;e<t.length;e++)jve(n,t[e])}function fB(n,t){return!t||t.firstChild===null||Bz(n)}var Gve;function x4(n,t){return Gve(n,t)}var yv=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(yv||{});function fV(n){return(n.flags&32)===32}function rv(n,t,e,r,o){if(r!=null){let s,i=!1;$f(r)?s=r:By(r)&&(i=!0,r=r[Pf]);let a=Sh(r);n===0&&e!==null?o==null?tV(t,e,a):DT(t,e,a,o||null,!0):n===1&&e!==null?DT(t,e,a,o||null,!0):n===2?Tve(t,a,i):n===3&&t.destroyNode(a),s!=null&&rwe(t,n,s,e,o)}}function Wve(n,t){mV(n,t),t[Pf]=null,t[Ip]=null}function Hve(n,t,e,r,o,s){r[Pf]=o,r[Ip]=t,YT(n,r,e,1,o,s)}function mV(n,t){t[Xg].changeDetectionScheduler?.notify(9),YT(n,t,t[Tl],2,null,null)}function Kve(n){let t=n[jS];if(!t)return gR(n[yo],n);for(;t;){let e=null;if(By(t))e=t[jS];else{let r=t[Il];r&&(e=r)}if(!e){for(;t&&!t[Sp]&&t!==n;)By(t)&&gR(t[yo],t),t=t[Lu];t===null&&(t=n),By(t)&&gR(t[yo],t),e=t&&t[Sp]}t=e}}function b4(n,t){let e=n[IT],r=e.indexOf(t);e.splice(r,1)}function gV(n,t){if(hv(t))return;let e=t[Tl];e.destroyNode&&YT(n,t,e,3,null,null),Kve(t)}function gR(n,t){if(hv(t))return;let e=Fo(null);try{t[jr]&=-129,t[jr]|=256,t[Cl]&&HO(t[Cl]),Yve(n,t),Xve(n,t),t[yo].type===1&&t[Tl].destroy();let r=t[US];if(r!==null&&$f(t[Lu])){r!==t[Lu]&&b4(r,t);let o=t[VT];o!==null&&o.detachView(n)}PR(t)}finally{Fo(e)}}function Xve(n,t){let e=n.cleanup,r=t[wT];if(e!==null)for(let i=0;i<e.length-1;i+=2)if(typeof e[i]=="string"){let a=e[i+3];a>=0?r[a]():r[-a].unsubscribe(),i+=2}else{let a=r[e[i+1]];e[i].call(a)}r!==null&&(t[wT]=null);let o=t[Kg];if(o!==null){t[Kg]=null;for(let i=0;i<o.length;i++){let a=o[i];a()}}let s=t[ST];if(s!==null){t[ST]=null;for(let i of s)i.destroy()}}function Yve(n,t){let e;if(n!=null&&(e=n.destroyHooks)!=null)for(let r=0;r<e.length;r+=2){let o=t[e[r]];if(!(o instanceof qS)){let s=e[r+1];if(Array.isArray(s))for(let i=0;i<s.length;i+=2){let a=o[s[i]],u=s[i+1];ts(4,a,u);try{u.call(a)}finally{ts(5,a,u)}}else{ts(4,o,s);try{s.call(o)}finally{ts(5,o,s)}}}}}function Qve(n,t,e){return Zve(n,t.parent,e)}function Zve(n,t,e){let r=t;for(;r!==null&&r.type&168;)t=r,r=t.parent;if(r===null)return e[Pf];if(KS(r)){let{encapsulation:o}=n.data[r.directiveStart+r.componentOffset];if(o===Ih.None||o===Ih.Emulated)return null}return Zg(r,e)}function Jve(n,t,e){return twe(n,t,e)}function ewe(n,t,e){return n.type&40?Zg(n,e):null}var twe=ewe,mB;function yV(n,t,e,r){let o=Qve(n,r,t),s=t[Tl],i=r.parent||t[Ip],a=Jve(i,r,t);if(o!=null)if(Array.isArray(e))for(let u=0;u<e.length;u++)dB(s,o,e[u],a,!1);else dB(s,o,e,a,!1);mB!==void 0&&mB(s,r,t,e,o)}function LS(n,t){if(t!==null){let e=t.type;if(e&3)return Zg(t,n);if(e&4)return VR(-1,n[t.index]);if(e&8){let r=t.child;if(r!==null)return LS(n,r);{let o=n[t.index];return $f(o)?VR(-1,o):Sh(o)}}else{if(e&128)return LS(n,t.next);if(e&32)return x4(t,n)()||Sh(n[t.index]);{let r=xV(n,t);if(r!==null){if(Array.isArray(r))return r[0];let o=Uy(n[wh]);return LS(o,r)}else return LS(n,t.next)}}}return null}function xV(n,t){if(t!==null){let r=n[wh][Ip],o=t.projection;return r.projection[o]}return null}function VR(n,t){let e=Il+n+1;if(e<t.length){let r=t[e],o=r[yo].firstChild;if(o!==null)return LS(r,o)}return t[jy]}function v4(n,t,e,r,o,s,i){for(;e!=null;){if(e.type===128){e=e.next;continue}let a=r[e.index],u=e.type;if(i&&t===0&&(a&&HT(Sh(a),r),e.flags|=2),!fV(e))if(u&8)v4(n,t,e.child,r,o,s,!1),rv(t,n,o,a,s);else if(u&32){let c=x4(e,r),h;for(;h=c();)rv(t,n,o,h,s);rv(t,n,o,a,s)}else u&16?nwe(n,t,r,e,o,s):rv(t,n,o,a,s);e=i?e.projectionNext:e.next}}function YT(n,t,e,r,o,s){v4(e,r,n.firstChild,t,o,s,!1)}function nwe(n,t,e,r,o,s){let i=e[wh],u=i[Ip].projection[r.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++){let h=u[c];rv(t,n,o,h,s)}else{let c=u,h=i[Lu];Bz(r)&&(c.flags|=128),v4(n,t,c,h,o,s,!0)}}function rwe(n,t,e,r,o){let s=e[jy],i=Sh(e);s!==i&&rv(t,n,r,s,o);for(let a=Il;a<e.length;a++){let u=e[a];YT(u[yo],u,n,t,r,s)}}function AT(n,t,e,r,o=!1){for(;e!==null;){if(e.type===128){e=o?e.projectionNext:e.next;continue}let s=t[e.index];s!==null&&r.push(Sh(s)),$f(s)&&owe(s,r);let i=e.type;if(i&8)AT(n,t,e.child,r);else if(i&32){let a=x4(e,t),u;for(;u=a();)r.push(u)}else if(i&16){let a=xV(t,e);if(Array.isArray(a))r.push(...a);else{let u=Uy(t[wh]);AT(u[yo],u,a,r,!0)}}e=o?e.projectionNext:e.next}return r}function owe(n,t){for(let e=Il;e<n.length;e++){let r=n[e],o=r[yo].firstChild;o!==null&&AT(r[yo],r,o,t)}n[jy]!==n[Pf]&&t.push(n[jy])}function bV(n){if(n[ov]!==null){for(let t of n[ov])t.impl.addSequence(t);n[ov].length=0}}var vV=[];function swe(n){return n[Cl]??iwe(n)}function iwe(n){let t=vV.pop()??Object.create(uwe);return t.lView=n,t}function awe(n){n.lView[Cl]!==n&&(n.lView=null,vV.push(n))}var uwe=Tn(Tt({},V_),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{XS(n.lView)},consumerOnSignalRead(){this.lView[Cl]=this}});function cwe(n){let t=n[Cl]??Object.create(lwe);return t.lView=n,t}var lwe=Tn(Tt({},V_),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let t=Uy(n.lView);for(;t&&!wV(t[yo]);)t=Uy(t);t&&oz(t)},consumerOnSignalRead(){this.lView[Cl]=this}});function wV(n){return n.type!==2}function SV(n){if(n[ST]===null)return;let t=!0;for(;t;){let e=!1;for(let r of n[ST])r.dirty&&(e=!0,r.zone===null||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));t=e&&!!(n[jr]&8192)}}var pwe=100;function CV(n,t=!0,e=0){let o=n[Xg].rendererFactory,s=!1;s||o.begin?.();try{hwe(n,e)}catch(i){throw t&&Vve(n,i),i}finally{s||o.end?.()}}function hwe(n,t){let e=lz();try{J9(!0),jR(n,t);let r=0;for(;qT(n);){if(r===pwe)throw new ur(103,!1);r++,jR(n,1)}}finally{J9(e)}}function dwe(n,t,e,r){if(hv(t))return;let o=t[jr],s=!1,i=!1;r4(t);let a=!0,u=null,c=null;s||(wV(n)?(c=swe(t),u=GO(c)):jO()===null?(a=!1,c=cwe(t),u=GO(c)):t[Cl]&&(HO(t[Cl]),t[Cl]=null));try{rz(t),mbe(n.bindingStartIndex),e!==null&&lV(n,t,e,2,r);let h=(o&3)===3;if(!s)if(h){let d=n.preOrderCheckHooks;d!==null&&pT(t,d,null)}else{let d=n.preOrderHooks;d!==null&&hT(t,d,0,null),fR(t,0)}if(i||fwe(t),SV(t),IV(t,0),n.contentQueries!==null&&Yz(n,t),!s)if(h){let d=n.contentCheckHooks;d!==null&&pT(t,d)}else{let d=n.contentHooks;d!==null&&hT(t,d,1),fR(t,1)}gwe(n,t);let f=n.components;f!==null&&TV(t,f,0);let g=n.viewQuery;if(g!==null&&BR(2,g,r),!s)if(h){let d=n.viewCheckHooks;d!==null&&pT(t,d)}else{let d=n.viewHooks;d!==null&&hT(t,d,2),fR(t,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),t[dR]){for(let d of t[dR])d();t[dR]=null}s||(bV(t),t[jr]&=-73)}catch(h){throw s||XS(t),h}finally{c!==null&&(l9(c,u),a&&awe(c)),o4()}}function IV(n,t){for(let e=jz(n);e!==null;e=Uz(e))for(let r=Il;r<e.length;r++){let o=e[r];_V(o,t)}}function fwe(n){for(let t=jz(n);t!==null;t=Uz(t)){if(!(t[jr]&2))continue;let e=t[IT];for(let r=0;r<e.length;r++){let o=e[r];oz(o)}}}function mwe(n,t,e){ts(18);let r=Qg(t,n);_V(r,e),ts(19,r[_l])}function _V(n,t){n4(n)&&jR(n,t)}function jR(n,t){let r=n[yo],o=n[jr],s=n[Cl],i=!!(t===0&&o&16);if(i||=!!(o&64&&t===0),i||=!!(o&1024),i||=!!(s?.dirty&&WO(s)),i||=!1,s&&(s.dirty=!1),n[jr]&=-9217,i)dwe(r,n,r.template,n[_l]);else if(o&8192){SV(n),IV(n,1);let a=r.components;a!==null&&TV(n,a,1),bV(n)}}function TV(n,t,e){for(let r=0;r<t.length;r++)mwe(n,t[r],e)}function gwe(n,t){let e=n.hostBindingOpCodes;if(e!==null)try{for(let r=0;r<e.length;r++){let o=e[r];if(o<0)qy(~o);else{let s=o,i=e[++r],a=e[++r];xbe(i,s);let u=t[s];ts(24,u),a(2,u),ts(25,u)}}}finally{qy(-1)}}function w4(n,t){let e=lz()?64:1088;for(n[Xg].changeDetectionScheduler?.notify(t);n;){n[jr]|=e;let r=Uy(n);if(_T(n)&&!r)return n;n=r}return null}function ywe(n,t,e,r){return[n,!0,0,t,null,r,null,e,null,null]}function xwe(n,t,e,r=!0){let o=t[yo];if(bwe(o,t,n,e),r){let i=VR(e,n),a=t[Tl],u=a.parentNode(n[jy]);u!==null&&Hve(o,n[Ip],a,t,u,i)}let s=t[vT];s!==null&&s.firstChild!==null&&(s.firstChild=null)}function UR(n,t){if(n.length<=Il)return;let e=Il+t,r=n[e];if(r){let o=r[US];o!==null&&o!==n&&b4(o,r),t>0&&(n[e-1][Sp]=r[Sp]);let s=xT(n,Il+t);Wve(r[yo],r);let i=s[VT];i!==null&&i.detachView(s[yo]),r[Lu]=null,r[Sp]=null,r[jr]&=-129}return r}function bwe(n,t,e,r){let o=Il+r,s=e.length;r>0&&(e[o-1][Sp]=t),r<s-Il?(t[Sp]=e[o],VB(e,Il+r,t)):(e.push(t),t[Sp]=null),t[Lu]=e;let i=t[US];i!==null&&e!==i&&EV(i,t);let a=t[VT];a!==null&&a.insertView(n),TR(t),t[jr]|=128}function EV(n,t){let e=n[IT],r=t[Lu];if(By(r))n[jr]|=2;else{let o=r[Lu][wh];t[wh]!==o&&(n[jr]|=2)}e===null?n[IT]=[t]:e.push(t)}var OT=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let t=this._lView,e=t[yo];return AT(e,t,e.firstChild,[])}constructor(t,e,r=!0){this._lView=t,this._cdRefInjectingView=e,this.notifyErrorHandler=r}get context(){return this._lView[_l]}set context(t){this._lView[_l]=t}get destroyed(){return hv(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let t=this._lView[Lu];if($f(t)){let e=t[CT],r=e?e.indexOf(this):-1;r>-1&&(UR(t,r),xT(e,r))}this._attachedToViewContainer=!1}gV(this._lView[yo],this._lView)}onDestroy(t){sz(this._lView,t)}markForCheck(){w4(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[jr]&=-129}reattach(){TR(this._lView),this._lView[jr]|=128}detectChanges(){this._lView[jr]|=1024,CV(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ur(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let t=_T(this._lView),e=this._lView[US];e!==null&&!t&&b4(e,this._lView),mV(this._lView[yo],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new ur(902,!1);this._appRef=t;let e=_T(this._lView),r=this._lView[US];r!==null&&!e&&EV(r,this._lView),TR(this._lView)}};function NV(n,t,e,r,o){let s=n.data[t];if(s===null)s=vwe(n,t,e,r,o),ybe()&&(s.flags|=32);else if(s.type&64){s.type=e,s.value=r,s.attrs=o;let i=dbe();s.injectorIndex=i===null?-1:i.injectorIndex}return GT(s,!0),s}function vwe(n,t,e,r,o){let s=uz(),i=cz(),a=i?s:s&&s.parent,u=n.data[t]=Swe(n,a,e,t,r,o);return wwe(n,u,s,i),u}function wwe(n,t,e,r){n.firstChild===null&&(n.firstChild=t),e!==null&&(r?e.child==null&&t.parent!==null&&(e.child=t):e.next===null&&(e.next=t,t.prev=e))}function Swe(n,t,e,r,o,s){let i=t?t.injectorIndex:-1,a=0;return lbe()&&(a|=128),{type:e,index:r,insertBeforeIndex:null,injectorIndex:i,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:s,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var Fje=new RegExp(`^(\\d+)*(${rve}|${nve})*(.*)`);var Cwe=()=>null;function gB(n,t){return Cwe(n,t)}var Iwe=class{},kV=class{},qR=class{resolveComponentFactory(t){throw Error(`No component factory found for ${qc(t)}.`)}},QT=class{static NULL=new qR},lv=class{};var _we=(()=>{class n{static \u0275prov=rr({token:n,providedIn:"root",factory:()=>null})}return n})();var yR={},GR=class{injector;parentInjector;constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,r){r=LT(r);let o=this.injector.get(t,yR,r);return o!==yR||e===yR?o:this.parentInjector.get(t,e,r)}};function yB(n,t,e){let r=e?n.styles:null,o=e?n.classes:null,s=0;if(t!==null)for(let i=0;i<t.length;i++){let a=t[i];if(typeof a=="number")s=a;else if(s==1)o=U9(o,a);else if(s==2){let u=a,c=t[++i];r=U9(r,u+": "+c+";")}}e?n.styles=r:n.stylesWithoutHost=r,e?n.classes=o:n.classesWithoutHost=o}function S4(n,t=zr.Default){let e=lc();if(e===null)return Sr(n,t);let r=Lf();return kz(r,e,Sl(n),t)}function DV(){let n="invalid";throw new Error(n)}function Twe(n,t,e,r,o){let s=r===null?null:{"":-1},i=o(n,e);if(i!==null){let a,u=null,c=null,h=Nwe(i);h===null?a=i:[a,u,c]=h,Awe(n,t,e,a,s,u,c)}s!==null&&r!==null&&Ewe(e,r,s)}function Ewe(n,t,e){let r=n.localNames=[];for(let o=0;o<t.length;o+=2){let s=e[t[o+1]];if(s==null)throw new ur(-301,!1);r.push(t[o],s)}}function Nwe(n){let t=null,e=!1;for(let i=0;i<n.length;i++){let a=n[i];if(i===0&&Wy(a)&&(t=a),a.findHostDirectiveDefs!==null){e=!0;break}}if(!e)return null;let r=null,o=null,s=null;for(let i of n)i.findHostDirectiveDefs!==null&&(r??=[],o??=new Map,s??=new Map,kwe(i,r,s,o)),i===t&&(r??=[],r.push(i));return r!==null?(r.push(...t===null?n:n.slice(1)),[r,o,s]):null}function kwe(n,t,e,r){let o=t.length;n.findHostDirectiveDefs(n,t,r),e.set(n,[o,t.length-1])}function Dwe(n,t,e){t.componentOffset=e,(n.components??=[]).push(t.index)}function Awe(n,t,e,r,o,s,i){let a=r.length,u=!1;for(let g=0;g<a;g++){let d=r[g];!u&&Wy(d)&&(u=!0,Dwe(n,e,g)),Mbe(_z(e,t),n,d.type)}$we(e,n.data.length,a);for(let g=0;g<a;g++){let d=r[g];d.providersResolver&&d.providersResolver(d)}let c=!1,h=!1,f=iV(n,t,a,null);a>0&&(e.directiveToIndex=new Map);for(let g=0;g<a;g++){let d=r[g];if(e.mergedAttrs=wz(e.mergedAttrs,d.hostAttrs),Rwe(n,e,t,f,d),Pwe(f,d,o),i!==null&&i.has(d)){let[m,y]=i.get(d);e.directiveToIndex.set(d.type,[f,m+e.directiveStart,y+e.directiveStart])}else(s===null||!s.has(d))&&e.directiveToIndex.set(d.type,f);d.contentQueries!==null&&(e.flags|=4),(d.hostBindings!==null||d.hostAttrs!==null||d.hostVars!==0)&&(e.flags|=64);let p=d.type.prototype;!c&&(p.ngOnChanges||p.ngOnInit||p.ngDoCheck)&&((n.preOrderHooks??=[]).push(e.index),c=!0),!h&&(p.ngOnChanges||p.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(e.index),h=!0),f++}Owe(n,e,s)}function Owe(n,t,e){for(let r=t.directiveStart;r<t.directiveEnd;r++){let o=n.data[r];if(e===null||!e.has(o))xB(0,t,o,r),xB(1,t,o,r),vB(t,r,!1);else{let s=e.get(o);bB(0,t,s,r),bB(1,t,s,r),vB(t,r,!0)}}}function xB(n,t,e,r){let o=n===0?e.inputs:e.outputs;for(let s in o)if(o.hasOwnProperty(s)){let i;n===0?i=t.inputs??={}:i=t.outputs??={},i[s]??=[],i[s].push(r),AV(t,s)}}function bB(n,t,e,r){let o=n===0?e.inputs:e.outputs;for(let s in o)if(o.hasOwnProperty(s)){let i=o[s],a;n===0?a=t.hostDirectiveInputs??={}:a=t.hostDirectiveOutputs??={},a[i]??=[],a[i].push(r,s),AV(t,i)}}function AV(n,t){t==="class"?n.flags|=8:t==="style"&&(n.flags|=16)}function vB(n,t,e){let{attrs:r,inputs:o,hostDirectiveInputs:s}=n;if(r===null||!e&&o===null||e&&s===null||y4(n)){n.initialInputs??=[],n.initialInputs.push(null);return}let i=null,a=0;for(;a<r.length;){let u=r[a];if(u===0){a+=4;continue}else if(u===5){a+=2;continue}else if(typeof u=="number")break;if(!e&&o.hasOwnProperty(u)){let c=o[u];for(let h of c)if(h===t){i??=[],i.push(u,r[a+1]);break}}else if(e&&s.hasOwnProperty(u)){let c=s[u];for(let h=0;h<c.length;h+=2)if(c[h]===t){i??=[],i.push(c[h+1],r[a+1]);break}}a+=2}n.initialInputs??=[],n.initialInputs.push(i)}function Rwe(n,t,e,r,o){n.data[r]=o;let s=o.factory||(o.factory=iv(o.type,!0)),i=new qS(s,Wy(o),S4);n.blueprint[r]=i,e[r]=i,Mwe(n,t,r,iV(n,e,o.hostVars,KT),o)}function Mwe(n,t,e,r,o){let s=o.hostBindings;if(s){let i=n.hostBindingOpCodes;i===null&&(i=n.hostBindingOpCodes=[]);let a=~t.index;Fwe(i)!=a&&i.push(a),i.push(e,r,s)}}function Fwe(n){let t=n.length;for(;t>0;){let e=n[--t];if(typeof e=="number"&&e<0)return e}return 0}function Pwe(n,t,e){if(e){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)e[t.exportAs[r]]=n;Wy(t)&&(e[""]=n)}}function $we(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function OV(n,t,e,r,o,s,i,a){let u=t.consts,c=Z9(u,i),h=NV(t,n,2,r,c);return s&&Twe(t,e,h,Z9(u,a),o),h.mergedAttrs=wz(h.mergedAttrs,h.attrs),h.attrs!==null&&yB(h,h.attrs,!1),h.mergedAttrs!==null&&yB(h,h.mergedAttrs,!0),t.queries!==null&&t.queries.elementStart(t,h),h}function RV(n,t){Cbe(n,t),QB(t)&&n.queries.elementEnd(t)}var RT=class extends QT{ngModule;constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){let e=Vy(t);return new pv(e,this.ngModule)}};function Lwe(n){return Object.keys(n).map(t=>{let[e,r,o]=n[t],s={propName:e,templateName:t,isSignal:(r&XT.SignalBased)!==0};return o&&(s.transform=o),s})}function Bwe(n){return Object.keys(n).map(t=>({propName:n[t],templateName:t}))}function zwe(n,t,e){let r=t instanceof cc?t:t?.injector;return r&&n.getStandaloneInjector!==null&&(r=n.getStandaloneInjector(r)||r),r?new GR(e,r):e}function Vwe(n){let t=n.get(lv,null);if(t===null)throw new ur(407,!1);let e=n.get(_we,null),r=n.get(cv,null);return{rendererFactory:t,sanitizer:e,changeDetectionScheduler:r}}function jwe(n,t){let e=(n.selectors[0][0]||"div").toLowerCase();return eV(t,e,e==="svg"?ebe:e==="math"?tbe:null)}var pv=class extends kV{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=Lwe(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=Bwe(this.componentDef.outputs),this.cachedOutputs}constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=Sve(t.selectors),this.ngContentSelectors=t.ngContentSelectors??[],this.isBoundToModule=!!e}create(t,e,r,o){ts(22);let s=Fo(null);try{let i=this.componentDef,a=r?["ng-version","19.2.14"]:Cve(this.componentDef.selectors[0]),u=rV(0,null,null,1,0,null,null,null,null,[a],null),c=zwe(i,o||this.ngModule,t),h=Vwe(c),f=h.rendererFactory.createRenderer(null,i),g=r?Rve(f,r,i.encapsulation,c):jwe(i,f),d=oV(null,u,null,512|sV(i),null,null,h,f,c,null,Xz(g,c,!0));d[Yg]=g,r4(d);let p=null;try{let m=OV(Yg,u,d,"#host",()=>[this.componentDef],!0,0);g&&(nV(f,g,m),HT(g,d)),pV(u,d,m),Qz(u,m,d),RV(u,m),e!==void 0&&Uwe(m,this.ngContentSelectors,e),p=Qg(m.index,d),d[_l]=p[_l],dV(u,d,null)}catch(m){throw p!==null&&PR(p),PR(d),m}finally{ts(23),o4()}return new WR(this.componentType,d)}finally{Fo(s)}}},WR=class extends Iwe{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(t,e){super(),this._rootLView=e,this._tNode=rbe(e[yo],Yg),this.location=p4(this._tNode,e),this.instance=Qg(this._tNode.index,e)[_l],this.hostView=this.changeDetectorRef=new OT(e,void 0,!1),this.componentType=t}setInput(t,e){let r=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),e))return;let o=this._rootLView,s=hV(r,o[yo],o,t,e);this.previousInputValues.set(t,e);let i=Qg(r.index,o);w4(i,1)}get injector(){return new zy(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}};function Uwe(n,t,e){let r=n.projection=[];for(let o=0;o<t.length;o++){let s=e[o];r.push(s!=null&&s.length?Array.from(s):null)}}var ZT=(()=>{class n{static __NG_ELEMENT_ID__=qwe}return n})();function qwe(){let n=Lf();return Wwe(n,lc())}var Gwe=ZT,MV=class extends Gwe{_lContainer;_hostTNode;_hostLView;constructor(t,e,r){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=r}get element(){return p4(this._hostTNode,this._hostLView)}get injector(){return new zy(this._hostTNode,this._hostLView)}get parentInjector(){let t=i4(this._hostTNode,this._hostLView);if(Sz(t)){let e=ET(t,this._hostLView),r=TT(t),o=e[yo].data[r+8];return new zy(o,e)}else return new zy(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){let e=wB(this._lContainer);return e!==null&&e[t]||null}get length(){return this._lContainer.length-Il}createEmbeddedView(t,e,r){let o,s;typeof r=="number"?o=r:r!=null&&(o=r.index,s=r.injector);let i=gB(this._lContainer,t.ssrId),a=t.createEmbeddedViewImpl(e||{},s,i);return this.insertImpl(a,o,fB(this._hostTNode,i)),a}createComponent(t,e,r,o,s){let i=t&&!Yxe(t),a;if(i)a=e;else{let p=e||{};a=p.index,r=p.injector,o=p.projectableNodes,s=p.environmentInjector||p.ngModuleRef}let u=i?t:new pv(Vy(t)),c=r||this.parentInjector;if(!s&&u.ngModule==null){let m=(i?c:this.parentInjector).get(cc,null);m&&(s=m)}let h=Vy(u.componentType??{}),f=gB(this._lContainer,h?.id??null),g=f?.firstChild??null,d=u.create(c,o,g,s);return this.insertImpl(d.hostView,a,fB(this._hostTNode,f)),d}insert(t,e){return this.insertImpl(t,e,!0)}insertImpl(t,e,r){let o=t._lView;if(obe(o)){let a=this.indexOf(t);if(a!==-1)this.detach(a);else{let u=o[Lu],c=new MV(u,u[Ip],u[Lu]);c.detach(c.indexOf(t))}}let s=this._adjustIndex(e),i=this._lContainer;return xwe(i,o,s,r),t.attachToViewContainerRef(),VB(xR(i),s,t),t}move(t,e){return this.insert(t,e)}indexOf(t){let e=wB(this._lContainer);return e!==null?e.indexOf(t):-1}remove(t){let e=this._adjustIndex(t,-1),r=UR(this._lContainer,e);r&&(xT(xR(this._lContainer),e),gV(r[yo],r))}detach(t){let e=this._adjustIndex(t,-1),r=UR(this._lContainer,e);return r&&xT(xR(this._lContainer),e)!=null?new OT(r):null}_adjustIndex(t,e=0){return t??this.length+e}};function wB(n){return n[CT]}function xR(n){return n[CT]||(n[CT]=[])}function Wwe(n,t){let e,r=t[n.index];return $f(r)?e=r:(e=ywe(r,t,null,n),t[n.index]=e,aV(t,e)),Kwe(e,t,n,r),new MV(e,n,t)}function Hwe(n,t){let e=n[Tl],r=e.createComment(""),o=Zg(t,n),s=e.parentNode(o);return DT(e,s,r,e.nextSibling(o),!1),r}var Kwe=Xwe;function Xwe(n,t,e,r){if(n[jy])return;let o;e.type&8?o=Sh(r):o=Hwe(t,e),n[jy]=o}var GS=class{},C4=class{};var HR=class extends GS{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new RT(this);constructor(t,e,r,o=!0){super(),this.ngModuleType=t,this._parent=e;let s=qB(t);this._bootstrapComponents=Zz(s.bootstrap),this._r3Injector=Oz(t,e,[{provide:GS,useValue:this},{provide:QT,useValue:this.componentFactoryResolver},...r],qc(t),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}},KR=class extends C4{moduleType;constructor(t){super(),this.moduleType=t}create(t){return new HR(this.moduleType,t,[])}};var MT=class extends GS{injector;componentFactoryResolver=new RT(this);instance=null;constructor(t){super();let e=new VS([...t.providers,{provide:GS,useValue:this},{provide:QT,useValue:this.componentFactoryResolver}],t.parent||t4(),t.debugName,new Set(["environment"]));this.injector=e,t.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}};function ZS(n,t,e=null){return new MT({providers:n,parent:t,debugName:e,runEnvironmentInitializers:!0}).injector}var Ywe=(()=>{class n{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let r=GB(!1,e.type),o=r.length>0?ZS([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,o)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=rr({token:n,providedIn:"environment",factory:()=>new n(Sr(cc))})}return n})();function JT(n){return PT(()=>{let t=FV(n),e=Tn(Tt({},t),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===zz.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&n.dependencies||null,getStandaloneInjector:t.standalone?o=>o.get(Ywe).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Ih.Emulated,styles:n.styles||bh,_:null,schemas:n.schemas||null,tView:null,id:""});t.standalone&&gv("NgStandalone"),PV(e);let r=n.dependencies;return e.directiveDefs=SB(r,!1),e.pipeDefs=SB(r,!0),e.id=t2e(e),e})}function Qwe(n){return Vy(n)||$xe(n)}function Zwe(n){return n!==null}function JS(n){return PT(()=>({type:n.type,bootstrap:n.bootstrap||bh,declarations:n.declarations||bh,imports:n.imports||bh,exports:n.exports||bh,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Jwe(n,t){if(n==null)return av;let e={};for(let r in n)if(n.hasOwnProperty(r)){let o=n[r],s,i,a,u;Array.isArray(o)?(a=o[0],s=o[1],i=o[2]??s,u=o[3]||null):(s=o,i=o,a=XT.None,u=null),e[s]=[r,a,u],t[s]=i}return e}function e2e(n){if(n==null)return av;let t={};for(let e in n)n.hasOwnProperty(e)&&(t[n[e]]=e);return t}function eE(n){return PT(()=>{let t=FV(n);return PV(t),t})}function FV(n){let t={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputConfig:n.inputs||av,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:n.signals===!0,selectors:n.selectors||bh,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Jwe(n.inputs,t),outputs:e2e(n.outputs),debugInfo:null}}function PV(n){n.features?.forEach(t=>t(n))}function SB(n,t){if(!n)return null;let e=t?Lxe:Qwe;return()=>(typeof n=="function"?n():n).map(r=>e(r)).filter(Zwe)}function t2e(n){let t=0,e=typeof n.consts=="function"?"":n.consts,r=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,e,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(let s of r.join("|"))t=Math.imul(31,t)+s.charCodeAt(0)<<0;return t+=2147483648,"c"+t}function n2e(n,t,e){let r=n[t];return Object.is(r,e)?!1:(n[t]=e,!0)}var $V=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();var LV=new lr("");var r2e=(()=>{class n{static \u0275prov=rr({token:n,providedIn:"root",factory:()=>new XR})}return n})(),XR=class{queuedEffectCount=0;queues=new Map;schedule(t){this.enqueue(t)}remove(t){let e=t.zone,r=this.queues.get(e);r.has(t)&&(r.delete(t),this.queuedEffectCount--)}enqueue(t){let e=t.zone;this.queues.has(e)||this.queues.set(e,new Set);let r=this.queues.get(e);r.has(t)||(this.queuedEffectCount++,r.add(t))}flush(){for(;this.queuedEffectCount>0;)for(let[t,e]of this.queues)t===null?this.flushQueue(e):t.run(()=>this.flushQueue(e))}flushQueue(t){for(let e of t)t.delete(e),this.queuedEffectCount--,e.run()}};function tE(n){return!!n&&typeof n.then=="function"}function o2e(n){return!!n&&typeof n.subscribe=="function"}var BV=new lr("");function I4(n){return BT([{provide:BV,multi:!0,useValue:n}])}var zV=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,r)=>{this.resolve=e,this.reject=r});appInits=xn(BV,{optional:!0})??[];injector=xn(Cp);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let o of this.appInits){let s=El(this.injector,o);if(tE(s))e.push(s);else if(o2e(s)){let i=new Promise((a,u)=>{s.subscribe({complete:a,error:u})});e.push(i)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),e.length===0&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),nE=new lr("");function s2e(){KO(()=>{throw new ur(600,!1)})}function i2e(n){return n.isBoundToModule}var a2e=10;var Gy=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=xn(Kbe);afterRenderManager=xn(Kz);zonelessEnabled=xn(u4);rootEffectScheduler=xn(r2e);dirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new za;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=xn(dv).hasPendingTasks.pipe(go(e=>!e));constructor(){xn(mv,{optional:!0})}whenStable(){let e;return new Promise(r=>{e=this.isStable.subscribe({next:o=>{o&&r()}})}).finally(()=>{e.unsubscribe()})}_injector=xn(cc);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,r){return this.bootstrapImpl(e,r)}bootstrapImpl(e,r,o=Cp.NULL){ts(10);let s=e instanceof kV;if(!this._injector.get(zV).done){let d="";throw new ur(405,d)}let a;s?a=e:a=this._injector.get(QT).resolveComponentFactory(e),this.componentTypes.push(a.componentType);let u=i2e(a)?void 0:this._injector.get(GS),c=r||a.selector,h=a.create(o,[],c,u),f=h.location.nativeElement,g=h.injector.get(LV,null);return g?.registerApplication(f),h.onDestroy(()=>{this.detachView(h.hostView),dT(this.components,h),g?.unregisterApplication(f)}),this._loadComponent(h),ts(11,h),h}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){ts(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(m4.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new ur(101,!1);let e=Fo(null);try{this._runningTick=!0,this.synchronize()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,Fo(e),this.afterTick.next(),ts(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(lv,null,{optional:!0}));let e=0;for(;this.dirtyFlags!==0&&e++<a2e;)ts(14),this.synchronizeOnce(),ts(15)}synchronizeOnce(){if(this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let e=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r,notifyErrorHandler:o}of this.allViews)u2e(r,o,e,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>qT(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){let r=e;dT(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(nE,[]).forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>dT(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new ur(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function dT(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}function u2e(n,t,e,r){if(!e&&!qT(n))return;CV(n,t,e&&!r?0:1)}function c2e(n,t,e,r){return n2e(n,gbe(),e)?t+$B(e)+r:KT}function CB(n,t,e,r,o){hV(t,n,e,o?"class":"style",r)}function rE(n,t,e,r){let o=lc(),s=YS(),i=Yg+n,a=o[Tl],u=s.firstCreatePass?OV(i,s,o,t,Bve,cbe(),e,r):s.data[i],c=l2e(s,o,u,a,t,n);o[i]=c;let h=ZB(u);return GT(u,!0),nV(a,c,u),!fV(u)&&xz()&&yV(s,o,c,u),(ibe()===0||h)&&HT(c,o),abe(),h&&(pV(s,o,u),Qz(s,u,o)),r!==null&&Ove(o,u),rE}function oE(){let n=Lf();cz()?fbe():(n=n.parent,GT(n,!1));let t=n;pbe(t)&&hbe(),ube();let e=YS();return e.firstCreatePass&&RV(e,t),t.classesWithoutHost!=null&&_be(t)&&CB(e,t,lc(),t.classesWithoutHost,!0),t.stylesWithoutHost!=null&&Tbe(t)&&CB(e,t,lc(),t.stylesWithoutHost,!1),oE}function eC(n,t,e,r){return rE(n,t,e,r),oE(),eC}var l2e=(n,t,e,r,o,s)=>(bz(!0),eV(r,o,wbe()));var FT="en-US";var p2e=FT;function h2e(n){typeof n=="string"&&(p2e=n.toLowerCase().replace(/_/g,"-"))}function IB(n,t,e){return function r(o){if(o===Function)return e;let s=KS(n)?Qg(n.index,t):t;w4(s,5);let i=t[_l],a=_B(t,i,e,o),u=r.__ngNextListenerFn__;for(;u;)a=_B(t,i,u,o)&&a,u=u.__ngNextListenerFn__;return a}}function _B(n,t,e,r){let o=Fo(null);try{return ts(6,t,e),e(r)!==!1}catch(s){return d2e(n,s),!1}finally{ts(7,t,e),Fo(o)}}function d2e(n,t){let e=n[uv],r=e?e.get(Ch,null):null;r&&r.handleError(t)}function TB(n,t,e,r,o,s){let i=t[e],a=t[yo],c=a.data[e].outputs[r],h=i[c],f=a.firstCreatePass?az(a):null,g=iz(t),d=h.subscribe(s),p=g.length;g.push(s,d),f&&f.push(o,n.index,p,-(p+1))}function sE(n,t,e,r){let o=lc(),s=YS(),i=Lf();return m2e(s,o,o[Tl],i,n,t,r),sE}function f2e(n,t,e,r){let o=n.cleanup;if(o!=null)for(let s=0;s<o.length-1;s+=2){let i=o[s];if(i===e&&o[s+1]===r){let a=t[wT],u=o[s+2];return a.length>u?a[u]:null}typeof i=="string"&&(s+=2)}return null}function m2e(n,t,e,r,o,s,i){let a=ZB(r),c=n.firstCreatePass?az(n):null,h=iz(t),f=!0;if(r.type&3||i){let g=Zg(r,t),d=i?i(g):g,p=h.length,m=i?v=>i(Sh(v[r.index])):r.index,y=null;if(!i&&a&&(y=f2e(n,t,o,r.index)),y!==null){let v=y.__ngLastListenerFn__||y;v.__ngNextListenerFn__=s,y.__ngLastListenerFn__=s,f=!1}else{s=IB(r,t,s),pve(t,d,o,s);let v=e.listen(d,o,s);h.push(s,v),c&&c.push(o,m,p,p+1)}}else s=IB(r,t,s);if(f){let g=r.outputs?.[o],d=r.hostDirectiveOutputs?.[o];if(d&&d.length)for(let p=0;p<d.length;p+=2){let m=d[p],y=d[p+1];TB(r,t,m,y,o,s)}if(g&&g.length)for(let p of g)TB(r,t,p,o,o,s)}}function VV(n,t=""){let e=lc(),r=YS(),o=n+Yg,s=r.firstCreatePass?NV(r,o,1,t,null):r.data[o],i=g2e(r,e,s,t,n);e[o]=i,xz()&&yV(r,e,i,s),GT(s,!1)}var g2e=(n,t,e,r,o)=>(bz(!0),Ive(t[Tl],r));function _4(n){return jV("",n,""),_4}function jV(n,t,e){let r=lc(),o=c2e(r,n,t,e);return o!==KT&&y2e(r,s4(),o),jV}function y2e(n,t,e){let r=nbe(t,n);_ve(n[Tl],r,e)}var YR=class{ngModuleFactory;componentFactories;constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}},UV=(()=>{class n{compileModuleSync(e){return new KR(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let r=this.compileModuleSync(e),o=qB(e),s=Zz(o.declarations).reduce((i,a)=>{let u=Vy(a);return u&&i.push(new pv(u)),i},[]);return new YR(r,s)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var x2e=(()=>{class n{zone=xn(Ii);changeDetectionScheduler=xn(cv);applicationRef=xn(Gy);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),b2e=new lr("",{factory:()=>!1});function qV({ngZoneFactory:n,ignoreChangesOutsideZone:t,scheduleInRootZone:e}){return n??=()=>new Ii(Tn(Tt({},WV()),{scheduleInRootZone:e})),[{provide:Ii,useFactory:n},{provide:zS,multi:!0,useFactory:()=>{let r=xn(x2e,{optional:!0});return()=>r.initialize()}},{provide:zS,multi:!0,useFactory:()=>{let r=xn(v2e);return()=>{r.initialize()}}},t===!0?{provide:Mz,useValue:!0}:[],{provide:Fz,useValue:e??Rz}]}function GV(n){let t=n?.ignoreChangesOutsideZone,e=n?.scheduleInRootZone,r=qV({ngZoneFactory:()=>{let o=WV(n);return o.scheduleInRootZone=e,o.shouldCoalesceEventChangeDetection&&gv("NgZone_CoalesceEvent"),new Ii(o)},ignoreChangesOutsideZone:t,scheduleInRootZone:e});return BT([{provide:b2e,useValue:!0},{provide:u4,useValue:!1},r])}function WV(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var v2e=(()=>{class n{subscription=new Mi;initialized=!1;zone=xn(Ii);pendingTasks=xn(dv);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Ii.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Ii.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var w2e=(()=>{class n{appRef=xn(Gy);taskService=xn(dv);ngZone=xn(Ii);zonelessEnabled=xn(u4);tracing=xn(mv,{optional:!0});disableScheduling=xn(Mz,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Mi;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(kT):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(xn(Fz,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof FR||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let r=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,r=!0;break}case 12:{this.appRef.dirtyFlags|=16,r=!0;break}case 13:{this.appRef.dirtyFlags|=2,r=!0;break}case 11:{r=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(r))return;let o=this.useMicrotaskScheduler?iB:Pz;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>o(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>o(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(kT+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){throw this.taskService.remove(e),r}finally{this.cleanup()}this.useMicrotaskScheduler=!0,iB(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function S2e(){return typeof $localize<"u"&&$localize.locale||FT}var HV=new lr("",{providedIn:"root",factory:()=>xn(HV,zr.Optional|zr.SkipSelf)||S2e()});var QR=new lr(""),C2e=new lr("");function PS(n){return!n.moduleRef}function I2e(n){let t=PS(n)?n.r3Injector:n.moduleRef.injector,e=t.get(Ii);return e.run(()=>{PS(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let r=t.get(Ch,null),o;if(e.runOutsideAngular(()=>{o=e.onError.subscribe({next:s=>{r.handleError(s)}})}),PS(n)){let s=()=>t.destroy(),i=n.platformInjector.get(QR);i.add(s),t.onDestroy(()=>{o.unsubscribe(),i.delete(s)})}else{let s=()=>n.moduleRef.destroy(),i=n.platformInjector.get(QR);i.add(s),n.moduleRef.onDestroy(()=>{dT(n.allPlatformModules,n.moduleRef),o.unsubscribe(),i.delete(s)})}return T2e(r,e,()=>{let s=t.get(zV);return s.runInitializers(),s.donePromise.then(()=>{let i=t.get(HV,FT);if(h2e(i||FT),!t.get(C2e,!0))return PS(n)?t.get(Gy):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(PS(n)){let u=t.get(Gy);return n.rootComponent!==void 0&&u.bootstrap(n.rootComponent),u}else return _2e(n.moduleRef,n.allPlatformModules),n.moduleRef})})})}function _2e(n,t){let e=n.injector.get(Gy);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(r=>e.bootstrap(r));else if(n.instance.ngDoBootstrap)n.instance.ngDoBootstrap(e);else throw new ur(-403,!1);t.push(n)}function T2e(n,t,e){try{let r=e();return tE(r)?r.catch(o=>{throw t.runOutsideAngular(()=>n.handleError(o)),o}):r}catch(r){throw t.runOutsideAngular(()=>n.handleError(r)),r}}var fT=null;function E2e(n=[],t){return Cp.create({name:t,providers:[{provide:zT,useValue:"platform"},{provide:QR,useValue:new Set([()=>fT=null])},...n]})}function N2e(n=[]){if(fT)return fT;let t=E2e(n);return fT=t,s2e(),k2e(t),t}function k2e(n){let t=n.get(d4,null);El(n,()=>{t?.forEach(e=>e())})}var tC=(()=>{class n{static __NG_ELEMENT_ID__=D2e}return n})();function D2e(n){return A2e(Lf(),lc(),(n&16)===16)}function A2e(n,t,e){if(KS(n)&&!e){let r=Qg(n.index,t);return new OT(r,r)}else if(n.type&175){let r=t[wh];return new OT(r,t)}return null}function KV(n){ts(8);try{let{rootComponent:t,appProviders:e,platformProviders:r}=n,o=N2e(r),s=[qV({}),{provide:cv,useExisting:w2e},...e||[]],i=new MT({providers:s,parent:o,debugName:"",runEnvironmentInitializers:!1});return I2e({r3Injector:i.injector,platformInjector:o,rootComponent:t})}catch(t){return Promise.reject(t)}finally{ts(9)}}var EB=class{[jb];constructor(t){this[jb]=t}destroy(){this[jb].destroy()}};function XV(n){let t=Vy(n);if(!t)return null;let e=new pv(t);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}var ba=new lr("");var ZV=null;function Bf(){return ZV}function T4(n){ZV??=n}var nC=class{},rC=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:()=>xn(JV),providedIn:"platform"})}return n})(),E4=new lr(""),JV=(()=>{class n extends rC{_location;_history;_doc=xn(ba);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Bf().getBaseHref(this._doc)}onPopState(e){let r=Bf().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){let r=Bf().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){this._history.pushState(e,r,o)}replaceState(e,r,o){this._history.replaceState(e,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function iE(n,t){return n?t?n.endsWith("/")?t.startsWith("/")?n+t.slice(1):n+t:t.startsWith("/")?n+t:`${n}/${t}`:n:t}function YV(n){let t=n.search(/#|\?|$/);return n[t-1]==="/"?n.slice(0,t-1)+n.slice(t):n}function _p(n){return n&&n[0]!=="?"?`?${n}`:n}var zf=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:()=>xn(uE),providedIn:"root"})}return n})(),aE=new lr(""),uE=(()=>{class n extends zf{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,r){super(),this._platformLocation=e,this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??xn(ba).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return iE(this._baseHref,e)}path(e=!1){let r=this._platformLocation.pathname+_p(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,s){let i=this.prepareExternalUrl(o+_p(s));this._platformLocation.pushState(e,r,i)}replaceState(e,r,o,s){let i=this.prepareExternalUrl(o+_p(s));this._platformLocation.replaceState(e,r,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(r){return new(r||n)(Sr(rC),Sr(aE,8))};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),e0=(()=>{class n{_subject=new za;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let r=this._locationStrategy.getBaseHref();this._basePath=M2e(YV(QV(r))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+_p(r))}normalize(e){return n.stripTrailingSlash(R2e(this._basePath,QV(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+_p(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+_p(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r??void 0,complete:o??void 0})}static normalizeQueryParams=_p;static joinWithSlash=iE;static stripTrailingSlash=YV;static \u0275fac=function(r){return new(r||n)(Sr(zf))};static \u0275prov=rr({token:n,factory:()=>O2e(),providedIn:"root"})}return n})();function O2e(){return new e0(Sr(zf))}function R2e(n,t){if(!n||!t.startsWith(n))return t;let e=t.substring(n.length);return e===""||["/",";","?","#"].includes(e[0])?e:t}function QV(n){return n.replace(/\/index.html$/,"")}function M2e(n){if(new RegExp("^(https?:)?//").test(n)){let[,e]=n.split(/\/\/[^\/]+/);return e}return n}var N4=(()=>{class n extends zf{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(e,r){super(),this._platformLocation=e,r!=null&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let r=this._platformLocation.hash??"#";return r.length>0?r.substring(1):r}prepareExternalUrl(e){let r=iE(this._baseHref,e);return r.length>0?"#"+r:r}pushState(e,r,o,s){let i=this.prepareExternalUrl(o+_p(s))||this._platformLocation.pathname;this._platformLocation.pushState(e,r,i)}replaceState(e,r,o,s){let i=this.prepareExternalUrl(o+_p(s))||this._platformLocation.pathname;this._platformLocation.replaceState(e,r,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(r){return new(r||n)(Sr(rC),Sr(aE,8))};static \u0275prov=rr({token:n,factory:n.\u0275fac})}return n})();function k4(n,t){t=encodeURIComponent(t);for(let e of n.split(";")){let r=e.indexOf("="),[o,s]=r==-1?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===t)return decodeURIComponent(s)}return null}var D4="browser",tj="server";function cE(n){return n===tj}var oC=class{};var nj=(()=>{class n{static \u0275prov=rr({token:n,providedIn:"root",factory:()=>new A4(xn(ba),window)})}return n})(),A4=class{document;window;offset=()=>[0,0];constructor(t,e){this.document=t,this.window=e}setOffset(t){Array.isArray(t)?this.offset=()=>t:this.offset=t}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(t){this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){let e=B2e(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){this.window.history.scrollRestoration=t}scrollToElement(t){let e=t.getBoundingClientRect(),r=e.left+this.window.pageXOffset,o=e.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(r-s[0],o-s[1])}};function B2e(n,t){let e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if(typeof n.createTreeWalker=="function"&&n.body&&typeof n.body.attachShadow=="function"){let r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT),o=r.currentNode;for(;o;){let s=o.shadowRoot;if(s){let i=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(i)return i}o=r.nextNode()}}return null}var hE=new lr(""),F4=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,r){this._zone=r,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o,s){return this._findPluginFor(r).addEventListener(e,r,o,s)}getZone(){return this._zone}_findPluginFor(e){let r=this._eventNameToPlugin.get(e);if(r)return r;if(r=this._plugins.find(s=>s.supports(e)),!r)throw new ur(5101,!1);return this._eventNameToPlugin.set(e,r),r}static \u0275fac=function(r){return new(r||n)(Sr(hE),Sr(Ii))};static \u0275prov=rr({token:n,factory:n.\u0275fac})}return n})(),sC=class{_doc;constructor(t){this._doc=t}manager},lE="ng-app-id";function rj(n){for(let t of n)t.remove()}function oj(n,t){let e=t.createElement("style");return e.textContent=n,e}function z2e(n,t,e,r){let o=n.head?.querySelectorAll(`style[${lE}="${t}"],link[${lE}="${t}"]`);if(o)for(let s of o)s.removeAttribute(lE),s instanceof HTMLLinkElement?r.set(s.href.slice(s.href.lastIndexOf("/")+1),{usage:0,elements:[s]}):s.textContent&&e.set(s.textContent,{usage:0,elements:[s]})}function R4(n,t){let e=t.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",n),e}var P4=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(e,r,o,s={}){this.doc=e,this.appId=r,this.nonce=o,this.isServer=cE(s),z2e(e,r,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,r){for(let o of e)this.addUsage(o,this.inline,oj);r?.forEach(o=>this.addUsage(o,this.external,R4))}removeStyles(e,r){for(let o of e)this.removeUsage(o,this.inline);r?.forEach(o=>this.removeUsage(o,this.external))}addUsage(e,r,o){let s=r.get(e);s?s.usage++:r.set(e,{usage:1,elements:[...this.hosts].map(i=>this.addElement(i,o(e,this.doc)))})}removeUsage(e,r){let o=r.get(e);o&&(o.usage--,o.usage<=0&&(rj(o.elements),r.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])rj(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[r,{elements:o}]of this.inline)o.push(this.addElement(e,oj(r,this.doc)));for(let[r,{elements:o}]of this.external)o.push(this.addElement(e,R4(r,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(lE,this.appId),e.appendChild(r)}static \u0275fac=function(r){return new(r||n)(Sr(ba),Sr(h4),Sr(f4,8),Sr(fv))};static \u0275prov=rr({token:n,factory:n.\u0275fac})}return n})(),O4={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},$4=/%COMP%/g;var ij="%COMP%",V2e=`_nghost-${ij}`,j2e=`_ngcontent-${ij}`,U2e=!0,q2e=new lr("",{providedIn:"root",factory:()=>U2e});function G2e(n){return j2e.replace($4,n)}function W2e(n){return V2e.replace($4,n)}function aj(n,t){return t.map(e=>e.replace($4,n))}var L4=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,r,o,s,i,a,u,c=null,h=null){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=s,this.doc=i,this.platformId=a,this.ngZone=u,this.nonce=c,this.tracingService=h,this.platformIsServer=cE(a),this.defaultRenderer=new iC(e,i,u,this.platformIsServer,this.tracingService)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Ih.ShadowDom&&(r=Tn(Tt({},r),{encapsulation:Ih.Emulated}));let o=this.getOrCreateRenderer(e,r);return o instanceof pE?o.applyToHost(e):o instanceof aC&&o.applyStyles(),o}getOrCreateRenderer(e,r){let o=this.rendererByCompId,s=o.get(r.id);if(!s){let i=this.doc,a=this.ngZone,u=this.eventManager,c=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,f=this.platformIsServer,g=this.tracingService;switch(r.encapsulation){case Ih.Emulated:s=new pE(u,c,r,this.appId,h,i,a,f,g);break;case Ih.ShadowDom:return new M4(u,c,e,r,i,a,this.nonce,f,g);default:s=new aC(u,c,r,h,i,a,f,g);break}o.set(r.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(r){return new(r||n)(Sr(F4),Sr(P4),Sr(h4),Sr(q2e),Sr(ba),Sr(fv),Sr(Ii),Sr(f4),Sr(mv,8))};static \u0275prov=rr({token:n,factory:n.\u0275fac})}return n})(),iC=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(t,e,r,o,s){this.eventManager=t,this.doc=e,this.ngZone=r,this.platformIsServer=o,this.tracingService=s}destroy(){}destroyNode=null;createElement(t,e){return e?this.doc.createElementNS(O4[e]||e,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,e){(sj(t)?t.content:t).appendChild(e)}insertBefore(t,e,r){t&&(sj(t)?t.content:t).insertBefore(e,r)}removeChild(t,e){e.remove()}selectRootElement(t,e){let r=typeof t=="string"?this.doc.querySelector(t):t;if(!r)throw new ur(-5104,!1);return e||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,r,o){if(o){e=o+":"+e;let s=O4[o];s?t.setAttributeNS(s,e,r):t.setAttribute(e,r)}else t.setAttribute(e,r)}removeAttribute(t,e,r){if(r){let o=O4[r];o?t.removeAttributeNS(o,e):t.removeAttribute(`${r}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,r,o){o&(yv.DashCase|yv.Important)?t.style.setProperty(e,r,o&yv.Important?"important":""):t.style[e]=r}removeStyle(t,e,r){r&yv.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,r){t!=null&&(t[e]=r)}setValue(t,e){t.nodeValue=e}listen(t,e,r,o){if(typeof t=="string"&&(t=Bf().getGlobalEventTarget(this.doc,t),!t))throw new ur(5102,!1);let s=this.decoratePreventDefault(r);return this.tracingService?.wrapEventListener&&(s=this.tracingService.wrapEventListener(t,e,s)),this.eventManager.addEventListener(t,e,s,o)}decoratePreventDefault(t){return e=>{if(e==="__ngUnwrap__")return t;(this.platformIsServer?this.ngZone.runGuarded(()=>t(e)):t(e))===!1&&e.preventDefault()}}};function sj(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var M4=class extends iC{sharedStylesHost;hostEl;shadowRoot;constructor(t,e,r,o,s,i,a,u,c){super(t,s,i,u,c),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let h=o.styles;h=aj(o.id,h);for(let g of h){let d=document.createElement("style");a&&d.setAttribute("nonce",a),d.textContent=g,this.shadowRoot.appendChild(d)}let f=o.getExternalStyles?.();if(f)for(let g of f){let d=R4(g,s);a&&d.setAttribute("nonce",a),this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,r){return super.insertBefore(this.nodeOrShadowRoot(t),e,r)}removeChild(t,e){return super.removeChild(null,e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},aC=class extends iC{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(t,e,r,o,s,i,a,u,c){super(t,s,i,a,u),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=o;let h=r.styles;this.styles=c?aj(c,h):h,this.styleUrls=r.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},pE=class extends aC{contentAttr;hostAttr;constructor(t,e,r,o,s,i,a,u,c){let h=o+"-"+r.id;super(t,e,r,s,i,a,u,c,h),this.contentAttr=G2e(h),this.hostAttr=W2e(h)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,e){let r=super.createElement(t,e);return super.setAttribute(r,this.contentAttr,""),r}};var dE=class n extends nC{supportsDOMEvents=!0;static makeCurrent(){T4(new n)}onAndCancel(t,e,r,o){return t.addEventListener(e,r,o),()=>{t.removeEventListener(e,r,o)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.remove()}createElement(t,e){return e=e||this.getDefaultDocument(),e.createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return e==="window"?window:e==="document"?t:e==="body"?t.body:null}getBaseHref(t){let e=H2e();return e==null?null:K2e(e)}resetBaseElement(){uC=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return k4(document.cookie,t)}},uC=null;function H2e(){return uC=uC||document.head.querySelector("base"),uC?uC.getAttribute("href"):null}function K2e(n){return new URL(n,document.baseURI).pathname}var X2e=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac})}return n})(),cj=(()=>{class n extends sC{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o,s){return e.addEventListener(r,o,s),()=>this.removeEventListener(e,r,o,s)}removeEventListener(e,r,o,s){return e.removeEventListener(r,o,s)}static \u0275fac=function(r){return new(r||n)(Sr(ba))};static \u0275prov=rr({token:n,factory:n.\u0275fac})}return n})(),uj=["alt","control","meta","shift"],Y2e={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Q2e={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},lj=(()=>{class n extends sC{constructor(e){super(e)}supports(e){return n.parseEventName(e)!=null}addEventListener(e,r,o,s){let i=n.parseEventName(r),a=n.eventCallback(i.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Bf().onAndCancel(e,i.domEventName,a,s))}static parseEventName(e){let r=e.toLowerCase().split("."),o=r.shift();if(r.length===0||!(o==="keydown"||o==="keyup"))return null;let s=n._normalizeKey(r.pop()),i="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),i="code."),uj.forEach(c=>{let h=r.indexOf(c);h>-1&&(r.splice(h,1),i+=c+".")}),i+=s,r.length!=0||s.length===0)return null;let u={};return u.domEventName=o,u.fullKey=i,u}static matchEventFullKeyCode(e,r){let o=Y2e[e.key]||e.key,s="";return r.indexOf("code.")>-1&&(o=e.code,s="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),uj.forEach(i=>{if(i!==o){let a=Q2e[i];a(e)&&(s+=i+".")}}),s+=o,s===r)}static eventCallback(e,r,o){return s=>{n.matchEventFullKeyCode(s,e)&&o.runGuarded(()=>r(s))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(r){return new(r||n)(Sr(ba))};static \u0275prov=rr({token:n,factory:n.\u0275fac})}return n})();function B4(n,t){return KV(Tt({rootComponent:n},Z2e(t)))}function Z2e(n){return{appProviders:[...rSe,...n?.providers??[]],platformProviders:nSe}}function J2e(){dE.makeCurrent()}function eSe(){return new Ch}function tSe(){return Gz(document),document}var nSe=[{provide:fv,useValue:D4},{provide:d4,useValue:J2e,multi:!0},{provide:ba,useFactory:tSe}];var rSe=[{provide:zT,useValue:"root"},{provide:Ch,useFactory:eSe},{provide:hE,useClass:cj,multi:!0,deps:[ba]},{provide:hE,useClass:lj,multi:!0,deps:[ba]},L4,P4,F4,{provide:lv,useExisting:L4},{provide:oC,useClass:X2e},[]];var pj=(()=>{class n{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(r){return new(r||n)(Sr(ba))};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Pr="primary",wC=Symbol("RouteTitle"),q4=class{params;constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function Xy(n){return new q4(n)}function bj(n,t,e){let r=e.path.split("/");if(r.length>n.length||e.pathMatch==="full"&&(t.hasChildren()||r.length<n.length))return null;let o={};for(let s=0;s<r.length;s++){let i=r[s],a=n[s];if(i[0]===":")o[i.substring(1)]=a;else if(i!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:o}}function sSe(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!_h(n[e],t[e]))return!1;return!0}function _h(n,t){let e=n?G4(n):void 0,r=t?G4(t):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let s=0;s<e.length;s++)if(o=e[s],!vj(n[o],t[o]))return!1;return!0}function G4(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function vj(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;let e=[...n].sort(),r=[...t].sort();return e.every((o,s)=>r[s]===o)}else return n===t}function wj(n){return n.length>0?n[n.length-1]:null}function o0(n){return aR(n)?n:tE(n)?ai(Promise.resolve(n)):br(n)}var iSe={exact:Cj,subset:Ij},Sj={exact:aSe,subset:uSe,ignored:()=>!0};function hj(n,t,e){return iSe[e.paths](n.root,t.root,e.matrixParams)&&Sj[e.queryParams](n.queryParams,t.queryParams)&&!(e.fragment==="exact"&&n.fragment!==t.fragment)}function aSe(n,t){return _h(n,t)}function Cj(n,t,e){if(!Hy(n.segments,t.segments)||!gE(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(let r in t.children)if(!n.children[r]||!Cj(n.children[r],t.children[r],e))return!1;return!0}function uSe(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>vj(n[e],t[e]))}function Ij(n,t,e){return _j(n,t,t.segments,e)}function _j(n,t,e,r){if(n.segments.length>e.length){let o=n.segments.slice(0,e.length);return!(!Hy(o,e)||t.hasChildren()||!gE(o,e,r))}else if(n.segments.length===e.length){if(!Hy(n.segments,e)||!gE(n.segments,e,r))return!1;for(let o in t.children)if(!n.children[o]||!Ij(n.children[o],t.children[o],r))return!1;return!0}else{let o=e.slice(0,n.segments.length),s=e.slice(n.segments.length);return!Hy(n.segments,o)||!gE(n.segments,o,r)||!n.children[Pr]?!1:_j(n.children[Pr],t,s,r)}}function gE(n,t,e){return t.every((r,o)=>Sj[e](n[o].parameters,r.parameters))}var Eh=class{root;queryParams;fragment;_queryParamMap;constructor(t=new Po([],{}),e={},r=null){this.root=t,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Xy(this.queryParams),this._queryParamMap}toString(){return pSe.serialize(this)}},Po=class{segments;children;parent=null;constructor(t,e){this.segments=t,this.children=e,Object.values(e).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return yE(this)}},t0=class{path;parameters;_parameterMap;constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap??=Xy(this.parameters),this._parameterMap}toString(){return Ej(this)}};function cSe(n,t){return Hy(n,t)&&n.every((e,r)=>_h(e.parameters,t[r].parameters))}function Hy(n,t){return n.length!==t.length?!1:n.every((e,r)=>e.path===t[r].path)}function lSe(n,t){let e=[];return Object.entries(n.children).forEach(([r,o])=>{r===Pr&&(e=e.concat(t(o,r)))}),Object.entries(n.children).forEach(([r,o])=>{r!==Pr&&(e=e.concat(t(o,r)))}),e}var Yy=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:()=>new n0,providedIn:"root"})}return n})(),n0=class{parse(t){let e=new H4(t);return new Eh(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){let e=`/${cC(t.root,!0)}`,r=fSe(t.queryParams),o=typeof t.fragment=="string"?`#${hSe(t.fragment)}`:"";return`${e}${r}${o}`}},pSe=new n0;function yE(n){return n.segments.map(t=>Ej(t)).join("/")}function cC(n,t){if(!n.hasChildren())return yE(n);if(t){let e=n.children[Pr]?cC(n.children[Pr],!1):"",r=[];return Object.entries(n.children).forEach(([o,s])=>{o!==Pr&&r.push(`${o}:${cC(s,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}else{let e=lSe(n,(r,o)=>o===Pr?[cC(n.children[Pr],!1)]:[`${o}:${cC(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[Pr]!=null?`${yE(n)}/${e[0]}`:`${yE(n)}/(${e.join("//")})`}}function Tj(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function fE(n){return Tj(n).replace(/%3B/gi,";")}function hSe(n){return encodeURI(n)}function W4(n){return Tj(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function xE(n){return decodeURIComponent(n)}function dj(n){return xE(n.replace(/\+/g,"%20"))}function Ej(n){return`${W4(n.path)}${dSe(n.parameters)}`}function dSe(n){return Object.entries(n).map(([t,e])=>`;${W4(t)}=${W4(e)}`).join("")}function fSe(n){let t=Object.entries(n).map(([e,r])=>Array.isArray(r)?r.map(o=>`${fE(e)}=${fE(o)}`).join("&"):`${fE(e)}=${fE(r)}`).filter(e=>e);return t.length?`?${t.join("&")}`:""}var mSe=/^[^\/()?;#]+/;function z4(n){let t=n.match(mSe);return t?t[0]:""}var gSe=/^[^\/()?;=#]+/;function ySe(n){let t=n.match(gSe);return t?t[0]:""}var xSe=/^[^=?&#]+/;function bSe(n){let t=n.match(xSe);return t?t[0]:""}var vSe=/^[^&#]+/;function wSe(n){let t=n.match(vSe);return t?t[0]:""}var H4=class{url;remaining;constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Po([],{}):new Po([],this.parseChildren())}parseQueryParams(){let t={};if(this.consumeOptional("?"))do this.parseQueryParam(t);while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(r[Pr]=new Po(t,e)),r}parseSegment(){let t=z4(this.remaining);if(t===""&&this.peekStartsWith(";"))throw new ur(4009,!1);return this.capture(t),new t0(xE(t),this.parseMatrixParams())}parseMatrixParams(){let t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){let e=ySe(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let o=z4(this.remaining);o&&(r=o,this.capture(r))}t[xE(e)]=xE(r)}parseQueryParam(t){let e=bSe(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let i=wSe(this.remaining);i&&(r=i,this.capture(r))}let o=dj(e),s=dj(r);if(t.hasOwnProperty(o)){let i=t[o];Array.isArray(i)||(i=[i],t[o]=i),i.push(s)}else t[o]=s}parseParens(t){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=z4(this.remaining),o=this.remaining[r.length];if(o!=="/"&&o!==")"&&o!==";")throw new ur(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=Pr);let i=this.parseChildren();e[s]=Object.keys(i).length===1?i[Pr]:new Po([],i),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return this.peekStartsWith(t)?(this.remaining=this.remaining.substring(t.length),!0):!1}capture(t){if(!this.consumeOptional(t))throw new ur(4011,!1)}};function Nj(n){return n.segments.length>0?new Po([],{[Pr]:n}):n}function kj(n){let t={};for(let[r,o]of Object.entries(n.children)){let s=kj(o);if(r===Pr&&s.segments.length===0&&s.hasChildren())for(let[i,a]of Object.entries(s.children))t[i]=a;else(s.segments.length>0||s.hasChildren())&&(t[r]=s)}let e=new Po(n.segments,t);return SSe(e)}function SSe(n){if(n.numberOfChildren===1&&n.children[Pr]){let t=n.children[Pr];return new Po(n.segments.concat(t.segments),t.children)}return n}function Sv(n){return n instanceof Eh}function Dj(n,t,e=null,r=null){let o=Aj(n);return Oj(o,t,e,r)}function Aj(n){let t;function e(s){let i={};for(let u of s.children){let c=e(u);i[u.outlet]=c}let a=new Po(s.url,i);return s===n&&(t=a),a}let r=e(n.root),o=Nj(r);return t??o}function Oj(n,t,e,r){let o=n;for(;o.parent;)o=o.parent;if(t.length===0)return V4(o,o,o,e,r);let s=CSe(t);if(s.toRoot())return V4(o,o,new Po([],{}),e,r);let i=ISe(s,o,n),a=i.processChildren?pC(i.segmentGroup,i.index,s.commands):Mj(i.segmentGroup,i.index,s.commands);return V4(o,i.segmentGroup,a,e,r)}function vE(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function dC(n){return typeof n=="object"&&n!=null&&n.outlets}function V4(n,t,e,r,o){let s={};r&&Object.entries(r).forEach(([u,c])=>{s[u]=Array.isArray(c)?c.map(h=>`${h}`):`${c}`});let i;n===t?i=e:i=Rj(n,t,e);let a=Nj(kj(i));return new Eh(a,s,o)}function Rj(n,t,e){let r={};return Object.entries(n.children).forEach(([o,s])=>{s===t?r[o]=e:r[o]=Rj(s,t,e)}),new Po(n.segments,r)}var wE=class{isAbsolute;numberOfDoubleDots;commands;constructor(t,e,r){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=r,t&&r.length>0&&vE(r[0]))throw new ur(4003,!1);let o=r.find(dC);if(o&&o!==wj(r))throw new ur(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function CSe(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new wE(!0,0,n);let t=0,e=!1,r=n.reduce((o,s,i)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([u,c])=>{a[u]=typeof c=="string"?c.split("/"):c}),[...o,{outlets:a}]}if(s.segmentPath)return[...o,s.segmentPath]}return typeof s!="string"?[...o,s]:i===0?(s.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?e=!0:a===".."?t++:a!=""&&o.push(a))}),o):[...o,s]},[]);return new wE(e,t,r)}var vv=class{segmentGroup;processChildren;index;constructor(t,e,r){this.segmentGroup=t,this.processChildren=e,this.index=r}};function ISe(n,t,e){if(n.isAbsolute)return new vv(t,!0,0);if(!e)return new vv(t,!1,NaN);if(e.parent===null)return new vv(e,!0,0);let r=vE(n.commands[0])?0:1,o=e.segments.length-1+r;return _Se(e,o,n.numberOfDoubleDots)}function _Se(n,t,e){let r=n,o=t,s=e;for(;s>o;){if(s-=o,r=r.parent,!r)throw new ur(4005,!1);o=r.segments.length}return new vv(r,!1,o-s)}function TSe(n){return dC(n[0])?n[0].outlets:{[Pr]:n}}function Mj(n,t,e){if(n??=new Po([],{}),n.segments.length===0&&n.hasChildren())return pC(n,t,e);let r=ESe(n,t,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new Po(n.segments.slice(0,r.pathIndex),{});return s.children[Pr]=new Po(n.segments.slice(r.pathIndex),n.children),pC(s,0,o)}else return r.match&&o.length===0?new Po(n.segments,{}):r.match&&!n.hasChildren()?K4(n,t,e):r.match?pC(n,0,o):K4(n,t,e)}function pC(n,t,e){if(e.length===0)return new Po(n.segments,{});{let r=TSe(e),o={};if(Object.keys(r).some(s=>s!==Pr)&&n.children[Pr]&&n.numberOfChildren===1&&n.children[Pr].segments.length===0){let s=pC(n.children[Pr],t,e);return new Po(n.segments,s.children)}return Object.entries(r).forEach(([s,i])=>{typeof i=="string"&&(i=[i]),i!==null&&(o[s]=Mj(n.children[s],t,i))}),Object.entries(n.children).forEach(([s,i])=>{r[s]===void 0&&(o[s]=i)}),new Po(n.segments,o)}}function ESe(n,t,e){let r=0,o=t,s={match:!1,pathIndex:0,commandIndex:0};for(;o<n.segments.length;){if(r>=e.length)return s;let i=n.segments[o],a=e[r];if(dC(a))break;let u=`${a}`,c=r<e.length-1?e[r+1]:null;if(o>0&&u===void 0)break;if(u&&c&&typeof c=="object"&&c.outlets===void 0){if(!mj(u,c,i))return s;r+=2}else{if(!mj(u,{},i))return s;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}function K4(n,t,e){let r=n.segments.slice(0,t),o=0;for(;o<e.length;){let s=e[o];if(dC(s)){let u=NSe(s.outlets);return new Po(r,u)}if(o===0&&vE(e[0])){let u=n.segments[t];r.push(new t0(u.path,fj(e[0]))),o++;continue}let i=dC(s)?s.outlets[Pr]:`${s}`,a=o<e.length-1?e[o+1]:null;i&&a&&vE(a)?(r.push(new t0(i,fj(a))),o+=2):(r.push(new t0(i,{})),o++)}return new Po(r,{})}function NSe(n){let t={};return Object.entries(n).forEach(([e,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(t[e]=K4(new Po([],{}),0,r))}),t}function fj(n){let t={};return Object.entries(n).forEach(([e,r])=>t[e]=`${r}`),t}function mj(n,t,e){return n==e.path&&_h(t,e.parameters)}var bE="imperative",Qi=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(Qi||{}),Wc=class{id;url;constructor(t,e){this.id=t,this.url=e}},r0=class extends Wc{type=Qi.NavigationStart;navigationTrigger;restoredState;constructor(t,e,r="imperative",o=null){super(t,e),this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Ep=class extends Wc{urlAfterRedirects;type=Qi.NavigationEnd;constructor(t,e,r){super(t,e),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},pc=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(pc||{}),Cv=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(Cv||{}),Th=class extends Wc{reason;code;type=Qi.NavigationCancel;constructor(t,e,r,o){super(t,e),this.reason=r,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Nh=class extends Wc{reason;code;type=Qi.NavigationSkipped;constructor(t,e,r,o){super(t,e),this.reason=r,this.code=o}},Iv=class extends Wc{error;target;type=Qi.NavigationError;constructor(t,e,r,o){super(t,e),this.error=r,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},fC=class extends Wc{urlAfterRedirects;state;type=Qi.RoutesRecognized;constructor(t,e,r,o){super(t,e),this.urlAfterRedirects=r,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},SE=class extends Wc{urlAfterRedirects;state;type=Qi.GuardsCheckStart;constructor(t,e,r,o){super(t,e),this.urlAfterRedirects=r,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},CE=class extends Wc{urlAfterRedirects;state;shouldActivate;type=Qi.GuardsCheckEnd;constructor(t,e,r,o,s){super(t,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=s}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},IE=class extends Wc{urlAfterRedirects;state;type=Qi.ResolveStart;constructor(t,e,r,o){super(t,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},_E=class extends Wc{urlAfterRedirects;state;type=Qi.ResolveEnd;constructor(t,e,r,o){super(t,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},TE=class{route;type=Qi.RouteConfigLoadStart;constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},EE=class{route;type=Qi.RouteConfigLoadEnd;constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},NE=class{snapshot;type=Qi.ChildActivationStart;constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},kE=class{snapshot;type=Qi.ChildActivationEnd;constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},DE=class{snapshot;type=Qi.ActivationStart;constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},AE=class{snapshot;type=Qi.ActivationEnd;constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},_v=class{routerEvent;position;anchor;type=Qi.Scroll;constructor(t,e,r){this.routerEvent=t,this.position=e,this.anchor=r}toString(){let t=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${t}')`}},mC=class{},Tv=class{url;navigationBehaviorOptions;constructor(t,e){this.url=t,this.navigationBehaviorOptions=e}};function kSe(n,t){return n.providers&&!n._injector&&(n._injector=ZS(n.providers,t,`Route: ${n.path}`)),n._injector??t}function Tp(n){return n.outlet||Pr}function DSe(n,t){let e=n.filter(r=>Tp(r)===t);return e.push(...n.filter(r=>Tp(r)!==t)),e}function SC(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let t=n.parent;t;t=t.parent){let e=t.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var OE=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return SC(this.route?.snapshot)??this.rootInjector}constructor(t){this.rootInjector=t,this.children=new Qy(this.rootInjector)}},Qy=(()=>{class n{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,r){let o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){let r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new OE(this.rootInjector),this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(r){return new(r||n)(Sr(cc))};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),RE=class{_root;constructor(t){this._root=t}get root(){return this._root.value}parent(t){let e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){let e=X4(t,this._root);return e?e.children.map(r=>r.value):[]}firstChild(t){let e=X4(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){let e=Y4(t,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==t)}pathFromRoot(t){return Y4(t,this._root).map(e=>e.value)}};function X4(n,t){if(n===t.value)return t;for(let e of t.children){let r=X4(n,e);if(r)return r}return null}function Y4(n,t){if(n===t.value)return[t];for(let e of t.children){let r=Y4(n,e);if(r.length)return r.unshift(t),r}return[]}var Gc=class{value;children;constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}};function bv(n){let t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}var gC=class extends RE{snapshot;constructor(t,e){super(t),this.snapshot=e,oM(this,t)}toString(){return this.snapshot.toString()}};function Fj(n){let t=ASe(n),e=new Va([new t0("",{})]),r=new Va({}),o=new Va({}),s=new Va({}),i=new Va(""),a=new Vf(e,r,s,i,o,Pr,n,t.root);return a.snapshot=t.root,new gC(new Gc(a,[]),t)}function ASe(n){let t={},e={},r={},o="",s=new Ky([],t,r,o,e,Pr,n,null,{});return new yC("",new Gc(s,[]))}var Vf=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(t,e,r,o,s,i,a,u){this.urlSubject=t,this.paramsSubject=e,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=s,this.outlet=i,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(go(c=>c[wC]))??br(void 0),this.url=t,this.params=e,this.queryParams=r,this.fragment=o,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(go(t=>Xy(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(go(t=>Xy(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function ME(n,t,e="emptyOnly"){let r,{routeConfig:o}=n;return t!==null&&(e==="always"||o?.path===""||!t.component&&!t.routeConfig?.loadComponent)?r={params:Tt(Tt({},t.params),n.params),data:Tt(Tt({},t.data),n.data),resolve:Tt(Tt(Tt(Tt({},n.data),t.data),o?.data),n._resolvedData)}:r={params:Tt({},n.params),data:Tt({},n.data),resolve:Tt(Tt({},n.data),n._resolvedData??{})},o&&$j(o)&&(r.resolve[wC]=o.title),r}var Ky=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[wC]}constructor(t,e,r,o,s,i,a,u,c){this.url=t,this.params=e,this.queryParams=r,this.fragment=o,this.data=s,this.outlet=i,this.component=a,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Xy(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Xy(this.queryParams),this._queryParamMap}toString(){let t=this.url.map(r=>r.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${t}', path:'${e}')`}},yC=class extends RE{url;constructor(t,e){super(e),this.url=t,oM(this,e)}toString(){return Pj(this._root)}};function oM(n,t){t.value._routerState=n,t.children.forEach(e=>oM(n,e))}function Pj(n){let t=n.children.length>0?` { ${n.children.map(Pj).join(", ")} } `:"";return`${n.value}${t}`}function j4(n){if(n.snapshot){let t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,_h(t.queryParams,e.queryParams)||n.queryParamsSubject.next(e.queryParams),t.fragment!==e.fragment&&n.fragmentSubject.next(e.fragment),_h(t.params,e.params)||n.paramsSubject.next(e.params),sSe(t.url,e.url)||n.urlSubject.next(e.url),_h(t.data,e.data)||n.dataSubject.next(e.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function Q4(n,t){let e=_h(n.params,t.params)&&cSe(n.url,t.url),r=!n.parent!=!t.parent;return e&&!r&&(!n.parent||Q4(n.parent,t.parent))}function $j(n){return typeof n.title=="string"||n.title===null}var Lj=new lr(""),CC=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Pr;activateEvents=new uc;deactivateEvents=new uc;attachEvents=new uc;detachEvents=new uc;routerOutletData=Lz(void 0);parentContexts=xn(Qy);location=xn(ZT);changeDetector=xn(tC);inputBinder=xn(IC,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ur(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ur(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ur(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new ur(4013,!1);this._activatedRoute=e;let o=this.location,i=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,u=new Z4(e,a,o.injector,this.routerOutletData);this.activated=o.createComponent(i,{index:o.length,injector:u,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||n)};static \u0275dir=eE({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[UT]})}return n})(),Z4=class{route;childContexts;parent;outletData;constructor(t,e,r,o){this.route=t,this.childContexts=e,this.parent=r,this.outletData=o}get(t,e){return t===Vf?this.route:t===Qy?this.childContexts:t===Lj?this.outletData:this.parent.get(t,e)}},IC=new lr(""),sM=(()=>{class n{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){let{activatedRoute:r}=e,o=MS([r.queryParams,r.params,r.data]).pipe(vl(([s,i,a],u)=>(a=Tt(Tt(Tt({},s),i),a),u===0?br(a):Promise.resolve(a)))).subscribe(s=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==r||r.component===null){this.unsubscribeFromRouteData(e);return}let i=XV(r.component);if(!i){this.unsubscribeFromRouteData(e);return}for(let{templateName:a}of i.inputs)e.activatedComponentRef.setInput(a,s[a])});this.outletDataSubscriptions.set(e,o)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac})}return n})(),iM=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275cmp=JT({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,o){r&1&&eC(0,"router-outlet")},dependencies:[CC],encapsulation:2})}return n})();function aM(n){let t=n.children&&n.children.map(aM),e=t?Tn(Tt({},n),{children:t}):Tt({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==Pr&&(e.component=iM),e}function OSe(n,t,e){let r=xC(n,t._root,e?e._root:void 0);return new gC(r,t)}function xC(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){let r=e.value;r._futureSnapshot=t.value;let o=RSe(n,t,e);return new Gc(r,o)}else{if(n.shouldAttach(t.value)){let s=n.retrieve(t.value);if(s!==null){let i=s.route;return i.value._futureSnapshot=t.value,i.children=t.children.map(a=>xC(n,a)),i}}let r=MSe(t.value),o=t.children.map(s=>xC(n,s));return new Gc(r,o)}}function RSe(n,t,e){return t.children.map(r=>{for(let o of e.children)if(n.shouldReuseRoute(r.value,o.value.snapshot))return xC(n,r,o);return xC(n,r)})}function MSe(n){return new Vf(new Va(n.url),new Va(n.params),new Va(n.queryParams),new Va(n.fragment),new Va(n.data),n.outlet,n.component,n)}var Ev=class{redirectTo;navigationBehaviorOptions;constructor(t,e){this.redirectTo=t,this.navigationBehaviorOptions=e}},Bj="ngNavigationCancelingError";function FE(n,t){let{redirectTo:e,navigationBehaviorOptions:r}=Sv(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,o=zj(!1,pc.Redirect);return o.url=e,o.navigationBehaviorOptions=r,o}function zj(n,t){let e=new Error(`NavigationCancelingError: ${n||""}`);return e[Bj]=!0,e.cancellationCode=t,e}function FSe(n){return Vj(n)&&Sv(n.url)}function Vj(n){return!!n&&n[Bj]}var PSe=(n,t,e,r)=>go(o=>(new J4(t,o.targetRouterState,o.currentRouterState,e,r).activate(n),o)),J4=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(t,e,r,o,s){this.routeReuseStrategy=t,this.futureState=e,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=s}activate(t){let e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,t),j4(this.futureState.root),this.activateChildRoutes(e,r,t)}deactivateChildRoutes(t,e,r){let o=bv(e);t.children.forEach(s=>{let i=s.value.outlet;this.deactivateRoutes(s,o[i],r),delete o[i]}),Object.values(o).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(t,e,r){let o=t.value,s=e?e.value:null;if(o===s)if(o.component){let i=r.getContext(o.outlet);i&&this.deactivateChildRoutes(t,e,i.children)}else this.deactivateChildRoutes(t,e,r);else s&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){let r=e.getContext(t.value.outlet),o=r&&t.value.component?r.children:e,s=bv(t);for(let i of Object.values(s))this.deactivateRouteAndItsChildren(i,o);if(r&&r.outlet){let i=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:i,route:t,contexts:a})}}deactivateRouteAndOutlet(t,e){let r=e.getContext(t.value.outlet),o=r&&t.value.component?r.children:e,s=bv(t);for(let i of Object.values(s))this.deactivateRouteAndItsChildren(i,o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(t,e,r){let o=bv(e);t.children.forEach(s=>{this.activateRoutes(s,o[s.value.outlet],r),this.forwardEvent(new AE(s.value.snapshot))}),t.children.length&&this.forwardEvent(new kE(t.value.snapshot))}activateRoutes(t,e,r){let o=t.value,s=e?e.value:null;if(j4(o),o===s)if(o.component){let i=r.getOrCreateContext(o.outlet);this.activateChildRoutes(t,e,i.children)}else this.activateChildRoutes(t,e,r);else if(o.component){let i=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),i.children.onOutletReAttached(a.contexts),i.attachRef=a.componentRef,i.route=a.route.value,i.outlet&&i.outlet.attach(a.componentRef,a.route.value),j4(a.route.value),this.activateChildRoutes(t,null,i.children)}else i.attachRef=null,i.route=o,i.outlet&&i.outlet.activateWith(o,i.injector),this.activateChildRoutes(t,null,i.children)}else this.activateChildRoutes(t,null,r)}},PE=class{path;route;constructor(t){this.path=t,this.route=this.path[this.path.length-1]}},wv=class{component;route;constructor(t,e){this.component=t,this.route=e}};function $Se(n,t,e){let r=n._root,o=t?t._root:null;return lC(r,o,e,[r.value])}function LSe(n){let t=n.routeConfig?n.routeConfig.canActivateChild:null;return!t||t.length===0?null:{node:n,guards:t}}function kv(n,t){let e=Symbol(),r=t.get(n,e);return r===e?typeof n=="function"&&!RB(n)?n:t.get(n):r}function lC(n,t,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let s=bv(t);return n.children.forEach(i=>{BSe(i,s[i.value.outlet],e,r.concat([i.value]),o),delete s[i.value.outlet]}),Object.entries(s).forEach(([i,a])=>hC(a,e.getContext(i),o)),o}function BSe(n,t,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,i=t?t.value:null,a=e?e.getContext(n.value.outlet):null;if(i&&s.routeConfig===i.routeConfig){let u=zSe(i,s,s.routeConfig.runGuardsAndResolvers);u?o.canActivateChecks.push(new PE(r)):(s.data=i.data,s._resolvedData=i._resolvedData),s.component?lC(n,t,a?a.children:null,r,o):lC(n,t,e,r,o),u&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new wv(a.outlet.component,i))}else i&&hC(t,a,o),o.canActivateChecks.push(new PE(r)),s.component?lC(n,null,a?a.children:null,r,o):lC(n,null,e,r,o);return o}function zSe(n,t,e){if(typeof e=="function")return e(n,t);switch(e){case"pathParamsChange":return!Hy(n.url,t.url);case"pathParamsOrQueryParamsChange":return!Hy(n.url,t.url)||!_h(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Q4(n,t)||!_h(n.queryParams,t.queryParams);case"paramsChange":default:return!Q4(n,t)}}function hC(n,t,e){let r=bv(n),o=n.value;Object.entries(r).forEach(([s,i])=>{o.component?t?hC(i,t.children.getContext(s),e):hC(i,null,e):hC(i,t,e)}),o.component?t&&t.outlet&&t.outlet.isActivated?e.canDeactivateChecks.push(new wv(t.outlet.component,o)):e.canDeactivateChecks.push(new wv(null,o)):e.canDeactivateChecks.push(new wv(null,o))}function _C(n){return typeof n=="function"}function VSe(n){return typeof n=="boolean"}function jSe(n){return n&&_C(n.canLoad)}function USe(n){return n&&_C(n.canActivate)}function qSe(n){return n&&_C(n.canActivateChild)}function GSe(n){return n&&_C(n.canDeactivate)}function WSe(n){return n&&_C(n.canMatch)}function jj(n){return n instanceof Of||n?.name==="EmptyError"}var mE=Symbol("INITIAL_VALUE");function Nv(){return vl(n=>MS(n.map(t=>t.pipe(Mf(1),lR(mE)))).pipe(go(t=>{for(let e of t)if(e!==!0){if(e===mE)return mE;if(e===!1||HSe(e))return e}return!0}),Uc(t=>t!==mE),Mf(1)))}function HSe(n){return Sv(n)||n instanceof Ev}function KSe(n,t){return Ci(e=>{let{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:s,canDeactivateChecks:i}}=e;return i.length===0&&s.length===0?br(Tn(Tt({},e),{guardsResult:!0})):XSe(i,r,o,n).pipe(Ci(a=>a&&VSe(a)?YSe(r,s,n,t):br(a)),go(a=>Tn(Tt({},e),{guardsResult:a})))})}function XSe(n,t,e,r){return ai(n).pipe(Ci(o=>tCe(o.component,o.route,e,t,r)),Ff(o=>o!==!0,!0))}function YSe(n,t,e,r){return ai(t).pipe(Wg(o=>Zb(ZSe(o.route.parent,r),QSe(o.route,r),eCe(n,o.path,e),JSe(n,o.route,e))),Ff(o=>o!==!0,!0))}function QSe(n,t){return n!==null&&t&&t(new DE(n)),br(!0)}function ZSe(n,t){return n!==null&&t&&t(new NE(n)),br(!0)}function JSe(n,t,e){let r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||r.length===0)return br(!0);let o=r.map(s=>uT(()=>{let i=SC(t)??e,a=kv(s,i),u=USe(a)?a.canActivate(t,n):El(i,()=>a(t,n));return o0(u).pipe(Ff())}));return br(o).pipe(Nv())}function eCe(n,t,e){let r=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(i=>LSe(i)).filter(i=>i!==null).map(i=>uT(()=>{let a=i.guards.map(u=>{let c=SC(i.node)??e,h=kv(u,c),f=qSe(h)?h.canActivateChild(r,n):El(c,()=>h(r,n));return o0(f).pipe(Ff())});return br(a).pipe(Nv())}));return br(s).pipe(Nv())}function tCe(n,t,e,r,o){let s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!s||s.length===0)return br(!0);let i=s.map(a=>{let u=SC(t)??o,c=kv(a,u),h=GSe(c)?c.canDeactivate(n,t,e,r):El(u,()=>c(n,t,e,r));return o0(h).pipe(Ff())});return br(i).pipe(Nv())}function nCe(n,t,e,r){let o=t.canLoad;if(o===void 0||o.length===0)return br(!0);let s=o.map(i=>{let a=kv(i,n),u=jSe(a)?a.canLoad(t,e):El(n,()=>a(t,e));return o0(u)});return br(s).pipe(Nv(),Uj(r))}function Uj(n){return rR(ja(t=>{if(typeof t!="boolean")throw FE(n,t)}),go(t=>t===!0))}function rCe(n,t,e,r){let o=t.canMatch;if(!o||o.length===0)return br(!0);let s=o.map(i=>{let a=kv(i,n),u=WSe(a)?a.canMatch(t,e):El(n,()=>a(t,e));return o0(u)});return br(s).pipe(Nv(),Uj(r))}var bC=class{segmentGroup;constructor(t){this.segmentGroup=t||null}},vC=class extends Error{urlTree;constructor(t){super(),this.urlTree=t}};function xv(n){return Yb(new bC(n))}function oCe(n){return Yb(new ur(4e3,!1))}function sCe(n){return Yb(zj(!1,pc.GuardRejected))}var eM=class{urlSerializer;urlTree;constructor(t,e){this.urlSerializer=t,this.urlTree=e}lineralizeSegments(t,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),o.numberOfChildren===0)return br(r);if(o.numberOfChildren>1||!o.children[Pr])return oCe(`${t.redirectTo}`);o=o.children[Pr]}}applyRedirectCommands(t,e,r,o,s){if(typeof e!="string"){let a=e,{queryParams:u,fragment:c,routeConfig:h,url:f,outlet:g,params:d,data:p,title:m}=o,y=El(s,()=>a({params:d,data:p,queryParams:u,fragment:c,routeConfig:h,url:f,outlet:g,title:m}));if(y instanceof Eh)throw new vC(y);e=y}let i=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,r);if(e[0]==="/")throw new vC(i);return i}applyRedirectCreateUrlTree(t,e,r,o){let s=this.createSegmentGroup(t,e.root,r,o);return new Eh(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){let r={};return Object.entries(t).forEach(([o,s])=>{if(typeof s=="string"&&s[0]===":"){let a=s.substring(1);r[o]=e[a]}else r[o]=s}),r}createSegmentGroup(t,e,r,o){let s=this.createSegments(t,e.segments,r,o),i={};return Object.entries(e.children).forEach(([a,u])=>{i[a]=this.createSegmentGroup(t,u,r,o)}),new Po(s,i)}createSegments(t,e,r,o){return e.map(s=>s.path[0]===":"?this.findPosParam(t,s,o):this.findOrReturn(s,r))}findPosParam(t,e,r){let o=r[e.path.substring(1)];if(!o)throw new ur(4001,!1);return o}findOrReturn(t,e){let r=0;for(let o of e){if(o.path===t.path)return e.splice(r),o;r++}return t}},tM={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function iCe(n,t,e,r,o){let s=qj(n,t,e);return s.matched?(r=kSe(t,r),rCe(r,t,e,o).pipe(go(i=>i===!0?s:Tt({},tM)))):br(s)}function qj(n,t,e){if(t.path==="**")return aCe(e);if(t.path==="")return t.pathMatch==="full"&&(n.hasChildren()||e.length>0)?Tt({},tM):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let o=(t.matcher||bj)(e,n,t);if(!o)return Tt({},tM);let s={};Object.entries(o.posParams??{}).forEach(([a,u])=>{s[a]=u.path});let i=o.consumed.length>0?Tt(Tt({},s),o.consumed[o.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:i,positionalParamSegments:o.posParams??{}}}function aCe(n){return{matched:!0,parameters:n.length>0?wj(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function gj(n,t,e,r){return e.length>0&&lCe(n,e,r)?{segmentGroup:new Po(t,cCe(r,new Po(e,n.children))),slicedSegments:[]}:e.length===0&&pCe(n,e,r)?{segmentGroup:new Po(n.segments,uCe(n,e,r,n.children)),slicedSegments:e}:{segmentGroup:new Po(n.segments,n.children),slicedSegments:e}}function uCe(n,t,e,r){let o={};for(let s of e)if(LE(n,t,s)&&!r[Tp(s)]){let i=new Po([],{});o[Tp(s)]=i}return Tt(Tt({},r),o)}function cCe(n,t){let e={};e[Pr]=t;for(let r of n)if(r.path===""&&Tp(r)!==Pr){let o=new Po([],{});e[Tp(r)]=o}return e}function lCe(n,t,e){return e.some(r=>LE(n,t,r)&&Tp(r)!==Pr)}function pCe(n,t,e){return e.some(r=>LE(n,t,r))}function LE(n,t,e){return(n.hasChildren()||t.length>0)&&e.pathMatch==="full"?!1:e.path===""}function hCe(n,t,e){return t.length===0&&!n.children[e]}var nM=class{};function dCe(n,t,e,r,o,s,i="emptyOnly"){return new rM(n,t,e,r,o,i,s).recognize()}var fCe=31,rM=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(t,e,r,o,s,i,a){this.injector=t,this.configLoader=e,this.rootComponentType=r,this.config=o,this.urlTree=s,this.paramsInheritanceStrategy=i,this.urlSerializer=a,this.applyRedirects=new eM(this.urlSerializer,this.urlTree)}noMatchError(t){return new ur(4002,`'${t.segmentGroup}'`)}recognize(){let t=gj(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(go(({children:e,rootSnapshot:r})=>{let o=new Gc(r,e),s=new yC("",o),i=Dj(r,[],this.urlTree.queryParams,this.urlTree.fragment);return i.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(i),{state:s,tree:i}}))}match(t){let e=new Ky([],Object.freeze({}),Object.freeze(Tt({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Pr,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,t,Pr,e).pipe(go(r=>({children:r,rootSnapshot:e})),Rf(r=>{if(r instanceof vC)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof bC?this.noMatchError(r):r}))}processSegmentGroup(t,e,r,o,s){return r.segments.length===0&&r.hasChildren()?this.processChildren(t,e,r,s):this.processSegment(t,e,r,r.segments,o,!0,s).pipe(go(i=>i instanceof Gc?[i]:[]))}processChildren(t,e,r,o){let s=[];for(let i of Object.keys(r.children))i==="primary"?s.unshift(i):s.push(i);return ai(s).pipe(Wg(i=>{let a=r.children[i],u=DSe(e,i);return this.processSegmentGroup(t,u,a,i,o)}),cR((i,a)=>(i.push(...a),i)),Hg(null),uR(),Ci(i=>{if(i===null)return xv(r);let a=Gj(i);return mCe(a),br(a)}))}processSegment(t,e,r,o,s,i,a){return ai(e).pipe(Wg(u=>this.processSegmentAgainstRoute(u._injector??t,e,u,r,o,s,i,a).pipe(Rf(c=>{if(c instanceof bC)return br(null);throw c}))),Ff(u=>!!u),Rf(u=>{if(jj(u))return hCe(r,o,s)?br(new nM):xv(r);throw u}))}processSegmentAgainstRoute(t,e,r,o,s,i,a,u){return Tp(r)!==i&&(i===Pr||!LE(o,s,r))?xv(o):r.redirectTo===void 0?this.matchSegmentAgainstRoute(t,o,r,s,i,u):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(t,o,e,r,s,i,u):xv(o)}expandSegmentAgainstRouteUsingRedirect(t,e,r,o,s,i,a){let{matched:u,parameters:c,consumedSegments:h,positionalParamSegments:f,remainingSegments:g}=qj(e,o,s);if(!u)return xv(e);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>fCe&&(this.allowRedirects=!1));let d=new Ky(s,c,Object.freeze(Tt({},this.urlTree.queryParams)),this.urlTree.fragment,yj(o),Tp(o),o.component??o._loadedComponent??null,o,xj(o)),p=ME(d,a,this.paramsInheritanceStrategy);d.params=Object.freeze(p.params),d.data=Object.freeze(p.data);let m=this.applyRedirects.applyRedirectCommands(h,o.redirectTo,f,d,t);return this.applyRedirects.lineralizeSegments(o,m).pipe(Ci(y=>this.processSegment(t,r,e,y.concat(g),i,!1,a)))}matchSegmentAgainstRoute(t,e,r,o,s,i){let a=iCe(e,r,o,t,this.urlSerializer);return r.path==="**"&&(e.children={}),a.pipe(vl(u=>u.matched?(t=r._injector??t,this.getChildConfig(t,r,o).pipe(vl(({routes:c})=>{let h=r._loadedInjector??t,{parameters:f,consumedSegments:g,remainingSegments:d}=u,p=new Ky(g,f,Object.freeze(Tt({},this.urlTree.queryParams)),this.urlTree.fragment,yj(r),Tp(r),r.component??r._loadedComponent??null,r,xj(r)),m=ME(p,i,this.paramsInheritanceStrategy);p.params=Object.freeze(m.params),p.data=Object.freeze(m.data);let{segmentGroup:y,slicedSegments:v}=gj(e,g,d,c);if(v.length===0&&y.hasChildren())return this.processChildren(h,c,y,p).pipe(go(T=>new Gc(p,T)));if(c.length===0&&v.length===0)return br(new Gc(p,[]));let N=Tp(r)===s;return this.processSegment(h,c,y,v,N?Pr:s,!0,p).pipe(go(T=>new Gc(p,T instanceof Gc?[T]:[])))}))):xv(e)))}getChildConfig(t,e,r){return e.children?br({routes:e.children,injector:t}):e.loadChildren?e._loadedRoutes!==void 0?br({routes:e._loadedRoutes,injector:e._loadedInjector}):nCe(t,e,r,this.urlSerializer).pipe(Ci(o=>o?this.configLoader.loadChildren(t,e).pipe(ja(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):sCe(e))):br({routes:[],injector:t})}};function mCe(n){n.sort((t,e)=>t.value.outlet===Pr?-1:e.value.outlet===Pr?1:t.value.outlet.localeCompare(e.value.outlet))}function gCe(n){let t=n.value.routeConfig;return t&&t.path===""}function Gj(n){let t=[],e=new Set;for(let r of n){if(!gCe(r)){t.push(r);continue}let o=t.find(s=>r.value.routeConfig===s.value.routeConfig);o!==void 0?(o.children.push(...r.children),e.add(o)):t.push(r)}for(let r of e){let o=Gj(r.children);t.push(new Gc(r.value,o))}return t.filter(r=>!e.has(r))}function yj(n){return n.data||{}}function xj(n){return n.resolve||{}}function yCe(n,t,e,r,o,s){return Ci(i=>dCe(n,t,e,r,i.extractedUrl,o,s).pipe(go(({state:a,tree:u})=>Tn(Tt({},i),{targetSnapshot:a,urlAfterRedirects:u}))))}function xCe(n,t){return Ci(e=>{let{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return br(e);let s=new Set(o.map(u=>u.route)),i=new Set;for(let u of s)if(!i.has(u))for(let c of Wj(u))i.add(c);let a=0;return ai(i).pipe(Wg(u=>s.has(u)?bCe(u,r,n,t):(u.data=ME(u,u.parent,n).resolve,br(void 0))),ja(()=>a++),Jb(1),Ci(u=>a===i.size?br(e):ic))})}function Wj(n){let t=n.children.map(e=>Wj(e)).flat();return[n,...t]}function bCe(n,t,e,r){let o=n.routeConfig,s=n._resolve;return o?.title!==void 0&&!$j(o)&&(s[wC]=o.title),vCe(s,n,t,r).pipe(go(i=>(n._resolvedData=i,n.data=ME(n,n.parent,e).resolve,null)))}function vCe(n,t,e,r){let o=G4(n);if(o.length===0)return br({});let s={};return ai(o).pipe(Ci(i=>wCe(n[i],t,e,r).pipe(Ff(),ja(a=>{if(a instanceof Ev)throw FE(new n0,a);s[i]=a}))),Jb(1),go(()=>s),Rf(i=>jj(i)?ic:Yb(i)))}function wCe(n,t,e,r){let o=SC(t)??r,s=kv(n,o),i=s.resolve?s.resolve(t,e):El(o,()=>s(t,e));return o0(i)}function U4(n){return vl(t=>{let e=n(t);return e?ai(e).pipe(go(()=>t)):br(t)})}var uM=(()=>{class n{buildTitle(e){let r,o=e.root;for(;o!==void 0;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(s=>s.outlet===Pr);return r}getResolvedTitleForRoute(e){return e.data[wC]}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:()=>xn(Hj),providedIn:"root"})}return n})(),Hj=(()=>{class n extends uM{title;constructor(e){super(),this.title=e}updateTitle(e){let r=this.buildTitle(e);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||n)(Sr(pj))};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Zy=new lr("",{providedIn:"root",factory:()=>({})}),Jy=new lr(""),BE=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=xn(UV);loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return br(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);let r=o0(e.loadComponent()).pipe(go(Xj),ja(s=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=s}),FS(()=>{this.componentLoaders.delete(e)})),o=new Xb(r,()=>new za).pipe(Kb());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return br({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let s=Kj(r,this.compiler,e,this.onLoadEndListener).pipe(FS(()=>{this.childrenLoaders.delete(r)})),i=new Xb(s,()=>new za).pipe(Kb());return this.childrenLoaders.set(r,i),i}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Kj(n,t,e,r){return o0(n.loadChildren()).pipe(go(Xj),Ci(o=>o instanceof C4||Array.isArray(o)?br(o):ai(t.compileModuleAsync(o))),go(o=>{r&&r(n);let s,i,a=!1;return Array.isArray(o)?(i=o,a=!0):(s=o.create(e).injector,i=s.get(Jy,[],{optional:!0,self:!0}).flat()),{routes:i.map(aM),injector:s}}))}function SCe(n){return n&&typeof n=="object"&&"default"in n}function Xj(n){return SCe(n)?n.default:n}var zE=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:()=>xn(CCe),providedIn:"root"})}return n})(),CCe=(()=>{class n{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),cM=new lr(""),lM=new lr("");function Yj(n,t,e){let r=n.get(lM),o=n.get(ba);return n.get(Ii).runOutsideAngular(()=>{if(!o.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,new Promise(c=>setTimeout(c));let s,i=new Promise(c=>{s=c}),a=o.startViewTransition(()=>(s(),ICe(n))),{onViewTransitionCreated:u}=r;return u&&El(n,()=>u({transition:a,from:t,to:e})),i})}function ICe(n){return new Promise(t=>{g4({read:()=>setTimeout(t)},{injector:n})})}var pM=new lr(""),VE=(()=>{class n{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new za;transitionAbortSubject=new za;configLoader=xn(BE);environmentInjector=xn(cc);destroyRef=xn(QS);urlSerializer=xn(Yy);rootContexts=xn(Qy);location=xn(e0);inputBindingEnabled=xn(IC,{optional:!0})!==null;titleStrategy=xn(uM);options=xn(Zy,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=xn(zE);createViewTransition=xn(cM,{optional:!0});navigationErrorHandler=xn(pM,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>br(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=o=>this.events.next(new TE(o)),r=o=>this.events.next(new EE(o));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let r=++this.navigationId;this.transitions?.next(Tn(Tt({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,id:r}))}setupNavigations(e){return this.transitions=new Va(null),this.transitions.pipe(Uc(r=>r!==null),vl(r=>{let o=!1,s=!1;return br(r).pipe(vl(i=>{if(this.navigationId>r.id)return this.cancelNavigationTransition(r,"",pc.SupersededByNewNavigation),ic;this.currentTransition=r,this.currentNavigation={id:i.id,initialUrl:i.rawUrl,extractedUrl:i.extractedUrl,targetBrowserUrl:typeof i.extras.browserUrl=="string"?this.urlSerializer.parse(i.extras.browserUrl):i.extras.browserUrl,trigger:i.source,extras:i.extras,previousNavigation:this.lastSuccessfulNavigation?Tn(Tt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let a=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=i.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!a&&u!=="reload"){let c="";return this.events.next(new Nh(i.id,this.urlSerializer.serialize(i.rawUrl),c,Cv.IgnoredSameUrlNavigation)),i.resolve(!1),ic}if(this.urlHandlingStrategy.shouldProcessUrl(i.rawUrl))return br(i).pipe(vl(c=>(this.events.next(new r0(c.id,this.urlSerializer.serialize(c.extractedUrl),c.source,c.restoredState)),c.id!==this.navigationId?ic:Promise.resolve(c))),yCe(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),ja(c=>{r.targetSnapshot=c.targetSnapshot,r.urlAfterRedirects=c.urlAfterRedirects,this.currentNavigation=Tn(Tt({},this.currentNavigation),{finalUrl:c.urlAfterRedirects});let h=new fC(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(h)}));if(a&&this.urlHandlingStrategy.shouldProcessUrl(i.currentRawUrl)){let{id:c,extractedUrl:h,source:f,restoredState:g,extras:d}=i,p=new r0(c,this.urlSerializer.serialize(h),f,g);this.events.next(p);let m=Fj(this.rootComponentType).snapshot;return this.currentTransition=r=Tn(Tt({},i),{targetSnapshot:m,urlAfterRedirects:h,extras:Tn(Tt({},d),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=h,br(r)}else{let c="";return this.events.next(new Nh(i.id,this.urlSerializer.serialize(i.extractedUrl),c,Cv.IgnoredByUrlHandlingStrategy)),i.resolve(!1),ic}}),ja(i=>{let a=new SE(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects),i.targetSnapshot);this.events.next(a)}),go(i=>(this.currentTransition=r=Tn(Tt({},i),{guards:$Se(i.targetSnapshot,i.currentSnapshot,this.rootContexts)}),r)),KSe(this.environmentInjector,i=>this.events.next(i)),ja(i=>{if(r.guardsResult=i.guardsResult,i.guardsResult&&typeof i.guardsResult!="boolean")throw FE(this.urlSerializer,i.guardsResult);let a=new CE(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects),i.targetSnapshot,!!i.guardsResult);this.events.next(a)}),Uc(i=>i.guardsResult?!0:(this.cancelNavigationTransition(i,"",pc.GuardRejected),!1)),U4(i=>{if(i.guards.canActivateChecks.length!==0)return br(i).pipe(ja(a=>{let u=new IE(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(u)}),vl(a=>{let u=!1;return br(a).pipe(xCe(this.paramsInheritanceStrategy,this.environmentInjector),ja({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(a,"",pc.NoDataFromResolver)}}))}),ja(a=>{let u=new _E(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(u)}))}),U4(i=>{let a=u=>{let c=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&c.push(this.configLoader.loadComponent(u.routeConfig).pipe(ja(h=>{u.component=h}),go(()=>{})));for(let h of u.children)c.push(...a(h));return c};return MS(a(i.targetSnapshot.root)).pipe(Hg(null),Mf(1))}),U4(()=>this.afterPreactivation()),vl(()=>{let{currentSnapshot:i,targetSnapshot:a}=r,u=this.createViewTransition?.(this.environmentInjector,i.root,a.root);return u?ai(u).pipe(go(()=>r)):br(r)}),go(i=>{let a=OSe(e.routeReuseStrategy,i.targetSnapshot,i.currentRouterState);return this.currentTransition=r=Tn(Tt({},i),{targetRouterState:a}),this.currentNavigation.targetRouterState=a,r}),ja(()=>{this.events.next(new mC)}),PSe(this.rootContexts,e.routeReuseStrategy,i=>this.events.next(i),this.inputBindingEnabled),Mf(1),ja({next:i=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ep(i.id,this.urlSerializer.serialize(i.extractedUrl),this.urlSerializer.serialize(i.urlAfterRedirects))),this.titleStrategy?.updateTitle(i.targetRouterState.snapshot),i.resolve(!0)},complete:()=>{o=!0}}),pR(this.transitionAbortSubject.pipe(ja(i=>{throw i}))),FS(()=>{!o&&!s&&this.cancelNavigationTransition(r,"",pc.SupersededByNewNavigation),this.currentTransition?.id===r.id&&(this.currentNavigation=null,this.currentTransition=null)}),Rf(i=>{if(this.destroyed)return r.resolve(!1),ic;if(s=!0,Vj(i))this.events.next(new Th(r.id,this.urlSerializer.serialize(r.extractedUrl),i.message,i.cancellationCode)),FSe(i)?this.events.next(new Tv(i.url,i.navigationBehaviorOptions)):r.resolve(!1);else{let a=new Iv(r.id,this.urlSerializer.serialize(r.extractedUrl),i,r.targetSnapshot??void 0);try{let u=El(this.environmentInjector,()=>this.navigationErrorHandler?.(a));if(u instanceof Ev){let{message:c,cancellationCode:h}=FE(this.urlSerializer,u);this.events.next(new Th(r.id,this.urlSerializer.serialize(r.extractedUrl),c,h)),this.events.next(new Tv(u.redirectTo,u.navigationBehaviorOptions))}else throw this.events.next(a),i}catch(u){this.options.resolveNavigationPromiseOnError?r.resolve(!1):r.reject(u)}}return ic}))}))}cancelNavigationTransition(e,r,o){let s=new Th(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(s),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return e.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function _Ce(n){return n!==bE}var Qj=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:()=>xn(TCe),providedIn:"root"})}return n})(),$E=class{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}},TCe=(()=>{class n extends $E{static \u0275fac=(()=>{let e;return function(o){return(e||(e=a4(n)))(o||n)}})();static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Zj=(()=>{class n{urlSerializer=xn(Yy);options=xn(Zy,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=xn(e0);urlHandlingStrategy=xn(zE);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Eh;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:e,initialUrl:r,targetBrowserUrl:o}){let s=e!==void 0?this.urlHandlingStrategy.merge(e,r):r,i=o??s;return i instanceof Eh?this.urlSerializer.serialize(i):i}commitTransition({targetRouterState:e,finalUrl:r,initialUrl:o}){r&&e?(this.currentUrlTree=r,this.rawUrlTree=this.urlHandlingStrategy.merge(r,o),this.routerState=e):this.rawUrlTree=o}routerState=Fj(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:e}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e??this.rawUrlTree)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:()=>xn(ECe),providedIn:"root"})}return n})(),ECe=(()=>{class n extends Zj{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(r=>{r.type==="popstate"&&setTimeout(()=>{e(r.url,r.state,"popstate")})})}handleRouterEvent(e,r){e instanceof r0?this.updateStateMemento():e instanceof Nh?this.commitTransition(r):e instanceof fC?this.urlUpdateStrategy==="eager"&&(r.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(r),r)):e instanceof mC?(this.commitTransition(r),this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(r),r)):e instanceof Th&&(e.code===pc.GuardRejected||e.code===pc.NoDataFromResolver)?this.restoreHistory(r):e instanceof Iv?this.restoreHistory(r,!0):e instanceof Ep&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,{extras:r,id:o}){let{replaceUrl:s,state:i}=r;if(this.location.isCurrentPathEqualTo(e)||s){let a=this.browserPageId,u=Tt(Tt({},i),this.generateNgRouterState(o,a));this.location.replaceState(e,"",u)}else{let a=Tt(Tt({},i),this.generateNgRouterState(o,this.browserPageId+1));this.location.go(e,"",a)}}restoreHistory(e,r=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,s=this.currentPageId-o;s!==0?this.location.historyGo(s):this.getCurrentUrlTree()===e.finalUrl&&s===0&&(this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=a4(n)))(o||n)}})();static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function jE(n,t){n.events.pipe(Uc(e=>e instanceof Ep||e instanceof Th||e instanceof Iv||e instanceof Nh),go(e=>e instanceof Ep||e instanceof Nh?0:(e instanceof Th?e.code===pc.Redirect||e.code===pc.SupersededByNewNavigation:!1)?2:1),Uc(e=>e!==2),Mf(1)).subscribe(()=>{t()})}var NCe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},kCe={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},jf=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=xn($V);stateManager=xn(Zj);options=xn(Zy,{optional:!0})||{};pendingTasks=xn(dv);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=xn(VE);urlSerializer=xn(Yy);location=xn(e0);urlHandlingStrategy=xn(zE);_events=new za;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=xn(Qj);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=xn(Jy,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!xn(IC,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Mi;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(r=>{try{let o=this.navigationTransitions.currentTransition,s=this.navigationTransitions.currentNavigation;if(o!==null&&s!==null){if(this.stateManager.handleRouterEvent(r,s),r instanceof Th&&r.code!==pc.Redirect&&r.code!==pc.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Ep)this.navigated=!0;else if(r instanceof Tv){let i=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),u=Tt({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||_Ce(o.source)},i);this.scheduleNavigation(a,bE,null,u,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}ACe(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),bE,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,r,o)=>{this.navigateToSyncWithBrowser(e,o,r)})}navigateToSyncWithBrowser(e,r,o){let s={replaceUrl:!0},i=o?.navigationId?o:null;if(o){let u=Tt({},o);delete u.navigationId,delete u.\u0275routerPageId,Object.keys(u).length!==0&&(s.state=u)}let a=this.parseUrl(e);this.scheduleNavigation(a,r,i,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(aM),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,r={}){let{relativeTo:o,queryParams:s,fragment:i,queryParamsHandling:a,preserveFragment:u}=r,c=u?this.currentUrlTree.fragment:i,h=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":h=Tt(Tt({},this.currentUrlTree.queryParams),s);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=s||null}h!==null&&(h=this.removeEmptyProps(h));let f;try{let g=o?o.snapshot:this.routerState.snapshot.root;f=Aj(g)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),f=this.currentUrlTree.root}return Oj(f,e,h,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){let o=Sv(e)?e:this.parseUrl(e),s=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(s,bE,null,r)}navigate(e,r={skipLocationChange:!1}){return DCe(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,r){let o;if(r===!0?o=Tt({},NCe):r===!1?o=Tt({},kCe):o=r,Sv(e))return hj(this.currentUrlTree,e,o);let s=this.parseUrl(e);return hj(this.currentUrlTree,s,o)}removeEmptyProps(e){return Object.entries(e).reduce((r,[o,s])=>(s!=null&&(r[o]=s),r),{})}scheduleNavigation(e,r,o,s,i){if(this.disposed)return Promise.resolve(!1);let a,u,c;i?(a=i.resolve,u=i.reject,c=i.promise):c=new Promise((f,g)=>{a=f,u=g});let h=this.pendingTasks.add();return jE(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:s,resolve:a,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(f=>Promise.reject(f))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function DCe(n){for(let t=0;t<n.length;t++)if(n[t]==null)throw new ur(4008,!1)}function ACe(n){return!(n instanceof mC)&&!(n instanceof Tv)}var TC=class{};var Jj=(()=>{class n{router;injector;preloadingStrategy;loader;subscription;constructor(e,r,o,s){this.router=e,this.injector=r,this.preloadingStrategy=o,this.loader=s}setUpPreloading(){this.subscription=this.router.events.pipe(Uc(e=>e instanceof Ep),Wg(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,r){let o=[];for(let s of r){s.providers&&!s._injector&&(s._injector=ZS(s.providers,e,`Route: ${s.path}`));let i=s._injector??e,a=s._loadedInjector??i;(s.loadChildren&&!s._loadedRoutes&&s.canLoad===void 0||s.loadComponent&&!s._loadedComponent)&&o.push(this.preloadConfig(i,s)),(s.children||s._loadedRoutes)&&o.push(this.processRoutes(a,s.children??s._loadedRoutes))}return ai(o).pipe(Qb())}preloadConfig(e,r){return this.preloadingStrategy.preload(r,()=>{let o;r.loadChildren&&r.canLoad===void 0?o=this.loader.loadChildren(e,r):o=br(null);let s=o.pipe(Ci(i=>i===null?br(void 0):(r._loadedRoutes=i.routes,r._loadedInjector=i.injector,this.processRoutes(i.injector??e,i.routes))));if(r.loadComponent&&!r._loadedComponent){let i=this.loader.loadComponent(r);return ai([s,i]).pipe(Qb())}else return s})}static \u0275fac=function(r){return new(r||n)(Sr(jf),Sr(cc),Sr(TC),Sr(BE))};static \u0275prov=rr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),eU=new lr(""),OCe=(()=>{class n{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource="imperative";restoredId=0;store={};constructor(e,r,o,s,i={}){this.urlSerializer=e,this.transitions=r,this.viewportScroller=o,this.zone=s,this.options=i,i.scrollPositionRestoration||="disabled",i.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof r0?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Ep?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof Nh&&e.code===Cv.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof _v&&(e.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(e.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new _v(e,this.lastSource==="popstate"?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(r){DV()};static \u0275prov=rr({token:n,factory:n.\u0275fac})}return n})();function dM(n,...t){return BT([{provide:Jy,multi:!0,useValue:n},[],{provide:Vf,useFactory:tU,deps:[jf]},{provide:nE,multi:!0,useFactory:nU},t.map(e=>e.\u0275providers)])}function tU(n){return n.routerState.root}function EC(n,t){return{\u0275kind:n,\u0275providers:t}}function nU(){let n=xn(Cp);return t=>{let e=n.get(Gy);if(t!==e.components[0])return;let r=n.get(jf),o=n.get(rU);n.get(fM)===1&&r.initialNavigation(),n.get(iU,null,zr.Optional)?.setUpPreloading(),n.get(eU,null,zr.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var rU=new lr("",{factory:()=>new za}),fM=new lr("",{providedIn:"root",factory:()=>1});function oU(){let n=[{provide:fM,useValue:0},I4(()=>{let t=xn(Cp);return t.get(E4,Promise.resolve()).then(()=>new Promise(r=>{let o=t.get(jf),s=t.get(rU);jE(o,()=>{r(!0)}),t.get(VE).afterPreactivation=()=>(r(!0),s.closed?br(void 0):s),o.initialNavigation()}))})];return EC(2,n)}function sU(){let n=[I4(()=>{xn(jf).setUpLocationChangeListener()}),{provide:fM,useValue:2}];return EC(3,n)}var iU=new lr("");function aU(n){return EC(0,[{provide:iU,useExisting:Jj},{provide:TC,useExisting:n}])}function uU(){return EC(8,[sM,{provide:IC,useExisting:sM}])}function cU(n){gv("NgRouterViewTransitions");let t=[{provide:cM,useValue:Yj},{provide:lM,useValue:Tt({skipNextTransition:!!n?.skipInitialTransition},n)}];return EC(9,t)}var lU=[e0,{provide:Yy,useClass:n0},jf,Qy,{provide:Vf,useFactory:tU,deps:[jf]},BE,[]],mM=(()=>{class n{constructor(){}static forRoot(e,r){return{ngModule:n,providers:[lU,[],{provide:Jy,multi:!0,useValue:e},[],r?.errorHandler?{provide:pM,useValue:r.errorHandler}:[],{provide:Zy,useValue:r||{}},r?.useHash?MCe():FCe(),RCe(),r?.preloadingStrategy?aU(r.preloadingStrategy).\u0275providers:[],r?.initialNavigation?PCe(r):[],r?.bindToComponentInputs?uU().\u0275providers:[],r?.enableViewTransitions?cU().\u0275providers:[],$Ce()]}}static forChild(e){return{ngModule:n,providers:[{provide:Jy,multi:!0,useValue:e}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=JS({type:n});static \u0275inj=WS({})}return n})();function RCe(){return{provide:eU,useFactory:()=>{let n=xn(nj),t=xn(Ii),e=xn(Zy),r=xn(VE),o=xn(Yy);return e.scrollOffset&&n.setOffset(e.scrollOffset),new OCe(o,r,n,t,e)}}}function MCe(){return{provide:zf,useClass:N4}}function FCe(){return{provide:zf,useClass:uE}}function PCe(n){return[n.initialNavigation==="disabled"?sU().\u0275providers:[],n.initialNavigation==="enabledBlocking"?oU().\u0275providers:[]]}var hM=new lr("");function $Ce(){return[{provide:hM,useFactory:nU},{provide:nE,multi:!0,useExisting:hM}]}var pU=[];var hU={providers:[GV({eventCoalescing:!0}),dM(pU)]};var CO=kS(g1e());var SO=class n{title="magenta-music";playing=!1;onClick(t){return Te(this,null,function*(){let e=new CO.SoundFontPlayer("https://storage.googleapis.com/magentadata/js/soundfonts/salamander",void 0,void 0,void 0,{run:r=>{console.log(r)},stop:()=>{}});e.getPlayState()!=="started"?(this.playing=!0,CO.urlToNoteSequence("https://bitmidi.com/uploads/28362.mid").then(r=>{e.start(r).then(()=>{this.playing=!1})})):e.stop()})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=JT({type:n,selectors:[["app-root"]],decls:4,vars:1,consts:[[1,"main"],["matButton","",3,"click"]],template:function(e,r){e&1&&(rE(0,"main",0)(1,"button",1),sE("click",function(s){return r.onClick(s)}),VV(2),oE()(),eC(3,"router-outlet")),e&2&&(uV(2),_4(r.playing?"Stop":"Play"))},dependencies:[mM,CC],encapsulation:2})};B4(SO,hU).catch(n=>console.error(n));
